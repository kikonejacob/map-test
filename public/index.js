(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.glMatrix=factory()})(this,function(){"use strict";function create(){var out=new Float32Array(3);out[0]=0;out[1]=0;out[2]=0;return out}function transformMat3(out,a,m){var x=a[0],y=a[1],z=a[2];out[0]=x*m[0]+y*m[3]+z*m[6];out[1]=x*m[1]+y*m[4]+z*m[7];out[2]=x*m[2]+y*m[5]+z*m[8];return out}var vec=create();function create$1(){var out=new Float32Array(4);out[0]=0;out[1]=0;out[2]=0;out[3]=0;return out}function scale$1(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out}function normalize$1(out,a){var x=a[0],y=a[1],z=a[2],w=a[3];var len=x*x+y*y+z*z+w*w;if(len>0){len=1/Math.sqrt(len);out[0]=x*len;out[1]=y*len;out[2]=z*len;out[3]=w*len}return out}function transformMat4$1(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w;out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w;out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w;out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w;return out}var vec$1=create$1();function create$2(){var out=new Float32Array(4);out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out}function rotate(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],s=Math.sin(rad),c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;return out}function scale$2(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;return out}function create$3(){var out=new Float32Array(9);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out}function fromRotation$1(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=0;out[3]=-s;out[4]=c;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out}function create$4(){var out=new Float32Array(16);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function identity$2(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function invert$2(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a02*b10-a01*b11-a03*b09)*det;out[2]=(a31*b05-a32*b04+a33*b03)*det;out[3]=(a22*b04-a21*b05-a23*b03)*det;out[4]=(a12*b08-a10*b11-a13*b07)*det;out[5]=(a00*b11-a02*b08+a03*b07)*det;out[6]=(a32*b02-a30*b05-a33*b01)*det;out[7]=(a20*b05-a22*b02+a23*b01)*det;out[8]=(a10*b10-a11*b08+a13*b06)*det;out[9]=(a01*b08-a00*b10-a03*b06)*det;out[10]=(a30*b04-a31*b02+a33*b00)*det;out[11]=(a21*b02-a20*b04-a23*b00)*det;out[12]=(a11*b07-a10*b09-a12*b06)*det;out[13]=(a00*b09-a01*b07+a02*b06)*det;out[14]=(a31*b01-a30*b03-a32*b00)*det;out[15]=(a20*b03-a21*b01+a22*b00)*det;return out}function multiply$4(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=b0*a00+b1*a10+b2*a20+b3*a30;out[1]=b0*a01+b1*a11+b2*a21+b3*a31;out[2]=b0*a02+b1*a12+b2*a22+b3*a32;out[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];out[4]=b0*a00+b1*a10+b2*a20+b3*a30;out[5]=b0*a01+b1*a11+b2*a21+b3*a31;out[6]=b0*a02+b1*a12+b2*a22+b3*a32;out[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];out[8]=b0*a00+b1*a10+b2*a20+b3*a30;out[9]=b0*a01+b1*a11+b2*a21+b3*a31;out[10]=b0*a02+b1*a12+b2*a22+b3*a32;out[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];out[12]=b0*a00+b1*a10+b2*a20+b3*a30;out[13]=b0*a01+b1*a11+b2*a21+b3*a31;out[14]=b0*a02+b1*a12+b2*a22+b3*a32;out[15]=b0*a03+b1*a13+b2*a23+b3*a33;return out}function translate$1(out,a,v){var x=v[0],y=v[1],z=v[2],a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23;if(a===out){out[12]=a[0]*x+a[4]*y+a[8]*z+a[12];out[13]=a[1]*x+a[5]*y+a[9]*z+a[13];out[14]=a[2]*x+a[6]*y+a[10]*z+a[14];out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]}else{a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a03;out[4]=a10;out[5]=a11;out[6]=a12;out[7]=a13;out[8]=a20;out[9]=a21;out[10]=a22;out[11]=a23;out[12]=a00*x+a10*y+a20*z+a[12];out[13]=a01*x+a11*y+a21*z+a[13];out[14]=a02*x+a12*y+a22*z+a[14];out[15]=a03*x+a13*y+a23*z+a[15]}return out}function scale$4(out,a,v){var x=v[0],y=v[1],z=v[2];out[0]=a[0]*x;out[1]=a[1]*x;out[2]=a[2]*x;out[3]=a[3]*x;out[4]=a[4]*y;out[5]=a[5]*y;out[6]=a[6]*y;out[7]=a[7]*y;out[8]=a[8]*z;out[9]=a[9]*z;out[10]=a[10]*z;out[11]=a[11]*z;out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out}function rotateX$1(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[4]=a10*c+a20*s;out[5]=a11*c+a21*s;out[6]=a12*c+a22*s;out[7]=a13*c+a23*s;out[8]=a20*c-a10*s;out[9]=a21*c-a11*s;out[10]=a22*c-a12*s;out[11]=a23*c-a13*s;return out}function rotateZ$1(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];if(a!==out){out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c+a10*s;out[1]=a01*c+a11*s;out[2]=a02*c+a12*s;out[3]=a03*c+a13*s;out[4]=a10*c-a00*s;out[5]=a11*c-a01*s;out[6]=a12*c-a02*s;out[7]=a13*c-a03*s;return out}function perspective(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf=1/(near-far);out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=2*far*near*nf;out[15]=0;return out}function ortho(out,left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=2*nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=(far+near)*nf;out[15]=1;return out}var mapboxBuild={vec3:{transformMat3:transformMat3},vec4:{transformMat4:transformMat4$1},mat2:{create:create$2,rotate:rotate,scale:scale$2},mat3:{create:create$3,fromRotation:fromRotation$1},mat4:{create:create$4,identity:identity$2,translate:translate$1,scale:scale$4,multiply:multiply$4,perspective:perspective,rotateX:rotateX$1,rotateZ:rotateZ$1,invert:invert$2,ortho:ortho}};return mapboxBuild})},{}],2:[function(require,module,exports){(function(global){"use strict";function compare(a,b){if(a===b){return 0}var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y){return-1}if(y<x){return 1}return 0}function isBuffer(b){if(global.Buffer&&typeof global.Buffer.isBuffer==="function"){return global.Buffer.isBuffer(b)}return!!(b!=null&&b._isBuffer)}var util=require("util/");var hasOwn=Object.prototype.hasOwnProperty;var pSlice=Array.prototype.slice;var functionsHaveNames=function(){return function foo(){}.name==="foo"}();function pToString(obj){return Object.prototype.toString.call(obj)}function isView(arrbuf){if(isBuffer(arrbuf)){return false}if(typeof global.ArrayBuffer!=="function"){return false}if(typeof ArrayBuffer.isView==="function"){return ArrayBuffer.isView(arrbuf)}if(!arrbuf){return false}if(arrbuf instanceof DataView){return true}if(arrbuf.buffer&&arrbuf.buffer instanceof ArrayBuffer){return true}return false}var assert=module.exports=ok;var regex=/\s*function\s+([^\(\s]*)\s*/;function getName(func){if(!util.isFunction(func)){return}if(functionsHaveNames){return func.name}var str=func.toString();var match=str.match(regex);return match&&match[1]}assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;if(options.message){this.message=options.message;this.generatedMessage=false}else{this.message=getMessage(this);this.generatedMessage=true}var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace){Error.captureStackTrace(this,stackStartFunction)}else{var err=new Error;if(err.stack){var out=err.stack;var fn_name=getName(stackStartFunction);var idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}};util.inherits(assert.AssertionError,Error);function truncate(s,n){if(typeof s==="string"){return s.length<n?s:s.slice(0,n)}else{return s}}function inspect(something){if(functionsHaveNames||!util.isFunction(something)){return util.inspect(something)}var rawname=getName(something);var name=rawname?": "+rawname:"";return"[Function"+name+"]"}function getMessage(self){return truncate(inspect(self.actual),128)+" "+self.operator+" "+truncate(inspect(self.expected),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){if(!value)fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,"!=",assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected,false)){fail(actual,expected,message,"deepEqual",assert.deepEqual)}};assert.deepStrictEqual=function deepStrictEqual(actual,expected,message){if(!_deepEqual(actual,expected,true)){fail(actual,expected,message,"deepStrictEqual",assert.deepStrictEqual)}};function _deepEqual(actual,expected,strict,memos){if(actual===expected){return true}else if(isBuffer(actual)&&isBuffer(expected)){return compare(actual,expected)===0}else if(util.isDate(actual)&&util.isDate(expected)){return actual.getTime()===expected.getTime()}else if(util.isRegExp(actual)&&util.isRegExp(expected)){return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase}else if((actual===null||typeof actual!=="object")&&(expected===null||typeof expected!=="object")){return strict?actual===expected:actual==expected}else if(isView(actual)&&isView(expected)&&pToString(actual)===pToString(expected)&&!(actual instanceof Float32Array||actual instanceof Float64Array)){return compare(new Uint8Array(actual.buffer),new Uint8Array(expected.buffer))===0}else if(isBuffer(actual)!==isBuffer(expected)){return false}else{memos=memos||{actual:[],expected:[]};var actualIndex=memos.actual.indexOf(actual);if(actualIndex!==-1){if(actualIndex===memos.expected.indexOf(expected)){return true}}memos.actual.push(actual);memos.expected.push(expected);return objEquiv(actual,expected,strict,memos)}}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b,strict,actualVisitedObjects){if(a===null||a===undefined||b===null||b===undefined)return false;if(util.isPrimitive(a)||util.isPrimitive(b))return a===b;if(strict&&Object.getPrototypeOf(a)!==Object.getPrototypeOf(b))return false;var aIsArgs=isArguments(a);var bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return false;if(aIsArgs){a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b,strict)}var ka=objectKeys(a);var kb=objectKeys(b);var key,i;if(ka.length!==kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!==kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key],strict,actualVisitedObjects))return false}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected,false)){fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)}};assert.notDeepStrictEqual=notDeepStrictEqual;function notDeepStrictEqual(actual,expected,message){if(_deepEqual(actual,expected,true)){fail(actual,expected,message,"notDeepStrictEqual",notDeepStrictEqual)}}assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,"===",assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,"!==",assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return false}if(Object.prototype.toString.call(expected)=="[object RegExp]"){return expected.test(actual)}try{if(actual instanceof expected){return true}}catch(e){}if(Error.isPrototypeOf(expected)){return false}return expected.call({},actual)===true}function _tryBlock(block){var error;try{block()}catch(e){error=e}return error}function _throws(shouldThrow,block,expected,message){var actual;if(typeof block!=="function"){throw new TypeError('"block" argument must be a function')}if(typeof expected==="string"){message=expected;expected=null}actual=_tryBlock(block);message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");if(shouldThrow&&!actual){fail(actual,expected,"Missing expected exception"+message)}var userProvidedMessage=typeof message==="string";var isUnwantedException=!shouldThrow&&util.isError(actual);var isUnexpectedException=!shouldThrow&&actual&&!expected;if(isUnwantedException&&userProvidedMessage&&expectedException(actual,expected)||isUnexpectedException){fail(actual,expected,"Got unwanted exception"+message)}if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual){throw actual}}assert.throws=function(block,error,message){_throws(true,block,error,message)};assert.doesNotThrow=function(block,error,message){_throws(false,block,error,message)};assert.ifError=function(err){if(err)throw err};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){if(hasOwn.call(obj,key))keys.push(key)}return keys}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"util/":996}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=autobind;function autobind(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}if(args.length===1){return boundClass.apply(undefined,args)}else{return boundMethod.apply(undefined,args)}}function boundClass(target){var keys=undefined;if(typeof Reflect!=="undefined"&&typeof Reflect.ownKeys==="function"){keys=Reflect.ownKeys(target.prototype)}else{keys=Object.getOwnPropertyNames(target.prototype);if(typeof Object.getOwnPropertySymbols==="function"){keys=keys.concat(Object.getOwnPropertySymbols(target.prototype))}}keys.forEach(function(key){if(key==="constructor"){return}var descriptor=Object.getOwnPropertyDescriptor(target.prototype,key);if(typeof descriptor.value==="function"){Object.defineProperty(target.prototype,key,boundMethod(target,key,descriptor))}});return target}function boundMethod(target,key,descriptor){var fn=descriptor.value;if(typeof fn!=="function"){throw new Error("@autobind decorator can only be applied to methods not: "+typeof fn)}var definingProperty=false;return{configurable:true,get:function get(){if(definingProperty||this===target.prototype||this.hasOwnProperty(key)){return fn}var boundFn=fn.bind(this);definingProperty=true;Object.defineProperty(this,key,{value:boundFn,configurable:true,writable:true});definingProperty=false;return boundFn}}}module.exports=exports["default"]},{}],4:[function(require,module,exports){(function(global){"use strict";require("core-js/shim");require("regenerator-runtime/runtime");require("core-js/fn/regexp/escape");if(global._babelPolyfill){throw new Error("only one instance of babel-polyfill is allowed")}global._babelPolyfill=true;var DEFINE_PROPERTY="defineProperty";function define(O,key,value){O[key]||Object[DEFINE_PROPERTY](O,key,{writable:true,configurable:true,value:value})}define(String.prototype,"padLeft","".padStart);define(String.prototype,"padRight","".padEnd);"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(key){[][key]&&define(Array,key,Function.call.bind([][key]))})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"core-js/fn/regexp/escape":24,"core-js/shim":317,"regenerator-runtime/runtime":963}],5:[function(require,module,exports){!function(root,name,definition){if(typeof module!="undefined"&&module.exports)module.exports=definition();else if(typeof define=="function"&&define.amd)define(name,definition);else root[name]=definition()}(this,"bowser",function(){var t=true;function detect(ua){function getFirstMatch(regex){var match=ua.match(regex);return match&&match.length>1&&match[1]||""}function getSecondMatch(regex){var match=ua.match(regex);return match&&match.length>1&&match[2]||""}var iosdevice=getFirstMatch(/(ipod|iphone|ipad)/i).toLowerCase(),likeAndroid=/like android/i.test(ua),android=!likeAndroid&&/android/i.test(ua),nexusMobile=/nexus\s*[0-6]\s*/i.test(ua),nexusTablet=!nexusMobile&&/nexus\s*[0-9]+/i.test(ua),chromeos=/CrOS/.test(ua),silk=/silk/i.test(ua),sailfish=/sailfish/i.test(ua),tizen=/tizen/i.test(ua),webos=/(web|hpw)os/i.test(ua),windowsphone=/windows phone/i.test(ua),samsungBrowser=/SamsungBrowser/i.test(ua),windows=!windowsphone&&/windows/i.test(ua),mac=!iosdevice&&!silk&&/macintosh/i.test(ua),linux=!android&&!sailfish&&!tizen&&!webos&&/linux/i.test(ua),edgeVersion=getFirstMatch(/edge\/(\d+(\.\d+)?)/i),versionIdentifier=getFirstMatch(/version\/(\d+(\.\d+)?)/i),tablet=/tablet/i.test(ua),mobile=!tablet&&/[^-]mobi/i.test(ua),xbox=/xbox/i.test(ua),result;if(/opera/i.test(ua)){result={name:"Opera",opera:t,version:versionIdentifier||getFirstMatch(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}}else if(/opr|opios/i.test(ua)){result={name:"Opera",opera:t,version:getFirstMatch(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||versionIdentifier}}else if(/SamsungBrowser/i.test(ua)){result={name:"Samsung Internet for Android",samsungBrowser:t,version:versionIdentifier||getFirstMatch(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}}else if(/coast/i.test(ua)){result={name:"Opera Coast",coast:t,version:versionIdentifier||getFirstMatch(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}}else if(/yabrowser/i.test(ua)){result={name:"Yandex Browser",yandexbrowser:t,version:versionIdentifier||getFirstMatch(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}}else if(/ucbrowser/i.test(ua)){result={name:"UC Browser",ucbrowser:t,version:getFirstMatch(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}}else if(/mxios/i.test(ua)){result={name:"Maxthon",maxthon:t,version:getFirstMatch(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}}else if(/epiphany/i.test(ua)){result={name:"Epiphany",epiphany:t,version:getFirstMatch(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}}else if(/puffin/i.test(ua)){result={name:"Puffin",puffin:t,version:getFirstMatch(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}}else if(/sleipnir/i.test(ua)){result={name:"Sleipnir",sleipnir:t,version:getFirstMatch(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}}else if(/k-meleon/i.test(ua)){result={name:"K-Meleon",kMeleon:t,version:getFirstMatch(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}}else if(windowsphone){result={name:"Windows Phone",windowsphone:t};if(edgeVersion){result.msedge=t;result.version=edgeVersion}else{result.msie=t;result.version=getFirstMatch(/iemobile\/(\d+(\.\d+)?)/i)}}else if(/msie|trident/i.test(ua)){result={name:"Internet Explorer",msie:t,version:getFirstMatch(/(?:msie |rv:)(\d+(\.\d+)?)/i)}}else if(chromeos){result={name:"Chrome",chromeos:t,chromeBook:t,chrome:t,version:getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}}else if(/chrome.+? edge/i.test(ua)){result={name:"Microsoft Edge",msedge:t,version:edgeVersion}}else if(/vivaldi/i.test(ua)){result={name:"Vivaldi",vivaldi:t,version:getFirstMatch(/vivaldi\/(\d+(\.\d+)?)/i)||versionIdentifier}}else if(sailfish){result={name:"Sailfish",sailfish:t,version:getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}}else if(/seamonkey\//i.test(ua)){result={name:"SeaMonkey",seamonkey:t,version:getFirstMatch(/seamonkey\/(\d+(\.\d+)?)/i)}}else if(/firefox|iceweasel|fxios/i.test(ua)){result={name:"Firefox",firefox:t,version:getFirstMatch(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)};if(/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(ua)){result.firefoxos=t}}else if(silk){result={name:"Amazon Silk",silk:t,version:getFirstMatch(/silk\/(\d+(\.\d+)?)/i)}}else if(/phantom/i.test(ua)){result={name:"PhantomJS",phantom:t,version:getFirstMatch(/phantomjs\/(\d+(\.\d+)?)/i)}}else if(/slimerjs/i.test(ua)){result={name:"SlimerJS",slimer:t,version:getFirstMatch(/slimerjs\/(\d+(\.\d+)?)/i)}}else if(/blackberry|\bbb\d+/i.test(ua)||/rim\stablet/i.test(ua)){result={name:"BlackBerry",blackberry:t,version:versionIdentifier||getFirstMatch(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}}else if(webos){result={name:"WebOS",webos:t,version:versionIdentifier||getFirstMatch(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)};/touchpad\//i.test(ua)&&(result.touchpad=t)}else if(/bada/i.test(ua)){result={name:"Bada",bada:t,version:getFirstMatch(/dolfin\/(\d+(\.\d+)?)/i)}}else if(tizen){result={name:"Tizen",tizen:t,version:getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||versionIdentifier}}else if(/qupzilla/i.test(ua)){result={name:"QupZilla",qupzilla:t,version:getFirstMatch(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||versionIdentifier}}else if(/chromium/i.test(ua)){result={name:"Chromium",chromium:t,version:getFirstMatch(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||versionIdentifier}}else if(/chrome|crios|crmo/i.test(ua)){result={name:"Chrome",chrome:t,version:getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}}else if(android){result={name:"Android",version:versionIdentifier}}else if(/safari|applewebkit/i.test(ua)){result={name:"Safari",safari:t};if(versionIdentifier){result.version=versionIdentifier}}else if(iosdevice){result={name:iosdevice=="iphone"?"iPhone":iosdevice=="ipad"?"iPad":"iPod"};if(versionIdentifier){result.version=versionIdentifier}}else if(/googlebot/i.test(ua)){result={name:"Googlebot",googlebot:t,version:getFirstMatch(/googlebot\/(\d+(\.\d+))/i)||versionIdentifier}}else{result={name:getFirstMatch(/^(.*)\/(.*) /),version:getSecondMatch(/^(.*)\/(.*) /)}}if(!result.msedge&&/(apple)?webkit/i.test(ua)){if(/(apple)?webkit\/537\.36/i.test(ua)){result.name=result.name||"Blink";result.blink=t}else{result.name=result.name||"Webkit";result.webkit=t}if(!result.version&&versionIdentifier){result.version=versionIdentifier}}else if(!result.opera&&/gecko\//i.test(ua)){result.name=result.name||"Gecko";result.gecko=t;result.version=result.version||getFirstMatch(/gecko\/(\d+(\.\d+)?)/i)}if(!result.windowsphone&&!result.msedge&&(android||result.silk)){result.android=t}else if(!result.windowsphone&&!result.msedge&&iosdevice){result[iosdevice]=t;result.ios=t}else if(mac){result.mac=t}else if(xbox){result.xbox=t}else if(windows){result.windows=t}else if(linux){result.linux=t}var osVersion="";if(result.windowsphone){osVersion=getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i)}else if(iosdevice){osVersion=getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i);osVersion=osVersion.replace(/[_\s]/g,".")}else if(android){osVersion=getFirstMatch(/android[ \/-](\d+(\.\d+)*)/i)}else if(result.webos){osVersion=getFirstMatch(/(?:web|hpw)os\/(\d+(\.\d+)*)/i)}else if(result.blackberry){osVersion=getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i)}else if(result.bada){osVersion=getFirstMatch(/bada\/(\d+(\.\d+)*)/i)}else if(result.tizen){osVersion=getFirstMatch(/tizen[\/\s](\d+(\.\d+)*)/i)}if(osVersion){result.osversion=osVersion}var osMajorVersion=osVersion.split(".")[0];if(tablet||nexusTablet||iosdevice=="ipad"||android&&(osMajorVersion==3||osMajorVersion>=4&&!mobile)||result.silk){result.tablet=t}else if(mobile||iosdevice=="iphone"||iosdevice=="ipod"||android||nexusMobile||result.blackberry||result.webos||result.bada){result.mobile=t}if(result.msedge||result.msie&&result.version>=10||result.yandexbrowser&&result.version>=15||result.vivaldi&&result.version>=1||result.chrome&&result.version>=20||result.samsungBrowser&&result.version>=4||result.firefox&&result.version>=20||result.safari&&result.version>=6||result.opera&&result.version>=10||result.ios&&result.osversion&&result.osversion.split(".")[0]>=6||result.blackberry&&result.version>=10.1||result.chromium&&result.version>=20){result.a=t}else if(result.msie&&result.version<10||result.chrome&&result.version<20||result.firefox&&result.version<20||result.safari&&result.version<6||result.opera&&result.version<10||result.ios&&result.osversion&&result.osversion.split(".")[0]<6||result.chromium&&result.version<20){result.c=t}else result.x=t;return result}var bowser=detect(typeof navigator!=="undefined"?navigator.userAgent||"":"");bowser.test=function(browserList){for(var i=0;i<browserList.length;++i){var browserItem=browserList[i];if(typeof browserItem==="string"){if(browserItem in bowser){return true}}}return false};function getVersionPrecision(version){return version.split(".").length}function map(arr,iterator){var result=[],i;if(Array.prototype.map){return Array.prototype.map.call(arr,iterator)}for(i=0;i<arr.length;i++){result.push(iterator(arr[i]))}return result}function compareVersions(versions){var precision=Math.max(getVersionPrecision(versions[0]),getVersionPrecision(versions[1]));var chunks=map(versions,function(version){var delta=precision-getVersionPrecision(version);version=version+new Array(delta+1).join(".0");return map(version.split("."),function(chunk){return new Array(20-chunk.length).join("0")+chunk}).reverse()});while(--precision>=0){if(chunks[0][precision]>chunks[1][precision]){return 1}else if(chunks[0][precision]===chunks[1][precision]){if(precision===0){return 0}}else{return-1}}}function isUnsupportedBrowser(minVersions,strictMode,ua){var _bowser=bowser;if(typeof strictMode==="string"){ua=strictMode;strictMode=void 0}if(strictMode===void 0){strictMode=false}if(ua){_bowser=detect(ua)}var version=""+_bowser.version;for(var browser in minVersions){if(minVersions.hasOwnProperty(browser)){if(_bowser[browser]){if(typeof minVersions[browser]!=="string"){throw new Error("Browser version in the minVersion map should be a string: "+browser+": "+String(minVersions))}return compareVersions([version,minVersions[browser]])<0}}}return strictMode}function check(minVersions,strictMode,ua){return!isUnsupportedBrowser(minVersions,strictMode,ua)}bowser.isUnsupportedBrowser=isUnsupportedBrowser;bowser.compareVersions=compareVersions;bowser.check=check;bowser._detect=detect;return bowser})},{}],6:[function(require,module,exports){},{}],7:[function(require,module,exports){(function(process,Buffer){var msg=require("pako/lib/zlib/messages");var zstream=require("pako/lib/zlib/zstream");var zlib_deflate=require("pako/lib/zlib/deflate.js");var zlib_inflate=require("pako/lib/zlib/inflate.js");var constants=require("pako/lib/zlib/constants");for(var key in constants){exports[key]=constants[key]}exports.NONE=0;exports.DEFLATE=1;exports.INFLATE=2;exports.GZIP=3;exports.GUNZIP=4;exports.DEFLATERAW=5;exports.INFLATERAW=6;exports.UNZIP=7;function Zlib(mode){if(mode<exports.DEFLATE||mode>exports.UNZIP)throw new TypeError("Bad argument");this.mode=mode;this.init_done=false;this.write_in_progress=false;this.pending_close=false;this.windowBits=0;this.level=0;this.memLevel=0;this.strategy=0;this.dictionary=null}Zlib.prototype.init=function(windowBits,level,memLevel,strategy,dictionary){this.windowBits=windowBits;this.level=level;this.memLevel=memLevel;this.strategy=strategy;if(this.mode===exports.GZIP||this.mode===exports.GUNZIP)this.windowBits+=16;if(this.mode===exports.UNZIP)this.windowBits+=32;if(this.mode===exports.DEFLATERAW||this.mode===exports.INFLATERAW)this.windowBits=-this.windowBits;this.strm=new zstream;switch(this.mode){case exports.DEFLATE:case exports.GZIP:case exports.DEFLATERAW:var status=zlib_deflate.deflateInit2(this.strm,this.level,exports.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case exports.INFLATE:case exports.GUNZIP:case exports.INFLATERAW:case exports.UNZIP:var status=zlib_inflate.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}if(status!==exports.Z_OK){this._error(status);return}this.write_in_progress=false;this.init_done=true};Zlib.prototype.params=function(){throw new Error("deflateParams Not supported")};Zlib.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(this.mode===exports.NONE)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")};Zlib.prototype.write=function(flush,input,in_off,in_len,out,out_off,out_len){this._writeCheck();this.write_in_progress=true;var self=this;process.nextTick(function(){self.write_in_progress=false;var res=self._write(flush,input,in_off,in_len,out,out_off,out_len);self.callback(res[0],res[1]);if(self.pending_close)self.close()});return this};function bufferSet(data,offset){for(var i=0;i<data.length;i++){this[offset+i]=data[i]}}Zlib.prototype.writeSync=function(flush,input,in_off,in_len,out,out_off,out_len){this._writeCheck();return this._write(flush,input,in_off,in_len,out,out_off,out_len)};Zlib.prototype._write=function(flush,input,in_off,in_len,out,out_off,out_len){this.write_in_progress=true;if(flush!==exports.Z_NO_FLUSH&&flush!==exports.Z_PARTIAL_FLUSH&&flush!==exports.Z_SYNC_FLUSH&&flush!==exports.Z_FULL_FLUSH&&flush!==exports.Z_FINISH&&flush!==exports.Z_BLOCK){throw new Error("Invalid flush value")}if(input==null){input=new Buffer(0);in_len=0;in_off=0}if(out._set)out.set=out._set;else out.set=bufferSet;var strm=this.strm;strm.avail_in=in_len;strm.input=input;strm.next_in=in_off;strm.avail_out=out_len;strm.output=out;strm.next_out=out_off;switch(this.mode){case exports.DEFLATE:case exports.GZIP:case exports.DEFLATERAW:var status=zlib_deflate.deflate(strm,flush);break;case exports.UNZIP:case exports.INFLATE:case exports.GUNZIP:case exports.INFLATERAW:var status=zlib_inflate.inflate(strm,flush);break;default:throw new Error("Unknown mode "+this.mode)}if(status!==exports.Z_STREAM_END&&status!==exports.Z_OK){this._error(status)}this.write_in_progress=false;return[strm.avail_in,strm.avail_out]};Zlib.prototype.close=function(){if(this.write_in_progress){this.pending_close=true;return}this.pending_close=false;if(this.mode===exports.DEFLATE||this.mode===exports.GZIP||this.mode===exports.DEFLATERAW){zlib_deflate.deflateEnd(this.strm)}else{zlib_inflate.inflateEnd(this.strm)}this.mode=exports.NONE};Zlib.prototype.reset=function(){switch(this.mode){case exports.DEFLATE:case exports.DEFLATERAW:var status=zlib_deflate.deflateReset(this.strm);
break;case exports.INFLATE:case exports.INFLATERAW:var status=zlib_inflate.inflateReset(this.strm);break}if(status!==exports.Z_OK){this._error(status)}};Zlib.prototype._error=function(status){this.onerror(msg[status]+": "+this.strm.msg,status);this.write_in_progress=false;if(this.pending_close)this.close()};exports.Zlib=Zlib}).call(this,require("_process"),require("buffer").Buffer)},{_process:11,buffer:19,"pako/lib/zlib/constants":736,"pako/lib/zlib/deflate.js":738,"pako/lib/zlib/inflate.js":740,"pako/lib/zlib/messages":742,"pako/lib/zlib/zstream":744}],8:[function(require,module,exports){(function(process,Buffer){var Transform=require("_stream_transform");var binding=require("./binding");var util=require("util");var assert=require("assert").ok;binding.Z_MIN_WINDOWBITS=8;binding.Z_MAX_WINDOWBITS=15;binding.Z_DEFAULT_WINDOWBITS=15;binding.Z_MIN_CHUNK=64;binding.Z_MAX_CHUNK=Infinity;binding.Z_DEFAULT_CHUNK=16*1024;binding.Z_MIN_MEMLEVEL=1;binding.Z_MAX_MEMLEVEL=9;binding.Z_DEFAULT_MEMLEVEL=8;binding.Z_MIN_LEVEL=-1;binding.Z_MAX_LEVEL=9;binding.Z_DEFAULT_LEVEL=binding.Z_DEFAULT_COMPRESSION;Object.keys(binding).forEach(function(k){if(k.match(/^Z/))exports[k]=binding[k]});exports.codes={Z_OK:binding.Z_OK,Z_STREAM_END:binding.Z_STREAM_END,Z_NEED_DICT:binding.Z_NEED_DICT,Z_ERRNO:binding.Z_ERRNO,Z_STREAM_ERROR:binding.Z_STREAM_ERROR,Z_DATA_ERROR:binding.Z_DATA_ERROR,Z_MEM_ERROR:binding.Z_MEM_ERROR,Z_BUF_ERROR:binding.Z_BUF_ERROR,Z_VERSION_ERROR:binding.Z_VERSION_ERROR};Object.keys(exports.codes).forEach(function(k){exports.codes[exports.codes[k]]=k});exports.Deflate=Deflate;exports.Inflate=Inflate;exports.Gzip=Gzip;exports.Gunzip=Gunzip;exports.DeflateRaw=DeflateRaw;exports.InflateRaw=InflateRaw;exports.Unzip=Unzip;exports.createDeflate=function(o){return new Deflate(o)};exports.createInflate=function(o){return new Inflate(o)};exports.createDeflateRaw=function(o){return new DeflateRaw(o)};exports.createInflateRaw=function(o){return new InflateRaw(o)};exports.createGzip=function(o){return new Gzip(o)};exports.createGunzip=function(o){return new Gunzip(o)};exports.createUnzip=function(o){return new Unzip(o)};exports.deflate=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Deflate(opts),buffer,callback)};exports.deflateSync=function(buffer,opts){return zlibBufferSync(new Deflate(opts),buffer)};exports.gzip=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Gzip(opts),buffer,callback)};exports.gzipSync=function(buffer,opts){return zlibBufferSync(new Gzip(opts),buffer)};exports.deflateRaw=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new DeflateRaw(opts),buffer,callback)};exports.deflateRawSync=function(buffer,opts){return zlibBufferSync(new DeflateRaw(opts),buffer)};exports.unzip=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Unzip(opts),buffer,callback)};exports.unzipSync=function(buffer,opts){return zlibBufferSync(new Unzip(opts),buffer)};exports.inflate=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Inflate(opts),buffer,callback)};exports.inflateSync=function(buffer,opts){return zlibBufferSync(new Inflate(opts),buffer)};exports.gunzip=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Gunzip(opts),buffer,callback)};exports.gunzipSync=function(buffer,opts){return zlibBufferSync(new Gunzip(opts),buffer)};exports.inflateRaw=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new InflateRaw(opts),buffer,callback)};exports.inflateRawSync=function(buffer,opts){return zlibBufferSync(new InflateRaw(opts),buffer)};function zlibBuffer(engine,buffer,callback){var buffers=[];var nread=0;engine.on("error",onError);engine.on("end",onEnd);engine.end(buffer);flow();function flow(){var chunk;while(null!==(chunk=engine.read())){buffers.push(chunk);nread+=chunk.length}engine.once("readable",flow)}function onError(err){engine.removeListener("end",onEnd);engine.removeListener("readable",flow);callback(err)}function onEnd(){var buf=Buffer.concat(buffers,nread);buffers=[];callback(null,buf);engine.close()}}function zlibBufferSync(engine,buffer){if(typeof buffer==="string")buffer=new Buffer(buffer);if(!Buffer.isBuffer(buffer))throw new TypeError("Not a string or buffer");var flushFlag=binding.Z_FINISH;return engine._processChunk(buffer,flushFlag)}function Deflate(opts){if(!(this instanceof Deflate))return new Deflate(opts);Zlib.call(this,opts,binding.DEFLATE)}function Inflate(opts){if(!(this instanceof Inflate))return new Inflate(opts);Zlib.call(this,opts,binding.INFLATE)}function Gzip(opts){if(!(this instanceof Gzip))return new Gzip(opts);Zlib.call(this,opts,binding.GZIP)}function Gunzip(opts){if(!(this instanceof Gunzip))return new Gunzip(opts);Zlib.call(this,opts,binding.GUNZIP)}function DeflateRaw(opts){if(!(this instanceof DeflateRaw))return new DeflateRaw(opts);Zlib.call(this,opts,binding.DEFLATERAW)}function InflateRaw(opts){if(!(this instanceof InflateRaw))return new InflateRaw(opts);Zlib.call(this,opts,binding.INFLATERAW)}function Unzip(opts){if(!(this instanceof Unzip))return new Unzip(opts);Zlib.call(this,opts,binding.UNZIP)}function Zlib(opts,mode){this._opts=opts=opts||{};this._chunkSize=opts.chunkSize||exports.Z_DEFAULT_CHUNK;Transform.call(this,opts);if(opts.flush){if(opts.flush!==binding.Z_NO_FLUSH&&opts.flush!==binding.Z_PARTIAL_FLUSH&&opts.flush!==binding.Z_SYNC_FLUSH&&opts.flush!==binding.Z_FULL_FLUSH&&opts.flush!==binding.Z_FINISH&&opts.flush!==binding.Z_BLOCK){throw new Error("Invalid flush flag: "+opts.flush)}}this._flushFlag=opts.flush||binding.Z_NO_FLUSH;if(opts.chunkSize){if(opts.chunkSize<exports.Z_MIN_CHUNK||opts.chunkSize>exports.Z_MAX_CHUNK){throw new Error("Invalid chunk size: "+opts.chunkSize)}}if(opts.windowBits){if(opts.windowBits<exports.Z_MIN_WINDOWBITS||opts.windowBits>exports.Z_MAX_WINDOWBITS){throw new Error("Invalid windowBits: "+opts.windowBits)}}if(opts.level){if(opts.level<exports.Z_MIN_LEVEL||opts.level>exports.Z_MAX_LEVEL){throw new Error("Invalid compression level: "+opts.level)}}if(opts.memLevel){if(opts.memLevel<exports.Z_MIN_MEMLEVEL||opts.memLevel>exports.Z_MAX_MEMLEVEL){throw new Error("Invalid memLevel: "+opts.memLevel)}}if(opts.strategy){if(opts.strategy!=exports.Z_FILTERED&&opts.strategy!=exports.Z_HUFFMAN_ONLY&&opts.strategy!=exports.Z_RLE&&opts.strategy!=exports.Z_FIXED&&opts.strategy!=exports.Z_DEFAULT_STRATEGY){throw new Error("Invalid strategy: "+opts.strategy)}}if(opts.dictionary){if(!Buffer.isBuffer(opts.dictionary)){throw new Error("Invalid dictionary: it should be a Buffer instance")}}this._binding=new binding.Zlib(mode);var self=this;this._hadError=false;this._binding.onerror=function(message,errno){self._binding=null;self._hadError=true;var error=new Error(message);error.errno=errno;error.code=exports.codes[errno];self.emit("error",error)};var level=exports.Z_DEFAULT_COMPRESSION;if(typeof opts.level==="number")level=opts.level;var strategy=exports.Z_DEFAULT_STRATEGY;if(typeof opts.strategy==="number")strategy=opts.strategy;this._binding.init(opts.windowBits||exports.Z_DEFAULT_WINDOWBITS,level,opts.memLevel||exports.Z_DEFAULT_MEMLEVEL,strategy,opts.dictionary);this._buffer=new Buffer(this._chunkSize);this._offset=0;this._closed=false;this._level=level;this._strategy=strategy;this.once("end",this.close)}util.inherits(Zlib,Transform);Zlib.prototype.params=function(level,strategy,callback){if(level<exports.Z_MIN_LEVEL||level>exports.Z_MAX_LEVEL){throw new RangeError("Invalid compression level: "+level)}if(strategy!=exports.Z_FILTERED&&strategy!=exports.Z_HUFFMAN_ONLY&&strategy!=exports.Z_RLE&&strategy!=exports.Z_FIXED&&strategy!=exports.Z_DEFAULT_STRATEGY){throw new TypeError("Invalid strategy: "+strategy)}if(this._level!==level||this._strategy!==strategy){var self=this;this.flush(binding.Z_SYNC_FLUSH,function(){self._binding.params(level,strategy);if(!self._hadError){self._level=level;self._strategy=strategy;if(callback)callback()}})}else{process.nextTick(callback)}};Zlib.prototype.reset=function(){return this._binding.reset()};Zlib.prototype._flush=function(callback){this._transform(new Buffer(0),"",callback)};Zlib.prototype.flush=function(kind,callback){var ws=this._writableState;if(typeof kind==="function"||kind===void 0&&!callback){callback=kind;kind=binding.Z_FULL_FLUSH}if(ws.ended){if(callback)process.nextTick(callback)}else if(ws.ending){if(callback)this.once("end",callback)}else if(ws.needDrain){var self=this;this.once("drain",function(){self.flush(callback)})}else{this._flushFlag=kind;this.write(new Buffer(0),"",callback)}};Zlib.prototype.close=function(callback){if(callback)process.nextTick(callback);if(this._closed)return;this._closed=true;this._binding.close();var self=this;process.nextTick(function(){self.emit("close")})};Zlib.prototype._transform=function(chunk,encoding,cb){var flushFlag;var ws=this._writableState;var ending=ws.ending||ws.ended;var last=ending&&(!chunk||ws.length===chunk.length);if(!chunk===null&&!Buffer.isBuffer(chunk))return cb(new Error("invalid input"));if(last)flushFlag=binding.Z_FINISH;else{flushFlag=this._flushFlag;if(chunk.length>=ws.length){this._flushFlag=this._opts.flush||binding.Z_NO_FLUSH}}var self=this;this._processChunk(chunk,flushFlag,cb)};Zlib.prototype._processChunk=function(chunk,flushFlag,cb){var availInBefore=chunk&&chunk.length;var availOutBefore=this._chunkSize-this._offset;var inOff=0;var self=this;var async=typeof cb==="function";if(!async){var buffers=[];var nread=0;var error;this.on("error",function(er){error=er});do{var res=this._binding.writeSync(flushFlag,chunk,inOff,availInBefore,this._buffer,this._offset,availOutBefore)}while(!this._hadError&&callback(res[0],res[1]));if(this._hadError){throw error}var buf=Buffer.concat(buffers,nread);this.close();return buf}var req=this._binding.write(flushFlag,chunk,inOff,availInBefore,this._buffer,this._offset,availOutBefore);req.buffer=chunk;req.callback=callback;function callback(availInAfter,availOutAfter){if(self._hadError)return;var have=availOutBefore-availOutAfter;assert(have>=0,"have should not go down");if(have>0){var out=self._buffer.slice(self._offset,self._offset+have);self._offset+=have;if(async){self.push(out)}else{buffers.push(out);nread+=out.length}}if(availOutAfter===0||self._offset>=self._chunkSize){availOutBefore=self._chunkSize;self._offset=0;self._buffer=new Buffer(self._chunkSize)}if(availOutAfter===0){inOff+=availInBefore-availInAfter;availInBefore=availInAfter;if(!async)return true;var newReq=self._binding.write(flushFlag,chunk,inOff,availInBefore,self._buffer,self._offset,self._chunkSize);newReq.callback=callback;newReq.buffer=chunk;return}if(!async)return false;cb()}};util.inherits(Deflate,Zlib);util.inherits(Inflate,Zlib);util.inherits(Gzip,Zlib);util.inherits(Gunzip,Zlib);util.inherits(DeflateRaw,Zlib);util.inherits(InflateRaw,Zlib);util.inherits(Unzip,Zlib)}).call(this,require("_process"),require("buffer").Buffer)},{"./binding":7,_process:11,_stream_transform:17,assert:2,buffer:19,util:996}],9:[function(require,module,exports){arguments[4][6][0].apply(exports,arguments)},{dup:6}],10:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"}},{}],11:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],12:[function(require,module,exports){"use strict";var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){keys.push(key)}return keys};module.exports=Duplex;var processNextTick=require("process-nextick-args");var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);var keys=objectKeys(Writable.prototype);for(var v=0;v<keys.length;v++){var method=keys[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;processNextTick(onEndNT,this)}function onEndNT(self){self.end()}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}},{"./_stream_readable":13,"./_stream_writable":15,"core-util-is":318,inherits:454,"process-nextick-args":770}],13:[function(require,module,exports){(function(process){"use strict";module.exports=Readable;var processNextTick=require("process-nextick-args");var isArray=require("isarray");var Duplex;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){}finally{if(!Stream)Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;var bufferShim=require("buffer-shims");var util=require("core-util-is");util.inherits=require("inherits");var debugUtil=require("util");var debug=void 0;if(debugUtil&&debugUtil.debuglog){debug=debugUtil.debuglog("stream")}else{debug=function(){}}var BufferList=require("./internal/streams/BufferList");var StringDecoder;util.inherits(Readable,Stream);function prependListener(emitter,event,fn){if(typeof emitter.prependListener==="function"){return emitter.prependListener(event,fn)}else{if(!emitter._events||!emitter._events[event])emitter.on(event,fn);else if(isArray(emitter._events[event]))emitter._events[event].unshift(fn);else emitter._events[event]=[fn,emitter._events[event]]}}function ReadableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.buffer=new BufferList;this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.resumeScheduled=false;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){Duplex=Duplex||require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;if(options&&typeof options.read==="function")this._read=options.read;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(!state.objectMode&&typeof chunk==="string"){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=bufferShim.from(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};Readable.prototype.isPaused=function(){return this._readableState.flowing===false};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null){state.reading=false;onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var _e=new Error("stream.unshift() after end event");stream.emit("error",_e)}else{var skipAdd;if(state.decoder&&!addToFront&&!encoding){chunk=state.decoder.write(chunk);skipAdd=!state.objectMode&&chunk.length===0}if(!addToFront)state.reading=false;if(!skipAdd){if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}}maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function computeNewHighWaterMark(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;n|=n>>>1;n|=n>>>2;n|=n>>>4;n|=n>>>8;n|=n>>>16;n++}return n}function howMuchToRead(n,state){if(n<=0||state.length===0&&state.ended)return 0;if(state.objectMode)return 1;if(n!==n){if(state.flowing&&state.length)return state.buffer.head.data.length;else return state.length}if(n>state.highWaterMark)state.highWaterMark=computeNewHighWaterMark(n);if(n<=state.length)return n;if(!state.ended){state.needReadable=true;return 0}return state.length}Readable.prototype.read=function(n){debug("read",n);n=parseInt(n,10);var state=this._readableState;var nOrig=n;if(n!==0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}else if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false;if(!state.reading)n=howMuchToRead(nOrig,state)}var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}else{state.length-=n}if(state.length===0){if(!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended)endReadable(this)}if(ret!==null)this.emit("data",ret);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)processNextTick(emitReadable_,stream);else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;processNextTick(maybeReadMore_,stream,state)}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("_read() is not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)processNextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){debug("onunpipe");if(readable===src){cleanup()}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);var cleanedUp=false;function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);src.removeListener("data",ondata);cleanedUp=true;if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}var increasedAwaitDrain=false;src.on("data",ondata);function ondata(chunk){debug("ondata");increasedAwaitDrain=false;var ret=dest.write(chunk);if(false===ret&&!increasedAwaitDrain){if((state.pipesCount===1&&state.pipes===dest||state.pipesCount>1&&indexOf(state.pipes,dest)!==-1)&&!cleanedUp){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++;increasedAwaitDrain=true}src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EElistenerCount(dest,"error")===0)dest.emit("error",er)}prependListener(dest,"error",onerror);function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EElistenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var i=0;i<len;i++){dests[i].emit("unpipe",this)}return this}var index=indexOf(state.pipes,dest);if(index===-1)return this;state.pipes.splice(index,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"){if(this._readableState.flowing!==false)this.resume()}else if(ev==="readable"){var state=this._readableState;if(!state.endEmitted&&!state.readableListening){state.readableListening=state.needReadable=true;state.emittedReadable=false;if(!state.reading){processNextTick(nReadingNextTick,this)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug("readable nexttick read 0");self.read(0)}Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;processNextTick(resume_,stream,state)}}function resume_(stream,state){if(!state.reading){debug("resume read 0");stream.read(0)}state.resumeScheduled=false;state.awaitDrain=0;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);while(state.flowing&&stream.read()!==null){}}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==="function"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){if(state.length===0)return null;var ret;if(state.objectMode)ret=state.buffer.shift();else if(!n||n>=state.length){if(state.decoder)ret=state.buffer.join("");else if(state.buffer.length===1)ret=state.buffer.head.data;else ret=state.buffer.concat(state.length);state.buffer.clear()}else{ret=fromListPartial(n,state.buffer,state.decoder)}return ret}function fromListPartial(n,list,hasStrings){var ret;if(n<list.head.data.length){ret=list.head.data.slice(0,n);list.head.data=list.head.data.slice(n)}else if(n===list.head.data.length){ret=list.shift()}else{ret=hasStrings?copyFromBufferString(n,list):copyFromBuffer(n,list)}return ret}function copyFromBufferString(n,list){var p=list.head;var c=1;var ret=p.data;n-=ret.length;while(p=p.next){var str=p.data;var nb=n>str.length?str.length:n;if(nb===str.length)ret+=str;else ret+=str.slice(0,n);n-=nb;if(n===0){if(nb===str.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=str.slice(nb)}break}++c}list.length-=c;return ret}function copyFromBuffer(n,list){var ret=bufferShim.allocUnsafe(n);var p=list.head;var c=1;p.data.copy(ret);n-=p.data.length;while(p=p.next){var buf=p.data;var nb=n>buf.length?buf.length:n;buf.copy(ret,ret.length-n,0,nb);n-=nb;if(n===0){if(nb===buf.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=buf.slice(nb)}break}++c}list.length-=c;return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');if(!state.endEmitted){state.ended=true;processNextTick(endReadableNT,state,stream)}}function endReadableNT(state,stream){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{"./_stream_duplex":12,"./internal/streams/BufferList":16,_process:11,buffer:19,"buffer-shims":18,"core-util-is":318,events:389,inherits:454,isarray:10,"process-nextick-args":770,"string_decoder/":982,util:6}],14:[function(require,module,exports){"use strict";module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null;this.writeencoding=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;if(options){if(typeof options.transform==="function")this._transform=options.transform;if(typeof options.flush==="function")this._flush=options.flush}this.once("prefinish",function(){if(typeof this._flush==="function")this._flush(function(er,data){done(stream,er,data)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){
throw new Error("_transform() is not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er,data){if(er)return stream.emit("error",er);if(data!==null&&data!==undefined)stream.push(data);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error("Calling transform done when ws.length != 0");if(ts.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":12,"core-util-is":318,inherits:454}],15:[function(require,module,exports){(function(process){"use strict";module.exports=Writable;var processNextTick=require("process-nextick-args");var asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:processNextTick;var Duplex;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var internalUtil={deprecate:require("util-deprecate")};var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){}finally{if(!Stream)Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;var bufferShim=require("buffer-shims");util.inherits(Writable,Stream);function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}function WritableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this)}WritableState.prototype.getBuffer=function getBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}return out};(function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.")})}catch(_){}})();var realHasInstance;if(typeof Symbol==="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==="function"){realHasInstance=Function.prototype[Symbol.hasInstance];Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){if(realHasInstance.call(this,object))return true;return object&&object._writableState instanceof WritableState}})}else{realHasInstance=function(object){return object instanceof this}}function Writable(options){Duplex=Duplex||require("./_stream_duplex");if(!realHasInstance.call(Writable,this)&&!(this instanceof Duplex)){return new Writable(options)}this._writableState=new WritableState(options,this);this.writable=true;if(options){if(typeof options.write==="function")this._write=options.write;if(typeof options.writev==="function")this._writev=options.writev}Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er);processNextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=true;var er=false;if(chunk===null){er=new TypeError("May not write null values to stream")}else if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}if(er){stream.emit("error",er);processNextTick(cb,er);valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(Buffer.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=nop;if(state.ended)writeAfterEnd(this,cb);else if(validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==="string")encoding=encoding.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);this._writableState.defaultEncoding=encoding;return this};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=bufferShim.from(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest=new WriteReq(chunk,encoding,cb);if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}state.bufferedRequestCount+=1}else{doWrite(stream,state,false,len,chunk,encoding,cb)}return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync)processNextTick(cb,er);else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}if(sync){asyncWrite(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount;var buffer=new Array(l);var holder=state.corkedRequestsFree;holder.entry=entry;var count=0;while(entry){buffer[count]=entry;entry=entry.next;count+=1}doWrite(stream,state,true,state.length,buffer,"",holder.finish);state.pendingcb++;state.lastBufferedRequest=null;if(holder.next){state.corkedRequestsFree=holder.next;holder.next=null}else{state.corkedRequestsFree=new CorkedRequest(state)}}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);entry=entry.next;if(state.writing){break}}if(entry===null)state.lastBufferedRequest=null}state.bufferedRequestCount=0;state.bufferedRequest=entry;state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("_write() is not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}function prefinish(stream,state){if(!state.prefinished){state.prefinished=true;stream.emit("prefinish")}}function finishMaybe(stream,state){var need=needFinish(state);if(need){if(state.pendingcb===0){prefinish(stream,state);state.finished=true;stream.emit("finish")}else{prefinish(stream,state)}}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)processNextTick(cb);else stream.once("finish",cb)}state.ended=true;stream.writable=false}function CorkedRequest(state){var _this=this;this.next=null;this.entry=null;this.finish=function(err){var entry=_this.entry;_this.entry=null;while(entry){var cb=entry.callback;state.pendingcb--;cb(err);entry=entry.next}if(state.corkedRequestsFree){state.corkedRequestsFree.next=_this}else{state.corkedRequestsFree=_this}}}}).call(this,require("_process"))},{"./_stream_duplex":12,_process:11,buffer:19,"buffer-shims":18,"core-util-is":318,events:389,inherits:454,"process-nextick-args":770,"util-deprecate":993}],16:[function(require,module,exports){"use strict";var Buffer=require("buffer").Buffer;var bufferShim=require("buffer-shims");module.exports=BufferList;function BufferList(){this.head=null;this.tail=null;this.length=0}BufferList.prototype.push=function(v){var entry={data:v,next:null};if(this.length>0)this.tail.next=entry;else this.head=entry;this.tail=entry;++this.length};BufferList.prototype.unshift=function(v){var entry={data:v,next:this.head};if(this.length===0)this.tail=entry;this.head=entry;++this.length};BufferList.prototype.shift=function(){if(this.length===0)return;var ret=this.head.data;if(this.length===1)this.head=this.tail=null;else this.head=this.head.next;--this.length;return ret};BufferList.prototype.clear=function(){this.head=this.tail=null;this.length=0};BufferList.prototype.join=function(s){if(this.length===0)return"";var p=this.head;var ret=""+p.data;while(p=p.next){ret+=s+p.data}return ret};BufferList.prototype.concat=function(n){if(this.length===0)return bufferShim.alloc(0);if(this.length===1)return this.head.data;var ret=bufferShim.allocUnsafe(n>>>0);var p=this.head;var i=0;while(p){p.data.copy(ret,i);i+=p.data.length;p=p.next}return ret}},{buffer:19,"buffer-shims":18}],17:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":14}],18:[function(require,module,exports){(function(global){"use strict";var buffer=require("buffer");var Buffer=buffer.Buffer;var SlowBuffer=buffer.SlowBuffer;var MAX_LEN=buffer.kMaxLength||2147483647;exports.alloc=function alloc(size,fill,encoding){if(typeof Buffer.alloc==="function"){return Buffer.alloc(size,fill,encoding)}if(typeof encoding==="number"){throw new TypeError("encoding must not be number")}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>MAX_LEN){throw new RangeError("size is too large")}var enc=encoding;var _fill=fill;if(_fill===undefined){enc=undefined;_fill=0}var buf=new Buffer(size);if(typeof _fill==="string"){var fillBuf=new Buffer(_fill,enc);var flen=fillBuf.length;var i=-1;while(++i<size){buf[i]=fillBuf[i%flen]}}else{buf.fill(_fill)}return buf};exports.allocUnsafe=function allocUnsafe(size){if(typeof Buffer.allocUnsafe==="function"){return Buffer.allocUnsafe(size)}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>MAX_LEN){throw new RangeError("size is too large")}return new Buffer(size)};exports.from=function from(value,encodingOrOffset,length){if(typeof Buffer.from==="function"&&(!global.Uint8Array||Uint8Array.from!==Buffer.from)){return Buffer.from(value,encodingOrOffset,length)}if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof value==="string"){return new Buffer(value,encodingOrOffset)}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){var offset=encodingOrOffset;if(arguments.length===1){return new Buffer(value)}if(typeof offset==="undefined"){offset=0}var len=length;if(typeof len==="undefined"){len=value.byteLength-offset}if(offset>=value.byteLength){throw new RangeError("'offset' is out of bounds")}if(len>value.byteLength-offset){throw new RangeError("'length' is out of bounds")}return new Buffer(value.slice(offset,offset+len))}if(Buffer.isBuffer(value)){var out=new Buffer(value.length);value.copy(out,0,0,value.length);return out}if(value){if(Array.isArray(value)||typeof ArrayBuffer!=="undefined"&&value.buffer instanceof ArrayBuffer||"length"in value){return new Buffer(value)}if(value.type==="Buffer"&&Array.isArray(value.data)){return new Buffer(value.data)}}throw new TypeError("First argument must be a string, Buffer, "+"ArrayBuffer, Array, or array-like object.")};exports.allocUnsafeSlow=function allocUnsafeSlow(size){if(typeof Buffer.allocUnsafeSlow==="function"){return Buffer.allocUnsafeSlow(size)}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>=MAX_LEN){throw new RangeError("size is too large")}return new SlowBuffer(size)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{buffer:19}],19:[function(require,module,exports){(function(global){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("isarray");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global.TYPED_ARRAY_SUPPORT!==undefined?global.TYPED_ARRAY_SUPPORT:typedArraySupport();exports.kMaxLength=kMaxLength();function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42&&typeof arr.subarray==="function"&&arr.subarray(1,1).byteLength===0}catch(e){return false}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length){throw new RangeError("Invalid typed array length")}if(Buffer.TYPED_ARRAY_SUPPORT){that=new Uint8Array(length);that.__proto__=Buffer.prototype}else{if(that===null){that=new Buffer(length)}that.length=length}return that}function Buffer(arg,encodingOrOffset,length){if(!Buffer.TYPED_ARRAY_SUPPORT&&!(this instanceof Buffer)){return new Buffer(arg,encodingOrOffset,length)}if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}Buffer.poolSize=8192;Buffer._augment=function(arr){arr.__proto__=Buffer.prototype;return arr};function from(that,value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){return fromArrayBuffer(that,value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(that,value,encodingOrOffset)}return fromObject(that,value)}Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)};if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true})}}function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}else if(size<0){throw new RangeError('"size" argument must not be negative')}}function alloc(that,size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(that,size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill)}return createBuffer(that,size)}Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding)};function allocUnsafe(that,size){assertSize(size);that=createBuffer(that,size<0?0:checked(size)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<size;++i){that[i]=0}}return that}Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)};function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;that=createBuffer(that,length);var actual=that.write(string,encoding);if(actual!==length){that=that.slice(0,actual)}return that}function fromArrayLike(that,array){var length=array.length<0?0:checked(array.length)|0;that=createBuffer(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayBuffer(that,array,byteOffset,length){array.byteLength;if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}if(byteOffset===undefined&&length===undefined){array=new Uint8Array(array)}else if(length===undefined){array=new Uint8Array(array,byteOffset)}else{array=new Uint8Array(array,byteOffset,length)}if(Buffer.TYPED_ARRAY_SUPPORT){that=array;that.__proto__=Buffer.prototype}else{that=fromArrayLike(that,array)}return that}function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;that=createBuffer(that,len);if(that.length===0){return that}obj.copy(that,0,0,len);return that}if(obj){if(typeof ArrayBuffer!=="undefined"&&obj.buffer instanceof ArrayBuffer||"length"in obj){if(typeof obj.length!=="number"||isnan(obj.length)){return createBuffer(that,0)}return fromArrayLike(that,obj)}if(obj.type==="Buffer"&&isArray(obj.data)){return fromArrayLike(that,obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(isNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(Buffer.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;++i){newBuf[i]=this[i+start];
}}return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value&255;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString());var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isnan(val){return val!==val}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"base64-js":20,ieee754:452,isarray:21}],20:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function placeHoldersCount(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return b64[len-2]==="="?2:b64[len-1]==="="?1:0}function byteLength(b64){return b64.length*3/4-placeHoldersCount(b64)}function toByteArray(b64){var i,j,l,tmp,placeHolders,arr;var len=b64.length;placeHolders=placeHoldersCount(b64);arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=tmp>>16&255;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}},{}],21:[function(require,module,exports){arguments[4][10][0].apply(exports,arguments)},{dup:10}],22:[function(require,module,exports){"use strict";module.exports=["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","copy","xor","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]},{}],23:[function(require,module,exports){(function(Buffer){"use strict";var Readable=require("readable-stream").Readable;var util=require("util");module.exports=ContentStream;function ContentStream(obj,options){if(!(this instanceof ContentStream)){return new ContentStream(obj,options)}Readable.call(this,options);if(obj===null||obj===undefined){obj=String(obj)}this._obj=obj}util.inherits(ContentStream,Readable);ContentStream.prototype._read=function(n){var obj=this._obj;if(typeof obj==="string"){this.push(new Buffer(obj))}else if(Buffer.isBuffer(obj)){this.push(obj)}else{this.push(new Buffer(JSON.stringify(obj)))}this.push(null)}}).call(this,require("buffer").Buffer)},{buffer:19,"readable-stream":954,util:996}],24:[function(require,module,exports){require("../../modules/core.regexp.escape");module.exports=require("../../modules/_core").RegExp.escape},{"../../modules/_core":45,"../../modules/core.regexp.escape":141}],25:[function(require,module,exports){module.exports=function(it){if(typeof it!="function")throw TypeError(it+" is not a function!");return it}},{}],26:[function(require,module,exports){var cof=require("./_cof");module.exports=function(it,msg){if(typeof it!="number"&&cof(it)!="Number")throw TypeError(msg);return+it}},{"./_cof":40}],27:[function(require,module,exports){var UNSCOPABLES=require("./_wks")("unscopables"),ArrayProto=Array.prototype;if(ArrayProto[UNSCOPABLES]==undefined)require("./_hide")(ArrayProto,UNSCOPABLES,{});module.exports=function(key){ArrayProto[UNSCOPABLES][key]=true}},{"./_hide":62,"./_wks":139}],28:[function(require,module,exports){module.exports=function(it,Constructor,name,forbiddenField){if(!(it instanceof Constructor)||forbiddenField!==undefined&&forbiddenField in it){throw TypeError(name+": incorrect invocation!")}return it}},{}],29:[function(require,module,exports){var isObject=require("./_is-object");module.exports=function(it){if(!isObject(it))throw TypeError(it+" is not an object!");return it}},{"./_is-object":71}],30:[function(require,module,exports){"use strict";var toObject=require("./_to-object"),toIndex=require("./_to-index"),toLength=require("./_to-length");module.exports=[].copyWithin||function copyWithin(target,start){var O=toObject(this),len=toLength(O.length),to=toIndex(target,len),from=toIndex(start,len),end=arguments.length>2?arguments[2]:undefined,count=Math.min((end===undefined?len:toIndex(end,len))-from,len-to),inc=1;if(from<to&&to<from+count){inc=-1;from+=count-1;to+=count-1}while(count-- >0){if(from in O)O[to]=O[from];else delete O[to];to+=inc;from+=inc}return O}},{"./_to-index":127,"./_to-length":130,"./_to-object":131}],31:[function(require,module,exports){"use strict";var toObject=require("./_to-object"),toIndex=require("./_to-index"),toLength=require("./_to-length");module.exports=function fill(value){var O=toObject(this),length=toLength(O.length),aLen=arguments.length,index=toIndex(aLen>1?arguments[1]:undefined,length),end=aLen>2?arguments[2]:undefined,endPos=end===undefined?length:toIndex(end,length);while(endPos>index)O[index++]=value;return O}},{"./_to-index":127,"./_to-length":130,"./_to-object":131}],32:[function(require,module,exports){var forOf=require("./_for-of");module.exports=function(iter,ITERATOR){var result=[];forOf(iter,false,result.push,result,ITERATOR);return result}},{"./_for-of":59}],33:[function(require,module,exports){var toIObject=require("./_to-iobject"),toLength=require("./_to-length"),toIndex=require("./_to-index");module.exports=function(IS_INCLUDES){return function($this,el,fromIndex){var O=toIObject($this),length=toLength(O.length),index=toIndex(fromIndex,length),value;if(IS_INCLUDES&&el!=el)while(length>index){value=O[index++];if(value!=value)return true}else for(;length>index;index++)if(IS_INCLUDES||index in O){if(O[index]===el)return IS_INCLUDES||index||0}return!IS_INCLUDES&&-1}}},{"./_to-index":127,"./_to-iobject":129,"./_to-length":130}],34:[function(require,module,exports){var ctx=require("./_ctx"),IObject=require("./_iobject"),toObject=require("./_to-object"),toLength=require("./_to-length"),asc=require("./_array-species-create");module.exports=function(TYPE,$create){var IS_MAP=TYPE==1,IS_FILTER=TYPE==2,IS_SOME=TYPE==3,IS_EVERY=TYPE==4,IS_FIND_INDEX=TYPE==6,NO_HOLES=TYPE==5||IS_FIND_INDEX,create=$create||asc;return function($this,callbackfn,that){var O=toObject($this),self=IObject(O),f=ctx(callbackfn,that,3),length=toLength(self.length),index=0,result=IS_MAP?create($this,length):IS_FILTER?create($this,0):undefined,val,res;for(;length>index;index++)if(NO_HOLES||index in self){val=self[index];res=f(val,index,O);if(TYPE){if(IS_MAP)result[index]=res;else if(res)switch(TYPE){case 3:return true;case 5:return val;case 6:return index;case 2:result.push(val)}else if(IS_EVERY)return false}}return IS_FIND_INDEX?-1:IS_SOME||IS_EVERY?IS_EVERY:result}}},{"./_array-species-create":37,"./_ctx":47,"./_iobject":67,"./_to-length":130,"./_to-object":131}],35:[function(require,module,exports){var aFunction=require("./_a-function"),toObject=require("./_to-object"),IObject=require("./_iobject"),toLength=require("./_to-length");module.exports=function(that,callbackfn,aLen,memo,isRight){aFunction(callbackfn);var O=toObject(that),self=IObject(O),length=toLength(O.length),index=isRight?length-1:0,i=isRight?-1:1;if(aLen<2)for(;;){if(index in self){memo=self[index];index+=i;break}index+=i;if(isRight?index<0:length<=index){throw TypeError("Reduce of empty array with no initial value")}}for(;isRight?index>=0:length>index;index+=i)if(index in self){memo=callbackfn(memo,self[index],index,O)}return memo}},{"./_a-function":25,"./_iobject":67,"./_to-length":130,"./_to-object":131}],36:[function(require,module,exports){var isObject=require("./_is-object"),isArray=require("./_is-array"),SPECIES=require("./_wks")("species");module.exports=function(original){var C;if(isArray(original)){C=original.constructor;if(typeof C=="function"&&(C===Array||isArray(C.prototype)))C=undefined;if(isObject(C)){C=C[SPECIES];if(C===null)C=undefined}}return C===undefined?Array:C}},{"./_is-array":69,"./_is-object":71,"./_wks":139}],37:[function(require,module,exports){var speciesConstructor=require("./_array-species-constructor");module.exports=function(original,length){return new(speciesConstructor(original))(length)}},{"./_array-species-constructor":36}],38:[function(require,module,exports){"use strict";var aFunction=require("./_a-function"),isObject=require("./_is-object"),invoke=require("./_invoke"),arraySlice=[].slice,factories={};var construct=function(F,len,args){if(!(len in factories)){for(var n=[],i=0;i<len;i++)n[i]="a["+i+"]";factories[len]=Function("F,a","return new F("+n.join(",")+")")}return factories[len](F,args)};module.exports=Function.bind||function bind(that){var fn=aFunction(this),partArgs=arraySlice.call(arguments,1);var bound=function(){var args=partArgs.concat(arraySlice.call(arguments));return this instanceof bound?construct(fn,args.length,args):invoke(fn,args,that)};if(isObject(fn.prototype))bound.prototype=fn.prototype;return bound}},{"./_a-function":25,"./_invoke":66,"./_is-object":71}],39:[function(require,module,exports){var cof=require("./_cof"),TAG=require("./_wks")("toStringTag"),ARG=cof(function(){return arguments}())=="Arguments";var tryGet=function(it,key){try{return it[key]}catch(e){}};module.exports=function(it){var O,T,B;return it===undefined?"Undefined":it===null?"Null":typeof(T=tryGet(O=Object(it),TAG))=="string"?T:ARG?cof(O):(B=cof(O))=="Object"&&typeof O.callee=="function"?"Arguments":B}},{"./_cof":40,"./_wks":139}],40:[function(require,module,exports){var toString={}.toString;module.exports=function(it){return toString.call(it).slice(8,-1)}},{}],41:[function(require,module,exports){"use strict";var dP=require("./_object-dp").f,create=require("./_object-create"),redefineAll=require("./_redefine-all"),ctx=require("./_ctx"),anInstance=require("./_an-instance"),defined=require("./_defined"),forOf=require("./_for-of"),$iterDefine=require("./_iter-define"),step=require("./_iter-step"),setSpecies=require("./_set-species"),DESCRIPTORS=require("./_descriptors"),fastKey=require("./_meta").fastKey,SIZE=DESCRIPTORS?"_s":"size";var getEntry=function(that,key){var index=fastKey(key),entry;if(index!=="F")return that._i[index];for(entry=that._f;entry;entry=entry.n){if(entry.k==key)return entry}};module.exports={getConstructor:function(wrapper,NAME,IS_MAP,ADDER){var C=wrapper(function(that,iterable){anInstance(that,C,NAME,"_i");that._i=create(null);that._f=undefined;that._l=undefined;that[SIZE]=0;if(iterable!=undefined)forOf(iterable,IS_MAP,that[ADDER],that)});redefineAll(C.prototype,{clear:function clear(){for(var that=this,data=that._i,entry=that._f;entry;entry=entry.n){entry.r=true;if(entry.p)entry.p=entry.p.n=undefined;delete data[entry.i]}that._f=that._l=undefined;that[SIZE]=0},delete:function(key){var that=this,entry=getEntry(that,key);if(entry){var next=entry.n,prev=entry.p;delete that._i[entry.i];entry.r=true;if(prev)prev.n=next;if(next)next.p=prev;if(that._f==entry)that._f=next;if(that._l==entry)that._l=prev;that[SIZE]--}return!!entry},forEach:function forEach(callbackfn){anInstance(this,C,"forEach");var f=ctx(callbackfn,arguments.length>1?arguments[1]:undefined,3),entry;while(entry=entry?entry.n:this._f){f(entry.v,entry.k,this);while(entry&&entry.r)entry=entry.p}},has:function has(key){return!!getEntry(this,key)}});if(DESCRIPTORS)dP(C.prototype,"size",{get:function(){return defined(this[SIZE])}});return C},def:function(that,key,value){var entry=getEntry(that,key),prev,index;if(entry){entry.v=value}else{that._l=entry={i:index=fastKey(key,true),k:key,v:value,p:prev=that._l,n:undefined,r:false};if(!that._f)that._f=entry;if(prev)prev.n=entry;that[SIZE]++;if(index!=="F")that._i[index]=entry}return that},getEntry:getEntry,setStrong:function(C,NAME,IS_MAP){$iterDefine(C,NAME,function(iterated,kind){this._t=iterated;this._k=kind;this._l=undefined},function(){var that=this,kind=that._k,entry=that._l;while(entry&&entry.r)entry=entry.p;if(!that._t||!(that._l=entry=entry?entry.n:that._t._f)){that._t=undefined;return step(1)}if(kind=="keys")return step(0,entry.k);if(kind=="values")return step(0,entry.v);return step(0,[entry.k,entry.v])},IS_MAP?"entries":"values",!IS_MAP,true);setSpecies(NAME)}}},{"./_an-instance":28,"./_ctx":47,"./_defined":49,"./_descriptors":50,"./_for-of":59,"./_iter-define":75,"./_iter-step":77,"./_meta":84,"./_object-create":88,"./_object-dp":89,"./_redefine-all":108,"./_set-species":113}],42:[function(require,module,exports){var classof=require("./_classof"),from=require("./_array-from-iterable");module.exports=function(NAME){return function toJSON(){if(classof(this)!=NAME)throw TypeError(NAME+"#toJSON isn't generic");return from(this)}}},{"./_array-from-iterable":32,"./_classof":39}],43:[function(require,module,exports){"use strict";var redefineAll=require("./_redefine-all"),getWeak=require("./_meta").getWeak,anObject=require("./_an-object"),isObject=require("./_is-object"),anInstance=require("./_an-instance"),forOf=require("./_for-of"),createArrayMethod=require("./_array-methods"),$has=require("./_has"),arrayFind=createArrayMethod(5),arrayFindIndex=createArrayMethod(6),id=0;var uncaughtFrozenStore=function(that){return that._l||(that._l=new UncaughtFrozenStore)};var UncaughtFrozenStore=function(){this.a=[]};var findUncaughtFrozen=function(store,key){return arrayFind(store.a,function(it){return it[0]===key})};UncaughtFrozenStore.prototype={get:function(key){var entry=findUncaughtFrozen(this,key);if(entry)return entry[1]},has:function(key){return!!findUncaughtFrozen(this,key)},set:function(key,value){var entry=findUncaughtFrozen(this,key);if(entry)entry[1]=value;else this.a.push([key,value])},delete:function(key){var index=arrayFindIndex(this.a,function(it){return it[0]===key});if(~index)this.a.splice(index,1);return!!~index}};module.exports={getConstructor:function(wrapper,NAME,IS_MAP,ADDER){var C=wrapper(function(that,iterable){anInstance(that,C,NAME,"_i");that._i=id++;that._l=undefined;if(iterable!=undefined)forOf(iterable,IS_MAP,that[ADDER],that)});redefineAll(C.prototype,{delete:function(key){if(!isObject(key))return false;var data=getWeak(key);if(data===true)return uncaughtFrozenStore(this)["delete"](key);return data&&$has(data,this._i)&&delete data[this._i]},has:function has(key){if(!isObject(key))return false;var data=getWeak(key);if(data===true)return uncaughtFrozenStore(this).has(key);return data&&$has(data,this._i)}});return C},def:function(that,key,value){var data=getWeak(anObject(key),true);if(data===true)uncaughtFrozenStore(that).set(key,value);else data[that._i]=value;return that},ufstore:uncaughtFrozenStore}},{"./_an-instance":28,"./_an-object":29,"./_array-methods":34,"./_for-of":59,"./_has":61,"./_is-object":71,"./_meta":84,"./_redefine-all":108}],44:[function(require,module,exports){"use strict";var global=require("./_global"),$export=require("./_export"),redefine=require("./_redefine"),redefineAll=require("./_redefine-all"),meta=require("./_meta"),forOf=require("./_for-of"),anInstance=require("./_an-instance"),isObject=require("./_is-object"),fails=require("./_fails"),$iterDetect=require("./_iter-detect"),setToStringTag=require("./_set-to-string-tag"),inheritIfRequired=require("./_inherit-if-required");module.exports=function(NAME,wrapper,methods,common,IS_MAP,IS_WEAK){var Base=global[NAME],C=Base,ADDER=IS_MAP?"set":"add",proto=C&&C.prototype,O={};var fixMethod=function(KEY){var fn=proto[KEY];redefine(proto,KEY,KEY=="delete"?function(a){return IS_WEAK&&!isObject(a)?false:fn.call(this,a===0?0:a)}:KEY=="has"?function has(a){return IS_WEAK&&!isObject(a)?false:fn.call(this,a===0?0:a)}:KEY=="get"?function get(a){return IS_WEAK&&!isObject(a)?undefined:fn.call(this,a===0?0:a)}:KEY=="add"?function add(a){fn.call(this,a===0?0:a);return this}:function set(a,b){fn.call(this,a===0?0:a,b);return this})};if(typeof C!="function"||!(IS_WEAK||proto.forEach&&!fails(function(){(new C).entries().next()}))){C=common.getConstructor(wrapper,NAME,IS_MAP,ADDER);redefineAll(C.prototype,methods);meta.NEED=true}else{var instance=new C,HASNT_CHAINING=instance[ADDER](IS_WEAK?{}:-0,1)!=instance,THROWS_ON_PRIMITIVES=fails(function(){instance.has(1)}),ACCEPT_ITERABLES=$iterDetect(function(iter){new C(iter)}),BUGGY_ZERO=!IS_WEAK&&fails(function(){var $instance=new C,index=5;while(index--)$instance[ADDER](index,index);return!$instance.has(-0)});if(!ACCEPT_ITERABLES){C=wrapper(function(target,iterable){anInstance(target,C,NAME);var that=inheritIfRequired(new Base,target,C);if(iterable!=undefined)forOf(iterable,IS_MAP,that[ADDER],that);return that});C.prototype=proto;proto.constructor=C;
}if(THROWS_ON_PRIMITIVES||BUGGY_ZERO){fixMethod("delete");fixMethod("has");IS_MAP&&fixMethod("get")}if(BUGGY_ZERO||HASNT_CHAINING)fixMethod(ADDER);if(IS_WEAK&&proto.clear)delete proto.clear}setToStringTag(C,NAME);O[NAME]=C;$export($export.G+$export.W+$export.F*(C!=Base),O);if(!IS_WEAK)common.setStrong(C,NAME,IS_MAP);return C}},{"./_an-instance":28,"./_export":54,"./_fails":56,"./_for-of":59,"./_global":60,"./_inherit-if-required":65,"./_is-object":71,"./_iter-detect":76,"./_meta":84,"./_redefine":109,"./_redefine-all":108,"./_set-to-string-tag":114}],45:[function(require,module,exports){var core=module.exports={version:"2.4.0"};if(typeof __e=="number")__e=core},{}],46:[function(require,module,exports){"use strict";var $defineProperty=require("./_object-dp"),createDesc=require("./_property-desc");module.exports=function(object,index,value){if(index in object)$defineProperty.f(object,index,createDesc(0,value));else object[index]=value}},{"./_object-dp":89,"./_property-desc":107}],47:[function(require,module,exports){var aFunction=require("./_a-function");module.exports=function(fn,that,length){aFunction(fn);if(that===undefined)return fn;switch(length){case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}}},{"./_a-function":25}],48:[function(require,module,exports){"use strict";var anObject=require("./_an-object"),toPrimitive=require("./_to-primitive"),NUMBER="number";module.exports=function(hint){if(hint!=="string"&&hint!==NUMBER&&hint!=="default")throw TypeError("Incorrect hint");return toPrimitive(anObject(this),hint!=NUMBER)}},{"./_an-object":29,"./_to-primitive":132}],49:[function(require,module,exports){module.exports=function(it){if(it==undefined)throw TypeError("Can't call method on  "+it);return it}},{}],50:[function(require,module,exports){module.exports=!require("./_fails")(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},{"./_fails":56}],51:[function(require,module,exports){var isObject=require("./_is-object"),document=require("./_global").document,is=isObject(document)&&isObject(document.createElement);module.exports=function(it){return is?document.createElement(it):{}}},{"./_global":60,"./_is-object":71}],52:[function(require,module,exports){module.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],53:[function(require,module,exports){var getKeys=require("./_object-keys"),gOPS=require("./_object-gops"),pIE=require("./_object-pie");module.exports=function(it){var result=getKeys(it),getSymbols=gOPS.f;if(getSymbols){var symbols=getSymbols(it),isEnum=pIE.f,i=0,key;while(symbols.length>i)if(isEnum.call(it,key=symbols[i++]))result.push(key)}return result}},{"./_object-gops":95,"./_object-keys":98,"./_object-pie":99}],54:[function(require,module,exports){var global=require("./_global"),core=require("./_core"),hide=require("./_hide"),redefine=require("./_redefine"),ctx=require("./_ctx"),PROTOTYPE="prototype";var $export=function(type,name,source){var IS_FORCED=type&$export.F,IS_GLOBAL=type&$export.G,IS_STATIC=type&$export.S,IS_PROTO=type&$export.P,IS_BIND=type&$export.B,target=IS_GLOBAL?global:IS_STATIC?global[name]||(global[name]={}):(global[name]||{})[PROTOTYPE],exports=IS_GLOBAL?core:core[name]||(core[name]={}),expProto=exports[PROTOTYPE]||(exports[PROTOTYPE]={}),key,own,out,exp;if(IS_GLOBAL)source=name;for(key in source){own=!IS_FORCED&&target&&target[key]!==undefined;out=(own?target:source)[key];exp=IS_BIND&&own?ctx(out,global):IS_PROTO&&typeof out=="function"?ctx(Function.call,out):out;if(target)redefine(target,key,out,type&$export.U);if(exports[key]!=out)hide(exports,key,exp);if(IS_PROTO&&expProto[key]!=out)expProto[key]=out}};global.core=core;$export.F=1;$export.G=2;$export.S=4;$export.P=8;$export.B=16;$export.W=32;$export.U=64;$export.R=128;module.exports=$export},{"./_core":45,"./_ctx":47,"./_global":60,"./_hide":62,"./_redefine":109}],55:[function(require,module,exports){var MATCH=require("./_wks")("match");module.exports=function(KEY){var re=/./;try{"/./"[KEY](re)}catch(e){try{re[MATCH]=false;return!"/./"[KEY](re)}catch(f){}}return true}},{"./_wks":139}],56:[function(require,module,exports){module.exports=function(exec){try{return!!exec()}catch(e){return true}}},{}],57:[function(require,module,exports){"use strict";var hide=require("./_hide"),redefine=require("./_redefine"),fails=require("./_fails"),defined=require("./_defined"),wks=require("./_wks");module.exports=function(KEY,length,exec){var SYMBOL=wks(KEY),fns=exec(defined,SYMBOL,""[KEY]),strfn=fns[0],rxfn=fns[1];if(fails(function(){var O={};O[SYMBOL]=function(){return 7};return""[KEY](O)!=7})){redefine(String.prototype,KEY,strfn);hide(RegExp.prototype,SYMBOL,length==2?function(string,arg){return rxfn.call(string,this,arg)}:function(string){return rxfn.call(string,this)})}}},{"./_defined":49,"./_fails":56,"./_hide":62,"./_redefine":109,"./_wks":139}],58:[function(require,module,exports){"use strict";var anObject=require("./_an-object");module.exports=function(){var that=anObject(this),result="";if(that.global)result+="g";if(that.ignoreCase)result+="i";if(that.multiline)result+="m";if(that.unicode)result+="u";if(that.sticky)result+="y";return result}},{"./_an-object":29}],59:[function(require,module,exports){var ctx=require("./_ctx"),call=require("./_iter-call"),isArrayIter=require("./_is-array-iter"),anObject=require("./_an-object"),toLength=require("./_to-length"),getIterFn=require("./core.get-iterator-method"),BREAK={},RETURN={};var exports=module.exports=function(iterable,entries,fn,that,ITERATOR){var iterFn=ITERATOR?function(){return iterable}:getIterFn(iterable),f=ctx(fn,that,entries?2:1),index=0,length,step,iterator,result;if(typeof iterFn!="function")throw TypeError(iterable+" is not iterable!");if(isArrayIter(iterFn))for(length=toLength(iterable.length);length>index;index++){result=entries?f(anObject(step=iterable[index])[0],step[1]):f(iterable[index]);if(result===BREAK||result===RETURN)return result}else for(iterator=iterFn.call(iterable);!(step=iterator.next()).done;){result=call(iterator,f,step.value,entries);if(result===BREAK||result===RETURN)return result}};exports.BREAK=BREAK;exports.RETURN=RETURN},{"./_an-object":29,"./_ctx":47,"./_is-array-iter":68,"./_iter-call":73,"./_to-length":130,"./core.get-iterator-method":140}],60:[function(require,module,exports){var global=module.exports=typeof window!="undefined"&&window.Math==Math?window:typeof self!="undefined"&&self.Math==Math?self:Function("return this")();if(typeof __g=="number")__g=global},{}],61:[function(require,module,exports){var hasOwnProperty={}.hasOwnProperty;module.exports=function(it,key){return hasOwnProperty.call(it,key)}},{}],62:[function(require,module,exports){var dP=require("./_object-dp"),createDesc=require("./_property-desc");module.exports=require("./_descriptors")?function(object,key,value){return dP.f(object,key,createDesc(1,value))}:function(object,key,value){object[key]=value;return object}},{"./_descriptors":50,"./_object-dp":89,"./_property-desc":107}],63:[function(require,module,exports){module.exports=require("./_global").document&&document.documentElement},{"./_global":60}],64:[function(require,module,exports){module.exports=!require("./_descriptors")&&!require("./_fails")(function(){return Object.defineProperty(require("./_dom-create")("div"),"a",{get:function(){return 7}}).a!=7})},{"./_descriptors":50,"./_dom-create":51,"./_fails":56}],65:[function(require,module,exports){var isObject=require("./_is-object"),setPrototypeOf=require("./_set-proto").set;module.exports=function(that,target,C){var P,S=target.constructor;if(S!==C&&typeof S=="function"&&(P=S.prototype)!==C.prototype&&isObject(P)&&setPrototypeOf){setPrototypeOf(that,P)}return that}},{"./_is-object":71,"./_set-proto":112}],66:[function(require,module,exports){module.exports=function(fn,args,that){var un=that===undefined;switch(args.length){case 0:return un?fn():fn.call(that);case 1:return un?fn(args[0]):fn.call(that,args[0]);case 2:return un?fn(args[0],args[1]):fn.call(that,args[0],args[1]);case 3:return un?fn(args[0],args[1],args[2]):fn.call(that,args[0],args[1],args[2]);case 4:return un?fn(args[0],args[1],args[2],args[3]):fn.call(that,args[0],args[1],args[2],args[3])}return fn.apply(that,args)}},{}],67:[function(require,module,exports){var cof=require("./_cof");module.exports=Object("z").propertyIsEnumerable(0)?Object:function(it){return cof(it)=="String"?it.split(""):Object(it)}},{"./_cof":40}],68:[function(require,module,exports){var Iterators=require("./_iterators"),ITERATOR=require("./_wks")("iterator"),ArrayProto=Array.prototype;module.exports=function(it){return it!==undefined&&(Iterators.Array===it||ArrayProto[ITERATOR]===it)}},{"./_iterators":78,"./_wks":139}],69:[function(require,module,exports){var cof=require("./_cof");module.exports=Array.isArray||function isArray(arg){return cof(arg)=="Array"}},{"./_cof":40}],70:[function(require,module,exports){var isObject=require("./_is-object"),floor=Math.floor;module.exports=function isInteger(it){return!isObject(it)&&isFinite(it)&&floor(it)===it}},{"./_is-object":71}],71:[function(require,module,exports){module.exports=function(it){return typeof it==="object"?it!==null:typeof it==="function"}},{}],72:[function(require,module,exports){var isObject=require("./_is-object"),cof=require("./_cof"),MATCH=require("./_wks")("match");module.exports=function(it){var isRegExp;return isObject(it)&&((isRegExp=it[MATCH])!==undefined?!!isRegExp:cof(it)=="RegExp")}},{"./_cof":40,"./_is-object":71,"./_wks":139}],73:[function(require,module,exports){var anObject=require("./_an-object");module.exports=function(iterator,fn,value,entries){try{return entries?fn(anObject(value)[0],value[1]):fn(value)}catch(e){var ret=iterator["return"];if(ret!==undefined)anObject(ret.call(iterator));throw e}}},{"./_an-object":29}],74:[function(require,module,exports){"use strict";var create=require("./_object-create"),descriptor=require("./_property-desc"),setToStringTag=require("./_set-to-string-tag"),IteratorPrototype={};require("./_hide")(IteratorPrototype,require("./_wks")("iterator"),function(){return this});module.exports=function(Constructor,NAME,next){Constructor.prototype=create(IteratorPrototype,{next:descriptor(1,next)});setToStringTag(Constructor,NAME+" Iterator")}},{"./_hide":62,"./_object-create":88,"./_property-desc":107,"./_set-to-string-tag":114,"./_wks":139}],75:[function(require,module,exports){"use strict";var LIBRARY=require("./_library"),$export=require("./_export"),redefine=require("./_redefine"),hide=require("./_hide"),has=require("./_has"),Iterators=require("./_iterators"),$iterCreate=require("./_iter-create"),setToStringTag=require("./_set-to-string-tag"),getPrototypeOf=require("./_object-gpo"),ITERATOR=require("./_wks")("iterator"),BUGGY=!([].keys&&"next"in[].keys()),FF_ITERATOR="@@iterator",KEYS="keys",VALUES="values";var returnThis=function(){return this};module.exports=function(Base,NAME,Constructor,next,DEFAULT,IS_SET,FORCED){$iterCreate(Constructor,NAME,next);var getMethod=function(kind){if(!BUGGY&&kind in proto)return proto[kind];switch(kind){case KEYS:return function keys(){return new Constructor(this,kind)};case VALUES:return function values(){return new Constructor(this,kind)}}return function entries(){return new Constructor(this,kind)}};var TAG=NAME+" Iterator",DEF_VALUES=DEFAULT==VALUES,VALUES_BUG=false,proto=Base.prototype,$native=proto[ITERATOR]||proto[FF_ITERATOR]||DEFAULT&&proto[DEFAULT],$default=$native||getMethod(DEFAULT),$entries=DEFAULT?!DEF_VALUES?$default:getMethod("entries"):undefined,$anyNative=NAME=="Array"?proto.entries||$native:$native,methods,key,IteratorPrototype;if($anyNative){IteratorPrototype=getPrototypeOf($anyNative.call(new Base));if(IteratorPrototype!==Object.prototype){setToStringTag(IteratorPrototype,TAG,true);if(!LIBRARY&&!has(IteratorPrototype,ITERATOR))hide(IteratorPrototype,ITERATOR,returnThis)}}if(DEF_VALUES&&$native&&$native.name!==VALUES){VALUES_BUG=true;$default=function values(){return $native.call(this)}}if((!LIBRARY||FORCED)&&(BUGGY||VALUES_BUG||!proto[ITERATOR])){hide(proto,ITERATOR,$default)}Iterators[NAME]=$default;Iterators[TAG]=returnThis;if(DEFAULT){methods={values:DEF_VALUES?$default:getMethod(VALUES),keys:IS_SET?$default:getMethod(KEYS),entries:$entries};if(FORCED)for(key in methods){if(!(key in proto))redefine(proto,key,methods[key])}else $export($export.P+$export.F*(BUGGY||VALUES_BUG),NAME,methods)}return methods}},{"./_export":54,"./_has":61,"./_hide":62,"./_iter-create":74,"./_iterators":78,"./_library":80,"./_object-gpo":96,"./_redefine":109,"./_set-to-string-tag":114,"./_wks":139}],76:[function(require,module,exports){var ITERATOR=require("./_wks")("iterator"),SAFE_CLOSING=false;try{var riter=[7][ITERATOR]();riter["return"]=function(){SAFE_CLOSING=true};Array.from(riter,function(){throw 2})}catch(e){}module.exports=function(exec,skipClosing){if(!skipClosing&&!SAFE_CLOSING)return false;var safe=false;try{var arr=[7],iter=arr[ITERATOR]();iter.next=function(){return{done:safe=true}};arr[ITERATOR]=function(){return iter};exec(arr)}catch(e){}return safe}},{"./_wks":139}],77:[function(require,module,exports){module.exports=function(done,value){return{value:value,done:!!done}}},{}],78:[function(require,module,exports){module.exports={}},{}],79:[function(require,module,exports){var getKeys=require("./_object-keys"),toIObject=require("./_to-iobject");module.exports=function(object,el){var O=toIObject(object),keys=getKeys(O),length=keys.length,index=0,key;while(length>index)if(O[key=keys[index++]]===el)return key}},{"./_object-keys":98,"./_to-iobject":129}],80:[function(require,module,exports){module.exports=false},{}],81:[function(require,module,exports){var $expm1=Math.expm1;module.exports=!$expm1||$expm1(10)>22025.465794806718||$expm1(10)<22025.465794806718||$expm1(-2e-17)!=-2e-17?function expm1(x){return(x=+x)==0?x:x>-1e-6&&x<1e-6?x+x*x/2:Math.exp(x)-1}:$expm1},{}],82:[function(require,module,exports){module.exports=Math.log1p||function log1p(x){return(x=+x)>-1e-8&&x<1e-8?x-x*x/2:Math.log(1+x)}},{}],83:[function(require,module,exports){module.exports=Math.sign||function sign(x){return(x=+x)==0||x!=x?x:x<0?-1:1}},{}],84:[function(require,module,exports){var META=require("./_uid")("meta"),isObject=require("./_is-object"),has=require("./_has"),setDesc=require("./_object-dp").f,id=0;var isExtensible=Object.isExtensible||function(){return true};var FREEZE=!require("./_fails")(function(){return isExtensible(Object.preventExtensions({}))});var setMeta=function(it){setDesc(it,META,{value:{i:"O"+ ++id,w:{}}})};var fastKey=function(it,create){if(!isObject(it))return typeof it=="symbol"?it:(typeof it=="string"?"S":"P")+it;if(!has(it,META)){if(!isExtensible(it))return"F";if(!create)return"E";setMeta(it)}return it[META].i};var getWeak=function(it,create){if(!has(it,META)){if(!isExtensible(it))return true;if(!create)return false;setMeta(it)}return it[META].w};var onFreeze=function(it){if(FREEZE&&meta.NEED&&isExtensible(it)&&!has(it,META))setMeta(it);return it};var meta=module.exports={KEY:META,NEED:false,fastKey:fastKey,getWeak:getWeak,onFreeze:onFreeze}},{"./_fails":56,"./_has":61,"./_is-object":71,"./_object-dp":89,"./_uid":136}],85:[function(require,module,exports){var Map=require("./es6.map"),$export=require("./_export"),shared=require("./_shared")("metadata"),store=shared.store||(shared.store=new(require("./es6.weak-map")));var getOrCreateMetadataMap=function(target,targetKey,create){var targetMetadata=store.get(target);if(!targetMetadata){if(!create)return undefined;store.set(target,targetMetadata=new Map)}var keyMetadata=targetMetadata.get(targetKey);if(!keyMetadata){if(!create)return undefined;targetMetadata.set(targetKey,keyMetadata=new Map)}return keyMetadata};var ordinaryHasOwnMetadata=function(MetadataKey,O,P){var metadataMap=getOrCreateMetadataMap(O,P,false);return metadataMap===undefined?false:metadataMap.has(MetadataKey)};var ordinaryGetOwnMetadata=function(MetadataKey,O,P){var metadataMap=getOrCreateMetadataMap(O,P,false);return metadataMap===undefined?undefined:metadataMap.get(MetadataKey)};var ordinaryDefineOwnMetadata=function(MetadataKey,MetadataValue,O,P){getOrCreateMetadataMap(O,P,true).set(MetadataKey,MetadataValue)};var ordinaryOwnMetadataKeys=function(target,targetKey){var metadataMap=getOrCreateMetadataMap(target,targetKey,false),keys=[];if(metadataMap)metadataMap.forEach(function(_,key){keys.push(key)});return keys};var toMetaKey=function(it){return it===undefined||typeof it=="symbol"?it:String(it)};var exp=function(O){$export($export.S,"Reflect",O)};module.exports={store:store,map:getOrCreateMetadataMap,has:ordinaryHasOwnMetadata,get:ordinaryGetOwnMetadata,set:ordinaryDefineOwnMetadata,keys:ordinaryOwnMetadataKeys,key:toMetaKey,exp:exp}},{"./_export":54,"./_shared":116,"./es6.map":171,"./es6.weak-map":277}],86:[function(require,module,exports){var global=require("./_global"),macrotask=require("./_task").set,Observer=global.MutationObserver||global.WebKitMutationObserver,process=global.process,Promise=global.Promise,isNode=require("./_cof")(process)=="process";module.exports=function(){var head,last,notify;var flush=function(){var parent,fn;if(isNode&&(parent=process.domain))parent.exit();while(head){fn=head.fn;head=head.next;try{fn()}catch(e){if(head)notify();else last=undefined;throw e}}last=undefined;if(parent)parent.enter()};if(isNode){notify=function(){process.nextTick(flush)}}else if(Observer){var toggle=true,node=document.createTextNode("");new Observer(flush).observe(node,{characterData:true});notify=function(){node.data=toggle=!toggle}}else if(Promise&&Promise.resolve){var promise=Promise.resolve();notify=function(){promise.then(flush)}}else{notify=function(){macrotask.call(global,flush)}}return function(fn){var task={fn:fn,next:undefined};if(last)last.next=task;if(!head){head=task;notify()}last=task}}},{"./_cof":40,"./_global":60,"./_task":126}],87:[function(require,module,exports){"use strict";var getKeys=require("./_object-keys"),gOPS=require("./_object-gops"),pIE=require("./_object-pie"),toObject=require("./_to-object"),IObject=require("./_iobject"),$assign=Object.assign;module.exports=!$assign||require("./_fails")(function(){var A={},B={},S=Symbol(),K="abcdefghijklmnopqrst";A[S]=7;K.split("").forEach(function(k){B[k]=k});return $assign({},A)[S]!=7||Object.keys($assign({},B)).join("")!=K})?function assign(target,source){var T=toObject(target),aLen=arguments.length,index=1,getSymbols=gOPS.f,isEnum=pIE.f;while(aLen>index){var S=IObject(arguments[index++]),keys=getSymbols?getKeys(S).concat(getSymbols(S)):getKeys(S),length=keys.length,j=0,key;while(length>j)if(isEnum.call(S,key=keys[j++]))T[key]=S[key]}return T}:$assign},{"./_fails":56,"./_iobject":67,"./_object-gops":95,"./_object-keys":98,"./_object-pie":99,"./_to-object":131}],88:[function(require,module,exports){var anObject=require("./_an-object"),dPs=require("./_object-dps"),enumBugKeys=require("./_enum-bug-keys"),IE_PROTO=require("./_shared-key")("IE_PROTO"),Empty=function(){},PROTOTYPE="prototype";var createDict=function(){var iframe=require("./_dom-create")("iframe"),i=enumBugKeys.length,lt="<",gt=">",iframeDocument;iframe.style.display="none";require("./_html").appendChild(iframe);iframe.src="javascript:";iframeDocument=iframe.contentWindow.document;iframeDocument.open();iframeDocument.write(lt+"script"+gt+"document.F=Object"+lt+"/script"+gt);iframeDocument.close();createDict=iframeDocument.F;while(i--)delete createDict[PROTOTYPE][enumBugKeys[i]];return createDict()};module.exports=Object.create||function create(O,Properties){var result;if(O!==null){Empty[PROTOTYPE]=anObject(O);result=new Empty;Empty[PROTOTYPE]=null;result[IE_PROTO]=O}else result=createDict();return Properties===undefined?result:dPs(result,Properties)}},{"./_an-object":29,"./_dom-create":51,"./_enum-bug-keys":52,"./_html":63,"./_object-dps":90,"./_shared-key":115}],89:[function(require,module,exports){var anObject=require("./_an-object"),IE8_DOM_DEFINE=require("./_ie8-dom-define"),toPrimitive=require("./_to-primitive"),dP=Object.defineProperty;exports.f=require("./_descriptors")?Object.defineProperty:function defineProperty(O,P,Attributes){anObject(O);P=toPrimitive(P,true);anObject(Attributes);if(IE8_DOM_DEFINE)try{return dP(O,P,Attributes)}catch(e){}if("get"in Attributes||"set"in Attributes)throw TypeError("Accessors not supported!");if("value"in Attributes)O[P]=Attributes.value;return O}},{"./_an-object":29,"./_descriptors":50,"./_ie8-dom-define":64,"./_to-primitive":132}],90:[function(require,module,exports){var dP=require("./_object-dp"),anObject=require("./_an-object"),getKeys=require("./_object-keys");module.exports=require("./_descriptors")?Object.defineProperties:function defineProperties(O,Properties){anObject(O);var keys=getKeys(Properties),length=keys.length,i=0,P;while(length>i)dP.f(O,P=keys[i++],Properties[P]);return O}},{"./_an-object":29,"./_descriptors":50,"./_object-dp":89,"./_object-keys":98}],91:[function(require,module,exports){module.exports=require("./_library")||!require("./_fails")(function(){var K=Math.random();__defineSetter__.call(null,K,function(){});delete require("./_global")[K]})},{"./_fails":56,"./_global":60,"./_library":80}],92:[function(require,module,exports){var pIE=require("./_object-pie"),createDesc=require("./_property-desc"),toIObject=require("./_to-iobject"),toPrimitive=require("./_to-primitive"),has=require("./_has"),IE8_DOM_DEFINE=require("./_ie8-dom-define"),gOPD=Object.getOwnPropertyDescriptor;exports.f=require("./_descriptors")?gOPD:function getOwnPropertyDescriptor(O,P){O=toIObject(O);P=toPrimitive(P,true);if(IE8_DOM_DEFINE)try{return gOPD(O,P)}catch(e){}if(has(O,P))return createDesc(!pIE.f.call(O,P),O[P])}},{"./_descriptors":50,"./_has":61,"./_ie8-dom-define":64,"./_object-pie":99,"./_property-desc":107,"./_to-iobject":129,"./_to-primitive":132}],93:[function(require,module,exports){var toIObject=require("./_to-iobject"),gOPN=require("./_object-gopn").f,toString={}.toString;var windowNames=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];var getWindowNames=function(it){try{return gOPN(it)}catch(e){return windowNames.slice()}};module.exports.f=function getOwnPropertyNames(it){return windowNames&&toString.call(it)=="[object Window]"?getWindowNames(it):gOPN(toIObject(it))}},{"./_object-gopn":94,"./_to-iobject":129}],94:[function(require,module,exports){var $keys=require("./_object-keys-internal"),hiddenKeys=require("./_enum-bug-keys").concat("length","prototype");exports.f=Object.getOwnPropertyNames||function getOwnPropertyNames(O){return $keys(O,hiddenKeys)}},{"./_enum-bug-keys":52,"./_object-keys-internal":97}],95:[function(require,module,exports){exports.f=Object.getOwnPropertySymbols},{}],96:[function(require,module,exports){var has=require("./_has"),toObject=require("./_to-object"),IE_PROTO=require("./_shared-key")("IE_PROTO"),ObjectProto=Object.prototype;module.exports=Object.getPrototypeOf||function(O){O=toObject(O);if(has(O,IE_PROTO))return O[IE_PROTO];if(typeof O.constructor=="function"&&O instanceof O.constructor){return O.constructor.prototype}return O instanceof Object?ObjectProto:null}},{"./_has":61,"./_shared-key":115,"./_to-object":131}],97:[function(require,module,exports){var has=require("./_has"),toIObject=require("./_to-iobject"),arrayIndexOf=require("./_array-includes")(false),IE_PROTO=require("./_shared-key")("IE_PROTO");module.exports=function(object,names){var O=toIObject(object),i=0,result=[],key;for(key in O)if(key!=IE_PROTO)has(O,key)&&result.push(key);while(names.length>i)if(has(O,key=names[i++])){~arrayIndexOf(result,key)||result.push(key)}return result}},{"./_array-includes":33,"./_has":61,"./_shared-key":115,"./_to-iobject":129}],98:[function(require,module,exports){var $keys=require("./_object-keys-internal"),enumBugKeys=require("./_enum-bug-keys");module.exports=Object.keys||function keys(O){return $keys(O,enumBugKeys)}},{"./_enum-bug-keys":52,"./_object-keys-internal":97}],99:[function(require,module,exports){exports.f={}.propertyIsEnumerable},{}],100:[function(require,module,exports){var $export=require("./_export"),core=require("./_core"),fails=require("./_fails");module.exports=function(KEY,exec){var fn=(core.Object||{})[KEY]||Object[KEY],exp={};exp[KEY]=exec(fn);$export($export.S+$export.F*fails(function(){fn(1)}),"Object",exp)}},{"./_core":45,"./_export":54,"./_fails":56}],101:[function(require,module,exports){var getKeys=require("./_object-keys"),toIObject=require("./_to-iobject"),isEnum=require("./_object-pie").f;module.exports=function(isEntries){return function(it){var O=toIObject(it),keys=getKeys(O),length=keys.length,i=0,result=[],key;while(length>i)if(isEnum.call(O,key=keys[i++])){result.push(isEntries?[key,O[key]]:O[key])}return result}}},{"./_object-keys":98,"./_object-pie":99,"./_to-iobject":129}],102:[function(require,module,exports){var gOPN=require("./_object-gopn"),gOPS=require("./_object-gops"),anObject=require("./_an-object"),Reflect=require("./_global").Reflect;module.exports=Reflect&&Reflect.ownKeys||function ownKeys(it){var keys=gOPN.f(anObject(it)),getSymbols=gOPS.f;return getSymbols?keys.concat(getSymbols(it)):keys}},{"./_an-object":29,"./_global":60,"./_object-gopn":94,"./_object-gops":95}],103:[function(require,module,exports){var $parseFloat=require("./_global").parseFloat,$trim=require("./_string-trim").trim;module.exports=1/$parseFloat(require("./_string-ws")+"-0")!==-Infinity?function parseFloat(str){var string=$trim(String(str),3),result=$parseFloat(string);return result===0&&string.charAt(0)=="-"?-0:result}:$parseFloat},{"./_global":60,"./_string-trim":124,"./_string-ws":125}],104:[function(require,module,exports){var $parseInt=require("./_global").parseInt,$trim=require("./_string-trim").trim,ws=require("./_string-ws"),hex=/^[\-+]?0[xX]/;module.exports=$parseInt(ws+"08")!==8||$parseInt(ws+"0x16")!==22?function parseInt(str,radix){var string=$trim(String(str),3);return $parseInt(string,radix>>>0||(hex.test(string)?16:10))}:$parseInt},{"./_global":60,"./_string-trim":124,"./_string-ws":125}],105:[function(require,module,exports){"use strict";var path=require("./_path"),invoke=require("./_invoke"),aFunction=require("./_a-function");module.exports=function(){var fn=aFunction(this),length=arguments.length,pargs=Array(length),i=0,_=path._,holder=false;while(length>i)if((pargs[i]=arguments[i++])===_)holder=true;return function(){var that=this,aLen=arguments.length,j=0,k=0,args;if(!holder&&!aLen)return invoke(fn,pargs,that);args=pargs.slice();if(holder)for(;length>j;j++)if(args[j]===_)args[j]=arguments[k++];while(aLen>k)args.push(arguments[k++]);return invoke(fn,args,that)}}},{"./_a-function":25,"./_invoke":66,"./_path":106}],106:[function(require,module,exports){module.exports=require("./_global")},{"./_global":60}],107:[function(require,module,exports){module.exports=function(bitmap,value){return{enumerable:!(bitmap&1),configurable:!(bitmap&2),writable:!(bitmap&4),value:value}}},{}],108:[function(require,module,exports){var redefine=require("./_redefine");module.exports=function(target,src,safe){for(var key in src)redefine(target,key,src[key],safe);return target}},{"./_redefine":109}],109:[function(require,module,exports){var global=require("./_global"),hide=require("./_hide"),has=require("./_has"),SRC=require("./_uid")("src"),TO_STRING="toString",$toString=Function[TO_STRING],TPL=(""+$toString).split(TO_STRING);require("./_core").inspectSource=function(it){return $toString.call(it)};(module.exports=function(O,key,val,safe){var isFunction=typeof val=="function";if(isFunction)has(val,"name")||hide(val,"name",key);if(O[key]===val)return;if(isFunction)has(val,SRC)||hide(val,SRC,O[key]?""+O[key]:TPL.join(String(key)));if(O===global){O[key]=val}else{if(!safe){delete O[key];hide(O,key,val)}else{if(O[key])O[key]=val;else hide(O,key,val)}}})(Function.prototype,TO_STRING,function toString(){return typeof this=="function"&&this[SRC]||$toString.call(this)})},{"./_core":45,"./_global":60,"./_has":61,"./_hide":62,"./_uid":136}],110:[function(require,module,exports){module.exports=function(regExp,replace){var replacer=replace===Object(replace)?function(part){return replace[part]}:replace;return function(it){return String(it).replace(regExp,replacer)}}},{}],111:[function(require,module,exports){module.exports=Object.is||function is(x,y){return x===y?x!==0||1/x===1/y:x!=x&&y!=y}},{}],112:[function(require,module,exports){var isObject=require("./_is-object"),anObject=require("./_an-object");var check=function(O,proto){anObject(O);if(!isObject(proto)&&proto!==null)throw TypeError(proto+": can't set as prototype!")};module.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(test,buggy,set){try{set=require("./_ctx")(Function.call,require("./_object-gopd").f(Object.prototype,"__proto__").set,2);set(test,[]);buggy=!(test instanceof Array)}catch(e){buggy=true}return function setPrototypeOf(O,proto){check(O,proto);if(buggy)O.__proto__=proto;else set(O,proto);return O}}({},false):undefined),check:check}},{"./_an-object":29,"./_ctx":47,"./_is-object":71,"./_object-gopd":92}],113:[function(require,module,exports){"use strict";var global=require("./_global"),dP=require("./_object-dp"),DESCRIPTORS=require("./_descriptors"),SPECIES=require("./_wks")("species");module.exports=function(KEY){var C=global[KEY];if(DESCRIPTORS&&C&&!C[SPECIES])dP.f(C,SPECIES,{configurable:true,get:function(){return this}})}},{"./_descriptors":50,"./_global":60,"./_object-dp":89,"./_wks":139}],114:[function(require,module,exports){var def=require("./_object-dp").f,has=require("./_has"),TAG=require("./_wks")("toStringTag");module.exports=function(it,tag,stat){if(it&&!has(it=stat?it:it.prototype,TAG))def(it,TAG,{configurable:true,value:tag})}},{"./_has":61,"./_object-dp":89,"./_wks":139}],115:[function(require,module,exports){var shared=require("./_shared")("keys"),uid=require("./_uid");module.exports=function(key){return shared[key]||(shared[key]=uid(key))}},{"./_shared":116,"./_uid":136}],116:[function(require,module,exports){var global=require("./_global"),SHARED="__core-js_shared__",store=global[SHARED]||(global[SHARED]={});module.exports=function(key){return store[key]||(store[key]={})}},{"./_global":60}],117:[function(require,module,exports){var anObject=require("./_an-object"),aFunction=require("./_a-function"),SPECIES=require("./_wks")("species");module.exports=function(O,D){var C=anObject(O).constructor,S;return C===undefined||(S=anObject(C)[SPECIES])==undefined?D:aFunction(S)}},{"./_a-function":25,"./_an-object":29,"./_wks":139}],118:[function(require,module,exports){var fails=require("./_fails");module.exports=function(method,arg){return!!method&&fails(function(){arg?method.call(null,function(){},1):method.call(null)})}},{"./_fails":56}],119:[function(require,module,exports){var toInteger=require("./_to-integer"),defined=require("./_defined");module.exports=function(TO_STRING){return function(that,pos){var s=String(defined(that)),i=toInteger(pos),l=s.length,a,b;if(i<0||i>=l)return TO_STRING?"":undefined;a=s.charCodeAt(i);return a<55296||a>56319||i+1===l||(b=s.charCodeAt(i+1))<56320||b>57343?TO_STRING?s.charAt(i):a:TO_STRING?s.slice(i,i+2):(a-55296<<10)+(b-56320)+65536}}},{"./_defined":49,"./_to-integer":128}],120:[function(require,module,exports){var isRegExp=require("./_is-regexp"),defined=require("./_defined");module.exports=function(that,searchString,NAME){if(isRegExp(searchString))throw TypeError("String#"+NAME+" doesn't accept regex!");return String(defined(that))}},{"./_defined":49,"./_is-regexp":72}],121:[function(require,module,exports){var $export=require("./_export"),fails=require("./_fails"),defined=require("./_defined"),quot=/"/g;var createHTML=function(string,tag,attribute,value){var S=String(defined(string)),p1="<"+tag;if(attribute!=="")p1+=" "+attribute+'="'+String(value).replace(quot,"&quot;")+'"';
return p1+">"+S+"</"+tag+">"};module.exports=function(NAME,exec){var O={};O[NAME]=exec(createHTML);$export($export.P+$export.F*fails(function(){var test=""[NAME]('"');return test!==test.toLowerCase()||test.split('"').length>3}),"String",O)}},{"./_defined":49,"./_export":54,"./_fails":56}],122:[function(require,module,exports){var toLength=require("./_to-length"),repeat=require("./_string-repeat"),defined=require("./_defined");module.exports=function(that,maxLength,fillString,left){var S=String(defined(that)),stringLength=S.length,fillStr=fillString===undefined?" ":String(fillString),intMaxLength=toLength(maxLength);if(intMaxLength<=stringLength||fillStr=="")return S;var fillLen=intMaxLength-stringLength,stringFiller=repeat.call(fillStr,Math.ceil(fillLen/fillStr.length));if(stringFiller.length>fillLen)stringFiller=stringFiller.slice(0,fillLen);return left?stringFiller+S:S+stringFiller}},{"./_defined":49,"./_string-repeat":123,"./_to-length":130}],123:[function(require,module,exports){"use strict";var toInteger=require("./_to-integer"),defined=require("./_defined");module.exports=function repeat(count){var str=String(defined(this)),res="",n=toInteger(count);if(n<0||n==Infinity)throw RangeError("Count can't be negative");for(;n>0;(n>>>=1)&&(str+=str))if(n&1)res+=str;return res}},{"./_defined":49,"./_to-integer":128}],124:[function(require,module,exports){var $export=require("./_export"),defined=require("./_defined"),fails=require("./_fails"),spaces=require("./_string-ws"),space="["+spaces+"]",non="",ltrim=RegExp("^"+space+space+"*"),rtrim=RegExp(space+space+"*$");var exporter=function(KEY,exec,ALIAS){var exp={};var FORCE=fails(function(){return!!spaces[KEY]()||non[KEY]()!=non});var fn=exp[KEY]=FORCE?exec(trim):spaces[KEY];if(ALIAS)exp[ALIAS]=fn;$export($export.P+$export.F*FORCE,"String",exp)};var trim=exporter.trim=function(string,TYPE){string=String(defined(string));if(TYPE&1)string=string.replace(ltrim,"");if(TYPE&2)string=string.replace(rtrim,"");return string};module.exports=exporter},{"./_defined":49,"./_export":54,"./_fails":56,"./_string-ws":125}],125:[function(require,module,exports){module.exports="\t\n\v\f\r "+"\u2028\u2029\ufeff"},{}],126:[function(require,module,exports){var ctx=require("./_ctx"),invoke=require("./_invoke"),html=require("./_html"),cel=require("./_dom-create"),global=require("./_global"),process=global.process,setTask=global.setImmediate,clearTask=global.clearImmediate,MessageChannel=global.MessageChannel,counter=0,queue={},ONREADYSTATECHANGE="onreadystatechange",defer,channel,port;var run=function(){var id=+this;if(queue.hasOwnProperty(id)){var fn=queue[id];delete queue[id];fn()}};var listener=function(event){run.call(event.data)};if(!setTask||!clearTask){setTask=function setImmediate(fn){var args=[],i=1;while(arguments.length>i)args.push(arguments[i++]);queue[++counter]=function(){invoke(typeof fn=="function"?fn:Function(fn),args)};defer(counter);return counter};clearTask=function clearImmediate(id){delete queue[id]};if(require("./_cof")(process)=="process"){defer=function(id){process.nextTick(ctx(run,id,1))}}else if(MessageChannel){channel=new MessageChannel;port=channel.port2;channel.port1.onmessage=listener;defer=ctx(port.postMessage,port,1)}else if(global.addEventListener&&typeof postMessage=="function"&&!global.importScripts){defer=function(id){global.postMessage(id+"","*")};global.addEventListener("message",listener,false)}else if(ONREADYSTATECHANGE in cel("script")){defer=function(id){html.appendChild(cel("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this);run.call(id)}}}else{defer=function(id){setTimeout(ctx(run,id,1),0)}}}module.exports={set:setTask,clear:clearTask}},{"./_cof":40,"./_ctx":47,"./_dom-create":51,"./_global":60,"./_html":63,"./_invoke":66}],127:[function(require,module,exports){var toInteger=require("./_to-integer"),max=Math.max,min=Math.min;module.exports=function(index,length){index=toInteger(index);return index<0?max(index+length,0):min(index,length)}},{"./_to-integer":128}],128:[function(require,module,exports){var ceil=Math.ceil,floor=Math.floor;module.exports=function(it){return isNaN(it=+it)?0:(it>0?floor:ceil)(it)}},{}],129:[function(require,module,exports){var IObject=require("./_iobject"),defined=require("./_defined");module.exports=function(it){return IObject(defined(it))}},{"./_defined":49,"./_iobject":67}],130:[function(require,module,exports){var toInteger=require("./_to-integer"),min=Math.min;module.exports=function(it){return it>0?min(toInteger(it),9007199254740991):0}},{"./_to-integer":128}],131:[function(require,module,exports){var defined=require("./_defined");module.exports=function(it){return Object(defined(it))}},{"./_defined":49}],132:[function(require,module,exports){var isObject=require("./_is-object");module.exports=function(it,S){if(!isObject(it))return it;var fn,val;if(S&&typeof(fn=it.toString)=="function"&&!isObject(val=fn.call(it)))return val;if(typeof(fn=it.valueOf)=="function"&&!isObject(val=fn.call(it)))return val;if(!S&&typeof(fn=it.toString)=="function"&&!isObject(val=fn.call(it)))return val;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":71}],133:[function(require,module,exports){"use strict";if(require("./_descriptors")){var LIBRARY=require("./_library"),global=require("./_global"),fails=require("./_fails"),$export=require("./_export"),$typed=require("./_typed"),$buffer=require("./_typed-buffer"),ctx=require("./_ctx"),anInstance=require("./_an-instance"),propertyDesc=require("./_property-desc"),hide=require("./_hide"),redefineAll=require("./_redefine-all"),toInteger=require("./_to-integer"),toLength=require("./_to-length"),toIndex=require("./_to-index"),toPrimitive=require("./_to-primitive"),has=require("./_has"),same=require("./_same-value"),classof=require("./_classof"),isObject=require("./_is-object"),toObject=require("./_to-object"),isArrayIter=require("./_is-array-iter"),create=require("./_object-create"),getPrototypeOf=require("./_object-gpo"),gOPN=require("./_object-gopn").f,getIterFn=require("./core.get-iterator-method"),uid=require("./_uid"),wks=require("./_wks"),createArrayMethod=require("./_array-methods"),createArrayIncludes=require("./_array-includes"),speciesConstructor=require("./_species-constructor"),ArrayIterators=require("./es6.array.iterator"),Iterators=require("./_iterators"),$iterDetect=require("./_iter-detect"),setSpecies=require("./_set-species"),arrayFill=require("./_array-fill"),arrayCopyWithin=require("./_array-copy-within"),$DP=require("./_object-dp"),$GOPD=require("./_object-gopd"),dP=$DP.f,gOPD=$GOPD.f,RangeError=global.RangeError,TypeError=global.TypeError,Uint8Array=global.Uint8Array,ARRAY_BUFFER="ArrayBuffer",SHARED_BUFFER="Shared"+ARRAY_BUFFER,BYTES_PER_ELEMENT="BYTES_PER_ELEMENT",PROTOTYPE="prototype",ArrayProto=Array[PROTOTYPE],$ArrayBuffer=$buffer.ArrayBuffer,$DataView=$buffer.DataView,arrayForEach=createArrayMethod(0),arrayFilter=createArrayMethod(2),arraySome=createArrayMethod(3),arrayEvery=createArrayMethod(4),arrayFind=createArrayMethod(5),arrayFindIndex=createArrayMethod(6),arrayIncludes=createArrayIncludes(true),arrayIndexOf=createArrayIncludes(false),arrayValues=ArrayIterators.values,arrayKeys=ArrayIterators.keys,arrayEntries=ArrayIterators.entries,arrayLastIndexOf=ArrayProto.lastIndexOf,arrayReduce=ArrayProto.reduce,arrayReduceRight=ArrayProto.reduceRight,arrayJoin=ArrayProto.join,arraySort=ArrayProto.sort,arraySlice=ArrayProto.slice,arrayToString=ArrayProto.toString,arrayToLocaleString=ArrayProto.toLocaleString,ITERATOR=wks("iterator"),TAG=wks("toStringTag"),TYPED_CONSTRUCTOR=uid("typed_constructor"),DEF_CONSTRUCTOR=uid("def_constructor"),ALL_CONSTRUCTORS=$typed.CONSTR,TYPED_ARRAY=$typed.TYPED,VIEW=$typed.VIEW,WRONG_LENGTH="Wrong length!";var $map=createArrayMethod(1,function(O,length){return allocate(speciesConstructor(O,O[DEF_CONSTRUCTOR]),length)});var LITTLE_ENDIAN=fails(function(){return new Uint8Array(new Uint16Array([1]).buffer)[0]===1});var FORCED_SET=!!Uint8Array&&!!Uint8Array[PROTOTYPE].set&&fails(function(){new Uint8Array(1).set({})});var strictToLength=function(it,SAME){if(it===undefined)throw TypeError(WRONG_LENGTH);var number=+it,length=toLength(it);if(SAME&&!same(number,length))throw RangeError(WRONG_LENGTH);return length};var toOffset=function(it,BYTES){var offset=toInteger(it);if(offset<0||offset%BYTES)throw RangeError("Wrong offset!");return offset};var validate=function(it){if(isObject(it)&&TYPED_ARRAY in it)return it;throw TypeError(it+" is not a typed array!")};var allocate=function(C,length){if(!(isObject(C)&&TYPED_CONSTRUCTOR in C)){throw TypeError("It is not a typed array constructor!")}return new C(length)};var speciesFromList=function(O,list){return fromList(speciesConstructor(O,O[DEF_CONSTRUCTOR]),list)};var fromList=function(C,list){var index=0,length=list.length,result=allocate(C,length);while(length>index)result[index]=list[index++];return result};var addGetter=function(it,key,internal){dP(it,key,{get:function(){return this._d[internal]}})};var $from=function from(source){var O=toObject(source),aLen=arguments.length,mapfn=aLen>1?arguments[1]:undefined,mapping=mapfn!==undefined,iterFn=getIterFn(O),i,length,values,result,step,iterator;if(iterFn!=undefined&&!isArrayIter(iterFn)){for(iterator=iterFn.call(O),values=[],i=0;!(step=iterator.next()).done;i++){values.push(step.value)}O=values}if(mapping&&aLen>2)mapfn=ctx(mapfn,arguments[2],2);for(i=0,length=toLength(O.length),result=allocate(this,length);length>i;i++){result[i]=mapping?mapfn(O[i],i):O[i]}return result};var $of=function of(){var index=0,length=arguments.length,result=allocate(this,length);while(length>index)result[index]=arguments[index++];return result};var TO_LOCALE_BUG=!!Uint8Array&&fails(function(){arrayToLocaleString.call(new Uint8Array(1))});var $toLocaleString=function toLocaleString(){return arrayToLocaleString.apply(TO_LOCALE_BUG?arraySlice.call(validate(this)):validate(this),arguments)};var proto={copyWithin:function copyWithin(target,start){return arrayCopyWithin.call(validate(this),target,start,arguments.length>2?arguments[2]:undefined)},every:function every(callbackfn){return arrayEvery(validate(this),callbackfn,arguments.length>1?arguments[1]:undefined)},fill:function fill(value){return arrayFill.apply(validate(this),arguments)},filter:function filter(callbackfn){return speciesFromList(this,arrayFilter(validate(this),callbackfn,arguments.length>1?arguments[1]:undefined))},find:function find(predicate){return arrayFind(validate(this),predicate,arguments.length>1?arguments[1]:undefined)},findIndex:function findIndex(predicate){return arrayFindIndex(validate(this),predicate,arguments.length>1?arguments[1]:undefined)},forEach:function forEach(callbackfn){arrayForEach(validate(this),callbackfn,arguments.length>1?arguments[1]:undefined)},indexOf:function indexOf(searchElement){return arrayIndexOf(validate(this),searchElement,arguments.length>1?arguments[1]:undefined)},includes:function includes(searchElement){return arrayIncludes(validate(this),searchElement,arguments.length>1?arguments[1]:undefined)},join:function join(separator){return arrayJoin.apply(validate(this),arguments)},lastIndexOf:function lastIndexOf(searchElement){return arrayLastIndexOf.apply(validate(this),arguments)},map:function map(mapfn){return $map(validate(this),mapfn,arguments.length>1?arguments[1]:undefined)},reduce:function reduce(callbackfn){return arrayReduce.apply(validate(this),arguments)},reduceRight:function reduceRight(callbackfn){return arrayReduceRight.apply(validate(this),arguments)},reverse:function reverse(){var that=this,length=validate(that).length,middle=Math.floor(length/2),index=0,value;while(index<middle){value=that[index];that[index++]=that[--length];that[length]=value}return that},some:function some(callbackfn){return arraySome(validate(this),callbackfn,arguments.length>1?arguments[1]:undefined)},sort:function sort(comparefn){return arraySort.call(validate(this),comparefn)},subarray:function subarray(begin,end){var O=validate(this),length=O.length,$begin=toIndex(begin,length);return new(speciesConstructor(O,O[DEF_CONSTRUCTOR]))(O.buffer,O.byteOffset+$begin*O.BYTES_PER_ELEMENT,toLength((end===undefined?length:toIndex(end,length))-$begin))}};var $slice=function slice(start,end){return speciesFromList(this,arraySlice.call(validate(this),start,end))};var $set=function set(arrayLike){validate(this);var offset=toOffset(arguments[1],1),length=this.length,src=toObject(arrayLike),len=toLength(src.length),index=0;if(len+offset>length)throw RangeError(WRONG_LENGTH);while(index<len)this[offset+index]=src[index++]};var $iterators={entries:function entries(){return arrayEntries.call(validate(this))},keys:function keys(){return arrayKeys.call(validate(this))},values:function values(){return arrayValues.call(validate(this))}};var isTAIndex=function(target,key){return isObject(target)&&target[TYPED_ARRAY]&&typeof key!="symbol"&&key in target&&String(+key)==String(key)};var $getDesc=function getOwnPropertyDescriptor(target,key){return isTAIndex(target,key=toPrimitive(key,true))?propertyDesc(2,target[key]):gOPD(target,key)};var $setDesc=function defineProperty(target,key,desc){if(isTAIndex(target,key=toPrimitive(key,true))&&isObject(desc)&&has(desc,"value")&&!has(desc,"get")&&!has(desc,"set")&&!desc.configurable&&(!has(desc,"writable")||desc.writable)&&(!has(desc,"enumerable")||desc.enumerable)){target[key]=desc.value;return target}else return dP(target,key,desc)};if(!ALL_CONSTRUCTORS){$GOPD.f=$getDesc;$DP.f=$setDesc}$export($export.S+$export.F*!ALL_CONSTRUCTORS,"Object",{getOwnPropertyDescriptor:$getDesc,defineProperty:$setDesc});if(fails(function(){arrayToString.call({})})){arrayToString=arrayToLocaleString=function toString(){return arrayJoin.call(this)}}var $TypedArrayPrototype$=redefineAll({},proto);redefineAll($TypedArrayPrototype$,$iterators);hide($TypedArrayPrototype$,ITERATOR,$iterators.values);redefineAll($TypedArrayPrototype$,{slice:$slice,set:$set,constructor:function(){},toString:arrayToString,toLocaleString:$toLocaleString});addGetter($TypedArrayPrototype$,"buffer","b");addGetter($TypedArrayPrototype$,"byteOffset","o");addGetter($TypedArrayPrototype$,"byteLength","l");addGetter($TypedArrayPrototype$,"length","e");dP($TypedArrayPrototype$,TAG,{get:function(){return this[TYPED_ARRAY]}});module.exports=function(KEY,BYTES,wrapper,CLAMPED){CLAMPED=!!CLAMPED;var NAME=KEY+(CLAMPED?"Clamped":"")+"Array",ISNT_UINT8=NAME!="Uint8Array",GETTER="get"+KEY,SETTER="set"+KEY,TypedArray=global[NAME],Base=TypedArray||{},TAC=TypedArray&&getPrototypeOf(TypedArray),FORCED=!TypedArray||!$typed.ABV,O={},TypedArrayPrototype=TypedArray&&TypedArray[PROTOTYPE];var getter=function(that,index){var data=that._d;return data.v[GETTER](index*BYTES+data.o,LITTLE_ENDIAN)};var setter=function(that,index,value){var data=that._d;if(CLAMPED)value=(value=Math.round(value))<0?0:value>255?255:value&255;data.v[SETTER](index*BYTES+data.o,value,LITTLE_ENDIAN)};var addElement=function(that,index){dP(that,index,{get:function(){return getter(this,index)},set:function(value){return setter(this,index,value)},enumerable:true})};if(FORCED){TypedArray=wrapper(function(that,data,$offset,$length){anInstance(that,TypedArray,NAME,"_d");var index=0,offset=0,buffer,byteLength,length,klass;if(!isObject(data)){length=strictToLength(data,true);byteLength=length*BYTES;buffer=new $ArrayBuffer(byteLength)}else if(data instanceof $ArrayBuffer||(klass=classof(data))==ARRAY_BUFFER||klass==SHARED_BUFFER){buffer=data;offset=toOffset($offset,BYTES);var $len=data.byteLength;if($length===undefined){if($len%BYTES)throw RangeError(WRONG_LENGTH);byteLength=$len-offset;if(byteLength<0)throw RangeError(WRONG_LENGTH)}else{byteLength=toLength($length)*BYTES;if(byteLength+offset>$len)throw RangeError(WRONG_LENGTH)}length=byteLength/BYTES}else if(TYPED_ARRAY in data){return fromList(TypedArray,data)}else{return $from.call(TypedArray,data)}hide(that,"_d",{b:buffer,o:offset,l:byteLength,e:length,v:new $DataView(buffer)});while(index<length)addElement(that,index++)});TypedArrayPrototype=TypedArray[PROTOTYPE]=create($TypedArrayPrototype$);hide(TypedArrayPrototype,"constructor",TypedArray)}else if(!$iterDetect(function(iter){new TypedArray(null);new TypedArray(iter)},true)){TypedArray=wrapper(function(that,data,$offset,$length){anInstance(that,TypedArray,NAME);var klass;if(!isObject(data))return new Base(strictToLength(data,ISNT_UINT8));if(data instanceof $ArrayBuffer||(klass=classof(data))==ARRAY_BUFFER||klass==SHARED_BUFFER){return $length!==undefined?new Base(data,toOffset($offset,BYTES),$length):$offset!==undefined?new Base(data,toOffset($offset,BYTES)):new Base(data)}if(TYPED_ARRAY in data)return fromList(TypedArray,data);return $from.call(TypedArray,data)});arrayForEach(TAC!==Function.prototype?gOPN(Base).concat(gOPN(TAC)):gOPN(Base),function(key){if(!(key in TypedArray))hide(TypedArray,key,Base[key])});TypedArray[PROTOTYPE]=TypedArrayPrototype;if(!LIBRARY)TypedArrayPrototype.constructor=TypedArray}var $nativeIterator=TypedArrayPrototype[ITERATOR],CORRECT_ITER_NAME=!!$nativeIterator&&($nativeIterator.name=="values"||$nativeIterator.name==undefined),$iterator=$iterators.values;hide(TypedArray,TYPED_CONSTRUCTOR,true);hide(TypedArrayPrototype,TYPED_ARRAY,NAME);hide(TypedArrayPrototype,VIEW,true);hide(TypedArrayPrototype,DEF_CONSTRUCTOR,TypedArray);if(CLAMPED?new TypedArray(1)[TAG]!=NAME:!(TAG in TypedArrayPrototype)){dP(TypedArrayPrototype,TAG,{get:function(){return NAME}})}O[NAME]=TypedArray;$export($export.G+$export.W+$export.F*(TypedArray!=Base),O);$export($export.S,NAME,{BYTES_PER_ELEMENT:BYTES,from:$from,of:$of});if(!(BYTES_PER_ELEMENT in TypedArrayPrototype))hide(TypedArrayPrototype,BYTES_PER_ELEMENT,BYTES);$export($export.P,NAME,proto);setSpecies(NAME);$export($export.P+$export.F*FORCED_SET,NAME,{set:$set});$export($export.P+$export.F*!CORRECT_ITER_NAME,NAME,$iterators);$export($export.P+$export.F*(TypedArrayPrototype.toString!=arrayToString),NAME,{toString:arrayToString});$export($export.P+$export.F*fails(function(){new TypedArray(1).slice()}),NAME,{slice:$slice});$export($export.P+$export.F*(fails(function(){return[1,2].toLocaleString()!=new TypedArray([1,2]).toLocaleString()})||!fails(function(){TypedArrayPrototype.toLocaleString.call([1,2])})),NAME,{toLocaleString:$toLocaleString});Iterators[NAME]=CORRECT_ITER_NAME?$nativeIterator:$iterator;if(!LIBRARY&&!CORRECT_ITER_NAME)hide(TypedArrayPrototype,ITERATOR,$iterator)}}else module.exports=function(){}},{"./_an-instance":28,"./_array-copy-within":30,"./_array-fill":31,"./_array-includes":33,"./_array-methods":34,"./_classof":39,"./_ctx":47,"./_descriptors":50,"./_export":54,"./_fails":56,"./_global":60,"./_has":61,"./_hide":62,"./_is-array-iter":68,"./_is-object":71,"./_iter-detect":76,"./_iterators":78,"./_library":80,"./_object-create":88,"./_object-dp":89,"./_object-gopd":92,"./_object-gopn":94,"./_object-gpo":96,"./_property-desc":107,"./_redefine-all":108,"./_same-value":111,"./_set-species":113,"./_species-constructor":117,"./_to-index":127,"./_to-integer":128,"./_to-length":130,"./_to-object":131,"./_to-primitive":132,"./_typed":135,"./_typed-buffer":134,"./_uid":136,"./_wks":139,"./core.get-iterator-method":140,"./es6.array.iterator":152}],134:[function(require,module,exports){"use strict";var global=require("./_global"),DESCRIPTORS=require("./_descriptors"),LIBRARY=require("./_library"),$typed=require("./_typed"),hide=require("./_hide"),redefineAll=require("./_redefine-all"),fails=require("./_fails"),anInstance=require("./_an-instance"),toInteger=require("./_to-integer"),toLength=require("./_to-length"),gOPN=require("./_object-gopn").f,dP=require("./_object-dp").f,arrayFill=require("./_array-fill"),setToStringTag=require("./_set-to-string-tag"),ARRAY_BUFFER="ArrayBuffer",DATA_VIEW="DataView",PROTOTYPE="prototype",WRONG_LENGTH="Wrong length!",WRONG_INDEX="Wrong index!",$ArrayBuffer=global[ARRAY_BUFFER],$DataView=global[DATA_VIEW],Math=global.Math,RangeError=global.RangeError,Infinity=global.Infinity,BaseBuffer=$ArrayBuffer,abs=Math.abs,pow=Math.pow,floor=Math.floor,log=Math.log,LN2=Math.LN2,BUFFER="buffer",BYTE_LENGTH="byteLength",BYTE_OFFSET="byteOffset",$BUFFER=DESCRIPTORS?"_b":BUFFER,$LENGTH=DESCRIPTORS?"_l":BYTE_LENGTH,$OFFSET=DESCRIPTORS?"_o":BYTE_OFFSET;var packIEEE754=function(value,mLen,nBytes){var buffer=Array(nBytes),eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?pow(2,-24)-pow(2,-77):0,i=0,s=value<0||value===0&&1/value<0?1:0,e,m,c;value=abs(value);if(value!=value||value===Infinity){m=value!=value?1:0;e=eMax}else{e=floor(log(value)/LN2);if(value*(c=pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*pow(2,mLen);e=e+eBias}else{m=value*pow(2,eBias-1)*pow(2,mLen);e=0}}for(;mLen>=8;buffer[i++]=m&255,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[i++]=e&255,e/=256,eLen-=8);buffer[--i]|=s*128;return buffer};var unpackIEEE754=function(buffer,mLen,nBytes){var eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=eLen-7,i=nBytes-1,s=buffer[i--],e=s&127,m;s>>=7;for(;nBits>0;e=e*256+buffer[i],i--,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[i],i--,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:s?-Infinity:Infinity}else{m=m+pow(2,mLen);e=e-eBias}return(s?-1:1)*m*pow(2,e-mLen)};var unpackI32=function(bytes){return bytes[3]<<24|bytes[2]<<16|bytes[1]<<8|bytes[0]};var packI8=function(it){return[it&255]};var packI16=function(it){return[it&255,it>>8&255]};var packI32=function(it){return[it&255,it>>8&255,it>>16&255,it>>24&255]};var packF64=function(it){return packIEEE754(it,52,8)};var packF32=function(it){return packIEEE754(it,23,4)};var addGetter=function(C,key,internal){dP(C[PROTOTYPE],key,{get:function(){return this[internal]}})};var get=function(view,bytes,index,isLittleEndian){var numIndex=+index,intIndex=toInteger(numIndex);if(numIndex!=intIndex||intIndex<0||intIndex+bytes>view[$LENGTH])throw RangeError(WRONG_INDEX);var store=view[$BUFFER]._b,start=intIndex+view[$OFFSET],pack=store.slice(start,start+bytes);return isLittleEndian?pack:pack.reverse()};var set=function(view,bytes,index,conversion,value,isLittleEndian){var numIndex=+index,intIndex=toInteger(numIndex);if(numIndex!=intIndex||intIndex<0||intIndex+bytes>view[$LENGTH])throw RangeError(WRONG_INDEX);var store=view[$BUFFER]._b,start=intIndex+view[$OFFSET],pack=conversion(+value);for(var i=0;i<bytes;i++)store[start+i]=pack[isLittleEndian?i:bytes-i-1]};var validateArrayBufferArguments=function(that,length){anInstance(that,$ArrayBuffer,ARRAY_BUFFER);var numberLength=+length,byteLength=toLength(numberLength);if(numberLength!=byteLength)throw RangeError(WRONG_LENGTH);return byteLength};if(!$typed.ABV){$ArrayBuffer=function ArrayBuffer(length){var byteLength=validateArrayBufferArguments(this,length);this._b=arrayFill.call(Array(byteLength),0);this[$LENGTH]=byteLength};$DataView=function DataView(buffer,byteOffset,byteLength){anInstance(this,$DataView,DATA_VIEW);anInstance(buffer,$ArrayBuffer,DATA_VIEW);var bufferLength=buffer[$LENGTH],offset=toInteger(byteOffset);if(offset<0||offset>bufferLength)throw RangeError("Wrong offset!");byteLength=byteLength===undefined?bufferLength-offset:toLength(byteLength);if(offset+byteLength>bufferLength)throw RangeError(WRONG_LENGTH);this[$BUFFER]=buffer;this[$OFFSET]=offset;this[$LENGTH]=byteLength};if(DESCRIPTORS){addGetter($ArrayBuffer,BYTE_LENGTH,"_l");addGetter($DataView,BUFFER,"_b");addGetter($DataView,BYTE_LENGTH,"_l");addGetter($DataView,BYTE_OFFSET,"_o")}redefineAll($DataView[PROTOTYPE],{getInt8:function getInt8(byteOffset){return get(this,1,byteOffset)[0]<<24>>24},getUint8:function getUint8(byteOffset){return get(this,1,byteOffset)[0]},getInt16:function getInt16(byteOffset){var bytes=get(this,2,byteOffset,arguments[1]);return(bytes[1]<<8|bytes[0])<<16>>16},getUint16:function getUint16(byteOffset){var bytes=get(this,2,byteOffset,arguments[1]);return bytes[1]<<8|bytes[0]},getInt32:function getInt32(byteOffset){return unpackI32(get(this,4,byteOffset,arguments[1]))},getUint32:function getUint32(byteOffset){return unpackI32(get(this,4,byteOffset,arguments[1]))>>>0},getFloat32:function getFloat32(byteOffset){return unpackIEEE754(get(this,4,byteOffset,arguments[1]),23,4)},getFloat64:function getFloat64(byteOffset){return unpackIEEE754(get(this,8,byteOffset,arguments[1]),52,8)},setInt8:function setInt8(byteOffset,value){set(this,1,byteOffset,packI8,value)},setUint8:function setUint8(byteOffset,value){set(this,1,byteOffset,packI8,value)},setInt16:function setInt16(byteOffset,value){set(this,2,byteOffset,packI16,value,arguments[2])},setUint16:function setUint16(byteOffset,value){set(this,2,byteOffset,packI16,value,arguments[2])},setInt32:function setInt32(byteOffset,value){set(this,4,byteOffset,packI32,value,arguments[2])},setUint32:function setUint32(byteOffset,value){set(this,4,byteOffset,packI32,value,arguments[2])},setFloat32:function setFloat32(byteOffset,value){set(this,4,byteOffset,packF32,value,arguments[2])},setFloat64:function setFloat64(byteOffset,value){set(this,8,byteOffset,packF64,value,arguments[2])}})}else{if(!fails(function(){new $ArrayBuffer})||!fails(function(){new $ArrayBuffer(.5)})){$ArrayBuffer=function ArrayBuffer(length){return new BaseBuffer(validateArrayBufferArguments(this,length))};var ArrayBufferProto=$ArrayBuffer[PROTOTYPE]=BaseBuffer[PROTOTYPE];for(var keys=gOPN(BaseBuffer),j=0,key;keys.length>j;){if(!((key=keys[j++])in $ArrayBuffer))hide($ArrayBuffer,key,BaseBuffer[key])}if(!LIBRARY)ArrayBufferProto.constructor=$ArrayBuffer}var view=new $DataView(new $ArrayBuffer(2)),$setInt8=$DataView[PROTOTYPE].setInt8;view.setInt8(0,2147483648);view.setInt8(1,2147483649);if(view.getInt8(0)||!view.getInt8(1))redefineAll($DataView[PROTOTYPE],{setInt8:function setInt8(byteOffset,value){$setInt8.call(this,byteOffset,value<<24>>24)},setUint8:function setUint8(byteOffset,value){$setInt8.call(this,byteOffset,value<<24>>24)}},true)}setToStringTag($ArrayBuffer,ARRAY_BUFFER);setToStringTag($DataView,DATA_VIEW);hide($DataView[PROTOTYPE],$typed.VIEW,true);exports[ARRAY_BUFFER]=$ArrayBuffer;exports[DATA_VIEW]=$DataView},{"./_an-instance":28,"./_array-fill":31,"./_descriptors":50,"./_fails":56,"./_global":60,"./_hide":62,"./_library":80,"./_object-dp":89,"./_object-gopn":94,"./_redefine-all":108,"./_set-to-string-tag":114,"./_to-integer":128,"./_to-length":130,"./_typed":135}],135:[function(require,module,exports){var global=require("./_global"),hide=require("./_hide"),uid=require("./_uid"),TYPED=uid("typed_array"),VIEW=uid("view"),ABV=!!(global.ArrayBuffer&&global.DataView),CONSTR=ABV,i=0,l=9,Typed;var TypedArrayConstructors="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");while(i<l){if(Typed=global[TypedArrayConstructors[i++]]){hide(Typed.prototype,TYPED,true);hide(Typed.prototype,VIEW,true)}else CONSTR=false}module.exports={ABV:ABV,CONSTR:CONSTR,TYPED:TYPED,VIEW:VIEW}},{"./_global":60,"./_hide":62,"./_uid":136}],136:[function(require,module,exports){var id=0,px=Math.random();module.exports=function(key){return"Symbol(".concat(key===undefined?"":key,")_",(++id+px).toString(36))}},{}],137:[function(require,module,exports){var global=require("./_global"),core=require("./_core"),LIBRARY=require("./_library"),wksExt=require("./_wks-ext"),defineProperty=require("./_object-dp").f;module.exports=function(name){var $Symbol=core.Symbol||(core.Symbol=LIBRARY?{}:global.Symbol||{});if(name.charAt(0)!="_"&&!(name in $Symbol))defineProperty($Symbol,name,{value:wksExt.f(name)})}},{"./_core":45,"./_global":60,"./_library":80,"./_object-dp":89,"./_wks-ext":138}],138:[function(require,module,exports){exports.f=require("./_wks")},{"./_wks":139}],139:[function(require,module,exports){var store=require("./_shared")("wks"),uid=require("./_uid"),Symbol=require("./_global").Symbol,USE_SYMBOL=typeof Symbol=="function";var $exports=module.exports=function(name){return store[name]||(store[name]=USE_SYMBOL&&Symbol[name]||(USE_SYMBOL?Symbol:uid)("Symbol."+name))};$exports.store=store},{"./_global":60,"./_shared":116,"./_uid":136}],140:[function(require,module,exports){var classof=require("./_classof"),ITERATOR=require("./_wks")("iterator"),Iterators=require("./_iterators");module.exports=require("./_core").getIteratorMethod=function(it){if(it!=undefined)return it[ITERATOR]||it["@@iterator"]||Iterators[classof(it)]}},{"./_classof":39,"./_core":45,"./_iterators":78,"./_wks":139}],141:[function(require,module,exports){var $export=require("./_export"),$re=require("./_replacer")(/[\\^$*+?.()|[\]{}]/g,"\\$&");$export($export.S,"RegExp",{escape:function escape(it){return $re(it)}})},{"./_export":54,"./_replacer":110}],142:[function(require,module,exports){var $export=require("./_export");$export($export.P,"Array",{copyWithin:require("./_array-copy-within")});require("./_add-to-unscopables")("copyWithin")},{"./_add-to-unscopables":27,"./_array-copy-within":30,"./_export":54}],143:[function(require,module,exports){"use strict";var $export=require("./_export"),$every=require("./_array-methods")(4);$export($export.P+$export.F*!require("./_strict-method")([].every,true),"Array",{every:function every(callbackfn){return $every(this,callbackfn,arguments[1])}})},{"./_array-methods":34,"./_export":54,"./_strict-method":118}],144:[function(require,module,exports){var $export=require("./_export");$export($export.P,"Array",{fill:require("./_array-fill")});require("./_add-to-unscopables")("fill")},{"./_add-to-unscopables":27,"./_array-fill":31,"./_export":54}],145:[function(require,module,exports){"use strict";var $export=require("./_export"),$filter=require("./_array-methods")(2);$export($export.P+$export.F*!require("./_strict-method")([].filter,true),"Array",{filter:function filter(callbackfn){return $filter(this,callbackfn,arguments[1])}})},{"./_array-methods":34,"./_export":54,"./_strict-method":118}],146:[function(require,module,exports){"use strict";var $export=require("./_export"),$find=require("./_array-methods")(6),KEY="findIndex",forced=true;if(KEY in[])Array(1)[KEY](function(){forced=false});$export($export.P+$export.F*forced,"Array",{findIndex:function findIndex(callbackfn){return $find(this,callbackfn,arguments.length>1?arguments[1]:undefined)}});require("./_add-to-unscopables")(KEY)},{"./_add-to-unscopables":27,"./_array-methods":34,"./_export":54}],147:[function(require,module,exports){"use strict";var $export=require("./_export"),$find=require("./_array-methods")(5),KEY="find",forced=true;if(KEY in[])Array(1)[KEY](function(){forced=false});$export($export.P+$export.F*forced,"Array",{find:function find(callbackfn){return $find(this,callbackfn,arguments.length>1?arguments[1]:undefined)}});require("./_add-to-unscopables")(KEY)},{"./_add-to-unscopables":27,"./_array-methods":34,"./_export":54}],148:[function(require,module,exports){"use strict";var $export=require("./_export"),$forEach=require("./_array-methods")(0),STRICT=require("./_strict-method")([].forEach,true);$export($export.P+$export.F*!STRICT,"Array",{forEach:function forEach(callbackfn){return $forEach(this,callbackfn,arguments[1])}})},{"./_array-methods":34,"./_export":54,"./_strict-method":118}],149:[function(require,module,exports){"use strict";var ctx=require("./_ctx"),$export=require("./_export"),toObject=require("./_to-object"),call=require("./_iter-call"),isArrayIter=require("./_is-array-iter"),toLength=require("./_to-length"),createProperty=require("./_create-property"),getIterFn=require("./core.get-iterator-method");$export($export.S+$export.F*!require("./_iter-detect")(function(iter){Array.from(iter)}),"Array",{from:function from(arrayLike){var O=toObject(arrayLike),C=typeof this=="function"?this:Array,aLen=arguments.length,mapfn=aLen>1?arguments[1]:undefined,mapping=mapfn!==undefined,index=0,iterFn=getIterFn(O),length,result,step,iterator;if(mapping)mapfn=ctx(mapfn,aLen>2?arguments[2]:undefined,2);
if(iterFn!=undefined&&!(C==Array&&isArrayIter(iterFn))){for(iterator=iterFn.call(O),result=new C;!(step=iterator.next()).done;index++){createProperty(result,index,mapping?call(iterator,mapfn,[step.value,index],true):step.value)}}else{length=toLength(O.length);for(result=new C(length);length>index;index++){createProperty(result,index,mapping?mapfn(O[index],index):O[index])}}result.length=index;return result}})},{"./_create-property":46,"./_ctx":47,"./_export":54,"./_is-array-iter":68,"./_iter-call":73,"./_iter-detect":76,"./_to-length":130,"./_to-object":131,"./core.get-iterator-method":140}],150:[function(require,module,exports){"use strict";var $export=require("./_export"),$indexOf=require("./_array-includes")(false),$native=[].indexOf,NEGATIVE_ZERO=!!$native&&1/[1].indexOf(1,-0)<0;$export($export.P+$export.F*(NEGATIVE_ZERO||!require("./_strict-method")($native)),"Array",{indexOf:function indexOf(searchElement){return NEGATIVE_ZERO?$native.apply(this,arguments)||0:$indexOf(this,searchElement,arguments[1])}})},{"./_array-includes":33,"./_export":54,"./_strict-method":118}],151:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Array",{isArray:require("./_is-array")})},{"./_export":54,"./_is-array":69}],152:[function(require,module,exports){"use strict";var addToUnscopables=require("./_add-to-unscopables"),step=require("./_iter-step"),Iterators=require("./_iterators"),toIObject=require("./_to-iobject");module.exports=require("./_iter-define")(Array,"Array",function(iterated,kind){this._t=toIObject(iterated);this._i=0;this._k=kind},function(){var O=this._t,kind=this._k,index=this._i++;if(!O||index>=O.length){this._t=undefined;return step(1)}if(kind=="keys")return step(0,index);if(kind=="values")return step(0,O[index]);return step(0,[index,O[index]])},"values");Iterators.Arguments=Iterators.Array;addToUnscopables("keys");addToUnscopables("values");addToUnscopables("entries")},{"./_add-to-unscopables":27,"./_iter-define":75,"./_iter-step":77,"./_iterators":78,"./_to-iobject":129}],153:[function(require,module,exports){"use strict";var $export=require("./_export"),toIObject=require("./_to-iobject"),arrayJoin=[].join;$export($export.P+$export.F*(require("./_iobject")!=Object||!require("./_strict-method")(arrayJoin)),"Array",{join:function join(separator){return arrayJoin.call(toIObject(this),separator===undefined?",":separator)}})},{"./_export":54,"./_iobject":67,"./_strict-method":118,"./_to-iobject":129}],154:[function(require,module,exports){"use strict";var $export=require("./_export"),toIObject=require("./_to-iobject"),toInteger=require("./_to-integer"),toLength=require("./_to-length"),$native=[].lastIndexOf,NEGATIVE_ZERO=!!$native&&1/[1].lastIndexOf(1,-0)<0;$export($export.P+$export.F*(NEGATIVE_ZERO||!require("./_strict-method")($native)),"Array",{lastIndexOf:function lastIndexOf(searchElement){if(NEGATIVE_ZERO)return $native.apply(this,arguments)||0;var O=toIObject(this),length=toLength(O.length),index=length-1;if(arguments.length>1)index=Math.min(index,toInteger(arguments[1]));if(index<0)index=length+index;for(;index>=0;index--)if(index in O)if(O[index]===searchElement)return index||0;return-1}})},{"./_export":54,"./_strict-method":118,"./_to-integer":128,"./_to-iobject":129,"./_to-length":130}],155:[function(require,module,exports){"use strict";var $export=require("./_export"),$map=require("./_array-methods")(1);$export($export.P+$export.F*!require("./_strict-method")([].map,true),"Array",{map:function map(callbackfn){return $map(this,callbackfn,arguments[1])}})},{"./_array-methods":34,"./_export":54,"./_strict-method":118}],156:[function(require,module,exports){"use strict";var $export=require("./_export"),createProperty=require("./_create-property");$export($export.S+$export.F*require("./_fails")(function(){function F(){}return!(Array.of.call(F)instanceof F)}),"Array",{of:function of(){var index=0,aLen=arguments.length,result=new(typeof this=="function"?this:Array)(aLen);while(aLen>index)createProperty(result,index,arguments[index++]);result.length=aLen;return result}})},{"./_create-property":46,"./_export":54,"./_fails":56}],157:[function(require,module,exports){"use strict";var $export=require("./_export"),$reduce=require("./_array-reduce");$export($export.P+$export.F*!require("./_strict-method")([].reduceRight,true),"Array",{reduceRight:function reduceRight(callbackfn){return $reduce(this,callbackfn,arguments.length,arguments[1],true)}})},{"./_array-reduce":35,"./_export":54,"./_strict-method":118}],158:[function(require,module,exports){"use strict";var $export=require("./_export"),$reduce=require("./_array-reduce");$export($export.P+$export.F*!require("./_strict-method")([].reduce,true),"Array",{reduce:function reduce(callbackfn){return $reduce(this,callbackfn,arguments.length,arguments[1],false)}})},{"./_array-reduce":35,"./_export":54,"./_strict-method":118}],159:[function(require,module,exports){"use strict";var $export=require("./_export"),html=require("./_html"),cof=require("./_cof"),toIndex=require("./_to-index"),toLength=require("./_to-length"),arraySlice=[].slice;$export($export.P+$export.F*require("./_fails")(function(){if(html)arraySlice.call(html)}),"Array",{slice:function slice(begin,end){var len=toLength(this.length),klass=cof(this);end=end===undefined?len:end;if(klass=="Array")return arraySlice.call(this,begin,end);var start=toIndex(begin,len),upTo=toIndex(end,len),size=toLength(upTo-start),cloned=Array(size),i=0;for(;i<size;i++)cloned[i]=klass=="String"?this.charAt(start+i):this[start+i];return cloned}})},{"./_cof":40,"./_export":54,"./_fails":56,"./_html":63,"./_to-index":127,"./_to-length":130}],160:[function(require,module,exports){"use strict";var $export=require("./_export"),$some=require("./_array-methods")(3);$export($export.P+$export.F*!require("./_strict-method")([].some,true),"Array",{some:function some(callbackfn){return $some(this,callbackfn,arguments[1])}})},{"./_array-methods":34,"./_export":54,"./_strict-method":118}],161:[function(require,module,exports){"use strict";var $export=require("./_export"),aFunction=require("./_a-function"),toObject=require("./_to-object"),fails=require("./_fails"),$sort=[].sort,test=[1,2,3];$export($export.P+$export.F*(fails(function(){test.sort(undefined)})||!fails(function(){test.sort(null)})||!require("./_strict-method")($sort)),"Array",{sort:function sort(comparefn){return comparefn===undefined?$sort.call(toObject(this)):$sort.call(toObject(this),aFunction(comparefn))}})},{"./_a-function":25,"./_export":54,"./_fails":56,"./_strict-method":118,"./_to-object":131}],162:[function(require,module,exports){require("./_set-species")("Array")},{"./_set-species":113}],163:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Date",{now:function(){return(new Date).getTime()}})},{"./_export":54}],164:[function(require,module,exports){"use strict";var $export=require("./_export"),fails=require("./_fails"),getTime=Date.prototype.getTime;var lz=function(num){return num>9?num:"0"+num};$export($export.P+$export.F*(fails(function(){return new Date(-5e13-1).toISOString()!="0385-07-25T07:06:39.999Z"})||!fails(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function toISOString(){if(!isFinite(getTime.call(this)))throw RangeError("Invalid time value");var d=this,y=d.getUTCFullYear(),m=d.getUTCMilliseconds(),s=y<0?"-":y>9999?"+":"";return s+("00000"+Math.abs(y)).slice(s?-6:-4)+"-"+lz(d.getUTCMonth()+1)+"-"+lz(d.getUTCDate())+"T"+lz(d.getUTCHours())+":"+lz(d.getUTCMinutes())+":"+lz(d.getUTCSeconds())+"."+(m>99?m:"0"+lz(m))+"Z"}})},{"./_export":54,"./_fails":56}],165:[function(require,module,exports){"use strict";var $export=require("./_export"),toObject=require("./_to-object"),toPrimitive=require("./_to-primitive");$export($export.P+$export.F*require("./_fails")(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1}),"Date",{toJSON:function toJSON(key){var O=toObject(this),pv=toPrimitive(O);return typeof pv=="number"&&!isFinite(pv)?null:O.toISOString()}})},{"./_export":54,"./_fails":56,"./_to-object":131,"./_to-primitive":132}],166:[function(require,module,exports){var TO_PRIMITIVE=require("./_wks")("toPrimitive"),proto=Date.prototype;if(!(TO_PRIMITIVE in proto))require("./_hide")(proto,TO_PRIMITIVE,require("./_date-to-primitive"))},{"./_date-to-primitive":48,"./_hide":62,"./_wks":139}],167:[function(require,module,exports){var DateProto=Date.prototype,INVALID_DATE="Invalid Date",TO_STRING="toString",$toString=DateProto[TO_STRING],getTime=DateProto.getTime;if(new Date(NaN)+""!=INVALID_DATE){require("./_redefine")(DateProto,TO_STRING,function toString(){var value=getTime.call(this);return value===value?$toString.call(this):INVALID_DATE})}},{"./_redefine":109}],168:[function(require,module,exports){var $export=require("./_export");$export($export.P,"Function",{bind:require("./_bind")})},{"./_bind":38,"./_export":54}],169:[function(require,module,exports){"use strict";var isObject=require("./_is-object"),getPrototypeOf=require("./_object-gpo"),HAS_INSTANCE=require("./_wks")("hasInstance"),FunctionProto=Function.prototype;if(!(HAS_INSTANCE in FunctionProto))require("./_object-dp").f(FunctionProto,HAS_INSTANCE,{value:function(O){if(typeof this!="function"||!isObject(O))return false;if(!isObject(this.prototype))return O instanceof this;while(O=getPrototypeOf(O))if(this.prototype===O)return true;return false}})},{"./_is-object":71,"./_object-dp":89,"./_object-gpo":96,"./_wks":139}],170:[function(require,module,exports){var dP=require("./_object-dp").f,createDesc=require("./_property-desc"),has=require("./_has"),FProto=Function.prototype,nameRE=/^\s*function ([^ (]*)/,NAME="name";var isExtensible=Object.isExtensible||function(){return true};NAME in FProto||require("./_descriptors")&&dP(FProto,NAME,{configurable:true,get:function(){try{var that=this,name=(""+that).match(nameRE)[1];has(that,NAME)||!isExtensible(that)||dP(that,NAME,createDesc(5,name));return name}catch(e){return""}}})},{"./_descriptors":50,"./_has":61,"./_object-dp":89,"./_property-desc":107}],171:[function(require,module,exports){"use strict";var strong=require("./_collection-strong");module.exports=require("./_collection")("Map",function(get){return function Map(){return get(this,arguments.length>0?arguments[0]:undefined)}},{get:function get(key){var entry=strong.getEntry(this,key);return entry&&entry.v},set:function set(key,value){return strong.def(this,key===0?0:key,value)}},strong,true)},{"./_collection":44,"./_collection-strong":41}],172:[function(require,module,exports){var $export=require("./_export"),log1p=require("./_math-log1p"),sqrt=Math.sqrt,$acosh=Math.acosh;$export($export.S+$export.F*!($acosh&&Math.floor($acosh(Number.MAX_VALUE))==710&&$acosh(Infinity)==Infinity),"Math",{acosh:function acosh(x){return(x=+x)<1?NaN:x>94906265.62425156?Math.log(x)+Math.LN2:log1p(x-1+sqrt(x-1)*sqrt(x+1))}})},{"./_export":54,"./_math-log1p":82}],173:[function(require,module,exports){var $export=require("./_export"),$asinh=Math.asinh;function asinh(x){return!isFinite(x=+x)||x==0?x:x<0?-asinh(-x):Math.log(x+Math.sqrt(x*x+1))}$export($export.S+$export.F*!($asinh&&1/$asinh(0)>0),"Math",{asinh:asinh})},{"./_export":54}],174:[function(require,module,exports){var $export=require("./_export"),$atanh=Math.atanh;$export($export.S+$export.F*!($atanh&&1/$atanh(-0)<0),"Math",{atanh:function atanh(x){return(x=+x)==0?x:Math.log((1+x)/(1-x))/2}})},{"./_export":54}],175:[function(require,module,exports){var $export=require("./_export"),sign=require("./_math-sign");$export($export.S,"Math",{cbrt:function cbrt(x){return sign(x=+x)*Math.pow(Math.abs(x),1/3)}})},{"./_export":54,"./_math-sign":83}],176:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{clz32:function clz32(x){return(x>>>=0)?31-Math.floor(Math.log(x+.5)*Math.LOG2E):32}})},{"./_export":54}],177:[function(require,module,exports){var $export=require("./_export"),exp=Math.exp;$export($export.S,"Math",{cosh:function cosh(x){return(exp(x=+x)+exp(-x))/2}})},{"./_export":54}],178:[function(require,module,exports){var $export=require("./_export"),$expm1=require("./_math-expm1");$export($export.S+$export.F*($expm1!=Math.expm1),"Math",{expm1:$expm1})},{"./_export":54,"./_math-expm1":81}],179:[function(require,module,exports){var $export=require("./_export"),sign=require("./_math-sign"),pow=Math.pow,EPSILON=pow(2,-52),EPSILON32=pow(2,-23),MAX32=pow(2,127)*(2-EPSILON32),MIN32=pow(2,-126);var roundTiesToEven=function(n){return n+1/EPSILON-1/EPSILON};$export($export.S,"Math",{fround:function fround(x){var $abs=Math.abs(x),$sign=sign(x),a,result;if($abs<MIN32)return $sign*roundTiesToEven($abs/MIN32/EPSILON32)*MIN32*EPSILON32;a=(1+EPSILON32/EPSILON)*$abs;result=a-(a-$abs);if(result>MAX32||result!=result)return $sign*Infinity;return $sign*result}})},{"./_export":54,"./_math-sign":83}],180:[function(require,module,exports){var $export=require("./_export"),abs=Math.abs;$export($export.S,"Math",{hypot:function hypot(value1,value2){var sum=0,i=0,aLen=arguments.length,larg=0,arg,div;while(i<aLen){arg=abs(arguments[i++]);if(larg<arg){div=larg/arg;sum=sum*div*div+1;larg=arg}else if(arg>0){div=arg/larg;sum+=div*div}else sum+=arg}return larg===Infinity?Infinity:larg*Math.sqrt(sum)}})},{"./_export":54}],181:[function(require,module,exports){var $export=require("./_export"),$imul=Math.imul;$export($export.S+$export.F*require("./_fails")(function(){return $imul(4294967295,5)!=-5||$imul.length!=2}),"Math",{imul:function imul(x,y){var UINT16=65535,xn=+x,yn=+y,xl=UINT16&xn,yl=UINT16&yn;return 0|xl*yl+((UINT16&xn>>>16)*yl+xl*(UINT16&yn>>>16)<<16>>>0)}})},{"./_export":54,"./_fails":56}],182:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{log10:function log10(x){return Math.log(x)/Math.LN10}})},{"./_export":54}],183:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{log1p:require("./_math-log1p")})},{"./_export":54,"./_math-log1p":82}],184:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{log2:function log2(x){return Math.log(x)/Math.LN2}})},{"./_export":54}],185:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{sign:require("./_math-sign")})},{"./_export":54,"./_math-sign":83}],186:[function(require,module,exports){var $export=require("./_export"),expm1=require("./_math-expm1"),exp=Math.exp;$export($export.S+$export.F*require("./_fails")(function(){return!Math.sinh(-2e-17)!=-2e-17}),"Math",{sinh:function sinh(x){return Math.abs(x=+x)<1?(expm1(x)-expm1(-x))/2:(exp(x-1)-exp(-x-1))*(Math.E/2)}})},{"./_export":54,"./_fails":56,"./_math-expm1":81}],187:[function(require,module,exports){var $export=require("./_export"),expm1=require("./_math-expm1"),exp=Math.exp;$export($export.S,"Math",{tanh:function tanh(x){var a=expm1(x=+x),b=expm1(-x);return a==Infinity?1:b==Infinity?-1:(a-b)/(exp(x)+exp(-x))}})},{"./_export":54,"./_math-expm1":81}],188:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{trunc:function trunc(it){return(it>0?Math.floor:Math.ceil)(it)}})},{"./_export":54}],189:[function(require,module,exports){"use strict";var global=require("./_global"),has=require("./_has"),cof=require("./_cof"),inheritIfRequired=require("./_inherit-if-required"),toPrimitive=require("./_to-primitive"),fails=require("./_fails"),gOPN=require("./_object-gopn").f,gOPD=require("./_object-gopd").f,dP=require("./_object-dp").f,$trim=require("./_string-trim").trim,NUMBER="Number",$Number=global[NUMBER],Base=$Number,proto=$Number.prototype,BROKEN_COF=cof(require("./_object-create")(proto))==NUMBER,TRIM="trim"in String.prototype;var toNumber=function(argument){var it=toPrimitive(argument,false);if(typeof it=="string"&&it.length>2){it=TRIM?it.trim():$trim(it,3);var first=it.charCodeAt(0),third,radix,maxCode;if(first===43||first===45){third=it.charCodeAt(2);if(third===88||third===120)return NaN}else if(first===48){switch(it.charCodeAt(1)){case 66:case 98:radix=2;maxCode=49;break;case 79:case 111:radix=8;maxCode=55;break;default:return+it}for(var digits=it.slice(2),i=0,l=digits.length,code;i<l;i++){code=digits.charCodeAt(i);if(code<48||code>maxCode)return NaN}return parseInt(digits,radix)}}return+it};if(!$Number(" 0o1")||!$Number("0b1")||$Number("+0x1")){$Number=function Number(value){var it=arguments.length<1?0:value,that=this;return that instanceof $Number&&(BROKEN_COF?fails(function(){proto.valueOf.call(that)}):cof(that)!=NUMBER)?inheritIfRequired(new Base(toNumber(it)),that,$Number):toNumber(it)};for(var keys=require("./_descriptors")?gOPN(Base):("MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,"+"EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,"+"MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger").split(","),j=0,key;keys.length>j;j++){if(has(Base,key=keys[j])&&!has($Number,key)){dP($Number,key,gOPD(Base,key))}}$Number.prototype=proto;proto.constructor=$Number;require("./_redefine")(global,NUMBER,$Number)}},{"./_cof":40,"./_descriptors":50,"./_fails":56,"./_global":60,"./_has":61,"./_inherit-if-required":65,"./_object-create":88,"./_object-dp":89,"./_object-gopd":92,"./_object-gopn":94,"./_redefine":109,"./_string-trim":124,"./_to-primitive":132}],190:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Number",{EPSILON:Math.pow(2,-52)})},{"./_export":54}],191:[function(require,module,exports){var $export=require("./_export"),_isFinite=require("./_global").isFinite;$export($export.S,"Number",{isFinite:function isFinite(it){return typeof it=="number"&&_isFinite(it)}})},{"./_export":54,"./_global":60}],192:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Number",{isInteger:require("./_is-integer")})},{"./_export":54,"./_is-integer":70}],193:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Number",{isNaN:function isNaN(number){return number!=number}})},{"./_export":54}],194:[function(require,module,exports){var $export=require("./_export"),isInteger=require("./_is-integer"),abs=Math.abs;$export($export.S,"Number",{isSafeInteger:function isSafeInteger(number){return isInteger(number)&&abs(number)<=9007199254740991}})},{"./_export":54,"./_is-integer":70}],195:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},{"./_export":54}],196:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},{"./_export":54}],197:[function(require,module,exports){var $export=require("./_export"),$parseFloat=require("./_parse-float");$export($export.S+$export.F*(Number.parseFloat!=$parseFloat),"Number",{parseFloat:$parseFloat})},{"./_export":54,"./_parse-float":103}],198:[function(require,module,exports){var $export=require("./_export"),$parseInt=require("./_parse-int");$export($export.S+$export.F*(Number.parseInt!=$parseInt),"Number",{parseInt:$parseInt})},{"./_export":54,"./_parse-int":104}],199:[function(require,module,exports){"use strict";var $export=require("./_export"),toInteger=require("./_to-integer"),aNumberValue=require("./_a-number-value"),repeat=require("./_string-repeat"),$toFixed=1..toFixed,floor=Math.floor,data=[0,0,0,0,0,0],ERROR="Number.toFixed: incorrect invocation!",ZERO="0";var multiply=function(n,c){var i=-1,c2=c;while(++i<6){c2+=n*data[i];data[i]=c2%1e7;c2=floor(c2/1e7)}};var divide=function(n){var i=6,c=0;while(--i>=0){c+=data[i];data[i]=floor(c/n);c=c%n*1e7}};var numToString=function(){var i=6,s="";while(--i>=0){if(s!==""||i===0||data[i]!==0){var t=String(data[i]);s=s===""?t:s+repeat.call(ZERO,7-t.length)+t}}return s};var pow=function(x,n,acc){return n===0?acc:n%2===1?pow(x,n-1,acc*x):pow(x*x,n/2,acc)};var log=function(x){var n=0,x2=x;while(x2>=4096){n+=12;x2/=4096}while(x2>=2){n+=1;x2/=2}return n};$export($export.P+$export.F*(!!$toFixed&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||(0xde0b6b3a7640080).toFixed(0)!=="1000000000000000128")||!require("./_fails")(function(){$toFixed.call({})})),"Number",{toFixed:function toFixed(fractionDigits){var x=aNumberValue(this,ERROR),f=toInteger(fractionDigits),s="",m=ZERO,e,z,j,k;if(f<0||f>20)throw RangeError(ERROR);if(x!=x)return"NaN";if(x<=-1e21||x>=1e21)return String(x);if(x<0){s="-";x=-x}if(x>1e-21){e=log(x*pow(2,69,1))-69;z=e<0?x*pow(2,-e,1):x/pow(2,e,1);z*=4503599627370496;e=52-e;if(e>0){multiply(0,z);j=f;while(j>=7){multiply(1e7,0);j-=7}multiply(pow(10,j,1),0);j=e-1;while(j>=23){divide(1<<23);j-=23}divide(1<<j);multiply(1,1);divide(2);m=numToString()}else{multiply(0,z);multiply(1<<-e,0);m=numToString()+repeat.call(ZERO,f)}}if(f>0){k=m.length;m=s+(k<=f?"0."+repeat.call(ZERO,f-k)+m:m.slice(0,k-f)+"."+m.slice(k-f))}else{m=s+m}return m}})},{"./_a-number-value":26,"./_export":54,"./_fails":56,"./_string-repeat":123,"./_to-integer":128}],200:[function(require,module,exports){"use strict";var $export=require("./_export"),$fails=require("./_fails"),aNumberValue=require("./_a-number-value"),$toPrecision=1..toPrecision;$export($export.P+$export.F*($fails(function(){return $toPrecision.call(1,undefined)!=="1"})||!$fails(function(){$toPrecision.call({})})),"Number",{toPrecision:function toPrecision(precision){var that=aNumberValue(this,"Number#toPrecision: incorrect invocation!");return precision===undefined?$toPrecision.call(that):$toPrecision.call(that,precision)}})},{"./_a-number-value":26,"./_export":54,"./_fails":56}],201:[function(require,module,exports){var $export=require("./_export");$export($export.S+$export.F,"Object",{assign:require("./_object-assign")})},{"./_export":54,"./_object-assign":87}],202:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Object",{create:require("./_object-create")})},{"./_export":54,"./_object-create":88}],203:[function(require,module,exports){var $export=require("./_export");$export($export.S+$export.F*!require("./_descriptors"),"Object",{defineProperties:require("./_object-dps")})},{"./_descriptors":50,"./_export":54,"./_object-dps":90}],204:[function(require,module,exports){var $export=require("./_export");$export($export.S+$export.F*!require("./_descriptors"),"Object",{defineProperty:require("./_object-dp").f})},{"./_descriptors":50,"./_export":54,"./_object-dp":89}],205:[function(require,module,exports){var isObject=require("./_is-object"),meta=require("./_meta").onFreeze;require("./_object-sap")("freeze",function($freeze){return function freeze(it){return $freeze&&isObject(it)?$freeze(meta(it)):it}})},{"./_is-object":71,"./_meta":84,"./_object-sap":100}],206:[function(require,module,exports){var toIObject=require("./_to-iobject"),$getOwnPropertyDescriptor=require("./_object-gopd").f;require("./_object-sap")("getOwnPropertyDescriptor",function(){return function getOwnPropertyDescriptor(it,key){return $getOwnPropertyDescriptor(toIObject(it),key)}})},{"./_object-gopd":92,"./_object-sap":100,"./_to-iobject":129}],207:[function(require,module,exports){require("./_object-sap")("getOwnPropertyNames",function(){return require("./_object-gopn-ext").f})},{"./_object-gopn-ext":93,"./_object-sap":100}],208:[function(require,module,exports){var toObject=require("./_to-object"),$getPrototypeOf=require("./_object-gpo");require("./_object-sap")("getPrototypeOf",function(){return function getPrototypeOf(it){return $getPrototypeOf(toObject(it))}})},{"./_object-gpo":96,"./_object-sap":100,"./_to-object":131}],209:[function(require,module,exports){var isObject=require("./_is-object");require("./_object-sap")("isExtensible",function($isExtensible){return function isExtensible(it){return isObject(it)?$isExtensible?$isExtensible(it):true:false}})},{"./_is-object":71,"./_object-sap":100}],210:[function(require,module,exports){var isObject=require("./_is-object");require("./_object-sap")("isFrozen",function($isFrozen){return function isFrozen(it){return isObject(it)?$isFrozen?$isFrozen(it):false:true}})},{"./_is-object":71,"./_object-sap":100}],211:[function(require,module,exports){var isObject=require("./_is-object");require("./_object-sap")("isSealed",function($isSealed){return function isSealed(it){return isObject(it)?$isSealed?$isSealed(it):false:true}})},{"./_is-object":71,"./_object-sap":100}],212:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Object",{is:require("./_same-value")})},{"./_export":54,"./_same-value":111}],213:[function(require,module,exports){var toObject=require("./_to-object"),$keys=require("./_object-keys");require("./_object-sap")("keys",function(){return function keys(it){return $keys(toObject(it))}})},{"./_object-keys":98,"./_object-sap":100,"./_to-object":131}],214:[function(require,module,exports){var isObject=require("./_is-object"),meta=require("./_meta").onFreeze;require("./_object-sap")("preventExtensions",function($preventExtensions){return function preventExtensions(it){return $preventExtensions&&isObject(it)?$preventExtensions(meta(it)):it}})},{"./_is-object":71,"./_meta":84,"./_object-sap":100}],215:[function(require,module,exports){var isObject=require("./_is-object"),meta=require("./_meta").onFreeze;require("./_object-sap")("seal",function($seal){return function seal(it){return $seal&&isObject(it)?$seal(meta(it)):it}})},{"./_is-object":71,"./_meta":84,"./_object-sap":100}],216:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Object",{setPrototypeOf:require("./_set-proto").set})},{"./_export":54,"./_set-proto":112}],217:[function(require,module,exports){"use strict";var classof=require("./_classof"),test={};test[require("./_wks")("toStringTag")]="z";if(test+""!="[object z]"){require("./_redefine")(Object.prototype,"toString",function toString(){return"[object "+classof(this)+"]"},true)}},{"./_classof":39,"./_redefine":109,"./_wks":139}],218:[function(require,module,exports){var $export=require("./_export"),$parseFloat=require("./_parse-float");$export($export.G+$export.F*(parseFloat!=$parseFloat),{parseFloat:$parseFloat})},{"./_export":54,"./_parse-float":103}],219:[function(require,module,exports){var $export=require("./_export"),$parseInt=require("./_parse-int");$export($export.G+$export.F*(parseInt!=$parseInt),{parseInt:$parseInt})},{"./_export":54,"./_parse-int":104}],220:[function(require,module,exports){"use strict";var LIBRARY=require("./_library"),global=require("./_global"),ctx=require("./_ctx"),classof=require("./_classof"),$export=require("./_export"),isObject=require("./_is-object"),aFunction=require("./_a-function"),anInstance=require("./_an-instance"),forOf=require("./_for-of"),speciesConstructor=require("./_species-constructor"),task=require("./_task").set,microtask=require("./_microtask")(),PROMISE="Promise",TypeError=global.TypeError,process=global.process,$Promise=global[PROMISE],process=global.process,isNode=classof(process)=="process",empty=function(){},Internal,GenericPromiseCapability,Wrapper;var USE_NATIVE=!!function(){try{var promise=$Promise.resolve(1),FakePromise=(promise.constructor={})[require("./_wks")("species")]=function(exec){exec(empty,empty)};return(isNode||typeof PromiseRejectionEvent=="function")&&promise.then(empty)instanceof FakePromise}catch(e){}}();var sameConstructor=function(a,b){return a===b||a===$Promise&&b===Wrapper};var isThenable=function(it){var then;return isObject(it)&&typeof(then=it.then)=="function"?then:false};var newPromiseCapability=function(C){return sameConstructor($Promise,C)?new PromiseCapability(C):new GenericPromiseCapability(C)};var PromiseCapability=GenericPromiseCapability=function(C){var resolve,reject;this.promise=new C(function($$resolve,$$reject){if(resolve!==undefined||reject!==undefined)throw TypeError("Bad Promise constructor");resolve=$$resolve;reject=$$reject});this.resolve=aFunction(resolve);this.reject=aFunction(reject)};var perform=function(exec){try{exec()}catch(e){return{error:e}}};var notify=function(promise,isReject){if(promise._n)return;promise._n=true;var chain=promise._c;microtask(function(){var value=promise._v,ok=promise._s==1,i=0;var run=function(reaction){var handler=ok?reaction.ok:reaction.fail,resolve=reaction.resolve,reject=reaction.reject,domain=reaction.domain,result,then;try{if(handler){if(!ok){if(promise._h==2)onHandleUnhandled(promise);promise._h=1}if(handler===true)result=value;else{if(domain)domain.enter();result=handler(value);if(domain)domain.exit()}if(result===reaction.promise){reject(TypeError("Promise-chain cycle"))}else if(then=isThenable(result)){then.call(result,resolve,reject)}else resolve(result)}else reject(value)}catch(e){reject(e)}};while(chain.length>i)run(chain[i++]);promise._c=[];promise._n=false;if(isReject&&!promise._h)onUnhandled(promise)})};var onUnhandled=function(promise){task.call(global,function(){var value=promise._v,abrupt,handler,console;if(isUnhandled(promise)){abrupt=perform(function(){if(isNode){process.emit("unhandledRejection",value,promise)}else if(handler=global.onunhandledrejection){handler({promise:promise,reason:value})}else if((console=global.console)&&console.error){console.error("Unhandled promise rejection",value)}});promise._h=isNode||isUnhandled(promise)?2:1}promise._a=undefined;if(abrupt)throw abrupt.error})};var isUnhandled=function(promise){if(promise._h==1)return false;var chain=promise._a||promise._c,i=0,reaction;while(chain.length>i){reaction=chain[i++];if(reaction.fail||!isUnhandled(reaction.promise))return false}return true};var onHandleUnhandled=function(promise){task.call(global,function(){var handler;if(isNode){process.emit("rejectionHandled",promise)}else if(handler=global.onrejectionhandled){handler({promise:promise,reason:promise._v})}})};var $reject=function(value){var promise=this;if(promise._d)return;promise._d=true;promise=promise._w||promise;promise._v=value;promise._s=2;if(!promise._a)promise._a=promise._c.slice();notify(promise,true)};var $resolve=function(value){var promise=this,then;if(promise._d)return;promise._d=true;promise=promise._w||promise;try{if(promise===value)throw TypeError("Promise can't be resolved itself");if(then=isThenable(value)){microtask(function(){var wrapper={_w:promise,_d:false};try{then.call(value,ctx($resolve,wrapper,1),ctx($reject,wrapper,1))}catch(e){$reject.call(wrapper,e)}})}else{promise._v=value;promise._s=1;notify(promise,false)}}catch(e){$reject.call({_w:promise,_d:false},e)}};if(!USE_NATIVE){$Promise=function Promise(executor){anInstance(this,$Promise,PROMISE,"_h");aFunction(executor);Internal.call(this);try{executor(ctx($resolve,this,1),ctx($reject,this,1))}catch(err){$reject.call(this,err)}};Internal=function Promise(executor){this._c=[];this._a=undefined;this._s=0;this._d=false;this._v=undefined;this._h=0;this._n=false};Internal.prototype=require("./_redefine-all")($Promise.prototype,{then:function then(onFulfilled,onRejected){var reaction=newPromiseCapability(speciesConstructor(this,$Promise));reaction.ok=typeof onFulfilled=="function"?onFulfilled:true;reaction.fail=typeof onRejected=="function"&&onRejected;reaction.domain=isNode?process.domain:undefined;this._c.push(reaction);if(this._a)this._a.push(reaction);if(this._s)notify(this,false);return reaction.promise},catch:function(onRejected){return this.then(undefined,onRejected)}});PromiseCapability=function(){var promise=new Internal;this.promise=promise;this.resolve=ctx($resolve,promise,1);this.reject=ctx($reject,promise,1)}}$export($export.G+$export.W+$export.F*!USE_NATIVE,{Promise:$Promise});require("./_set-to-string-tag")($Promise,PROMISE);require("./_set-species")(PROMISE);Wrapper=require("./_core")[PROMISE];$export($export.S+$export.F*!USE_NATIVE,PROMISE,{reject:function reject(r){var capability=newPromiseCapability(this),$$reject=capability.reject;$$reject(r);return capability.promise}});$export($export.S+$export.F*(LIBRARY||!USE_NATIVE),PROMISE,{
resolve:function resolve(x){if(x instanceof $Promise&&sameConstructor(x.constructor,this))return x;var capability=newPromiseCapability(this),$$resolve=capability.resolve;$$resolve(x);return capability.promise}});$export($export.S+$export.F*!(USE_NATIVE&&require("./_iter-detect")(function(iter){$Promise.all(iter)["catch"](empty)})),PROMISE,{all:function all(iterable){var C=this,capability=newPromiseCapability(C),resolve=capability.resolve,reject=capability.reject;var abrupt=perform(function(){var values=[],index=0,remaining=1;forOf(iterable,false,function(promise){var $index=index++,alreadyCalled=false;values.push(undefined);remaining++;C.resolve(promise).then(function(value){if(alreadyCalled)return;alreadyCalled=true;values[$index]=value;--remaining||resolve(values)},reject)});--remaining||resolve(values)});if(abrupt)reject(abrupt.error);return capability.promise},race:function race(iterable){var C=this,capability=newPromiseCapability(C),reject=capability.reject;var abrupt=perform(function(){forOf(iterable,false,function(promise){C.resolve(promise).then(capability.resolve,reject)})});if(abrupt)reject(abrupt.error);return capability.promise}})},{"./_a-function":25,"./_an-instance":28,"./_classof":39,"./_core":45,"./_ctx":47,"./_export":54,"./_for-of":59,"./_global":60,"./_is-object":71,"./_iter-detect":76,"./_library":80,"./_microtask":86,"./_redefine-all":108,"./_set-species":113,"./_set-to-string-tag":114,"./_species-constructor":117,"./_task":126,"./_wks":139}],221:[function(require,module,exports){var $export=require("./_export"),aFunction=require("./_a-function"),anObject=require("./_an-object"),rApply=(require("./_global").Reflect||{}).apply,fApply=Function.apply;$export($export.S+$export.F*!require("./_fails")(function(){rApply(function(){})}),"Reflect",{apply:function apply(target,thisArgument,argumentsList){var T=aFunction(target),L=anObject(argumentsList);return rApply?rApply(T,thisArgument,L):fApply.call(T,thisArgument,L)}})},{"./_a-function":25,"./_an-object":29,"./_export":54,"./_fails":56,"./_global":60}],222:[function(require,module,exports){var $export=require("./_export"),create=require("./_object-create"),aFunction=require("./_a-function"),anObject=require("./_an-object"),isObject=require("./_is-object"),fails=require("./_fails"),bind=require("./_bind"),rConstruct=(require("./_global").Reflect||{}).construct;var NEW_TARGET_BUG=fails(function(){function F(){}return!(rConstruct(function(){},[],F)instanceof F)});var ARGS_BUG=!fails(function(){rConstruct(function(){})});$export($export.S+$export.F*(NEW_TARGET_BUG||ARGS_BUG),"Reflect",{construct:function construct(Target,args){aFunction(Target);anObject(args);var newTarget=arguments.length<3?Target:aFunction(arguments[2]);if(ARGS_BUG&&!NEW_TARGET_BUG)return rConstruct(Target,args,newTarget);if(Target==newTarget){switch(args.length){case 0:return new Target;case 1:return new Target(args[0]);case 2:return new Target(args[0],args[1]);case 3:return new Target(args[0],args[1],args[2]);case 4:return new Target(args[0],args[1],args[2],args[3])}var $args=[null];$args.push.apply($args,args);return new(bind.apply(Target,$args))}var proto=newTarget.prototype,instance=create(isObject(proto)?proto:Object.prototype),result=Function.apply.call(Target,instance,args);return isObject(result)?result:instance}})},{"./_a-function":25,"./_an-object":29,"./_bind":38,"./_export":54,"./_fails":56,"./_global":60,"./_is-object":71,"./_object-create":88}],223:[function(require,module,exports){var dP=require("./_object-dp"),$export=require("./_export"),anObject=require("./_an-object"),toPrimitive=require("./_to-primitive");$export($export.S+$export.F*require("./_fails")(function(){Reflect.defineProperty(dP.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function defineProperty(target,propertyKey,attributes){anObject(target);propertyKey=toPrimitive(propertyKey,true);anObject(attributes);try{dP.f(target,propertyKey,attributes);return true}catch(e){return false}}})},{"./_an-object":29,"./_export":54,"./_fails":56,"./_object-dp":89,"./_to-primitive":132}],224:[function(require,module,exports){var $export=require("./_export"),gOPD=require("./_object-gopd").f,anObject=require("./_an-object");$export($export.S,"Reflect",{deleteProperty:function deleteProperty(target,propertyKey){var desc=gOPD(anObject(target),propertyKey);return desc&&!desc.configurable?false:delete target[propertyKey]}})},{"./_an-object":29,"./_export":54,"./_object-gopd":92}],225:[function(require,module,exports){"use strict";var $export=require("./_export"),anObject=require("./_an-object");var Enumerate=function(iterated){this._t=anObject(iterated);this._i=0;var keys=this._k=[],key;for(key in iterated)keys.push(key)};require("./_iter-create")(Enumerate,"Object",function(){var that=this,keys=that._k,key;do{if(that._i>=keys.length)return{value:undefined,done:true}}while(!((key=keys[that._i++])in that._t));return{value:key,done:false}});$export($export.S,"Reflect",{enumerate:function enumerate(target){return new Enumerate(target)}})},{"./_an-object":29,"./_export":54,"./_iter-create":74}],226:[function(require,module,exports){var gOPD=require("./_object-gopd"),$export=require("./_export"),anObject=require("./_an-object");$export($export.S,"Reflect",{getOwnPropertyDescriptor:function getOwnPropertyDescriptor(target,propertyKey){return gOPD.f(anObject(target),propertyKey)}})},{"./_an-object":29,"./_export":54,"./_object-gopd":92}],227:[function(require,module,exports){var $export=require("./_export"),getProto=require("./_object-gpo"),anObject=require("./_an-object");$export($export.S,"Reflect",{getPrototypeOf:function getPrototypeOf(target){return getProto(anObject(target))}})},{"./_an-object":29,"./_export":54,"./_object-gpo":96}],228:[function(require,module,exports){var gOPD=require("./_object-gopd"),getPrototypeOf=require("./_object-gpo"),has=require("./_has"),$export=require("./_export"),isObject=require("./_is-object"),anObject=require("./_an-object");function get(target,propertyKey){var receiver=arguments.length<3?target:arguments[2],desc,proto;if(anObject(target)===receiver)return target[propertyKey];if(desc=gOPD.f(target,propertyKey))return has(desc,"value")?desc.value:desc.get!==undefined?desc.get.call(receiver):undefined;if(isObject(proto=getPrototypeOf(target)))return get(proto,propertyKey,receiver)}$export($export.S,"Reflect",{get:get})},{"./_an-object":29,"./_export":54,"./_has":61,"./_is-object":71,"./_object-gopd":92,"./_object-gpo":96}],229:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Reflect",{has:function has(target,propertyKey){return propertyKey in target}})},{"./_export":54}],230:[function(require,module,exports){var $export=require("./_export"),anObject=require("./_an-object"),$isExtensible=Object.isExtensible;$export($export.S,"Reflect",{isExtensible:function isExtensible(target){anObject(target);return $isExtensible?$isExtensible(target):true}})},{"./_an-object":29,"./_export":54}],231:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Reflect",{ownKeys:require("./_own-keys")})},{"./_export":54,"./_own-keys":102}],232:[function(require,module,exports){var $export=require("./_export"),anObject=require("./_an-object"),$preventExtensions=Object.preventExtensions;$export($export.S,"Reflect",{preventExtensions:function preventExtensions(target){anObject(target);try{if($preventExtensions)$preventExtensions(target);return true}catch(e){return false}}})},{"./_an-object":29,"./_export":54}],233:[function(require,module,exports){var $export=require("./_export"),setProto=require("./_set-proto");if(setProto)$export($export.S,"Reflect",{setPrototypeOf:function setPrototypeOf(target,proto){setProto.check(target,proto);try{setProto.set(target,proto);return true}catch(e){return false}}})},{"./_export":54,"./_set-proto":112}],234:[function(require,module,exports){var dP=require("./_object-dp"),gOPD=require("./_object-gopd"),getPrototypeOf=require("./_object-gpo"),has=require("./_has"),$export=require("./_export"),createDesc=require("./_property-desc"),anObject=require("./_an-object"),isObject=require("./_is-object");function set(target,propertyKey,V){var receiver=arguments.length<4?target:arguments[3],ownDesc=gOPD.f(anObject(target),propertyKey),existingDescriptor,proto;if(!ownDesc){if(isObject(proto=getPrototypeOf(target))){return set(proto,propertyKey,V,receiver)}ownDesc=createDesc(0)}if(has(ownDesc,"value")){if(ownDesc.writable===false||!isObject(receiver))return false;existingDescriptor=gOPD.f(receiver,propertyKey)||createDesc(0);existingDescriptor.value=V;dP.f(receiver,propertyKey,existingDescriptor);return true}return ownDesc.set===undefined?false:(ownDesc.set.call(receiver,V),true)}$export($export.S,"Reflect",{set:set})},{"./_an-object":29,"./_export":54,"./_has":61,"./_is-object":71,"./_object-dp":89,"./_object-gopd":92,"./_object-gpo":96,"./_property-desc":107}],235:[function(require,module,exports){var global=require("./_global"),inheritIfRequired=require("./_inherit-if-required"),dP=require("./_object-dp").f,gOPN=require("./_object-gopn").f,isRegExp=require("./_is-regexp"),$flags=require("./_flags"),$RegExp=global.RegExp,Base=$RegExp,proto=$RegExp.prototype,re1=/a/g,re2=/a/g,CORRECT_NEW=new $RegExp(re1)!==re1;if(require("./_descriptors")&&(!CORRECT_NEW||require("./_fails")(function(){re2[require("./_wks")("match")]=false;return $RegExp(re1)!=re1||$RegExp(re2)==re2||$RegExp(re1,"i")!="/a/i"}))){$RegExp=function RegExp(p,f){var tiRE=this instanceof $RegExp,piRE=isRegExp(p),fiU=f===undefined;return!tiRE&&piRE&&p.constructor===$RegExp&&fiU?p:inheritIfRequired(CORRECT_NEW?new Base(piRE&&!fiU?p.source:p,f):Base((piRE=p instanceof $RegExp)?p.source:p,piRE&&fiU?$flags.call(p):f),tiRE?this:proto,$RegExp)};var proxy=function(key){key in $RegExp||dP($RegExp,key,{configurable:true,get:function(){return Base[key]},set:function(it){Base[key]=it}})};for(var keys=gOPN(Base),i=0;keys.length>i;)proxy(keys[i++]);proto.constructor=$RegExp;$RegExp.prototype=proto;require("./_redefine")(global,"RegExp",$RegExp)}require("./_set-species")("RegExp")},{"./_descriptors":50,"./_fails":56,"./_flags":58,"./_global":60,"./_inherit-if-required":65,"./_is-regexp":72,"./_object-dp":89,"./_object-gopn":94,"./_redefine":109,"./_set-species":113,"./_wks":139}],236:[function(require,module,exports){if(require("./_descriptors")&&/./g.flags!="g")require("./_object-dp").f(RegExp.prototype,"flags",{configurable:true,get:require("./_flags")})},{"./_descriptors":50,"./_flags":58,"./_object-dp":89}],237:[function(require,module,exports){require("./_fix-re-wks")("match",1,function(defined,MATCH,$match){return[function match(regexp){"use strict";var O=defined(this),fn=regexp==undefined?undefined:regexp[MATCH];return fn!==undefined?fn.call(regexp,O):new RegExp(regexp)[MATCH](String(O))},$match]})},{"./_fix-re-wks":57}],238:[function(require,module,exports){require("./_fix-re-wks")("replace",2,function(defined,REPLACE,$replace){return[function replace(searchValue,replaceValue){"use strict";var O=defined(this),fn=searchValue==undefined?undefined:searchValue[REPLACE];return fn!==undefined?fn.call(searchValue,O,replaceValue):$replace.call(String(O),searchValue,replaceValue)},$replace]})},{"./_fix-re-wks":57}],239:[function(require,module,exports){require("./_fix-re-wks")("search",1,function(defined,SEARCH,$search){return[function search(regexp){"use strict";var O=defined(this),fn=regexp==undefined?undefined:regexp[SEARCH];return fn!==undefined?fn.call(regexp,O):new RegExp(regexp)[SEARCH](String(O))},$search]})},{"./_fix-re-wks":57}],240:[function(require,module,exports){require("./_fix-re-wks")("split",2,function(defined,SPLIT,$split){"use strict";var isRegExp=require("./_is-regexp"),_split=$split,$push=[].push,$SPLIT="split",LENGTH="length",LAST_INDEX="lastIndex";if("abbc"[$SPLIT](/(b)*/)[1]=="c"||"test"[$SPLIT](/(?:)/,-1)[LENGTH]!=4||"ab"[$SPLIT](/(?:ab)*/)[LENGTH]!=2||"."[$SPLIT](/(.?)(.?)/)[LENGTH]!=4||"."[$SPLIT](/()()/)[LENGTH]>1||""[$SPLIT](/.?/)[LENGTH]){var NPCG=/()??/.exec("")[1]===undefined;$split=function(separator,limit){var string=String(this);if(separator===undefined&&limit===0)return[];if(!isRegExp(separator))return _split.call(string,separator,limit);var output=[];var flags=(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")+(separator.unicode?"u":"")+(separator.sticky?"y":"");var lastLastIndex=0;var splitLimit=limit===undefined?4294967295:limit>>>0;var separatorCopy=new RegExp(separator.source,flags+"g");var separator2,match,lastIndex,lastLength,i;if(!NPCG)separator2=new RegExp("^"+separatorCopy.source+"$(?!\\s)",flags);while(match=separatorCopy.exec(string)){lastIndex=match.index+match[0][LENGTH];if(lastIndex>lastLastIndex){output.push(string.slice(lastLastIndex,match.index));if(!NPCG&&match[LENGTH]>1)match[0].replace(separator2,function(){for(i=1;i<arguments[LENGTH]-2;i++)if(arguments[i]===undefined)match[i]=undefined});if(match[LENGTH]>1&&match.index<string[LENGTH])$push.apply(output,match.slice(1));lastLength=match[0][LENGTH];lastLastIndex=lastIndex;if(output[LENGTH]>=splitLimit)break}if(separatorCopy[LAST_INDEX]===match.index)separatorCopy[LAST_INDEX]++}if(lastLastIndex===string[LENGTH]){if(lastLength||!separatorCopy.test(""))output.push("")}else output.push(string.slice(lastLastIndex));return output[LENGTH]>splitLimit?output.slice(0,splitLimit):output}}else if("0"[$SPLIT](undefined,0)[LENGTH]){$split=function(separator,limit){return separator===undefined&&limit===0?[]:_split.call(this,separator,limit)}}return[function split(separator,limit){var O=defined(this),fn=separator==undefined?undefined:separator[SPLIT];return fn!==undefined?fn.call(separator,O,limit):$split.call(String(O),separator,limit)},$split]})},{"./_fix-re-wks":57,"./_is-regexp":72}],241:[function(require,module,exports){"use strict";require("./es6.regexp.flags");var anObject=require("./_an-object"),$flags=require("./_flags"),DESCRIPTORS=require("./_descriptors"),TO_STRING="toString",$toString=/./[TO_STRING];var define=function(fn){require("./_redefine")(RegExp.prototype,TO_STRING,fn,true)};if(require("./_fails")(function(){return $toString.call({source:"a",flags:"b"})!="/a/b"})){define(function toString(){var R=anObject(this);return"/".concat(R.source,"/","flags"in R?R.flags:!DESCRIPTORS&&R instanceof RegExp?$flags.call(R):undefined)})}else if($toString.name!=TO_STRING){define(function toString(){return $toString.call(this)})}},{"./_an-object":29,"./_descriptors":50,"./_fails":56,"./_flags":58,"./_redefine":109,"./es6.regexp.flags":236}],242:[function(require,module,exports){"use strict";var strong=require("./_collection-strong");module.exports=require("./_collection")("Set",function(get){return function Set(){return get(this,arguments.length>0?arguments[0]:undefined)}},{add:function add(value){return strong.def(this,value=value===0?0:value,value)}},strong)},{"./_collection":44,"./_collection-strong":41}],243:[function(require,module,exports){"use strict";require("./_string-html")("anchor",function(createHTML){return function anchor(name){return createHTML(this,"a","name",name)}})},{"./_string-html":121}],244:[function(require,module,exports){"use strict";require("./_string-html")("big",function(createHTML){return function big(){return createHTML(this,"big","","")}})},{"./_string-html":121}],245:[function(require,module,exports){"use strict";require("./_string-html")("blink",function(createHTML){return function blink(){return createHTML(this,"blink","","")}})},{"./_string-html":121}],246:[function(require,module,exports){"use strict";require("./_string-html")("bold",function(createHTML){return function bold(){return createHTML(this,"b","","")}})},{"./_string-html":121}],247:[function(require,module,exports){"use strict";var $export=require("./_export"),$at=require("./_string-at")(false);$export($export.P,"String",{codePointAt:function codePointAt(pos){return $at(this,pos)}})},{"./_export":54,"./_string-at":119}],248:[function(require,module,exports){"use strict";var $export=require("./_export"),toLength=require("./_to-length"),context=require("./_string-context"),ENDS_WITH="endsWith",$endsWith=""[ENDS_WITH];$export($export.P+$export.F*require("./_fails-is-regexp")(ENDS_WITH),"String",{endsWith:function endsWith(searchString){var that=context(this,searchString,ENDS_WITH),endPosition=arguments.length>1?arguments[1]:undefined,len=toLength(that.length),end=endPosition===undefined?len:Math.min(toLength(endPosition),len),search=String(searchString);return $endsWith?$endsWith.call(that,search,end):that.slice(end-search.length,end)===search}})},{"./_export":54,"./_fails-is-regexp":55,"./_string-context":120,"./_to-length":130}],249:[function(require,module,exports){"use strict";require("./_string-html")("fixed",function(createHTML){return function fixed(){return createHTML(this,"tt","","")}})},{"./_string-html":121}],250:[function(require,module,exports){"use strict";require("./_string-html")("fontcolor",function(createHTML){return function fontcolor(color){return createHTML(this,"font","color",color)}})},{"./_string-html":121}],251:[function(require,module,exports){"use strict";require("./_string-html")("fontsize",function(createHTML){return function fontsize(size){return createHTML(this,"font","size",size)}})},{"./_string-html":121}],252:[function(require,module,exports){var $export=require("./_export"),toIndex=require("./_to-index"),fromCharCode=String.fromCharCode,$fromCodePoint=String.fromCodePoint;$export($export.S+$export.F*(!!$fromCodePoint&&$fromCodePoint.length!=1),"String",{fromCodePoint:function fromCodePoint(x){var res=[],aLen=arguments.length,i=0,code;while(aLen>i){code=+arguments[i++];if(toIndex(code,1114111)!==code)throw RangeError(code+" is not a valid code point");res.push(code<65536?fromCharCode(code):fromCharCode(((code-=65536)>>10)+55296,code%1024+56320))}return res.join("")}})},{"./_export":54,"./_to-index":127}],253:[function(require,module,exports){"use strict";var $export=require("./_export"),context=require("./_string-context"),INCLUDES="includes";$export($export.P+$export.F*require("./_fails-is-regexp")(INCLUDES),"String",{includes:function includes(searchString){return!!~context(this,searchString,INCLUDES).indexOf(searchString,arguments.length>1?arguments[1]:undefined)}})},{"./_export":54,"./_fails-is-regexp":55,"./_string-context":120}],254:[function(require,module,exports){"use strict";require("./_string-html")("italics",function(createHTML){return function italics(){return createHTML(this,"i","","")}})},{"./_string-html":121}],255:[function(require,module,exports){"use strict";var $at=require("./_string-at")(true);require("./_iter-define")(String,"String",function(iterated){this._t=String(iterated);this._i=0},function(){var O=this._t,index=this._i,point;if(index>=O.length)return{value:undefined,done:true};point=$at(O,index);this._i+=point.length;return{value:point,done:false}})},{"./_iter-define":75,"./_string-at":119}],256:[function(require,module,exports){"use strict";require("./_string-html")("link",function(createHTML){return function link(url){return createHTML(this,"a","href",url)}})},{"./_string-html":121}],257:[function(require,module,exports){var $export=require("./_export"),toIObject=require("./_to-iobject"),toLength=require("./_to-length");$export($export.S,"String",{raw:function raw(callSite){var tpl=toIObject(callSite.raw),len=toLength(tpl.length),aLen=arguments.length,res=[],i=0;while(len>i){res.push(String(tpl[i++]));if(i<aLen)res.push(String(arguments[i]))}return res.join("")}})},{"./_export":54,"./_to-iobject":129,"./_to-length":130}],258:[function(require,module,exports){var $export=require("./_export");$export($export.P,"String",{repeat:require("./_string-repeat")})},{"./_export":54,"./_string-repeat":123}],259:[function(require,module,exports){"use strict";require("./_string-html")("small",function(createHTML){return function small(){return createHTML(this,"small","","")}})},{"./_string-html":121}],260:[function(require,module,exports){"use strict";var $export=require("./_export"),toLength=require("./_to-length"),context=require("./_string-context"),STARTS_WITH="startsWith",$startsWith=""[STARTS_WITH];$export($export.P+$export.F*require("./_fails-is-regexp")(STARTS_WITH),"String",{startsWith:function startsWith(searchString){var that=context(this,searchString,STARTS_WITH),index=toLength(Math.min(arguments.length>1?arguments[1]:undefined,that.length)),search=String(searchString);return $startsWith?$startsWith.call(that,search,index):that.slice(index,index+search.length)===search}})},{"./_export":54,"./_fails-is-regexp":55,"./_string-context":120,"./_to-length":130}],261:[function(require,module,exports){"use strict";require("./_string-html")("strike",function(createHTML){return function strike(){return createHTML(this,"strike","","")}})},{"./_string-html":121}],262:[function(require,module,exports){"use strict";require("./_string-html")("sub",function(createHTML){return function sub(){return createHTML(this,"sub","","")}})},{"./_string-html":121}],263:[function(require,module,exports){"use strict";require("./_string-html")("sup",function(createHTML){return function sup(){return createHTML(this,"sup","","")}})},{"./_string-html":121}],264:[function(require,module,exports){"use strict";require("./_string-trim")("trim",function($trim){return function trim(){return $trim(this,3)}})},{"./_string-trim":124}],265:[function(require,module,exports){"use strict";var global=require("./_global"),has=require("./_has"),DESCRIPTORS=require("./_descriptors"),$export=require("./_export"),redefine=require("./_redefine"),META=require("./_meta").KEY,$fails=require("./_fails"),shared=require("./_shared"),setToStringTag=require("./_set-to-string-tag"),uid=require("./_uid"),wks=require("./_wks"),wksExt=require("./_wks-ext"),wksDefine=require("./_wks-define"),keyOf=require("./_keyof"),enumKeys=require("./_enum-keys"),isArray=require("./_is-array"),anObject=require("./_an-object"),toIObject=require("./_to-iobject"),toPrimitive=require("./_to-primitive"),createDesc=require("./_property-desc"),_create=require("./_object-create"),gOPNExt=require("./_object-gopn-ext"),$GOPD=require("./_object-gopd"),$DP=require("./_object-dp"),$keys=require("./_object-keys"),gOPD=$GOPD.f,dP=$DP.f,gOPN=gOPNExt.f,$Symbol=global.Symbol,$JSON=global.JSON,_stringify=$JSON&&$JSON.stringify,PROTOTYPE="prototype",HIDDEN=wks("_hidden"),TO_PRIMITIVE=wks("toPrimitive"),isEnum={}.propertyIsEnumerable,SymbolRegistry=shared("symbol-registry"),AllSymbols=shared("symbols"),OPSymbols=shared("op-symbols"),ObjectProto=Object[PROTOTYPE],USE_NATIVE=typeof $Symbol=="function",QObject=global.QObject;var setter=!QObject||!QObject[PROTOTYPE]||!QObject[PROTOTYPE].findChild;var setSymbolDesc=DESCRIPTORS&&$fails(function(){return _create(dP({},"a",{get:function(){return dP(this,"a",{value:7}).a}})).a!=7})?function(it,key,D){var protoDesc=gOPD(ObjectProto,key);if(protoDesc)delete ObjectProto[key];dP(it,key,D);if(protoDesc&&it!==ObjectProto)dP(ObjectProto,key,protoDesc)}:dP;var wrap=function(tag){var sym=AllSymbols[tag]=_create($Symbol[PROTOTYPE]);sym._k=tag;return sym};var isSymbol=USE_NATIVE&&typeof $Symbol.iterator=="symbol"?function(it){return typeof it=="symbol"}:function(it){return it instanceof $Symbol};var $defineProperty=function defineProperty(it,key,D){if(it===ObjectProto)$defineProperty(OPSymbols,key,D);anObject(it);key=toPrimitive(key,true);anObject(D);if(has(AllSymbols,key)){if(!D.enumerable){if(!has(it,HIDDEN))dP(it,HIDDEN,createDesc(1,{}));it[HIDDEN][key]=true}else{if(has(it,HIDDEN)&&it[HIDDEN][key])it[HIDDEN][key]=false;D=_create(D,{enumerable:createDesc(0,false)})}return setSymbolDesc(it,key,D)}return dP(it,key,D)};var $defineProperties=function defineProperties(it,P){anObject(it);var keys=enumKeys(P=toIObject(P)),i=0,l=keys.length,key;while(l>i)$defineProperty(it,key=keys[i++],P[key]);return it};var $create=function create(it,P){return P===undefined?_create(it):$defineProperties(_create(it),P)};var $propertyIsEnumerable=function propertyIsEnumerable(key){var E=isEnum.call(this,key=toPrimitive(key,true));if(this===ObjectProto&&has(AllSymbols,key)&&!has(OPSymbols,key))return false;return E||!has(this,key)||!has(AllSymbols,key)||has(this,HIDDEN)&&this[HIDDEN][key]?E:true};var $getOwnPropertyDescriptor=function getOwnPropertyDescriptor(it,key){it=toIObject(it);key=toPrimitive(key,true);if(it===ObjectProto&&has(AllSymbols,key)&&!has(OPSymbols,key))return;var D=gOPD(it,key);if(D&&has(AllSymbols,key)&&!(has(it,HIDDEN)&&it[HIDDEN][key]))D.enumerable=true;return D};var $getOwnPropertyNames=function getOwnPropertyNames(it){var names=gOPN(toIObject(it)),result=[],i=0,key;while(names.length>i){if(!has(AllSymbols,key=names[i++])&&key!=HIDDEN&&key!=META)result.push(key)}return result};var $getOwnPropertySymbols=function getOwnPropertySymbols(it){var IS_OP=it===ObjectProto,names=gOPN(IS_OP?OPSymbols:toIObject(it)),result=[],i=0,key;while(names.length>i){if(has(AllSymbols,key=names[i++])&&(IS_OP?has(ObjectProto,key):true))result.push(AllSymbols[key])}return result};if(!USE_NATIVE){$Symbol=function Symbol(){if(this instanceof $Symbol)throw TypeError("Symbol is not a constructor!");var tag=uid(arguments.length>0?arguments[0]:undefined);var $set=function(value){if(this===ObjectProto)$set.call(OPSymbols,value);if(has(this,HIDDEN)&&has(this[HIDDEN],tag))this[HIDDEN][tag]=false;setSymbolDesc(this,tag,createDesc(1,value))};if(DESCRIPTORS&&setter)setSymbolDesc(ObjectProto,tag,{configurable:true,set:$set});return wrap(tag)};redefine($Symbol[PROTOTYPE],"toString",function toString(){return this._k});$GOPD.f=$getOwnPropertyDescriptor;$DP.f=$defineProperty;require("./_object-gopn").f=gOPNExt.f=$getOwnPropertyNames;require("./_object-pie").f=$propertyIsEnumerable;require("./_object-gops").f=$getOwnPropertySymbols;if(DESCRIPTORS&&!require("./_library")){redefine(ObjectProto,"propertyIsEnumerable",$propertyIsEnumerable,true)}wksExt.f=function(name){return wrap(wks(name))}}$export($export.G+$export.W+$export.F*!USE_NATIVE,{Symbol:$Symbol});for(var symbols="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),i=0;symbols.length>i;)wks(symbols[i++]);for(var symbols=$keys(wks.store),i=0;symbols.length>i;)wksDefine(symbols[i++]);$export($export.S+$export.F*!USE_NATIVE,"Symbol",{for:function(key){return has(SymbolRegistry,key+="")?SymbolRegistry[key]:SymbolRegistry[key]=$Symbol(key)},keyFor:function keyFor(key){if(isSymbol(key))return keyOf(SymbolRegistry,key);throw TypeError(key+" is not a symbol!")},useSetter:function(){setter=true},useSimple:function(){setter=false}});$export($export.S+$export.F*!USE_NATIVE,"Object",{create:$create,defineProperty:$defineProperty,defineProperties:$defineProperties,getOwnPropertyDescriptor:$getOwnPropertyDescriptor,getOwnPropertyNames:$getOwnPropertyNames,getOwnPropertySymbols:$getOwnPropertySymbols});$JSON&&$export($export.S+$export.F*(!USE_NATIVE||$fails(function(){var S=$Symbol();return _stringify([S])!="[null]"||_stringify({a:S})!="{}"||_stringify(Object(S))!="{}"})),"JSON",{stringify:function stringify(it){if(it===undefined||isSymbol(it))return;var args=[it],i=1,replacer,$replacer;while(arguments.length>i)args.push(arguments[i++]);replacer=args[1];if(typeof replacer=="function")$replacer=replacer;if($replacer||!isArray(replacer))replacer=function(key,value){if($replacer)value=$replacer.call(this,key,value);if(!isSymbol(value))return value};args[1]=replacer;return _stringify.apply($JSON,args)}});$Symbol[PROTOTYPE][TO_PRIMITIVE]||require("./_hide")($Symbol[PROTOTYPE],TO_PRIMITIVE,$Symbol[PROTOTYPE].valueOf);setToStringTag($Symbol,"Symbol");setToStringTag(Math,"Math",true);setToStringTag(global.JSON,"JSON",true)},{"./_an-object":29,"./_descriptors":50,"./_enum-keys":53,"./_export":54,"./_fails":56,"./_global":60,"./_has":61,"./_hide":62,"./_is-array":69,"./_keyof":79,"./_library":80,"./_meta":84,"./_object-create":88,"./_object-dp":89,"./_object-gopd":92,"./_object-gopn":94,"./_object-gopn-ext":93,"./_object-gops":95,"./_object-keys":98,"./_object-pie":99,"./_property-desc":107,"./_redefine":109,"./_set-to-string-tag":114,"./_shared":116,"./_to-iobject":129,"./_to-primitive":132,"./_uid":136,"./_wks":139,"./_wks-define":137,"./_wks-ext":138}],266:[function(require,module,exports){"use strict";var $export=require("./_export"),$typed=require("./_typed"),buffer=require("./_typed-buffer"),anObject=require("./_an-object"),toIndex=require("./_to-index"),toLength=require("./_to-length"),isObject=require("./_is-object"),ArrayBuffer=require("./_global").ArrayBuffer,speciesConstructor=require("./_species-constructor"),$ArrayBuffer=buffer.ArrayBuffer,$DataView=buffer.DataView,$isView=$typed.ABV&&ArrayBuffer.isView,$slice=$ArrayBuffer.prototype.slice,VIEW=$typed.VIEW,ARRAY_BUFFER="ArrayBuffer";$export($export.G+$export.W+$export.F*(ArrayBuffer!==$ArrayBuffer),{ArrayBuffer:$ArrayBuffer});$export($export.S+$export.F*!$typed.CONSTR,ARRAY_BUFFER,{isView:function isView(it){return $isView&&$isView(it)||isObject(it)&&VIEW in it}});$export($export.P+$export.U+$export.F*require("./_fails")(function(){return!new $ArrayBuffer(2).slice(1,undefined).byteLength}),ARRAY_BUFFER,{slice:function slice(start,end){if($slice!==undefined&&end===undefined)return $slice.call(anObject(this),start);var len=anObject(this).byteLength,first=toIndex(start,len),final=toIndex(end===undefined?len:end,len),result=new(speciesConstructor(this,$ArrayBuffer))(toLength(final-first)),viewS=new $DataView(this),viewT=new $DataView(result),index=0;while(first<final){viewT.setUint8(index++,viewS.getUint8(first++))}return result}});require("./_set-species")(ARRAY_BUFFER)},{"./_an-object":29,"./_export":54,"./_fails":56,"./_global":60,"./_is-object":71,"./_set-species":113,"./_species-constructor":117,"./_to-index":127,"./_to-length":130,"./_typed":135,"./_typed-buffer":134}],267:[function(require,module,exports){var $export=require("./_export");$export($export.G+$export.W+$export.F*!require("./_typed").ABV,{DataView:require("./_typed-buffer").DataView})},{"./_export":54,"./_typed":135,"./_typed-buffer":134}],268:[function(require,module,exports){require("./_typed-array")("Float32",4,function(init){return function Float32Array(data,byteOffset,length){return init(this,data,byteOffset,length)}})},{"./_typed-array":133}],269:[function(require,module,exports){require("./_typed-array")("Float64",8,function(init){return function Float64Array(data,byteOffset,length){return init(this,data,byteOffset,length)}})},{"./_typed-array":133}],270:[function(require,module,exports){require("./_typed-array")("Int16",2,function(init){return function Int16Array(data,byteOffset,length){return init(this,data,byteOffset,length)}})},{"./_typed-array":133}],271:[function(require,module,exports){require("./_typed-array")("Int32",4,function(init){return function Int32Array(data,byteOffset,length){return init(this,data,byteOffset,length)}})},{"./_typed-array":133}],272:[function(require,module,exports){require("./_typed-array")("Int8",1,function(init){return function Int8Array(data,byteOffset,length){return init(this,data,byteOffset,length)}})},{"./_typed-array":133}],273:[function(require,module,exports){require("./_typed-array")("Uint16",2,function(init){return function Uint16Array(data,byteOffset,length){return init(this,data,byteOffset,length)}})},{"./_typed-array":133}],274:[function(require,module,exports){require("./_typed-array")("Uint32",4,function(init){return function Uint32Array(data,byteOffset,length){return init(this,data,byteOffset,length)}})},{"./_typed-array":133}],275:[function(require,module,exports){require("./_typed-array")("Uint8",1,function(init){return function Uint8Array(data,byteOffset,length){return init(this,data,byteOffset,length)}})},{"./_typed-array":133}],276:[function(require,module,exports){require("./_typed-array")("Uint8",1,function(init){return function Uint8ClampedArray(data,byteOffset,length){return init(this,data,byteOffset,length);
}},true)},{"./_typed-array":133}],277:[function(require,module,exports){"use strict";var each=require("./_array-methods")(0),redefine=require("./_redefine"),meta=require("./_meta"),assign=require("./_object-assign"),weak=require("./_collection-weak"),isObject=require("./_is-object"),getWeak=meta.getWeak,isExtensible=Object.isExtensible,uncaughtFrozenStore=weak.ufstore,tmp={},InternalMap;var wrapper=function(get){return function WeakMap(){return get(this,arguments.length>0?arguments[0]:undefined)}};var methods={get:function get(key){if(isObject(key)){var data=getWeak(key);if(data===true)return uncaughtFrozenStore(this).get(key);return data?data[this._i]:undefined}},set:function set(key,value){return weak.def(this,key,value)}};var $WeakMap=module.exports=require("./_collection")("WeakMap",wrapper,methods,weak,true,true);if((new $WeakMap).set((Object.freeze||Object)(tmp),7).get(tmp)!=7){InternalMap=weak.getConstructor(wrapper);assign(InternalMap.prototype,methods);meta.NEED=true;each(["delete","has","get","set"],function(key){var proto=$WeakMap.prototype,method=proto[key];redefine(proto,key,function(a,b){if(isObject(a)&&!isExtensible(a)){if(!this._f)this._f=new InternalMap;var result=this._f[key](a,b);return key=="set"?this:result}return method.call(this,a,b)})})}},{"./_array-methods":34,"./_collection":44,"./_collection-weak":43,"./_is-object":71,"./_meta":84,"./_object-assign":87,"./_redefine":109}],278:[function(require,module,exports){"use strict";var weak=require("./_collection-weak");require("./_collection")("WeakSet",function(get){return function WeakSet(){return get(this,arguments.length>0?arguments[0]:undefined)}},{add:function add(value){return weak.def(this,value,true)}},weak,false,true)},{"./_collection":44,"./_collection-weak":43}],279:[function(require,module,exports){"use strict";var $export=require("./_export"),$includes=require("./_array-includes")(true);$export($export.P,"Array",{includes:function includes(el){return $includes(this,el,arguments.length>1?arguments[1]:undefined)}});require("./_add-to-unscopables")("includes")},{"./_add-to-unscopables":27,"./_array-includes":33,"./_export":54}],280:[function(require,module,exports){var $export=require("./_export"),microtask=require("./_microtask")(),process=require("./_global").process,isNode=require("./_cof")(process)=="process";$export($export.G,{asap:function asap(fn){var domain=isNode&&process.domain;microtask(domain?domain.bind(fn):fn)}})},{"./_cof":40,"./_export":54,"./_global":60,"./_microtask":86}],281:[function(require,module,exports){var $export=require("./_export"),cof=require("./_cof");$export($export.S,"Error",{isError:function isError(it){return cof(it)==="Error"}})},{"./_cof":40,"./_export":54}],282:[function(require,module,exports){var $export=require("./_export");$export($export.P+$export.R,"Map",{toJSON:require("./_collection-to-json")("Map")})},{"./_collection-to-json":42,"./_export":54}],283:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{iaddh:function iaddh(x0,x1,y0,y1){var $x0=x0>>>0,$x1=x1>>>0,$y0=y0>>>0;return $x1+(y1>>>0)+(($x0&$y0|($x0|$y0)&~($x0+$y0>>>0))>>>31)|0}})},{"./_export":54}],284:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{imulh:function imulh(u,v){var UINT16=65535,$u=+u,$v=+v,u0=$u&UINT16,v0=$v&UINT16,u1=$u>>16,v1=$v>>16,t=(u1*v0>>>0)+(u0*v0>>>16);return u1*v1+(t>>16)+((u0*v1>>>0)+(t&UINT16)>>16)}})},{"./_export":54}],285:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{isubh:function isubh(x0,x1,y0,y1){var $x0=x0>>>0,$x1=x1>>>0,$y0=y0>>>0;return $x1-(y1>>>0)-((~$x0&$y0|~($x0^$y0)&$x0-$y0>>>0)>>>31)|0}})},{"./_export":54}],286:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{umulh:function umulh(u,v){var UINT16=65535,$u=+u,$v=+v,u0=$u&UINT16,v0=$v&UINT16,u1=$u>>>16,v1=$v>>>16,t=(u1*v0>>>0)+(u0*v0>>>16);return u1*v1+(t>>>16)+((u0*v1>>>0)+(t&UINT16)>>>16)}})},{"./_export":54}],287:[function(require,module,exports){"use strict";var $export=require("./_export"),toObject=require("./_to-object"),aFunction=require("./_a-function"),$defineProperty=require("./_object-dp");require("./_descriptors")&&$export($export.P+require("./_object-forced-pam"),"Object",{__defineGetter__:function __defineGetter__(P,getter){$defineProperty.f(toObject(this),P,{get:aFunction(getter),enumerable:true,configurable:true})}})},{"./_a-function":25,"./_descriptors":50,"./_export":54,"./_object-dp":89,"./_object-forced-pam":91,"./_to-object":131}],288:[function(require,module,exports){"use strict";var $export=require("./_export"),toObject=require("./_to-object"),aFunction=require("./_a-function"),$defineProperty=require("./_object-dp");require("./_descriptors")&&$export($export.P+require("./_object-forced-pam"),"Object",{__defineSetter__:function __defineSetter__(P,setter){$defineProperty.f(toObject(this),P,{set:aFunction(setter),enumerable:true,configurable:true})}})},{"./_a-function":25,"./_descriptors":50,"./_export":54,"./_object-dp":89,"./_object-forced-pam":91,"./_to-object":131}],289:[function(require,module,exports){var $export=require("./_export"),$entries=require("./_object-to-array")(true);$export($export.S,"Object",{entries:function entries(it){return $entries(it)}})},{"./_export":54,"./_object-to-array":101}],290:[function(require,module,exports){var $export=require("./_export"),ownKeys=require("./_own-keys"),toIObject=require("./_to-iobject"),gOPD=require("./_object-gopd"),createProperty=require("./_create-property");$export($export.S,"Object",{getOwnPropertyDescriptors:function getOwnPropertyDescriptors(object){var O=toIObject(object),getDesc=gOPD.f,keys=ownKeys(O),result={},i=0,key;while(keys.length>i)createProperty(result,key=keys[i++],getDesc(O,key));return result}})},{"./_create-property":46,"./_export":54,"./_object-gopd":92,"./_own-keys":102,"./_to-iobject":129}],291:[function(require,module,exports){"use strict";var $export=require("./_export"),toObject=require("./_to-object"),toPrimitive=require("./_to-primitive"),getPrototypeOf=require("./_object-gpo"),getOwnPropertyDescriptor=require("./_object-gopd").f;require("./_descriptors")&&$export($export.P+require("./_object-forced-pam"),"Object",{__lookupGetter__:function __lookupGetter__(P){var O=toObject(this),K=toPrimitive(P,true),D;do{if(D=getOwnPropertyDescriptor(O,K))return D.get}while(O=getPrototypeOf(O))}})},{"./_descriptors":50,"./_export":54,"./_object-forced-pam":91,"./_object-gopd":92,"./_object-gpo":96,"./_to-object":131,"./_to-primitive":132}],292:[function(require,module,exports){"use strict";var $export=require("./_export"),toObject=require("./_to-object"),toPrimitive=require("./_to-primitive"),getPrototypeOf=require("./_object-gpo"),getOwnPropertyDescriptor=require("./_object-gopd").f;require("./_descriptors")&&$export($export.P+require("./_object-forced-pam"),"Object",{__lookupSetter__:function __lookupSetter__(P){var O=toObject(this),K=toPrimitive(P,true),D;do{if(D=getOwnPropertyDescriptor(O,K))return D.set}while(O=getPrototypeOf(O))}})},{"./_descriptors":50,"./_export":54,"./_object-forced-pam":91,"./_object-gopd":92,"./_object-gpo":96,"./_to-object":131,"./_to-primitive":132}],293:[function(require,module,exports){var $export=require("./_export"),$values=require("./_object-to-array")(false);$export($export.S,"Object",{values:function values(it){return $values(it)}})},{"./_export":54,"./_object-to-array":101}],294:[function(require,module,exports){"use strict";var $export=require("./_export"),global=require("./_global"),core=require("./_core"),microtask=require("./_microtask")(),OBSERVABLE=require("./_wks")("observable"),aFunction=require("./_a-function"),anObject=require("./_an-object"),anInstance=require("./_an-instance"),redefineAll=require("./_redefine-all"),hide=require("./_hide"),forOf=require("./_for-of"),RETURN=forOf.RETURN;var getMethod=function(fn){return fn==null?undefined:aFunction(fn)};var cleanupSubscription=function(subscription){var cleanup=subscription._c;if(cleanup){subscription._c=undefined;cleanup()}};var subscriptionClosed=function(subscription){return subscription._o===undefined};var closeSubscription=function(subscription){if(!subscriptionClosed(subscription)){subscription._o=undefined;cleanupSubscription(subscription)}};var Subscription=function(observer,subscriber){anObject(observer);this._c=undefined;this._o=observer;observer=new SubscriptionObserver(this);try{var cleanup=subscriber(observer),subscription=cleanup;if(cleanup!=null){if(typeof cleanup.unsubscribe==="function")cleanup=function(){subscription.unsubscribe()};else aFunction(cleanup);this._c=cleanup}}catch(e){observer.error(e);return}if(subscriptionClosed(this))cleanupSubscription(this)};Subscription.prototype=redefineAll({},{unsubscribe:function unsubscribe(){closeSubscription(this)}});var SubscriptionObserver=function(subscription){this._s=subscription};SubscriptionObserver.prototype=redefineAll({},{next:function next(value){var subscription=this._s;if(!subscriptionClosed(subscription)){var observer=subscription._o;try{var m=getMethod(observer.next);if(m)return m.call(observer,value)}catch(e){try{closeSubscription(subscription)}finally{throw e}}}},error:function error(value){var subscription=this._s;if(subscriptionClosed(subscription))throw value;var observer=subscription._o;subscription._o=undefined;try{var m=getMethod(observer.error);if(!m)throw value;value=m.call(observer,value)}catch(e){try{cleanupSubscription(subscription)}finally{throw e}}cleanupSubscription(subscription);return value},complete:function complete(value){var subscription=this._s;if(!subscriptionClosed(subscription)){var observer=subscription._o;subscription._o=undefined;try{var m=getMethod(observer.complete);value=m?m.call(observer,value):undefined}catch(e){try{cleanupSubscription(subscription)}finally{throw e}}cleanupSubscription(subscription);return value}}});var $Observable=function Observable(subscriber){anInstance(this,$Observable,"Observable","_f")._f=aFunction(subscriber)};redefineAll($Observable.prototype,{subscribe:function subscribe(observer){return new Subscription(observer,this._f)},forEach:function forEach(fn){var that=this;return new(core.Promise||global.Promise)(function(resolve,reject){aFunction(fn);var subscription=that.subscribe({next:function(value){try{return fn(value)}catch(e){reject(e);subscription.unsubscribe()}},error:reject,complete:resolve})})}});redefineAll($Observable,{from:function from(x){var C=typeof this==="function"?this:$Observable;var method=getMethod(anObject(x)[OBSERVABLE]);if(method){var observable=anObject(method.call(x));return observable.constructor===C?observable:new C(function(observer){return observable.subscribe(observer)})}return new C(function(observer){var done=false;microtask(function(){if(!done){try{if(forOf(x,false,function(it){observer.next(it);if(done)return RETURN})===RETURN)return}catch(e){if(done)throw e;observer.error(e);return}observer.complete()}});return function(){done=true}})},of:function of(){for(var i=0,l=arguments.length,items=Array(l);i<l;)items[i]=arguments[i++];return new(typeof this==="function"?this:$Observable)(function(observer){var done=false;microtask(function(){if(!done){for(var i=0;i<items.length;++i){observer.next(items[i]);if(done)return}observer.complete()}});return function(){done=true}})}});hide($Observable.prototype,OBSERVABLE,function(){return this});$export($export.G,{Observable:$Observable});require("./_set-species")("Observable")},{"./_a-function":25,"./_an-instance":28,"./_an-object":29,"./_core":45,"./_export":54,"./_for-of":59,"./_global":60,"./_hide":62,"./_microtask":86,"./_redefine-all":108,"./_set-species":113,"./_wks":139}],295:[function(require,module,exports){var metadata=require("./_metadata"),anObject=require("./_an-object"),toMetaKey=metadata.key,ordinaryDefineOwnMetadata=metadata.set;metadata.exp({defineMetadata:function defineMetadata(metadataKey,metadataValue,target,targetKey){ordinaryDefineOwnMetadata(metadataKey,metadataValue,anObject(target),toMetaKey(targetKey))}})},{"./_an-object":29,"./_metadata":85}],296:[function(require,module,exports){var metadata=require("./_metadata"),anObject=require("./_an-object"),toMetaKey=metadata.key,getOrCreateMetadataMap=metadata.map,store=metadata.store;metadata.exp({deleteMetadata:function deleteMetadata(metadataKey,target){var targetKey=arguments.length<3?undefined:toMetaKey(arguments[2]),metadataMap=getOrCreateMetadataMap(anObject(target),targetKey,false);if(metadataMap===undefined||!metadataMap["delete"](metadataKey))return false;if(metadataMap.size)return true;var targetMetadata=store.get(target);targetMetadata["delete"](targetKey);return!!targetMetadata.size||store["delete"](target)}})},{"./_an-object":29,"./_metadata":85}],297:[function(require,module,exports){var Set=require("./es6.set"),from=require("./_array-from-iterable"),metadata=require("./_metadata"),anObject=require("./_an-object"),getPrototypeOf=require("./_object-gpo"),ordinaryOwnMetadataKeys=metadata.keys,toMetaKey=metadata.key;var ordinaryMetadataKeys=function(O,P){var oKeys=ordinaryOwnMetadataKeys(O,P),parent=getPrototypeOf(O);if(parent===null)return oKeys;var pKeys=ordinaryMetadataKeys(parent,P);return pKeys.length?oKeys.length?from(new Set(oKeys.concat(pKeys))):pKeys:oKeys};metadata.exp({getMetadataKeys:function getMetadataKeys(target){return ordinaryMetadataKeys(anObject(target),arguments.length<2?undefined:toMetaKey(arguments[1]))}})},{"./_an-object":29,"./_array-from-iterable":32,"./_metadata":85,"./_object-gpo":96,"./es6.set":242}],298:[function(require,module,exports){var metadata=require("./_metadata"),anObject=require("./_an-object"),getPrototypeOf=require("./_object-gpo"),ordinaryHasOwnMetadata=metadata.has,ordinaryGetOwnMetadata=metadata.get,toMetaKey=metadata.key;var ordinaryGetMetadata=function(MetadataKey,O,P){var hasOwn=ordinaryHasOwnMetadata(MetadataKey,O,P);if(hasOwn)return ordinaryGetOwnMetadata(MetadataKey,O,P);var parent=getPrototypeOf(O);return parent!==null?ordinaryGetMetadata(MetadataKey,parent,P):undefined};metadata.exp({getMetadata:function getMetadata(metadataKey,target){return ordinaryGetMetadata(metadataKey,anObject(target),arguments.length<3?undefined:toMetaKey(arguments[2]))}})},{"./_an-object":29,"./_metadata":85,"./_object-gpo":96}],299:[function(require,module,exports){var metadata=require("./_metadata"),anObject=require("./_an-object"),ordinaryOwnMetadataKeys=metadata.keys,toMetaKey=metadata.key;metadata.exp({getOwnMetadataKeys:function getOwnMetadataKeys(target){return ordinaryOwnMetadataKeys(anObject(target),arguments.length<2?undefined:toMetaKey(arguments[1]))}})},{"./_an-object":29,"./_metadata":85}],300:[function(require,module,exports){var metadata=require("./_metadata"),anObject=require("./_an-object"),ordinaryGetOwnMetadata=metadata.get,toMetaKey=metadata.key;metadata.exp({getOwnMetadata:function getOwnMetadata(metadataKey,target){return ordinaryGetOwnMetadata(metadataKey,anObject(target),arguments.length<3?undefined:toMetaKey(arguments[2]))}})},{"./_an-object":29,"./_metadata":85}],301:[function(require,module,exports){var metadata=require("./_metadata"),anObject=require("./_an-object"),getPrototypeOf=require("./_object-gpo"),ordinaryHasOwnMetadata=metadata.has,toMetaKey=metadata.key;var ordinaryHasMetadata=function(MetadataKey,O,P){var hasOwn=ordinaryHasOwnMetadata(MetadataKey,O,P);if(hasOwn)return true;var parent=getPrototypeOf(O);return parent!==null?ordinaryHasMetadata(MetadataKey,parent,P):false};metadata.exp({hasMetadata:function hasMetadata(metadataKey,target){return ordinaryHasMetadata(metadataKey,anObject(target),arguments.length<3?undefined:toMetaKey(arguments[2]))}})},{"./_an-object":29,"./_metadata":85,"./_object-gpo":96}],302:[function(require,module,exports){var metadata=require("./_metadata"),anObject=require("./_an-object"),ordinaryHasOwnMetadata=metadata.has,toMetaKey=metadata.key;metadata.exp({hasOwnMetadata:function hasOwnMetadata(metadataKey,target){return ordinaryHasOwnMetadata(metadataKey,anObject(target),arguments.length<3?undefined:toMetaKey(arguments[2]))}})},{"./_an-object":29,"./_metadata":85}],303:[function(require,module,exports){var metadata=require("./_metadata"),anObject=require("./_an-object"),aFunction=require("./_a-function"),toMetaKey=metadata.key,ordinaryDefineOwnMetadata=metadata.set;metadata.exp({metadata:function metadata(metadataKey,metadataValue){return function decorator(target,targetKey){ordinaryDefineOwnMetadata(metadataKey,metadataValue,(targetKey!==undefined?anObject:aFunction)(target),toMetaKey(targetKey))}}})},{"./_a-function":25,"./_an-object":29,"./_metadata":85}],304:[function(require,module,exports){var $export=require("./_export");$export($export.P+$export.R,"Set",{toJSON:require("./_collection-to-json")("Set")})},{"./_collection-to-json":42,"./_export":54}],305:[function(require,module,exports){"use strict";var $export=require("./_export"),$at=require("./_string-at")(true);$export($export.P,"String",{at:function at(pos){return $at(this,pos)}})},{"./_export":54,"./_string-at":119}],306:[function(require,module,exports){"use strict";var $export=require("./_export"),defined=require("./_defined"),toLength=require("./_to-length"),isRegExp=require("./_is-regexp"),getFlags=require("./_flags"),RegExpProto=RegExp.prototype;var $RegExpStringIterator=function(regexp,string){this._r=regexp;this._s=string};require("./_iter-create")($RegExpStringIterator,"RegExp String",function next(){var match=this._r.exec(this._s);return{value:match,done:match===null}});$export($export.P,"String",{matchAll:function matchAll(regexp){defined(this);if(!isRegExp(regexp))throw TypeError(regexp+" is not a regexp!");var S=String(this),flags="flags"in RegExpProto?String(regexp.flags):getFlags.call(regexp),rx=new RegExp(regexp.source,~flags.indexOf("g")?flags:"g"+flags);rx.lastIndex=toLength(regexp.lastIndex);return new $RegExpStringIterator(rx,S)}})},{"./_defined":49,"./_export":54,"./_flags":58,"./_is-regexp":72,"./_iter-create":74,"./_to-length":130}],307:[function(require,module,exports){"use strict";var $export=require("./_export"),$pad=require("./_string-pad");$export($export.P,"String",{padEnd:function padEnd(maxLength){return $pad(this,maxLength,arguments.length>1?arguments[1]:undefined,false)}})},{"./_export":54,"./_string-pad":122}],308:[function(require,module,exports){"use strict";var $export=require("./_export"),$pad=require("./_string-pad");$export($export.P,"String",{padStart:function padStart(maxLength){return $pad(this,maxLength,arguments.length>1?arguments[1]:undefined,true)}})},{"./_export":54,"./_string-pad":122}],309:[function(require,module,exports){"use strict";require("./_string-trim")("trimLeft",function($trim){return function trimLeft(){return $trim(this,1)}},"trimStart")},{"./_string-trim":124}],310:[function(require,module,exports){"use strict";require("./_string-trim")("trimRight",function($trim){return function trimRight(){return $trim(this,2)}},"trimEnd")},{"./_string-trim":124}],311:[function(require,module,exports){require("./_wks-define")("asyncIterator")},{"./_wks-define":137}],312:[function(require,module,exports){require("./_wks-define")("observable")},{"./_wks-define":137}],313:[function(require,module,exports){var $export=require("./_export");$export($export.S,"System",{global:require("./_global")})},{"./_export":54,"./_global":60}],314:[function(require,module,exports){var $iterators=require("./es6.array.iterator"),redefine=require("./_redefine"),global=require("./_global"),hide=require("./_hide"),Iterators=require("./_iterators"),wks=require("./_wks"),ITERATOR=wks("iterator"),TO_STRING_TAG=wks("toStringTag"),ArrayValues=Iterators.Array;for(var collections=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],i=0;i<5;i++){var NAME=collections[i],Collection=global[NAME],proto=Collection&&Collection.prototype,key;if(proto){if(!proto[ITERATOR])hide(proto,ITERATOR,ArrayValues);if(!proto[TO_STRING_TAG])hide(proto,TO_STRING_TAG,NAME);Iterators[NAME]=ArrayValues;for(key in $iterators)if(!proto[key])redefine(proto,key,$iterators[key],true)}}},{"./_global":60,"./_hide":62,"./_iterators":78,"./_redefine":109,"./_wks":139,"./es6.array.iterator":152}],315:[function(require,module,exports){var $export=require("./_export"),$task=require("./_task");$export($export.G+$export.B,{setImmediate:$task.set,clearImmediate:$task.clear})},{"./_export":54,"./_task":126}],316:[function(require,module,exports){var global=require("./_global"),$export=require("./_export"),invoke=require("./_invoke"),partial=require("./_partial"),navigator=global.navigator,MSIE=!!navigator&&/MSIE .\./.test(navigator.userAgent);var wrap=function(set){return MSIE?function(fn,time){return set(invoke(partial,[].slice.call(arguments,2),typeof fn=="function"?fn:Function(fn)),time)}:set};$export($export.G+$export.B+$export.F*MSIE,{setTimeout:wrap(global.setTimeout),setInterval:wrap(global.setInterval)})},{"./_export":54,"./_global":60,"./_invoke":66,"./_partial":105}],317:[function(require,module,exports){require("./modules/es6.symbol");require("./modules/es6.object.create");require("./modules/es6.object.define-property");require("./modules/es6.object.define-properties");require("./modules/es6.object.get-own-property-descriptor");require("./modules/es6.object.get-prototype-of");require("./modules/es6.object.keys");require("./modules/es6.object.get-own-property-names");require("./modules/es6.object.freeze");require("./modules/es6.object.seal");require("./modules/es6.object.prevent-extensions");require("./modules/es6.object.is-frozen");require("./modules/es6.object.is-sealed");require("./modules/es6.object.is-extensible");require("./modules/es6.object.assign");require("./modules/es6.object.is");require("./modules/es6.object.set-prototype-of");require("./modules/es6.object.to-string");require("./modules/es6.function.bind");require("./modules/es6.function.name");require("./modules/es6.function.has-instance");require("./modules/es6.parse-int");require("./modules/es6.parse-float");require("./modules/es6.number.constructor");require("./modules/es6.number.to-fixed");require("./modules/es6.number.to-precision");require("./modules/es6.number.epsilon");require("./modules/es6.number.is-finite");require("./modules/es6.number.is-integer");require("./modules/es6.number.is-nan");require("./modules/es6.number.is-safe-integer");require("./modules/es6.number.max-safe-integer");require("./modules/es6.number.min-safe-integer");require("./modules/es6.number.parse-float");require("./modules/es6.number.parse-int");require("./modules/es6.math.acosh");require("./modules/es6.math.asinh");require("./modules/es6.math.atanh");require("./modules/es6.math.cbrt");require("./modules/es6.math.clz32");require("./modules/es6.math.cosh");require("./modules/es6.math.expm1");require("./modules/es6.math.fround");require("./modules/es6.math.hypot");require("./modules/es6.math.imul");require("./modules/es6.math.log10");require("./modules/es6.math.log1p");require("./modules/es6.math.log2");require("./modules/es6.math.sign");require("./modules/es6.math.sinh");require("./modules/es6.math.tanh");require("./modules/es6.math.trunc");require("./modules/es6.string.from-code-point");require("./modules/es6.string.raw");require("./modules/es6.string.trim");require("./modules/es6.string.iterator");require("./modules/es6.string.code-point-at");require("./modules/es6.string.ends-with");require("./modules/es6.string.includes");require("./modules/es6.string.repeat");require("./modules/es6.string.starts-with");require("./modules/es6.string.anchor");require("./modules/es6.string.big");require("./modules/es6.string.blink");require("./modules/es6.string.bold");require("./modules/es6.string.fixed");require("./modules/es6.string.fontcolor");require("./modules/es6.string.fontsize");require("./modules/es6.string.italics");require("./modules/es6.string.link");require("./modules/es6.string.small");require("./modules/es6.string.strike");require("./modules/es6.string.sub");require("./modules/es6.string.sup");require("./modules/es6.date.now");require("./modules/es6.date.to-json");require("./modules/es6.date.to-iso-string");require("./modules/es6.date.to-string");require("./modules/es6.date.to-primitive");require("./modules/es6.array.is-array");require("./modules/es6.array.from");require("./modules/es6.array.of");require("./modules/es6.array.join");require("./modules/es6.array.slice");require("./modules/es6.array.sort");require("./modules/es6.array.for-each");require("./modules/es6.array.map");require("./modules/es6.array.filter");require("./modules/es6.array.some");require("./modules/es6.array.every");require("./modules/es6.array.reduce");require("./modules/es6.array.reduce-right");require("./modules/es6.array.index-of");require("./modules/es6.array.last-index-of");require("./modules/es6.array.copy-within");require("./modules/es6.array.fill");require("./modules/es6.array.find");require("./modules/es6.array.find-index");require("./modules/es6.array.species");require("./modules/es6.array.iterator");require("./modules/es6.regexp.constructor");require("./modules/es6.regexp.to-string");require("./modules/es6.regexp.flags");require("./modules/es6.regexp.match");require("./modules/es6.regexp.replace");require("./modules/es6.regexp.search");require("./modules/es6.regexp.split");require("./modules/es6.promise");require("./modules/es6.map");require("./modules/es6.set");require("./modules/es6.weak-map");require("./modules/es6.weak-set");require("./modules/es6.typed.array-buffer");require("./modules/es6.typed.data-view");require("./modules/es6.typed.int8-array");require("./modules/es6.typed.uint8-array");require("./modules/es6.typed.uint8-clamped-array");require("./modules/es6.typed.int16-array");require("./modules/es6.typed.uint16-array");require("./modules/es6.typed.int32-array");require("./modules/es6.typed.uint32-array");require("./modules/es6.typed.float32-array");require("./modules/es6.typed.float64-array");require("./modules/es6.reflect.apply");require("./modules/es6.reflect.construct");require("./modules/es6.reflect.define-property");require("./modules/es6.reflect.delete-property");require("./modules/es6.reflect.enumerate");require("./modules/es6.reflect.get");require("./modules/es6.reflect.get-own-property-descriptor");require("./modules/es6.reflect.get-prototype-of");require("./modules/es6.reflect.has");require("./modules/es6.reflect.is-extensible");require("./modules/es6.reflect.own-keys");require("./modules/es6.reflect.prevent-extensions");require("./modules/es6.reflect.set");require("./modules/es6.reflect.set-prototype-of");require("./modules/es7.array.includes");require("./modules/es7.string.at");require("./modules/es7.string.pad-start");require("./modules/es7.string.pad-end");require("./modules/es7.string.trim-left");require("./modules/es7.string.trim-right");require("./modules/es7.string.match-all");require("./modules/es7.symbol.async-iterator");require("./modules/es7.symbol.observable");require("./modules/es7.object.get-own-property-descriptors");require("./modules/es7.object.values");require("./modules/es7.object.entries");require("./modules/es7.object.define-getter");require("./modules/es7.object.define-setter");require("./modules/es7.object.lookup-getter");require("./modules/es7.object.lookup-setter");require("./modules/es7.map.to-json");require("./modules/es7.set.to-json");require("./modules/es7.system.global");require("./modules/es7.error.is-error");require("./modules/es7.math.iaddh");require("./modules/es7.math.isubh");require("./modules/es7.math.imulh");require("./modules/es7.math.umulh");require("./modules/es7.reflect.define-metadata");require("./modules/es7.reflect.delete-metadata");require("./modules/es7.reflect.get-metadata");require("./modules/es7.reflect.get-metadata-keys");require("./modules/es7.reflect.get-own-metadata");require("./modules/es7.reflect.get-own-metadata-keys");require("./modules/es7.reflect.has-metadata");require("./modules/es7.reflect.has-own-metadata");require("./modules/es7.reflect.metadata");require("./modules/es7.asap");require("./modules/es7.observable");require("./modules/web.timers");require("./modules/web.immediate");require("./modules/web.dom.iterable");module.exports=require("./modules/_core")},{"./modules/_core":45,"./modules/es6.array.copy-within":142,"./modules/es6.array.every":143,"./modules/es6.array.fill":144,"./modules/es6.array.filter":145,"./modules/es6.array.find":147,"./modules/es6.array.find-index":146,"./modules/es6.array.for-each":148,"./modules/es6.array.from":149,"./modules/es6.array.index-of":150,"./modules/es6.array.is-array":151,"./modules/es6.array.iterator":152,"./modules/es6.array.join":153,"./modules/es6.array.last-index-of":154,"./modules/es6.array.map":155,"./modules/es6.array.of":156,"./modules/es6.array.reduce":158,"./modules/es6.array.reduce-right":157,"./modules/es6.array.slice":159,"./modules/es6.array.some":160,"./modules/es6.array.sort":161,"./modules/es6.array.species":162,"./modules/es6.date.now":163,"./modules/es6.date.to-iso-string":164,"./modules/es6.date.to-json":165,"./modules/es6.date.to-primitive":166,"./modules/es6.date.to-string":167,"./modules/es6.function.bind":168,"./modules/es6.function.has-instance":169,"./modules/es6.function.name":170,"./modules/es6.map":171,"./modules/es6.math.acosh":172,"./modules/es6.math.asinh":173,"./modules/es6.math.atanh":174,"./modules/es6.math.cbrt":175,"./modules/es6.math.clz32":176,"./modules/es6.math.cosh":177,"./modules/es6.math.expm1":178,"./modules/es6.math.fround":179,"./modules/es6.math.hypot":180,"./modules/es6.math.imul":181,"./modules/es6.math.log10":182,"./modules/es6.math.log1p":183,"./modules/es6.math.log2":184,"./modules/es6.math.sign":185,"./modules/es6.math.sinh":186,"./modules/es6.math.tanh":187,"./modules/es6.math.trunc":188,"./modules/es6.number.constructor":189,"./modules/es6.number.epsilon":190,"./modules/es6.number.is-finite":191,"./modules/es6.number.is-integer":192,"./modules/es6.number.is-nan":193,"./modules/es6.number.is-safe-integer":194,"./modules/es6.number.max-safe-integer":195,"./modules/es6.number.min-safe-integer":196,"./modules/es6.number.parse-float":197,"./modules/es6.number.parse-int":198,"./modules/es6.number.to-fixed":199,"./modules/es6.number.to-precision":200,"./modules/es6.object.assign":201,"./modules/es6.object.create":202,"./modules/es6.object.define-properties":203,"./modules/es6.object.define-property":204,"./modules/es6.object.freeze":205,"./modules/es6.object.get-own-property-descriptor":206,"./modules/es6.object.get-own-property-names":207,"./modules/es6.object.get-prototype-of":208,"./modules/es6.object.is":212,"./modules/es6.object.is-extensible":209,"./modules/es6.object.is-frozen":210,"./modules/es6.object.is-sealed":211,"./modules/es6.object.keys":213,"./modules/es6.object.prevent-extensions":214,"./modules/es6.object.seal":215,"./modules/es6.object.set-prototype-of":216,"./modules/es6.object.to-string":217,"./modules/es6.parse-float":218,"./modules/es6.parse-int":219,"./modules/es6.promise":220,"./modules/es6.reflect.apply":221,"./modules/es6.reflect.construct":222,"./modules/es6.reflect.define-property":223,"./modules/es6.reflect.delete-property":224,"./modules/es6.reflect.enumerate":225,"./modules/es6.reflect.get":228,"./modules/es6.reflect.get-own-property-descriptor":226,"./modules/es6.reflect.get-prototype-of":227,"./modules/es6.reflect.has":229,"./modules/es6.reflect.is-extensible":230,"./modules/es6.reflect.own-keys":231,"./modules/es6.reflect.prevent-extensions":232,"./modules/es6.reflect.set":234,"./modules/es6.reflect.set-prototype-of":233,"./modules/es6.regexp.constructor":235,"./modules/es6.regexp.flags":236,"./modules/es6.regexp.match":237,"./modules/es6.regexp.replace":238,"./modules/es6.regexp.search":239,"./modules/es6.regexp.split":240,"./modules/es6.regexp.to-string":241,"./modules/es6.set":242,"./modules/es6.string.anchor":243,"./modules/es6.string.big":244,"./modules/es6.string.blink":245,"./modules/es6.string.bold":246,
"./modules/es6.string.code-point-at":247,"./modules/es6.string.ends-with":248,"./modules/es6.string.fixed":249,"./modules/es6.string.fontcolor":250,"./modules/es6.string.fontsize":251,"./modules/es6.string.from-code-point":252,"./modules/es6.string.includes":253,"./modules/es6.string.italics":254,"./modules/es6.string.iterator":255,"./modules/es6.string.link":256,"./modules/es6.string.raw":257,"./modules/es6.string.repeat":258,"./modules/es6.string.small":259,"./modules/es6.string.starts-with":260,"./modules/es6.string.strike":261,"./modules/es6.string.sub":262,"./modules/es6.string.sup":263,"./modules/es6.string.trim":264,"./modules/es6.symbol":265,"./modules/es6.typed.array-buffer":266,"./modules/es6.typed.data-view":267,"./modules/es6.typed.float32-array":268,"./modules/es6.typed.float64-array":269,"./modules/es6.typed.int16-array":270,"./modules/es6.typed.int32-array":271,"./modules/es6.typed.int8-array":272,"./modules/es6.typed.uint16-array":273,"./modules/es6.typed.uint32-array":274,"./modules/es6.typed.uint8-array":275,"./modules/es6.typed.uint8-clamped-array":276,"./modules/es6.weak-map":277,"./modules/es6.weak-set":278,"./modules/es7.array.includes":279,"./modules/es7.asap":280,"./modules/es7.error.is-error":281,"./modules/es7.map.to-json":282,"./modules/es7.math.iaddh":283,"./modules/es7.math.imulh":284,"./modules/es7.math.isubh":285,"./modules/es7.math.umulh":286,"./modules/es7.object.define-getter":287,"./modules/es7.object.define-setter":288,"./modules/es7.object.entries":289,"./modules/es7.object.get-own-property-descriptors":290,"./modules/es7.object.lookup-getter":291,"./modules/es7.object.lookup-setter":292,"./modules/es7.object.values":293,"./modules/es7.observable":294,"./modules/es7.reflect.define-metadata":295,"./modules/es7.reflect.delete-metadata":296,"./modules/es7.reflect.get-metadata":298,"./modules/es7.reflect.get-metadata-keys":297,"./modules/es7.reflect.get-own-metadata":300,"./modules/es7.reflect.get-own-metadata-keys":299,"./modules/es7.reflect.has-metadata":301,"./modules/es7.reflect.has-own-metadata":302,"./modules/es7.reflect.metadata":303,"./modules/es7.set.to-json":304,"./modules/es7.string.at":305,"./modules/es7.string.match-all":306,"./modules/es7.string.pad-end":307,"./modules/es7.string.pad-start":308,"./modules/es7.string.trim-left":309,"./modules/es7.string.trim-right":310,"./modules/es7.symbol.async-iterator":311,"./modules/es7.symbol.observable":312,"./modules/es7.system.global":313,"./modules/web.dom.iterable":314,"./modules/web.immediate":315,"./modules/web.timers":316}],318:[function(require,module,exports){(function(Buffer){function isArray(arg){if(Array.isArray){return Array.isArray(arg)}return objectToString(arg)==="[object Array]"}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return objectToString(e)==="[object Error]"||e instanceof Error}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=Buffer.isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,{isBuffer:require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":457}],319:[function(require,module,exports){var kCSSColorTable={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function clamp_css_byte(i){i=Math.round(i);return i<0?0:i>255?255:i}function clamp_css_float(f){return f<0?0:f>1?1:f}function parse_css_int(str){if(str[str.length-1]==="%")return clamp_css_byte(parseFloat(str)/100*255);return clamp_css_byte(parseInt(str))}function parse_css_float(str){if(str[str.length-1]==="%")return clamp_css_float(parseFloat(str)/100);return clamp_css_float(parseFloat(str))}function css_hue_to_rgb(m1,m2,h){if(h<0)h+=1;else if(h>1)h-=1;if(h*6<1)return m1+(m2-m1)*h*6;if(h*2<1)return m2;if(h*3<2)return m1+(m2-m1)*(2/3-h)*6;return m1}function parseCSSColor(css_str){var str=css_str.replace(/ /g,"").toLowerCase();if(str in kCSSColorTable)return kCSSColorTable[str].slice();if(str[0]==="#"){if(str.length===4){var iv=parseInt(str.substr(1),16);if(!(iv>=0&&iv<=4095))return null;return[(iv&3840)>>4|(iv&3840)>>8,iv&240|(iv&240)>>4,iv&15|(iv&15)<<4,1]}else if(str.length===7){var iv=parseInt(str.substr(1),16);if(!(iv>=0&&iv<=16777215))return null;return[(iv&16711680)>>16,(iv&65280)>>8,iv&255,1]}return null}var op=str.indexOf("("),ep=str.indexOf(")");if(op!==-1&&ep+1===str.length){var fname=str.substr(0,op);var params=str.substr(op+1,ep-(op+1)).split(",");var alpha=1;switch(fname){case"rgba":if(params.length!==4)return null;alpha=parse_css_float(params.pop());case"rgb":if(params.length!==3)return null;return[parse_css_int(params[0]),parse_css_int(params[1]),parse_css_int(params[2]),alpha];case"hsla":if(params.length!==4)return null;alpha=parse_css_float(params.pop());case"hsl":if(params.length!==3)return null;var h=(parseFloat(params[0])%360+360)%360/360;var s=parse_css_float(params[1]);var l=parse_css_float(params[2]);var m2=l<=.5?l*(s+1):l+s-l*s;var m1=l*2-m2;return[clamp_css_byte(css_hue_to_rgb(m1,m2,h+1/3)*255),clamp_css_byte(css_hue_to_rgb(m1,m2,h)*255),clamp_css_byte(css_hue_to_rgb(m1,m2,h-1/3)*255),alpha];default:return null}}return null}try{exports.parseCSSColor=parseCSSColor}catch(e){}},{}],320:[function(require,module,exports){"use strict";var createThunk=require("./lib/thunk.js");function Procedure(){this.argTypes=[];this.shimArgs=[];this.arrayArgs=[];this.arrayBlockIndices=[];this.scalarArgs=[];this.offsetArgs=[];this.offsetArgIndex=[];this.indexArgs=[];this.shapeArgs=[];this.funcName="";this.pre=null;this.body=null;this.post=null;this.debug=false}function compileCwise(user_args){var proc=new Procedure;proc.pre=user_args.pre;proc.body=user_args.body;proc.post=user_args.post;var proc_args=user_args.args.slice(0);proc.argTypes=proc_args;for(var i=0;i<proc_args.length;++i){var arg_type=proc_args[i];if(arg_type==="array"||typeof arg_type==="object"&&arg_type.blockIndices){proc.argTypes[i]="array";proc.arrayArgs.push(i);proc.arrayBlockIndices.push(arg_type.blockIndices?arg_type.blockIndices:0);proc.shimArgs.push("array"+i);if(i<proc.pre.args.length&&proc.pre.args[i].count>0){throw new Error("cwise: pre() block may not reference array args")}if(i<proc.post.args.length&&proc.post.args[i].count>0){throw new Error("cwise: post() block may not reference array args")}}else if(arg_type==="scalar"){proc.scalarArgs.push(i);proc.shimArgs.push("scalar"+i)}else if(arg_type==="index"){proc.indexArgs.push(i);if(i<proc.pre.args.length&&proc.pre.args[i].count>0){throw new Error("cwise: pre() block may not reference array index")}if(i<proc.body.args.length&&proc.body.args[i].lvalue){throw new Error("cwise: body() block may not write to array index")}if(i<proc.post.args.length&&proc.post.args[i].count>0){throw new Error("cwise: post() block may not reference array index")}}else if(arg_type==="shape"){proc.shapeArgs.push(i);if(i<proc.pre.args.length&&proc.pre.args[i].lvalue){throw new Error("cwise: pre() block may not write to array shape")}if(i<proc.body.args.length&&proc.body.args[i].lvalue){throw new Error("cwise: body() block may not write to array shape")}if(i<proc.post.args.length&&proc.post.args[i].lvalue){throw new Error("cwise: post() block may not write to array shape")}}else if(typeof arg_type==="object"&&arg_type.offset){proc.argTypes[i]="offset";proc.offsetArgs.push({array:arg_type.array,offset:arg_type.offset});proc.offsetArgIndex.push(i)}else{throw new Error("cwise: Unknown argument type "+proc_args[i])}}if(proc.arrayArgs.length<=0){throw new Error("cwise: No array arguments specified")}if(proc.pre.args.length>proc_args.length){throw new Error("cwise: Too many arguments in pre() block")}if(proc.body.args.length>proc_args.length){throw new Error("cwise: Too many arguments in body() block")}if(proc.post.args.length>proc_args.length){throw new Error("cwise: Too many arguments in post() block")}proc.debug=!!user_args.printCode||!!user_args.debug;proc.funcName=user_args.funcName||"cwise";proc.blockSize=user_args.blockSize||64;return createThunk(proc)}module.exports=compileCwise},{"./lib/thunk.js":322}],321:[function(require,module,exports){"use strict";var uniq=require("uniq");function innerFill(order,proc,body){var dimension=order.length,nargs=proc.arrayArgs.length,has_index=proc.indexArgs.length>0,code=[],vars=[],idx=0,pidx=0,i,j;for(i=0;i<dimension;++i){vars.push(["i",i,"=0"].join(""))}for(j=0;j<nargs;++j){for(i=0;i<dimension;++i){pidx=idx;idx=order[i];if(i===0){vars.push(["d",j,"s",i,"=t",j,"p",idx].join(""))}else{vars.push(["d",j,"s",i,"=(t",j,"p",idx,"-s",pidx,"*t",j,"p",pidx,")"].join(""))}}}code.push("var "+vars.join(","));for(i=dimension-1;i>=0;--i){idx=order[i];code.push(["for(i",i,"=0;i",i,"<s",idx,";++i",i,"){"].join(""))}code.push(body);for(i=0;i<dimension;++i){pidx=idx;idx=order[i];for(j=0;j<nargs;++j){code.push(["p",j,"+=d",j,"s",i].join(""))}if(has_index){if(i>0){code.push(["index[",pidx,"]-=s",pidx].join(""))}code.push(["++index[",idx,"]"].join(""))}code.push("}")}return code.join("\n")}function outerFill(matched,order,proc,body){var dimension=order.length,nargs=proc.arrayArgs.length,blockSize=proc.blockSize,has_index=proc.indexArgs.length>0,code=[];for(var i=0;i<nargs;++i){code.push(["var offset",i,"=p",i].join(""))}for(var i=matched;i<dimension;++i){code.push(["for(var j"+i+"=SS[",order[i],"]|0;j",i,">0;){"].join(""));code.push(["if(j",i,"<",blockSize,"){"].join(""));code.push(["s",order[i],"=j",i].join(""));code.push(["j",i,"=0"].join(""));code.push(["}else{s",order[i],"=",blockSize].join(""));code.push(["j",i,"-=",blockSize,"}"].join(""));if(has_index){code.push(["index[",order[i],"]=j",i].join(""))}}for(var i=0;i<nargs;++i){var indexStr=["offset"+i];for(var j=matched;j<dimension;++j){indexStr.push(["j",j,"*t",i,"p",order[j]].join(""))}code.push(["p",i,"=(",indexStr.join("+"),")"].join(""))}code.push(innerFill(order,proc,body));for(var i=matched;i<dimension;++i){code.push("}")}return code.join("\n")}function countMatches(orders){var matched=0,dimension=orders[0].length;while(matched<dimension){for(var j=1;j<orders.length;++j){if(orders[j][matched]!==orders[0][matched]){return matched}}++matched}return matched}function processBlock(block,proc,dtypes){var code=block.body;var pre=[];var post=[];for(var i=0;i<block.args.length;++i){var carg=block.args[i];if(carg.count<=0){continue}var re=new RegExp(carg.name,"g");var ptrStr="";var arrNum=proc.arrayArgs.indexOf(i);switch(proc.argTypes[i]){case"offset":var offArgIndex=proc.offsetArgIndex.indexOf(i);var offArg=proc.offsetArgs[offArgIndex];arrNum=offArg.array;ptrStr="+q"+offArgIndex;case"array":ptrStr="p"+arrNum+ptrStr;var localStr="l"+i;var arrStr="a"+arrNum;if(proc.arrayBlockIndices[arrNum]===0){if(carg.count===1){if(dtypes[arrNum]==="generic"){if(carg.lvalue){pre.push(["var ",localStr,"=",arrStr,".get(",ptrStr,")"].join(""));code=code.replace(re,localStr);post.push([arrStr,".set(",ptrStr,",",localStr,")"].join(""))}else{code=code.replace(re,[arrStr,".get(",ptrStr,")"].join(""))}}else{code=code.replace(re,[arrStr,"[",ptrStr,"]"].join(""))}}else if(dtypes[arrNum]==="generic"){pre.push(["var ",localStr,"=",arrStr,".get(",ptrStr,")"].join(""));code=code.replace(re,localStr);if(carg.lvalue){post.push([arrStr,".set(",ptrStr,",",localStr,")"].join(""))}}else{pre.push(["var ",localStr,"=",arrStr,"[",ptrStr,"]"].join(""));code=code.replace(re,localStr);if(carg.lvalue){post.push([arrStr,"[",ptrStr,"]=",localStr].join(""))}}}else{var reStrArr=[carg.name],ptrStrArr=[ptrStr];for(var j=0;j<Math.abs(proc.arrayBlockIndices[arrNum]);j++){reStrArr.push("\\s*\\[([^\\]]+)\\]");ptrStrArr.push("$"+(j+1)+"*t"+arrNum+"b"+j)}re=new RegExp(reStrArr.join(""),"g");ptrStr=ptrStrArr.join("+");if(dtypes[arrNum]==="generic"){throw new Error("cwise: Generic arrays not supported in combination with blocks!")}else{code=code.replace(re,[arrStr,"[",ptrStr,"]"].join(""))}}break;case"scalar":code=code.replace(re,"Y"+proc.scalarArgs.indexOf(i));break;case"index":code=code.replace(re,"index");break;case"shape":code=code.replace(re,"shape");break}}return[pre.join("\n"),code,post.join("\n")].join("\n").trim()}function typeSummary(dtypes){var summary=new Array(dtypes.length);var allEqual=true;for(var i=0;i<dtypes.length;++i){var t=dtypes[i];var digits=t.match(/\d+/);if(!digits){digits=""}else{digits=digits[0]}if(t.charAt(0)===0){summary[i]="u"+t.charAt(1)+digits}else{summary[i]=t.charAt(0)+digits}if(i>0){allEqual=allEqual&&summary[i]===summary[i-1]}}if(allEqual){return summary[0]}return summary.join("")}function generateCWiseOp(proc,typesig){var dimension=typesig[1].length-Math.abs(proc.arrayBlockIndices[0])|0;var orders=new Array(proc.arrayArgs.length);var dtypes=new Array(proc.arrayArgs.length);for(var i=0;i<proc.arrayArgs.length;++i){dtypes[i]=typesig[2*i];orders[i]=typesig[2*i+1]}var blockBegin=[],blockEnd=[];var loopBegin=[],loopEnd=[];var loopOrders=[];for(var i=0;i<proc.arrayArgs.length;++i){if(proc.arrayBlockIndices[i]<0){loopBegin.push(0);loopEnd.push(dimension);blockBegin.push(dimension);blockEnd.push(dimension+proc.arrayBlockIndices[i])}else{loopBegin.push(proc.arrayBlockIndices[i]);loopEnd.push(proc.arrayBlockIndices[i]+dimension);blockBegin.push(0);blockEnd.push(proc.arrayBlockIndices[i])}var newOrder=[];for(var j=0;j<orders[i].length;j++){if(loopBegin[i]<=orders[i][j]&&orders[i][j]<loopEnd[i]){newOrder.push(orders[i][j]-loopBegin[i])}}loopOrders.push(newOrder)}var arglist=["SS"];var code=["'use strict'"];var vars=[];for(var j=0;j<dimension;++j){vars.push(["s",j,"=SS[",j,"]"].join(""))}for(var i=0;i<proc.arrayArgs.length;++i){arglist.push("a"+i);arglist.push("t"+i);arglist.push("p"+i);for(var j=0;j<dimension;++j){vars.push(["t",i,"p",j,"=t",i,"[",loopBegin[i]+j,"]"].join(""))}for(var j=0;j<Math.abs(proc.arrayBlockIndices[i]);++j){vars.push(["t",i,"b",j,"=t",i,"[",blockBegin[i]+j,"]"].join(""))}}for(var i=0;i<proc.scalarArgs.length;++i){arglist.push("Y"+i)}if(proc.shapeArgs.length>0){vars.push("shape=SS.slice(0)")}if(proc.indexArgs.length>0){var zeros=new Array(dimension);for(var i=0;i<dimension;++i){zeros[i]="0"}vars.push(["index=[",zeros.join(","),"]"].join(""))}for(var i=0;i<proc.offsetArgs.length;++i){var off_arg=proc.offsetArgs[i];var init_string=[];for(var j=0;j<off_arg.offset.length;++j){if(off_arg.offset[j]===0){continue}else if(off_arg.offset[j]===1){init_string.push(["t",off_arg.array,"p",j].join(""))}else{init_string.push([off_arg.offset[j],"*t",off_arg.array,"p",j].join(""))}}if(init_string.length===0){vars.push("q"+i+"=0")}else{vars.push(["q",i,"=",init_string.join("+")].join(""))}}var thisVars=uniq([].concat(proc.pre.thisVars).concat(proc.body.thisVars).concat(proc.post.thisVars));vars=vars.concat(thisVars);code.push("var "+vars.join(","));for(var i=0;i<proc.arrayArgs.length;++i){code.push("p"+i+"|=0")}if(proc.pre.body.length>3){code.push(processBlock(proc.pre,proc,dtypes))}var body=processBlock(proc.body,proc,dtypes);var matched=countMatches(loopOrders);if(matched<dimension){code.push(outerFill(matched,loopOrders[0],proc,body))}else{code.push(innerFill(loopOrders[0],proc,body))}if(proc.post.body.length>3){code.push(processBlock(proc.post,proc,dtypes))}if(proc.debug){console.log("-----Generated cwise routine for ",typesig,":\n"+code.join("\n")+"\n----------")}var loopName=[proc.funcName||"unnamed","_cwise_loop_",orders[0].join("s"),"m",matched,typeSummary(dtypes)].join("");var f=new Function(["function ",loopName,"(",arglist.join(","),"){",code.join("\n"),"} return ",loopName].join(""));return f()}module.exports=generateCWiseOp},{uniq:991}],322:[function(require,module,exports){"use strict";var compile=require("./compile.js");function createThunk(proc){var code=["'use strict'","var CACHED={}"];var vars=[];var thunkName=proc.funcName+"_cwise_thunk";code.push(["return function ",thunkName,"(",proc.shimArgs.join(","),"){"].join(""));var typesig=[];var string_typesig=[];var proc_args=[["array",proc.arrayArgs[0],".shape.slice(",Math.max(0,proc.arrayBlockIndices[0]),proc.arrayBlockIndices[0]<0?","+proc.arrayBlockIndices[0]+")":")"].join("")];var shapeLengthConditions=[],shapeConditions=[];for(var i=0;i<proc.arrayArgs.length;++i){var j=proc.arrayArgs[i];vars.push(["t",j,"=array",j,".dtype,","r",j,"=array",j,".order"].join(""));typesig.push("t"+j);typesig.push("r"+j);string_typesig.push("t"+j);string_typesig.push("r"+j+".join()");proc_args.push("array"+j+".data");proc_args.push("array"+j+".stride");proc_args.push("array"+j+".offset|0");if(i>0){shapeLengthConditions.push("array"+proc.arrayArgs[0]+".shape.length===array"+j+".shape.length+"+(Math.abs(proc.arrayBlockIndices[0])-Math.abs(proc.arrayBlockIndices[i])));shapeConditions.push("array"+proc.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,proc.arrayBlockIndices[0])+"]===array"+j+".shape[shapeIndex+"+Math.max(0,proc.arrayBlockIndices[i])+"]")}}if(proc.arrayArgs.length>1){code.push("if (!("+shapeLengthConditions.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')");code.push("for(var shapeIndex=array"+proc.arrayArgs[0]+".shape.length-"+Math.abs(proc.arrayBlockIndices[0])+"; shapeIndex-->0;) {");code.push("if (!("+shapeConditions.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')");code.push("}")}for(var i=0;i<proc.scalarArgs.length;++i){proc_args.push("scalar"+proc.scalarArgs[i])}vars.push(["type=[",string_typesig.join(","),"].join()"].join(""));vars.push("proc=CACHED[type]");code.push("var "+vars.join(","));code.push(["if(!proc){","CACHED[type]=proc=compile([",typesig.join(","),"])}","return proc(",proc_args.join(","),")}"].join(""));if(proc.debug){console.log("-----Generated thunk:\n"+code.join("\n")+"\n----------")}var thunk=new Function("compile",code.join("\n"));return thunk(compile.bind(undefined,proc))}module.exports=createThunk},{"./compile.js":321}],323:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3=global.d3||{})})(this,function(exports){"use strict";var ascending=function(a,b){return a<b?-1:a>b?1:a>=b?0:NaN};var bisector=function(compare){if(compare.length===1)compare=ascendingComparator(compare);return{left:function(a,x,lo,hi){if(lo==null)lo=0;if(hi==null)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)<0)lo=mid+1;else hi=mid}return lo},right:function(a,x,lo,hi){if(lo==null)lo=0;if(hi==null)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)>0)hi=mid;else lo=mid+1}return lo}}};function ascendingComparator(f){return function(d,x){return ascending(f(d),x)}}var ascendingBisect=bisector(ascending);var bisectRight=ascendingBisect.right;var bisectLeft=ascendingBisect.left;var descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN};var number=function(x){return x===null?NaN:+x};var variance=function(array,f){var n=array.length,m=0,a,d,s=0,i=-1,j=0;if(f==null){while(++i<n){if(!isNaN(a=number(array[i]))){d=a-m;m+=d/++j;s+=d*(a-m)}}}else{while(++i<n){if(!isNaN(a=number(f(array[i],i,array)))){d=a-m;m+=d/++j;s+=d*(a-m)}}}if(j>1)return s/(j-1)};var deviation=function(array,f){var v=variance(array,f);return v?Math.sqrt(v):v};var extent=function(array,f){var i=-1,n=array.length,a,b,c;if(f==null){while(++i<n)if((b=array[i])!=null&&b>=b){a=c=b;break}while(++i<n)if((b=array[i])!=null){if(a>b)a=b;if(c<b)c=b}}else{while(++i<n)if((b=f(array[i],i,array))!=null&&b>=b){a=c=b;break}while(++i<n)if((b=f(array[i],i,array))!=null){if(a>b)a=b;if(c<b)c=b}}return[a,c]};var array=Array.prototype;var slice=array.slice;var map=array.map;var constant=function(x){return function(){return x}};var identity=function(x){return x};var range=function(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;var i=-1,n=Math.max(0,Math.ceil((stop-start)/step))|0,range=new Array(n);while(++i<n){range[i]=start+i*step}return range};var e10=Math.sqrt(50);var e5=Math.sqrt(10);var e2=Math.sqrt(2);var ticks=function(start,stop,count){var step=tickStep(start,stop,count);return range(Math.ceil(start/step)*step,Math.floor(stop/step)*step+step/2,step)};function tickStep(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;if(error>=e10)step1*=10;else if(error>=e5)step1*=5;else if(error>=e2)step1*=2;return stop<start?-step1:step1}var sturges=function(values){return Math.ceil(Math.log(values.length)/Math.LN2)+1};var histogram=function(){var value=identity,domain=extent,threshold=sturges;function histogram(data){var i,n=data.length,x,values=new Array(n);for(i=0;i<n;++i){values[i]=value(data[i],i,data)}var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);if(!Array.isArray(tz))tz=ticks(x0,x1,tz);var m=tz.length;while(tz[0]<=x0)tz.shift(),--m;while(tz[m-1]>=x1)tz.pop(),--m;var bins=new Array(m+1),bin;for(i=0;i<=m;++i){bin=bins[i]=[];bin.x0=i>0?tz[i-1]:x0;bin.x1=i<m?tz[i]:x1}for(i=0;i<n;++i){x=values[i];if(x0<=x&&x<=x1){bins[bisectRight(tz,x,0,m)].push(data[i])}}return bins}histogram.value=function(_){return arguments.length?(value=typeof _==="function"?_:constant(_),histogram):value};histogram.domain=function(_){return arguments.length?(domain=typeof _==="function"?_:constant([_[0],_[1]]),histogram):domain};histogram.thresholds=function(_){return arguments.length?(threshold=typeof _==="function"?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold};return histogram};var quantile=function(array,p,f){if(f==null)f=number;if(!(n=array.length))return;if((p=+p)<=0||n<2)return+f(array[0],0,array);if(p>=1)return+f(array[n-1],n-1,array);var n,h=(n-1)*p,i=Math.floor(h),a=+f(array[i],i,array),b=+f(array[i+1],i+1,array);return a+(b-a)*(h-i)};var freedmanDiaconis=function(values,min,max){values=map.call(values,number).sort(ascending);return Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(values.length,-1/3)))};var scott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(values.length,-1/3)))};var max=function(array,f){var i=-1,n=array.length,a,b;if(f==null){while(++i<n)if((b=array[i])!=null&&b>=b){a=b;break}while(++i<n)if((b=array[i])!=null&&b>a)a=b}else{while(++i<n)if((b=f(array[i],i,array))!=null&&b>=b){a=b;break}while(++i<n)if((b=f(array[i],i,array))!=null&&b>a)a=b}return a};var mean=function(array,f){var s=0,n=array.length,a,i=-1,j=n;if(f==null){while(++i<n)if(!isNaN(a=number(array[i])))s+=a;else--j}else{while(++i<n)if(!isNaN(a=number(f(array[i],i,array))))s+=a;else--j}if(j)return s/j};var median=function(array,f){var numbers=[],n=array.length,a,i=-1;if(f==null){while(++i<n)if(!isNaN(a=number(array[i])))numbers.push(a)}else{while(++i<n)if(!isNaN(a=number(f(array[i],i,array))))numbers.push(a)}return quantile(numbers.sort(ascending),.5)};var merge=function(arrays){var n=arrays.length,m,i=-1,j=0,merged,array;while(++i<n)j+=arrays[i].length;merged=new Array(j);while(--n>=0){array=arrays[n];m=array.length;while(--m>=0){merged[--j]=array[m]}}return merged};var min=function(array,f){var i=-1,n=array.length,a,b;if(f==null){while(++i<n)if((b=array[i])!=null&&b>=b){a=b;break}while(++i<n)if((b=array[i])!=null&&a>b)a=b}else{while(++i<n)if((b=f(array[i],i,array))!=null&&b>=b){a=b;break}while(++i<n)if((b=f(array[i],i,array))!=null&&a>b)a=b}return a};var pairs=function(array){var i=0,n=array.length-1,p=array[0],pairs=new Array(n<0?0:n);while(i<n)pairs[i]=[p,p=array[++i]];return pairs};var permute=function(array,indexes){var i=indexes.length,permutes=new Array(i);while(i--)permutes[i]=array[indexes[i]];return permutes};var scan=function(array,compare){if(!(n=array.length))return;var i=0,n,j=0,xi,xj=array[j];if(!compare)compare=ascending;while(++i<n)if(compare(xi=array[i],xj)<0||compare(xj,xj)!==0)xj=xi,j=i;if(compare(xj,xj)===0)return j};var shuffle=function(array,i0,i1){var m=(i1==null?array.length:i1)-(i0=i0==null?0:+i0),t,i;while(m){i=Math.random()*m--|0;t=array[m+i0];array[m+i0]=array[i+i0];array[i+i0]=t}return array};var sum=function(array,f){var s=0,n=array.length,a,i=-1;if(f==null){while(++i<n)if(a=+array[i])s+=a}else{while(++i<n)if(a=+f(array[i],i,array))s+=a}return s};var transpose=function(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length),transpose=new Array(m);++i<m;){for(var j=-1,n,row=transpose[i]=new Array(n);++j<n;){row[j]=matrix[j][i]}}return transpose};function length(d){return d.length}var zip=function(){return transpose(arguments)};exports.bisect=bisectRight;exports.bisectRight=bisectRight;exports.bisectLeft=bisectLeft;exports.ascending=ascending;exports.bisector=bisector;exports.descending=descending;exports.deviation=deviation;exports.extent=extent;exports.histogram=histogram;exports.thresholdFreedmanDiaconis=freedmanDiaconis;exports.thresholdScott=scott;exports.thresholdSturges=sturges;exports.max=max;exports.mean=mean;exports.median=median;exports.merge=merge;exports.min=min;exports.pairs=pairs;exports.permute=permute;exports.quantile=quantile;exports.range=range;exports.scan=scan;exports.shuffle=shuffle;exports.sum=sum;exports.ticks=ticks;exports.tickStep=tickStep;exports.transpose=transpose;exports.variance=variance;exports.zip=zip;Object.defineProperty(exports,"__esModule",{value:true})})},{}],324:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3=global.d3||{})})(this,function(exports){"use strict";var prefix="$";function Map(){}Map.prototype=map.prototype={constructor:Map,has:function(key){return prefix+key in this},get:function(key){return this[prefix+key]},set:function(key,value){this[prefix+key]=value;return this},remove:function(key){var property=prefix+key;return property in this&&delete this[property]},clear:function(){for(var property in this)if(property[0]===prefix)delete this[property]},keys:function(){var keys=[];for(var property in this)if(property[0]===prefix)keys.push(property.slice(1));return keys},values:function(){var values=[];for(var property in this)if(property[0]===prefix)values.push(this[property]);return values},entries:function(){var entries=[];for(var property in this)if(property[0]===prefix)entries.push({key:property.slice(1),value:this[property]});return entries},size:function(){var size=0;for(var property in this)if(property[0]===prefix)++size;return size},empty:function(){for(var property in this)if(property[0]===prefix)return false;return true},each:function(f){for(var property in this)if(property[0]===prefix)f(this[property],property.slice(1),this)}};function map(object,f){var map=new Map;if(object instanceof Map)object.each(function(value,key){map.set(key,value)});else if(Array.isArray(object)){var i=-1,n=object.length,o;if(f==null)while(++i<n)map.set(i,object[i]);else while(++i<n)map.set(f(o=object[i],i,object),o)}else if(object)for(var key in object)map.set(key,object[key]);return map}var nest=function(){var keys=[],sortKeys=[],sortValues,rollup,nest;function apply(array,depth,createResult,setResult){if(depth>=keys.length)return rollup!=null?rollup(array):sortValues!=null?array.sort(sortValues):array;var i=-1,n=array.length,key=keys[depth++],keyValue,value,valuesByKey=map(),values,result=createResult();while(++i<n){if(values=valuesByKey.get(keyValue=key(value=array[i])+"")){
values.push(value)}else{valuesByKey.set(keyValue,[value])}}valuesByKey.each(function(values,key){setResult(result,key,apply(values,depth,createResult,setResult))});return result}function entries(map$$1,depth){if(++depth>keys.length)return map$$1;var array,sortKey=sortKeys[depth-1];if(rollup!=null&&depth>=keys.length)array=map$$1.entries();else array=[],map$$1.each(function(v,k){array.push({key:k,values:entries(v,depth)})});return sortKey!=null?array.sort(function(a,b){return sortKey(a.key,b.key)}):array}return nest={object:function(array){return apply(array,0,createObject,setObject)},map:function(array){return apply(array,0,createMap,setMap)},entries:function(array){return entries(apply(array,0,createMap,setMap),0)},key:function(d){keys.push(d);return nest},sortKeys:function(order){sortKeys[keys.length-1]=order;return nest},sortValues:function(order){sortValues=order;return nest},rollup:function(f){rollup=f;return nest}}};function createObject(){return{}}function setObject(object,key,value){object[key]=value}function createMap(){return map()}function setMap(map$$1,key,value){map$$1.set(key,value)}function Set(){}var proto=map.prototype;Set.prototype=set.prototype={constructor:Set,has:proto.has,add:function(value){value+="";this[prefix+value]=value;return this},remove:proto.remove,clear:proto.clear,values:proto.keys,size:proto.size,empty:proto.empty,each:proto.each};function set(object,f){var set=new Set;if(object instanceof Set)object.each(function(value){set.add(value)});else if(object){var i=-1,n=object.length;if(f==null)while(++i<n)set.add(object[i]);else while(++i<n)set.add(f(object[i],i,object))}return set}var keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys};var values=function(map){var values=[];for(var key in map)values.push(map[key]);return values};var entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries};exports.nest=nest;exports.set=set;exports.map=map;exports.keys=keys;exports.values=values;exports.entries=entries;Object.defineProperty(exports,"__esModule",{value:true})})},{}],325:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3=global.d3||{})})(this,function(exports){"use strict";var define=function(constructor,factory,prototype){constructor.prototype=factory.prototype=prototype;prototype.constructor=constructor};function extend(parent,definition){var prototype=Object.create(parent.prototype);for(var key in definition)prototype[key]=definition[key];return prototype}function Color(){}var darker=.7;var brighter=1/darker;var reI="\\s*([+-]?\\d+)\\s*";var reN="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*";var reP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*";var reHex3=/^#([0-9a-f]{3})$/;var reHex6=/^#([0-9a-f]{6})$/;var reRgbInteger=new RegExp("^rgb\\("+[reI,reI,reI]+"\\)$");var reRgbPercent=new RegExp("^rgb\\("+[reP,reP,reP]+"\\)$");var reRgbaInteger=new RegExp("^rgba\\("+[reI,reI,reI,reN]+"\\)$");var reRgbaPercent=new RegExp("^rgba\\("+[reP,reP,reP,reN]+"\\)$");var reHslPercent=new RegExp("^hsl\\("+[reN,reP,reP]+"\\)$");var reHslaPercent=new RegExp("^hsla\\("+[reN,reP,reP,reN]+"\\)$");var named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};define(Color,color,{displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+""}});function color(format){var m;format=(format+"").trim().toLowerCase();return(m=reHex3.exec(format))?(m=parseInt(m[1],16),new Rgb(m>>8&15|m>>4&240,m>>4&15|m&240,(m&15)<<4|m&15,1)):(m=reHex6.exec(format))?rgbn(parseInt(m[1],16)):(m=reRgbInteger.exec(format))?new Rgb(m[1],m[2],m[3],1):(m=reRgbPercent.exec(format))?new Rgb(m[1]*255/100,m[2]*255/100,m[3]*255/100,1):(m=reRgbaInteger.exec(format))?rgba(m[1],m[2],m[3],m[4]):(m=reRgbaPercent.exec(format))?rgba(m[1]*255/100,m[2]*255/100,m[3]*255/100,m[4]):(m=reHslPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,1):(m=reHslaPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,m[4]):named.hasOwnProperty(format)?rgbn(named[format]):format==="transparent"?new Rgb(NaN,NaN,NaN,0):null}function rgbn(n){return new Rgb(n>>16&255,n>>8&255,n&255,1)}function rgba(r,g,b,a){if(a<=0)r=g=b=NaN;return new Rgb(r,g,b,a)}function rgbConvert(o){if(!(o instanceof Color))o=color(o);if(!o)return new Rgb;o=o.rgb();return new Rgb(o.r,o.g,o.b,o.opacity)}function rgb(r,g,b,opacity){return arguments.length===1?rgbConvert(r):new Rgb(r,g,b,opacity==null?1:opacity)}function Rgb(r,g,b,opacity){this.r=+r;this.g=+g;this.b=+b;this.opacity=+opacity}define(Rgb,rgb,extend(Color,{brighter:function(k){k=k==null?brighter:Math.pow(brighter,k);return new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},darker:function(k){k=k==null?darker:Math.pow(darker,k);return new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&(0<=this.g&&this.g<=255)&&(0<=this.b&&this.b<=255)&&(0<=this.opacity&&this.opacity<=1)},toString:function(){var a=this.opacity;a=isNaN(a)?1:Math.max(0,Math.min(1,a));return(a===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(a===1?")":", "+a+")")}}));function hsla(h,s,l,a){if(a<=0)h=s=l=NaN;else if(l<=0||l>=1)h=s=NaN;else if(s<=0)h=NaN;return new Hsl(h,s,l,a)}function hslConvert(o){if(o instanceof Hsl)return new Hsl(o.h,o.s,o.l,o.opacity);if(!(o instanceof Color))o=color(o);if(!o)return new Hsl;if(o instanceof Hsl)return o;o=o.rgb();var r=o.r/255,g=o.g/255,b=o.b/255,min=Math.min(r,g,b),max=Math.max(r,g,b),h=NaN,s=max-min,l=(max+min)/2;if(s){if(r===max)h=(g-b)/s+(g<b)*6;else if(g===max)h=(b-r)/s+2;else h=(r-g)/s+4;s/=l<.5?max+min:2-max-min;h*=60}else{s=l>0&&l<1?0:h}return new Hsl(h,s,l,o.opacity)}function hsl(h,s,l,opacity){return arguments.length===1?hslConvert(h):new Hsl(h,s,l,opacity==null?1:opacity)}function Hsl(h,s,l,opacity){this.h=+h;this.s=+s;this.l=+l;this.opacity=+opacity}define(Hsl,hsl,extend(Color,{brighter:function(k){k=k==null?brighter:Math.pow(brighter,k);return new Hsl(this.h,this.s,this.l*k,this.opacity)},darker:function(k){k=k==null?darker:Math.pow(darker,k);return new Hsl(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=this.h%360+(this.h<0)*360,s=isNaN(h)||isNaN(this.s)?0:this.s,l=this.l,m2=l+(l<.5?l:1-l)*s,m1=2*l-m2;return new Rgb(hsl2rgb(h>=240?h-240:h+120,m1,m2),hsl2rgb(h,m1,m2),hsl2rgb(h<120?h+240:h-120,m1,m2),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&(0<=this.l&&this.l<=1)&&(0<=this.opacity&&this.opacity<=1)}}));function hsl2rgb(h,m1,m2){return(h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1)*255}var deg2rad=Math.PI/180;var rad2deg=180/Math.PI;var Kn=18;var Xn=.95047;var Yn=1;var Zn=1.08883;var t0=4/29;var t1=6/29;var t2=3*t1*t1;var t3=t1*t1*t1;function labConvert(o){if(o instanceof Lab)return new Lab(o.l,o.a,o.b,o.opacity);if(o instanceof Hcl){var h=o.h*deg2rad;return new Lab(o.l,Math.cos(h)*o.c,Math.sin(h)*o.c,o.opacity)}if(!(o instanceof Rgb))o=rgbConvert(o);var b=rgb2xyz(o.r),a=rgb2xyz(o.g),l=rgb2xyz(o.b),x=xyz2lab((.4124564*b+.3575761*a+.1804375*l)/Xn),y=xyz2lab((.2126729*b+.7151522*a+.072175*l)/Yn),z=xyz2lab((.0193339*b+.119192*a+.9503041*l)/Zn);return new Lab(116*y-16,500*(x-y),200*(y-z),o.opacity)}function lab(l,a,b,opacity){return arguments.length===1?labConvert(l):new Lab(l,a,b,opacity==null?1:opacity)}function Lab(l,a,b,opacity){this.l=+l;this.a=+a;this.b=+b;this.opacity=+opacity}define(Lab,lab,extend(Color,{brighter:function(k){return new Lab(this.l+Kn*(k==null?1:k),this.a,this.b,this.opacity)},darker:function(k){return new Lab(this.l-Kn*(k==null?1:k),this.a,this.b,this.opacity)},rgb:function(){var y=(this.l+16)/116,x=isNaN(this.a)?y:y+this.a/500,z=isNaN(this.b)?y:y-this.b/200;y=Yn*lab2xyz(y);x=Xn*lab2xyz(x);z=Zn*lab2xyz(z);return new Rgb(xyz2rgb(3.2404542*x-1.5371385*y-.4985314*z),xyz2rgb(-.969266*x+1.8760108*y+.041556*z),xyz2rgb(.0556434*x-.2040259*y+1.0572252*z),this.opacity)}}));function xyz2lab(t){return t>t3?Math.pow(t,1/3):t/t2+t0}function lab2xyz(t){return t>t1?t*t*t:t2*(t-t0)}function xyz2rgb(x){return 255*(x<=.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055)}function rgb2xyz(x){return(x/=255)<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function hclConvert(o){if(o instanceof Hcl)return new Hcl(o.h,o.c,o.l,o.opacity);if(!(o instanceof Lab))o=labConvert(o);var h=Math.atan2(o.b,o.a)*rad2deg;return new Hcl(h<0?h+360:h,Math.sqrt(o.a*o.a+o.b*o.b),o.l,o.opacity)}function hcl(h,c,l,opacity){return arguments.length===1?hclConvert(h):new Hcl(h,c,l,opacity==null?1:opacity)}function Hcl(h,c,l,opacity){this.h=+h;this.c=+c;this.l=+l;this.opacity=+opacity}define(Hcl,hcl,extend(Color,{brighter:function(k){return new Hcl(this.h,this.c,this.l+Kn*(k==null?1:k),this.opacity)},darker:function(k){return new Hcl(this.h,this.c,this.l-Kn*(k==null?1:k),this.opacity)},rgb:function(){return labConvert(this).rgb()}}));var A=-.14861;var B=+1.78277;var C=-.29227;var D=-.90649;var E=+1.97294;var ED=E*D;var EB=E*B;var BC_DA=B*C-D*A;function cubehelixConvert(o){if(o instanceof Cubehelix)return new Cubehelix(o.h,o.s,o.l,o.opacity);if(!(o instanceof Rgb))o=rgbConvert(o);var r=o.r/255,g=o.g/255,b=o.b/255,l=(BC_DA*b+ED*r-EB*g)/(BC_DA+ED-EB),bl=b-l,k=(E*(g-l)-C*bl)/D,s=Math.sqrt(k*k+bl*bl)/(E*l*(1-l)),h=s?Math.atan2(k,bl)*rad2deg-120:NaN;return new Cubehelix(h<0?h+360:h,s,l,o.opacity)}function cubehelix(h,s,l,opacity){return arguments.length===1?cubehelixConvert(h):new Cubehelix(h,s,l,opacity==null?1:opacity)}function Cubehelix(h,s,l,opacity){this.h=+h;this.s=+s;this.l=+l;this.opacity=+opacity}define(Cubehelix,cubehelix,extend(Color,{brighter:function(k){k=k==null?brighter:Math.pow(brighter,k);return new Cubehelix(this.h,this.s,this.l*k,this.opacity)},darker:function(k){k=k==null?darker:Math.pow(darker,k);return new Cubehelix(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=isNaN(this.h)?0:(this.h+120)*deg2rad,l=+this.l,a=isNaN(this.s)?0:this.s*l*(1-l),cosh=Math.cos(h),sinh=Math.sin(h);return new Rgb(255*(l+a*(A*cosh+B*sinh)),255*(l+a*(C*cosh+D*sinh)),255*(l+a*(E*cosh)),this.opacity)}}));exports.color=color;exports.rgb=rgb;exports.hsl=hsl;exports.lab=lab;exports.hcl=hcl;exports.cubehelix=cubehelix;Object.defineProperty(exports,"__esModule",{value:true})})},{}],326:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3=global.d3||{})})(this,function(exports){"use strict";function formatDecimal(x,p){if((i=(x=p?x.toExponential(p-1):x.toExponential()).indexOf("e"))<0)return null;var i,coefficient=x.slice(0,i);return[coefficient.length>1?coefficient[0]+coefficient.slice(2):coefficient,+x.slice(i+1)]}function exponent(x){return x=formatDecimal(Math.abs(x)),x?x[1]:NaN}function formatGroup(grouping,thousands){return function(value,width){var i=value.length,t=[],j=0,g=grouping[0],length=0;while(i>0&&g>0){if(length+g+1>width)g=Math.max(1,width-length);t.push(value.substring(i-=g,i+g));if((length+=g+1)>width)break;g=grouping[j=(j+1)%grouping.length]}return t.reverse().join(thousands)}}function formatDefault(x,p){x=x.toPrecision(p);out:for(var n=x.length,i=1,i0=-1,i1;i<n;++i){switch(x[i]){case".":i0=i1=i;break;case"0":if(i0===0)i0=i;i1=i;break;case"e":break out;default:if(i0>0)i0=0;break}}return i0>0?x.slice(0,i0)+x.slice(i1+1):x}var prefixExponent;function formatPrefixAuto(x,p){var d=formatDecimal(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1],i=exponent-(prefixExponent=Math.max(-8,Math.min(8,Math.floor(exponent/3)))*3)+1,n=coefficient.length;return i===n?coefficient:i>n?coefficient+new Array(i-n+1).join("0"):i>0?coefficient.slice(0,i)+"."+coefficient.slice(i):"0."+new Array(1-i).join("0")+formatDecimal(x,Math.max(0,p+i-1))[0]}function formatRounded(x,p){var d=formatDecimal(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1];return exponent<0?"0."+new Array(-exponent).join("0")+coefficient:coefficient.length>exponent+1?coefficient.slice(0,exponent+1)+"."+coefficient.slice(exponent+1):coefficient+new Array(exponent-coefficient.length+2).join("0")}var formatTypes={"":formatDefault,"%":function(x,p){return(x*100).toFixed(p)},b:function(x){return Math.round(x).toString(2)},c:function(x){return x+""},d:function(x){return Math.round(x).toString(10)},e:function(x,p){return x.toExponential(p)},f:function(x,p){return x.toFixed(p)},g:function(x,p){return x.toPrecision(p)},o:function(x){return Math.round(x).toString(8)},p:function(x,p){return formatRounded(x*100,p)},r:formatRounded,s:formatPrefixAuto,X:function(x){return Math.round(x).toString(16).toUpperCase()},x:function(x){return Math.round(x).toString(16)}};var re=/^(?:(.)?([<>=^]))?([+\-\( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?([a-z%])?$/i;function formatSpecifier(specifier){return new FormatSpecifier(specifier)}function FormatSpecifier(specifier){if(!(match=re.exec(specifier)))throw new Error("invalid format: "+specifier);var match,fill=match[1]||" ",align=match[2]||">",sign=match[3]||"-",symbol=match[4]||"",zero=!!match[5],width=match[6]&&+match[6],comma=!!match[7],precision=match[8]&&+match[8].slice(1),type=match[9]||"";if(type==="n")comma=true,type="g";else if(!formatTypes[type])type="";if(zero||fill==="0"&&align==="=")zero=true,fill="0",align="=";this.fill=fill;this.align=align;this.sign=sign;this.symbol=symbol;this.zero=zero;this.width=width;this.comma=comma;this.precision=precision;this.type=type}FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,this.precision|0))+this.type};var prefixes=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function identity(x){return x}function formatLocale(locale){var group=locale.grouping&&locale.thousands?formatGroup(locale.grouping,locale.thousands):identity,currency=locale.currency,decimal=locale.decimal;function newFormat(specifier){specifier=formatSpecifier(specifier);var fill=specifier.fill,align=specifier.align,sign=specifier.sign,symbol=specifier.symbol,zero=specifier.zero,width=specifier.width,comma=specifier.comma,precision=specifier.precision,type=specifier.type;var prefix=symbol==="$"?currency[0]:symbol==="#"&&/[boxX]/.test(type)?"0"+type.toLowerCase():"",suffix=symbol==="$"?currency[1]:/[%p]/.test(type)?"%":"";var formatType=formatTypes[type],maybeSuffix=!type||/[defgprs%]/.test(type);precision=precision==null?type?6:12:/[gprs]/.test(type)?Math.max(1,Math.min(21,precision)):Math.max(0,Math.min(20,precision));function format(value){var valuePrefix=prefix,valueSuffix=suffix,i,n,c;if(type==="c"){valueSuffix=formatType(value)+valueSuffix;value=""}else{value=+value;var valueNegative=(value<0||1/value<0)&&(value*=-1,true);value=formatType(value,precision);if(valueNegative){i=-1,n=value.length;valueNegative=false;while(++i<n){if(c=value.charCodeAt(i),48<c&&c<58||type==="x"&&96<c&&c<103||type==="X"&&64<c&&c<71){valueNegative=true;break}}}valuePrefix=(valueNegative?sign==="("?sign:"-":sign==="-"||sign==="("?"":sign)+valuePrefix;valueSuffix=valueSuffix+(type==="s"?prefixes[8+prefixExponent/3]:"")+(valueNegative&&sign==="("?")":"");if(maybeSuffix){i=-1,n=value.length;while(++i<n){if(c=value.charCodeAt(i),48>c||c>57){valueSuffix=(c===46?decimal+value.slice(i+1):value.slice(i))+valueSuffix;value=value.slice(0,i);break}}}}if(comma&&!zero)value=group(value,Infinity);var length=valuePrefix.length+value.length+valueSuffix.length,padding=length<width?new Array(width-length+1).join(fill):"";if(comma&&zero)value=group(padding+value,padding.length?width-valueSuffix.length:Infinity),padding="";switch(align){case"<":return valuePrefix+value+valueSuffix+padding;case"=":return valuePrefix+padding+value+valueSuffix;case"^":return padding.slice(0,length=padding.length>>1)+valuePrefix+value+valueSuffix+padding.slice(length)}return padding+valuePrefix+value+valueSuffix}format.toString=function(){return specifier+""};return format}function formatPrefix(specifier,value){var f=newFormat((specifier=formatSpecifier(specifier),specifier.type="f",specifier)),e=Math.max(-8,Math.min(8,Math.floor(exponent(value)/3)))*3,k=Math.pow(10,-e),prefix=prefixes[8+e/3];return function(value){return f(k*value)+prefix}}return{format:newFormat,formatPrefix:formatPrefix}}var locale;defaultLocale({decimal:".",thousands:",",grouping:[3],currency:["$",""]});function defaultLocale(definition){locale=formatLocale(definition);exports.format=locale.format;exports.formatPrefix=locale.formatPrefix;return locale}function precisionFixed(step){return Math.max(0,-exponent(Math.abs(step)))}function precisionPrefix(step,value){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(exponent(value)/3)))*3-exponent(Math.abs(step)))}function precisionRound(step,max){step=Math.abs(step),max=Math.abs(max)-step;return Math.max(0,exponent(max)-exponent(step))+1}exports.formatDefaultLocale=defaultLocale;exports.formatLocale=formatLocale;exports.formatSpecifier=formatSpecifier;exports.precisionFixed=precisionFixed;exports.precisionPrefix=precisionPrefix;exports.precisionRound=precisionRound;Object.defineProperty(exports,"__esModule",{value:true})})},{}],327:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports,require("d3-array")):typeof define==="function"&&define.amd?define(["exports","d3-array"],factory):factory(global.d3=global.d3||{},global.d3)})(this,function(exports,d3Array){"use strict";var adder=function(){return new Adder};function Adder(){this.reset()}Adder.prototype={constructor:Adder,reset:function(){this.s=this.t=0},add:function(y){add(temp,y,this.t);add(this,temp.s,this.s);if(this.s)this.t+=temp.t;else this.s=temp.t},valueOf:function(){return this.s}};var temp=new Adder;function add(adder,a,b){var x=adder.s=a+b,bv=x-a,av=x-bv;adder.t=a-av+(b-bv)}var epsilon=1e-6;var epsilon2=1e-12;var pi=Math.PI;var halfPi=pi/2;var quarterPi=pi/4;var tau=pi*2;var degrees=180/pi;var radians=pi/180;var abs=Math.abs;var atan=Math.atan;var atan2=Math.atan2;var cos=Math.cos;var ceil=Math.ceil;var exp=Math.exp;var log=Math.log;var pow=Math.pow;var sin=Math.sin;var sign=Math.sign||function(x){return x>0?1:x<0?-1:0};var sqrt=Math.sqrt;var tan=Math.tan;function acos(x){return x>1?0:x<-1?pi:Math.acos(x)}function asin(x){return x>1?halfPi:x<-1?-halfPi:Math.asin(x)}function haversin(x){return(x=sin(x/2))*x}function noop(){}function streamGeometry(geometry,stream){if(geometry&&streamGeometryType.hasOwnProperty(geometry.type)){streamGeometryType[geometry.type](geometry,stream)}}var streamObjectType={Feature:function(feature,stream){streamGeometry(feature.geometry,stream)},FeatureCollection:function(object,stream){var features=object.features,i=-1,n=features.length;while(++i<n)streamGeometry(features[i].geometry,stream)}};var streamGeometryType={Sphere:function(object,stream){stream.sphere()},Point:function(object,stream){object=object.coordinates;stream.point(object[0],object[1],object[2])},MultiPoint:function(object,stream){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)object=coordinates[i],stream.point(object[0],object[1],object[2])},LineString:function(object,stream){streamLine(object.coordinates,stream,0)},MultiLineString:function(object,stream){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)streamLine(coordinates[i],stream,0)},Polygon:function(object,stream){streamPolygon(object.coordinates,stream)},MultiPolygon:function(object,stream){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)streamPolygon(coordinates[i],stream)},GeometryCollection:function(object,stream){var geometries=object.geometries,i=-1,n=geometries.length;while(++i<n)streamGeometry(geometries[i],stream)}};function streamLine(coordinates,stream,closed){var i=-1,n=coordinates.length-closed,coordinate;stream.lineStart();while(++i<n)coordinate=coordinates[i],stream.point(coordinate[0],coordinate[1],coordinate[2]);stream.lineEnd()}function streamPolygon(coordinates,stream){var i=-1,n=coordinates.length;stream.polygonStart();while(++i<n)streamLine(coordinates[i],stream,1);stream.polygonEnd()}var geoStream=function(object,stream){if(object&&streamObjectType.hasOwnProperty(object.type)){streamObjectType[object.type](object,stream)}else{streamGeometry(object,stream)}};var areaRingSum=adder();var areaSum=adder();var lambda00;var phi00;var lambda0;var cosPhi0;var sinPhi0;var areaStream={point:noop,lineStart:noop,lineEnd:noop,polygonStart:function(){areaRingSum.reset();areaStream.lineStart=areaRingStart;areaStream.lineEnd=areaRingEnd},polygonEnd:function(){var areaRing=+areaRingSum;areaSum.add(areaRing<0?tau+areaRing:areaRing);this.lineStart=this.lineEnd=this.point=noop},sphere:function(){areaSum.add(tau)}};function areaRingStart(){areaStream.point=areaPointFirst}function areaRingEnd(){areaPoint(lambda00,phi00)}function areaPointFirst(lambda,phi){areaStream.point=areaPoint;lambda00=lambda,phi00=phi;lambda*=radians,phi*=radians;lambda0=lambda,cosPhi0=cos(phi=phi/2+quarterPi),sinPhi0=sin(phi)}function areaPoint(lambda,phi){lambda*=radians,phi*=radians;phi=phi/2+quarterPi;var dLambda=lambda-lambda0,sdLambda=dLambda>=0?1:-1,adLambda=sdLambda*dLambda,cosPhi=cos(phi),sinPhi=sin(phi),k=sinPhi0*sinPhi,u=cosPhi0*cosPhi+k*cos(adLambda),v=k*sdLambda*sin(adLambda);areaRingSum.add(atan2(v,u));lambda0=lambda,cosPhi0=cosPhi,sinPhi0=sinPhi}var area=function(object){areaSum.reset();geoStream(object,areaStream);return areaSum*2};function spherical(cartesian){return[atan2(cartesian[1],cartesian[0]),asin(cartesian[2])]}function cartesian(spherical){var lambda=spherical[0],phi=spherical[1],cosPhi=cos(phi);return[cosPhi*cos(lambda),cosPhi*sin(lambda),sin(phi)]}function cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function cartesianAddInPlace(a,b){a[0]+=b[0],a[1]+=b[1],a[2]+=b[2]}function cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k]}function cartesianNormalizeInPlace(d){var l=sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l,d[1]/=l,d[2]/=l}var lambda0$1;var phi0;var lambda1;var phi1;var lambda2;var lambda00$1;var phi00$1;var p0;var deltaSum=adder();var ranges;var range$1;var boundsStream={point:boundsPoint,lineStart:boundsLineStart,lineEnd:boundsLineEnd,polygonStart:function(){boundsStream.point=boundsRingPoint;boundsStream.lineStart=boundsRingStart;boundsStream.lineEnd=boundsRingEnd;deltaSum.reset();areaStream.polygonStart()},polygonEnd:function(){areaStream.polygonEnd();boundsStream.point=boundsPoint;boundsStream.lineStart=boundsLineStart;boundsStream.lineEnd=boundsLineEnd;if(areaRingSum<0)lambda0$1=-(lambda1=180),phi0=-(phi1=90);else if(deltaSum>epsilon)phi1=90;else if(deltaSum<-epsilon)phi0=-90;range$1[0]=lambda0$1,range$1[1]=lambda1}};function boundsPoint(lambda,phi){ranges.push(range$1=[lambda0$1=lambda,lambda1=lambda]);if(phi<phi0)phi0=phi;if(phi>phi1)phi1=phi}function linePoint(lambda,phi){var p=cartesian([lambda*radians,phi*radians]);if(p0){var normal=cartesianCross(p0,p),equatorial=[normal[1],-normal[0],0],inflection=cartesianCross(equatorial,normal);cartesianNormalizeInPlace(inflection);inflection=spherical(inflection);var delta=lambda-lambda2,sign$$1=delta>0?1:-1,lambdai=inflection[0]*degrees*sign$$1,phii,antimeridian=abs(delta)>180;if(antimeridian^(sign$$1*lambda2<lambdai&&lambdai<sign$$1*lambda)){phii=inflection[1]*degrees;if(phii>phi1)phi1=phii}else if(lambdai=(lambdai+360)%360-180,antimeridian^(sign$$1*lambda2<lambdai&&lambdai<sign$$1*lambda)){phii=-inflection[1]*degrees;if(phii<phi0)phi0=phii}else{if(phi<phi0)phi0=phi;if(phi>phi1)phi1=phi}if(antimeridian){if(lambda<lambda2){if(angle(lambda0$1,lambda)>angle(lambda0$1,lambda1))lambda1=lambda}else{if(angle(lambda,lambda1)>angle(lambda0$1,lambda1))lambda0$1=lambda}}else{if(lambda1>=lambda0$1){if(lambda<lambda0$1)lambda0$1=lambda;if(lambda>lambda1)lambda1=lambda}else{if(lambda>lambda2){if(angle(lambda0$1,lambda)>angle(lambda0$1,lambda1))lambda1=lambda}else{if(angle(lambda,lambda1)>angle(lambda0$1,lambda1))lambda0$1=lambda}}}}else{boundsPoint(lambda,phi)}p0=p,lambda2=lambda}function boundsLineStart(){boundsStream.point=linePoint}function boundsLineEnd(){range$1[0]=lambda0$1,range$1[1]=lambda1;boundsStream.point=boundsPoint;p0=null}function boundsRingPoint(lambda,phi){if(p0){var delta=lambda-lambda2;deltaSum.add(abs(delta)>180?delta+(delta>0?360:-360):delta)}else{lambda00$1=lambda,phi00$1=phi}areaStream.point(lambda,phi);linePoint(lambda,phi)}function boundsRingStart(){areaStream.lineStart()}function boundsRingEnd(){boundsRingPoint(lambda00$1,phi00$1);areaStream.lineEnd();if(abs(deltaSum)>epsilon)lambda0$1=-(lambda1=180);range$1[0]=lambda0$1,range$1[1]=lambda1;p0=null}function angle(lambda0,lambda1){return(lambda1-=lambda0)<0?lambda1+360:lambda1}function rangeCompare(a,b){return a[0]-b[0]}function rangeContains(range$$1,x){return range$$1[0]<=range$$1[1]?range$$1[0]<=x&&x<=range$$1[1]:x<range$$1[0]||range$$1[1]<x}var bounds=function(feature){var i,n,a,b,merged,deltaMax,delta;phi1=lambda1=-(lambda0$1=phi0=Infinity);ranges=[];geoStream(feature,boundsStream);if(n=ranges.length){ranges.sort(rangeCompare);for(i=1,a=ranges[0],merged=[a];i<n;++i){b=ranges[i];if(rangeContains(a,b[0])||rangeContains(a,b[1])){if(angle(a[0],b[1])>angle(a[0],a[1]))a[1]=b[1];if(angle(b[0],a[1])>angle(a[0],a[1]))a[0]=b[0]}else{merged.push(a=b)}}for(deltaMax=-Infinity,n=merged.length-1,i=0,a=merged[n];i<=n;a=b,++i){b=merged[i];if((delta=angle(a[1],b[0]))>deltaMax)deltaMax=delta,lambda0$1=b[0],lambda1=a[1]}}ranges=range$1=null;return lambda0$1===Infinity||phi0===Infinity?[[NaN,NaN],[NaN,NaN]]:[[lambda0$1,phi0],[lambda1,phi1]]};var W0;var W1;var X0;var Y0;var Z0;var X1;var Y1;var Z1;var X2;var Y2;var Z2;var lambda00$2;var phi00$2;var x0;var y0;var z0;var centroidStream={sphere:noop,point:centroidPoint,lineStart:centroidLineStart,lineEnd:centroidLineEnd,polygonStart:function(){centroidStream.lineStart=centroidRingStart;centroidStream.lineEnd=centroidRingEnd},polygonEnd:function(){centroidStream.lineStart=centroidLineStart;centroidStream.lineEnd=centroidLineEnd}};function centroidPoint(lambda,phi){lambda*=radians,phi*=radians;var cosPhi=cos(phi);centroidPointCartesian(cosPhi*cos(lambda),cosPhi*sin(lambda),sin(phi))}function centroidPointCartesian(x,y,z){++W0;X0+=(x-X0)/W0;Y0+=(y-Y0)/W0;Z0+=(z-Z0)/W0}function centroidLineStart(){centroidStream.point=centroidLinePointFirst}function centroidLinePointFirst(lambda,phi){lambda*=radians,phi*=radians;var cosPhi=cos(phi);x0=cosPhi*cos(lambda);y0=cosPhi*sin(lambda);z0=sin(phi);centroidStream.point=centroidLinePoint;centroidPointCartesian(x0,y0,z0)}function centroidLinePoint(lambda,phi){lambda*=radians,phi*=radians;var cosPhi=cos(phi),x=cosPhi*cos(lambda),y=cosPhi*sin(lambda),z=sin(phi),w=atan2(sqrt((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);W1+=w;X1+=w*(x0+(x0=x));Y1+=w*(y0+(y0=y));Z1+=w*(z0+(z0=z));centroidPointCartesian(x0,y0,z0)}function centroidLineEnd(){centroidStream.point=centroidPoint}function centroidRingStart(){centroidStream.point=centroidRingPointFirst}function centroidRingEnd(){centroidRingPoint(lambda00$2,phi00$2);centroidStream.point=centroidPoint}function centroidRingPointFirst(lambda,phi){lambda00$2=lambda,phi00$2=phi;lambda*=radians,phi*=radians;centroidStream.point=centroidRingPoint;var cosPhi=cos(phi);x0=cosPhi*cos(lambda);y0=cosPhi*sin(lambda);z0=sin(phi);centroidPointCartesian(x0,y0,z0)}function centroidRingPoint(lambda,phi){lambda*=radians,phi*=radians;var cosPhi=cos(phi),x=cosPhi*cos(lambda),y=cosPhi*sin(lambda),z=sin(phi),cx=y0*z-z0*y,cy=z0*x-x0*z,cz=x0*y-y0*x,m=sqrt(cx*cx+cy*cy+cz*cz),u=x0*x+y0*y+z0*z,v=m&&-acos(u)/m,w=atan2(m,u);X2+=v*cx;Y2+=v*cy;Z2+=v*cz;W1+=w;X1+=w*(x0+(x0=x));Y1+=w*(y0+(y0=y));Z1+=w*(z0+(z0=z));centroidPointCartesian(x0,y0,z0)}var centroid=function(object){W0=W1=X0=Y0=Z0=X1=Y1=Z1=X2=Y2=Z2=0;geoStream(object,centroidStream);var x=X2,y=Y2,z=Z2,m=x*x+y*y+z*z;if(m<epsilon2){x=X1,y=Y1,z=Z1;if(W1<epsilon)x=X0,y=Y0,z=Z0;m=x*x+y*y+z*z;if(m<epsilon2)return[NaN,NaN]}return[atan2(y,x)*degrees,asin(z/sqrt(m))*degrees]};var constant=function(x){return function(){return x}};var compose=function(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1])}if(a.invert&&b.invert)compose.invert=function(x,y){return x=b.invert(x,y),x&&a.invert(x[0],x[1])};return compose};function rotationIdentity(lambda,phi){return[lambda>pi?lambda-tau:lambda<-pi?lambda+tau:lambda,phi]}rotationIdentity.invert=rotationIdentity;function rotateRadians(deltaLambda,deltaPhi,deltaGamma){return(deltaLambda%=tau)?deltaPhi||deltaGamma?compose(rotationLambda(deltaLambda),rotationPhiGamma(deltaPhi,deltaGamma)):rotationLambda(deltaLambda):deltaPhi||deltaGamma?rotationPhiGamma(deltaPhi,deltaGamma):rotationIdentity}function forwardRotationLambda(deltaLambda){return function(lambda,phi){return lambda+=deltaLambda,[lambda>pi?lambda-tau:lambda<-pi?lambda+tau:lambda,phi]}}function rotationLambda(deltaLambda){var rotation=forwardRotationLambda(deltaLambda);
rotation.invert=forwardRotationLambda(-deltaLambda);return rotation}function rotationPhiGamma(deltaPhi,deltaGamma){var cosDeltaPhi=cos(deltaPhi),sinDeltaPhi=sin(deltaPhi),cosDeltaGamma=cos(deltaGamma),sinDeltaGamma=sin(deltaGamma);function rotation(lambda,phi){var cosPhi=cos(phi),x=cos(lambda)*cosPhi,y=sin(lambda)*cosPhi,z=sin(phi),k=z*cosDeltaPhi+x*sinDeltaPhi;return[atan2(y*cosDeltaGamma-k*sinDeltaGamma,x*cosDeltaPhi-z*sinDeltaPhi),asin(k*cosDeltaGamma+y*sinDeltaGamma)]}rotation.invert=function(lambda,phi){var cosPhi=cos(phi),x=cos(lambda)*cosPhi,y=sin(lambda)*cosPhi,z=sin(phi),k=z*cosDeltaGamma-y*sinDeltaGamma;return[atan2(y*cosDeltaGamma+z*sinDeltaGamma,x*cosDeltaPhi+k*sinDeltaPhi),asin(k*cosDeltaPhi-x*sinDeltaPhi)]};return rotation}var rotation=function(rotate){rotate=rotateRadians(rotate[0]*radians,rotate[1]*radians,rotate.length>2?rotate[2]*radians:0);function forward(coordinates){coordinates=rotate(coordinates[0]*radians,coordinates[1]*radians);return coordinates[0]*=degrees,coordinates[1]*=degrees,coordinates}forward.invert=function(coordinates){coordinates=rotate.invert(coordinates[0]*radians,coordinates[1]*radians);return coordinates[0]*=degrees,coordinates[1]*=degrees,coordinates};return forward};function circleStream(stream,radius,delta,direction,t0,t1){if(!delta)return;var cosRadius=cos(radius),sinRadius=sin(radius),step=direction*delta;if(t0==null){t0=radius+direction*tau;t1=radius-step/2}else{t0=circleRadius(cosRadius,t0);t1=circleRadius(cosRadius,t1);if(direction>0?t0<t1:t0>t1)t0+=direction*tau}for(var point,t=t0;direction>0?t>t1:t<t1;t-=step){point=spherical([cosRadius,-sinRadius*cos(t),-sinRadius*sin(t)]);stream.point(point[0],point[1])}}function circleRadius(cosRadius,point){point=cartesian(point),point[0]-=cosRadius;cartesianNormalizeInPlace(point);var radius=acos(-point[1]);return((-point[2]<0?-radius:radius)+tau-epsilon)%tau}var circle=function(){var center=constant([0,0]),radius=constant(90),precision=constant(6),ring,rotate,stream={point:point};function point(x,y){ring.push(x=rotate(x,y));x[0]*=degrees,x[1]*=degrees}function circle(){var c=center.apply(this,arguments),r=radius.apply(this,arguments)*radians,p=precision.apply(this,arguments)*radians;ring=[];rotate=rotateRadians(-c[0]*radians,-c[1]*radians,0).invert;circleStream(stream,r,p,1);c={type:"Polygon",coordinates:[ring]};ring=rotate=null;return c}circle.center=function(_){return arguments.length?(center=typeof _==="function"?_:constant([+_[0],+_[1]]),circle):center};circle.radius=function(_){return arguments.length?(radius=typeof _==="function"?_:constant(+_),circle):radius};circle.precision=function(_){return arguments.length?(precision=typeof _==="function"?_:constant(+_),circle):precision};return circle};var clipBuffer=function(){var lines=[],line;return{point:function(x,y){line.push([x,y])},lineStart:function(){lines.push(line=[])},lineEnd:noop,rejoin:function(){if(lines.length>1)lines.push(lines.pop().concat(lines.shift()))},result:function(){var result=lines;lines=[];line=null;return result}}};var clipLine=function(a,b,x0,y0,x1,y1){var ax=a[0],ay=a[1],bx=b[0],by=b[1],t0=0,t1=1,dx=bx-ax,dy=by-ay,r;r=x0-ax;if(!dx&&r>0)return;r/=dx;if(dx<0){if(r<t0)return;if(r<t1)t1=r}else if(dx>0){if(r>t1)return;if(r>t0)t0=r}r=x1-ax;if(!dx&&r<0)return;r/=dx;if(dx<0){if(r>t1)return;if(r>t0)t0=r}else if(dx>0){if(r<t0)return;if(r<t1)t1=r}r=y0-ay;if(!dy&&r>0)return;r/=dy;if(dy<0){if(r<t0)return;if(r<t1)t1=r}else if(dy>0){if(r>t1)return;if(r>t0)t0=r}r=y1-ay;if(!dy&&r<0)return;r/=dy;if(dy<0){if(r>t1)return;if(r>t0)t0=r}else if(dy>0){if(r<t0)return;if(r<t1)t1=r}if(t0>0)a[0]=ax+t0*dx,a[1]=ay+t0*dy;if(t1<1)b[0]=ax+t1*dx,b[1]=ay+t1*dy;return true};var pointEqual=function(a,b){return abs(a[0]-b[0])<epsilon&&abs(a[1]-b[1])<epsilon};function Intersection(point,points,other,entry){this.x=point;this.z=points;this.o=other;this.e=entry;this.v=false;this.n=this.p=null}var clipPolygon=function(segments,compareIntersection,startInside,interpolate,stream){var subject=[],clip=[],i,n;segments.forEach(function(segment){if((n=segment.length-1)<=0)return;var n,p0=segment[0],p1=segment[n],x;if(pointEqual(p0,p1)){stream.lineStart();for(i=0;i<n;++i)stream.point((p0=segment[i])[0],p0[1]);stream.lineEnd();return}subject.push(x=new Intersection(p0,segment,null,true));clip.push(x.o=new Intersection(p0,null,x,false));subject.push(x=new Intersection(p1,segment,null,false));clip.push(x.o=new Intersection(p1,null,x,true))});if(!subject.length)return;clip.sort(compareIntersection);link(subject);link(clip);for(i=0,n=clip.length;i<n;++i){clip[i].e=startInside=!startInside}var start=subject[0],points,point;while(1){var current=start,isSubject=true;while(current.v)if((current=current.n)===start)return;points=current.z;stream.lineStart();do{current.v=current.o.v=true;if(current.e){if(isSubject){for(i=0,n=points.length;i<n;++i)stream.point((point=points[i])[0],point[1])}else{interpolate(current.x,current.n.x,1,stream)}current=current.n}else{if(isSubject){points=current.p.z;for(i=points.length-1;i>=0;--i)stream.point((point=points[i])[0],point[1])}else{interpolate(current.x,current.p.x,-1,stream)}current=current.p}current=current.o;points=current.z;isSubject=!isSubject}while(!current.v);stream.lineEnd()}};function link(array){if(!(n=array.length))return;var n,i=0,a=array[0],b;while(++i<n){a.n=b=array[i];b.p=a;a=b}a.n=b=array[0];b.p=a}var clipMax=1e9;var clipMin=-clipMax;function clipExtent(x0,y0,x1,y1){function visible(x,y){return x0<=x&&x<=x1&&y0<=y&&y<=y1}function interpolate(from,to,direction,stream){var a=0,a1=0;if(from==null||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoint(from,to)<0^direction>0){do stream.point(a===0||a===3?x0:x1,a>1?y1:y0);while((a=(a+direction+4)%4)!==a1)}else{stream.point(to[0],to[1])}}function corner(p,direction){return abs(p[0]-x0)<epsilon?direction>0?0:3:abs(p[0]-x1)<epsilon?direction>0?2:1:abs(p[1]-y0)<epsilon?direction>0?1:0:direction>0?3:2}function compareIntersection(a,b){return comparePoint(a.x,b.x)}function comparePoint(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:ca===0?b[1]-a[1]:ca===1?a[0]-b[0]:ca===2?a[1]-b[1]:b[0]-a[0]}return function(stream){var activeStream=stream,bufferStream=clipBuffer(),segments,polygon,ring,x__,y__,v__,x_,y_,v_,first,clean;var clipStream={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:polygonStart,polygonEnd:polygonEnd};function point(x,y){if(visible(x,y))activeStream.point(x,y)}function polygonInside(){var winding=0;for(var i=0,n=polygon.length;i<n;++i){for(var ring=polygon[i],j=1,m=ring.length,point=ring[0],a0,a1,b0=point[0],b1=point[1];j<m;++j){a0=b0,a1=b1,point=ring[j],b0=point[0],b1=point[1];if(a1<=y1){if(b1>y1&&(b0-a0)*(y1-a1)>(b1-a1)*(x0-a0))++winding}else{if(b1<=y1&&(b0-a0)*(y1-a1)<(b1-a1)*(x0-a0))--winding}}}return winding}function polygonStart(){activeStream=bufferStream,segments=[],polygon=[],clean=true}function polygonEnd(){var startInside=polygonInside(),cleanInside=clean&&startInside,visible=(segments=d3Array.merge(segments)).length;if(cleanInside||visible){stream.polygonStart();if(cleanInside){stream.lineStart();interpolate(null,null,1,stream);stream.lineEnd()}if(visible){clipPolygon(segments,compareIntersection,startInside,interpolate,stream)}stream.polygonEnd()}activeStream=stream,segments=polygon=ring=null}function lineStart(){clipStream.point=linePoint;if(polygon)polygon.push(ring=[]);first=true;v_=false;x_=y_=NaN}function lineEnd(){if(segments){linePoint(x__,y__);if(v__&&v_)bufferStream.rejoin();segments.push(bufferStream.result())}clipStream.point=point;if(v_)activeStream.lineEnd()}function linePoint(x,y){var v=visible(x,y);if(polygon)ring.push([x,y]);if(first){x__=x,y__=y,v__=v;first=false;if(v){activeStream.lineStart();activeStream.point(x,y)}}else{if(v&&v_)activeStream.point(x,y);else{var a=[x_=Math.max(clipMin,Math.min(clipMax,x_)),y_=Math.max(clipMin,Math.min(clipMax,y_))],b=[x=Math.max(clipMin,Math.min(clipMax,x)),y=Math.max(clipMin,Math.min(clipMax,y))];if(clipLine(a,b,x0,y0,x1,y1)){if(!v_){activeStream.lineStart();activeStream.point(a[0],a[1])}activeStream.point(b[0],b[1]);if(!v)activeStream.lineEnd();clean=false}else if(v){activeStream.lineStart();activeStream.point(x,y);clean=false}}}x_=x,y_=y,v_=v}return clipStream}}var extent=function(){var x0=0,y0=0,x1=960,y1=500,cache,cacheStream,clip;return clip={stream:function(stream){return cache&&cacheStream===stream?cache:cache=clipExtent(x0,y0,x1,y1)(cacheStream=stream)},extent:function(_){return arguments.length?(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1],cache=cacheStream=null,clip):[[x0,y0],[x1,y1]]}}};var lengthSum=adder();var lambda0$2;var sinPhi0$1;var cosPhi0$1;var lengthStream={sphere:noop,point:noop,lineStart:lengthLineStart,lineEnd:noop,polygonStart:noop,polygonEnd:noop};function lengthLineStart(){lengthStream.point=lengthPointFirst;lengthStream.lineEnd=lengthLineEnd}function lengthLineEnd(){lengthStream.point=lengthStream.lineEnd=noop}function lengthPointFirst(lambda,phi){lambda*=radians,phi*=radians;lambda0$2=lambda,sinPhi0$1=sin(phi),cosPhi0$1=cos(phi);lengthStream.point=lengthPoint}function lengthPoint(lambda,phi){lambda*=radians,phi*=radians;var sinPhi=sin(phi),cosPhi=cos(phi),delta=abs(lambda-lambda0$2),cosDelta=cos(delta),sinDelta=sin(delta),x=cosPhi*sinDelta,y=cosPhi0$1*sinPhi-sinPhi0$1*cosPhi*cosDelta,z=sinPhi0$1*sinPhi+cosPhi0$1*cosPhi*cosDelta;lengthSum.add(atan2(sqrt(x*x+y*y),z));lambda0$2=lambda,sinPhi0$1=sinPhi,cosPhi0$1=cosPhi}var length=function(object){lengthSum.reset();geoStream(object,lengthStream);return+lengthSum};var coordinates=[null,null];var object={type:"LineString",coordinates:coordinates};var distance=function(a,b){coordinates[0]=a;coordinates[1]=b;return length(object)};function graticuleX(y0,y1,dy){var y=d3Array.range(y0,y1-epsilon,dy).concat(y1);return function(x){return y.map(function(y){return[x,y]})}}function graticuleY(x0,x1,dx){var x=d3Array.range(x0,x1-epsilon,dx).concat(x1);return function(y){return x.map(function(x){return[x,y]})}}function graticule(){var x1,x0,X1,X0,y1,y0,Y1,Y0,dx=10,dy=dx,DX=90,DY=360,x,y,X,Y,precision=2.5;function graticule(){return{type:"MultiLineString",coordinates:lines()}}function lines(){return d3Array.range(ceil(X0/DX)*DX,X1,DX).map(X).concat(d3Array.range(ceil(Y0/DY)*DY,Y1,DY).map(Y)).concat(d3Array.range(ceil(x0/dx)*dx,x1,dx).filter(function(x){return abs(x%DX)>epsilon}).map(x)).concat(d3Array.range(ceil(y0/dy)*dy,y1,dy).filter(function(y){return abs(y%DY)>epsilon}).map(y))}graticule.lines=function(){return lines().map(function(coordinates){return{type:"LineString",coordinates:coordinates}})};graticule.outline=function(){return{type:"Polygon",coordinates:[X(X0).concat(Y(Y1).slice(1),X(X1).reverse().slice(1),Y(Y0).reverse().slice(1))]}};graticule.extent=function(_){if(!arguments.length)return graticule.extentMinor();return graticule.extentMajor(_).extentMinor(_)};graticule.extentMajor=function(_){if(!arguments.length)return[[X0,Y0],[X1,Y1]];X0=+_[0][0],X1=+_[1][0];Y0=+_[0][1],Y1=+_[1][1];if(X0>X1)_=X0,X0=X1,X1=_;if(Y0>Y1)_=Y0,Y0=Y1,Y1=_;return graticule.precision(precision)};graticule.extentMinor=function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];x0=+_[0][0],x1=+_[1][0];y0=+_[0][1],y1=+_[1][1];if(x0>x1)_=x0,x0=x1,x1=_;if(y0>y1)_=y0,y0=y1,y1=_;return graticule.precision(precision)};graticule.step=function(_){if(!arguments.length)return graticule.stepMinor();return graticule.stepMajor(_).stepMinor(_)};graticule.stepMajor=function(_){if(!arguments.length)return[DX,DY];DX=+_[0],DY=+_[1];return graticule};graticule.stepMinor=function(_){if(!arguments.length)return[dx,dy];dx=+_[0],dy=+_[1];return graticule};graticule.precision=function(_){if(!arguments.length)return precision;precision=+_;x=graticuleX(y0,y1,90);y=graticuleY(x0,x1,precision);X=graticuleX(Y0,Y1,90);Y=graticuleY(X0,X1,precision);return graticule};return graticule.extentMajor([[-180,-90+epsilon],[180,90-epsilon]]).extentMinor([[-180,-80-epsilon],[180,80+epsilon]])}function graticule10(){return graticule()()}var interpolate=function(a,b){var x0=a[0]*radians,y0=a[1]*radians,x1=b[0]*radians,y1=b[1]*radians,cy0=cos(y0),sy0=sin(y0),cy1=cos(y1),sy1=sin(y1),kx0=cy0*cos(x0),ky0=cy0*sin(x0),kx1=cy1*cos(x1),ky1=cy1*sin(x1),d=2*asin(sqrt(haversin(y1-y0)+cy0*cy1*haversin(x1-x0))),k=sin(d);var interpolate=d?function(t){var B=sin(t*=d)/k,A=sin(d-t)/k,x=A*kx0+B*kx1,y=A*ky0+B*ky1,z=A*sy0+B*sy1;return[atan2(y,x)*degrees,atan2(z,sqrt(x*x+y*y))*degrees]}:function(){return[x0*degrees,y0*degrees]};interpolate.distance=d;return interpolate};var identity=function(x){return x};var areaSum$1=adder();var areaRingSum$1=adder();var x00;var y00;var x0$1;var y0$1;var areaStream$1={point:noop,lineStart:noop,lineEnd:noop,polygonStart:function(){areaStream$1.lineStart=areaRingStart$1;areaStream$1.lineEnd=areaRingEnd$1},polygonEnd:function(){areaStream$1.lineStart=areaStream$1.lineEnd=areaStream$1.point=noop;areaSum$1.add(abs(areaRingSum$1));areaRingSum$1.reset()},result:function(){var area=areaSum$1/2;areaSum$1.reset();return area}};function areaRingStart$1(){areaStream$1.point=areaPointFirst$1}function areaPointFirst$1(x,y){areaStream$1.point=areaPoint$1;x00=x0$1=x,y00=y0$1=y}function areaPoint$1(x,y){areaRingSum$1.add(y0$1*x-x0$1*y);x0$1=x,y0$1=y}function areaRingEnd$1(){areaPoint$1(x00,y00)}var x0$2=Infinity;var y0$2=x0$2;var x1=-x0$2;var y1=x1;var boundsStream$1={point:boundsPoint$1,lineStart:noop,lineEnd:noop,polygonStart:noop,polygonEnd:noop,result:function(){var bounds=[[x0$2,y0$2],[x1,y1]];x1=y1=-(y0$2=x0$2=Infinity);return bounds}};function boundsPoint$1(x,y){if(x<x0$2)x0$2=x;if(x>x1)x1=x;if(y<y0$2)y0$2=y;if(y>y1)y1=y}var X0$1=0;var Y0$1=0;var Z0$1=0;var X1$1=0;var Y1$1=0;var Z1$1=0;var X2$1=0;var Y2$1=0;var Z2$1=0;var x00$1;var y00$1;var x0$3;var y0$3;var centroidStream$1={point:centroidPoint$1,lineStart:centroidLineStart$1,lineEnd:centroidLineEnd$1,polygonStart:function(){centroidStream$1.lineStart=centroidRingStart$1;centroidStream$1.lineEnd=centroidRingEnd$1},polygonEnd:function(){centroidStream$1.point=centroidPoint$1;centroidStream$1.lineStart=centroidLineStart$1;centroidStream$1.lineEnd=centroidLineEnd$1},result:function(){var centroid=Z2$1?[X2$1/Z2$1,Y2$1/Z2$1]:Z1$1?[X1$1/Z1$1,Y1$1/Z1$1]:Z0$1?[X0$1/Z0$1,Y0$1/Z0$1]:[NaN,NaN];X0$1=Y0$1=Z0$1=X1$1=Y1$1=Z1$1=X2$1=Y2$1=Z2$1=0;return centroid}};function centroidPoint$1(x,y){X0$1+=x;Y0$1+=y;++Z0$1}function centroidLineStart$1(){centroidStream$1.point=centroidPointFirstLine}function centroidPointFirstLine(x,y){centroidStream$1.point=centroidPointLine;centroidPoint$1(x0$3=x,y0$3=y)}function centroidPointLine(x,y){var dx=x-x0$3,dy=y-y0$3,z=sqrt(dx*dx+dy*dy);X1$1+=z*(x0$3+x)/2;Y1$1+=z*(y0$3+y)/2;Z1$1+=z;centroidPoint$1(x0$3=x,y0$3=y)}function centroidLineEnd$1(){centroidStream$1.point=centroidPoint$1}function centroidRingStart$1(){centroidStream$1.point=centroidPointFirstRing}function centroidRingEnd$1(){centroidPointRing(x00$1,y00$1)}function centroidPointFirstRing(x,y){centroidStream$1.point=centroidPointRing;centroidPoint$1(x00$1=x0$3=x,y00$1=y0$3=y)}function centroidPointRing(x,y){var dx=x-x0$3,dy=y-y0$3,z=sqrt(dx*dx+dy*dy);X1$1+=z*(x0$3+x)/2;Y1$1+=z*(y0$3+y)/2;Z1$1+=z;z=y0$3*x-x0$3*y;X2$1+=z*(x0$3+x);Y2$1+=z*(y0$3+y);Z2$1+=z*3;centroidPoint$1(x0$3=x,y0$3=y)}function PathContext(context){this._context=context}PathContext.prototype={_radius:4.5,pointRadius:function(_){return this._radius=_,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){if(this._line===0)this._context.closePath();this._point=NaN},point:function(x,y){switch(this._point){case 0:{this._context.moveTo(x,y);this._point=1;break}case 1:{this._context.lineTo(x,y);break}default:{this._context.moveTo(x+this._radius,y);this._context.arc(x,y,this._radius,0,tau);break}}},result:noop};function PathString(){this._string=[]}PathString.prototype={_circle:circle$1(4.5),pointRadius:function(_){return this._circle=circle$1(_),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){if(this._line===0)this._string.push("Z");this._point=NaN},point:function(x,y){switch(this._point){case 0:{this._string.push("M",x,",",y);this._point=1;break}case 1:{this._string.push("L",x,",",y);break}default:{this._string.push("M",x,",",y,this._circle);break}}},result:function(){if(this._string.length){var result=this._string.join("");this._string=[];return result}}};function circle$1(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+2*radius+"z"}var index=function(projection,context){var pointRadius=4.5,projectionStream,contextStream;function path(object){if(object){if(typeof pointRadius==="function")contextStream.pointRadius(+pointRadius.apply(this,arguments));geoStream(object,projectionStream(contextStream))}return contextStream.result()}path.area=function(object){geoStream(object,projectionStream(areaStream$1));return areaStream$1.result()};path.bounds=function(object){geoStream(object,projectionStream(boundsStream$1));return boundsStream$1.result()};path.centroid=function(object){geoStream(object,projectionStream(centroidStream$1));return centroidStream$1.result()};path.projection=function(_){return arguments.length?(projectionStream=_==null?(projection=null,identity):(projection=_).stream,path):projection};path.context=function(_){if(!arguments.length)return context;contextStream=_==null?(context=null,new PathString):new PathContext(context=_);if(typeof pointRadius!=="function")contextStream.pointRadius(pointRadius);return path};path.pointRadius=function(_){if(!arguments.length)return pointRadius;pointRadius=typeof _==="function"?_:(contextStream.pointRadius(+_),+_);return path};return path.projection(projection).context(context)};var sum=adder();var polygonContains=function(polygon,point){var lambda=point[0],phi=point[1],normal=[sin(lambda),-cos(lambda),0],angle=0,winding=0;sum.reset();for(var i=0,n=polygon.length;i<n;++i){if(!(m=(ring=polygon[i]).length))continue;var ring,m,point0=ring[m-1],lambda0=point0[0],phi0=point0[1]/2+quarterPi,sinPhi0=sin(phi0),cosPhi0=cos(phi0);for(var j=0;j<m;++j,lambda0=lambda1,sinPhi0=sinPhi1,cosPhi0=cosPhi1,point0=point1){var point1=ring[j],lambda1=point1[0],phi1=point1[1]/2+quarterPi,sinPhi1=sin(phi1),cosPhi1=cos(phi1),delta=lambda1-lambda0,sign$$1=delta>=0?1:-1,absDelta=sign$$1*delta,antimeridian=absDelta>pi,k=sinPhi0*sinPhi1;sum.add(atan2(k*sign$$1*sin(absDelta),cosPhi0*cosPhi1+k*cos(absDelta)));angle+=antimeridian?delta+sign$$1*tau:delta;if(antimeridian^lambda0>=lambda^lambda1>=lambda){var arc=cartesianCross(cartesian(point0),cartesian(point1));cartesianNormalizeInPlace(arc);var intersection=cartesianCross(normal,arc);cartesianNormalizeInPlace(intersection);var phiArc=(antimeridian^delta>=0?-1:1)*asin(intersection[2]);if(phi>phiArc||phi===phiArc&&(arc[0]||arc[1])){winding+=antimeridian^delta>=0?1:-1}}}}return(angle<-epsilon||angle<epsilon&&sum<-epsilon)^winding&1};var clip=function(pointVisible,clipLine,interpolate,start){return function(rotate,sink){var line=clipLine(sink),rotatedStart=rotate.invert(start[0],start[1]),ringBuffer=clipBuffer(),ringSink=clipLine(ringBuffer),polygonStarted=false,polygon,segments,ring;var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing;clip.lineStart=ringStart;clip.lineEnd=ringEnd;segments=[];polygon=[]},polygonEnd:function(){clip.point=point;clip.lineStart=lineStart;clip.lineEnd=lineEnd;segments=d3Array.merge(segments);var startInside=polygonContains(polygon,rotatedStart);if(segments.length){if(!polygonStarted)sink.polygonStart(),polygonStarted=true;clipPolygon(segments,compareIntersection,startInside,interpolate,sink)}else if(startInside){if(!polygonStarted)sink.polygonStart(),polygonStarted=true;sink.lineStart();interpolate(null,null,1,sink);sink.lineEnd()}if(polygonStarted)sink.polygonEnd(),polygonStarted=false;segments=polygon=null},sphere:function(){sink.polygonStart();sink.lineStart();interpolate(null,null,1,sink);sink.lineEnd();sink.polygonEnd()}};function point(lambda,phi){var point=rotate(lambda,phi);if(pointVisible(lambda=point[0],phi=point[1]))sink.point(lambda,phi)}function pointLine(lambda,phi){var point=rotate(lambda,phi);line.point(point[0],point[1])}function lineStart(){clip.point=pointLine;line.lineStart()}function lineEnd(){clip.point=point;line.lineEnd()}function pointRing(lambda,phi){ring.push([lambda,phi]);var point=rotate(lambda,phi);ringSink.point(point[0],point[1])}function ringStart(){ringSink.lineStart();ring=[]}function ringEnd(){pointRing(ring[0][0],ring[0][1]);ringSink.lineEnd();var clean=ringSink.clean(),ringSegments=ringBuffer.result(),i,n=ringSegments.length,m,segment,point;ring.pop();polygon.push(ring);ring=null;if(!n)return;if(clean&1){segment=ringSegments[0];if((m=segment.length-1)>0){if(!polygonStarted)sink.polygonStart(),polygonStarted=true;sink.lineStart();for(i=0;i<m;++i)sink.point((point=segment[i])[0],point[1]);sink.lineEnd()}return}if(n>1&&clean&2)ringSegments.push(ringSegments.pop().concat(ringSegments.shift()));segments.push(ringSegments.filter(validSegment))}return clip}};function validSegment(segment){return segment.length>1}function compareIntersection(a,b){return((a=a.x)[0]<0?a[1]-halfPi-epsilon:halfPi-a[1])-((b=b.x)[0]<0?b[1]-halfPi-epsilon:halfPi-b[1])}var clipAntimeridian=clip(function(){return true},clipAntimeridianLine,clipAntimeridianInterpolate,[-pi,-halfPi]);function clipAntimeridianLine(stream){var lambda0=NaN,phi0=NaN,sign0=NaN,clean;return{lineStart:function(){stream.lineStart();clean=1},point:function(lambda1,phi1){var sign1=lambda1>0?pi:-pi,delta=abs(lambda1-lambda0);if(abs(delta-pi)<epsilon){stream.point(lambda0,phi0=(phi0+phi1)/2>0?halfPi:-halfPi);stream.point(sign0,phi0);stream.lineEnd();stream.lineStart();stream.point(sign1,phi0);stream.point(lambda1,phi0);clean=0}else if(sign0!==sign1&&delta>=pi){if(abs(lambda0-sign0)<epsilon)lambda0-=sign0*epsilon;if(abs(lambda1-sign1)<epsilon)lambda1-=sign1*epsilon;phi0=clipAntimeridianIntersect(lambda0,phi0,lambda1,phi1);stream.point(sign0,phi0);stream.lineEnd();stream.lineStart();stream.point(sign1,phi0);clean=0}stream.point(lambda0=lambda1,phi0=phi1);sign0=sign1},lineEnd:function(){stream.lineEnd();lambda0=phi0=NaN},clean:function(){return 2-clean}}}function clipAntimeridianIntersect(lambda0,phi0,lambda1,phi1){var cosPhi0,cosPhi1,sinLambda0Lambda1=sin(lambda0-lambda1);return abs(sinLambda0Lambda1)>epsilon?atan((sin(phi0)*(cosPhi1=cos(phi1))*sin(lambda1)-sin(phi1)*(cosPhi0=cos(phi0))*sin(lambda0))/(cosPhi0*cosPhi1*sinLambda0Lambda1)):(phi0+phi1)/2}function clipAntimeridianInterpolate(from,to,direction,stream){var phi;if(from==null){phi=direction*halfPi;stream.point(-pi,phi);stream.point(0,phi);stream.point(pi,phi);stream.point(pi,0);stream.point(pi,-phi);stream.point(0,-phi);stream.point(-pi,-phi);stream.point(-pi,0);stream.point(-pi,phi)}else if(abs(from[0]-to[0])>epsilon){var lambda=from[0]<to[0]?pi:-pi;phi=direction*lambda/2;stream.point(-lambda,phi);stream.point(0,phi);stream.point(lambda,phi)}else{stream.point(to[0],to[1])}}var clipCircle=function(radius,delta){var cr=cos(radius),smallRadius=cr>0,notHemisphere=abs(cr)>epsilon;function interpolate(from,to,direction,stream){circleStream(stream,radius,delta,direction,from,to)}function visible(lambda,phi){return cos(lambda)*cos(phi)>cr}function clipLine(stream){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=false;clean=1},point:function(lambda,phi){var point1=[lambda,phi],point2,v=visible(lambda,phi),c=smallRadius?v?0:code(lambda,phi):v?code(lambda+(lambda<0?pi:-pi),phi):0;if(!point0&&(v00=v0=v))stream.lineStart();if(v!==v0){point2=intersect(point0,point1);if(pointEqual(point0,point2)||pointEqual(point1,point2)){point1[0]+=epsilon;point1[1]+=epsilon;v=visible(point1[0],point1[1])}}if(v!==v0){clean=0;if(v){stream.lineStart();point2=intersect(point1,point0);stream.point(point2[0],point2[1])}else{point2=intersect(point0,point1);stream.point(point2[0],point2[1]);stream.lineEnd()}point0=point2}else if(notHemisphere&&point0&&smallRadius^v){var t;if(!(c&c0)&&(t=intersect(point1,point0,true))){clean=0;if(smallRadius){stream.lineStart();stream.point(t[0][0],t[0][1]);stream.point(t[1][0],t[1][1]);stream.lineEnd()}else{stream.point(t[1][0],t[1][1]);stream.lineEnd();stream.lineStart();stream.point(t[0][0],t[0][1])}}}if(v&&(!point0||!pointEqual(point0,point1))){stream.point(point1[0],point1[1])}point0=point1,v0=v,c0=c},lineEnd:function(){if(v0)stream.lineEnd();point0=null},clean:function(){return clean|(v00&&v0)<<1}}}function intersect(a,b,two){var pa=cartesian(a),pb=cartesian(b);var n1=[1,0,0],n2=cartesianCross(pa,pb),n2n2=cartesianDot(n2,n2),n1n2=n2[0],determinant=n2n2-n1n2*n1n2;if(!determinant)return!two&&a;var c1=cr*n2n2/determinant,c2=-cr*n1n2/determinant,n1xn2=cartesianCross(n1,n2),A=cartesianScale(n1,c1),B=cartesianScale(n2,c2);cartesianAddInPlace(A,B);var u=n1xn2,w=cartesianDot(A,u),uu=cartesianDot(u,u),t2=w*w-uu*(cartesianDot(A,A)-1);if(t2<0)return;var t=sqrt(t2),q=cartesianScale(u,(-w-t)/uu);cartesianAddInPlace(q,A);q=spherical(q);if(!two)return q;var lambda0=a[0],lambda1=b[0],phi0=a[1],phi1=b[1],z;if(lambda1<lambda0)z=lambda0,lambda0=lambda1,lambda1=z;var delta=lambda1-lambda0,polar=abs(delta-pi)<epsilon,meridian=polar||delta<epsilon;if(!polar&&phi1<phi0)z=phi0,phi0=phi1,phi1=z;if(meridian?polar?phi0+phi1>0^q[1]<(abs(q[0]-lambda0)<epsilon?phi0:phi1):phi0<=q[1]&&q[1]<=phi1:delta>pi^(lambda0<=q[0]&&q[0]<=lambda1)){var q1=cartesianScale(u,(-w+t)/uu);cartesianAddInPlace(q1,A);return[q,spherical(q1)]}}function code(lambda,phi){var r=smallRadius?radius:pi-radius,code=0;if(lambda<-r)code|=1;else if(lambda>r)code|=2;if(phi<-r)code|=4;else if(phi>r)code|=8;return code}return clip(visible,clipLine,interpolate,smallRadius?[0,-radius]:[-pi,radius-pi])};var transform=function(methods){return{stream:transformer(methods)}};function transformer(methods){return function(stream){var s=new TransformStream;for(var key in methods)s[key]=methods[key];s.stream=stream;return s}}function TransformStream(){}TransformStream.prototype={constructor:TransformStream,point:function(x,y){this.stream.point(x,y)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function fitExtent(projection,extent,object){var w=extent[1][0]-extent[0][0],h=extent[1][1]-extent[0][1],clip=projection.clipExtent&&projection.clipExtent();projection.scale(150).translate([0,0]);if(clip!=null)projection.clipExtent(null);geoStream(object,projection.stream(boundsStream$1));var b=boundsStream$1.result(),k=Math.min(w/(b[1][0]-b[0][0]),h/(b[1][1]-b[0][1])),x=+extent[0][0]+(w-k*(b[1][0]+b[0][0]))/2,y=+extent[0][1]+(h-k*(b[1][1]+b[0][1]))/2;if(clip!=null)projection.clipExtent(clip);return projection.scale(k*150).translate([x,y])}function fitSize(projection,size,object){return fitExtent(projection,[[0,0],size],object)}var maxDepth=16;var cosMinDistance=cos(30*radians);var resample=function(project,delta2){return+delta2?resample$1(project,delta2):resampleNone(project)};function resampleNone(project){return transformer({point:function(x,y){x=project(x,y);this.stream.point(x[0],x[1])}})}function resample$1(project,delta2){function resampleLineTo(x0,y0,lambda0,a0,b0,c0,x1,y1,lambda1,a1,b1,c1,depth,stream){var dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;if(d2>4*delta2&&depth--){var a=a0+a1,b=b0+b1,c=c0+c1,m=sqrt(a*a+b*b+c*c),phi2=asin(c/=m),lambda2=abs(abs(c)-1)<epsilon||abs(lambda0-lambda1)<epsilon?(lambda0+lambda1)/2:atan2(b,a),p=project(lambda2,phi2),x2=p[0],y2=p[1],dx2=x2-x0,dy2=y2-y0,dz=dy*dx2-dx*dy2;if(dz*dz/d2>delta2||abs((dx*dx2+dy*dy2)/d2-.5)>.3||a0*a1+b0*b1+c0*c1<cosMinDistance){resampleLineTo(x0,y0,lambda0,a0,b0,c0,x2,y2,lambda2,a/=m,b/=m,c,depth,stream);stream.point(x2,y2);resampleLineTo(x2,y2,lambda2,a,b,c,x1,y1,lambda1,a1,b1,c1,depth,stream)}}}return function(stream){var lambda00,x00,y00,a00,b00,c00,lambda0,x0,y0,a0,b0,c0;var resampleStream={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart();resampleStream.lineStart=ringStart},polygonEnd:function(){stream.polygonEnd();resampleStream.lineStart=lineStart}};function point(x,y){x=project(x,y);stream.point(x[0],x[1])}function lineStart(){x0=NaN;resampleStream.point=linePoint;stream.lineStart()}function linePoint(lambda,phi){var c=cartesian([lambda,phi]),p=project(lambda,phi);resampleLineTo(x0,y0,lambda0,a0,b0,c0,x0=p[0],y0=p[1],lambda0=lambda,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream);stream.point(x0,y0)}function lineEnd(){resampleStream.point=point;stream.lineEnd()}function ringStart(){lineStart();resampleStream.point=ringPoint;resampleStream.lineEnd=ringEnd}function ringPoint(lambda,phi){linePoint(lambda00=lambda,phi),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0;resampleStream.point=linePoint}function ringEnd(){resampleLineTo(x0,y0,lambda0,a0,b0,c0,x00,y00,lambda00,a00,b00,c00,maxDepth,stream);resampleStream.lineEnd=lineEnd;lineEnd()}return resampleStream}}var transformRadians=transformer({point:function(x,y){this.stream.point(x*radians,y*radians)}});function projection(project){return projectionMutator(function(){return project})()}function projectionMutator(projectAt){var project,k=150,x=480,y=250,dx,dy,lambda=0,phi=0,deltaLambda=0,deltaPhi=0,deltaGamma=0,rotate,projectRotate,theta=null,preclip=clipAntimeridian,x0=null,y0,x1,y1,postclip=identity,delta2=.5,projectResample=resample(projectTransform,delta2),cache,cacheStream;function projection(point){point=projectRotate(point[0]*radians,point[1]*radians);return[point[0]*k+dx,dy-point[1]*k]}function invert(point){point=projectRotate.invert((point[0]-dx)/k,(dy-point[1])/k);return point&&[point[0]*degrees,point[1]*degrees]}function projectTransform(x,y){return x=project(x,y),[x[0]*k+dx,dy-x[1]*k]}projection.stream=function(stream){return cache&&cacheStream===stream?cache:cache=transformRadians(preclip(rotate,projectResample(postclip(cacheStream=stream))))};projection.clipAngle=function(_){return arguments.length?(preclip=+_?clipCircle(theta=_*radians,6*radians):(theta=null,clipAntimeridian),reset()):theta*degrees};projection.clipExtent=function(_){return arguments.length?(postclip=_==null?(x0=y0=x1=y1=null,identity):clipExtent(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]),reset()):x0==null?null:[[x0,y0],[x1,y1]]};projection.scale=function(_){return arguments.length?(k=+_,recenter()):k};projection.translate=function(_){return arguments.length?(x=+_[0],y=+_[1],recenter()):[x,y]};projection.center=function(_){return arguments.length?(lambda=_[0]%360*radians,phi=_[1]%360*radians,recenter()):[lambda*degrees,phi*degrees]};projection.rotate=function(_){return arguments.length?(deltaLambda=_[0]%360*radians,deltaPhi=_[1]%360*radians,deltaGamma=_.length>2?_[2]%360*radians:0,recenter()):[deltaLambda*degrees,deltaPhi*degrees,deltaGamma*degrees]};projection.precision=function(_){return arguments.length?(projectResample=resample(projectTransform,delta2=_*_),reset()):sqrt(delta2)};projection.fitExtent=function(extent,object){return fitExtent(projection,extent,object)};projection.fitSize=function(size,object){return fitSize(projection,size,object)};function recenter(){projectRotate=compose(rotate=rotateRadians(deltaLambda,deltaPhi,deltaGamma),project);var center=project(lambda,phi);dx=x-center[0]*k;dy=y+center[1]*k;return reset()}function reset(){cache=cacheStream=null;return projection}return function(){project=projectAt.apply(this,arguments);projection.invert=project.invert&&invert;return recenter()}}function conicProjection(projectAt){var phi0=0,phi1=pi/3,m=projectionMutator(projectAt),p=m(phi0,phi1);p.parallels=function(_){return arguments.length?m(phi0=_[0]*radians,phi1=_[1]*radians):[phi0*degrees,phi1*degrees]};return p}function cylindricalEqualAreaRaw(phi0){var cosPhi0=cos(phi0);function forward(lambda,phi){return[lambda*cosPhi0,sin(phi)/cosPhi0];
}forward.invert=function(x,y){return[x/cosPhi0,asin(y*cosPhi0)]};return forward}function conicEqualAreaRaw(y0,y1){var sy0=sin(y0),n=(sy0+sin(y1))/2;if(abs(n)<epsilon)return cylindricalEqualAreaRaw(y0);var c=1+sy0*(2*n-sy0),r0=sqrt(c)/n;function project(x,y){var r=sqrt(c-2*n*sin(y))/n;return[r*sin(x*=n),r0-r*cos(x)]}project.invert=function(x,y){var r0y=r0-y;return[atan2(x,abs(r0y))/n*sign(r0y),asin((c-(x*x+r0y*r0y)*n*n)/(2*n))]};return project}var conicEqualArea=function(){return conicProjection(conicEqualAreaRaw).scale(155.424).center([0,33.6442])};var albers=function(){return conicEqualArea().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])};function multiplex(streams){var n=streams.length;return{point:function(x,y){var i=-1;while(++i<n)streams[i].point(x,y)},sphere:function(){var i=-1;while(++i<n)streams[i].sphere()},lineStart:function(){var i=-1;while(++i<n)streams[i].lineStart()},lineEnd:function(){var i=-1;while(++i<n)streams[i].lineEnd()},polygonStart:function(){var i=-1;while(++i<n)streams[i].polygonStart()},polygonEnd:function(){var i=-1;while(++i<n)streams[i].polygonEnd()}}}var albersUsa=function(){var cache,cacheStream,lower48=albers(),lower48Point,alaska=conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),alaskaPoint,hawaii=conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),hawaiiPoint,point,pointStream={point:function(x,y){point=[x,y]}};function albersUsa(coordinates){var x=coordinates[0],y=coordinates[1];return point=null,(lower48Point.point(x,y),point)||(alaskaPoint.point(x,y),point)||(hawaiiPoint.point(x,y),point)}albersUsa.invert=function(coordinates){var k=lower48.scale(),t=lower48.translate(),x=(coordinates[0]-t[0])/k,y=(coordinates[1]-t[1])/k;return(y>=.12&&y<.234&&x>=-.425&&x<-.214?alaska:y>=.166&&y<.234&&x>=-.214&&x<-.115?hawaii:lower48).invert(coordinates)};albersUsa.stream=function(stream){return cache&&cacheStream===stream?cache:cache=multiplex([lower48.stream(cacheStream=stream),alaska.stream(stream),hawaii.stream(stream)])};albersUsa.precision=function(_){if(!arguments.length)return lower48.precision();lower48.precision(_),alaska.precision(_),hawaii.precision(_);return reset()};albersUsa.scale=function(_){if(!arguments.length)return lower48.scale();lower48.scale(_),alaska.scale(_*.35),hawaii.scale(_);return albersUsa.translate(lower48.translate())};albersUsa.translate=function(_){if(!arguments.length)return lower48.translate();var k=lower48.scale(),x=+_[0],y=+_[1];lower48Point=lower48.translate(_).clipExtent([[x-.455*k,y-.238*k],[x+.455*k,y+.238*k]]).stream(pointStream);alaskaPoint=alaska.translate([x-.307*k,y+.201*k]).clipExtent([[x-.425*k+epsilon,y+.12*k+epsilon],[x-.214*k-epsilon,y+.234*k-epsilon]]).stream(pointStream);hawaiiPoint=hawaii.translate([x-.205*k,y+.212*k]).clipExtent([[x-.214*k+epsilon,y+.166*k+epsilon],[x-.115*k-epsilon,y+.234*k-epsilon]]).stream(pointStream);return reset()};albersUsa.fitExtent=function(extent,object){return fitExtent(albersUsa,extent,object)};albersUsa.fitSize=function(size,object){return fitSize(albersUsa,size,object)};function reset(){cache=cacheStream=null;return albersUsa}return albersUsa.scale(1070)};function azimuthalRaw(scale){return function(x,y){var cx=cos(x),cy=cos(y),k=scale(cx*cy);return[k*cy*sin(x),k*sin(y)]}}function azimuthalInvert(angle){return function(x,y){var z=sqrt(x*x+y*y),c=angle(z),sc=sin(c),cc=cos(c);return[atan2(x*sc,z*cc),asin(z&&y*sc/z)]}}var azimuthalEqualAreaRaw=azimuthalRaw(function(cxcy){return sqrt(2/(1+cxcy))});azimuthalEqualAreaRaw.invert=azimuthalInvert(function(z){return 2*asin(z/2)});var azimuthalEqualArea=function(){return projection(azimuthalEqualAreaRaw).scale(124.75).clipAngle(180-.001)};var azimuthalEquidistantRaw=azimuthalRaw(function(c){return(c=acos(c))&&c/sin(c)});azimuthalEquidistantRaw.invert=azimuthalInvert(function(z){return z});var azimuthalEquidistant=function(){return projection(azimuthalEquidistantRaw).scale(79.4188).clipAngle(180-.001)};function mercatorRaw(lambda,phi){return[lambda,log(tan((halfPi+phi)/2))]}mercatorRaw.invert=function(x,y){return[x,2*atan(exp(y))-halfPi]};var mercator=function(){return mercatorProjection(mercatorRaw).scale(961/tau)};function mercatorProjection(project){var m=projection(project),scale=m.scale,translate=m.translate,clipExtent=m.clipExtent,clipAuto;m.scale=function(_){return arguments.length?(scale(_),clipAuto&&m.clipExtent(null),m):scale()};m.translate=function(_){return arguments.length?(translate(_),clipAuto&&m.clipExtent(null),m):translate()};m.clipExtent=function(_){if(!arguments.length)return clipAuto?null:clipExtent();if(clipAuto=_==null){var k=pi*scale(),t=translate();_=[[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]]}clipExtent(_);return m};return m.clipExtent(null)}function tany(y){return tan((halfPi+y)/2)}function conicConformalRaw(y0,y1){var cy0=cos(y0),n=y0===y1?sin(y0):log(cy0/cos(y1))/log(tany(y1)/tany(y0)),f=cy0*pow(tany(y0),n)/n;if(!n)return mercatorRaw;function project(x,y){if(f>0){if(y<-halfPi+epsilon)y=-halfPi+epsilon}else{if(y>halfPi-epsilon)y=halfPi-epsilon}var r=f/pow(tany(y),n);return[r*sin(n*x),f-r*cos(n*x)]}project.invert=function(x,y){var fy=f-y,r=sign(n)*sqrt(x*x+fy*fy);return[atan2(x,abs(fy))/n*sign(fy),2*atan(pow(f/r,1/n))-halfPi]};return project}var conicConformal=function(){return conicProjection(conicConformalRaw).scale(109.5).parallels([30,30])};function equirectangularRaw(lambda,phi){return[lambda,phi]}equirectangularRaw.invert=equirectangularRaw;var equirectangular=function(){return projection(equirectangularRaw).scale(152.63)};function conicEquidistantRaw(y0,y1){var cy0=cos(y0),n=y0===y1?sin(y0):(cy0-cos(y1))/(y1-y0),g=cy0/n+y0;if(abs(n)<epsilon)return equirectangularRaw;function project(x,y){var gy=g-y,nx=n*x;return[gy*sin(nx),g-gy*cos(nx)]}project.invert=function(x,y){var gy=g-y;return[atan2(x,abs(gy))/n*sign(gy),g-sign(n)*sqrt(x*x+gy*gy)]};return project}var conicEquidistant=function(){return conicProjection(conicEquidistantRaw).scale(131.154).center([0,13.9389])};function gnomonicRaw(x,y){var cy=cos(y),k=cos(x)*cy;return[cy*sin(x)/k,sin(y)/k]}gnomonicRaw.invert=azimuthalInvert(atan);var gnomonic=function(){return projection(gnomonicRaw).scale(144.049).clipAngle(60)};function scaleTranslate(kx,ky,tx,ty){return kx===1&&ky===1&&tx===0&&ty===0?identity:transformer({point:function(x,y){this.stream.point(x*kx+tx,y*ky+ty)}})}var identity$1=function(){var k=1,tx=0,ty=0,sx=1,sy=1,transform=identity,x0=null,y0,x1,y1,clip=identity,cache,cacheStream,projection;function reset(){cache=cacheStream=null;return projection}return projection={stream:function(stream){return cache&&cacheStream===stream?cache:cache=transform(clip(cacheStream=stream))},clipExtent:function(_){return arguments.length?(clip=_==null?(x0=y0=x1=y1=null,identity):clipExtent(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]),reset()):x0==null?null:[[x0,y0],[x1,y1]]},scale:function(_){return arguments.length?(transform=scaleTranslate((k=+_)*sx,k*sy,tx,ty),reset()):k},translate:function(_){return arguments.length?(transform=scaleTranslate(k*sx,k*sy,tx=+_[0],ty=+_[1]),reset()):[tx,ty]},reflectX:function(_){return arguments.length?(transform=scaleTranslate(k*(sx=_?-1:1),k*sy,tx,ty),reset()):sx<0},reflectY:function(_){return arguments.length?(transform=scaleTranslate(k*sx,k*(sy=_?-1:1),tx,ty),reset()):sy<0},fitExtent:function(extent,object){return fitExtent(projection,extent,object)},fitSize:function(size,object){return fitSize(projection,size,object)}}};function orthographicRaw(x,y){return[cos(y)*sin(x),sin(y)]}orthographicRaw.invert=azimuthalInvert(asin);var orthographic=function(){return projection(orthographicRaw).scale(249.5).clipAngle(90+epsilon)};function stereographicRaw(x,y){var cy=cos(y),k=1+cos(x)*cy;return[cy*sin(x)/k,sin(y)/k]}stereographicRaw.invert=azimuthalInvert(function(z){return 2*atan(z)});var stereographic=function(){return projection(stereographicRaw).scale(250).clipAngle(142)};function transverseMercatorRaw(lambda,phi){return[log(tan((halfPi+phi)/2)),-lambda]}transverseMercatorRaw.invert=function(x,y){return[-y,2*atan(exp(x))-halfPi]};var transverseMercator=function(){var m=mercatorProjection(transverseMercatorRaw),center=m.center,rotate=m.rotate;m.center=function(_){return arguments.length?center([-_[1],_[0]]):(_=center(),[_[1],-_[0]])};m.rotate=function(_){return arguments.length?rotate([_[0],_[1],_.length>2?_[2]+90:90]):(_=rotate(),[_[0],_[1],_[2]-90])};return rotate([0,0,90]).scale(159.155)};exports.geoArea=area;exports.geoBounds=bounds;exports.geoCentroid=centroid;exports.geoCircle=circle;exports.geoClipExtent=extent;exports.geoDistance=distance;exports.geoGraticule=graticule;exports.geoGraticule10=graticule10;exports.geoInterpolate=interpolate;exports.geoLength=length;exports.geoPath=index;exports.geoAlbers=albers;exports.geoAlbersUsa=albersUsa;exports.geoAzimuthalEqualArea=azimuthalEqualArea;exports.geoAzimuthalEqualAreaRaw=azimuthalEqualAreaRaw;exports.geoAzimuthalEquidistant=azimuthalEquidistant;exports.geoAzimuthalEquidistantRaw=azimuthalEquidistantRaw;exports.geoConicConformal=conicConformal;exports.geoConicConformalRaw=conicConformalRaw;exports.geoConicEqualArea=conicEqualArea;exports.geoConicEqualAreaRaw=conicEqualAreaRaw;exports.geoConicEquidistant=conicEquidistant;exports.geoConicEquidistantRaw=conicEquidistantRaw;exports.geoEquirectangular=equirectangular;exports.geoEquirectangularRaw=equirectangularRaw;exports.geoGnomonic=gnomonic;exports.geoGnomonicRaw=gnomonicRaw;exports.geoIdentity=identity$1;exports.geoProjection=projection;exports.geoProjectionMutator=projectionMutator;exports.geoMercator=mercator;exports.geoMercatorRaw=mercatorRaw;exports.geoOrthographic=orthographic;exports.geoOrthographicRaw=orthographicRaw;exports.geoStereographic=stereographic;exports.geoStereographicRaw=stereographicRaw;exports.geoTransverseMercator=transverseMercator;exports.geoTransverseMercatorRaw=transverseMercatorRaw;exports.geoRotation=rotation;exports.geoStream=geoStream;exports.geoTransform=transform;Object.defineProperty(exports,"__esModule",{value:true})})},{"d3-array":323}],328:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports,require("d3-color")):typeof define==="function"&&define.amd?define(["exports","d3-color"],factory):factory(global.d3=global.d3||{},global.d3)})(this,function(exports,d3Color){"use strict";function basis(t1,v0,v1,v2,v3){var t2=t1*t1,t3=t2*t1;return((1-3*t1+3*t2-t3)*v0+(4-6*t2+3*t3)*v1+(1+3*t1+3*t2-3*t3)*v2+t3*v3)/6}var basis$1=function(values){var n=values.length-1;return function(t){var i=t<=0?t=0:t>=1?(t=1,n-1):Math.floor(t*n),v1=values[i],v2=values[i+1],v0=i>0?values[i-1]:2*v1-v2,v3=i<n-1?values[i+2]:2*v2-v1;return basis((t-i/n)*n,v0,v1,v2,v3)}};var basisClosed=function(values){var n=values.length;return function(t){var i=Math.floor(((t%=1)<0?++t:t)*n),v0=values[(i+n-1)%n],v1=values[i%n],v2=values[(i+1)%n],v3=values[(i+2)%n];return basis((t-i/n)*n,v0,v1,v2,v3)}};var constant=function(x){return function(){return x}};function linear(a,d){return function(t){return a+t*d}}function exponential(a,b,y){return a=Math.pow(a,y),b=Math.pow(b,y)-a,y=1/y,function(t){return Math.pow(a+t*b,y)}}function hue(a,b){var d=b-a;return d?linear(a,d>180||d<-180?d-360*Math.round(d/360):d):constant(isNaN(a)?b:a)}function gamma(y){return(y=+y)===1?nogamma:function(a,b){return b-a?exponential(a,b,y):constant(isNaN(a)?b:a)}}function nogamma(a,b){var d=b-a;return d?linear(a,d):constant(isNaN(a)?b:a)}var rgb$1=function rgbGamma(y){var color$$1=gamma(y);function rgb$$1(start,end){var r=color$$1((start=d3Color.rgb(start)).r,(end=d3Color.rgb(end)).r),g=color$$1(start.g,end.g),b=color$$1(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){start.r=r(t);start.g=g(t);start.b=b(t);start.opacity=opacity(t);return start+""}}rgb$$1.gamma=rgbGamma;return rgb$$1}(1);function rgbSpline(spline){return function(colors){var n=colors.length,r=new Array(n),g=new Array(n),b=new Array(n),i,color$$1;for(i=0;i<n;++i){color$$1=d3Color.rgb(colors[i]);r[i]=color$$1.r||0;g[i]=color$$1.g||0;b[i]=color$$1.b||0}r=spline(r);g=spline(g);b=spline(b);color$$1.opacity=1;return function(t){color$$1.r=r(t);color$$1.g=g(t);color$$1.b=b(t);return color$$1+""}}}var rgbBasis=rgbSpline(basis$1);var rgbBasisClosed=rgbSpline(basisClosed);var array=function(a,b){var nb=b?b.length:0,na=a?Math.min(nb,a.length):0,x=new Array(nb),c=new Array(nb),i;for(i=0;i<na;++i)x[i]=value(a[i],b[i]);for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<na;++i)c[i]=x[i](t);return c}};var date=function(a,b){var d=new Date;return a=+a,b-=a,function(t){return d.setTime(a+b*t),d}};var number=function(a,b){return a=+a,b-=a,function(t){return a+b*t}};var object=function(a,b){var i={},c={},k;if(a===null||typeof a!=="object")a={};if(b===null||typeof b!=="object")b={};for(k in b){if(k in a){i[k]=value(a[k],b[k])}else{c[k]=b[k]}}return function(t){for(k in i)c[k]=i[k](t);return c}};var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;var reB=new RegExp(reA.source,"g");function zero(b){return function(){return b}}function one(b){return function(t){return b(t)+""}}var string=function(a,b){var bi=reA.lastIndex=reB.lastIndex=0,am,bm,bs,i=-1,s=[],q=[];a=a+"",b=b+"";while((am=reA.exec(a))&&(bm=reB.exec(b))){if((bs=bm.index)>bi){bs=b.slice(bi,bs);if(s[i])s[i]+=bs;else s[++i]=bs}if((am=am[0])===(bm=bm[0])){if(s[i])s[i]+=bm;else s[++i]=bm}else{s[++i]=null;q.push({i:i,x:number(am,bm)})}bi=reB.lastIndex}if(bi<b.length){bs=b.slice(bi);if(s[i])s[i]+=bs;else s[++i]=bs}return s.length<2?q[0]?one(q[0].x):zero(b):(b=q.length,function(t){for(var i=0,o;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})};var value=function(a,b){var t=typeof b,c;return b==null||t==="boolean"?constant(b):(t==="number"?number:t==="string"?(c=d3Color.color(b))?(b=c,rgb$1):string:b instanceof d3Color.color?rgb$1:b instanceof Date?date:Array.isArray(b)?array:isNaN(b)?object:number)(a,b)};var round=function(a,b){return a=+a,b-=a,function(t){return Math.round(a+b*t)}};var degrees=180/Math.PI;var identity={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};var decompose=function(a,b,c,d,e,f){var scaleX,scaleY,skewX;if(scaleX=Math.sqrt(a*a+b*b))a/=scaleX,b/=scaleX;if(skewX=a*c+b*d)c-=a*skewX,d-=b*skewX;if(scaleY=Math.sqrt(c*c+d*d))c/=scaleY,d/=scaleY,skewX/=scaleY;if(a*d<b*c)a=-a,b=-b,skewX=-skewX,scaleX=-scaleX;return{translateX:e,translateY:f,rotate:Math.atan2(b,a)*degrees,skewX:Math.atan(skewX)*degrees,scaleX:scaleX,scaleY:scaleY}};var cssNode;var cssRoot;var cssView;var svgNode;function parseCss(value){if(value==="none")return identity;if(!cssNode)cssNode=document.createElement("DIV"),cssRoot=document.documentElement,cssView=document.defaultView;cssNode.style.transform=value;value=cssView.getComputedStyle(cssRoot.appendChild(cssNode),null).getPropertyValue("transform");cssRoot.removeChild(cssNode);value=value.slice(7,-1).split(",");return decompose(+value[0],+value[1],+value[2],+value[3],+value[4],+value[5])}function parseSvg(value){if(value==null)return identity;if(!svgNode)svgNode=document.createElementNS("http://www.w3.org/2000/svg","g");svgNode.setAttribute("transform",value);if(!(value=svgNode.transform.baseVal.consolidate()))return identity;value=value.matrix;return decompose(value.a,value.b,value.c,value.d,value.e,value.f)}function interpolateTransform(parse,pxComma,pxParen,degParen){function pop(s){return s.length?s.pop()+" ":""}function translate(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push("translate(",null,pxComma,null,pxParen);q.push({i:i-4,x:number(xa,xb)},{i:i-2,x:number(ya,yb)})}else if(xb||yb){s.push("translate("+xb+pxComma+yb+pxParen)}}function rotate(a,b,s,q){if(a!==b){if(a-b>180)b+=360;else if(b-a>180)a+=360;q.push({i:s.push(pop(s)+"rotate(",null,degParen)-2,x:number(a,b)})}else if(b){s.push(pop(s)+"rotate("+b+degParen)}}function skewX(a,b,s,q){if(a!==b){q.push({i:s.push(pop(s)+"skewX(",null,degParen)-2,x:number(a,b)})}else if(b){s.push(pop(s)+"skewX("+b+degParen)}}function scale(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push(pop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:number(xa,xb)},{i:i-2,x:number(ya,yb)})}else if(xb!==1||yb!==1){s.push(pop(s)+"scale("+xb+","+yb+")")}}return function(a,b){var s=[],q=[];a=parse(a),b=parse(b);translate(a.translateX,a.translateY,b.translateX,b.translateY,s,q);rotate(a.rotate,b.rotate,s,q);skewX(a.skewX,b.skewX,s,q);scale(a.scaleX,a.scaleY,b.scaleX,b.scaleY,s,q);a=b=null;return function(t){var i=-1,n=q.length,o;while(++i<n)s[(o=q[i]).i]=o.x(t);return s.join("")}}}var interpolateTransformCss=interpolateTransform(parseCss,"px, ","px)","deg)");var interpolateTransformSvg=interpolateTransform(parseSvg,", ",")",")");var rho=Math.SQRT2;var rho2=2;var rho4=4;var epsilon2=1e-12;function cosh(x){return((x=Math.exp(x))+1/x)/2}function sinh(x){return((x=Math.exp(x))-1/x)/2}function tanh(x){return((x=Math.exp(2*x))-1)/(x+1)}var zoom=function(p0,p1){var ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2],dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy,i,S;if(d2<epsilon2){S=Math.log(w1/w0)/rho;i=function(t){return[ux0+t*dx,uy0+t*dy,w0*Math.exp(rho*t*S)]}}else{var d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+rho4*d2)/(2*w0*rho2*d1),b1=(w1*w1-w0*w0-rho4*d2)/(2*w1*rho2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1);S=(r1-r0)/rho;i=function(t){var s=t*S,coshr0=cosh(r0),u=w0/(rho2*d1)*(coshr0*tanh(rho*s+r0)-sinh(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/cosh(rho*s+r0)]}}i.duration=S*1e3;return i};function hsl$1(hue$$1){return function(start,end){var h=hue$$1((start=d3Color.hsl(start)).h,(end=d3Color.hsl(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){start.h=h(t);start.s=s(t);start.l=l(t);start.opacity=opacity(t);return start+""}}}var hsl$2=hsl$1(hue);var hslLong=hsl$1(nogamma);function lab$1(start,end){var l=nogamma((start=d3Color.lab(start)).l,(end=d3Color.lab(end)).l),a=nogamma(start.a,end.a),b=nogamma(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){start.l=l(t);start.a=a(t);start.b=b(t);start.opacity=opacity(t);return start+""}}function hcl$1(hue$$1){return function(start,end){var h=hue$$1((start=d3Color.hcl(start)).h,(end=d3Color.hcl(end)).h),c=nogamma(start.c,end.c),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){start.h=h(t);start.c=c(t);start.l=l(t);start.opacity=opacity(t);return start+""}}}var hcl$2=hcl$1(hue);var hclLong=hcl$1(nogamma);function cubehelix$1(hue$$1){return function cubehelixGamma(y){y=+y;function cubehelix$$1(start,end){var h=hue$$1((start=d3Color.cubehelix(start)).h,(end=d3Color.cubehelix(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){start.h=h(t);start.s=s(t);start.l=l(Math.pow(t,y));start.opacity=opacity(t);return start+""}}cubehelix$$1.gamma=cubehelixGamma;return cubehelix$$1}(1)}var cubehelix$2=cubehelix$1(hue);var cubehelixLong=cubehelix$1(nogamma);var quantize=function(interpolator,n){var samples=new Array(n);for(var i=0;i<n;++i)samples[i]=interpolator(i/(n-1));return samples};exports.interpolate=value;exports.interpolateArray=array;exports.interpolateBasis=basis$1;exports.interpolateBasisClosed=basisClosed;exports.interpolateDate=date;exports.interpolateNumber=number;exports.interpolateObject=object;exports.interpolateRound=round;exports.interpolateString=string;exports.interpolateTransformCss=interpolateTransformCss;exports.interpolateTransformSvg=interpolateTransformSvg;exports.interpolateZoom=zoom;exports.interpolateRgb=rgb$1;exports.interpolateRgbBasis=rgbBasis;exports.interpolateRgbBasisClosed=rgbBasisClosed;exports.interpolateHsl=hsl$2;exports.interpolateHslLong=hslLong;exports.interpolateLab=lab$1;exports.interpolateHcl=hcl$2;exports.interpolateHclLong=hclLong;exports.interpolateCubehelix=cubehelix$2;exports.interpolateCubehelixLong=cubehelixLong;exports.quantize=quantize;Object.defineProperty(exports,"__esModule",{value:true})})},{"d3-color":325}],329:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports,require("d3-array"),require("d3-collection"),require("d3-interpolate"),require("d3-format"),require("d3-time"),require("d3-time-format"),require("d3-color")):typeof define==="function"&&define.amd?define(["exports","d3-array","d3-collection","d3-interpolate","d3-format","d3-time","d3-time-format","d3-color"],factory):factory(global.d3=global.d3||{},global.d3,global.d3,global.d3,global.d3,global.d3,global.d3,global.d3)})(this,function(exports,d3Array,d3Collection,d3Interpolate,d3Format,d3Time,d3TimeFormat,d3Color){"use strict";var array=Array.prototype;var map$1=array.map;var slice=array.slice;var implicit={name:"implicit"};function ordinal(range$$1){var index=d3Collection.map(),domain=[],unknown=implicit;range$$1=range$$1==null?[]:slice.call(range$$1);function scale(d){var key=d+"",i=index.get(key);if(!i){if(unknown!==implicit)return unknown;index.set(key,i=domain.push(d))}return range$$1[(i-1)%range$$1.length]}scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[],index=d3Collection.map();var i=-1,n=_.length,d,key;while(++i<n)if(!index.has(key=(d=_[i])+""))index.set(key,domain.push(d));return scale};scale.range=function(_){return arguments.length?(range$$1=slice.call(_),scale):range$$1.slice()};scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown};scale.copy=function(){return ordinal().domain(domain).range(range$$1).unknown(unknown)};return scale}function band(){var scale=ordinal().unknown(undefined),domain=scale.domain,ordinalRange=scale.range,range$$1=[0,1],step,bandwidth,round=false,paddingInner=0,paddingOuter=0,align=.5;delete scale.unknown;function rescale(){var n=domain().length,reverse=range$$1[1]<range$$1[0],start=range$$1[reverse-0],stop=range$$1[1-reverse];step=(stop-start)/Math.max(1,n-paddingInner+paddingOuter*2);if(round)step=Math.floor(step);start+=(stop-start-step*(n-paddingInner))*align;bandwidth=step*(1-paddingInner);if(round)start=Math.round(start),bandwidth=Math.round(bandwidth);var values=d3Array.range(n).map(function(i){return start+step*i});return ordinalRange(reverse?values.reverse():values)}scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()};scale.range=function(_){return arguments.length?(range$$1=[+_[0],+_[1]],rescale()):range$$1.slice()};scale.rangeRound=function(_){return range$$1=[+_[0],+_[1]],round=true,rescale()};scale.bandwidth=function(){return bandwidth};scale.step=function(){return step};scale.round=function(_){return arguments.length?(round=!!_,rescale()):round};scale.padding=function(_){return arguments.length?(paddingInner=paddingOuter=Math.max(0,Math.min(1,_)),rescale()):paddingInner};scale.paddingInner=function(_){return arguments.length?(paddingInner=Math.max(0,Math.min(1,_)),rescale()):paddingInner};scale.paddingOuter=function(_){return arguments.length?(paddingOuter=Math.max(0,Math.min(1,_)),rescale()):paddingOuter};scale.align=function(_){return arguments.length?(align=Math.max(0,Math.min(1,_)),rescale()):align};scale.copy=function(){return band().domain(domain()).range(range$$1).round(round).paddingInner(paddingInner).paddingOuter(paddingOuter).align(align)};return rescale()}function pointish(scale){var copy=scale.copy;scale.padding=scale.paddingOuter;delete scale.paddingInner;delete scale.paddingOuter;scale.copy=function(){return pointish(copy())};return scale}function point(){return pointish(band().paddingInner(1))}var constant=function(x){return function(){return x}};var number=function(x){return+x};var unit=[0,1];function deinterpolateLinear(a,b){return(b-=a=+a)?function(x){return(x-a)/b}:constant(b)}function deinterpolateClamp(deinterpolate){return function(a,b){var d=deinterpolate(a=+a,b=+b);return function(x){return x<=a?0:x>=b?1:d(x)}}}function reinterpolateClamp(reinterpolate){return function(a,b){var r=reinterpolate(a=+a,b=+b);return function(t){return t<=0?a:t>=1?b:r(t)}}}function bimap(domain,range$$1,deinterpolate,reinterpolate){var d0=domain[0],d1=domain[1],r0=range$$1[0],r1=range$$1[1];if(d1<d0)d0=deinterpolate(d1,d0),r0=reinterpolate(r1,r0);else d0=deinterpolate(d0,d1),r0=reinterpolate(r0,r1);return function(x){return r0(d0(x))}}function polymap(domain,range$$1,deinterpolate,reinterpolate){var j=Math.min(domain.length,range$$1.length)-1,d=new Array(j),r=new Array(j),i=-1;if(domain[j]<domain[0]){domain=domain.slice().reverse();range$$1=range$$1.slice().reverse()}while(++i<j){d[i]=deinterpolate(domain[i],domain[i+1]);r[i]=reinterpolate(range$$1[i],range$$1[i+1])}return function(x){var i=d3Array.bisect(domain,x,1,j)-1;return r[i](d[i](x))}}function copy(source,target){return target.domain(source.domain()).range(source.range()).interpolate(source.interpolate()).clamp(source.clamp())}function continuous(deinterpolate,reinterpolate){var domain=unit,range$$1=unit,interpolate$$1=d3Interpolate.interpolate,clamp=false,piecewise,output,input;function rescale(){piecewise=Math.min(domain.length,range$$1.length)>2?polymap:bimap;output=input=null;return scale}function scale(x){return(output||(output=piecewise(domain,range$$1,clamp?deinterpolateClamp(deinterpolate):deinterpolate,interpolate$$1)))(+x)}scale.invert=function(y){return(input||(input=piecewise(range$$1,domain,deinterpolateLinear,clamp?reinterpolateClamp(reinterpolate):reinterpolate)))(+y)};scale.domain=function(_){return arguments.length?(domain=map$1.call(_,number),rescale()):domain.slice()};scale.range=function(_){return arguments.length?(range$$1=slice.call(_),rescale()):range$$1.slice()};scale.rangeRound=function(_){return range$$1=slice.call(_),interpolate$$1=d3Interpolate.interpolateRound,rescale()};scale.clamp=function(_){return arguments.length?(clamp=!!_,rescale()):clamp};scale.interpolate=function(_){return arguments.length?(interpolate$$1=_,rescale()):interpolate$$1};return rescale()}var tickFormat=function(domain,count,specifier){var start=domain[0],stop=domain[domain.length-1],step=d3Array.tickStep(start,stop,count==null?10:count),precision;specifier=d3Format.formatSpecifier(specifier==null?",f":specifier);switch(specifier.type){case"s":{var value=Math.max(Math.abs(start),Math.abs(stop));if(specifier.precision==null&&!isNaN(precision=d3Format.precisionPrefix(step,value)))specifier.precision=precision;return d3Format.formatPrefix(specifier,value)}case"":case"e":case"g":case"p":case"r":{if(specifier.precision==null&&!isNaN(precision=d3Format.precisionRound(step,Math.max(Math.abs(start),Math.abs(stop)))))specifier.precision=precision-(specifier.type==="e");break}case"f":case"%":{if(specifier.precision==null&&!isNaN(precision=d3Format.precisionFixed(step)))specifier.precision=precision-(specifier.type==="%")*2;break}}return d3Format.format(specifier)};function linearish(scale){var domain=scale.domain;scale.ticks=function(count){var d=domain();return d3Array.ticks(d[0],d[d.length-1],count==null?10:count)};scale.tickFormat=function(count,specifier){return tickFormat(domain(),count,specifier)};scale.nice=function(count){var d=domain(),i=d.length-1,n=count==null?10:count,start=d[0],stop=d[i],step=d3Array.tickStep(start,stop,n);if(step){step=d3Array.tickStep(Math.floor(start/step)*step,Math.ceil(stop/step)*step,n);d[0]=Math.floor(start/step)*step;d[i]=Math.ceil(stop/step)*step;domain(d)}return scale};return scale}function linear(){var scale=continuous(deinterpolateLinear,d3Interpolate.interpolateNumber);scale.copy=function(){return copy(scale,linear())};return linearish(scale)}function identity(){var domain=[0,1];function scale(x){return+x}scale.invert=scale;scale.domain=scale.range=function(_){return arguments.length?(domain=map$1.call(_,number),scale):domain.slice()};scale.copy=function(){return identity().domain(domain)};return linearish(scale)}var nice=function(domain,interval){domain=domain.slice();var i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1],t;if(x1<x0){t=i0,i0=i1,i1=t;t=x0,x0=x1,x1=t}domain[i0]=interval.floor(x0);domain[i1]=interval.ceil(x1);return domain};function deinterpolate(a,b){return(b=Math.log(b/a))?function(x){return Math.log(x/a)/b}:constant(b)}function reinterpolate(a,b){return a<0?function(t){return-Math.pow(-b,t)*Math.pow(-a,1-t)}:function(t){return Math.pow(b,t)*Math.pow(a,1-t)}}function pow10(x){return isFinite(x)?+("1e"+x):x<0?0:x}function powp(base){return base===10?pow10:base===Math.E?Math.exp:function(x){return Math.pow(base,x)}}function logp(base){return base===Math.E?Math.log:base===10&&Math.log10||base===2&&Math.log2||(base=Math.log(base),function(x){return Math.log(x)/base})}function reflect(f){return function(x){return-f(-x)}}function log(){var scale=continuous(deinterpolate,reinterpolate).domain([1,10]),domain=scale.domain,base=10,logs=logp(10),pows=powp(10);function rescale(){logs=logp(base),pows=powp(base);if(domain()[0]<0)logs=reflect(logs),pows=reflect(pows);return scale}scale.base=function(_){return arguments.length?(base=+_,rescale()):base};scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()};scale.ticks=function(count){var d=domain(),u=d[0],v=d[d.length-1],r;if(r=v<u)i=u,u=v,v=i;var i=logs(u),j=logs(v),p,k,t,n=count==null?10:+count,z=[];if(!(base%1)&&j-i<n){i=Math.round(i)-1,j=Math.round(j)+1;if(u>0)for(;i<j;++i){for(k=1,p=pows(i);k<base;++k){t=p*k;if(t<u)continue;if(t>v)break;z.push(t)}}else for(;i<j;++i){for(k=base-1,p=pows(i);k>=1;--k){t=p*k;if(t<u)continue;if(t>v)break;z.push(t)}}}else{z=d3Array.ticks(i,j,Math.min(j-i,n)).map(pows)}return r?z.reverse():z};scale.tickFormat=function(count,specifier){if(specifier==null)specifier=base===10?".0e":",";if(typeof specifier!=="function")specifier=d3Format.format(specifier);if(count===Infinity)return specifier;if(count==null)count=10;var k=Math.max(1,base*count/scale.ticks().length);return function(d){var i=d/pows(Math.round(logs(d)));if(i*base<base-.5)i*=base;return i<=k?specifier(d):""}};scale.nice=function(){return domain(nice(domain(),{floor:function(x){return pows(Math.floor(logs(x)))},ceil:function(x){return pows(Math.ceil(logs(x)))}}))};scale.copy=function(){return copy(scale,log().base(base))};return scale}function raise(x,exponent){return x<0?-Math.pow(-x,exponent):Math.pow(x,exponent)}function pow(){var exponent=1,scale=continuous(deinterpolate,reinterpolate),domain=scale.domain;function deinterpolate(a,b){return(b=raise(b,exponent)-(a=raise(a,exponent)))?function(x){return(raise(x,exponent)-a)/b}:constant(b)}function reinterpolate(a,b){b=raise(b,exponent)-(a=raise(a,exponent));return function(t){return raise(a+b*t,1/exponent)}}scale.exponent=function(_){return arguments.length?(exponent=+_,domain(domain())):exponent};scale.copy=function(){return copy(scale,pow().exponent(exponent))};return linearish(scale)}function sqrt(){return pow().exponent(.5)}function quantile$1(){var domain=[],range$$1=[],thresholds=[];function rescale(){var i=0,n=Math.max(1,range$$1.length);thresholds=new Array(n-1);while(++i<n)thresholds[i-1]=d3Array.quantile(domain,i/n);return scale}function scale(x){if(!isNaN(x=+x))return range$$1[d3Array.bisect(thresholds,x)]}scale.invertExtent=function(y){var i=range$$1.indexOf(y);return i<0?[NaN,NaN]:[i>0?thresholds[i-1]:domain[0],i<thresholds.length?thresholds[i]:domain[domain.length-1]]};scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[];for(var i=0,n=_.length,d;i<n;++i)if(d=_[i],d!=null&&!isNaN(d=+d))domain.push(d);domain.sort(d3Array.ascending);return rescale()};scale.range=function(_){return arguments.length?(range$$1=slice.call(_),rescale()):range$$1.slice()};scale.quantiles=function(){return thresholds.slice()};scale.copy=function(){return quantile$1().domain(domain).range(range$$1)};return scale}function quantize(){var x0=0,x1=1,n=1,domain=[.5],range$$1=[0,1];function scale(x){if(x<=x)return range$$1[d3Array.bisect(domain,x,0,n)]}function rescale(){var i=-1;domain=new Array(n);while(++i<n)domain[i]=((i+1)*x1-(i-n)*x0)/(n+1);
return scale}scale.domain=function(_){return arguments.length?(x0=+_[0],x1=+_[1],rescale()):[x0,x1]};scale.range=function(_){return arguments.length?(n=(range$$1=slice.call(_)).length-1,rescale()):range$$1.slice()};scale.invertExtent=function(y){var i=range$$1.indexOf(y);return i<0?[NaN,NaN]:i<1?[x0,domain[0]]:i>=n?[domain[n-1],x1]:[domain[i-1],domain[i]]};scale.copy=function(){return quantize().domain([x0,x1]).range(range$$1)};return linearish(scale)}function threshold(){var domain=[.5],range$$1=[0,1],n=1;function scale(x){if(x<=x)return range$$1[d3Array.bisect(domain,x,0,n)]}scale.domain=function(_){return arguments.length?(domain=slice.call(_),n=Math.min(domain.length,range$$1.length-1),scale):domain.slice()};scale.range=function(_){return arguments.length?(range$$1=slice.call(_),n=Math.min(domain.length,range$$1.length-1),scale):range$$1.slice()};scale.invertExtent=function(y){var i=range$$1.indexOf(y);return[domain[i-1],domain[i]]};scale.copy=function(){return threshold().domain(domain).range(range$$1)};return scale}var durationSecond=1e3;var durationMinute=durationSecond*60;var durationHour=durationMinute*60;var durationDay=durationHour*24;var durationWeek=durationDay*7;var durationMonth=durationDay*30;var durationYear=durationDay*365;function date(t){return new Date(t)}function number$1(t){return t instanceof Date?+t:+new Date(+t)}function calendar(year,month,week,day,hour,minute,second,millisecond,format$$1){var scale=continuous(deinterpolateLinear,d3Interpolate.interpolateNumber),invert=scale.invert,domain=scale.domain;var formatMillisecond=format$$1(".%L"),formatSecond=format$$1(":%S"),formatMinute=format$$1("%I:%M"),formatHour=format$$1("%I %p"),formatDay=format$$1("%a %d"),formatWeek=format$$1("%b %d"),formatMonth=format$$1("%B"),formatYear=format$$1("%Y");var tickIntervals=[[second,1,durationSecond],[second,5,5*durationSecond],[second,15,15*durationSecond],[second,30,30*durationSecond],[minute,1,durationMinute],[minute,5,5*durationMinute],[minute,15,15*durationMinute],[minute,30,30*durationMinute],[hour,1,durationHour],[hour,3,3*durationHour],[hour,6,6*durationHour],[hour,12,12*durationHour],[day,1,durationDay],[day,2,2*durationDay],[week,1,durationWeek],[month,1,durationMonth],[month,3,3*durationMonth],[year,1,durationYear]];function tickFormat(date){return(second(date)<date?formatMillisecond:minute(date)<date?formatSecond:hour(date)<date?formatMinute:day(date)<date?formatHour:month(date)<date?week(date)<date?formatDay:formatWeek:year(date)<date?formatMonth:formatYear)(date)}function tickInterval(interval,start,stop,step){if(interval==null)interval=10;if(typeof interval==="number"){var target=Math.abs(stop-start)/interval,i=d3Array.bisector(function(i){return i[2]}).right(tickIntervals,target);if(i===tickIntervals.length){step=d3Array.tickStep(start/durationYear,stop/durationYear,interval);interval=year}else if(i){i=tickIntervals[target/tickIntervals[i-1][2]<tickIntervals[i][2]/target?i-1:i];step=i[1];interval=i[0]}else{step=d3Array.tickStep(start,stop,interval);interval=millisecond}}return step==null?interval:interval.every(step)}scale.invert=function(y){return new Date(invert(y))};scale.domain=function(_){return arguments.length?domain(map$1.call(_,number$1)):domain().map(date)};scale.ticks=function(interval,step){var d=domain(),t0=d[0],t1=d[d.length-1],r=t1<t0,t;if(r)t=t0,t0=t1,t1=t;t=tickInterval(interval,t0,t1,step);t=t?t.range(t0,t1+1):[];return r?t.reverse():t};scale.tickFormat=function(count,specifier){return specifier==null?tickFormat:format$$1(specifier)};scale.nice=function(interval,step){var d=domain();return(interval=tickInterval(interval,d[0],d[d.length-1],step))?domain(nice(d,interval)):scale};scale.copy=function(){return copy(scale,calendar(year,month,week,day,hour,minute,second,millisecond,format$$1))};return scale}var time=function(){return calendar(d3Time.timeYear,d3Time.timeMonth,d3Time.timeWeek,d3Time.timeDay,d3Time.timeHour,d3Time.timeMinute,d3Time.timeSecond,d3Time.timeMillisecond,d3TimeFormat.timeFormat).domain([new Date(2e3,0,1),new Date(2e3,0,2)])};var utcTime=function(){return calendar(d3Time.utcYear,d3Time.utcMonth,d3Time.utcWeek,d3Time.utcDay,d3Time.utcHour,d3Time.utcMinute,d3Time.utcSecond,d3Time.utcMillisecond,d3TimeFormat.utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)])};var colors=function(s){return s.match(/.{6}/g).map(function(x){return"#"+x})};var category10=colors("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");var category20b=colors("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6");var category20c=colors("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9");var category20=colors("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5");var cubehelix$1=d3Interpolate.interpolateCubehelixLong(d3Color.cubehelix(300,.5,0),d3Color.cubehelix(-240,.5,1));var warm=d3Interpolate.interpolateCubehelixLong(d3Color.cubehelix(-100,.75,.35),d3Color.cubehelix(80,1.5,.8));var cool=d3Interpolate.interpolateCubehelixLong(d3Color.cubehelix(260,.75,.35),d3Color.cubehelix(80,1.5,.8));var rainbow=d3Color.cubehelix();var rainbow$1=function(t){if(t<0||t>1)t-=Math.floor(t);var ts=Math.abs(t-.5);rainbow.h=360*t-100;rainbow.s=1.5-1.5*ts;rainbow.l=.8-.9*ts;return rainbow+""};function ramp(range$$1){var n=range$$1.length;return function(t){return range$$1[Math.max(0,Math.min(n-1,Math.floor(t*n)))]}}var viridis=ramp(colors("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var magma=ramp(colors("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf"));var inferno=ramp(colors("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4"));var plasma=ramp(colors("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function sequential(interpolator){var x0=0,x1=1,clamp=false;function scale(x){var t=(x-x0)/(x1-x0);return interpolator(clamp?Math.max(0,Math.min(1,t)):t)}scale.domain=function(_){return arguments.length?(x0=+_[0],x1=+_[1],scale):[x0,x1]};scale.clamp=function(_){return arguments.length?(clamp=!!_,scale):clamp};scale.interpolator=function(_){return arguments.length?(interpolator=_,scale):interpolator};scale.copy=function(){return sequential(interpolator).domain([x0,x1]).clamp(clamp)};return linearish(scale)}exports.scaleBand=band;exports.scalePoint=point;exports.scaleIdentity=identity;exports.scaleLinear=linear;exports.scaleLog=log;exports.scaleOrdinal=ordinal;exports.scaleImplicit=implicit;exports.scalePow=pow;exports.scaleSqrt=sqrt;exports.scaleQuantile=quantile$1;exports.scaleQuantize=quantize;exports.scaleThreshold=threshold;exports.scaleTime=time;exports.scaleUtc=utcTime;exports.schemeCategory10=category10;exports.schemeCategory20b=category20b;exports.schemeCategory20c=category20c;exports.schemeCategory20=category20;exports.interpolateCubehelixDefault=cubehelix$1;exports.interpolateRainbow=rainbow$1;exports.interpolateWarm=warm;exports.interpolateCool=cool;exports.interpolateViridis=viridis;exports.interpolateMagma=magma;exports.interpolateInferno=inferno;exports.interpolatePlasma=plasma;exports.scaleSequential=sequential;Object.defineProperty(exports,"__esModule",{value:true})})},{"d3-array":323,"d3-collection":324,"d3-color":325,"d3-format":326,"d3-interpolate":328,"d3-time":332,"d3-time-format":331}],330:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3=global.d3||{})})(this,function(exports){"use strict";var xhtml="http://www.w3.org/1999/xhtml";var namespaces={svg:"http://www.w3.org/2000/svg",xhtml:xhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};var namespace=function(name){var prefix=name+="",i=prefix.indexOf(":");if(i>=0&&(prefix=name.slice(0,i))!=="xmlns")name=name.slice(i+1);return namespaces.hasOwnProperty(prefix)?{space:namespaces[prefix],local:name}:name};function creatorInherit(name){return function(){var document=this.ownerDocument,uri=this.namespaceURI;return uri===xhtml&&document.documentElement.namespaceURI===xhtml?document.createElement(name):document.createElementNS(uri,name)}}function creatorFixed(fullname){return function(){return this.ownerDocument.createElementNS(fullname.space,fullname.local)}}var creator=function(name){var fullname=namespace(name);return(fullname.local?creatorFixed:creatorInherit)(fullname)};var nextId=0;function local(){return new Local}function Local(){this._="@"+(++nextId).toString(36)}Local.prototype=local.prototype={constructor:Local,get:function(node){var id=this._;while(!(id in node))if(!(node=node.parentNode))return;return node[id]},set:function(node,value){return node[this._]=value},remove:function(node){return this._ in node&&delete node[this._]},toString:function(){return this._}};var matcher=function(selector){return function(){return this.matches(selector)}};if(typeof document!=="undefined"){var element=document.documentElement;if(!element.matches){var vendorMatches=element.webkitMatchesSelector||element.msMatchesSelector||element.mozMatchesSelector||element.oMatchesSelector;matcher=function(selector){return function(){return vendorMatches.call(this,selector)}}}}var matcher$1=matcher;var filterEvents={};exports.event=null;if(typeof document!=="undefined"){var element$1=document.documentElement;if(!("onmouseenter"in element$1)){filterEvents={mouseenter:"mouseover",mouseleave:"mouseout"}}}function filterContextListener(listener,index,group){listener=contextListener(listener,index,group);return function(event){var related=event.relatedTarget;if(!related||related!==this&&!(related.compareDocumentPosition(this)&8)){listener.call(this,event)}}}function contextListener(listener,index,group){return function(event1){var event0=exports.event;exports.event=event1;try{listener.call(this,this.__data__,index,group)}finally{exports.event=event0}}}function parseTypenames(typenames){return typenames.trim().split(/^|\s+/).map(function(t){var name="",i=t.indexOf(".");if(i>=0)name=t.slice(i+1),t=t.slice(0,i);return{type:t,name:name}})}function onRemove(typename){return function(){var on=this.__on;if(!on)return;for(var j=0,i=-1,m=on.length,o;j<m;++j){if(o=on[j],(!typename.type||o.type===typename.type)&&o.name===typename.name){this.removeEventListener(o.type,o.listener,o.capture)}else{on[++i]=o}}if(++i)on.length=i;else delete this.__on}}function onAdd(typename,value,capture){var wrap=filterEvents.hasOwnProperty(typename.type)?filterContextListener:contextListener;return function(d,i,group){var on=this.__on,o,listener=wrap(value,i,group);if(on)for(var j=0,m=on.length;j<m;++j){if((o=on[j]).type===typename.type&&o.name===typename.name){this.removeEventListener(o.type,o.listener,o.capture);this.addEventListener(o.type,o.listener=listener,o.capture=capture);o.value=value;return}}this.addEventListener(typename.type,listener,capture);o={type:typename.type,name:typename.name,value:value,listener:listener,capture:capture};if(!on)this.__on=[o];else on.push(o)}}var selection_on=function(typename,value,capture){var typenames=parseTypenames(typename+""),i,n=typenames.length,t;if(arguments.length<2){var on=this.node().__on;if(on)for(var j=0,m=on.length,o;j<m;++j){for(i=0,o=on[j];i<n;++i){if((t=typenames[i]).type===o.type&&t.name===o.name){return o.value}}}return}on=value?onAdd:onRemove;if(capture==null)capture=false;for(i=0;i<n;++i)this.each(on(typenames[i],value,capture));return this};function customEvent(event1,listener,that,args){var event0=exports.event;event1.sourceEvent=exports.event;exports.event=event1;try{return listener.apply(that,args)}finally{exports.event=event0}}var sourceEvent=function(){var current=exports.event,source;while(source=current.sourceEvent)current=source;return current};var point=function(node,event){var svg=node.ownerSVGElement||node;if(svg.createSVGPoint){var point=svg.createSVGPoint();point.x=event.clientX,point.y=event.clientY;point=point.matrixTransform(node.getScreenCTM().inverse());return[point.x,point.y]}var rect=node.getBoundingClientRect();return[event.clientX-rect.left-node.clientLeft,event.clientY-rect.top-node.clientTop]};var mouse=function(node){var event=sourceEvent();if(event.changedTouches)event=event.changedTouches[0];return point(node,event)};function none(){}var selector=function(selector){return selector==null?none:function(){return this.querySelector(selector)}};var selection_select=function(select){if(typeof select!=="function")select=selector(select);for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j){for(var group=groups[j],n=group.length,subgroup=subgroups[j]=new Array(n),node,subnode,i=0;i<n;++i){if((node=group[i])&&(subnode=select.call(node,node.__data__,i,group))){if("__data__"in node)subnode.__data__=node.__data__;subgroup[i]=subnode}}}return new Selection(subgroups,this._parents)};function empty(){return[]}var selectorAll=function(selector){return selector==null?empty:function(){return this.querySelectorAll(selector)}};var selection_selectAll=function(select){if(typeof select!=="function")select=selectorAll(select);for(var groups=this._groups,m=groups.length,subgroups=[],parents=[],j=0;j<m;++j){for(var group=groups[j],n=group.length,node,i=0;i<n;++i){if(node=group[i]){subgroups.push(select.call(node,node.__data__,i,group));parents.push(node)}}}return new Selection(subgroups,parents)};var selection_filter=function(match){if(typeof match!=="function")match=matcher$1(match);for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j){for(var group=groups[j],n=group.length,subgroup=subgroups[j]=[],node,i=0;i<n;++i){if((node=group[i])&&match.call(node,node.__data__,i,group)){subgroup.push(node)}}}return new Selection(subgroups,this._parents)};var sparse=function(update){return new Array(update.length)};var selection_enter=function(){return new Selection(this._enter||this._groups.map(sparse),this._parents)};function EnterNode(parent,datum){this.ownerDocument=parent.ownerDocument;this.namespaceURI=parent.namespaceURI;this._next=null;this._parent=parent;this.__data__=datum}EnterNode.prototype={constructor:EnterNode,appendChild:function(child){return this._parent.insertBefore(child,this._next)},insertBefore:function(child,next){return this._parent.insertBefore(child,next)},querySelector:function(selector){return this._parent.querySelector(selector)},querySelectorAll:function(selector){return this._parent.querySelectorAll(selector)}};var constant=function(x){return function(){return x}};var keyPrefix="$";function bindIndex(parent,group,enter,update,exit,data){var i=0,node,groupLength=group.length,dataLength=data.length;for(;i<dataLength;++i){if(node=group[i]){node.__data__=data[i];update[i]=node}else{enter[i]=new EnterNode(parent,data[i])}}for(;i<groupLength;++i){if(node=group[i]){exit[i]=node}}}function bindKey(parent,group,enter,update,exit,data,key){var i,node,nodeByKeyValue={},groupLength=group.length,dataLength=data.length,keyValues=new Array(groupLength),keyValue;for(i=0;i<groupLength;++i){if(node=group[i]){keyValues[i]=keyValue=keyPrefix+key.call(node,node.__data__,i,group);if(keyValue in nodeByKeyValue){exit[i]=node}else{nodeByKeyValue[keyValue]=node}}}for(i=0;i<dataLength;++i){keyValue=keyPrefix+key.call(parent,data[i],i,data);if(node=nodeByKeyValue[keyValue]){update[i]=node;node.__data__=data[i];nodeByKeyValue[keyValue]=null}else{enter[i]=new EnterNode(parent,data[i])}}for(i=0;i<groupLength;++i){if((node=group[i])&&nodeByKeyValue[keyValues[i]]===node){exit[i]=node}}}var selection_data=function(value,key){if(!value){data=new Array(this.size()),j=-1;this.each(function(d){data[++j]=d});return data}var bind=key?bindKey:bindIndex,parents=this._parents,groups=this._groups;if(typeof value!=="function")value=constant(value);for(var m=groups.length,update=new Array(m),enter=new Array(m),exit=new Array(m),j=0;j<m;++j){var parent=parents[j],group=groups[j],groupLength=group.length,data=value.call(parent,parent&&parent.__data__,j,parents),dataLength=data.length,enterGroup=enter[j]=new Array(dataLength),updateGroup=update[j]=new Array(dataLength),exitGroup=exit[j]=new Array(groupLength);bind(parent,group,enterGroup,updateGroup,exitGroup,data,key);for(var i0=0,i1=0,previous,next;i0<dataLength;++i0){if(previous=enterGroup[i0]){if(i0>=i1)i1=i0+1;while(!(next=updateGroup[i1])&&++i1<dataLength);previous._next=next||null}}}update=new Selection(update,parents);update._enter=enter;update._exit=exit;return update};var selection_exit=function(){return new Selection(this._exit||this._groups.map(sparse),this._parents)};var selection_merge=function(selection){for(var groups0=this._groups,groups1=selection._groups,m0=groups0.length,m1=groups1.length,m=Math.min(m0,m1),merges=new Array(m0),j=0;j<m;++j){for(var group0=groups0[j],group1=groups1[j],n=group0.length,merge=merges[j]=new Array(n),node,i=0;i<n;++i){if(node=group0[i]||group1[i]){merge[i]=node}}}for(;j<m0;++j){merges[j]=groups0[j]}return new Selection(merges,this._parents)};var selection_order=function(){for(var groups=this._groups,j=-1,m=groups.length;++j<m;){for(var group=groups[j],i=group.length-1,next=group[i],node;--i>=0;){if(node=group[i]){if(next&&next!==node.nextSibling)next.parentNode.insertBefore(node,next);next=node}}}return this};var selection_sort=function(compare){if(!compare)compare=ascending;function compareNode(a,b){return a&&b?compare(a.__data__,b.__data__):!a-!b}for(var groups=this._groups,m=groups.length,sortgroups=new Array(m),j=0;j<m;++j){for(var group=groups[j],n=group.length,sortgroup=sortgroups[j]=new Array(n),node,i=0;i<n;++i){if(node=group[i]){sortgroup[i]=node}}sortgroup.sort(compareNode)}return new Selection(sortgroups,this._parents).order()};function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}var selection_call=function(){var callback=arguments[0];arguments[0]=this;callback.apply(null,arguments);return this};var selection_nodes=function(){var nodes=new Array(this.size()),i=-1;this.each(function(){nodes[++i]=this});return nodes};var selection_node=function(){for(var groups=this._groups,j=0,m=groups.length;j<m;++j){for(var group=groups[j],i=0,n=group.length;i<n;++i){var node=group[i];if(node)return node}}return null};var selection_size=function(){var size=0;this.each(function(){++size});return size};var selection_empty=function(){return!this.node()};var selection_each=function(callback){for(var groups=this._groups,j=0,m=groups.length;j<m;++j){for(var group=groups[j],i=0,n=group.length,node;i<n;++i){if(node=group[i])callback.call(node,node.__data__,i,group)}}return this};function attrRemove(name){return function(){this.removeAttribute(name)}}function attrRemoveNS(fullname){return function(){this.removeAttributeNS(fullname.space,fullname.local)}}function attrConstant(name,value){return function(){this.setAttribute(name,value)}}function attrConstantNS(fullname,value){return function(){this.setAttributeNS(fullname.space,fullname.local,value)}}function attrFunction(name,value){return function(){var v=value.apply(this,arguments);if(v==null)this.removeAttribute(name);else this.setAttribute(name,v)}}function attrFunctionNS(fullname,value){return function(){var v=value.apply(this,arguments);if(v==null)this.removeAttributeNS(fullname.space,fullname.local);else this.setAttributeNS(fullname.space,fullname.local,v)}}var selection_attr=function(name,value){var fullname=namespace(name);if(arguments.length<2){var node=this.node();return fullname.local?node.getAttributeNS(fullname.space,fullname.local):node.getAttribute(fullname)}return this.each((value==null?fullname.local?attrRemoveNS:attrRemove:typeof value==="function"?fullname.local?attrFunctionNS:attrFunction:fullname.local?attrConstantNS:attrConstant)(fullname,value))};var defaultView=function(node){return node.ownerDocument&&node.ownerDocument.defaultView||node.document&&node||node.defaultView};function styleRemove(name){return function(){this.style.removeProperty(name)}}function styleConstant(name,value,priority){return function(){this.style.setProperty(name,value,priority)}}function styleFunction(name,value,priority){return function(){var v=value.apply(this,arguments);if(v==null)this.style.removeProperty(name);else this.style.setProperty(name,v,priority)}}var selection_style=function(name,value,priority){var node;return arguments.length>1?this.each((value==null?styleRemove:typeof value==="function"?styleFunction:styleConstant)(name,value,priority==null?"":priority)):defaultView(node=this.node()).getComputedStyle(node,null).getPropertyValue(name)};function propertyRemove(name){return function(){delete this[name]}}function propertyConstant(name,value){return function(){this[name]=value}}function propertyFunction(name,value){return function(){var v=value.apply(this,arguments);if(v==null)delete this[name];else this[name]=v}}var selection_property=function(name,value){return arguments.length>1?this.each((value==null?propertyRemove:typeof value==="function"?propertyFunction:propertyConstant)(name,value)):this.node()[name]};function classArray(string){return string.trim().split(/^|\s+/)}function classList(node){return node.classList||new ClassList(node)}function ClassList(node){this._node=node;this._names=classArray(node.getAttribute("class")||"")}ClassList.prototype={add:function(name){var i=this._names.indexOf(name);if(i<0){this._names.push(name);this._node.setAttribute("class",this._names.join(" "))}},remove:function(name){var i=this._names.indexOf(name);if(i>=0){this._names.splice(i,1);this._node.setAttribute("class",this._names.join(" "))}},contains:function(name){return this._names.indexOf(name)>=0}};function classedAdd(node,names){var list=classList(node),i=-1,n=names.length;while(++i<n)list.add(names[i])}function classedRemove(node,names){var list=classList(node),i=-1,n=names.length;while(++i<n)list.remove(names[i])}function classedTrue(names){return function(){classedAdd(this,names)}}function classedFalse(names){return function(){classedRemove(this,names)}}function classedFunction(names,value){return function(){(value.apply(this,arguments)?classedAdd:classedRemove)(this,names)}}var selection_classed=function(name,value){var names=classArray(name+"");if(arguments.length<2){var list=classList(this.node()),i=-1,n=names.length;while(++i<n)if(!list.contains(names[i]))return false;return true}return this.each((typeof value==="function"?classedFunction:value?classedTrue:classedFalse)(names,value))};function textRemove(){this.textContent=""}function textConstant(value){return function(){this.textContent=value}}function textFunction(value){return function(){var v=value.apply(this,arguments);this.textContent=v==null?"":v}}var selection_text=function(value){return arguments.length?this.each(value==null?textRemove:(typeof value==="function"?textFunction:textConstant)(value)):this.node().textContent};function htmlRemove(){this.innerHTML=""}function htmlConstant(value){return function(){this.innerHTML=value}}function htmlFunction(value){return function(){var v=value.apply(this,arguments);this.innerHTML=v==null?"":v}}var selection_html=function(value){return arguments.length?this.each(value==null?htmlRemove:(typeof value==="function"?htmlFunction:htmlConstant)(value)):this.node().innerHTML};function raise(){if(this.nextSibling)this.parentNode.appendChild(this)}var selection_raise=function(){return this.each(raise)};function lower(){if(this.previousSibling)this.parentNode.insertBefore(this,this.parentNode.firstChild)}var selection_lower=function(){return this.each(lower)};var selection_append=function(name){var create=typeof name==="function"?name:creator(name);return this.select(function(){return this.appendChild(create.apply(this,arguments))})};function constantNull(){return null}var selection_insert=function(name,before){var create=typeof name==="function"?name:creator(name),select=before==null?constantNull:typeof before==="function"?before:selector(before);return this.select(function(){return this.insertBefore(create.apply(this,arguments),select.apply(this,arguments)||null)})};function remove(){var parent=this.parentNode;if(parent)parent.removeChild(this)}var selection_remove=function(){return this.each(remove)};var selection_datum=function(value){return arguments.length?this.property("__data__",value):this.node().__data__};function dispatchEvent(node,type,params){var window=defaultView(node),event=window.CustomEvent;if(event){event=new event(type,params)}else{event=window.document.createEvent("Event");if(params)event.initEvent(type,params.bubbles,params.cancelable),event.detail=params.detail;else event.initEvent(type,false,false)}node.dispatchEvent(event)}function dispatchConstant(type,params){return function(){return dispatchEvent(this,type,params)}}function dispatchFunction(type,params){return function(){return dispatchEvent(this,type,params.apply(this,arguments))}}var selection_dispatch=function(type,params){return this.each((typeof params==="function"?dispatchFunction:dispatchConstant)(type,params))};var root=[null];function Selection(groups,parents){this._groups=groups;this._parents=parents}function selection(){return new Selection([[document.documentElement]],root)}Selection.prototype=selection.prototype={constructor:Selection,select:selection_select,selectAll:selection_selectAll,filter:selection_filter,data:selection_data,enter:selection_enter,exit:selection_exit,merge:selection_merge,order:selection_order,sort:selection_sort,call:selection_call,nodes:selection_nodes,node:selection_node,size:selection_size,empty:selection_empty,each:selection_each,attr:selection_attr,style:selection_style,property:selection_property,classed:selection_classed,text:selection_text,html:selection_html,raise:selection_raise,lower:selection_lower,append:selection_append,insert:selection_insert,remove:selection_remove,datum:selection_datum,on:selection_on,dispatch:selection_dispatch};var select=function(selector){return typeof selector==="string"?new Selection([[document.querySelector(selector)]],[document.documentElement]):new Selection([[selector]],root);
};var selectAll=function(selector){return typeof selector==="string"?new Selection([document.querySelectorAll(selector)],[document.documentElement]):new Selection([selector==null?[]:selector],root)};var touch=function(node,touches,identifier){if(arguments.length<3)identifier=touches,touches=sourceEvent().changedTouches;for(var i=0,n=touches?touches.length:0,touch;i<n;++i){if((touch=touches[i]).identifier===identifier){return point(node,touch)}}return null};var touches=function(node,touches){if(touches==null)touches=sourceEvent().touches;for(var i=0,n=touches?touches.length:0,points=new Array(n);i<n;++i){points[i]=point(node,touches[i])}return points};exports.creator=creator;exports.local=local;exports.matcher=matcher$1;exports.mouse=mouse;exports.namespace=namespace;exports.namespaces=namespaces;exports.select=select;exports.selectAll=selectAll;exports.selection=selection;exports.selector=selector;exports.selectorAll=selectorAll;exports.touch=touch;exports.touches=touches;exports.window=defaultView;exports.customEvent=customEvent;Object.defineProperty(exports,"__esModule",{value:true})})},{}],331:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports,require("d3-time")):typeof define==="function"&&define.amd?define(["exports","d3-time"],factory):factory(global.d3=global.d3||{},global.d3)})(this,function(exports,d3Time){"use strict";function localDate(d){if(0<=d.y&&d.y<100){var date=new Date(-1,d.m,d.d,d.H,d.M,d.S,d.L);date.setFullYear(d.y);return date}return new Date(d.y,d.m,d.d,d.H,d.M,d.S,d.L)}function utcDate(d){if(0<=d.y&&d.y<100){var date=new Date(Date.UTC(-1,d.m,d.d,d.H,d.M,d.S,d.L));date.setUTCFullYear(d.y);return date}return new Date(Date.UTC(d.y,d.m,d.d,d.H,d.M,d.S,d.L))}function newYear(y){return{y:y,m:0,d:1,H:0,M:0,S:0,L:0}}function formatLocale(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_weekdays=locale.days,locale_shortWeekdays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths;var periodRe=formatRe(locale_periods),periodLookup=formatLookup(locale_periods),weekdayRe=formatRe(locale_weekdays),weekdayLookup=formatLookup(locale_weekdays),shortWeekdayRe=formatRe(locale_shortWeekdays),shortWeekdayLookup=formatLookup(locale_shortWeekdays),monthRe=formatRe(locale_months),monthLookup=formatLookup(locale_months),shortMonthRe=formatRe(locale_shortMonths),shortMonthLookup=formatLookup(locale_shortMonths);var formats={a:formatShortWeekday,A:formatWeekday,b:formatShortMonth,B:formatMonth,c:null,d:formatDayOfMonth,e:formatDayOfMonth,H:formatHour24,I:formatHour12,j:formatDayOfYear,L:formatMilliseconds,m:formatMonthNumber,M:formatMinutes,p:formatPeriod,S:formatSeconds,U:formatWeekNumberSunday,w:formatWeekdayNumber,W:formatWeekNumberMonday,x:null,X:null,y:formatYear,Y:formatFullYear,Z:formatZone,"%":formatLiteralPercent};var utcFormats={a:formatUTCShortWeekday,A:formatUTCWeekday,b:formatUTCShortMonth,B:formatUTCMonth,c:null,d:formatUTCDayOfMonth,e:formatUTCDayOfMonth,H:formatUTCHour24,I:formatUTCHour12,j:formatUTCDayOfYear,L:formatUTCMilliseconds,m:formatUTCMonthNumber,M:formatUTCMinutes,p:formatUTCPeriod,S:formatUTCSeconds,U:formatUTCWeekNumberSunday,w:formatUTCWeekdayNumber,W:formatUTCWeekNumberMonday,x:null,X:null,y:formatUTCYear,Y:formatUTCFullYear,Z:formatUTCZone,"%":formatLiteralPercent};var parses={a:parseShortWeekday,A:parseWeekday,b:parseShortMonth,B:parseMonth,c:parseLocaleDateTime,d:parseDayOfMonth,e:parseDayOfMonth,H:parseHour24,I:parseHour24,j:parseDayOfYear,L:parseMilliseconds,m:parseMonthNumber,M:parseMinutes,p:parsePeriod,S:parseSeconds,U:parseWeekNumberSunday,w:parseWeekdayNumber,W:parseWeekNumberMonday,x:parseLocaleDate,X:parseLocaleTime,y:parseYear,Y:parseFullYear,Z:parseZone,"%":parseLiteralPercent};formats.x=newFormat(locale_date,formats);formats.X=newFormat(locale_time,formats);formats.c=newFormat(locale_dateTime,formats);utcFormats.x=newFormat(locale_date,utcFormats);utcFormats.X=newFormat(locale_time,utcFormats);utcFormats.c=newFormat(locale_dateTime,utcFormats);function newFormat(specifier,formats){return function(date){var string=[],i=-1,j=0,n=specifier.length,c,pad,format;if(!(date instanceof Date))date=new Date(+date);while(++i<n){if(specifier.charCodeAt(i)===37){string.push(specifier.slice(j,i));if((pad=pads[c=specifier.charAt(++i)])!=null)c=specifier.charAt(++i);else pad=c==="e"?" ":"0";if(format=formats[c])c=format(date,pad);string.push(c);j=i+1}}string.push(specifier.slice(j,i));return string.join("")}}function newParse(specifier,newDate){return function(string){var d=newYear(1900),i=parseSpecifier(d,specifier,string+="",0);if(i!=string.length)return null;if("p"in d)d.H=d.H%12+d.p*12;if("W"in d||"U"in d){if(!("w"in d))d.w="W"in d?1:0;var day="Z"in d?utcDate(newYear(d.y)).getUTCDay():newDate(newYear(d.y)).getDay();d.m=0;d.d="W"in d?(d.w+6)%7+d.W*7-(day+5)%7:d.w+d.U*7-(day+6)%7}if("Z"in d){d.H+=d.Z/100|0;d.M+=d.Z%100;return utcDate(d)}return newDate(d)}}function parseSpecifier(d,specifier,string,j){var i=0,n=specifier.length,m=string.length,c,parse;while(i<n){if(j>=m)return-1;c=specifier.charCodeAt(i++);if(c===37){c=specifier.charAt(i++);parse=parses[c in pads?specifier.charAt(i++):c];if(!parse||(j=parse(d,string,j))<0)return-1}else if(c!=string.charCodeAt(j++)){return-1}}return j}function parsePeriod(d,string,i){var n=periodRe.exec(string.slice(i));return n?(d.p=periodLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseShortWeekday(d,string,i){var n=shortWeekdayRe.exec(string.slice(i));return n?(d.w=shortWeekdayLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseWeekday(d,string,i){var n=weekdayRe.exec(string.slice(i));return n?(d.w=weekdayLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseShortMonth(d,string,i){var n=shortMonthRe.exec(string.slice(i));return n?(d.m=shortMonthLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseMonth(d,string,i){var n=monthRe.exec(string.slice(i));return n?(d.m=monthLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseLocaleDateTime(d,string,i){return parseSpecifier(d,locale_dateTime,string,i)}function parseLocaleDate(d,string,i){return parseSpecifier(d,locale_date,string,i)}function parseLocaleTime(d,string,i){return parseSpecifier(d,locale_time,string,i)}function formatShortWeekday(d){return locale_shortWeekdays[d.getDay()]}function formatWeekday(d){return locale_weekdays[d.getDay()]}function formatShortMonth(d){return locale_shortMonths[d.getMonth()]}function formatMonth(d){return locale_months[d.getMonth()]}function formatPeriod(d){return locale_periods[+(d.getHours()>=12)]}function formatUTCShortWeekday(d){return locale_shortWeekdays[d.getUTCDay()]}function formatUTCWeekday(d){return locale_weekdays[d.getUTCDay()]}function formatUTCShortMonth(d){return locale_shortMonths[d.getUTCMonth()]}function formatUTCMonth(d){return locale_months[d.getUTCMonth()]}function formatUTCPeriod(d){return locale_periods[+(d.getUTCHours()>=12)]}return{format:function(specifier){var f=newFormat(specifier+="",formats);f.toString=function(){return specifier};return f},parse:function(specifier){var p=newParse(specifier+="",localDate);p.toString=function(){return specifier};return p},utcFormat:function(specifier){var f=newFormat(specifier+="",utcFormats);f.toString=function(){return specifier};return f},utcParse:function(specifier){var p=newParse(specifier,utcDate);p.toString=function(){return specifier};return p}}}var pads={"-":"",_:" ",0:"0"};var numberRe=/^\s*\d+/;var percentRe=/^%/;var requoteRe=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;function pad(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string)}function requote(s){return s.replace(requoteRe,"\\$&")}function formatRe(names){return new RegExp("^(?:"+names.map(requote).join("|")+")","i")}function formatLookup(names){var map={},i=-1,n=names.length;while(++i<n)map[names[i].toLowerCase()]=i;return map}function parseWeekdayNumber(d,string,i){var n=numberRe.exec(string.slice(i,i+1));return n?(d.w=+n[0],i+n[0].length):-1}function parseWeekNumberSunday(d,string,i){var n=numberRe.exec(string.slice(i));return n?(d.U=+n[0],i+n[0].length):-1}function parseWeekNumberMonday(d,string,i){var n=numberRe.exec(string.slice(i));return n?(d.W=+n[0],i+n[0].length):-1}function parseFullYear(d,string,i){var n=numberRe.exec(string.slice(i,i+4));return n?(d.y=+n[0],i+n[0].length):-1}function parseYear(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.y=+n[0]+(+n[0]>68?1900:2e3),i+n[0].length):-1}function parseZone(d,string,i){var n=/^(Z)|([+-]\d\d)(?:\:?(\d\d))?/.exec(string.slice(i,i+6));return n?(d.Z=n[1]?0:-(n[2]+(n[3]||"00")),i+n[0].length):-1}function parseMonthNumber(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.m=n[0]-1,i+n[0].length):-1}function parseDayOfMonth(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.d=+n[0],i+n[0].length):-1}function parseDayOfYear(d,string,i){var n=numberRe.exec(string.slice(i,i+3));return n?(d.m=0,d.d=+n[0],i+n[0].length):-1}function parseHour24(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.H=+n[0],i+n[0].length):-1}function parseMinutes(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.M=+n[0],i+n[0].length):-1}function parseSeconds(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.S=+n[0],i+n[0].length):-1}function parseMilliseconds(d,string,i){var n=numberRe.exec(string.slice(i,i+3));return n?(d.L=+n[0],i+n[0].length):-1}function parseLiteralPercent(d,string,i){var n=percentRe.exec(string.slice(i,i+1));return n?i+n[0].length:-1}function formatDayOfMonth(d,p){return pad(d.getDate(),p,2)}function formatHour24(d,p){return pad(d.getHours(),p,2)}function formatHour12(d,p){return pad(d.getHours()%12||12,p,2)}function formatDayOfYear(d,p){return pad(1+d3Time.timeDay.count(d3Time.timeYear(d),d),p,3)}function formatMilliseconds(d,p){return pad(d.getMilliseconds(),p,3)}function formatMonthNumber(d,p){return pad(d.getMonth()+1,p,2)}function formatMinutes(d,p){return pad(d.getMinutes(),p,2)}function formatSeconds(d,p){return pad(d.getSeconds(),p,2)}function formatWeekNumberSunday(d,p){return pad(d3Time.timeSunday.count(d3Time.timeYear(d),d),p,2)}function formatWeekdayNumber(d){return d.getDay()}function formatWeekNumberMonday(d,p){return pad(d3Time.timeMonday.count(d3Time.timeYear(d),d),p,2)}function formatYear(d,p){return pad(d.getFullYear()%100,p,2)}function formatFullYear(d,p){return pad(d.getFullYear()%1e4,p,4)}function formatZone(d){var z=d.getTimezoneOffset();return(z>0?"-":(z*=-1,"+"))+pad(z/60|0,"0",2)+pad(z%60,"0",2)}function formatUTCDayOfMonth(d,p){return pad(d.getUTCDate(),p,2)}function formatUTCHour24(d,p){return pad(d.getUTCHours(),p,2)}function formatUTCHour12(d,p){return pad(d.getUTCHours()%12||12,p,2)}function formatUTCDayOfYear(d,p){return pad(1+d3Time.utcDay.count(d3Time.utcYear(d),d),p,3)}function formatUTCMilliseconds(d,p){return pad(d.getUTCMilliseconds(),p,3)}function formatUTCMonthNumber(d,p){return pad(d.getUTCMonth()+1,p,2)}function formatUTCMinutes(d,p){return pad(d.getUTCMinutes(),p,2)}function formatUTCSeconds(d,p){return pad(d.getUTCSeconds(),p,2)}function formatUTCWeekNumberSunday(d,p){return pad(d3Time.utcSunday.count(d3Time.utcYear(d),d),p,2)}function formatUTCWeekdayNumber(d){return d.getUTCDay()}function formatUTCWeekNumberMonday(d,p){return pad(d3Time.utcMonday.count(d3Time.utcYear(d),d),p,2)}function formatUTCYear(d,p){return pad(d.getUTCFullYear()%100,p,2)}function formatUTCFullYear(d,p){return pad(d.getUTCFullYear()%1e4,p,4)}function formatUTCZone(){return"+0000"}function formatLiteralPercent(){return"%"}var locale$1;defaultLocale({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function defaultLocale(definition){locale$1=formatLocale(definition);exports.timeFormat=locale$1.format;exports.timeParse=locale$1.parse;exports.utcFormat=locale$1.utcFormat;exports.utcParse=locale$1.utcParse;return locale$1}var isoSpecifier="%Y-%m-%dT%H:%M:%S.%LZ";function formatIsoNative(date){return date.toISOString()}var formatIso=Date.prototype.toISOString?formatIsoNative:exports.utcFormat(isoSpecifier);function parseIsoNative(string){var date=new Date(string);return isNaN(date)?null:date}var parseIso=+new Date("2000-01-01T00:00:00.000Z")?parseIsoNative:exports.utcParse(isoSpecifier);exports.timeFormatDefaultLocale=defaultLocale;exports.timeFormatLocale=formatLocale;exports.isoFormat=formatIso;exports.isoParse=parseIso;Object.defineProperty(exports,"__esModule",{value:true})})},{"d3-time":332}],332:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3=global.d3||{})})(this,function(exports){"use strict";var t0=new Date;var t1=new Date;function newInterval(floori,offseti,count,field){function interval(date){return floori(date=new Date(+date)),date}interval.floor=interval;interval.ceil=function(date){return floori(date=new Date(date-1)),offseti(date,1),floori(date),date};interval.round=function(date){var d0=interval(date),d1=interval.ceil(date);return date-d0<d1-date?d0:d1};interval.offset=function(date,step){return offseti(date=new Date(+date),step==null?1:Math.floor(step)),date};interval.range=function(start,stop,step){var range=[];start=interval.ceil(start);step=step==null?1:Math.floor(step);if(!(start<stop)||!(step>0))return range;do range.push(new Date(+start));while(offseti(start,step),floori(start),start<stop);return range};interval.filter=function(test){return newInterval(function(date){if(date>=date)while(floori(date),!test(date))date.setTime(date-1)},function(date,step){if(date>=date)while(--step>=0)while(offseti(date,1),!test(date)){}})};if(count){interval.count=function(start,end){t0.setTime(+start),t1.setTime(+end);floori(t0),floori(t1);return Math.floor(count(t0,t1))};interval.every=function(step){step=Math.floor(step);return!isFinite(step)||!(step>0)?null:!(step>1)?interval:interval.filter(field?function(d){return field(d)%step===0}:function(d){return interval.count(0,d)%step===0})}}return interval}var millisecond=newInterval(function(){},function(date,step){date.setTime(+date+step)},function(start,end){return end-start});millisecond.every=function(k){k=Math.floor(k);if(!isFinite(k)||!(k>0))return null;if(!(k>1))return millisecond;return newInterval(function(date){date.setTime(Math.floor(date/k)*k)},function(date,step){date.setTime(+date+step*k)},function(start,end){return(end-start)/k})};var milliseconds=millisecond.range;var durationSecond=1e3;var durationMinute=6e4;var durationHour=36e5;var durationDay=864e5;var durationWeek=6048e5;var second=newInterval(function(date){date.setTime(Math.floor(date/durationSecond)*durationSecond)},function(date,step){date.setTime(+date+step*durationSecond)},function(start,end){return(end-start)/durationSecond},function(date){return date.getUTCSeconds()});var seconds=second.range;var minute=newInterval(function(date){date.setTime(Math.floor(date/durationMinute)*durationMinute)},function(date,step){date.setTime(+date+step*durationMinute)},function(start,end){return(end-start)/durationMinute},function(date){return date.getMinutes()});var minutes=minute.range;var hour=newInterval(function(date){var offset=date.getTimezoneOffset()*durationMinute%durationHour;if(offset<0)offset+=durationHour;date.setTime(Math.floor((+date-offset)/durationHour)*durationHour+offset)},function(date,step){date.setTime(+date+step*durationHour)},function(start,end){return(end-start)/durationHour},function(date){return date.getHours()});var hours=hour.range;var day=newInterval(function(date){date.setHours(0,0,0,0)},function(date,step){date.setDate(date.getDate()+step)},function(start,end){return(end-start-(end.getTimezoneOffset()-start.getTimezoneOffset())*durationMinute)/durationDay},function(date){return date.getDate()-1});var days=day.range;function weekday(i){return newInterval(function(date){date.setDate(date.getDate()-(date.getDay()+7-i)%7);date.setHours(0,0,0,0)},function(date,step){date.setDate(date.getDate()+step*7)},function(start,end){return(end-start-(end.getTimezoneOffset()-start.getTimezoneOffset())*durationMinute)/durationWeek})}var sunday=weekday(0);var monday=weekday(1);var tuesday=weekday(2);var wednesday=weekday(3);var thursday=weekday(4);var friday=weekday(5);var saturday=weekday(6);var sundays=sunday.range;var mondays=monday.range;var tuesdays=tuesday.range;var wednesdays=wednesday.range;var thursdays=thursday.range;var fridays=friday.range;var saturdays=saturday.range;var month=newInterval(function(date){date.setDate(1);date.setHours(0,0,0,0)},function(date,step){date.setMonth(date.getMonth()+step)},function(start,end){return end.getMonth()-start.getMonth()+(end.getFullYear()-start.getFullYear())*12},function(date){return date.getMonth()});var months=month.range;var year=newInterval(function(date){date.setMonth(0,1);date.setHours(0,0,0,0)},function(date,step){date.setFullYear(date.getFullYear()+step)},function(start,end){return end.getFullYear()-start.getFullYear()},function(date){return date.getFullYear()});year.every=function(k){return!isFinite(k=Math.floor(k))||!(k>0)?null:newInterval(function(date){date.setFullYear(Math.floor(date.getFullYear()/k)*k);date.setMonth(0,1);date.setHours(0,0,0,0)},function(date,step){date.setFullYear(date.getFullYear()+step*k)})};var years=year.range;var utcMinute=newInterval(function(date){date.setUTCSeconds(0,0)},function(date,step){date.setTime(+date+step*durationMinute)},function(start,end){return(end-start)/durationMinute},function(date){return date.getUTCMinutes()});var utcMinutes=utcMinute.range;var utcHour=newInterval(function(date){date.setUTCMinutes(0,0,0)},function(date,step){date.setTime(+date+step*durationHour)},function(start,end){return(end-start)/durationHour},function(date){return date.getUTCHours()});var utcHours=utcHour.range;var utcDay=newInterval(function(date){date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCDate(date.getUTCDate()+step)},function(start,end){return(end-start)/durationDay},function(date){return date.getUTCDate()-1});var utcDays=utcDay.range;function utcWeekday(i){return newInterval(function(date){date.setUTCDate(date.getUTCDate()-(date.getUTCDay()+7-i)%7);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCDate(date.getUTCDate()+step*7)},function(start,end){return(end-start)/durationWeek})}var utcSunday=utcWeekday(0);var utcMonday=utcWeekday(1);var utcTuesday=utcWeekday(2);var utcWednesday=utcWeekday(3);var utcThursday=utcWeekday(4);var utcFriday=utcWeekday(5);var utcSaturday=utcWeekday(6);var utcSundays=utcSunday.range;var utcMondays=utcMonday.range;var utcTuesdays=utcTuesday.range;var utcWednesdays=utcWednesday.range;var utcThursdays=utcThursday.range;var utcFridays=utcFriday.range;var utcSaturdays=utcSaturday.range;var utcMonth=newInterval(function(date){date.setUTCDate(1);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCMonth(date.getUTCMonth()+step)},function(start,end){return end.getUTCMonth()-start.getUTCMonth()+(end.getUTCFullYear()-start.getUTCFullYear())*12},function(date){return date.getUTCMonth()});var utcMonths=utcMonth.range;var utcYear=newInterval(function(date){date.setUTCMonth(0,1);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step)},function(start,end){return end.getUTCFullYear()-start.getUTCFullYear()},function(date){return date.getUTCFullYear()});utcYear.every=function(k){return!isFinite(k=Math.floor(k))||!(k>0)?null:newInterval(function(date){date.setUTCFullYear(Math.floor(date.getUTCFullYear()/k)*k);date.setUTCMonth(0,1);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step*k)})};var utcYears=utcYear.range;exports.timeInterval=newInterval;exports.timeMillisecond=millisecond;exports.timeMilliseconds=milliseconds;exports.utcMillisecond=millisecond;exports.utcMilliseconds=milliseconds;exports.timeSecond=second;exports.timeSeconds=seconds;exports.utcSecond=second;exports.utcSeconds=seconds;exports.timeMinute=minute;exports.timeMinutes=minutes;exports.timeHour=hour;exports.timeHours=hours;exports.timeDay=day;exports.timeDays=days;exports.timeWeek=sunday;exports.timeWeeks=sundays;exports.timeSunday=sunday;exports.timeSundays=sundays;exports.timeMonday=monday;exports.timeMondays=mondays;exports.timeTuesday=tuesday;exports.timeTuesdays=tuesdays;exports.timeWednesday=wednesday;exports.timeWednesdays=wednesdays;exports.timeThursday=thursday;exports.timeThursdays=thursdays;exports.timeFriday=friday;exports.timeFridays=fridays;exports.timeSaturday=saturday;exports.timeSaturdays=saturdays;exports.timeMonth=month;exports.timeMonths=months;exports.timeYear=year;exports.timeYears=years;exports.utcMinute=utcMinute;exports.utcMinutes=utcMinutes;exports.utcHour=utcHour;exports.utcHours=utcHours;exports.utcDay=utcDay;exports.utcDays=utcDays;exports.utcWeek=utcSunday;exports.utcWeeks=utcSundays;exports.utcSunday=utcSunday;exports.utcSundays=utcSundays;exports.utcMonday=utcMonday;exports.utcMondays=utcMondays;exports.utcTuesday=utcTuesday;exports.utcTuesdays=utcTuesdays;exports.utcWednesday=utcWednesday;exports.utcWednesdays=utcWednesdays;exports.utcThursday=utcThursday;exports.utcThursdays=utcThursdays;exports.utcFriday=utcFriday;exports.utcFridays=utcFridays;exports.utcSaturday=utcSaturday;exports.utcSaturdays=utcSaturdays;exports.utcMonth=utcMonth;exports.utcMonths=utcMonths;exports.utcYear=utcYear;exports.utcYears=utcYears;Object.defineProperty(exports,"__esModule",{value:true})})},{}],333:[function(require,module,exports){(function(Buffer){module.exports=dataUriToBuffer;function dataUriToBuffer(uri){if(!/^data\:/i.test(uri)){throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")')}uri=uri.replace(/\r?\n/g,"");var firstComma=uri.indexOf(",");if(-1===firstComma||firstComma<=4)throw new TypeError("malformed data: URI");var meta=uri.substring(5,firstComma).split(";");var base64=false;var charset="US-ASCII";for(var i=0;i<meta.length;i++){if("base64"==meta[i]){base64=true}else if(0==meta[i].indexOf("charset=")){charset=meta[i].substring(8)}}var data=unescape(uri.substring(firstComma+1));var encoding=base64?"base64":"ascii";var buffer=new Buffer(data,encoding);buffer.type=meta[0]||"text/plain";buffer.charset=charset;return buffer}}).call(this,require("buffer").Buffer)},{buffer:19}],334:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _reflectionEffect=require("./reflection-effect");Object.defineProperty(exports,"ReflectionEffect",{enumerable:true,get:function get(){return _interopRequireDefault(_reflectionEffect).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./reflection-effect":335}],335:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _reflectionEffect=require("./reflection-effect");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_reflectionEffect).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./reflection-effect":336}],336:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _luma=require("luma.gl");var _shaderUtils=require("../../../shader-utils");var _lib=require("../../lib");var _path=require("path");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ReflectionEffect=function(_Effect){_inherits(ReflectionEffect,_Effect);function ReflectionEffect(){var reflectivity=arguments.length>0&&arguments[0]!==undefined?arguments[0]:.2;_classCallCheck(this,ReflectionEffect);var _this=_possibleConstructorReturn(this,(ReflectionEffect.__proto__||Object.getPrototypeOf(ReflectionEffect)).call(this));_this.reflectivity=reflectivity;_this.framebuffer=null;_this.setNeedsRedraw();return _this}_createClass(ReflectionEffect,[{key:"getShaders",value:function getShaders(){return{vs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME reflection-effect-vs\n\nattribute vec3 vertices;\n\nvarying vec2 uv;\n\nvoid main(void) {\n  uv = vertices.xy;\n  gl_Position = vec4(2. * vertices.xy - vec2(1., 1.), 1., 1.);\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME reflection-effect-fs\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D reflectionTexture;\nuniform float reflectivity;\n\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_FragColor = texture2D(reflectionTexture, vec2(uv.x, 1. - uv.y));\n  gl_FragColor.a *= reflectivity;\n}\n'}}},{key:"initialize",value:function initialize(_ref){var gl=_ref.gl,layerManager=_ref.layerManager;this.model=new _luma.Model(_extends({gl:gl},(0,_shaderUtils.assembleShaders)(gl,this.getShaders()),{geometry:new _luma.Geometry({drawMode:_luma.GL.TRIANGLE_FAN,vertices:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])})}));this.framebuffer=new _luma.Framebuffer(gl)}},{key:"preDraw",value:function preDraw(_ref2){var gl=_ref2.gl,layerManager=_ref2.layerManager;var viewport=layerManager.context.viewport;var dpi=typeof window!=="undefined"&&window.devicePixelRatio||1;this.framebuffer.resize({width:dpi*viewport.width,height:dpi*viewport.height});var pitch=viewport.pitch;this.framebuffer.bind();layerManager.setContext(_extends({},viewport,{pitch:-180-pitch}));gl.clear(_luma.GL.COLOR_BUFFER_BIT|_luma.GL.DEPTH_BUFFER_BIT);layerManager.drawLayers();layerManager.setContext(_extends({},viewport,{pitch:pitch}));gl.bindFramebuffer(gl.FRAMEBUFFER,null)}},{key:"draw",value:function draw(_ref3){var gl=_ref3.gl,layerManager=_ref3.layerManager;this.model.render({reflectionTexture:this.framebuffer.texture,reflectivity:this.reflectivity})}},{key:"finalize",value:function finalize(_ref4){var gl=_ref4.gl,layerManager=_ref4.layerManager}}]);return ReflectionEffect}(_lib.Effect);exports.default=ReflectionEffect},{"../../../shader-utils":378,"../../lib":340,"luma.gl":505,path:745}],337:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _effects=require("./effects");Object.keys(_effects).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _effects[key]}})});var _lib=require("./lib");Object.keys(_lib).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _lib[key]}})})},{"./effects":334,"./lib":340}],338:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var EffectManager=function(){function EffectManager(_ref){var gl=_ref.gl,layerManager=_ref.layerManager;_classCallCheck(this,EffectManager);this.gl=gl;this.layerManager=layerManager;this._effects=[]}_createClass(EffectManager,[{key:"addEffect",value:function addEffect(effect){this._effects.push(effect);this._sortEffects();effect.initialize({gl:this.gl,layerManager:this.layerManager})}},{key:"removeEffect",value:function removeEffect(effect){
var i=this._effects.indexOf(effect);if(i>=0){effect.finalize({gl:this.gl,layerManager:this.layerManager});this._effects.splice(i,1);return true}return false}},{key:"preDraw",value:function preDraw(){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this._effects[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var effect=_step.value;if(effect.needsRedraw){effect.preDraw({gl:this.gl,layerManager:this.layerManager})}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"draw",value:function draw(){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this._effects[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var effect=_step2.value;if(effect.needsRedraw){effect.draw({gl:this.gl,layerManager:this.layerManager})}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"_sortEffects",value:function _sortEffects(){this._effects.sort(function(a,b){if(a.priority>b.priority){return-1}else if(a.priority<b.priority){return 1}return a.count-b.count})}}]);return EffectManager}();exports.default=EffectManager},{}],339:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var counter=0;var Effect=function(){function Effect(){_classCallCheck(this,Effect);this.count=counter++;this.visible=true;this.priority=0;this.needsRedraw=false}_createClass(Effect,[{key:"initialize",value:function initialize(_ref){var gl=_ref.gl,layerManager=_ref.layerManager}},{key:"finalize",value:function finalize(_ref2){var gl=_ref2.gl,layerManager=_ref2.layerManager}},{key:"preDraw",value:function preDraw(_ref3){var gl=_ref3.gl,layerManager=_ref3.layerManager}},{key:"draw",value:function draw(_ref4){var gl=_ref4.gl,layerManager=_ref4.layerManager}},{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.needsRedraw=redraw}}]);return Effect}();exports.default=Effect},{}],340:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _effect=require("./effect");Object.defineProperty(exports,"Effect",{enumerable:true,get:function get(){return _interopRequireDefault(_effect).default}});var _effectManager=require("./effect-manager");Object.defineProperty(exports,"EffectManager",{enumerable:true,get:function get(){return _interopRequireDefault(_effectManager).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./effect":339,"./effect-manager":338}],341:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _lib=require("./lib");Object.keys(_lib).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _lib[key]}})});var _lib2=require("./experimental/lib");Object.keys(_lib2).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _lib2[key]}})});var _viewport=require("./viewport");Object.keys(_viewport).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _viewport[key]}})});var _shaderUtils=require("./shader-utils");Object.keys(_shaderUtils).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _shaderUtils[key]}})});var _core=require("./layers/core");Object.keys(_core).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _core[key]}})});var _fp=require("./layers/fp64");Object.keys(_fp).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _fp[key]}})});var _effects=require("./experimental/effects");Object.keys(_effects).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _effects[key]}})})},{"./experimental/effects":334,"./experimental/lib":340,"./layers/core":346,"./layers/fp64":359,"./lib":365,"./shader-utils":378,"./viewport":383}],342:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _class,_temp;var _=require("../../..");var _luma=require("luma.gl");var _path=require("path");function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,0,255,255];var defaultGetSourcePosition=function defaultGetSourcePosition(x){return x.sourcePosition};var defaultGetTargetPosition=function defaultGetTargetPosition(x){return x.targetPosition};var defaultGetColor=function defaultGetColor(x){return x.color};var ArcLayer=(_temp=_class=function(_Layer){_inherits(ArcLayer,_Layer);function ArcLayer(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$strokeWidth=_ref.strokeWidth,strokeWidth=_ref$strokeWidth===undefined?1:_ref$strokeWidth,_ref$getSourcePositio=_ref.getSourcePosition,getSourcePosition=_ref$getSourcePositio===undefined?defaultGetSourcePosition:_ref$getSourcePositio,_ref$getTargetPositio=_ref.getTargetPosition,getTargetPosition=_ref$getTargetPositio===undefined?defaultGetTargetPosition:_ref$getTargetPositio,_ref$getSourceColor=_ref.getSourceColor,getSourceColor=_ref$getSourceColor===undefined?defaultGetColor:_ref$getSourceColor,_ref$getTargetColor=_ref.getTargetColor,getTargetColor=_ref$getTargetColor===undefined?defaultGetColor:_ref$getTargetColor,props=_objectWithoutProperties(_ref,["strokeWidth","getSourcePosition","getTargetPosition","getSourceColor","getTargetColor"]);_classCallCheck(this,ArcLayer);return _possibleConstructorReturn(this,(ArcLayer.__proto__||Object.getPrototypeOf(ArcLayer)).call(this,_extends({strokeWidth:strokeWidth,getSourcePosition:getSourcePosition,getTargetPosition:getTargetPosition,getSourceColor:getSourceColor,getTargetColor:getTargetColor},props)))}_createClass(ArcLayer,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;this.setState({model:this._createModel(gl)});var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instancePositions:{size:4,update:this.calculateInstancePositions},instanceSourceColors:{type:_luma.GL.UNSIGNED_BYTE,size:4,update:this.calculateInstanceSourceColors},instanceTargetColors:{type:_luma.GL.UNSIGNED_BYTE,size:4,update:this.calculateInstanceTargetColors}})}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var gl=this.context.gl;var lineWidth=this.screenToDevicePixels(this.props.strokeWidth);gl.lineWidth(lineWidth);this.state.model.render(uniforms);gl.lineWidth(1)}},{key:"getShaders",value:function getShaders(){return{vs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME arc-layer-vertex-shader\n\nconst float N = 49.0;\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec4 instancePositions;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvoid main(void) {\n  vec2 source = preproject(instancePositions.xy);\n  vec2 target = preproject(instancePositions.zw);\n\n  float segmentRatio = smoothstep(0.0, 1.0, positions.x / N);\n\n  float vertex_height = paraboloid(source, target, segmentRatio);\n  if (vertex_height < 0.0) vertex_height = 0.0;\n  vec3 p = vec3(\n    // xy: linear interpolation of source & target\n    mix(source, target, segmentRatio),\n    // z: paraboloid interpolate of source & target\n    sqrt(vertex_height)\n  );\n\n  gl_Position = project(vec4(p, 1.0));\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n\n  vColor = mix(\n    vec4(color.rgb, color.a * opacity),\n    vec4(instancePickingColors / 255., 1.),\n    renderPickingBuffer\n  );\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME arc-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n'}}},{key:"_createModel",value:function _createModel(gl){var positions=[];var NUM_SEGMENTS=50;for(var i=0;i<NUM_SEGMENTS;i++){positions=[].concat(_toConsumableArray(positions),[i,i,i])}return new _luma.Model(_extends({gl:gl},(0,_.assembleShaders)(gl,this.getShaders()),{geometry:new _luma.Geometry({drawMode:_luma.GL.LINE_STRIP,positions:new Float32Array(positions)}),isInstanced:true}))}},{key:"calculateInstancePositions",value:function calculateInstancePositions(attribute){var _props=this.props,data=_props.data,getSourcePosition=_props.getSourcePosition,getTargetPosition=_props.getTargetPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;var sourcePosition=getSourcePosition(object);var targetPosition=getTargetPosition(object);value[i+0]=sourcePosition[0];value[i+1]=sourcePosition[1];value[i+2]=targetPosition[0];value[i+3]=targetPosition[1];i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstanceSourceColors",value:function calculateInstanceSourceColors(attribute){var _props2=this.props,data=_props2.data,getSourceColor=_props2.getSourceColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var object=_step2.value;var color=getSourceColor(object)||DEFAULT_COLOR;value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?DEFAULT_COLOR[3]:color[3];i+=size}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceTargetColors",value:function calculateInstanceTargetColors(attribute){var _props3=this.props,data=_props3.data,getTargetColor=_props3.getTargetColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var object=_step3.value;var color=getTargetColor(object)||DEFAULT_COLOR;value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?DEFAULT_COLOR[3]:color[3];i+=size}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}}]);return ArcLayer}(_.Layer),_class.layerName="ArcLayer",_temp);exports.default=ArcLayer},{"../../..":341,"luma.gl":505,path:745}],343:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _arcLayer=require("./arc-layer");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_arcLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./arc-layer":342}],344:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _class,_temp;var _=require("../../..");var _luma=require("luma.gl");var _lodash=require("lodash.flattendeep");var _lodash2=_interopRequireDefault(_lodash);var _geojsonNormalize=require("geojson-normalize");var _geojsonNormalize2=_interopRequireDefault(_geojsonNormalize);var _earcut=require("earcut");var _earcut2=_interopRequireDefault(_earcut);var _path=require("path");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,0,255,255];var defaultGetColor=function defaultGetColor(feature){return feature.properties.color};var ChoroplethLayer=(_temp=_class=function(_Layer){_inherits(ChoroplethLayer,_Layer);function ChoroplethLayer(props){_classCallCheck(this,ChoroplethLayer);return _possibleConstructorReturn(this,(ChoroplethLayer.__proto__||Object.getPrototypeOf(ChoroplethLayer)).call(this,_extends({getColor:defaultGetColor,drawCountour:false,strokeWidth:1},props)))}_createClass(ChoroplethLayer,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;var attributeManager=this.state.attributeManager;attributeManager.addDynamic({indices:{size:1,update:this.calculateIndices,isIndexed:true},positions:{size:3,update:this.calculatePositions},colors:{type:_luma.GL.UNSIGNED_BYTE,size:4,update:this.calculateColors},pickingColors:{type:_luma.GL.UNSIGNED_BYTE,size:3,update:this.calculatePickingColors,noAlloc:true}});var IndexType=gl.getExtension("OES_element_index_uint")?Uint32Array:Uint16Array;this.setState({model:this.getModel(gl),numInstances:0,IndexType:IndexType})}},{key:"updateState",value:function updateState(_ref){var oldProps=_ref.oldProps,props=_ref.props,changeFlags=_ref.changeFlags;var attributeManager=this.state.attributeManager;if(changeFlags.dataChanged){this.state.choropleths=extractChoropleths(props.data);attributeManager.invalidateAll()}if(oldProps.opacity!==props.opacity){this.setUniforms({opacity:props.opacity})}}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var gl=this.context.gl;var lineWidth=this.screenToDevicePixels(this.props.strokeWidth);gl.lineWidth(lineWidth);this.state.model.render(uniforms);gl.lineWidth(1)}},{key:"pick",value:function pick(opts){_get(ChoroplethLayer.prototype.__proto__||Object.getPrototypeOf(ChoroplethLayer.prototype),"pick",this).call(this,opts);var info=opts.info;var index=this.decodePickingColor(info.color);var feature=index>=0?this.props.data.features[index]:null;info.feature=feature;info.object=feature}},{key:"getShaders",value:function getShaders(){return{vs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME choropleth-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 colors;\nattribute vec3 pickingColors;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\nuniform vec3 selectedPickingColor;\n\n// PICKING\nuniform float pickingEnabled;\nvarying vec4 vPickingColor;\nvoid picking_setPickColor(vec3 pickingColor) {\n  vPickingColor = vec4(pickingColor,  1.);\n}\nvec4 picking_setNormalAndPickColors(vec4 color, vec3 pickingColor) {\n  vec4 pickingColor4 = vec4(pickingColor.rgb, 1.);\n  vPickingColor = mix(color, pickingColor4, pickingEnabled);\n  return vPickingColor;\n}\n\n// PICKING\n// vec4 getColor(vec4 color, float opacity, vec3 pickingColor, float renderPickingBuffer) {\n//   vec4 color4 = vec4(color.xyz / 255., color.w / 255. * opacity);\n//   vec4 pickingColor4 = vec4(pickingColor / 255., 1.);\n//   return mix(color4, pickingColor4, renderPickingBuffer);\n// }\n\nvoid main(void) {\n\n  vec4 color = vec4(colors.rgb, colors.a * opacity) / 255.;\n\n  picking_setNormalAndPickColors(\n    color,\n    pickingColors / 255.\n  );\n\n  vec3 p = project_position(positions);\n  gl_Position = project_to_clipspace(vec4(p, 1.));\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME choropleth-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\n// PICKING\n// uniform bool pickingEnabled;\nvarying vec4 vPickingColor;\nvec4 picking_getColor() {\n  return vPickingColor;\n}\n// PICKING\n\nvoid main(void) {\n  gl_FragColor = picking_getColor();\n}\n'}}},{key:"getModel",value:function getModel(gl){return new _luma.Model(_extends({gl:gl,id:this.props.id},(0,_.assembleShaders)(gl,this.getShaders()),{geometry:new _luma.Geometry({drawMode:this.props.drawContour?_luma.GL.LINES:_luma.GL.TRIANGLES}),vertexCount:0,isIndexed:true}))}},{key:"calculateIndices",value:function calculateIndices(attribute){var _this2=this;var offsets=this.state.choropleths.reduce(function(acc,choropleth){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+choropleth.reduce(function(count,polygon){return count+polygon.length},0)])},[0]);var IndexType=this.state.IndexType;if(IndexType===Uint16Array&&offsets[offsets.length-1]>65535){throw new Error("Vertex count exceeds browser's limit")}var indices=this.state.choropleths.map(function(choropleth,choroplethIndex){return _this2.props.drawContour?calculateContourIndices(choropleth).map(function(index){return index+offsets[choroplethIndex]}):calculateSurfaceIndices(choropleth).map(function(index){return index+offsets[choroplethIndex]})});attribute.value=new IndexType((0,_lodash2.default)(indices));attribute.target=_luma.GL.ELEMENT_ARRAY_BUFFER;this.state.model.setVertexCount(attribute.value.length/attribute.size)}},{key:"calculatePositions",value:function calculatePositions(attribute){var vertices=(0,_lodash2.default)(this.state.choropleths);attribute.value=new Float32Array(vertices)}},{key:"calculateColors",value:function calculateColors(attribute){var _props=this.props,features=_props.data.features,getColor=_props.getColor;var colors=this.state.choropleths.map(function(choropleth,choroplethIndex){var feature=features[choropleth.featureIndex];var color=getColor(feature)||DEFAULT_COLOR;if(isNaN(color[3])){color[3]=DEFAULT_COLOR[3]}return choropleth.map(function(polygon){return polygon.map(function(vertex){return color})})});attribute.value=new Uint8Array((0,_lodash2.default)(colors))}},{key:"calculatePickingColors",value:function calculatePickingColors(attribute){var _this3=this;var colors=this.state.choropleths.map(function(choropleth,choroplethIndex){var featureIndex=choropleth.featureIndex;var color=_this3.props.drawContour?[0,0,0]:[(featureIndex+1)%256,Math.floor((featureIndex+1)/256)%256,Math.floor((featureIndex+1)/256/256)%256];return choropleth.map(function(polygon){return polygon.map(function(vertex){return color})})});attribute.value=new Uint8Array((0,_lodash2.default)(colors))}}]);return ChoroplethLayer}(_.Layer),_class.layerName="ChoroplethLayer",_temp);exports.default=ChoroplethLayer;function extractChoropleths(data){var normalizedGeojson=(0,_geojsonNormalize2.default)(data);var result=[];normalizedGeojson.features.map(function(feature,featureIndex){var choropleths=featureToChoropleths(feature);choropleths.forEach(function(choropleth){choropleth.featureIndex=featureIndex});result.push.apply(result,_toConsumableArray(choropleths))});return result}function featureToChoropleths(feature){var _feature$geometry=feature.geometry,coordinates=_feature$geometry.coordinates,type=_feature$geometry.type;var choropleths=void 0;switch(type){case"MultiPolygon":choropleths=coordinates;break;case"Polygon":choropleths=[coordinates];break;case"LineString":choropleths=[[coordinates]];break;case"MultiLineString":choropleths=coordinates.map(function(coords){return[coords]});break;default:choropleths=[]}return choropleths.map(function(choropleth){return choropleth.map(function(polygon){return polygon.map(function(coordinate){return[coordinate[0],coordinate[1],coordinate[2]||0]})})})}function calculateContourIndices(choropleth){var offset=0;return choropleth.reduce(function(acc,polygon){var numVertices=polygon.length;var indices=[].concat(_toConsumableArray(acc),[offset]);for(var i=1;i<numVertices-1;i++){indices.push(i+offset,i+offset)}indices.push(offset+numVertices-1);offset+=numVertices;return indices},[])}function calculateSurfaceIndices(choropleth){var holes=null;if(choropleth.length>1){holes=choropleth.reduce(function(acc,polygon){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+polygon.length])},[0]).slice(1,choropleth.length)}return(0,_earcut2.default)((0,_lodash2.default)(choropleth),holes,3)}},{"../../..":341,earcut:388,"geojson-normalize":417,"lodash.flattendeep":466,"luma.gl":505,path:745}],345:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _choroplethLayer=require("./choropleth-layer");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_choroplethLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./choropleth-layer":344}],346:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _arcLayer=require("./arc-layer");Object.defineProperty(exports,"ArcLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_arcLayer).default}});var _choroplethLayer=require("./choropleth-layer");Object.defineProperty(exports,"ChoroplethLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_choroplethLayer).default}});var _lineLayer=require("./line-layer");Object.defineProperty(exports,"LineLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_lineLayer).default}});var _scatterplotLayer=require("./scatterplot-layer");Object.defineProperty(exports,"ScatterplotLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_scatterplotLayer).default}});var _screenGridLayer=require("./screen-grid-layer");Object.defineProperty(exports,"ScreenGridLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_screenGridLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./arc-layer":343,"./choropleth-layer":345,"./line-layer":347,"./scatterplot-layer":349,"./screen-grid-layer":351}],347:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _lineLayer=require("./line-layer");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){
return _interopRequireDefault(_lineLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./line-layer":348}],348:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _class,_temp;var _=require("../../..");var _luma=require("luma.gl");var _path=require("path");function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,255,0,255];var defaultGetSourcePosition=function defaultGetSourcePosition(x){return x.sourcePosition};var defaultGetTargetPosition=function defaultGetTargetPosition(x){return x.targetPosition};var defaultGetColor=function defaultGetColor(x){return x.color||DEFAULT_COLOR};var LineLayer=(_temp=_class=function(_Layer){_inherits(LineLayer,_Layer);function LineLayer(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$getSourcePositio=_ref.getSourcePosition,getSourcePosition=_ref$getSourcePositio===undefined?defaultGetSourcePosition:_ref$getSourcePositio,_ref$getTargetPositio=_ref.getTargetPosition,getTargetPosition=_ref$getTargetPositio===undefined?defaultGetTargetPosition:_ref$getTargetPositio,_ref$getColor=_ref.getColor,getColor=_ref$getColor===undefined?defaultGetColor:_ref$getColor,_ref$strokeWidth=_ref.strokeWidth,strokeWidth=_ref$strokeWidth===undefined?1:_ref$strokeWidth,opts=_objectWithoutProperties(_ref,["getSourcePosition","getTargetPosition","getColor","strokeWidth"]);_classCallCheck(this,LineLayer);return _possibleConstructorReturn(this,(LineLayer.__proto__||Object.getPrototypeOf(LineLayer)).call(this,_extends({getSourcePosition:getSourcePosition,getTargetPosition:getTargetPosition,getColor:getColor,strokeWidth:strokeWidth},opts)))}_createClass(LineLayer,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;this.setState({model:this.createModel(gl)});var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instanceSourcePositions:{size:3,update:this.calculateInstanceSourcePositions},instanceTargetPositions:{size:3,update:this.calculateInstanceTargetPositions},instanceColors:{type:_luma.GL.UNSIGNED_BYTE,size:4,update:this.calculateInstanceColors}})}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var gl=this.context.gl;var lineWidth=this.screenToDevicePixels(this.props.strokeWidth);gl.lineWidth(lineWidth);this.state.model.render(uniforms);gl.lineWidth(1)}},{key:"getShaders",value:function getShaders(){return{vs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME line-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  // Position\n  vec3 source = project_position(instanceSourcePositions);\n  vec3 target = project_position(instanceTargetPositions);\n\n  // linear interpolation of source & target to pick right coord\n  float segmentIndex = positions.x;\n  vec3 p = mix(source, target, segmentIndex);\n\n  gl_Position = project_to_clipspace(vec4(p, 1.));\n\n  // Color\n  vec4 color = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  vec4 pickingColor = vec4(instancePickingColors / 255., 1.);\n  vColor = mix(\n    color,\n    pickingColor,\n    renderPickingBuffer\n  );\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n#define SHADER_NAME line-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n'}}},{key:"createModel",value:function createModel(gl){var positions=[0,0,0,1,1,1];return new _luma.Model(_extends({gl:gl,id:this.props.id},(0,_.assembleShaders)(gl,this.getShaders()),{geometry:new _luma.Geometry({drawMode:_luma.GL.LINE_STRIP,positions:new Float32Array(positions)}),isInstanced:true}))}},{key:"calculateInstanceSourcePositions",value:function calculateInstanceSourcePositions(attribute){var _props=this.props,data=_props.data,getSourcePosition=_props.getSourcePosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;var sourcePosition=getSourcePosition(object);value[i+0]=sourcePosition[0];value[i+1]=sourcePosition[1];value[i+2]=sourcePosition[2]||0;i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstanceTargetPositions",value:function calculateInstanceTargetPositions(attribute){var _props2=this.props,data=_props2.data,getTargetPosition=_props2.getTargetPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var object=_step2.value;var targetPosition=getTargetPosition(object);value[i+0]=targetPosition[0];value[i+1]=targetPosition[1];value[i+2]=targetPosition[2]||0;i+=size}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceColors",value:function calculateInstanceColors(attribute){var _props3=this.props,data=_props3.data,getColor=_props3.getColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var object=_step3.value;var color=getColor(object);value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?DEFAULT_COLOR[3]:color[3];i+=size}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}}]);return LineLayer}(_.Layer),_class.layerName="LineLayer",_temp);exports.default=LineLayer},{"../../..":341,"luma.gl":505,path:745}],349:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _scatterplotLayer=require("./scatterplot-layer");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_scatterplotLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./scatterplot-layer":350}],350:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _class,_temp;var _=require("../../..");var _luma=require("luma.gl");var _path=require("path");function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[255,0,255,255];var defaultGetPosition=function defaultGetPosition(x){return x.position};var defaultGetRadius=function defaultGetRadius(x){return x.radius};var defaultGetColor=function defaultGetColor(x){return x.color||DEFAULT_COLOR};var ScatterplotLayer=(_temp=_class=function(_Layer){_inherits(ScatterplotLayer,_Layer);function ScatterplotLayer(_ref){var _ref$getPosition=_ref.getPosition,getPosition=_ref$getPosition===undefined?defaultGetPosition:_ref$getPosition,_ref$getRadius=_ref.getRadius,getRadius=_ref$getRadius===undefined?defaultGetRadius:_ref$getRadius,_ref$getColor=_ref.getColor,getColor=_ref$getColor===undefined?defaultGetColor:_ref$getColor,_ref$radius=_ref.radius,radius=_ref$radius===undefined?30:_ref$radius,_ref$radiusMinPixels=_ref.radiusMinPixels,radiusMinPixels=_ref$radiusMinPixels===undefined?0:_ref$radiusMinPixels,_ref$radiusMaxPixels=_ref.radiusMaxPixels,radiusMaxPixels=_ref$radiusMaxPixels===undefined?Number.MAX_SAFE_INTEGER:_ref$radiusMaxPixels,_ref$drawOutline=_ref.drawOutline,drawOutline=_ref$drawOutline===undefined?false:_ref$drawOutline,_ref$strokeWidth=_ref.strokeWidth,strokeWidth=_ref$strokeWidth===undefined?1:_ref$strokeWidth,props=_objectWithoutProperties(_ref,["getPosition","getRadius","getColor","radius","radiusMinPixels","radiusMaxPixels","drawOutline","strokeWidth"]);_classCallCheck(this,ScatterplotLayer);return _possibleConstructorReturn(this,(ScatterplotLayer.__proto__||Object.getPrototypeOf(ScatterplotLayer)).call(this,_extends({getPosition:getPosition,getRadius:getRadius,getColor:getColor,drawOutline:drawOutline,strokeWidth:strokeWidth,radius:radius,radiusMinPixels:radiusMinPixels,radiusMaxPixels:radiusMaxPixels},props)))}_createClass(ScatterplotLayer,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;var model=this._getModel(gl);this.setState({model:model});var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceRadius:{size:1,update:this.calculateInstanceRadius},instanceColors:{type:_luma.GL.UNSIGNED_BYTE,size:4,update:this.calculateInstanceColors}})}},{key:"updateState",value:function updateState(evt){_get(ScatterplotLayer.prototype.__proto__||Object.getPrototypeOf(ScatterplotLayer.prototype),"updateState",this).call(this,evt);var props=evt.props,oldProps=evt.oldProps;if(props.drawOutline!==oldProps.drawOutline){this.state.model.geometry.drawMode=props.drawOutline?_luma.GL.LINE_LOOP:_luma.GL.TRIANGLE_FAN}}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var gl=this.context.gl;var lineWidth=this.screenToDevicePixels(this.props.strokeWidth);gl.lineWidth(lineWidth);this.state.model.render(_extends({},uniforms,{radius:this.props.radius,radiusMinPixels:this.props.radiusMinPixels,radiusMaxPixels:this.props.radiusMaxPixels}));gl.lineWidth(1)}},{key:"getShaders",value:function getShaders(id){return{vs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute float instanceRadius;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radius;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  vec3 center = project_position(instancePositions);\n  float radiusPixels = clamp(\n    project_scale(radius * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n  vec3 vertex = positions * radiusPixels;\n  gl_Position = project_to_clipspace(vec4(center + vertex, 1.0));\n\n  vec4 color = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  vec4 pickingColor = vec4(instancePickingColors / 255., 1.);\n  vColor = mix(\n    color,\n    pickingColor,\n    renderPickingBuffer\n  );\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME scatterplot-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n'}}},{key:"_getModel",value:function _getModel(gl){var NUM_SEGMENTS=16;var positions=[];for(var i=0;i<NUM_SEGMENTS;i++){positions.push(Math.cos(Math.PI*2*i/NUM_SEGMENTS),Math.sin(Math.PI*2*i/NUM_SEGMENTS),0)}var shaders=(0,_.assembleShaders)(gl,this.getShaders());var model=new _luma.Model(_extends({gl:gl,id:"scatterplot"},shaders,{geometry:new _luma.Geometry({drawMode:_luma.GL.TRIANGLE_FAN,positions:new Float32Array(positions)}),isInstanced:true}));return model}},{key:"calculateInstancePositions",value:function calculateInstancePositions(attribute){var _props=this.props,data=_props.data,getPosition=_props.getPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var point=_step.value;var position=getPosition(point);value[i+0]=position[0]||0;value[i+1]=position[1]||0;value[i+2]=position[2]||0;i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstanceRadius",value:function calculateInstanceRadius(attribute){var _props2=this.props,data=_props2.data,getRadius=_props2.getRadius;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var point=_step2.value;var radius=getRadius(point);value[i+0]=isNaN(radius)?1:radius;i+=size}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceColors",value:function calculateInstanceColors(attribute){var _props3=this.props,data=_props3.data,getColor=_props3.getColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var point=_step3.value;var color=getColor(point);value[i+0]=color[0]||0;value[i+1]=color[1]||0;value[i+2]=color[2]||0;value[i+3]=isNaN(color[3])?DEFAULT_COLOR[3]:color[3];i+=size}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}}]);return ScatterplotLayer}(_.Layer),_class.layerName="ScatterplotLayer",_temp);exports.default=ScatterplotLayer},{"../../..":341,"luma.gl":505,path:745}],351:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _screenGridLayer=require("./screen-grid-layer");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_screenGridLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./screen-grid-layer":352}],352:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _class,_temp;var _=require("../../..");var _luma=require("luma.gl");var _path=require("path");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ScreenGridLayer=(_temp=_class=function(_Layer){_inherits(ScreenGridLayer,_Layer);function ScreenGridLayer(opts){_classCallCheck(this,ScreenGridLayer);return _possibleConstructorReturn(this,(ScreenGridLayer.__proto__||Object.getPrototypeOf(ScreenGridLayer)).call(this,_extends({unitWidth:100,unitHeight:100,minColor:[0,0,0,255],maxColor:[0,255,0,255],getPosition:function getPosition(d){return d.position},getWeight:function getWeight(d){return 1}},opts)))}_createClass(ScreenGridLayer,[{key:"initializeState",value:function initializeState(){var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCount:{size:1,update:this.calculateInstanceCount}});var gl=this.context.gl;this.setState({model:this.getModel(gl)})}},{key:"updateState",value:function updateState(_ref){var oldProps=_ref.oldProps,props=_ref.props,changeFlags=_ref.changeFlags;var cellSizeChanged=props.unitWidth!==oldProps.unitWidth||props.unitHeight!==oldProps.unitHeight;if(cellSizeChanged||changeFlags.viewportChanged){this.updateCell()}}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var _props=this.props,minColor=_props.minColor,maxColor=_props.maxColor;var _state=this.state,model=_state.model,cellScale=_state.cellScale,maxCount=_state.maxCount;var gl=this.context.gl;gl.depthMask(true);model.render(_extends({},uniforms,{minColor:minColor,maxColor:maxColor,cellScale:cellScale,maxCount:maxCount}))}},{key:"getShaders",value:function getShaders(){return{vs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME grid-layer-vs\n\nattribute vec3 vertices;\nattribute vec3 instancePositions;\nattribute float instanceCount;\nattribute vec3 instancePickingColors;\n\nuniform float maxCount;\nuniform float opacity;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform float renderPickingBuffer;\nuniform vec3 cellScale;\nuniform vec3 selectedPickingColor;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  vec4 color = mix(minColor, maxColor, instanceCount / maxCount) / 255.;\n\n  vColor = mix(\n    vec4(color.rgb, color.a * opacity),\n    vec4(instancePickingColors / 255., 1.),\n    renderPickingBuffer\n  );\n\n  gl_Position = vec4(instancePositions + vertices * cellScale, 1.);\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* fragment shader for the grid-layer */\n#define SHADER_NAME grid-layer-fs\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n'}}},{key:"getModel",value:function getModel(gl){return new _luma.Model(_extends({gl:gl,id:this.props.id},(0,_.assembleShaders)(gl,this.getShaders()),{geometry:new _luma.Geometry({drawMode:_luma.GL.TRIANGLE_FAN,vertices:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])}),isInstanced:true}))}},{key:"updateCell",value:function updateCell(){var _context$viewport=this.context.viewport,width=_context$viewport.width,height=_context$viewport.height;var _props2=this.props,unitWidth=_props2.unitWidth,unitHeight=_props2.unitHeight;var MARGIN=2;var cellScale=new Float32Array([(unitWidth-MARGIN)/width*2,-(unitHeight-MARGIN)/height*2,1]);var numCol=Math.ceil(width/unitWidth);var numRow=Math.ceil(height/unitHeight);this.setState({cellScale:cellScale,numCol:numCol,numRow:numRow,numInstances:numCol*numRow});var attributeManager=this.state.attributeManager;attributeManager.invalidateAll()}},{key:"calculateInstancePositions",value:function calculateInstancePositions(attribute,_ref3){var numInstances=_ref3.numInstances;var _context$viewport2=this.context.viewport,width=_context$viewport2.width,height=_context$viewport2.height;var _props3=this.props,unitWidth=_props3.unitWidth,unitHeight=_props3.unitHeight;var numCol=this.state.numCol;var value=attribute.value,size=attribute.size;for(var i=0;i<numInstances;i++){var x=i%numCol;var y=Math.floor(i/numCol);value[i*size+0]=x*unitWidth/width*2-1;value[i*size+1]=1-y*unitHeight/height*2;value[i*size+2]=0}}},{key:"calculateInstanceCount",value:function calculateInstanceCount(attribute){var _props4=this.props,data=_props4.data,unitWidth=_props4.unitWidth,unitHeight=_props4.unitHeight,getPosition=_props4.getPosition,getWeight=_props4.getWeight;var _state2=this.state,numCol=_state2.numCol,numRow=_state2.numRow;var value=attribute.value;var maxCount=0;value.fill(0);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var point=_step.value;var pixel=this.project(getPosition(point));var colId=Math.floor(pixel[0]/unitWidth);var rowId=Math.floor(pixel[1]/unitHeight);if(colId>=0&&colId<numCol&&rowId>=0&&rowId<numRow){var i=colId+rowId*numCol;value[i]+=getWeight(point);if(value[i]>maxCount){maxCount=value[i]}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){
throw _iteratorError}}}this.setState({maxCount:maxCount})}}]);return ScreenGridLayer}(_.Layer),_class.layerName="ScreenGridLayer",_temp);exports.default=ScreenGridLayer},{"../../..":341,"luma.gl":505,path:745}],353:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _class,_temp;var _=require("../../..");var _fp=require("../../../lib/utils/fp64");var _luma=require("luma.gl");var _path=require("path");function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,0,255,255];var defaultGetSourcePosition=function defaultGetSourcePosition(x){return x.sourcePosition};var defaultGetTargetPosition=function defaultGetTargetPosition(x){return x.targetPosition};var defaultGetColor=function defaultGetColor(x){return x.color};var ArcLayer64=(_temp=_class=function(_Layer){_inherits(ArcLayer64,_Layer);function ArcLayer64(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$getSourcePositio=_ref.getSourcePosition,getSourcePosition=_ref$getSourcePositio===undefined?defaultGetSourcePosition:_ref$getSourcePositio,_ref$getTargetPositio=_ref.getTargetPosition,getTargetPosition=_ref$getTargetPositio===undefined?defaultGetTargetPosition:_ref$getTargetPositio,_ref$getSourceColor=_ref.getSourceColor,getSourceColor=_ref$getSourceColor===undefined?defaultGetColor:_ref$getSourceColor,_ref$getTargetColor=_ref.getTargetColor,getTargetColor=_ref$getTargetColor===undefined?defaultGetColor:_ref$getTargetColor,_ref$strokeWidth=_ref.strokeWidth,strokeWidth=_ref$strokeWidth===undefined?1:_ref$strokeWidth,props=_objectWithoutProperties(_ref,["getSourcePosition","getTargetPosition","getSourceColor","getTargetColor","strokeWidth"]);_classCallCheck(this,ArcLayer64);return _possibleConstructorReturn(this,(ArcLayer64.__proto__||Object.getPrototypeOf(ArcLayer64)).call(this,_extends({getSourcePosition:getSourcePosition,getTargetPosition:getTargetPosition,getSourceColor:getSourceColor,getTargetColor:getTargetColor,strokeWidth:strokeWidth},props)))}_createClass(ArcLayer64,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instanceSourcePositionsFP64:{size:4,update:this.calculateInstanceSourcePositions},instanceTargetPositionsFP64:{size:4,update:this.calculateInstanceTargetPositions},instanceSourceColors:{size:4,type:_luma.GL.UNSIGNED_BYTE,update:this.calculateInstanceSourceColors},instanceTargetColors:{size:4,type:_luma.GL.UNSIGNED_BYTE,update:this.calculateInstanceTargetColors}});this.setState({model:this.createModel(gl)})}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var gl=this.context.gl;var lineWidth=this.screenToDevicePixels(this.props.strokeWidth);gl.lineWidth(lineWidth);this.state.model.render(uniforms);gl.lineWidth(1)}},{key:"getShaders",value:function getShaders(){return{vs:'// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME arc-layer-64-vertex-shader\n\nconst float N = 49.0;\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceSourcePositionsFP64;\nattribute vec4 instanceTargetPositionsFP64;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\nvec2 paraboloid_fp64(vec2 source[2], vec2 target[2], float ratio) {\n\n  vec2 x[2];\n  vec2_mix_fp64(source, target, ratio, x);\n  vec2 center[2];\n  vec2_mix_fp64(source, target, 0.5, center);\n\n  vec2 dSourceCenter = vec2_distance_fp64(source, center);\n  vec2 dXCenter = vec2_distance_fp64(x, center);\n  return mul_fp64(sum_fp64(dSourceCenter, dXCenter), sub_fp64(dSourceCenter, dXCenter));\n}\n\nvoid main(void) {\n  vec2 projectedSourceCoord[2];\n  project_position_fp64(instanceSourcePositionsFP64, projectedSourceCoord);\n  vec2 projectedTargetCoord[2];\n  project_position_fp64(instanceTargetPositionsFP64, projectedTargetCoord);\n\n  float segmentRatio = smoothstep(0.0, 1.0, positions.x / N);\n\n  vec2 mixed_temp[2];\n\n  vec2_mix_fp64(projectedSourceCoord, projectedTargetCoord, segmentRatio, mixed_temp);\n\n  vec2 vertex_pos_modelspace[4];\n\n  vertex_pos_modelspace[0] = mixed_temp[0];\n  vertex_pos_modelspace[1] = mixed_temp[1];\n\n  vec2 vertex_height = paraboloid_fp64(projectedSourceCoord, projectedTargetCoord, segmentRatio);\n  if (vertex_height.x < 0.0 || (vertex_height.x == 0.0 && vertex_height.y <= 0.0)) vertex_height = vec2(0.0, 0.0);\n\n  vertex_pos_modelspace[2] = sqrt_fp64(vertex_height);\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n\n  vColor = mix(\n    vec4(color.rgb, color.a * opacity),\n    vec4(instancePickingColors / 255., 1.),\n    renderPickingBuffer\n  );\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME arc-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n',fp64:true,project64:true}}},{key:"createModel",value:function createModel(gl){var positions=[];var NUM_SEGMENTS=50;for(var i=0;i<NUM_SEGMENTS;i++){positions=[].concat(_toConsumableArray(positions),[i,i,i])}return new _luma.Model(_extends({gl:gl,id:this.props.id},(0,_.assembleShaders)(gl,this.getShaders()),{geometry:new _luma.Geometry({drawMode:_luma.GL.LINE_STRIP,positions:new Float32Array(positions)}),isInstanced:true}))}},{key:"calculateInstanceSourcePositions",value:function calculateInstanceSourcePositions(attribute){var _props=this.props,data=_props.data,getSourcePosition=_props.getSourcePosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;var sourcePosition=getSourcePosition(object);var _fp64ify=(0,_fp.fp64ify)(sourcePosition[0]);var _fp64ify2=_slicedToArray(_fp64ify,2);value[i+0]=_fp64ify2[0];value[i+1]=_fp64ify2[1];var _fp64ify3=(0,_fp.fp64ify)(sourcePosition[1]);var _fp64ify4=_slicedToArray(_fp64ify3,2);value[i+2]=_fp64ify4[0];value[i+3]=_fp64ify4[1];i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstanceTargetPositions",value:function calculateInstanceTargetPositions(attribute){var _props2=this.props,data=_props2.data,getTargetPosition=_props2.getTargetPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var object=_step2.value;var targetPosition=getTargetPosition(object);var _fp64ify5=(0,_fp.fp64ify)(targetPosition[0]);var _fp64ify6=_slicedToArray(_fp64ify5,2);value[i+0]=_fp64ify6[0];value[i+1]=_fp64ify6[1];var _fp64ify7=(0,_fp.fp64ify)(targetPosition[1]);var _fp64ify8=_slicedToArray(_fp64ify7,2);value[i+2]=_fp64ify8[0];value[i+3]=_fp64ify8[1];i+=size}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceSourceColors",value:function calculateInstanceSourceColors(attribute){var _props3=this.props,data=_props3.data,getSourceColor=_props3.getSourceColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var object=_step3.value;var color=getSourceColor(object)||DEFAULT_COLOR;value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?DEFAULT_COLOR[3]:color[3];i+=size}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}},{key:"calculateInstanceTargetColors",value:function calculateInstanceTargetColors(attribute){var _props4=this.props,data=_props4.data,getTargetColor=_props4.getTargetColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=data[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var object=_step4.value;var color=getTargetColor(object)||DEFAULT_COLOR;value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?DEFAULT_COLOR[3]:color[3];i+=size}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}}]);return ArcLayer64}(_.Layer),_class.layerName="ArcLayer64",_temp);exports.default=ArcLayer64},{"../../..":341,"../../../lib/utils/fp64":371,"luma.gl":505,path:745}],354:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _arcLayer=require("./arc-layer-64");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_arcLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./arc-layer-64":353}],355:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _class,_temp;var _=require("../../..");var _fp=require("../../../lib/utils/fp64");var _luma=require("luma.gl");var _lodash=require("lodash.flattendeep");var _lodash2=_interopRequireDefault(_lodash);var _geojsonNormalize=require("geojson-normalize");var _geojsonNormalize2=_interopRequireDefault(_geojsonNormalize);var _earcut=require("earcut");var _earcut2=_interopRequireDefault(_earcut);var _path=require("path");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,0,255,255];var defaultGetColor=function defaultGetColor(feature){return feature.properties.color};var ChoroplethLayer64=(_temp=_class=function(_Layer){_inherits(ChoroplethLayer64,_Layer);function ChoroplethLayer64(props){_classCallCheck(this,ChoroplethLayer64);return _possibleConstructorReturn(this,(ChoroplethLayer64.__proto__||Object.getPrototypeOf(ChoroplethLayer64)).call(this,_extends({getColor:defaultGetColor,drawCountour:false,strokeWidth:1},props)))}_createClass(ChoroplethLayer64,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;var attributeManager=this.state.attributeManager;attributeManager.addDynamic({indices:{size:1,update:this.calculateIndices,isIndexed:true},positionsFP64:{size:4,update:this.calculatePositionsFP64},heightsFP64:{size:2,update:this.calculateHeightsFP64},colors:{size:4,type:_luma.GL.UNSIGNED_BYTE,update:this.calculateColors},pickingColors:{size:3,update:this.calculatePickingColors,noAlloc:true}});var IndexType=gl.getExtension("OES_element_index_uint")?Uint32Array:Uint16Array;this.setState({model:this.getModel(gl),numInstances:0,IndexType:IndexType})}},{key:"updateState",value:function updateState(_ref){var oldProps=_ref.oldProps,props=_ref.props,changeFlags=_ref.changeFlags;var attributeManager=this.state.attributeManager;if(changeFlags.dataChanged){this.state.choropleths=extractChoropleths(props.data);attributeManager.invalidateAll()}if(oldProps.opacity!==props.opacity){this.setUniforms({opacity:props.opacity})}}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var gl=this.context.gl;var lineWidth=this.screenToDevicePixels(this.props.strokeWidth);gl.lineWidth(lineWidth);this.state.model.render(uniforms);gl.lineWidth(1)}},{key:"pick",value:function pick(opts){_get(ChoroplethLayer64.prototype.__proto__||Object.getPrototypeOf(ChoroplethLayer64.prototype),"pick",this).call(this,opts);var info=opts.info;var index=this.decodePickingColor(info.color);var feature=index>=0?this.props.data.features[index]:null;info.feature=feature;info.object=feature}},{key:"getShaders",value:function getShaders(){return{vs:'// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME choropleth-layer-64-vertex-shader\n\nattribute vec4 positionsFP64;\nattribute vec2 heightsFP64;\n\nattribute vec3 positions;\nattribute vec4 colors;\nattribute vec3 pickingColors;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\nuniform vec3 selectedPickingColor;\n\nvarying vec4 vColor;\n\nvec4 getColor(vec4 color, float opacity, vec3 pickingColor, float renderPickingBuffer) {\n  vec4 color4 = vec4(color.xyz / 255., color.w / 255. * opacity);\n  vec4 pickingColor4 = vec4(pickingColor / 255., 1.);\n  return mix(color4, pickingColor4, renderPickingBuffer);\n}\n\nvoid main(void) {\n  // For some reason, need to add one to elevation to show up in untilted mode\n  vec2 projectedCoord[2];\n  project_position_fp64(positionsFP64, projectedCoord);\n\n  vec2 vertex_pos_modelspace[4];\n\n  vertex_pos_modelspace[0] = projectedCoord[0];\n  vertex_pos_modelspace[1] = projectedCoord[1];\n  vertex_pos_modelspace[2] = heightsFP64;\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  vec4 color = vec4(colors.rgb, colors.a * opacity) / 255.;\n  vec4 pickingColor = vec4(pickingColors / 255., 1.);\n\n  vColor = mix(\n    color,\n    pickingColor,\n    renderPickingBuffer\n  );\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME choropleth-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n',fp64:true,project64:true}}},{key:"getModel",value:function getModel(gl){return new _luma.Model(_extends({gl:gl,id:this.props.id},(0,_.assembleShaders)(gl,this.getShaders()),{geometry:new _luma.Geometry({drawMode:this.props.drawContour?_luma.GL.LINES:_luma.GL.TRIANGLES}),vertexCount:0,isIndexed:true}))}},{key:"calculateIndices",value:function calculateIndices(attribute){var _this2=this;var offsets=this.state.choropleths.reduce(function(acc,choropleth){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+choropleth.reduce(function(count,polygon){return count+polygon.length},0)])},[0]);var IndexType=this.state.IndexType;if(IndexType===Uint16Array&&offsets[offsets.length-1]>65535){throw new Error("Vertex count exceeds browser's limit")}var indices=this.state.choropleths.map(function(choropleth,choroplethIndex){return _this2.props.drawContour?calculateContourIndices(choropleth).map(function(index){return index+offsets[choroplethIndex]}):calculateSurfaceIndices(choropleth).map(function(index){return index+offsets[choroplethIndex]})});attribute.value=new IndexType((0,_lodash2.default)(indices));attribute.target=_luma.GL.ELEMENT_ARRAY_BUFFER;this.state.model.setVertexCount(attribute.value.length/attribute.size)}},{key:"calculatePositionsFP64",value:function calculatePositionsFP64(attribute){var vertices=(0,_lodash2.default)(this.state.choropleths);attribute.value=new Float32Array(vertices.length/3*4);for(var index=0;index<vertices.length/3;index++){var _fp64ify=(0,_fp.fp64ify)(vertices[index*3]);var _fp64ify2=_slicedToArray(_fp64ify,2);attribute.value[index*4]=_fp64ify2[0];attribute.value[index*4+1]=_fp64ify2[1];var _fp64ify3=(0,_fp.fp64ify)(vertices[index*3+1]);var _fp64ify4=_slicedToArray(_fp64ify3,2);attribute.value[index*4+2]=_fp64ify4[0];attribute.value[index*4+3]=_fp64ify4[1]}}},{key:"calculateHeightsFP64",value:function calculateHeightsFP64(attribute){var vertices=(0,_lodash2.default)(this.state.choropleths);attribute.value=new Float32Array(vertices.length/3*2);for(var index=0;index<vertices.length/3;index++){var _fp64ify5=(0,_fp.fp64ify)(vertices[index*3+2]);var _fp64ify6=_slicedToArray(_fp64ify5,2);attribute.value[index*2]=_fp64ify6[0];attribute.value[index*2+1]=_fp64ify6[1]}}},{key:"calculateColors",value:function calculateColors(attribute){var _props=this.props,features=_props.data.features,getColor=_props.getColor;var colors=this.state.choropleths.map(function(choropleth,choroplethIndex){var feature=features[choropleth.featureIndex];var color=getColor(feature)||DEFAULT_COLOR;if(isNaN(color[3])){color[3]=DEFAULT_COLOR[3]}return choropleth.map(function(polygon){return polygon.map(function(vertex){return color})})});attribute.value=new Uint8Array((0,_lodash2.default)(colors))}},{key:"calculatePickingColors",value:function calculatePickingColors(attribute){var _this3=this;var colors=this.state.choropleths.map(function(choropleth,choroplethIndex){var featureIndex=choropleth.featureIndex;var color=_this3.props.drawContour?_this3.nullPickingColor():_this3.encodePickingColor(featureIndex);return choropleth.map(function(polygon){return polygon.map(function(vertex){return color})})});attribute.value=new Uint8Array((0,_lodash2.default)(colors))}}]);return ChoroplethLayer64}(_.Layer),_class.layerName="ChoroplethLayer64",_temp);exports.default=ChoroplethLayer64;function extractChoropleths(data){var normalizedGeojson=(0,_geojsonNormalize2.default)(data);var result=[];normalizedGeojson.features.map(function(feature,featureIndex){var choropleths=featureToChoropleths(feature);choropleths.forEach(function(choropleth){choropleth.featureIndex=featureIndex});result.push.apply(result,_toConsumableArray(choropleths))});return result}function featureToChoropleths(feature){var _feature$geometry=feature.geometry,coordinates=_feature$geometry.coordinates,type=_feature$geometry.type;var choropleths=void 0;switch(type){case"MultiPolygon":choropleths=coordinates;break;case"Polygon":choropleths=[coordinates];break;case"LineString":choropleths=[[coordinates]];break;case"MultiLineString":choropleths=coordinates.map(function(coords){return[coords]});break;default:choropleths=[]}return choropleths.map(function(choropleth){return choropleth.map(function(polygon){return polygon.map(function(coordinate){return[coordinate[0],coordinate[1],coordinate[2]||0]})})})}function calculateContourIndices(choropleth){var offset=0;return choropleth.reduce(function(acc,polygon){var numVertices=polygon.length;var indices=[].concat(_toConsumableArray(acc),[offset]);for(var i=1;i<numVertices-1;i++){indices.push(i+offset,i+offset)}indices.push(offset+numVertices-1);offset+=numVertices;return indices},[])}function calculateSurfaceIndices(choropleth){var holes=null;if(choropleth.length>1){holes=choropleth.reduce(function(acc,polygon){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+polygon.length])},[0]).slice(1,choropleth.length)}return(0,_earcut2.default)((0,_lodash2.default)(choropleth),holes,3)}},{"../../..":341,"../../../lib/utils/fp64":371,earcut:388,"geojson-normalize":417,"lodash.flattendeep":466,"luma.gl":505,path:745}],356:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _choroplethLayer=require("./choropleth-layer-64");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_choroplethLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./choropleth-layer-64":355}],357:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _class,_temp;var _=require("../../..");var _fp=require("../../../lib/utils/fp64");var _luma=require("luma.gl");var _lodash=require("lodash.flattendeep");var _lodash2=_interopRequireDefault(_lodash);var _earcut=require("earcut");var _earcut2=_interopRequireDefault(_earcut);var _glMatrix=require("gl-matrix");var _path=require("path");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){
if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[180,180,200];var DEFAULT_AMBIENT_COLOR=[255,255,255];var DEFAULT_POINTLIGHT_AMBIENT_COEFFICIENT=.1;var DEFAULT_POINTLIGHT_LOCATION=[40.4406,-79.9959,100];var DEFAULT_POINTLIGHT_COLOR=[255,255,255];var DEFAULT_POINTLIGHT_ATTENUATION=1;var DEFAULT_MATERIAL_SPECULAR_COLOR=[255,255,255];var DEFAULT_MATERIAL_SHININESS=1;var ExtrudedChoroplethLayer64=(_temp=_class=function(_Layer){_inherits(ExtrudedChoroplethLayer64,_Layer);function ExtrudedChoroplethLayer64(_ref){var _ref$opacity=_ref.opacity,opacity=_ref$opacity===undefined?1:_ref$opacity,_ref$elevation=_ref.elevation,elevation=_ref$elevation===undefined?1:_ref$elevation,props=_objectWithoutProperties(_ref,["opacity","elevation"]);_classCallCheck(this,ExtrudedChoroplethLayer64);return _possibleConstructorReturn(this,(ExtrudedChoroplethLayer64.__proto__||Object.getPrototypeOf(ExtrudedChoroplethLayer64)).call(this,_extends({opacity:opacity,elevation:elevation},props)))}_createClass(ExtrudedChoroplethLayer64,[{key:"initializeState",value:function initializeState(){var attributeManager=this.state.attributeManager;attributeManager.add({indices:{size:1,isIndexed:true,update:this.calculateIndices},positions:{size:4,update:this.calculatePositions},heights:{size:2,update:this.calculateHeights},normals:{size:3,update:this.calculateNormals},colors:{size:3,update:this.calculateColors}});var gl=this.context.gl;this.setState({numInstances:0,model:this.getModel(gl)})}},{key:"updateState",value:function updateState(_ref2){var changeFlags=_ref2.changeFlags;var attributeManager=this.state.attributeManager;if(changeFlags.dataChanged){this.extractExtrudedChoropleth();attributeManager.invalidateAll()}var _props=this.props,elevation=_props.elevation,color=_props.color,ambientColor=_props.ambientColor,pointLightColor=_props.pointLightColor,pointLightLocation=_props.pointLightLocation,pointLightAmbientCoefficient=_props.pointLightAmbientCoefficient,pointLightAttenuation=_props.pointLightAttenuation,materialSpecularColor=_props.materialSpecularColor,materialShininess=_props.materialShininess;this.setUniforms({elevation:Number.isFinite(elevation)?elevation:1,colors:color||DEFAULT_COLOR,uAmbientColor:ambientColor||DEFAULT_AMBIENT_COLOR,uPointLightAmbientCoefficient:pointLightAmbientCoefficient||DEFAULT_POINTLIGHT_AMBIENT_COEFFICIENT,uPointLightLocation:pointLightLocation||DEFAULT_POINTLIGHT_LOCATION,uPointLightColor:pointLightColor||DEFAULT_POINTLIGHT_COLOR,uPointLightAttenuation:pointLightAttenuation||DEFAULT_POINTLIGHT_ATTENUATION,uMaterialSpecularColor:materialSpecularColor||DEFAULT_MATERIAL_SPECULAR_COLOR,uMaterialShininess:materialShininess||DEFAULT_MATERIAL_SHININESS})}},{key:"draw",value:function draw(_ref3){var uniforms=_ref3.uniforms;this.state.model.render(_extends({},uniforms))}},{key:"pick",value:function pick(opts){_get(ExtrudedChoroplethLayer64.prototype.__proto__||Object.getPrototypeOf(ExtrudedChoroplethLayer64.prototype),"pick",this).call(this,opts);var info=opts.info;var index=this.decodePickingColor(info.color);var feature=index>=0?this.props.data.features[index]:null;info.feature=feature;info.object=feature}},{key:"getShaders",value:function getShaders(){return{vs:"// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME extruded-choropleths-layer-vertex-shader\n\n// import MATH_FP64 from '../shaderlib/fp64/math-fp64';\n// import PROJECT from '../shaderlib/project';\n// import LIGHTING from '../shaderlib/lighting';\n\nuniform float opacity;\nuniform vec3 colors;\nuniform float elevation;\n\nuniform vec3 uAmbientColor;\nuniform float uPointLightAmbientCoefficient;\nuniform vec3 uPointLightLocation;\nuniform vec3 uPointLightColor;\nuniform float uPointLightAttenuation;\n\nuniform vec3 uMaterialSpecularColor;\nuniform float uMaterialShininess;\n\nattribute vec4 positions;\nattribute vec2 heights;\nattribute vec3 normals;\n\nvarying vec4 vColor;\n\nvec3 applyLighting(vec3 position_modelspace, vec3 normal_modelspace, vec3 color) {\n\n  vec3 pointLightLocation_modelspace = vec3(project_position(uPointLightLocation));\n  vec3 lightDirection = normalize(pointLightLocation_modelspace - position_modelspace);\n\n  vec3 ambient = uPointLightAmbientCoefficient * color / 255.0 * uAmbientColor / 255.0;\n\n  float diffuseCoefficient = max(dot(normal_modelspace, lightDirection), 0.0);\n  vec3 diffuse = diffuseCoefficient * uPointLightColor / 255. * color / 255.;\n\n  return ambient + uPointLightAttenuation * diffuse;\n}\n\nvoid main(void) {\n  vec2 projected_xy[2];\n  project_position_fp64(positions, projected_xy);\n  vec2 scaled_height = mul_fp64(heights, vec2(projectionPixelsPerUnit.x * elevation, 0.0));\n\n  vec2 vertex_pos_modelspace[4];\n  vertex_pos_modelspace[0] = projected_xy[0];\n  vertex_pos_modelspace[1] = projected_xy[1];\n  vertex_pos_modelspace[2] = sum_fp64(scaled_height, vec2(1.0, 0.0));\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  vec3 color = applyLighting(\n  \tvec3(\n  \t  vertex_pos_modelspace[0].x,\n  \t  vertex_pos_modelspace[1].x,\n  \t  vertex_pos_modelspace[2].x),\n  \tnormals,\n  \tcolors\n  );\n  vColor = vec4(color, opacity);\n}\n// `;\n",fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* fragment shader for the building-layer */\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n// `;\n',fp64:true,project64:true}}},{key:"getModel",value:function getModel(gl){if(!gl.getExtension("OES_element_index_uint")){throw new Error("Extruded choropleth layer needs 32 bit indices")}gl.enable(_luma.GL.DEPTH_TEST);gl.depthFunc(_luma.GL.LEQUAL);return new _luma.Model(_extends({gl:gl,id:this.props.id},(0,_.assembleShaders)(gl,this.getShaders()),{geometry:new _luma.Geometry({drawMode:this.props.drawWireframe?_luma.GL.LINES:_luma.GL.TRIANGLES}),vertexCount:0,isIndexed:true}))}},{key:"calculatePositions",value:function calculatePositions(attribute){var _this2=this;var positions=this.state.positions;if(!positions){positions=(0,_lodash2.default)(this.state.groupedVertices.map(function(vertices){var topVertices=Array.prototype.concat.apply([],vertices);var baseVertices=topVertices.map(function(v){return[v[0],v[1],0]});return _this2.props.drawWireframe?[topVertices,baseVertices]:[topVertices,topVertices,topVertices,baseVertices,baseVertices]}))}attribute.value=new Float32Array(positions.length/3*4);for(var i=0;i<positions.length/3;i++){var _fp64ify=(0,_fp.fp64ify)(positions[i*3+0]);var _fp64ify2=_slicedToArray(_fp64ify,2);attribute.value[i*4+0]=_fp64ify2[0];attribute.value[i*4+1]=_fp64ify2[1];var _fp64ify3=(0,_fp.fp64ify)(positions[i*3+1]);var _fp64ify4=_slicedToArray(_fp64ify3,2);attribute.value[i*4+2]=_fp64ify4[0];attribute.value[i*4+3]=_fp64ify4[1]}}},{key:"calculateHeights",value:function calculateHeights(attribute){var _this3=this;var positions=this.state.positions;if(!positions){positions=(0,_lodash2.default)(this.state.groupedVertices.map(function(vertices){var topVertices=Array.prototype.concat.apply([],vertices);var baseVertices=topVertices.map(function(v){return[v[0],v[1],0]});return _this3.props.drawWireframe?[topVertices,baseVertices]:[topVertices,topVertices,topVertices,baseVertices,baseVertices]}))}attribute.value=new Float32Array(positions.length/3*2);for(var i=0;i<positions.length/3;i++){var _fp64ify5=(0,_fp.fp64ify)(positions[i*3+2]+.1);var _fp64ify6=_slicedToArray(_fp64ify5,2);attribute.value[i*2+0]=_fp64ify6[0];attribute.value[i*2+1]=_fp64ify6[1]}}},{key:"calculateNormals",value:function calculateNormals(attribute){var _this4=this;var up=[0,1,0];var normals=this.state.groupedVertices.map(function(vertices,buildingIndex){var topNormals=new Array(countVertices(vertices)).fill(up);var sideNormals=vertices.map(function(polygon){return _this4.calculateSideNormals(polygon)});var sideNormalsForward=sideNormals.map(function(n){return n[0]});var sideNormalsBackward=sideNormals.map(function(n){return n[1]});return _this4.props.drawWireframe?[topNormals,topNormals]:[topNormals,sideNormalsForward,sideNormalsBackward,sideNormalsForward,sideNormalsBackward]});attribute.value=new Float32Array((0,_lodash2.default)(normals))}},{key:"calculateSideNormals",value:function calculateSideNormals(vertices){var numVertices=vertices.length;var normals=[];for(var i=0;i<numVertices-1;i++){var n=getNormal(vertices[i],vertices[i+1]);normals.push(n)}return[[].concat(normals,[normals[0]]),[normals[0]].concat(normals)]}},{key:"calculateIndices",value:function calculateIndices(attribute){var _this5=this;var multiplier=this.props.drawWireframe?2:5;var offsets=this.state.groupedVertices.reduce(function(acc,vertices){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+countVertices(vertices)*multiplier])},[0]);var indices=this.state.groupedVertices.map(function(vertices,buildingIndex){return _this5.props.drawWireframe?_this5.calculateContourIndices(vertices,offsets[buildingIndex]):_this5.calculateSurfaceIndices(vertices,offsets[buildingIndex])});attribute.value=new Uint32Array((0,_lodash2.default)(indices));attribute.target=_luma.GL.ELEMENT_ARRAY_BUFFER;this.state.model.setVertexCount(attribute.value.length/attribute.size)}},{key:"calculateColors",value:function calculateColors(attribute){var _this6=this;var colors=this.state.groupedVertices.map(function(vertices,buildingIndex){var color=_this6.props.color;var baseColor=Array.isArray(color)?color[0]:color;var topColor=Array.isArray(color)?color[color.length-1]:color;var numVertices=countVertices(vertices);var topColors=new Array(numVertices).fill(topColor);var baseColors=new Array(numVertices).fill(baseColor);return _this6.props.drawWireframe?[topColors,baseColors]:[topColors,topColors,topColors,baseColors,baseColors]});attribute.value=new Float32Array((0,_lodash2.default)(colors))}},{key:"extractExtrudedChoropleth",value:function extractExtrudedChoropleth(){var _this7=this;var data=this.props.data;this.state.buildings=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{var _loop=function _loop(){var _state$buildings;var building=_step.value;var properties=building.properties,_building$geometry=building.geometry,coordinates=_building$geometry.coordinates,type=_building$geometry.type;if(!properties.height){properties.height=Math.random()*1e3}switch(type){case"MultiPolygon":var buildings=coordinates.map(function(coords){return{coordinates:coords,properties:properties}});(_state$buildings=_this7.state.buildings).push.apply(_state$buildings,_toConsumableArray(buildings));break;case"Polygon":_this7.state.buildings.push({coordinates:coordinates,properties:properties});break;default:}};for(var _iterator=data.features[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){_loop()}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.state.groupedVertices=this.state.buildings.map(function(building){return building.coordinates.map(function(polygon){return polygon.map(function(coordinate){return[coordinate[0],coordinate[1],building.properties.height||10]})})})}},{key:"calculateContourIndices",value:function calculateContourIndices(vertices,offset){var stride=countVertices(vertices);return vertices.map(function(polygon){var indices=[offset];var numVertices=polygon.length;for(var i=1;i<numVertices-1;i++){indices.push(i+offset,i+offset)}indices.push(offset);for(var _i=0;_i<numVertices-1;_i++){indices.push(_i+offset,_i+stride+offset)}offset+=numVertices;return indices})}},{key:"calculateSurfaceIndices",value:function calculateSurfaceIndices(vertices,offset){var stride=countVertices(vertices);var holes=null;var quad=[[0,1],[0,3],[1,2],[1,2],[0,3],[1,4]];if(vertices.length>1){holes=vertices.reduce(function(acc,polygon){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+polygon.length])},[0]).slice(1,vertices.length)}var topIndices=(0,_earcut2.default)((0,_lodash2.default)(vertices),holes,3).map(function(index){return index+offset});var sideIndices=vertices.map(function(polygon){var numVertices=polygon.length;var indices=[];for(var i=0;i<numVertices-1;i++){indices.push.apply(indices,_toConsumableArray(drawRectangle(i)))}offset+=numVertices;return indices});return[topIndices,sideIndices];function drawRectangle(i){return quad.map(function(v){return i+v[0]+stride*v[1]+offset})}}}]);return ExtrudedChoroplethLayer64}(_.Layer),_class.layerName="ExtrudedChoroplethLayer64",_temp);exports.default=ExtrudedChoroplethLayer64;function getNormal(p1,p2){if(p1[0]===p2[0]&&p1[1]===p2[1]){return[1,0,0]}var degrees2radians=Math.PI/180;var lon1=degrees2radians*p1[0];var lon2=degrees2radians*p2[0];var lat1=degrees2radians*p1[1];var lat2=degrees2radians*p2[1];var a=Math.sin(lon2-lon1)*Math.cos(lat2);var b=Math.cos(lat1)*Math.sin(lat2)-Math.sin(lat1)*Math.cos(lat2)*Math.cos(lon2-lon1);return _glMatrix.vec3.normalize([],[b,0,-a])}function countVertices(vertices){return vertices.reduce(function(count,polygon){return count+polygon.length},0)}},{"../../..":341,"../../../lib/utils/fp64":371,earcut:388,"gl-matrix":438,"lodash.flattendeep":466,"luma.gl":505,path:745}],358:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extrudedChoroplethLayer=require("./extruded-choropleth-layer-64");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_extrudedChoroplethLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./extruded-choropleth-layer-64":357}],359:[function(require,module,exports){"use strict";var _scatterplotLayer=require("./scatterplot-layer");var _scatterplotLayer2=_interopRequireDefault(_scatterplotLayer);var _arcLayer=require("./arc-layer");var _arcLayer2=_interopRequireDefault(_arcLayer);var _choroplethLayer=require("./choropleth-layer");var _choroplethLayer2=_interopRequireDefault(_choroplethLayer);var _extrudedChoroplethLayer=require("./extruded-choropleth-layer");var _extrudedChoroplethLayer2=_interopRequireDefault(_extrudedChoroplethLayer);var _lineLayer=require("./line-layer");var _lineLayer2=_interopRequireDefault(_lineLayer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports={ScatterplotLayer64:_scatterplotLayer2.default,ArcLayer64:_arcLayer2.default,ChoroplethLayer64:_choroplethLayer2.default,ExtrudedChoroplethLayer64:_extrudedChoroplethLayer2.default,LineLayer64:_lineLayer2.default}},{"./arc-layer":354,"./choropleth-layer":356,"./extruded-choropleth-layer":358,"./line-layer":360,"./scatterplot-layer":362}],360:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _lineLayer=require("./line-layer-64");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_lineLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./line-layer-64":361}],361:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _class,_temp;var _=require("../../..");var _fp=require("../../../lib/utils/fp64");var _luma=require("luma.gl");var _path=require("path");function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,255,0,255];var defaultGetSourcePosition=function defaultGetSourcePosition(x){return x.sourcePosition};var defaultGetTargetPosition=function defaultGetTargetPosition(x){return x.targetPosition};var defaultGetColor=function defaultGetColor(x){return x.color||DEFAULT_COLOR};var LineLayer64=(_temp=_class=function(_Layer){_inherits(LineLayer64,_Layer);function LineLayer64(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$getSourcePositio=_ref.getSourcePosition,getSourcePosition=_ref$getSourcePositio===undefined?defaultGetSourcePosition:_ref$getSourcePositio,_ref$getTargetPositio=_ref.getTargetPosition,getTargetPosition=_ref$getTargetPositio===undefined?defaultGetTargetPosition:_ref$getTargetPositio,_ref$getColor=_ref.getColor,getColor=_ref$getColor===undefined?defaultGetColor:_ref$getColor,_ref$strokeWidth=_ref.strokeWidth,strokeWidth=_ref$strokeWidth===undefined?1:_ref$strokeWidth,opts=_objectWithoutProperties(_ref,["getSourcePosition","getTargetPosition","getColor","strokeWidth"]);_classCallCheck(this,LineLayer64);return _possibleConstructorReturn(this,(LineLayer64.__proto__||Object.getPrototypeOf(LineLayer64)).call(this,_extends({strokeWidth:strokeWidth,getSourcePosition:getSourcePosition,getTargetPosition:getTargetPosition,getColor:getColor},opts)))}_createClass(LineLayer64,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;this.setState({model:this.createModel(gl)});var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instanceSourcePositionsFP64:{size:4,update:this.calculateInstanceSourcePositions},instanceTargetPositionsFP64:{size:4,update:this.calculateInstanceTargetPositions},instanceElevations:{size:2,update:this.calculateInstanceElevations},instanceColors:{size:4,type:_luma.GL.UNSIGNED_BYTE,update:this.calculateInstanceColors}})}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var gl=this.context.gl;var lineWidth=this.screenToDevicePixels(this.props.strokeWidth);gl.lineWidth(lineWidth);this.state.model.render(uniforms);gl.lineWidth(1)}},{key:"getShaders",value:function getShaders(){return{vs:'// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME line-layer-64-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourcePositionsFP64;\nattribute vec4 instanceTargetPositionsFP64;\nattribute vec2 instanceElevations;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  // Position\n  vec2 projectedSourceCoord[2];\n  project_position_fp64(instanceSourcePositionsFP64, projectedSourceCoord);\n  vec2 projectedTargetCoord[2];\n  project_position_fp64(instanceTargetPositionsFP64, projectedTargetCoord);\n\n  // linear interpolation of source & target to pick right coord\n  float segmentIndex = positions.x;\n  vec2 mixed_temp[2];\n\n  vec2_mix_fp64(projectedSourceCoord, projectedTargetCoord, segmentIndex, mixed_temp);\n\n  float mixedElevation =\n    mix(instanceElevations.x, instanceElevations.y, segmentIndex);\n\n  vec2 vertex_pos_modelspace[4];\n\n  vertex_pos_modelspace[0] = mixed_temp[0];\n  vertex_pos_modelspace[1] = mixed_temp[1];\n  vertex_pos_modelspace[2] = vec2(project_scale(mixedElevation), 0.0);\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  // Color\n  vec4 color = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  vec4 pickingColor = vec4(instancePickingColors / 255., 1.);\n\n  vColor = mix(\n    color,\n    pickingColor,\n    renderPickingBuffer\n  );\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n#define SHADER_NAME line-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n',fp64:true,project64:true}}},{key:"createModel",value:function createModel(gl){var positions=[0,0,0,1,1,1];return new _luma.Model(_extends({gl:gl,id:this.props.id},(0,_.assembleShaders)(gl,this.getShaders()),{geometry:new _luma.Geometry({drawMode:_luma.GL.LINE_STRIP,positions:new Float32Array(positions)}),isInstanced:true}))}},{key:"calculateInstanceSourcePositions",value:function calculateInstanceSourcePositions(attribute){var _props=this.props,data=_props.data,getSourcePosition=_props.getSourcePosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;var sourcePosition=getSourcePosition(object);var _fp64ify=(0,_fp.fp64ify)(sourcePosition[0]);var _fp64ify2=_slicedToArray(_fp64ify,2);value[i+0]=_fp64ify2[0];value[i+1]=_fp64ify2[1];var _fp64ify3=(0,_fp.fp64ify)(sourcePosition[1]);var _fp64ify4=_slicedToArray(_fp64ify3,2);value[i+2]=_fp64ify4[0];value[i+3]=_fp64ify4[1];i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstanceTargetPositions",value:function calculateInstanceTargetPositions(attribute){var _props2=this.props,data=_props2.data,getTargetPosition=_props2.getTargetPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var object=_step2.value;var targetPosition=getTargetPosition(object);var _fp64ify5=(0,_fp.fp64ify)(targetPosition[0]);var _fp64ify6=_slicedToArray(_fp64ify5,2);value[i+0]=_fp64ify6[0];value[i+1]=_fp64ify6[1];var _fp64ify7=(0,_fp.fp64ify)(targetPosition[1]);var _fp64ify8=_slicedToArray(_fp64ify7,2);value[i+2]=_fp64ify8[0];value[i+3]=_fp64ify8[1];i+=size}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceElevations",value:function calculateInstanceElevations(attribute){var _props3=this.props,data=_props3.data,getSourcePosition=_props3.getSourcePosition,getTargetPosition=_props3.getTargetPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var object=_step3.value;var sourcePosition=getSourcePosition(object);var targetPosition=getTargetPosition(object);value[i+0]=sourcePosition[2]||0;value[i+1]=targetPosition[2]||0;i+=size}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}},{key:"calculateInstanceColors",value:function calculateInstanceColors(attribute){var _props4=this.props,data=_props4.data,getColor=_props4.getColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=data[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var object=_step4.value;var color=getColor(object);value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?DEFAULT_COLOR[3]:color[3];i+=size}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}}]);return LineLayer64}(_.Layer),_class.layerName="LineLayer64",_temp);exports.default=LineLayer64},{"../../..":341,"../../../lib/utils/fp64":371,"luma.gl":505,path:745}],362:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _scatterplotLayer=require("./scatterplot-layer-64");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_scatterplotLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./scatterplot-layer-64":363}],363:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _extends=Object.assign||function(target){
for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _class,_temp;var _=require("../../..");var _fp=require("../../../lib/utils/fp64");var _luma=require("luma.gl");var _path=require("path");function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[255,0,255,255];var defaultGetPosition=function defaultGetPosition(x){return x.position};var defaultGetRadius=function defaultGetRadius(x){return x.radius};var defaultGetColor=function defaultGetColor(x){return x.color||DEFAULT_COLOR};var ScatterplotLayer64=(_temp=_class=function(_Layer){_inherits(ScatterplotLayer64,_Layer);function ScatterplotLayer64(_ref){var _ref$getPosition=_ref.getPosition,getPosition=_ref$getPosition===undefined?defaultGetPosition:_ref$getPosition,_ref$getRadius=_ref.getRadius,getRadius=_ref$getRadius===undefined?defaultGetRadius:_ref$getRadius,_ref$getColor=_ref.getColor,getColor=_ref$getColor===undefined?defaultGetColor:_ref$getColor,_ref$radius=_ref.radius,radius=_ref$radius===undefined?30:_ref$radius,_ref$radiusMinPixels=_ref.radiusMinPixels,radiusMinPixels=_ref$radiusMinPixels===undefined?0:_ref$radiusMinPixels,_ref$radiusMaxPixels=_ref.radiusMaxPixels,radiusMaxPixels=_ref$radiusMaxPixels===undefined?Number.MAX_SAFE_INTEGER:_ref$radiusMaxPixels,_ref$drawOutline=_ref.drawOutline,drawOutline=_ref$drawOutline===undefined?false:_ref$drawOutline,_ref$strokeWidth=_ref.strokeWidth,strokeWidth=_ref$strokeWidth===undefined?1:_ref$strokeWidth,props=_objectWithoutProperties(_ref,["getPosition","getRadius","getColor","radius","radiusMinPixels","radiusMaxPixels","drawOutline","strokeWidth"]);_classCallCheck(this,ScatterplotLayer64);return _possibleConstructorReturn(this,(ScatterplotLayer64.__proto__||Object.getPrototypeOf(ScatterplotLayer64)).call(this,_extends({getPosition:getPosition,getRadius:getRadius,getColor:getColor,radius:radius,drawOutline:drawOutline,strokeWidth:strokeWidth,radiusMinPixels:radiusMinPixels,radiusMaxPixels:radiusMaxPixels},props)))}_createClass(ScatterplotLayer64,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;var attributeManager=this.state.attributeManager;this.setState({model:this.getModel(gl)});attributeManager.addInstanced({instancePositionsFP64:{size:4,update:this.calculateInstancePositions},instanceRadius:{size:1,update:this.calculateInstanceRadius},layerHeight:{size:2,update:this.calculateLayerHeight},instanceColors:{size:4,type:_luma.GL.UNSIGNED_BYTE,update:this.calculateInstanceColors}})}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;this.calculateZoomRadius();this.state.model.render(_extends({},uniforms,{radiusMinPixels:this.props.radiusMinPixels,radiusMaxPixels:this.props.radiusMaxPixels,zoomRadiusFP64:this.state.zoomRadiusFP64}))}},{key:"getShaders",value:function getShaders(){return{vs:'// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME scatterplot-layer-64-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instancePositionsFP64;\nattribute vec2 layerHeight;\nattribute float instanceRadius;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\n// Only one-dimensional arrays may be declared in GLSL ES 1.0. specs p.24\nuniform float opacity;\nuniform vec2 zoomRadiusFP64;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  // For some reason, need to add one to elevation to show up in untilted mode\n\n  vec2 projected_coord_xy[2];\n  project_position_fp64(instancePositionsFP64, projected_coord_xy);\n\n  vec2 pos_mul_radius[4];\n  vec4_fp64(vec4(positions * instanceRadius, 0.0), pos_mul_radius);\n\n  vec2 vertex_pos_localspace[4];\n  vec4_scalar_mul_fp64(pos_mul_radius, zoomRadiusFP64, vertex_pos_localspace);\n\n  vec2 vertex_pos_modelspace[4];\n\n  vertex_pos_modelspace[0] = sum_fp64(vertex_pos_localspace[0], projected_coord_xy[0]);\n  vertex_pos_modelspace[1] = sum_fp64(vertex_pos_localspace[1], projected_coord_xy[1]);\n  vertex_pos_modelspace[2] = sum_fp64(vertex_pos_localspace[2], vec2(layerHeight.x + 1.0, layerHeight.y));\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  vec4 color = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  vec4 pickingColor = vec4(instancePickingColors / 255., 1.);\n\n  vColor = mix(\n    color,\n    pickingColor,\n    renderPickingBuffer\n  );\n}\n',fs:'// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME scatterplot-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n\n',fp64:true,project64:true}}},{key:"getModel",value:function getModel(gl){var NUM_SEGMENTS=16;var positions=[];for(var i=0;i<NUM_SEGMENTS;i++){positions.push(Math.cos(Math.PI*2*i/NUM_SEGMENTS),Math.sin(Math.PI*2*i/NUM_SEGMENTS),0)}return new _luma.Model(_extends({gl:gl,id:this.props.id},(0,_.assembleShaders)(gl,this.getShaders()),{geometry:new _luma.Geometry({drawMode:_luma.GL.TRIANGLE_FAN,positions:new Float32Array(positions)}),isInstanced:true}))}},{key:"calculateInstancePositions",value:function calculateInstancePositions(attribute){var _props=this.props,data=_props.data,getPosition=_props.getPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var point=_step.value;var position=getPosition(point);var _fp64ify=(0,_fp.fp64ify)(position[0]);var _fp64ify2=_slicedToArray(_fp64ify,2);value[i+0]=_fp64ify2[0];value[i+1]=_fp64ify2[1];var _fp64ify3=(0,_fp.fp64ify)(position[1]);var _fp64ify4=_slicedToArray(_fp64ify3,2);value[i+2]=_fp64ify4[0];value[i+3]=_fp64ify4[1];i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateLayerHeight",value:function calculateLayerHeight(attribute){var _props2=this.props,data=_props2.data,getPosition=_props2.getPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var point=_step2.value;var position=getPosition(point);var _fp64ify5=(0,_fp.fp64ify)(position[2]||0);var _fp64ify6=_slicedToArray(_fp64ify5,2);value[i+0]=_fp64ify6[0];value[i+1]=_fp64ify6[1];i+=size}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceRadius",value:function calculateInstanceRadius(attribute){var _props3=this.props,data=_props3.data,getRadius=_props3.getRadius;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var point=_step3.value;var radius=getRadius(point)||1;value[i+0]=radius;i+=size}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}},{key:"calculateInstanceColors",value:function calculateInstanceColors(attribute){var _props4=this.props,data=_props4.data,getColor=_props4.getColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=data[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var point=_step4.value;var color=getColor(point);value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?DEFAULT_COLOR[3]:color[3];i+=size}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}},{key:"calculateZoomRadius",value:function calculateZoomRadius(){var pixel0=this.projectFlat([-122,37.5]);var pixel1=this.projectFlat([-122,37.5002]);var dx=pixel0[0]-pixel1[0];var dy=pixel0[1]-pixel1[1];var radius=Math.max(Math.sqrt(dx*dx+dy*dy),2);this.state.zoomRadiusFP64=(0,_fp.fp64ify)(radius)}}]);return ScatterplotLayer64}(_.Layer),_class.layerName="ScatterplotLayer64",_temp);exports.default=ScatterplotLayer64},{"../../..":341,"../../../lib/utils/fp64":371,"luma.gl":505,path:745}],364:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _luma=require("luma.gl");var _utils=require("./utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function noop(){}var AttributeManager=function(){function AttributeManager(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$id=_ref.id,id=_ref$id===undefined?"attribute-manager":_ref$id,otherProps=_objectWithoutProperties(_ref,["id"]);_classCallCheck(this,AttributeManager);this.id=id;this.attributes={};this.allocedInstances=-1;this.needsRedraw=true;this.userData={};this.onUpdateStart=noop;this.onUpdateEnd=noop;this.onLog=this._defaultLog;Object.seal(this)}_createClass(AttributeManager,[{key:"add",value:function add(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this._add(attributes,updaters)}},{key:"invalidate",value:function invalidate(attributeName){var attributes=this.attributes;var attribute=attributes[attributeName];if(!attribute){var message="invalidating non-existent attribute "+attributeName+" for "+this.id+"\n";message+="Valid attributes: "+Object.keys(attributes).join(", ");(0,_assert2.default)(attribute,message)}attribute.needsUpdate=true;this.onLog(1,"invalidated attribute "+attributeName+" for "+this.id)}},{key:"invalidateAll",value:function invalidateAll(){var attributes=this.attributes;for(var attributeName in attributes){this.invalidate(attributeName)}}},{key:"update",value:function update(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},data=_ref2.data,numInstances=_ref2.numInstances,_ref2$buffers=_ref2.buffers,buffers=_ref2$buffers===undefined?{}:_ref2$buffers,_ref2$props=_ref2.props,props=_ref2$props===undefined?{}:_ref2$props,_ref2$context=_ref2.context,context=_ref2$context===undefined?{}:_ref2$context,opts=_objectWithoutProperties(_ref2,["data","numInstances","buffers","props","context"]);this._checkExternalBuffers(buffers,opts);this._setExternalBuffers(buffers);if(this._analyzeBuffers({numInstances:numInstances})){this.onUpdateStart(this.id);this._updateBuffers({numInstances:numInstances,data:data,props:props,context:context});this.onUpdateEnd(this.id)}}},{key:"setLogFunctions",value:function setLogFunctions(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},onLog=_ref3.onLog,onUpdateStart=_ref3.onUpdateStart,onUpdateEnd=_ref3.onUpdateEnd;this.onLog=onLog!==undefined?onLog:this.onLog;this.onUpdateStart=onUpdateStart!==undefined?onUpdateStart:this.onUpdateStart;this.onUpdateEnd=onUpdateEnd!==undefined?onUpdateEnd:this.onUpdateEnd}},{key:"getAttributes",value:function getAttributes(){return this.attributes}},{key:"getChangedAttributes",value:function getChangedAttributes(_ref4){var _ref4$clearChangedFla=_ref4.clearChangedFlags,clearChangedFlags=_ref4$clearChangedFla===undefined?false:_ref4$clearChangedFla;var attributes=this.attributes;var changedAttributes={};for(var attributeName in attributes){var attribute=attributes[attributeName];if(attribute.changed){attribute.changed=attribute.changed&&!clearChangedFlags;changedAttributes[attributeName]=attribute}}return changedAttributes}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref5$clearRedrawFlag=_ref5.clearRedrawFlags,clearRedrawFlags=_ref5$clearRedrawFlag===undefined?false:_ref5$clearRedrawFlag;var redraw=this.needsRedraw;redraw=redraw||this.needsRedraw;this.needsRedraw=this.needsRedraw&&!clearRedrawFlags;return redraw}},{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.needsRedraw=true;return this}},{key:"addDynamic",value:function addDynamic(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this._add(attributes,updaters)}},{key:"addInstanced",value:function addInstanced(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this._add(attributes,updaters,{instanced:1})}},{key:"_defaultLog",value:function _defaultLog(level,message){_utils.log.log(level,message)}},{key:"_add",value:function _add(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _extraProps=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var newAttributes={};for(var attributeName in attributes){if(attributeName in updaters){attributes[attributeName]=_extends({},attributes[attributeName],updaters[attributeName])}var attribute=attributes[attributeName];this._validate(attributeName,attribute);var attributeData=_extends({target:undefined,isIndexed:false,userData:{}},attribute,{isExternalBuffer:false,needsAlloc:false,needsUpdate:false,changed:false,size:attribute.size,value:attribute.value||null},_extraProps);Object.seal(attributeData);this.attributes[attributeName]=attributeData}Object.assign(this.attributes,newAttributes)}},{key:"_validate",value:function _validate(attributeName,attribute){(0,_assert2.default)(typeof attribute.size==="number","Attribute definition for "+attributeName+" missing size");(0,_assert2.default)(typeof attribute.update==="function"||attribute.noAlloc,"Attribute updater for "+attributeName+" missing update method")}},{key:"_checkExternalBuffers",value:function _checkExternalBuffers(){var bufferMap=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var attributes=this.attributes;for(var attributeName in bufferMap){var attribute=attributes[attributeName];if(!attribute&&!opts.ignoreUnknownAttributes){throw new Error("Unknown attribute prop "+attributeName)}}}},{key:"_setExternalBuffers",value:function _setExternalBuffers(bufferMap){var attributes=this.attributes,numInstances=this.numInstances;for(var attributeName in attributes){var attribute=attributes[attributeName];var buffer=bufferMap[attributeName];attribute.isExternalBuffer=false;if(buffer){if(!(buffer instanceof Float32Array)){throw new Error("Attribute properties must be of type Float32Array")}if(attribute.auto&&buffer.length<=numInstances*attribute.size){throw new Error("Attribute prop array must match length and size")}attribute.isExternalBuffer=true;attribute.needsUpdate=false;if(attribute.value!==buffer){attribute.value=buffer;attribute.changed=true;this.needsRedraw=true}}}}},{key:"_analyzeBuffers",value:function _analyzeBuffers(_ref6){var numInstances=_ref6.numInstances;var attributes=this.attributes;(0,_assert2.default)(numInstances!==undefined,"numInstances not defined");var needsUpdate=false;for(var attributeName in attributes){var attribute=attributes[attributeName];if(!attribute.isExternalBuffer){var needsAlloc=attribute.value===null||attribute.value.length/attribute.size<numInstances;if(needsAlloc&&attribute.update){attribute.needsAlloc=true;needsUpdate=true}if(attribute.needsUpdate){needsUpdate=true}}}return needsUpdate}},{key:"_updateBuffers",value:function _updateBuffers(_ref7){var numInstances=_ref7.numInstances,data=_ref7.data,props=_ref7.props,context=_ref7.context;var attributes=this.attributes;var allocCount=Math.max(numInstances,1);for(var attributeName in attributes){var attribute=attributes[attributeName];if(attribute.needsAlloc){var ArrayType=(0,_luma.glArrayFromType)(attribute.type||_luma.GL.FLOAT);attribute.value=new ArrayType(attribute.size*allocCount);this.onLog(2,this.id+":"+attributeName+" allocated "+allocCount);attribute.needsAlloc=false;attribute.needsUpdate=true}if(attribute.needsUpdate){var update=attribute.update;if(update){this.onLog(2,this.id+":"+attributeName+" updating "+numInstances);update.call(context,attribute,{data:data,props:props,numInstances:numInstances})}else{this.onLog(2,this.id+":"+attributeName+" missing update function")}attribute.needsUpdate=false;attribute.changed=true;this.needsRedraw=true}}this.allocedInstances=allocCount}}]);return AttributeManager}();exports.default=AttributeManager},{"./utils":372,assert:2,"luma.gl":505}],365:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LayerManager=exports.AttributeManager=exports.Layer=undefined;var _layer=require("./layer");Object.defineProperty(exports,"Layer",{enumerable:true,get:function get(){return _interopRequireDefault(_layer).default}});var _attributeManager=require("./attribute-manager");Object.defineProperty(exports,"AttributeManager",{enumerable:true,get:function get(){return _interopRequireDefault(_attributeManager).default}});var _layerManager=require("./layer-manager");Object.defineProperty(exports,"LayerManager",{enumerable:true,get:function get(){return _interopRequireDefault(_layerManager).default}});var _objectIterator=require("./utils/object-iterator");Object.keys(_objectIterator).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _objectIterator[key]}})});require("./init");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./attribute-manager":364,"./init":366,"./layer":368,"./layer-manager":367,"./utils/object-iterator":374}],366:[function(require,module,exports){"use strict";var _package=require("../../package.json");var STARTUP_MESSAGE="set deck.log.priority=2 to trace attribute updates";console.log("deck.gl "+_package.version+" - "+STARTUP_MESSAGE)},{"../../package.json":386}],367:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _layer=require("./layer");var _layer2=_interopRequireDefault(_layer);var _viewport=require("../viewport");var _utils=require("./utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);var _pickLayers=require("./pick-layers");var _luma=require("luma.gl");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var LayerManager=function(){function LayerManager(_ref){var gl=_ref.gl;_classCallCheck(this,LayerManager);this.prevLayers=[];this.layers=[];this.drewLayers=false;this.oldContext={};this.context={gl:gl,uniforms:{},viewport:null,viewportChanged:true,pickingFBO:null};this.redrawNeeded=true;Object.seal(this.context)}_createClass(LayerManager,[{key:"setContext",value:function setContext(_ref2){var width=_ref2.width,height=_ref2.height,latitude=_ref2.latitude,longitude=_ref2.longitude,zoom=_ref2.zoom,pitch=_ref2.pitch,bearing=_ref2.bearing,altitude=_ref2.altitude;var oldViewport=this.context.viewport;var viewportChanged=!oldViewport||width!==oldViewport.width||height!==oldViewport.height||latitude!==oldViewport.latitude||longitude!==oldViewport.longitude||zoom!==oldViewport.zoom||bearing!==oldViewport.bearing||pitch!==oldViewport.pitch||altitude!==oldViewport.altitude;if(viewportChanged||!this.context.viewport){Object.assign(this.oldContext,this.context);var viewport=new _viewport.Viewport({width:width,height:height,latitude:latitude,longitude:longitude,zoom:zoom,pitch:pitch,bearing:bearing,altitude:altitude,tileSize:512});this.context.viewport=viewport;this.context.viewportChanged=viewportChanged;this.context.uniforms={};(0,_utils.log)(4,viewport,latitude,longitude,zoom)}return this}},{key:"updateLayers",value:function updateLayers(_ref3){var newLayers=_ref3.newLayers;(0,_assert2.default)(this.context.viewport,"LayerManager.updateLayers: viewport not set");newLayers=newLayers.filter(function(newLayer){return newLayer!==null});var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=newLayers[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var layer=_step.value;layer.context=this.context}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.prevLayers=this.layers;var _updateLayers2=this._updateLayers({oldLayers:this.prevLayers,newLayers:newLayers}),error=_updateLayers2.error,generatedLayers=_updateLayers2.generatedLayers;this.layers=generatedLayers;if(error){throw error}return this}},{key:"drawLayers",value:function drawLayers(){(0,_assert2.default)(this.context.viewport,"LayerManager.drawLayers: viewport not set");var uniforms=this.context.uniforms;var layerIndex=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.layers[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var layer=_step2.value;if(layer.props.visible){layer.drawLayer({uniforms:uniforms,layerIndex:layerIndex});layerIndex++}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return this}},{key:"pickLayer",value:function pickLayer(_ref4){var x=_ref4.x,y=_ref4.y,mode=_ref4.mode;var _context=this.context,gl=_context.gl,uniforms=_context.uniforms;if(this.context.pickingFBO===null||gl.canvas.width!==this.context.pickingFBO.width||gl.canvas.height!==this.context.pickingFBO.height){this.context.pickingFBO=new _luma.FramebufferObject(gl,{width:gl.canvas.width,height:gl.canvas.height})}return(0,_pickLayers.pickLayers)(gl,{x:x,y:y,uniforms:uniforms,layers:this.layers,mode:mode,pickingFBO:this.context.pickingFBO})}},{key:"needsRedraw",value:function needsRedraw(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref5$clearRedrawFlag=_ref5.clearRedrawFlags,clearRedrawFlags=_ref5$clearRedrawFlag===undefined?false:_ref5$clearRedrawFlag;if(!this.context.viewport){return false}var redraw=false;if(this.layers.length===0&&this.drewLayers){redraw=true;return true}if(this.redrawNeeded){this.redrawNeeded=false;redraw=true}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.layers[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var layer=_step3.value;redraw=redraw||layer.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags});this.drewLayers=true}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}return redraw}},{key:"_updateLayers",value:function _updateLayers(_ref6){var oldLayers=_ref6.oldLayers,newLayers=_ref6.newLayers;var oldLayerMap={};var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=oldLayers[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var oldLayer=_step4.value;if(oldLayerMap[oldLayer.id]){_utils.log.once(0,"Multipe old layers with same id "+layerName(oldLayer))}else{oldLayerMap[oldLayer.id]=oldLayer}}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}var generatedLayers=[];var error=this._matchSublayers({newLayers:newLayers,oldLayerMap:oldLayerMap,generatedLayers:generatedLayers});var error2=this._finalizeOldLayers(oldLayers);var firstError=error||error2;return{error:firstError,generatedLayers:generatedLayers}}},{key:"_matchSublayers",value:function _matchSublayers(_ref7){var newLayers=_ref7.newLayers,oldLayerMap=_ref7.oldLayerMap,generatedLayers=_ref7.generatedLayers;newLayers=newLayers.filter(function(newLayer){return newLayer!==null});var error=null;var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=newLayers[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var newLayer=_step5.value;newLayer.context=this.context;try{var oldLayer=oldLayerMap[newLayer.id];oldLayerMap[newLayer.id]=null;if(oldLayer===null){_utils.log.once(0,"Multipe new layers with same id "+layerName(newLayer))}if(oldLayer){(0,_utils.log)(3,"matched "+layerName(newLayer),oldLayer,"=>",newLayer);this._transferLayerState(oldLayer,newLayer);this._updateLayer(newLayer)}else{this._initializeNewLayer(newLayer)}generatedLayers.push(newLayer);var sublayers=newLayer.renderLayers();if(sublayers){sublayers=Array.isArray(sublayers)?sublayers:[sublayers];this._matchSublayers({newLayers:sublayers,oldLayerMap:oldLayerMap,generatedLayers:generatedLayers})}}catch(err){_utils.log.once(0,"deck.gl error during matching of "+layerName(newLayer)+" "+err,err);error=error||err}}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally{if(_didIteratorError5){throw _iteratorError5}}}return error}},{key:"_transferLayerState",value:function _transferLayerState(oldLayer,newLayer){var state=oldLayer.state,props=oldLayer.props;(0,_assert2.default)(state,"deck.gl sanity check - Matching layer has no state");(0,_assert2.default)(oldLayer!==newLayer,"deck.gl sanity check - Matching layer is same");newLayer.state=state;state.layer=newLayer;if(state.model){state.model.userData.layer=newLayer;
}newLayer.oldProps=props;oldLayer.state=null}},{key:"_finalizeOldLayers",value:function _finalizeOldLayers(oldLayers){var error=null;var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=oldLayers[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var layer=_step6.value;if(layer.state){error=error||this._finalizeLayer(layer)}}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally{try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return()}}finally{if(_didIteratorError6){throw _iteratorError6}}}return error}},{key:"_initializeNewLayer",value:function _initializeNewLayer(layer){var error=null;if(!layer.state){(0,_utils.log)(1,"initializing "+layerName(layer));try{layer.initializeLayer({oldProps:{},props:layer.props,oldContext:this.oldContext,context:this.context,changeFlags:layer.diffProps({},layer.props,this.context)})}catch(err){_utils.log.once(0,"deck.gl error during initialization of "+layerName(layer)+" "+err,err);error=error||err}if(layer.state){layer.state.layer=layer}if(layer.state&&layer.state.model){layer.state.model.userData.layer=layer}}return error}},{key:"_updateLayer",value:function _updateLayer(layer){var oldProps=layer.oldProps,props=layer.props;var error=null;if(oldProps){try{layer.updateLayer({oldProps:oldProps,props:props,context:this.context,oldContext:this.oldContext,changeFlags:layer.diffProps(oldProps,layer.props,this.context)})}catch(err){_utils.log.once(0,"deck.gl error during update of "+layerName(layer),err);error=err}(0,_utils.log)(2,"updating "+layerName(layer))}return error}},{key:"_finalizeLayer",value:function _finalizeLayer(layer){var error=null;var state=layer.state;if(state){try{layer.finalizeLayer()}catch(err){_utils.log.once(0,"deck.gl error during finalization of "+layerName(layer),err);error=err}layer.state=null;(0,_utils.log)(1,"finalizing "+layerName(layer))}return error}}]);return LayerManager}();exports.default=LayerManager;function layerName(layer){if(layer instanceof _layer2.default){return""+layer}return!layer?"null layer":"invalid layer"}},{"../viewport":383,"./layer":368,"./pick-layers":369,"./utils":372,assert:2,"luma.gl":505}],368:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _attributeManager=require("./attribute-manager");var _attributeManager2=_interopRequireDefault(_attributeManager);var _luma=require("luma.gl");var _utils=require("./utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var DEFAULT_PROPS={data:[],dataIterator:null,dataComparator:null,numInstances:undefined,visible:true,pickable:false,opacity:.8,onHover:function onHover(){},onClick:function onClick(){},getValue:function getValue(x){return x},updateTriggers:{}};var counter=0;var Layer=function(){function Layer(props){_classCallCheck(this,Layer);props=_extends({},DEFAULT_PROPS,props,{data:props.data||[],id:props.id||this.constructor.layerName});this.id=props.id;this.count=counter++;this.props=props;this.oldProps=null;this.state=null;this.context=null;Object.seal(this);this.validateRequiredProp("id",function(x){return typeof x==="string"});this.validateRequiredProp("data");if(props.data){(0,_utils.addIterator)(props.data);if(!props.data[Symbol.iterator]){_utils.log.once(0,"data prop must have iterator")}}this._validateDeprecatedProps()}_createClass(Layer,[{key:"toString",value:function toString(){var className=this.constructor.name;return className!==this.props.id?"<"+className+":'"+this.props.id+"'>":"<"+className+">"}},{key:"initializeState",value:function initializeState(){throw new Error("Layer "+this+" has not defined initializeState")}},{key:"finalizeState",value:function finalizeState(){}},{key:"shouldUpdateState",value:function shouldUpdateState(_ref){var oldProps=_ref.oldProps,props=_ref.props,oldContext=_ref.oldContext,context=_ref.context,changeFlags=_ref.changeFlags;return changeFlags.somethingChanged}},{key:"updateState",value:function updateState(_ref2){var oldProps=_ref2.oldProps,props=_ref2.props,oldContext=_ref2.oldContext,context=_ref2.context,changeFlags=_ref2.changeFlags;if(changeFlags.dataChanged&&this.state.attributeManager){this.state.attributeManager.invalidateAll()}}},{key:"renderLayers",value:function renderLayers(){return null}},{key:"draw",value:function draw(_ref3){var _ref3$uniforms=_ref3.uniforms,uniforms=_ref3$uniforms===undefined?{}:_ref3$uniforms;if(this.state.model){this.state.model.render(uniforms)}}},{key:"pick",value:function pick(_ref4){var info=_ref4.info,uniforms=_ref4.uniforms,pickEnableUniforms=_ref4.pickEnableUniforms,pickDisableUniforms=_ref4.pickDisableUniforms,mode=_ref4.mode;var gl=this.context.gl;var model=this.state.model;if(model){model.setUniforms(pickEnableUniforms);model.render(uniforms);model.setUniforms(pickDisableUniforms);var _info$devicePixel=_slicedToArray(info.devicePixel,2),x=_info$devicePixel[0],y=_info$devicePixel[1];var color=new Uint8Array(4);gl.readPixels(x,y,1,1,_luma.GL.RGBA,_luma.GL.UNSIGNED_BYTE,color);info.index=this.decodePickingColor(color);info.color=color;if(mode==="hover"){var selectedPickingColor=new Float32Array(3);selectedPickingColor[0]=color[0];selectedPickingColor[1]=color[1];selectedPickingColor[2]=color[2];this.setUniforms({selectedPickingColor:selectedPickingColor})}}}},{key:"setState",value:function setState(updateObject){Object.assign(this.state,updateObject);this.state.needsRedraw=true}},{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this.state){this.state.needsRedraw=redraw}}},{key:"project",value:function project(lngLat){var viewport=this.context.viewport;(0,_assert2.default)(Array.isArray(lngLat),"Layer.project needs [lng,lat]");return viewport.project(lngLat)}},{key:"unproject",value:function unproject(xy){var viewport=this.context.viewport;(0,_assert2.default)(Array.isArray(xy),"Layer.unproject needs [x,y]");return viewport.unproject(xy)}},{key:"projectFlat",value:function projectFlat(lngLat){var viewport=this.context.viewport;(0,_assert2.default)(Array.isArray(lngLat),"Layer.project needs [lng,lat]");return viewport.projectFlat(lngLat)}},{key:"unprojectFlat",value:function unprojectFlat(xy){var viewport=this.context.viewport;(0,_assert2.default)(Array.isArray(xy),"Layer.unproject needs [x,y]");return viewport.unprojectFlat(xy)}},{key:"screenToDevicePixels",value:function screenToDevicePixels(screenPixels){var devicePixelRatio=typeof window!=="undefined"?window.devicePixelRatio:1;return screenPixels*devicePixelRatio}},{key:"nullPickingColor",value:function nullPickingColor(){return[0,0,0]}},{key:"encodePickingColor",value:function encodePickingColor(i){return[(i+1)%256,Math.floor((i+1)/256)%256,Math.floor((i+1)/256/256)%256]}},{key:"decodePickingColor",value:function decodePickingColor(color){(0,_assert2.default)(color instanceof Uint8Array);var _color=_slicedToArray(color,3),i1=_color[0],i2=_color[1],i3=_color[2];var index=i1+i2*256+i3*65536-1;return index}},{key:"calculateInstancePickingColors",value:function calculateInstancePickingColors(attribute,_ref5){var numInstances=_ref5.numInstances;var value=attribute.value,size=attribute.size;for(var i=0;i<numInstances;i++){var pickingColor=this.encodePickingColor(i);value[i*size+0]=pickingColor[0];value[i*size+1]=pickingColor[1];value[i*size+2]=pickingColor[2]}}},{key:"getFirstObject",value:function getFirstObject(){var data=this.props.data;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;return object}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return null}},{key:"getNumInstances",value:function getNumInstances(props){props=props||this.props;if(this.state&&this.state.numInstances!==undefined){return this.state.numInstances}if(props.numInstances!==undefined){return props.numInstances}var _props=props,data=_props.data;if(data&&typeof data.count==="function"){return data.count()}if(data&&data.size!==undefined){return data.size}if(data&&data.length!==undefined){return data.length}throw new Error("Could not deduce numInstances")}},{key:"initializeLayer",value:function initializeLayer(updateParams){(0,_assert2.default)(this.context.gl,"Layer context missing gl");(0,_assert2.default)(!this.state,"Layer missing state");this.state={};this.setState({attributeManager:new _attributeManager2.default({id:this.props.id}),model:null,needsRedraw:true,dataChanged:true});this.state.attributeManager.setLogFunctions(this.props);var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instancePickingColors:{type:_luma.GL.UNSIGNED_BYTE,size:3,update:this.calculateInstancePickingColors}});this.initializeState();this.updateState(updateParams);this._updateAttributes(this.props);this._updateBaseUniforms();var model=this.state.model;if(model){model.setInstanceCount(this.getNumInstances());model.id=this.props.id;model.program.id=this.props.id+"-program";model.geometry.id=this.props.id+"-geometry";model.setAttributes(attributeManager.getAttributes())}}},{key:"updateLayer",value:function updateLayer(updateParams){if(this.shouldUpdate){_utils.log.once(0,"deck.gl v3 shouldUpdate deprecated. Use shouldUpdateState in "+this)}var stateNeedsUpdate=this.shouldUpdateState(updateParams);if(stateNeedsUpdate){var hasRedefinedMethod=this.willReceiveProps&&this.willReceiveProps!==Layer.prototype.willReceiveProps;if(hasRedefinedMethod){_utils.log.once(0,"deck.gl v3 willReceiveProps deprecated. Use updateState in "+this);var oldProps=updateParams.oldProps,props=updateParams.props,changeFlags=updateParams.changeFlags;this.setState(changeFlags);this.willReceiveProps(oldProps,props,changeFlags);this.setState({dataChanged:false,viewportChanged:false})}this.updateState(updateParams);this._updateAttributes(updateParams.newProps);this._updateBaseUniforms();if(this.state.model){this.state.model.setInstanceCount(this.getNumInstances())}}}},{key:"finalizeLayer",value:function finalizeLayer(){this.finalizeState()}},{key:"drawLayer",value:function drawLayer(_ref6){var _ref6$uniforms=_ref6.uniforms,uniforms=_ref6$uniforms===undefined?{}:_ref6$uniforms,_ref6$layerIndex=_ref6.layerIndex,layerIndex=_ref6$layerIndex===undefined?0:_ref6$layerIndex;(0,_assert2.default)(this.context.viewport,"Layer missing context.viewport");var viewportUniforms=this.context.viewport.getUniforms(this.props);uniforms=_extends({},uniforms,viewportUniforms,{layerIndex:layerIndex});this.draw({uniforms:uniforms})}},{key:"pickLayer",value:function pickLayer(_ref7){var _ref7$uniforms=_ref7.uniforms,uniforms=_ref7$uniforms===undefined?{}:_ref7$uniforms,opts=_objectWithoutProperties(_ref7,["uniforms"]);var viewportUniforms=this.context.viewport.getUniforms(this.props);uniforms=_extends({},uniforms,viewportUniforms,{renderPickingBuffer:true});return this.pick(_extends({uniforms:uniforms},opts))}},{key:"diffProps",value:function diffProps(oldProps,newProps,context){var propsChangedReason=(0,_utils.compareProps)({newProps:newProps,oldProps:oldProps,ignoreProps:{data:null,updateTriggers:null}});var dataChangedReason=this._diffDataProps(oldProps,newProps);var propsChanged=Boolean(propsChangedReason);var dataChanged=Boolean(dataChangedReason);var viewportChanged=context.viewportChanged;var somethingChanged=propsChanged||dataChanged||viewportChanged;if(!dataChanged){this._diffUpdateTriggers(oldProps,newProps)}else{_utils.log.log(1,"dataChanged: "+dataChanged)}return{propsChanged:propsChanged,dataChanged:dataChanged,viewportChanged:viewportChanged,somethingChanged:somethingChanged,reason:dataChangedReason||propsChangedReason}}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref8=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref8$clearRedrawFlag=_ref8.clearRedrawFlags,clearRedrawFlags=_ref8$clearRedrawFlag===undefined?false:_ref8$clearRedrawFlag;if(!this.state){return false}var redraw=false;redraw=redraw||this.state.needsRedraw;this.state.needsRedraw=this.state.needsRedraw&&!clearRedrawFlags;var _state=this.state,attributeManager=_state.attributeManager,model=_state.model;redraw=redraw||attributeManager&&attributeManager.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags});redraw=redraw||model&&model.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags});return redraw}},{key:"_diffDataProps",value:function _diffDataProps(oldProps,newProps){var dataComparator=newProps.dataComparator;if(dataComparator){if(!dataComparator(newProps.data,oldProps.data)){return"Data comparator detected a change"}}else if(newProps.data!==oldProps.data){return"A new data container was supplied"}return null}},{key:"_diffUpdateTriggers",value:function _diffUpdateTriggers(oldProps,newProps){var attributeManager=this.state.attributeManager;if(!attributeManager){return false}var change=false;for(var propName in newProps.updateTriggers){var oldTriggers=oldProps.updateTriggers[propName];var newTriggers=newProps.updateTriggers[propName];var diffReason=(0,_utils.compareProps)({oldProps:oldTriggers,newProps:newTriggers});if(diffReason){if(propName==="all"){_utils.log.log(1,"updateTriggers invalidating all attributes: "+diffReason);attributeManager.invalidateAll();change=true}else{_utils.log.log(1,"updateTriggers invalidating attribute "+propName+": "+diffReason);attributeManager.invalidate(propName);change=true}}}return change}},{key:"validateRequiredProp",value:function validateRequiredProp(propertyName,condition){var value=this.props[propertyName];if(value===undefined){throw new Error("Property "+propertyName+" undefined in layer "+this)}if(condition&&!condition(value)){throw new Error("Bad property "+propertyName+" in layer "+this)}}},{key:"_updateAttributes",value:function _updateAttributes(props){var _state2=this.state,attributeManager=_state2.attributeManager,model=_state2.model;if(!attributeManager){return}var numInstances=this.getNumInstances(props);attributeManager.update({numInstances:numInstances,bufferMap:props,context:this,ignoreUnknownAttributes:true});if(model){var changedAttributes=attributeManager.getChangedAttributes({clearChangedFlags:true});model.setAttributes(changedAttributes)}}},{key:"_updateBaseUniforms",value:function _updateBaseUniforms(){this.setUniforms({opacity:Math.pow(this.props.opacity,1/2.2),ONE:1})}},{key:"willReceiveProps",value:function willReceiveProps(){}},{key:"setUniforms",value:function setUniforms(uniformMap){if(this.state.model){this.state.model.setUniforms(uniformMap)}this.state.needsRedraw=true;(0,_utils.log)(3,"layer.setUniforms",uniformMap)}},{key:"_validateDeprecatedProps",value:function _validateDeprecatedProps(){if(this.props.isPickable!==undefined){_utils.log.once(0,"No isPickable prop in deckgl v3 - use pickable instead")}var hasViewportProps=this.props.latitude!==undefined||this.props.longitude!==undefined||this.props.zoom!==undefined||this.props.pitch!==undefined||this.props.bearing!==undefined;if(hasViewportProps){_utils.log.once(0,"deck.gl v3 no longer needs viewport props in Layer "+this)}}}]);return Layer}();exports.default=Layer},{"./attribute-manager":364,"./utils":372,assert:2,"luma.gl":505}],369:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.pickLayers=pickLayers;var _luma=require("luma.gl");function pickLayers(gl,_ref){var layers=_ref.layers,pickingFBO=_ref.pickingFBO,_ref$uniforms=_ref.uniforms,uniforms=_ref$uniforms===undefined?{}:_ref$uniforms,x=_ref.x,y=_ref.y,mode=_ref.mode;var pixelRatio=typeof window!=="undefined"?window.devicePixelRatio:1;var deviceX=x*pixelRatio;var deviceY=gl.canvas.height-y*pixelRatio;var pickedInfos=[];(0,_luma.glContextWithState)(gl,{frameBuffer:pickingFBO,framebuffer:pickingFBO,scissorTest:{x:deviceX,y:deviceY,w:1,h:1}},function(){var zOrder=0;var isBlending=gl.isEnabled(_luma.GL.BLEND);gl.disable(_luma.GL.BLEND);for(var i=layers.length-1;i>=0;--i){var layer=layers[i];if(layer.props.visible&&layer.props.pickable){gl.clear(_luma.GL.COLOR_BUFFER_BIT|_luma.GL.DEPTH_BUFFER_BIT);var info=createInfo({layer:layer,pixel:[x,y],devicePixel:[deviceX,deviceY],pixelRatio:pixelRatio});layer.pickLayer({info:info,uniforms:uniforms,pickEnableUniforms:{renderPickingBuffer:1,pickingEnabled:1},pickDisableUniforms:{renderPickingBuffer:0,pickingEnabled:0},deviceX:deviceX,deviceY:deviceY,mode:mode});if(info.index>=0){info.picked=true;info.zOrder=zOrder++;if(Array.isArray(layer.props.data)){info.object=layer.props.data[info.index]}}pickedInfos.push(info)}}if(isBlending){gl.enable(_luma.GL.BLEND)}});var unhandledPickInfos=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=pickedInfos[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var info=_step.value;var handled=null;switch(mode){case"click":handled=info.layer.props.onClick(info);break;case"hover":handled=info.layer.props.onHover(info);break;default:throw new Error("unknown pick type")}if(!handled){unhandledPickInfos.push(info)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return unhandledPickInfos}function createInfo(_ref2){var info=_ref2.info,layer=_ref2.layer,pixel=_ref2.pixel,devicePixel=_ref2.devicePixel,pixelRatio=_ref2.pixelRatio;return{layer:layer,index:-1,picked:false,x:pixel[0],y:pixel[1],pixel:pixel,devicePixel:devicePixel,pixelRatio:pixelRatio,lngLat:layer.unproject(pixel)}}},{"luma.gl":505}],370:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.compareProps=compareProps;exports.areEqualShallow=areEqualShallow;var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function compareProps(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},oldProps=_ref.oldProps,newProps=_ref.newProps,_ref$ignoreProps=_ref.ignoreProps,ignoreProps=_ref$ignoreProps===undefined?{}:_ref$ignoreProps;(0,_assert2.default)(oldProps!==undefined&&newProps!==undefined,"compareProps args");if(oldProps===newProps){return null}if((typeof oldProps==="undefined"?"undefined":_typeof(oldProps))!=="object"||oldProps===null){return"old props is not an object"}if((typeof newProps==="undefined"?"undefined":_typeof(newProps))!=="object"||newProps===null){return"new props is not an object"}for(var key in oldProps){if(!(key in ignoreProps)){if(!newProps.hasOwnProperty(key)){return"prop "+key+" dropped: "+oldProps[key]+" -> (undefined)"}else if(oldProps[key]!==newProps[key]){return"prop "+key+" changed: "+oldProps[key]+" -> "+newProps[key]}}}for(var _key in newProps){if(!(_key in ignoreProps)){if(!oldProps.hasOwnProperty(_key)){return"prop "+_key+" added: (undefined) -> "+newProps[_key]}}}return null}function areEqualShallow(a,b){var _ref2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},_ref2$ignore=_ref2.ignore,ignore=_ref2$ignore===undefined?{}:_ref2$ignore;if(a===b){return true}if((typeof a==="undefined"?"undefined":_typeof(a))!=="object"||a===null||(typeof b==="undefined"?"undefined":_typeof(b))!=="object"||b===null){return false}if(Object.keys(a).length!==Object.keys(b).length){return false}for(var key in a){if(!(key in ignore)&&(!(key in b)||a[key]!==b[key])){return false}}for(var _key2 in b){if(!(_key2 in ignore)&&!(_key2 in a)){return false}}return true}},{assert:2}],371:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fp64ify=fp64ify;function fp64ify(a){var hiPart=Math.fround(a);var loPart=a-Math.fround(a);return[hiPart,loPart]}},{}],372:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _objectIterator=require("./object-iterator");Object.keys(_objectIterator).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _objectIterator[key]}})});var _compareObjects=require("./compare-objects");Object.keys(_compareObjects).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _compareObjects[key]}})});var _log=require("./log");Object.defineProperty(exports,"log",{enumerable:true,get:function get(){return _interopRequireDefault(_log).default}});var _fp=require("./fp64");Object.keys(_fp).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _fp[key]}})});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./compare-objects":370,"./fp64":371,"./log":373,"./object-iterator":374}],373:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=log;var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function log(priority){(0,_assert2.default)(Number.isFinite(priority),"log priority must be a number");if(priority<=log.priority){var _console;for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}(_console=console).debug.apply(_console,args)}}var cache={};function once(priority,arg){if(!cache[arg]){for(var _len2=arguments.length,args=Array(_len2>2?_len2-2:0),_key2=2;_key2<_len2;_key2++){args[_key2-2]=arguments[_key2]}log.apply(undefined,[priority,arg].concat(args))}cache[arg]=true}log.priority=0;log.log=log;log.once=once;if(typeof window!=="undefined"){window.deck=window.deck||{log:log}}},{assert:2}],374:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.makeObjectValueIterator=makeObjectValueIterator;exports.addIterator=addIterator;exports.isPlainObject=isPlainObject;var _marked=[makeObjectValueIterator].map(regeneratorRuntime.mark);function makeObjectValueIterator(obj){var key;return regeneratorRuntime.wrap(function makeObjectValueIterator$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.t0=regeneratorRuntime.keys(obj);case 1:if((_context.t1=_context.t0()).done){_context.next=8;break}key=_context.t1.value;if(!obj.hasOwnProperty(key)){_context.next=6;break}_context.next=6;return obj[key];case 6:_context.next=1;break;case 8:case"end":return _context.stop()}}},_marked[0],this)}function addIterator(object){if(isPlainObject(object)&&!object[Symbol.iterator]){object[Symbol.iterator]=function iterator(){return makeObjectValueIterator(object)}}}function isPlainObject(o){return o!==null&&(typeof o==="undefined"?"undefined":_typeof(o))==="object"&&o.constructor===Object}},{}],375:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class,_class2,_temp;var _react=require("react");var _react2=_interopRequireDefault(_react);var _autobindDecorator=require("autobind-decorator");var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);var _webglRenderer=require("./webgl-renderer");var _webglRenderer2=_interopRequireDefault(_webglRenderer);var _lib=require("../lib");var _experimental=require("../experimental");var _luma=require("luma.gl");var _utils=require("../lib/utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}function noop(){}var DeckGL=(_class=(_temp=_class2=function(_React$Component){_inherits(DeckGL,_React$Component);function DeckGL(props){_classCallCheck(this,DeckGL);var _this=_possibleConstructorReturn(this,(DeckGL.__proto__||Object.getPrototypeOf(DeckGL)).call(this,props));_this.state={};_this.needsRedraw=true;_this.layerManager=null;_this.effectManager=null;return _this}_createClass(DeckGL,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){this._updateLayers(nextProps)}},{key:"_updateLayers",value:function _updateLayers(nextProps){var width=nextProps.width,height=nextProps.height,latitude=nextProps.latitude,longitude=nextProps.longitude,zoom=nextProps.zoom,pitch=nextProps.pitch,bearing=nextProps.bearing,altitude=nextProps.altitude;if(this.layerManager){this.layerManager.setContext({width:width,height:height,latitude:latitude,longitude:longitude,zoom:zoom,pitch:pitch,bearing:bearing,altitude:altitude}).updateLayers({newLayers:nextProps.layers})}}},{key:"_onRendererInitialized",value:function _onRendererInitialized(_ref){var gl=_ref.gl,canvas=_ref.canvas;gl.enable(_luma.GL.BLEND);gl.blendFunc(_luma.GL.SRC_ALPHA,_luma.GL.ONE_MINUS_SRC_ALPHA);this.props.onWebGLInitialized(gl);this.layerManager=new _lib.LayerManager({gl:gl});this.effectManager=new _experimental.EffectManager({gl:gl,layerManager:this.layerManager});var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.props.effects[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var effect=_step.value;this.effectManager.addEffect(effect)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this._updateLayers(this.props);var hasEvent=this.props.onLayerClick!==noop||this.props.onLayerHover!==noop;var hasPickableLayer=this.layerManager.layers.map(function(l){return l.props.pickable}).includes(true);if(hasEvent&&!hasPickableLayer){_utils.log.once(0,"You have supplied a mouse event handler but none of your layers got the `pickable` flag.")}this.events=(0,_luma.addEvents)(canvas,{cacheSize:false,cachePosition:false,centerOrigin:false,onClick:this._onClick,onMouseMove:this._onMouseMove})}},{key:"_onClick",value:function _onClick(event){var x=event.x,y=event.y;var selectedInfos=this.layerManager.pickLayer({x:x,y:y,mode:"click"});var firstInfo=selectedInfos.find(function(info){return info.index>=0});this.props.onLayerClick(firstInfo,selectedInfos,event.event)}},{key:"_onMouseMove",value:function _onMouseMove(event){var x=event.x,y=event.y;var selectedInfos=this.layerManager.pickLayer({x:x,y:y,mode:"hover"});var firstInfo=selectedInfos.find(function(info){return info.index>=0});this.props.onLayerHover(firstInfo,selectedInfos,event.event)}},{key:"_onRenderFrame",value:function _onRenderFrame(_ref2){var gl=_ref2.gl;if(!this.layerManager.needsRedraw({clearRedrawFlags:true})){return}gl.clear(_luma.GL.COLOR_BUFFER_BIT|_luma.GL.DEPTH_BUFFER_BIT);this.effectManager.preDraw();this.layerManager.drawLayers();this.effectManager.draw()}},{key:"render",value:function render(){var _props=this.props,width=_props.width,height=_props.height,gl=_props.gl,debug=_props.debug,otherProps=_objectWithoutProperties(_props,["width","height","gl","debug"]);return _react2.default.createElement(_webglRenderer2.default,_extends({},otherProps,{
width:width,height:height,gl:gl,debug:debug,viewport:{x:0,y:0,width:width,height:height},onRendererInitialized:this._onRendererInitialized,onNeedRedraw:this._onNeedRedraw,onRenderFrame:this._onRenderFrame,onMouseMove:this._onMouseMove,onClick:this._onClick}))}}]);return DeckGL}(_react2.default.Component),_class2.propTypes={id:_react.PropTypes.string,width:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,layers:_react.PropTypes.arrayOf(_react.PropTypes.instanceOf(_lib.Layer)).isRequired,effects:_react.PropTypes.arrayOf(_react.PropTypes.instanceOf(_experimental.Effect)),gl:_react.PropTypes.object,debug:_react.PropTypes.bool,onWebGLInitialized:noop,onLayerClick:noop,onLayerHover:noop},_class2.defaultProps={id:"deckgl-overlay",debug:false,gl:null,effects:[],onWebGLInitialized:noop,onLayerClick:noop,onLayerHover:noop},_temp),_applyDecoratedDescriptor(_class.prototype,"_onRendererInitialized",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_onRendererInitialized"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_onClick",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_onClick"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_onMouseMove",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_onMouseMove"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_onRenderFrame",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_onRenderFrame"),_class.prototype),_class);exports.default=DeckGL},{"../experimental":337,"../lib":365,"../lib/utils":372,"./webgl-renderer":376,"autobind-decorator":3,"luma.gl":505,react:948}],376:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class,_class2,_temp;var _react=require("react");var _react2=_interopRequireDefault(_react);var _autobindDecorator=require("autobind-decorator");var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);var _luma=require("luma.gl");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}var DEFAULT_PIXEL_RATIO=typeof window!=="undefined"&&window.devicePixelRatio||1;var WebGLRenderer=(_class=(_temp=_class2=function(_React$Component){_inherits(WebGLRenderer,_React$Component);function WebGLRenderer(props){_classCallCheck(this,WebGLRenderer);var _this=_possibleConstructorReturn(this,(WebGLRenderer.__proto__||Object.getPrototypeOf(WebGLRenderer)).call(this,props));_this.state={};_this._animationFrame=null;_this.gl=null;return _this}_createClass(WebGLRenderer,[{key:"componentDidMount",value:function componentDidMount(){var canvas=this.refs.overlay;this._initWebGL(canvas);this._animationLoop()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._cancelAnimationLoop()}},{key:"_initWebGL",value:function _initWebGL(canvas){var _props=this.props,debug=_props.debug,glOptions=_props.glOptions;var gl=this.props.gl;if(!gl){try{gl=(0,_luma.createGLContext)(_extends({canvas:canvas,debug:debug},glOptions))}catch(error){this.props.onInitializationFailed(error);return}}this.gl=gl;this.props.onRendererInitialized({canvas:canvas,gl:gl})}},{key:"_animationLoop",value:function _animationLoop(){this._renderFrame();if(typeof window!=="undefined"){this._animationFrame=requestAnimationFrame(this._animationLoop)}}},{key:"_cancelAnimationLoop",value:function _cancelAnimationLoop(){if(this._animationFrame){cancelAnimationFrame(this._animationFrame)}}},{key:"_updateGLViewport",value:function _updateGLViewport(){var _props$viewport=this.props.viewport,x=_props$viewport.x,y=_props$viewport.y,w=_props$viewport.width,h=_props$viewport.height;var dpr=this.props.pixelRatio;var gl=this.gl;x=x*dpr;y=y*dpr;w=w*dpr;h=h*dpr;if(x!==this.x||y!==this.y||w!==this.w||h!==this.h){gl.viewport(x,y,w,h);this.x=x;this.y=y;this.w=w;this.h=h}}},{key:"_renderFrame",value:function _renderFrame(){var _props$viewport2=this.props.viewport,width=_props$viewport2.width,height=_props$viewport2.height;var gl=this.gl;if(!gl||!(width>0)||!(height>0)){return}this._updateGLViewport();this.props.onRenderFrame({gl:gl})}},{key:"render",value:function render(){var _props2=this.props,id=_props2.id,width=_props2.width,height=_props2.height,pixelRatio=_props2.pixelRatio,style=_props2.style;return _react2.default.createElement("canvas",{ref:"overlay",key:"overlay",id:id,width:width*pixelRatio,height:height*pixelRatio,style:_extends({},style,{width:width,height:height})})}}]);return WebGLRenderer}(_react2.default.Component),_class2.propTypes={id:_react.PropTypes.string.isRequired,width:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,style:_react.PropTypes.object,pixelRatio:_react.PropTypes.number,viewport:_react.PropTypes.object.isRequired,blending:_react.PropTypes.object,events:_react.PropTypes.object,gl:_react.PropTypes.object,glOptions:_react.PropTypes.object,debug:_react.PropTypes.bool,onRendererInitialized:_react.PropTypes.func.isRequired,onInitializationFailed:_react.PropTypes.func,onError:_react.PropTypes.func,onRenderFrame:_react.PropTypes.func,onMouseMove:_react.PropTypes.func,onClick:_react.PropTypes.func},_class2.defaultProps={style:{},gl:null,glOptions:{preserveDrawingBuffer:true},debug:false,pixelRatio:DEFAULT_PIXEL_RATIO,onRendererInitialized:function onRendererInitialized(){},onInitializationFailed:function onInitializationFailed(error){throw error},onError:function onError(error){throw error},onRenderFrame:function onRenderFrame(){}},_temp),_applyDecoratedDescriptor(_class.prototype,"_animationLoop",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_animationLoop"),_class.prototype),_class);exports.default=WebGLRenderer},{"autobind-decorator":3,"luma.gl":505,react:948}],377:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.checkRendererVendor=checkRendererVendor;exports.getPlatformShaderDefines=getPlatformShaderDefines;exports.assembleShaders=assembleShaders;var _luma=require("luma.gl");var _shaderChunks=require("./shader-chunks");var _shaderChunks2=_interopRequireDefault(_shaderChunks);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function checkRendererVendor(debugInfo,gpuVendor){var vendor=debugInfo.vendor,renderer=debugInfo.renderer;var result=void 0;switch(gpuVendor){case"nvidia":result=vendor.match(/NVIDIA/i)||renderer.match(/NVIDIA/i);break;case"intel":result=vendor.match(/INTEL/i)||renderer.match(/INTEL/i);break;case"amd":result=vendor.match(/AMD/i)||renderer.match(/AMD/i)||vendor.match(/ATI/i)||renderer.match(/ATI/i);break;default:result=false}return result}function getPlatformShaderDefines(gl){var platformDefines="";var debugInfo=(0,_luma.glGetDebugInfo)(gl);if(checkRendererVendor(debugInfo,"nvidia")){platformDefines+="#define NVIDIA_GPU\n#define NVIDIA_FP64_WORKAROUND 1\n#define NVIDIA_EQUATION_WORKAROUND 1\n"}else if(checkRendererVendor(debugInfo,"intel")){platformDefines+="#define INTEL_GPU\n#define INTEL_FP64_WORKAROUND 1\n#define NVIDIA_EQUATION_WORKAROUND 1\n #define INTEL_TAN_WORKAROUND 1\n"}else if(checkRendererVendor(debugInfo,"amd")){platformDefines+="#define AMD_GPU\n"}else{platformDefines+="#define DEFAULT_GPU\n"}return platformDefines}function assembleShader(gl,_ref){var vs=_ref.vs,fs=_ref.fs,_ref$fp=_ref.fp64,fp64=_ref$fp===undefined?false:_ref$fp,_ref$project=_ref.project,project=_ref$project===undefined?true:_ref$project,_ref$project2=_ref.project64,project64=_ref$project2===undefined?false:_ref$project2,opts=_objectWithoutProperties(_ref,["vs","fs","fp64","project","project64"]);if(project64===true){fp64=true}var source=getPlatformShaderDefines(gl)+"\n";opts=_extends({},opts,{project:project,project64:project64,fp64:fp64});var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Object.keys(_shaderChunks2.default)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var chunkName=_step.value;if(opts[chunkName]){source+=_shaderChunks2.default[chunkName].source+"\n"}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}source+=vs;return source}function assembleShaders(gl,_ref2){var vs=_ref2.vs,fs=_ref2.fs,opts=_objectWithoutProperties(_ref2,["vs","fs"]);return{gl:gl,vs:assembleShader(gl,_extends({},opts,{vs:vs})),fs:fs}}},{"./shader-chunks":379,"luma.gl":505}],378:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assembleShaders=require("./assemble-shaders");Object.keys(_assembleShaders).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _assembleShaders[key]}})})},{"./assemble-shaders":377}],379:[function(require,module,exports){"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _fp=require("../../dist/shaderlib/fp64");var _fp2=_interopRequireDefault(_fp);var _project=require("../../dist/shaderlib/project");var _project2=_interopRequireDefault(_project);var _project3=require("../../dist/shaderlib/project64");var _project4=_interopRequireDefault(_project3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports=_extends({},_fp2.default,_project2.default,_project4.default)},{"../../dist/shaderlib/fp64":380,"../../dist/shaderlib/project":381,"../../dist/shaderlib/project64":382}],380:[function(require,module,exports){"use strict";module.exports={fp64:{interface:"fp64",source:"// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nuniform float ONE;\n\nconst vec2 E_FP64 = vec2(2.7182817459106445e+00, 8.254840366817007e-08);\nconst vec2 LOG2_FP64 = vec2(0.6931471824645996e+00, -1.9046542121259336e-09);\nconst vec2 PI_FP64 = vec2(3.1415927410125732, -8.742278012618954e-8);\nconst vec2 TWO_PI_FP64 = vec2(6.2831854820251465, -1.7484556025237907e-7);\nconst vec2 PI_2_FP64 = vec2(1.5707963705062866, -4.371139006309477e-8);\nconst vec2 PI_4_FP64 = vec2(0.7853981852531433, -2.1855695031547384e-8);\nconst vec2 PI_16_FP64 = vec2(0.19634954631328583, -5.463923757886846e-9);\nconst vec2 PI_16_2_FP64 = vec2(0.39269909262657166, -1.0927847515773692e-8);\nconst vec2 PI_16_3_FP64 = vec2(0.5890486240386963, -1.4906100798128818e-9);\n\nconst vec2 SIN_TABLE_0_FP64 = vec2(0.19509032368659973, -1.6704714833615242e-9);\nconst vec2 SIN_TABLE_1_FP64 = vec2(0.3826834261417389, 6.22335089017767e-9);\nconst vec2 SIN_TABLE_2_FP64 = vec2(0.5555702447891235, -1.1769521357507529e-8);\nconst vec2 SIN_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617041793133e-8);\n\nconst vec2 COS_TABLE_0_FP64 = vec2(0.9807852506637573, 2.9739473106360492e-8);\nconst vec2 COS_TABLE_1_FP64 = vec2(0.9238795042037964, 2.8307490351764386e-8);\nconst vec2 COS_TABLE_2_FP64 = vec2(0.8314695954322815, 1.6870263741530778e-8);\nconst vec2 COS_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617152815436e-8);\n\nconst vec2 INVERSE_FACTORIAL_3_FP64 = vec2(1.666666716337204e-01, -4.967053879312289e-09); // 1/3!\nconst vec2 INVERSE_FACTORIAL_4_FP64 = vec2(4.16666679084301e-02, -1.2417634698280722e-09); // 1/4!\nconst vec2 INVERSE_FACTORIAL_5_FP64 = vec2(8.333333767950535e-03, -4.34617203337595e-10); // 1/5!\nconst vec2 INVERSE_FACTORIAL_6_FP64 = vec2(1.3888889225199819e-03, -3.3631094437103215e-11); // 1/6!\nconst vec2 INVERSE_FACTORIAL_7_FP64 = vec2(1.9841270113829523e-04,  -2.725596874933456e-12); // 1/7!\nconst vec2 INVERSE_FACTORIAL_8_FP64 = vec2(2.4801587642286904e-05, -3.406996025904184e-13); // 1/8!\nconst vec2 INVERSE_FACTORIAL_9_FP64 = vec2(2.75573188446287533e-06, 3.7935713937038186e-14); // 1/9!\nconst vec2 INVERSE_FACTORIAL_10_FP64 = vec2(2.755731998149713e-07, -7.575112367869873e-15); // 1/10!\n\nfloat nint(float d) {\n    if (d == floor(d)) return d;\n    return floor(d + 0.5);\n}\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n  float a_hi = t * ONE - (t - a);\n  float a_lo = a * ONE - a_hi;\n  return vec2(a_hi, a_lo);\n}\n#else\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n  return vec2(a_hi, a_lo);\n}\n#endif\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\nvec2 quickTwoSum(float a, float b) {\n  float sum = (a + b) * ONE;\n  float err = b - (sum - a) * ONE;\n  return vec2(sum, err);\n}\n#else\nvec2 quickTwoSum(float a, float b) {\n  float sum = a + b;\n  float err = b - (sum - a);\n  return vec2(sum, err);\n}\n#endif\n\nvec2 nint_fp64(vec2 a) {\n    float hi = nint(a.x);\n    float lo;\n    vec2 tmp;\n    if (hi == a.x) {\n        lo = nint(a.y);\n        tmp = quickTwoSum(hi, lo);\n    } else {\n        lo = 0.0;\n        if (abs(hi - a.x) == 0.5 && a.y < 0.0) {\n            hi -= 1.0;\n        }\n        tmp = vec2(hi, lo);\n    }\n    return tmp;\n}\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\n\n/* The purpose of this workaround is to prevent compilers from\noptimizing away necessary arithmetic operations by swapping their sequences\nor transform the equation to some 'equivalent' from.\n\nThe method is to multiply an artifical variable, ONE, which will be known to\nthe compiler to be one only at the runtime. The whole expression is then represented\nas a polynomial with respective to ONE. In the coefficients of all terms, only one a\nand one b should appear\n\nerr = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE\n*/\n\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);\n  return vec2(s, err);\n}\n#else\nvec2 twoSum(float a, float b) {\n  float s = a + b;\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n  return vec2(s, err);\n}\n#endif\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\n/* Same thing as in twoSum() */\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);\n  return vec2(s, err);\n}\n#else\nvec2 twoSub(float a, float b) {\n  float s = a - b;\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n  return vec2(s, err);\n}\n#endif\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n\n  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x * a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;\n  return vec2(prod, err);\n}\n#else\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n  return vec2(prod, err);\n}\n#endif\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  // y component is for the error\n  prod.y += a.x * b.y;\n  prod.y += a.y * b.x;\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n  vec2 yn = a * xn;\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n  return sum_fp64(vec2(yn, 0.0), prod);\n}\n\n/* k_power controls how much range reduction we would like to have\nRange reduction uses the following method:\nassume a = k_power * r + m * log(2), k and m being integers.\nSet k_power = 4 (we can choose other k to trade accuracy with performance.\nwe only need to calculate exp(r) and using exp(a) = 2^m * exp(r)^k_power;\n*/\n\nvec2 exp_fp64(vec2 a) {\n  // We need to make sure these two numbers match\n  // as bit-wise shift is not available in GLSL 1.0\n  const int k_power = 4;\n  const float k = 16.0;\n\n  const float inv_k = 1.0 / k;\n\n  if (a.x <= -88.0) return vec2(0.0, 0.0);\n  if (a.x >= 88.0) return vec2(1.0 / 0.0, 1.0 / 0.0);\n  if (a.x == 0.0 && a.y == 0.0) return vec2(1.0, 0.0);\n  if (a.x == 1.0 && a.y == 0.0) return E_FP64;\n\n  float m = floor(a.x / LOG2_FP64.x + 0.5);\n  vec2 r = sub_fp64(a, mul_fp64(LOG2_FP64, vec2(m, 0.0))) * inv_k;\n  vec2 s, t, p;\n\n  p = mul_fp64(r, r);\n  s = sum_fp64(r, p * 0.5);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_3_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_4_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_5_FP64);\n\n  // s = sum_fp64(s, t);\n  // p = mul_fp64(p, r);\n  // t = mul_fp64(p, INVERSE_FACTORIAL_6_FP64);\n\n  // s = sum_fp64(s, t);\n  // p = mul_fp64(p, r);\n  // t = mul_fp64(p, INVERSE_FACTORIAL_7_FP64);\n\n  s = sum_fp64(s, t);\n\n\n  // At this point, s = exp(r) - 1; but after following 4 recursions, we will get exp(r) ^ 512 - 1.\n  for (int i = 0; i < k_power; i++) {\n    s = sum_fp64(s * 2.0, mul_fp64(s, s));\n  }\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = sum_fp64(s, vec2(ONE, 0.0));\n#else\n  s = sum_fp64(s, vec2(1.0, 0.0));\n#endif\n\n  return s * pow(2.0, m);\n//   return r;\n}\n\nvec2 log_fp64(vec2 a)\n{\n  if (a.x == 1.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x <= 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n  vec2 x = vec2(log(a.x), 0.0);\n  vec2 s;\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = vec2(ONE, 0.0);\n#else\n  s = vec2(1.0, 0.0);\n#endif\n\n  x = sub_fp64(sum_fp64(x, mul_fp64(a, exp_fp64(-x))), s);\n  return x;\n}\n\nvec2 sin_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(0.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  s = a;\n  r = a;\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_3_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_5_FP64);\n  s = sum_fp64(s, t);\n\n  /* keep the following commented code in case we need them\n  for extra accuracy from the Taylor expansion*/\n  // r = mul_fp64(r, x);\n  // t = mul_fp64(r, INVERSE_FACTORIAL_7_FP64);\n  // s = sum_fp64(s, t);\n\n  // r = mul_fp64(r, x);\n  // t = mul_fp64(r, INVERSE_FACTORIAL_9_FP64);\n  // s = sum_fp64(s, t);\n\n  return s;\n}\n\nvec2 cos_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(1.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  r = x;\n  s = sum_fp64(vec2(1.0, 0.0), r * 0.5);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_4_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_6_FP64);\n  s = sum_fp64(s, t);\n\n  /* keep the following commented code in case we need them\n  for extra accuracy from the Taylor expansion*/\n  // r = mul_fp64(r, x);\n  // t = mul_fp64(r, INVERSE_FACTORIAL_8_FP64);\n  // s = sum_fp64(s, t);\n\n  // r = mul_fp64(r, x);\n  // t = mul_fp64(r, INVERSE_FACTORIAL_10_FP64);\n  // s = sum_fp64(s, t);\n\n  return s;\n}\n\nvoid sincos_taylor_fp64(vec2 a, out vec2 sin_t, out vec2 cos_t) {\n  if (a.x == 0.0 && a.y == 0.0) {\n    sin_t = vec2(0.0, 0.0);\n    cos_t = vec2(1.0, 0.0);\n  }\n\n  sin_t = sin_taylor_fp64(a);\n  cos_t = sqrt_fp64(sub_fp64(vec2(1.0, 0.0), mul_fp64(sin_t, sin_t)));\n}\n\nvec2 sin_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n\n    // 2pi range reduction\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return sin_taylor_fp64(t);\n        } else if (j == 1) {\n            return cos_taylor_fp64(t);\n        } else if (j == -1) {\n            return -cos_taylor_fp64(t);\n        } else {\n            return -sin_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else if (k == 3) {\n        t = sub_fp64(t, PI_16_3_FP64);\n    } else if (k == -3) {\n        t = sum_fp64(t, PI_16_3_FP64);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 cos_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(1.0, 0.0);\n    }\n\n    // 2pi range reduction\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return cos_taylor_fp64(t);\n        } else if (j == 1) {\n            return -sin_taylor_fp64(t);\n        } else if (j == -1) {\n            return sin_taylor_fp64(t);\n        } else {\n            return -cos_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else if (k == 3) {\n        t = sub_fp64(t, PI_16_3_FP64);\n    } else if (k == -3) {\n        t = sum_fp64(t, PI_16_3_FP64);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 tan_fp64(vec2 a) {\n    vec2 sin_a;\n    vec2 cos_a;\n\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n\n    // 2pi range reduction\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    // We just can't get PI/16 * 3.0 very accurately.\n    // so let's just store it\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else if (k == 3) {\n        t = sub_fp64(t, PI_16_3_FP64);\n    } else if (k == -3) {\n        t = sum_fp64(t, PI_16_3_FP64);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n    vec2 sin_t, cos_t;\n    vec2 s, c;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#else\n        if (abs_k == 1) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs_k == 2) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs_k == 3) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs_k == 4) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#endif\n        if (k > 0) {\n            s = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            s = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return div_fp64(sin_a, cos_a);\n}\n\nvec2 radians_fp64(vec2 degree) {\n  return div_fp64(mul_fp64(degree, PI_FP64), vec2(180.0, 0.0));\n}\n\n// Vector functions\n// vec2 functions\nvoid vec2_sum_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sum_fp64(a[0], b[0]);\n    out_val[1] = sum_fp64(a[1], b[1]);\n}\n\nvoid vec2_sub_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sub_fp64(a[0], b[0]);\n    out_val[1] = sub_fp64(a[1], b[1]);\n}\n\nvoid vec2_mix_fp64(vec2 x[2], vec2 y[2], float a, out vec2 out_val[2]) {\n  vec2 range[2];\n  vec2_sub_fp64(y, x, range);\n  vec2 portion[2];\n  portion[0] = range[0] * a;\n  portion[1] = range[1] * a;\n  vec2_sum_fp64(x, portion, out_val);\n}\n\nvec2 vec2_length_fp64(vec2 x[2]) {\n  return sqrt_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])));\n}\n\nvec2 vec2_distance_fp64(vec2 x[2], vec2 y[2]) {\n  vec2 diff[2];\n  vec2_sub_fp64(x, y, diff);\n  return vec2_length_fp64(diff);\n}\n\n// vec3 functions\nvoid vec3_sub_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec3_sum_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvec2 vec3_length_fp64(vec2 x[3]) {\n  return sqrt_fp64(sum_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])), mul_fp64(x[2], x[2])));\n}\n\nvec2 vec3_distance_fp64(vec2 x[3], vec2 y[3]) {\n  vec2 diff[3];\n  vec3_sub_fp64(x, y, diff);\n  return vec3_length_fp64(diff);\n}\n\n// vec4 functions\nvoid vec4_fp64(vec4 a, out vec2 out_val[4]) {\n  out_val[0].x = a[0];\n  out_val[0].y = 0.0;\n\n  out_val[1].x = a[1];\n  out_val[1].y = 0.0;\n\n  out_val[2].x = a[2];\n  out_val[2].y = 0.0;\n\n  out_val[3].x = a[3];\n  out_val[3].y = 0.0;\n}\n\nvoid vec4_scalar_mul_fp64(vec2 a[4], vec2 b, out vec2 out_val[4]) {\n  out_val[0] = mul_fp64(a[0], b);\n  out_val[1] = mul_fp64(a[1], b);\n  out_val[2] = mul_fp64(a[2], b);\n  out_val[3] = mul_fp64(a[3], b);\n}\n\nvoid vec4_sum_fp64(vec2 a[4], vec2 b[4], out vec2 out_val[4]) {\n  for (int i = 0; i < 4; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec4_dot_fp64(vec2 a[4], vec2 b[4], out vec2 out_val) {\n  vec2 v[4];\n\n  v[0] = mul_fp64(a[0], b[0]);\n  v[1] = mul_fp64(a[1], b[1]);\n  v[2] = mul_fp64(a[2], b[2]);\n  v[3] = mul_fp64(a[3], b[3]);\n\n  out_val = sum_fp64(sum_fp64(v[0], v[1]), sum_fp64(v[2], v[3]));\n}\n\nvoid mat4_vec4_mul_fp64(vec2 b[16], vec2 a[4], out vec2 out_val[4]) {\n  vec2 tmp[4];\n\n  for (int i = 0; i < 4; i++)\n  {\n    for (int j = 0; j < 4; j++)\n    {\n      tmp[j] = b[j + i * 4];\n    }\n    vec4_dot_fp64(a, tmp, out_val[i]);\n  }\n}\n"
}}},{}],381:[function(require,module,exports){"use strict";module.exports={project:{interface:"project",source:"const float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\n\nconst float PROJECT_LINEAR = 0.;\nconst float PROJECT_MERCATOR = 1.;\nconst float PROJECT_MERCATOR_OFFSETS = 2.;\n\nuniform float projectionMode;\nuniform float projectionScale;\nuniform vec4 projectionCenter;\nuniform vec3 projectionPixelsPerUnit;\nuniform mat4 projectionMatrix;\nuniform mat4 projectionMatrixUncentered;\n\n#ifdef INTEL_TAN_WORKAROUND\n\n// All these functions are for substituting tan() function from Intel GPU only\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n\n    // 2pi range reduction\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 0.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 0.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\n//\n// Scaling offsets\n//\n\nfloat project_scale(float meters) {\n  return meters * projectionPixelsPerUnit.x;\n}\n\nvec2 project_scale(vec2 meters) {\n  return vec2(\n    meters.x * projectionPixelsPerUnit.x,\n    meters.y * projectionPixelsPerUnit.x\n  );\n}\n\nvec3 project_scale(vec3 meters) {\n  return vec3(\n    meters.x * projectionPixelsPerUnit.x,\n    meters.y * projectionPixelsPerUnit.x,\n    meters.z * projectionPixelsPerUnit.x\n  );\n}\n\nvec4 project_scale(vec4 meters) {\n  return vec4(\n    meters.x * projectionPixelsPerUnit.x,\n    meters.y * projectionPixelsPerUnit.x,\n    meters.z * projectionPixelsPerUnit.x,\n    meters.w\n  );\n}\n\n//\n// Projecting positions\n//\n\n// non-linear projection: lnglats => unit tile [0-1, 0-1]\nvec2 project_mercator_(vec2 lnglat) {\n  return vec2(\n    radians(lnglat.x) + PI,\n#ifdef INTEL_TAN_WORKAROUND\n        PI - log(tan_fp32(PI * 0.25 + radians(lnglat.y) * 0.5))\n#else\n        PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n#endif\n  );\n}\n\nvec2 project_position(vec2 position) {\n  if (projectionMode == PROJECT_LINEAR) {\n    return (position + vec2(TILE_SIZE / 2.0)) * projectionScale;\n  }\n  if (projectionMode == PROJECT_MERCATOR_OFFSETS) {\n    return project_scale(position);\n  }\n  // Covers projectionMode == PROJECT_MERCATOR\n  return project_mercator_(position) * WORLD_SCALE * projectionScale;\n}\n\nvec3 project_position(vec3 position) {\n  return vec3(project_position(position.xy), project_scale(position.z) + .1);\n}\n\nvec4 project_position(vec4 position) {\n  return vec4(project_position(position.xyz), position.w);\n}\n\n//\n\nvec4 project_to_clipspace(vec4 position) {\n  if (projectionMode == PROJECT_MERCATOR_OFFSETS) {\n    return projectionMatrix * vec4(position.xyz, 0.0) + projectionCenter;\n  }\n  return projectionMatrix * position;\n}\n\n// Backwards compatibility\n\nfloat scale(float position) {\n  return project_scale(position);\n}\n\nvec2 scale(vec2 position) {\n  return project_scale(position);\n}\n\nvec3 scale(vec3 position) {\n  return project_scale(position);\n}\n\nvec4 scale(vec4 position) {\n  return project_scale(position);\n}\n\nvec2 preproject(vec2 position) {\n  return project_position(position);\n}\n\nvec3 preproject(vec3 position) {\n  return project_position(position);\n}\n\nvec4 preproject(vec4 position) {\n  return project_position(position);\n}\n\nvec4 project(vec4 position) {\n  return project_to_clipspace(position);\n}\n"}}},{}],382:[function(require,module,exports){"use strict";module.exports={project64:{interface:"project64",source:"const vec2 WORLD_SCALE_FP64 = vec2(81.4873275756836, 0.0000032873668232014097);\n\nuniform vec2 projectionScaleFP64;\nuniform vec2 projectionFP64[16];\n\nvoid mercatorProject_fp64(vec4 lnglat_fp64, out vec2 out_val[2]) { //longitude: lnglat_fp64.xy; latitude: lnglat_fp64.zw\n\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64);\n  out_val[1] = sub_fp64(PI_FP64, log_fp64(tan_fp64(sum_fp64(PI_4_FP64, radians_fp64(lnglat_fp64.zw) / 2.0))));\n  return;\n}\n\nvoid project_position_fp64(vec4 position_fp64, out vec2 out_val[2]) {\n\n  vec2 pos_fp64[2];\n  mercatorProject_fp64(position_fp64, pos_fp64);\n  vec2 x_fp64 = mul_fp64(pos_fp64[0], projectionScaleFP64);\n  vec2 y_fp64 = mul_fp64(pos_fp64[1], projectionScaleFP64);\n  out_val[0] = mul_fp64(x_fp64, WORLD_SCALE_FP64);\n  out_val[1] = mul_fp64(y_fp64, WORLD_SCALE_FP64);\n\n  return;\n}\n\nvec4 project_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {\n  vec2 vertex_pos_clipspace[4];\n  mat4_vec4_mul_fp64(projectionFP64, vertex_pos_modelspace, vertex_pos_clipspace);\n  return vec4(\n    vertex_pos_clipspace[0].x,\n    vertex_pos_clipspace[1].x,\n    vertex_pos_clipspace[2].x,\n    vertex_pos_clipspace[3].x\n    );\n}\n"}}},{}],383:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _viewport=require("./viewport");Object.keys(_viewport).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _viewport[key]}})});Object.defineProperty(exports,"Viewport",{enumerable:true,get:function get(){return _interopRequireDefault(_viewport).default}});Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_viewport).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./viewport":384}],384:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.COORDINATE_SYSTEM=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class;var _perspective=require("viewport-mercator-project/perspective");Object.defineProperty(exports,"COORDINATE_SYSTEM",{enumerable:true,get:function get(){return _perspective.COORDINATE_SYSTEM}});var _perspective2=_interopRequireDefault(_perspective);var _autobindDecorator=require("autobind-decorator");var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);var _glMatrix=require("gl-matrix");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}function fp64ify(a){var hiPart=Math.fround(a);var loPart=a-Math.fround(a);return[hiPart,loPart]}var WebGLViewport=(_class=function(_Viewport){_inherits(WebGLViewport,_Viewport);function WebGLViewport(options){_classCallCheck(this,WebGLViewport);var _this=_possibleConstructorReturn(this,(WebGLViewport.__proto__||Object.getPrototypeOf(WebGLViewport)).call(this,options));_this._calculateWebGLMatrices();return _this}_createClass(WebGLViewport,[{key:"getProjectionMatrix",value:function getProjectionMatrix(){return this.glProjectionMatrix}},{key:"getProjectionMatrixFP64",value:function getProjectionMatrixFP64(){return this.glProjectionMatrixFP64}},{key:"getProjectionMatrixUncentered",value:function getProjectionMatrixUncentered(){return this.glProjectionMatrixUncentered}},{key:"getWebGLMatrices",value:function getWebGLMatrices(){return{projectionMatrix:this.glProjectionMatrix,projectionFP64:this.glProjectionMatrixFP64}}},{key:"getUniforms",value:function getUniforms(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$projectionMode=_ref.projectionMode,projectionMode=_ref$projectionMode===undefined?_perspective.COORDINATE_SYSTEM.LNGLAT:_ref$projectionMode,_ref$positionOrigin=_ref.positionOrigin,positionOrigin=_ref$positionOrigin===undefined?[0,0]:_ref$positionOrigin,_ref$modelMatrix=_ref.modelMatrix,modelMatrix=_ref$modelMatrix===undefined?null:_ref$modelMatrix;var positionOriginPixels=this.projectFlat(positionOrigin);var projectedPositionOrigin=[positionOriginPixels[0],positionOriginPixels[1],0,1];var projections=this.getProjections();var viewProjectionMatrix=projections.viewProjectionMatrix;var projectionCenter=_glMatrix.vec4.transformMat4([],projectedPositionOrigin,viewProjectionMatrix);if(modelMatrix){_glMatrix.mat4.multiply(viewProjectionMatrix,viewProjectionMatrix,modelMatrix)}return{projectionMode:projectionMode,projectionCenter:projectionCenter,projectionMatrix:this.glProjectionMatrix,projectionFP64:this.glProjectionMatrixFP64,projectionPixelsPerUnit:this.pixelsPerMeter,projectionScale:this.scale,projectionScaleFP64:fp64ify(this.scale),mercatorScale:Math.pow(2,this.zoom),mercatorCenter:this.center}}},{key:"_calculateWebGLMatrices",value:function _calculateWebGLMatrices(){this.glProjectionMatrix=new Float32Array(this.viewProjectionMatrix);this.glProjectionMatrixFP64=new Float32Array(32);this._dy64ifyProjectionMatrix()}},{key:"_dy64ifyProjectionMatrix",value:function _dy64ifyProjectionMatrix(){for(var i=0;i<4;++i){for(var j=0;j<4;++j){var _fp64ify=fp64ify(this.viewProjectionMatrix[j*4+i]);var _fp64ify2=_slicedToArray(_fp64ify,2);this.glProjectionMatrixFP64[(i*4+j)*2]=_fp64ify2[0];this.glProjectionMatrixFP64[(i*4+j)*2+1]=_fp64ify2[1]}}}}]);return WebGLViewport}(_perspective2.default),_applyDecoratedDescriptor(_class.prototype,"getProjectionMatrix",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"getProjectionMatrix"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"getProjectionMatrixFP64",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"getProjectionMatrixFP64"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"getProjectionMatrixUncentered",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"getProjectionMatrixUncentered"),_class.prototype),_class);exports.default=WebGLViewport},{"autobind-decorator":3,"gl-matrix":438,"viewport-mercator-project/perspective":1002}],385:[function(require,module,exports){module.exports=require("./dist/index")},{"./dist/index":341}],386:[function(require,module,exports){module.exports={_args:[[{raw:"deck.gl@^3.1.2",scope:null,escapedName:"deck.gl",name:"deck.gl",rawSpec:"^3.1.2",spec:">=3.1.2 <4.0.0",type:"range"},"/home/khome/dev/map-test"]],_from:"deck.gl@>=3.1.2 <4.0.0",_id:"deck.gl@3.1.2",_inCache:true,_location:"/deck.gl",_nodeVersion:"6.5.0",_npmOperationalInternal:{host:"packages-18-east.internal.npmjs.com",tmp:"tmp/deck.gl-3.1.2.tgz_1484866437354_0.2929714755155146"},_npmUser:{name:"shaojingli",email:"lishaojing@gmail.com"},_npmVersion:"3.10.3",_phantomChildren:{},_requested:{raw:"deck.gl@^3.1.2",scope:null,escapedName:"deck.gl",name:"deck.gl",rawSpec:"^3.1.2",spec:">=3.1.2 <4.0.0",type:"range"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/deck.gl/-/deck.gl-3.1.2.tgz",_shasum:"18bc11946a336f2d0c8a47643a04df093651b386",_shrinkwrap:null,_spec:"deck.gl@^3.1.2",_where:"/home/khome/dev/map-test",bugs:{url:"https://github.com/uber/deck.gl/issues"},dependencies:{"autobind-decorator":"^1.3.3","babel-polyfill":"^6.1.19",earcut:"^2.0.6","extrude-polyline":"^1.0.6","geojson-normalize":"0.0.1","get-pixels":"^3.3.0","gl-matrix":"^2.3.2","lodash.flattendeep":"^4.4.0","save-pixels":"^2.3.0","viewport-mercator-project":"3.0.0-beta3"},description:"A suite of 3D-enabled data visualization overlays, suitable for react-map-gl",devDependencies:{"babel-cli":"^6.3.15","babel-core":"^6.7.7","babel-eslint":"^6.0.0","babel-plugin-static-fs":"^1.1.0","babel-plugin-transform-decorators-legacy":"^1.3.4","babel-preset-es2015":"^6.3.13","babel-preset-react":"^6.3.13","babel-preset-stage-2":"^6.3.13","babel-runtime":"^6.11.6",babelify:"^7.2.0","brfs-babel":"^1.0.0",browserify:"^13.0.0",budo:"^9.0.0","d3-color":"^1.0.1","d3-request":"^1.0.2","d3-scale":"^1.0.3",discify:"^1.2.0",electron:"^1.4.7",envify:"^3.4.0",eslint:"^2.0.0","eslint-config-uber-es2015":"^2.0.0","eslint-config-uber-jsx":"^2.0.0","eslint-plugin-react":"^6.0.0",faucet:"0.0.1",gl:"^4.0.1","highlight.js":"^9.7.0",immutable:"^3.7.5","luma.gl":"^2.10.3",marked:"^0.3.6",react:"^15.3.2","react-addons-test-utils":"^15.0.2","react-dom":"^15.3.2","react-map-gl":"^1.7.2","react-redux":"^4.4.5","react-router":"^2.8.1","react-stats":"0.0.5",redux:"^3.6.0","redux-thunk":"^2.1.0",sassify:"^2.0.0","stats.js":"^0.17.0","tap-browser-color":"^0.1.2",tape:"^4.6.0","tape-catch":"^1.0.4",testron:"^1.2.0","tween.js":"^16.3.5","uglify-js":"^2.6.1"},directories:{},dist:{shasum:"18bc11946a336f2d0c8a47643a04df093651b386",tarball:"https://registry.npmjs.org/deck.gl/-/deck.gl-3.1.2.tgz"},files:["dist","shaderlib","src","index.js","react.js","viewport.js","samples.js","experimental.js"],gitHead:"7df3e282ee76af7ef622819e424f7ef0540f0332",homepage:"https://github.com/uber/deck.gl#readme",keywords:["webgl","visualization","overlay","layer"],license:"MIT",main:"index.js",maintainers:[{name:"apercu",email:"bgronon@gmail.com"},{name:"gnavvy",email:"gnavvy@gmail.com"},{name:"heshan0131",email:"heshan0131@gmail.com"},{name:"ibgreen",email:"ib.green.home@gmail.com"},{name:"pessimistress",email:"cxiaoji@gmail.com"},{name:"shaojingli",email:"lishaojing@gmail.com"}],name:"deck.gl",optionalDependencies:{},peerDependencies:{react:"0.14.x - 15.x","react-dom":"0.14.x - 15.x","luma.gl":"^2.10.3"},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+https://github.com/uber/deck.gl.git"},scripts:{build:"npm run build-dist && npm run build-script","build-clean":"rm -fr dist/*","build-dist":"npm run build-clean && npm run build-src && npm run build-shaderlib","build-script":"browserify src/bundle.js -t babelify -t brfs-babel | uglifyjs > dist/deckgl.min.js","build-shaderlib":"babel shaderlib -d dist/shaderlib --source-maps inline --copy-files","build-shaderlib-watch":"babel shaderlib -d dist/shaderlib --source-maps inline --copy-files --watch &","build-src":"babel src -d dist --source-maps inline --copy-files","build-src-watch":"babel src -d dist --source-maps inline --copy-files --watch &","build-watch":"npm run build-clean && npm run build-src-watch && npm run build-shaderlib-watch","demo-build":"npm run demo-build-clean && npm run demo-build-copy && npm run demo-build-script","demo-build-clean":"rm -fr dist-demo && mkdir -p dist-demo","demo-build-copy":" mkdir -p dist-demo/docs && cp -R demo/src/static/* dist-demo/ && cp -R docs dist-demo","demo-build-script":"NODE_ENV=production browserify demo/src/javascripts/main.js -o -t babelify -t sassify -t brfs-babel | uglifyjs > dist-demo/main.min.js","demo-gh-pages":"git subtree push --prefix dist-demo origin gh-pages","demo-gh-pages-force":"git push origin `git subtree split --prefix dist-demo master`:gh-pages --force","demo-publish":"npm run build && npm run demo-build && git add dist-demo -f && git commit -m 'UPDATE DOCS' --no-verify && npm run demo-gh-pages","demo-publish-force":"npm run build && npm run demo-build && git add dist-demo -f && git commit -m 'UPDATE DOCS' --no-verify && npm run demo-gh-pages-force","demo-start":"npm run demo-build-copy && budo demo/src/javascripts/main.js:main.min.js --dir dist-demo/ --open -- -t babelify -t sassify -t brfs-babel",lint:"eslint src exhibits/app.js",mypublish:"npm run build && npm run test-fast && npm publish",precommit:"npm test","profile-disc":"browserify src/bundle.js --full-paths -t babelify -t brfs-babel | uglifyjs | discify --open",start:"npm run build-watch && budo example/main.js:example/bundle.js --live --open --port 3000 --css example/main.css --title 'deck.gl' --watch-glob '**/*.{html,css,js,glsl}' -- -t brfs-babel -t babelify -t envify",test:"npm run lint && npm run build-dist && npm run test-headless","test-browser":"budo src/test/browser.js:build/test-bundle.js --dir test --live --open --port 3001 --watch-glob '**/*.{html,css,scss,js,glsl}' -- -t babelify -t brfs-babel","test-electron":"browserify dist/test/electron.js | testron | faucet","test-fast":"npm run lint && npm run test-headless","test-headless":"node dist/test/headless.js","test-headless-src":"babel-node --only=deck.gl/test,deck.gl/src,deck.gl/shaderlib src/test/headless.js","test-shader":"npm run build-dist && budo src/test/shader.js:build/test-bundle.js --dir test --live --open --port 3001 --watch-glob '**/*.{html,css,scss,js,glsl}' -- -t babelify -t brfs-babel"},version:"3.1.2"}},{}],387:[function(require,module,exports){module.exports=require("./dist/react/deckgl")},{"./dist/react/deckgl":375}],388:[function(require,module,exports){"use strict";module.exports=earcut;function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,true),triangles=[];if(!outerNode)return triangles;var minX,minY,maxX,maxY,x,y,size;if(hasHoles)outerNode=eliminateHoles(data,holeIndices,outerNode,dim);if(data.length>80*dim){minX=maxX=data[0];minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim){x=data[i];y=data[i+1];if(x<minX)minX=x;if(y<minY)minY=y;if(x>maxX)maxX=x;if(y>maxY)maxY=y}size=Math.max(maxX-minX,maxY-minY)}earcutLinked(outerNode,triangles,dim,minX,minY,size);return triangles}function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0){for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last)}else{for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last)}if(last&&equals(last,last.next)){removeNode(last);last=last.next}return last}function filterPoints(start,end){if(!start)return start;if(!end)end=start;var p=start,again;do{again=false;if(!p.steiner&&(equals(p,p.next)||area(p.prev,p,p.next)===0)){removeNode(p);p=end=p.prev;if(p===p.next)return null;again=true}else{p=p.next}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,size,pass){if(!ear)return;if(!pass&&size)indexCurve(ear,minX,minY,size);var stop=ear,prev,next;while(ear.prev!==ear.next){prev=ear.prev;next=ear.next;if(size?isEarHashed(ear,minX,minY,size):isEar(ear)){triangles.push(prev.i/dim);triangles.push(ear.i/dim);triangles.push(next.i/dim);removeNode(ear);ear=next.next;stop=next.next;continue}ear=next;if(ear===stop){if(!pass){earcutLinked(filterPoints(ear),triangles,dim,minX,minY,size,1)}else if(pass===1){ear=cureLocalIntersections(ear,triangles,dim);earcutLinked(ear,triangles,dim,minX,minY,size,2)}else if(pass===2){splitEarcut(ear,triangles,dim,minX,minY,size)}break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var p=ear.next.next;while(p!==ear.prev){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.next}return true}function isEarHashed(ear,minX,minY,size){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y;var minZ=zOrder(minTX,minTY,minX,minY,size),maxZ=zOrder(maxTX,maxTY,minX,minY,size);var p=ear.nextZ;while(p&&p.z<=maxZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.nextZ}p=ear.prevZ;while(p&&p.z>=minZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ}return true}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;if(!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)){triangles.push(a.i/dim);triangles.push(p.i/dim);triangles.push(b.i/dim);removeNode(p);removeNode(p.next);p=start=b}p=p.next}while(p!==start);return p}function splitEarcut(start,triangles,dim,minX,minY,size){var a=start;do{var b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);a=filterPoints(a,a.next);c=filterPoints(c,c.next);earcutLinked(a,triangles,dim,minX,minY,size);earcutLinked(c,triangles,dim,minX,minY,size);return}b=b.next}a=a.next}while(a!==start)}function eliminateHoles(data,holeIndices,outerNode,dim){var queue=[],i,len,start,end,list;for(i=0,len=holeIndices.length;i<len;i++){start=holeIndices[i]*dim;end=i<len-1?holeIndices[i+1]*dim:data.length;list=linkedList(data,start,end,dim,false);if(list===list.next)list.steiner=true;queue.push(getLeftmost(list))}queue.sort(compareX);for(i=0;i<queue.length;i++){eliminateHole(queue[i],outerNode);outerNode=filterPoints(outerNode,outerNode.next)}return outerNode}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){outerNode=findHoleBridge(hole,outerNode);if(outerNode){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function findHoleBridge(hole,outerNode){var p=outerNode,hx=hole.x,hy=hole.y,qx=-Infinity,m;do{if(hy<=p.y&&hy>=p.next.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){qx=x;if(x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var stop=m,mx=m.x,my=m.y,tanMin=Infinity,tan;p=m.next;while(p!==stop){if(hx>=p.x&&p.x>=mx&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)){tan=Math.abs(hy-p.y)/(hx-p.x);if((tan<tanMin||tan===tanMin&&p.x>m.x)&&locallyInside(p,hole)){m=p;tanMin=tan}}p=p.next}return m}function indexCurve(start,minX,minY,size){var p=start;do{if(p.z===null)p.z=zOrder(p.x,p.y,minX,minY,size);p.prevZ=p.prev;p.nextZ=p.next;p=p.next}while(p!==start);p.prevZ.nextZ=null;p.prevZ=null;sortLinked(p)}function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{p=list;list=null;tail=null;numMerges=0;while(p){numMerges++;q=p;pSize=0;for(i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q)break}qSize=inSize;while(pSize>0||qSize>0&&q){if(pSize===0){e=q;q=q.nextZ;qSize--}else if(qSize===0||!q){e=p;p=p.nextZ;pSize--}else if(p.z<=q.z){e=p;p=p.nextZ;pSize--}else{e=q;q=q.nextZ;qSize--}if(tail)tail.nextZ=e;else list=e;e.prevZ=tail;tail=e}p=q}tail.nextZ=null;inSize*=2}while(numMerges>1);return list}function zOrder(x,y,minX,minY,size){x=32767*(x-minX)/size;y=32767*(y-minY)/size;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;x=(x|x<<1)&1431655765;y=(y|y<<8)&16711935;y=(y|y<<4)&252645135;y=(y|y<<2)&858993459;y=(y|y<<1)&1431655765;return x|y<<1}function getLeftmost(start){var p=start,leftmost=start;do{if(p.x<leftmost.x)leftmost=p;p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){if(equals(p1,q1)&&equals(p2,q2)||equals(p1,q2)&&equals(p2,q1))return true;return area(p1,q1,p2)>0!==area(p1,q1,q2)>0&&area(p2,q2,p1)>0!==area(p2,q2,q1)>0}function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return true;p=p.next}while(p!==a);return false}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var p=a,inside=false,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{if(p.y>py!==p.next.y>py&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x)inside=!inside;p=p.next}while(p!==a);return inside}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;a.next=b;b.prev=a;a2.next=an;an.prev=a2;b2.next=a2;a2.prev=b2;bp.next=b2;b2.prev=bp;return b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);if(!last){p.prev=p;p.next=p}else{p.next=last.next;p.prev=last;last.next.prev=p;last.next=p}return p}function removeNode(p){p.next.prev=p.prev;p.prev.next=p.next;if(p.prevZ)p.prevZ.nextZ=p.nextZ;if(p.nextZ)p.nextZ.prevZ=p.prevZ}function Node(i,x,y){this.i=i;this.x=x;this.y=y;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false}earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length;var outerLen=hasHoles?holeIndices[0]*dim:data.length;var polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles){for(var i=0,len=holeIndices.length;i<len;i++){var start=holeIndices[i]*dim;var end=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim))}}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim;var b=triangles[i+1]*dim;var c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return polygonArea===0&&trianglesArea===0?0:Math.abs((trianglesArea-polygonArea)/polygonArea)};function signedArea(data,start,end,dim){var sum=0;for(var i=start,j=end-dim;i<end;i+=dim){sum+=(data[j]-data[i])*(data[i+1]+data[j+1]);j=i}return sum}earcut.flatten=function(data){var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0;for(var i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++){for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d])}if(i>0){holeIndex+=data[i-1].length;result.holes.push(holeIndex)}}return result}},{}],389:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+")");err.context=er;throw err}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);
if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-- >0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],390:[function(require,module,exports){var toString={}.toString,isArray=Array.isArray||function(obj){return toString.call(obj)==="[object Array]"},objKeys=Object.keys||function(obj){var keys=[];for(var name in obj){if(obj.hasOwnProperty(name)){keys.push(name)}}return keys},strReg=/[\u0000-\u001f"\\]/g,strReplace=function(str){var code=str.charCodeAt(0);switch(code){case 34:return'\\"';case 92:return"\\\\";case 12:return"\\f";case 10:return"\\n";case 13:return"\\r";case 9:return"\\t";case 8:return"\\b";default:if(code>15){return"\\u00"+code.toString(16)}else{return"\\u000"+code.toString(16)}}};module.exports=function simpleStableStringify(val){if(val!==undefined){return""+sss(val)}};module.exports.stringSearch=strReg;module.exports.stringReplace=strReplace;function sss(val){var i,max,str,keys,key,pass;switch(typeof val){case"object":if(val===null){return null}else if(isArray(val)){str="[";max=val.length-1;for(i=0;i<max;i++){str+=sss(val[i])+","}if(max>-1){str+=sss(val[i])}return str+"]"}else{keys=objKeys(val).sort();max=keys.length;str="{";key=keys[i=0];pass=max>0&&val[key]!==undefined;while(i<max){if(pass){str+='"'+key.replace(strReg,strReplace)+'":'+sss(val[key]);key=keys[++i];pass=i<max&&val[key]!==undefined;if(pass){str+=","}}else{key=keys[++i];pass=i<max&&val[key]!==undefined}}return str+"}"}case"undefined":return null;case"string":return'"'+val.replace(strReg,strReplace)+'"';default:return val}}},{}],391:[function(require,module,exports){"use strict";var emptyFunction=require("./emptyFunction");var EventListener={listen:function listen(target,eventType,callback){if(target.addEventListener){target.addEventListener(eventType,callback,false);return{remove:function remove(){target.removeEventListener(eventType,callback,false)}}}else if(target.attachEvent){target.attachEvent("on"+eventType,callback);return{remove:function remove(){target.detachEvent("on"+eventType,callback)}}}},capture:function capture(target,eventType,callback){if(target.addEventListener){target.addEventListener(eventType,callback,true);return{remove:function remove(){target.removeEventListener(eventType,callback,true)}}}else{if("production"!=="production"){console.error("Attempted to listen to events during the capture phase on a "+"browser that does not support the capture phase. Your application "+"will not receive some events.")}return{remove:emptyFunction}}},registerDefault:function registerDefault(){}};module.exports=EventListener},{"./emptyFunction":398}],392:[function(require,module,exports){"use strict";var canUseDOM=!!(typeof window!=="undefined"&&window.document&&window.document.createElement);var ExecutionEnvironment={canUseDOM:canUseDOM,canUseWorkers:typeof Worker!=="undefined",canUseEventListeners:canUseDOM&&!!(window.addEventListener||window.attachEvent),canUseViewport:canUseDOM&&!!window.screen,isInWorker:!canUseDOM};module.exports=ExecutionEnvironment},{}],393:[function(require,module,exports){"use strict";var _hyphenPattern=/-(.)/g;function camelize(string){return string.replace(_hyphenPattern,function(_,character){return character.toUpperCase()})}module.exports=camelize},{}],394:[function(require,module,exports){"use strict";var camelize=require("./camelize");var msPattern=/^-ms-/;function camelizeStyleName(string){return camelize(string.replace(msPattern,"ms-"))}module.exports=camelizeStyleName},{"./camelize":393}],395:[function(require,module,exports){"use strict";var isTextNode=require("./isTextNode");function containsNode(outerNode,innerNode){if(!outerNode||!innerNode){return false}else if(outerNode===innerNode){return true}else if(isTextNode(outerNode)){return false}else if(isTextNode(innerNode)){return containsNode(outerNode,innerNode.parentNode)}else if("contains"in outerNode){return outerNode.contains(innerNode)}else if(outerNode.compareDocumentPosition){return!!(outerNode.compareDocumentPosition(innerNode)&16)}else{return false}}module.exports=containsNode},{"./isTextNode":408}],396:[function(require,module,exports){"use strict";var invariant=require("./invariant");function toArray(obj){var length=obj.length;!(!Array.isArray(obj)&&(typeof obj==="object"||typeof obj==="function"))?"production"!=="production"?invariant(false,"toArray: Array-like object expected"):invariant(false):void 0;!(typeof length==="number")?"production"!=="production"?invariant(false,"toArray: Object needs a length property"):invariant(false):void 0;!(length===0||length-1 in obj)?"production"!=="production"?invariant(false,"toArray: Object should have keys for indices"):invariant(false):void 0;!(typeof obj.callee!=="function")?"production"!=="production"?invariant(false,"toArray: Object can't be `arguments`. Use rest params "+"(function(...args) {}) or Array.from() instead."):invariant(false):void 0;if(obj.hasOwnProperty){try{return Array.prototype.slice.call(obj)}catch(e){}}var ret=Array(length);for(var ii=0;ii<length;ii++){ret[ii]=obj[ii]}return ret}function hasArrayNature(obj){return!!obj&&(typeof obj=="object"||typeof obj=="function")&&"length"in obj&&!("setInterval"in obj)&&typeof obj.nodeType!="number"&&(Array.isArray(obj)||"callee"in obj||"item"in obj)}function createArrayFromMixed(obj){if(!hasArrayNature(obj)){return[obj]}else if(Array.isArray(obj)){return obj.slice()}else{return toArray(obj)}}module.exports=createArrayFromMixed},{"./invariant":406}],397:[function(require,module,exports){"use strict";var ExecutionEnvironment=require("./ExecutionEnvironment");var createArrayFromMixed=require("./createArrayFromMixed");var getMarkupWrap=require("./getMarkupWrap");var invariant=require("./invariant");var dummyNode=ExecutionEnvironment.canUseDOM?document.createElement("div"):null;var nodeNamePattern=/^\s*<(\w+)/;function getNodeName(markup){var nodeNameMatch=markup.match(nodeNamePattern);return nodeNameMatch&&nodeNameMatch[1].toLowerCase()}function createNodesFromMarkup(markup,handleScript){var node=dummyNode;!!!dummyNode?"production"!=="production"?invariant(false,"createNodesFromMarkup dummy not initialized"):invariant(false):void 0;var nodeName=getNodeName(markup);var wrap=nodeName&&getMarkupWrap(nodeName);if(wrap){node.innerHTML=wrap[1]+markup+wrap[2];var wrapDepth=wrap[0];while(wrapDepth--){node=node.lastChild}}else{node.innerHTML=markup}var scripts=node.getElementsByTagName("script");if(scripts.length){!handleScript?"production"!=="production"?invariant(false,"createNodesFromMarkup(...): Unexpected <script> element rendered."):invariant(false):void 0;createArrayFromMixed(scripts).forEach(handleScript)}var nodes=Array.from(node.childNodes);while(node.lastChild){node.removeChild(node.lastChild)}return nodes}module.exports=createNodesFromMarkup},{"./ExecutionEnvironment":392,"./createArrayFromMixed":396,"./getMarkupWrap":402,"./invariant":406}],398:[function(require,module,exports){"use strict";function makeEmptyFunction(arg){return function(){return arg}}var emptyFunction=function emptyFunction(){};emptyFunction.thatReturns=makeEmptyFunction;emptyFunction.thatReturnsFalse=makeEmptyFunction(false);emptyFunction.thatReturnsTrue=makeEmptyFunction(true);emptyFunction.thatReturnsNull=makeEmptyFunction(null);emptyFunction.thatReturnsThis=function(){return this};emptyFunction.thatReturnsArgument=function(arg){return arg};module.exports=emptyFunction},{}],399:[function(require,module,exports){"use strict";var emptyObject={};if("production"!=="production"){Object.freeze(emptyObject)}module.exports=emptyObject},{}],400:[function(require,module,exports){"use strict";function focusNode(node){try{node.focus()}catch(e){}}module.exports=focusNode},{}],401:[function(require,module,exports){"use strict";function getActiveElement(){if(typeof document==="undefined"){return null}try{return document.activeElement||document.body}catch(e){return document.body}}module.exports=getActiveElement},{}],402:[function(require,module,exports){"use strict";var ExecutionEnvironment=require("./ExecutionEnvironment");var invariant=require("./invariant");var dummyNode=ExecutionEnvironment.canUseDOM?document.createElement("div"):null;var shouldWrap={};var selectWrap=[1,'<select multiple="true">',"</select>"];var tableWrap=[1,"<table>","</table>"];var trWrap=[3,"<table><tbody><tr>","</tr></tbody></table>"];var svgWrap=[1,'<svg xmlns="http://www.w3.org/2000/svg">',"</svg>"];var markupWrap={"*":[1,"?<div>","</div>"],area:[1,"<map>","</map>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],legend:[1,"<fieldset>","</fieldset>"],param:[1,"<object>","</object>"],tr:[2,"<table><tbody>","</tbody></table>"],optgroup:selectWrap,option:selectWrap,caption:tableWrap,colgroup:tableWrap,tbody:tableWrap,tfoot:tableWrap,thead:tableWrap,td:trWrap,th:trWrap};var svgElements=["circle","clipPath","defs","ellipse","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","text","tspan"];svgElements.forEach(function(nodeName){markupWrap[nodeName]=svgWrap;shouldWrap[nodeName]=true});function getMarkupWrap(nodeName){!!!dummyNode?"production"!=="production"?invariant(false,"Markup wrapping node not initialized"):invariant(false):void 0;if(!markupWrap.hasOwnProperty(nodeName)){nodeName="*"}if(!shouldWrap.hasOwnProperty(nodeName)){if(nodeName==="*"){dummyNode.innerHTML="<link />"}else{dummyNode.innerHTML="<"+nodeName+"></"+nodeName+">"}shouldWrap[nodeName]=!dummyNode.firstChild}return shouldWrap[nodeName]?markupWrap[nodeName]:null}module.exports=getMarkupWrap},{"./ExecutionEnvironment":392,"./invariant":406}],403:[function(require,module,exports){"use strict";function getUnboundedScrollPosition(scrollable){if(scrollable===window){return{x:window.pageXOffset||document.documentElement.scrollLeft,y:window.pageYOffset||document.documentElement.scrollTop}}return{x:scrollable.scrollLeft,y:scrollable.scrollTop}}module.exports=getUnboundedScrollPosition},{}],404:[function(require,module,exports){"use strict";var _uppercasePattern=/([A-Z])/g;function hyphenate(string){return string.replace(_uppercasePattern,"-$1").toLowerCase()}module.exports=hyphenate},{}],405:[function(require,module,exports){"use strict";var hyphenate=require("./hyphenate");var msPattern=/^ms-/;function hyphenateStyleName(string){return hyphenate(string).replace(msPattern,"-ms-")}module.exports=hyphenateStyleName},{"./hyphenate":404}],406:[function(require,module,exports){"use strict";var validateFormat=function validateFormat(format){};if("production"!=="production"){validateFormat=function validateFormat(format){if(format===undefined){throw new Error("invariant requires an error message argument")}}}function invariant(condition,format,a,b,c,d,e,f){validateFormat(format);if(!condition){var error;if(format===undefined){error=new Error("Minified exception occurred; use the non-minified dev environment "+"for the full error message and additional helpful warnings.")}else{var args=[a,b,c,d,e,f];var argIndex=0;error=new Error(format.replace(/%s/g,function(){return args[argIndex++]}));error.name="Invariant Violation"}error.framesToPop=1;throw error}}module.exports=invariant},{}],407:[function(require,module,exports){"use strict";function isNode(object){return!!(object&&(typeof Node==="function"?object instanceof Node:typeof object==="object"&&typeof object.nodeType==="number"&&typeof object.nodeName==="string"))}module.exports=isNode},{}],408:[function(require,module,exports){"use strict";var isNode=require("./isNode");function isTextNode(object){return isNode(object)&&object.nodeType==3}module.exports=isTextNode},{"./isNode":407}],409:[function(require,module,exports){"use strict";function memoizeStringOnly(callback){var cache={};return function(string){if(!cache.hasOwnProperty(string)){cache[string]=callback.call(this,string)}return cache[string]}}module.exports=memoizeStringOnly},{}],410:[function(require,module,exports){"use strict";var ExecutionEnvironment=require("./ExecutionEnvironment");var performance;if(ExecutionEnvironment.canUseDOM){performance=window.performance||window.msPerformance||window.webkitPerformance}module.exports=performance||{}},{"./ExecutionEnvironment":392}],411:[function(require,module,exports){"use strict";var performance=require("./performance");var performanceNow;if(performance.now){performanceNow=function performanceNow(){return performance.now()}}else{performanceNow=function performanceNow(){return Date.now()}}module.exports=performanceNow},{"./performance":410}],412:[function(require,module,exports){"use strict";var hasOwnProperty=Object.prototype.hasOwnProperty;function is(x,y){if(x===y){return x!==0||y!==0||1/x===1/y}else{return x!==x&&y!==y}}function shallowEqual(objA,objB){if(is(objA,objB)){return true}if(typeof objA!=="object"||objA===null||typeof objB!=="object"||objB===null){return false}var keysA=Object.keys(objA);var keysB=Object.keys(objB);if(keysA.length!==keysB.length){return false}for(var i=0;i<keysA.length;i++){if(!hasOwnProperty.call(objB,keysA[i])||!is(objA[keysA[i]],objB[keysA[i]])){return false}}return true}module.exports=shallowEqual},{}],413:[function(require,module,exports){"use strict";var emptyFunction=require("./emptyFunction");var warning=emptyFunction;if("production"!=="production"){(function(){var printWarning=function printWarning(format){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}var argIndex=0;var message="Warning: "+format.replace(/%s/g,function(){return args[argIndex++]});if(typeof console!=="undefined"){console.error(message)}try{throw new Error(message)}catch(x){}};warning=function warning(condition,format){if(format===undefined){throw new Error("`warning(condition, format, ...args)` requires a warning "+"message argument")}if(format.indexOf("Failed Composite propType: ")===0){return}if(!condition){for(var _len2=arguments.length,args=Array(_len2>2?_len2-2:0),_key2=2;_key2<_len2;_key2++){args[_key2-2]=arguments[_key2]}printWarning.apply(undefined,[format].concat(args))}}})()}module.exports=warning},{"./emptyFunction":398}],414:[function(require,module,exports){"use strict";module.exports=createFilter;var types=["Unknown","Point","LineString","Polygon"];function createFilter(filter){return new Function("f","var p = (f && f.properties || {}); return "+compile(filter))}function compile(filter){if(!filter)return"true";var op=filter[0];if(filter.length<=1)return op==="any"?"false":"true";var str=op==="=="?compileComparisonOp(filter[1],filter[2],"===",false):op==="!="?compileComparisonOp(filter[1],filter[2],"!==",false):op==="<"||op===">"||op==="<="||op===">="?compileComparisonOp(filter[1],filter[2],op,true):op==="any"?compileLogicalOp(filter.slice(1),"||"):op==="all"?compileLogicalOp(filter.slice(1),"&&"):op==="none"?compileNegation(compileLogicalOp(filter.slice(1),"||")):op==="in"?compileInOp(filter[1],filter.slice(2)):op==="!in"?compileNegation(compileInOp(filter[1],filter.slice(2))):op==="has"?compileHasOp(filter[1]):op==="!has"?compileNegation(compileHasOp([filter[1]])):"true";return"("+str+")"}function compilePropertyReference(property){return property==="$type"?"f.type":property==="$id"?"f.id":"p["+JSON.stringify(property)+"]"}function compileComparisonOp(property,value,op,checkType){var left=compilePropertyReference(property);var right=property==="$type"?types.indexOf(value):JSON.stringify(value);return(checkType?"typeof "+left+"=== typeof "+right+"&&":"")+left+op+right}function compileLogicalOp(expressions,op){return expressions.map(compile).join(op)}function compileInOp(property,values){if(property==="$type")values=values.map(function(value){return types.indexOf(value)});var left=JSON.stringify(values.sort(compare));var right=compilePropertyReference(property);if(values.length<=200)return left+".indexOf("+right+") !== -1";return"function(v, a, i, j) {"+"while (i <= j) { var m = (i + j) >> 1;"+"    if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;"+"}"+"return false; }("+right+", "+left+",0,"+(values.length-1)+")"}function compileHasOp(property){return JSON.stringify(property)+" in p"}function compileNegation(expression){return"!("+expression+")"}function compare(a,b){return a<b?-1:a>b?1:0}},{}],415:[function(require,module,exports){var saveAs=saveAs||function(view){"use strict";if(typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return}var doc=view.document,get_URL=function(){return view.URL||view.webkitURL||view},save_link=doc.createElementNS("http://www.w3.org/1999/xhtml","a"),can_use_save_link="download"in save_link,click=function(node){var event=new MouseEvent("click");node.dispatchEvent(event)},webkit_req_fs=view.webkitRequestFileSystem,req_fs=view.requestFileSystem||webkit_req_fs||view.mozRequestFileSystem,throw_outside=function(ex){(view.setImmediate||view.setTimeout)(function(){throw ex},0)},force_saveable_type="application/octet-stream",fs_min_size=0,arbitrary_revoke_timeout=500,revoke=function(file){var revoker=function(){if(typeof file==="string"){get_URL().revokeObjectURL(file)}else{file.remove()}};if(view.chrome){revoker()}else{setTimeout(revoker,arbitrary_revoke_timeout)}},dispatch=function(filesaver,event_types,event){event_types=[].concat(event_types);var i=event_types.length;while(i--){var listener=filesaver["on"+event_types[i]];if(typeof listener==="function"){try{listener.call(filesaver,event||filesaver)}catch(ex){throw_outside(ex)}}}},auto_bom=function(blob){if(/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(blob.type)){return new Blob(["\ufeff",blob],{type:blob.type})}return blob},FileSaver=function(blob,name,no_auto_bom){if(!no_auto_bom){blob=auto_bom(blob)}var filesaver=this,type=blob.type,blob_changed=false,object_url,target_view,dispatch_all=function(){dispatch(filesaver,"writestart progress write writeend".split(" "))},fs_error=function(){if(blob_changed||!object_url){object_url=get_URL().createObjectURL(blob)}if(target_view){target_view.location.href=object_url}else{var new_tab=view.open(object_url,"_blank");if(new_tab==undefined&&typeof safari!=="undefined"){view.location.href=object_url}}filesaver.readyState=filesaver.DONE;dispatch_all();revoke(object_url)},abortable=function(func){return function(){if(filesaver.readyState!==filesaver.DONE){return func.apply(this,arguments)}}},create_if_not_found={create:true,exclusive:false},slice;filesaver.readyState=filesaver.INIT;if(!name){name="download"}if(can_use_save_link){object_url=get_URL().createObjectURL(blob);save_link.href=object_url;save_link.download=name;setTimeout(function(){click(save_link);dispatch_all();revoke(object_url);filesaver.readyState=filesaver.DONE});return}if(view.chrome&&type&&type!==force_saveable_type){slice=blob.slice||blob.webkitSlice;blob=slice.call(blob,0,blob.size,force_saveable_type);blob_changed=true}if(webkit_req_fs&&name!=="download"){name+=".download"}if(type===force_saveable_type||webkit_req_fs){target_view=view}if(!req_fs){fs_error();return}fs_min_size+=blob.size;req_fs(view.TEMPORARY,fs_min_size,abortable(function(fs){fs.root.getDirectory("saved",create_if_not_found,abortable(function(dir){var save=function(){dir.getFile(name,create_if_not_found,abortable(function(file){file.createWriter(abortable(function(writer){writer.onwriteend=function(event){target_view.location.href=file.toURL();filesaver.readyState=filesaver.DONE;dispatch(filesaver,"writeend",event);revoke(file)};writer.onerror=function(){var error=writer.error;if(error.code!==error.ABORT_ERR){fs_error()}};"writestart progress write abort".split(" ").forEach(function(event){writer["on"+event]=filesaver["on"+event]});writer.write(blob);filesaver.abort=function(){writer.abort();filesaver.readyState=filesaver.DONE};filesaver.readyState=filesaver.WRITING}),fs_error)}),fs_error)};dir.getFile(name,{create:false},abortable(function(file){file.remove();save()}),abortable(function(ex){if(ex.code===ex.NOT_FOUND_ERR){save()}else{fs_error()}}))}),fs_error)}),fs_error)},FS_proto=FileSaver.prototype,saveAs=function(blob,name,no_auto_bom){return new FileSaver(blob,name,no_auto_bom)};if(typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob){return function(blob,name,no_auto_bom){if(!no_auto_bom){blob=auto_bom(blob)}return navigator.msSaveOrOpenBlob(blob,name||"download")}}FS_proto.abort=function(){var filesaver=this;filesaver.readyState=filesaver.DONE;dispatch(filesaver,"abort")};FS_proto.readyState=FS_proto.INIT=0;FS_proto.WRITING=1;FS_proto.DONE=2;FS_proto.error=FS_proto.onwritestart=FS_proto.onprogress=FS_proto.onwrite=FS_proto.onabort=FS_proto.onerror=FS_proto.onwriteend=null;return saveAs}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content);if(typeof module!=="undefined"&&module.exports){module.exports.saveAs=saveAs}else if(typeof define!=="undefined"&&define!==null&&define.amd!=null){define([],function(){return saveAs})}},{}],416:[function(require,module,exports){var wgs84=require("wgs84");module.exports.geometry=geometry;module.exports.ring=ringArea;function geometry(_){if(_.type==="Polygon")return polygonArea(_.coordinates);else if(_.type==="MultiPolygon"){var area=0;for(var i=0;i<_.coordinates.length;i++){area+=polygonArea(_.coordinates[i])}return area}else{return null}}function polygonArea(coords){var area=0;if(coords&&coords.length>0){area+=Math.abs(ringArea(coords[0]));for(var i=1;i<coords.length;i++){area-=Math.abs(ringArea(coords[i]))}}return area}function ringArea(coords){var area=0;if(coords.length>2){var p1,p2;for(var i=0;i<coords.length-1;i++){p1=coords[i];p2=coords[i+1];area+=rad(p2[0]-p1[0])*(2+Math.sin(rad(p1[1]))+Math.sin(rad(p2[1])))}area=area*wgs84.RADIUS*wgs84.RADIUS/2}return area}function rad(_){return _*Math.PI/180}},{wgs84:1008}],417:[function(require,module,exports){module.exports=normalize;var types={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function normalize(gj){if(!gj||!gj.type)return null;var type=types[gj.type];if(!type)return null;if(type==="geometry"){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:gj}]}}else if(type==="feature"){return{type:"FeatureCollection",features:[gj]}}else if(type==="featurecollection"){return gj}}},{}],418:[function(require,module,exports){var geojsonArea=require("geojson-area");module.exports=rewind;function rewind(gj,outer){switch(gj&&gj.type||null){case"FeatureCollection":gj.features=gj.features.map(curryOuter(rewind,outer));return gj;case"Feature":gj.geometry=rewind(gj.geometry,outer);return gj;case"Polygon":case"MultiPolygon":return correct(gj,outer);default:return gj}}function curryOuter(a,b){return function(_){return a(_,b)}}function correct(_,outer){if(_.type==="Polygon"){_.coordinates=correctRings(_.coordinates,outer)}else if(_.type==="MultiPolygon"){_.coordinates=_.coordinates.map(curryOuter(correctRings,outer))}return _}function correctRings(_,outer){outer=!!outer;_[0]=wind(_[0],!outer);for(var i=1;i<_.length;i++){_[i]=wind(_[i],outer)}return _}function wind(_,dir){return cw(_)===dir?_:_.reverse()}function cw(_){return geojsonArea.ring(_)>=0}},{"geojson-area":416}],419:[function(require,module,exports){"use strict";module.exports=clip;var createFeature=require("./feature");function clip(features,scale,k1,k2,axis,intersect,minAll,maxAll){k1/=scale;k2/=scale;if(minAll>=k1&&maxAll<=k2)return features;else if(minAll>k2||maxAll<k1)return null;var clipped=[];for(var i=0;i<features.length;i++){var feature=features[i],geometry=feature.geometry,type=feature.type,min,max;min=feature.min[axis];max=feature.max[axis];if(min>=k1&&max<=k2){clipped.push(feature);continue}else if(min>k2||max<k1)continue;var slices=type===1?clipPoints(geometry,k1,k2,axis):clipGeometry(geometry,k1,k2,axis,intersect,type===3);if(slices.length){clipped.push(createFeature(feature.tags,type,slices,feature.id))}}return clipped.length?clipped:null}function clipPoints(geometry,k1,k2,axis){var slice=[];for(var i=0;i<geometry.length;i++){var a=geometry[i],ak=a[axis];if(ak>=k1&&ak<=k2)slice.push(a)}return slice}function clipGeometry(geometry,k1,k2,axis,intersect,closed){var slices=[];for(var i=0;i<geometry.length;i++){var ak=0,bk=0,b=null,points=geometry[i],area=points.area,dist=points.dist,outer=points.outer,len=points.length,a,j,last;var slice=[];for(j=0;j<len-1;j++){a=b||points[j];b=points[j+1];ak=bk||a[axis];bk=b[axis];if(ak<k1){if(bk>k2){slice.push(intersect(a,b,k1),intersect(a,b,k2));if(!closed)slice=newSlice(slices,slice,area,dist,outer)}else if(bk>=k1)slice.push(intersect(a,b,k1))}else if(ak>k2){if(bk<k1){slice.push(intersect(a,b,k2),intersect(a,b,k1));if(!closed)slice=newSlice(slices,slice,area,dist,outer)}else if(bk<=k2)slice.push(intersect(a,b,k2))}else{slice.push(a);if(bk<k1){slice.push(intersect(a,b,k1));if(!closed)slice=newSlice(slices,slice,area,dist,outer)}else if(bk>k2){slice.push(intersect(a,b,k2));if(!closed)slice=newSlice(slices,slice,area,dist,outer)}}}a=points[len-1];ak=a[axis];if(ak>=k1&&ak<=k2)slice.push(a);last=slice[slice.length-1];if(closed&&last&&(slice[0][0]!==last[0]||slice[0][1]!==last[1]))slice.push(slice[0]);newSlice(slices,slice,area,dist,outer)}return slices}function newSlice(slices,slice,area,dist,outer){if(slice.length){slice.area=area;slice.dist=dist;if(outer!==undefined)slice.outer=outer;slices.push(slice)}return[]}},{"./feature":421}],420:[function(require,module,exports){"use strict";module.exports=convert;var simplify=require("./simplify");var createFeature=require("./feature");function convert(data,tolerance){var features=[];if(data.type==="FeatureCollection"){for(var i=0;i<data.features.length;i++){convertFeature(features,data.features[i],tolerance)}}else if(data.type==="Feature"){convertFeature(features,data,tolerance)}else{convertFeature(features,{geometry:data},tolerance)}return features}function convertFeature(features,feature,tolerance){if(feature.geometry===null){return}var geom=feature.geometry,type=geom.type,coords=geom.coordinates,tags=feature.properties,id=feature.id,i,j,rings,projectedRing;if(type==="Point"){features.push(createFeature(tags,1,[projectPoint(coords)],id))}else if(type==="MultiPoint"){features.push(createFeature(tags,1,project(coords),id))}else if(type==="LineString"){features.push(createFeature(tags,2,[project(coords,tolerance)],id))}else if(type==="MultiLineString"||type==="Polygon"){rings=[];for(i=0;i<coords.length;i++){projectedRing=project(coords[i],tolerance);if(type==="Polygon")projectedRing.outer=i===0;rings.push(projectedRing)}features.push(createFeature(tags,type==="Polygon"?3:2,rings,id))}else if(type==="MultiPolygon"){rings=[];for(i=0;i<coords.length;i++){for(j=0;j<coords[i].length;j++){projectedRing=project(coords[i][j],tolerance);projectedRing.outer=j===0;rings.push(projectedRing)}}features.push(createFeature(tags,3,rings,id))}else if(type==="GeometryCollection"){for(i=0;i<geom.geometries.length;i++){convertFeature(features,{geometry:geom.geometries[i],properties:tags},tolerance)}}else{throw new Error("Input data is not a valid GeoJSON object.")}}function project(lonlats,tolerance){var projected=[];for(var i=0;i<lonlats.length;i++){projected.push(projectPoint(lonlats[i]))}if(tolerance){simplify(projected,tolerance);calcSize(projected)}return projected}function projectPoint(p){var sin=Math.sin(p[1]*Math.PI/180),x=p[0]/360+.5,y=.5-.25*Math.log((1+sin)/(1-sin))/Math.PI;y=y<0?0:y>1?1:y;return[x,y,0]}function calcSize(points){var area=0,dist=0;for(var i=0,a,b;i<points.length-1;i++){a=b||points[i];b=points[i+1];area+=a[0]*b[1]-b[0]*a[1];dist+=Math.abs(b[0]-a[0])+Math.abs(b[1]-a[1])}points.area=Math.abs(area/2);points.dist=dist}},{"./feature":421,"./simplify":423}],421:[function(require,module,exports){"use strict";module.exports=createFeature;function createFeature(tags,type,geom,id){var feature={id:id||null,type:type,geometry:geom,tags:tags||null,min:[Infinity,Infinity],max:[-Infinity,-Infinity]};calcBBox(feature);return feature}function calcBBox(feature){var geometry=feature.geometry,min=feature.min,max=feature.max;if(feature.type===1){calcRingBBox(min,max,geometry)}else{for(var i=0;i<geometry.length;i++){calcRingBBox(min,max,geometry[i])}}return feature}function calcRingBBox(min,max,points){for(var i=0,p;i<points.length;i++){p=points[i];min[0]=Math.min(p[0],min[0]);max[0]=Math.max(p[0],max[0]);min[1]=Math.min(p[1],min[1]);max[1]=Math.max(p[1],max[1])}}},{}],422:[function(require,module,exports){"use strict";module.exports=geojsonvt;var convert=require("./convert"),transform=require("./transform"),clip=require("./clip"),wrap=require("./wrap"),createTile=require("./tile");function geojsonvt(data,options){return new GeoJSONVT(data,options)}function GeoJSONVT(data,options){options=this.options=extend(Object.create(this.options),options);var debug=options.debug;if(debug)console.time("preprocess data");var z2=1<<options.maxZoom,features=convert(data,options.tolerance/(z2*options.extent));
this.tiles={};this.tileCoords=[];if(debug){console.timeEnd("preprocess data");console.log("index: maxZoom: %d, maxPoints: %d",options.indexMaxZoom,options.indexMaxPoints);console.time("generate tiles");this.stats={};this.total=0}features=wrap(features,options.buffer/options.extent,intersectX);if(features.length)this.splitTile(features,0,0,0);if(debug){if(features.length)console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints);console.timeEnd("generate tiles");console.log("tiles generated:",this.total,JSON.stringify(this.stats))}}GeoJSONVT.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:false,tolerance:3,extent:4096,buffer:64,debug:0};GeoJSONVT.prototype.splitTile=function(features,z,x,y,cz,cx,cy){var stack=[features,z,x,y],options=this.options,debug=options.debug,solid=null;while(stack.length){y=stack.pop();x=stack.pop();z=stack.pop();features=stack.pop();var z2=1<<z,id=toID(z,x,y),tile=this.tiles[id],tileTolerance=z===options.maxZoom?0:options.tolerance/(z2*options.extent);if(!tile){if(debug>1)console.time("creation");tile=this.tiles[id]=createTile(features,z2,x,y,tileTolerance,z===options.maxZoom);this.tileCoords.push({z:z,x:x,y:y});if(debug){if(debug>1){console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,x,y,tile.numFeatures,tile.numPoints,tile.numSimplified);console.timeEnd("creation")}var key="z"+z;this.stats[key]=(this.stats[key]||0)+1;this.total++}}tile.source=features;if(!cz){if(z===options.indexMaxZoom||tile.numPoints<=options.indexMaxPoints)continue}else{if(z===options.maxZoom||z===cz)continue;var m=1<<cz-z;if(x!==Math.floor(cx/m)||y!==Math.floor(cy/m))continue}if(!options.solidChildren&&isClippedSquare(tile,options.extent,options.buffer)){if(cz)solid=z;continue}tile.source=null;if(debug>1)console.time("clipping");var k1=.5*options.buffer/options.extent,k2=.5-k1,k3=.5+k1,k4=1+k1,tl,bl,tr,br,left,right;tl=bl=tr=br=null;left=clip(features,z2,x-k1,x+k3,0,intersectX,tile.min[0],tile.max[0]);right=clip(features,z2,x+k2,x+k4,0,intersectX,tile.min[0],tile.max[0]);if(left){tl=clip(left,z2,y-k1,y+k3,1,intersectY,tile.min[1],tile.max[1]);bl=clip(left,z2,y+k2,y+k4,1,intersectY,tile.min[1],tile.max[1])}if(right){tr=clip(right,z2,y-k1,y+k3,1,intersectY,tile.min[1],tile.max[1]);br=clip(right,z2,y+k2,y+k4,1,intersectY,tile.min[1],tile.max[1])}if(debug>1)console.timeEnd("clipping");if(features.length){stack.push(tl||[],z+1,x*2,y*2);stack.push(bl||[],z+1,x*2,y*2+1);stack.push(tr||[],z+1,x*2+1,y*2);stack.push(br||[],z+1,x*2+1,y*2+1)}}return solid};GeoJSONVT.prototype.getTile=function(z,x,y){var options=this.options,extent=options.extent,debug=options.debug;var z2=1<<z;x=(x%z2+z2)%z2;var id=toID(z,x,y);if(this.tiles[id])return transform.tile(this.tiles[id],extent);if(debug>1)console.log("drilling down to z%d-%d-%d",z,x,y);var z0=z,x0=x,y0=y,parent;while(!parent&&z0>0){z0--;x0=Math.floor(x0/2);y0=Math.floor(y0/2);parent=this.tiles[toID(z0,x0,y0)]}if(!parent||!parent.source)return null;if(debug>1)console.log("found parent tile z%d-%d-%d",z0,x0,y0);if(isClippedSquare(parent,extent,options.buffer))return transform.tile(parent,extent);if(debug>1)console.time("drilling down");var solid=this.splitTile(parent.source,z0,x0,y0,z,x,y);if(debug>1)console.timeEnd("drilling down");if(solid!==null){var m=1<<z-solid;id=toID(solid,Math.floor(x/m),Math.floor(y/m))}return this.tiles[id]?transform.tile(this.tiles[id],extent):null};function toID(z,x,y){return((1<<z)*y+x)*32+z}function intersectX(a,b,x){return[x,(x-a[0])*(b[1]-a[1])/(b[0]-a[0])+a[1],1]}function intersectY(a,b,y){return[(y-a[1])*(b[0]-a[0])/(b[1]-a[1])+a[0],y,1]}function extend(dest,src){for(var i in src)dest[i]=src[i];return dest}function isClippedSquare(tile,extent,buffer){var features=tile.source;if(features.length!==1)return false;var feature=features[0];if(feature.type!==3||feature.geometry.length>1)return false;var len=feature.geometry[0].length;if(len!==5)return false;for(var i=0;i<len;i++){var p=transform.point(feature.geometry[0][i],extent,tile.z2,tile.x,tile.y);if(p[0]!==-buffer&&p[0]!==extent+buffer||p[1]!==-buffer&&p[1]!==extent+buffer)return false}return true}},{"./clip":419,"./convert":420,"./tile":424,"./transform":425,"./wrap":426}],423:[function(require,module,exports){"use strict";module.exports=simplify;function simplify(points,tolerance){var sqTolerance=tolerance*tolerance,len=points.length,first=0,last=len-1,stack=[],i,maxSqDist,sqDist,index;points[first][2]=1;points[last][2]=1;while(last){maxSqDist=0;for(i=first+1;i<last;i++){sqDist=getSqSegDist(points[i],points[first],points[last]);if(sqDist>maxSqDist){index=i;maxSqDist=sqDist}}if(maxSqDist>sqTolerance){points[index][2]=maxSqDist;stack.push(first);stack.push(index);first=index}else{last=stack.pop();first=stack.pop()}}}function getSqSegDist(p,a,b){var x=a[0],y=a[1],bx=b[0],by=b[1],px=p[0],py=p[1],dx=bx-x,dy=by-y;if(dx!==0||dy!==0){var t=((px-x)*dx+(py-y)*dy)/(dx*dx+dy*dy);if(t>1){x=bx;y=by}else if(t>0){x+=dx*t;y+=dy*t}}dx=px-x;dy=py-y;return dx*dx+dy*dy}},{}],424:[function(require,module,exports){"use strict";module.exports=createTile;function createTile(features,z2,tx,ty,tolerance,noSimplify){var tile={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:tx,y:ty,z2:z2,transformed:false,min:[2,1],max:[-1,0]};for(var i=0;i<features.length;i++){tile.numFeatures++;addFeature(tile,features[i],tolerance,noSimplify);var min=features[i].min,max=features[i].max;if(min[0]<tile.min[0])tile.min[0]=min[0];if(min[1]<tile.min[1])tile.min[1]=min[1];if(max[0]>tile.max[0])tile.max[0]=max[0];if(max[1]>tile.max[1])tile.max[1]=max[1]}return tile}function addFeature(tile,feature,tolerance,noSimplify){var geom=feature.geometry,type=feature.type,simplified=[],sqTolerance=tolerance*tolerance,i,j,ring,p;if(type===1){for(i=0;i<geom.length;i++){simplified.push(geom[i]);tile.numPoints++;tile.numSimplified++}}else{for(i=0;i<geom.length;i++){ring=geom[i];if(!noSimplify&&(type===2&&ring.dist<tolerance||type===3&&ring.area<sqTolerance)){tile.numPoints+=ring.length;continue}var simplifiedRing=[];for(j=0;j<ring.length;j++){p=ring[j];if(noSimplify||p[2]>sqTolerance){simplifiedRing.push(p);tile.numSimplified++}tile.numPoints++}if(type===3)rewind(simplifiedRing,ring.outer);simplified.push(simplifiedRing)}}if(simplified.length){var tileFeature={geometry:simplified,type:type,tags:feature.tags||null};if(feature.id!==null){tileFeature.id=feature.id}tile.features.push(tileFeature)}}function rewind(ring,clockwise){var area=signedArea(ring);if(area<0===clockwise)ring.reverse()}function signedArea(ring){var sum=0;for(var i=0,len=ring.length,j=len-1,p1,p2;i<len;j=i++){p1=ring[i];p2=ring[j];sum+=(p2[0]-p1[0])*(p1[1]+p2[1])}return sum}},{}],425:[function(require,module,exports){"use strict";exports.tile=transformTile;exports.point=transformPoint;function transformTile(tile,extent){if(tile.transformed)return tile;var z2=tile.z2,tx=tile.x,ty=tile.y,i,j,k;for(i=0;i<tile.features.length;i++){var feature=tile.features[i],geom=feature.geometry,type=feature.type;if(type===1){for(j=0;j<geom.length;j++)geom[j]=transformPoint(geom[j],extent,z2,tx,ty)}else{for(j=0;j<geom.length;j++){var ring=geom[j];for(k=0;k<ring.length;k++)ring[k]=transformPoint(ring[k],extent,z2,tx,ty)}}}tile.transformed=true;return tile}function transformPoint(p,extent,z2,tx,ty){var x=Math.round(extent*(p[0]*z2-tx)),y=Math.round(extent*(p[1]*z2-ty));return[x,y]}},{}],426:[function(require,module,exports){"use strict";var clip=require("./clip");var createFeature=require("./feature");module.exports=wrap;function wrap(features,buffer,intersectX){var merged=features,left=clip(features,1,-1-buffer,buffer,0,intersectX,-1,2),right=clip(features,1,1-buffer,2+buffer,0,intersectX,-1,2);if(left||right){merged=clip(features,1,-buffer,1+buffer,0,intersectX,-1,2)||[];if(left)merged=shiftFeatureCoords(left,1).concat(merged);if(right)merged=merged.concat(shiftFeatureCoords(right,-1))}return merged}function shiftFeatureCoords(features,offset){var newFeatures=[];for(var i=0;i<features.length;i++){var feature=features[i],type=feature.type;var newGeometry;if(type===1){newGeometry=shiftCoords(feature.geometry,offset)}else{newGeometry=[];for(var j=0;j<feature.geometry.length;j++){newGeometry.push(shiftCoords(feature.geometry[j],offset))}}newFeatures.push(createFeature(feature.tags,type,newGeometry,feature.id))}return newFeatures}function shiftCoords(points,offset){var newPoints=[];newPoints.area=points.area;newPoints.dist=points.dist;for(var i=0;i<points.length;i++){newPoints.push([points[i][0]+offset,points[i][1],points[i][2]])}return newPoints}},{"./clip":419,"./feature":421}],427:[function(require,module,exports){(function(Buffer,process){"use strict";var path=require("path");var ndarray=require("ndarray");var GifReader=require("omggif").GifReader;var pack=require("ndarray-pack");var through=require("through");var parseDataURI=require("data-uri-to-buffer");function defaultImage(url,cb){var img=new Image;img.crossOrigin="Anonymous";img.onload=function(){var canvas=document.createElement("canvas");canvas.width=img.width;canvas.height=img.height;var context=canvas.getContext("2d");context.drawImage(img,0,0);var pixels=context.getImageData(0,0,img.width,img.height);cb(null,ndarray(new Uint8Array(pixels.data),[img.width,img.height,4],[4,4*img.width,1],0))};img.onerror=function(err){cb(err)};img.src=url}function handleGif(data,cb){var reader;try{reader=new GifReader(data)}catch(err){cb(err);return}if(reader.numFrames()>0){var nshape=[reader.numFrames(),reader.height,reader.width,4];var ndata=new Uint8Array(nshape[0]*nshape[1]*nshape[2]*nshape[3]);var result=ndarray(ndata,nshape);try{for(var i=0;i<reader.numFrames();++i){reader.decodeAndBlitFrameRGBA(i,ndata.subarray(result.index(i,0,0,0),result.index(i+1,0,0,0)))}}catch(err){cb(err);return}cb(null,result.transpose(0,2,1))}else{var nshape=[reader.height,reader.width,4];var ndata=new Uint8Array(nshape[0]*nshape[1]*nshape[2]);var result=ndarray(ndata,nshape);try{reader.decodeAndBlitFrameRGBA(0,ndata)}catch(err){cb(err);return}cb(null,result.transpose(1,0))}}function httpGif(url,cb){var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";if(xhr.overrideMimeType){xhr.overrideMimeType("application/binary")}xhr.onerror=function(err){cb(err)};xhr.onload=function(){if(xhr.readyState!==4){return}var data=new Uint8Array(xhr.response);handleGif(data,cb);return};xhr.send()}function copyBuffer(buffer){if(buffer[0]===undefined){var n=buffer.length;var result=new Uint8Array(n);for(var i=0;i<n;++i){result[i]=buffer.get(i)}return result}else{return new Uint8Array(buffer)}}function dataGif(url,cb){process.nextTick(function(){try{var buffer=parseDataURI(url);if(buffer){handleGif(copyBuffer(buffer),cb)}else{cb(new Error("Error parsing data URI"))}}catch(err){cb(err)}})}module.exports=function getPixels(url,type,cb){if(!cb){cb=type;type=""}var ext=path.extname(url);switch(type||ext.toUpperCase()){case".GIF":httpGif(url,cb);break;default:if(Buffer.isBuffer(url)){url="data:"+type+";base64,"+url.toString("base64")}if(url.indexOf("data:image/gif;")===0){dataGif(url,cb)}else{defaultImage(url,cb)}}}}).call(this,{isBuffer:require("../is-buffer/index.js")},require("_process"))},{"../is-buffer/index.js":457,_process:11,"data-uri-to-buffer":333,ndarray:731,"ndarray-pack":729,omggif:733,path:745,through:988}],428:[function(require,module,exports){(function(Buffer){var assert=require("assert");var EventEmitter=require("events").EventEmitter;var ReadableStream=require("readable-stream");var util=require("util");var NeuQuant=require("./TypedNeuQuant.js");var LZWEncoder=require("./LZWEncoder.js");function ByteCapacitor(options){ReadableStream.call(this,options);this.okayToPush=true;this.resetData()}util.inherits(ByteCapacitor,ReadableStream);ByteCapacitor.prototype._read=function(){this.okayToPush=true};ByteCapacitor.prototype.resetData=function(){this.data=[]};ByteCapacitor.prototype.flushData=function(){if(!this.okayToPush){var err=new Error("GIF memory limit exceeded. Please `read` from GIF before writing additional frames/information.");return this.emit("error",err)}var buff=new Buffer(this.data);this.resetData();this.okayToPush=this.push(buff)};ByteCapacitor.prototype.writeByte=function(val){this.data.push(val)};ByteCapacitor.prototype.writeUTFBytes=function(string){for(var l=string.length,i=0;i<l;i++){this.writeByte(string.charCodeAt(i))}};ByteCapacitor.prototype.writeBytes=function(array,offset,length){for(var l=length||array.length,i=offset||0;i<l;i++){this.writeByte(array[i])}};function GIFEncoder(width,height,options){options=options||{};var hwm=options.highWaterMark;ByteCapacitor.call(this,{highWaterMark:hwm||hwm===0?hwm:64*1024});this.width=~~width;this.height=~~height;this.transparent=null;this.transIndex=0;this.repeat=-1;this.delay=0;this.pixels=null;this.indexedPixels=null;this.colorDepth=null;this.colorTab=null;this.usedEntry=[];this.palSize=7;this.dispose=-1;this.firstFrame=true;this.sample=10;var that=this;function flushData(){that.flushData()}this.on("writeHeader#stop",flushData);this.on("frame#stop",flushData);this.on("finish#stop",function finishGif(){flushData();that.push(null)})}util.inherits(GIFEncoder,ByteCapacitor);GIFEncoder.prototype.setDelay=function(milliseconds){this.delay=Math.round(milliseconds/10)};GIFEncoder.prototype.setFrameRate=function(fps){this.delay=Math.round(100/fps)};GIFEncoder.prototype.setDispose=function(disposalCode){if(disposalCode>=0)this.dispose=disposalCode};GIFEncoder.prototype.setRepeat=function(repeat){this.repeat=repeat};GIFEncoder.prototype.setTransparent=function(color){this.transparent=color};GIFEncoder.prototype.analyzeImage=function(imageData){this.setImagePixels(this.removeAlphaChannel(imageData));this.analyzePixels()};GIFEncoder.prototype.writeImageInfo=function(){if(this.firstFrame){this.writeLSD();this.writePalette();if(this.repeat>=0){this.writeNetscapeExt()}}this.writeGraphicCtrlExt();this.writeImageDesc();if(!this.firstFrame)this.writePalette();this.firstFrame=false};GIFEncoder.prototype.outputImage=function(){this.writePixels()};GIFEncoder.prototype.addFrame=function(imageData){this.emit("frame#start");this.analyzeImage(imageData);this.writeImageInfo();this.outputImage();this.emit("frame#stop")};GIFEncoder.prototype.finish=function(){this.emit("finish#start");this.writeByte(59);this.emit("finish#stop")};GIFEncoder.prototype.setQuality=function(quality){if(quality<1)quality=1;this.sample=quality};GIFEncoder.prototype.writeHeader=function(){this.emit("writeHeader#start");this.writeUTFBytes("GIF89a");this.emit("writeHeader#stop")};GIFEncoder.prototype.analyzePixels=function(){var len=this.pixels.length;var nPix=len/3;this.indexedPixels=new Uint8Array(nPix);var imgq=new NeuQuant(this.pixels,this.sample);imgq.buildColormap();this.colorTab=imgq.getColormap();var k=0;for(var j=0;j<nPix;j++){var index=imgq.lookupRGB(this.pixels[k++]&255,this.pixels[k++]&255,this.pixels[k++]&255);this.usedEntry[index]=true;this.indexedPixels[j]=index}this.pixels=null;this.colorDepth=8;this.palSize=7;if(this.transparent!==null){this.transIndex=this.findClosest(this.transparent)}};GIFEncoder.prototype.findClosest=function(c){if(this.colorTab===null)return-1;var r=(c&16711680)>>16;var g=(c&65280)>>8;var b=c&255;var minpos=0;var dmin=256*256*256;var len=this.colorTab.length;for(var i=0;i<len;){var dr=r-(this.colorTab[i++]&255);var dg=g-(this.colorTab[i++]&255);var db=b-(this.colorTab[i]&255);var d=dr*dr+dg*dg+db*db;var index=i/3;if(this.usedEntry[index]&&d<dmin){dmin=d;minpos=index}i++}return minpos};GIFEncoder.prototype.removeAlphaChannel=function(data){var w=this.width;var h=this.height;var pixels=new Uint8Array(w*h*3);var count=0;for(var i=0;i<h;i++){for(var j=0;j<w;j++){var b=i*w*4+j*4;pixels[count++]=data[b];pixels[count++]=data[b+1];pixels[count++]=data[b+2]}}return pixels};GIFEncoder.prototype.setImagePixels=function(pixels){this.pixels=pixels};GIFEncoder.prototype.writeGraphicCtrlExt=function(){this.writeByte(33);this.writeByte(249);this.writeByte(4);var transp,disp;if(this.transparent===null){transp=0;disp=0}else{transp=1;disp=2}if(this.dispose>=0){disp=dispose&7}disp<<=2;this.writeByte(0|disp|0|transp);this.writeShort(this.delay);this.writeByte(this.transIndex);this.writeByte(0)};GIFEncoder.prototype.writeImageDesc=function(){this.writeByte(44);this.writeShort(0);this.writeShort(0);this.writeShort(this.width);this.writeShort(this.height);if(this.firstFrame){this.writeByte(0)}else{this.writeByte(128|0|0|0|this.palSize)}};GIFEncoder.prototype.writeLSD=function(){this.writeShort(this.width);this.writeShort(this.height);this.writeByte(128|112|0|this.palSize);this.writeByte(0);this.writeByte(0)};GIFEncoder.prototype.writeNetscapeExt=function(){this.writeByte(33);this.writeByte(255);this.writeByte(11);this.writeUTFBytes("NETSCAPE2.0");this.writeByte(3);this.writeByte(1);this.writeShort(this.repeat);this.writeByte(0)};GIFEncoder.prototype.writePalette=function(){this.writeBytes(this.colorTab);var n=3*256-this.colorTab.length;for(var i=0;i<n;i++)this.writeByte(0)};GIFEncoder.prototype.writeShort=function(pValue){this.writeByte(pValue&255);this.writeByte(pValue>>8&255)};GIFEncoder.prototype.writePixels=function(){var enc=new LZWEncoder(this.width,this.height,this.indexedPixels,this.colorDepth);enc.encode(this)};GIFEncoder.prototype.stream=function(){return this};GIFEncoder.ByteCapacitor=ByteCapacitor;module.exports=GIFEncoder}).call(this,require("buffer").Buffer)},{"./LZWEncoder.js":429,"./TypedNeuQuant.js":430,assert:2,buffer:19,events:389,"readable-stream":436,util:996}],429:[function(require,module,exports){var EOF=-1;var BITS=12;var HSIZE=5003;var masks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function LZWEncoder(width,height,pixels,colorDepth){var initCodeSize=Math.max(2,colorDepth);var accum=new Uint8Array(256);var htab=new Int32Array(HSIZE);var codetab=new Int32Array(HSIZE);var cur_accum,cur_bits=0;var a_count;var free_ent=0;var maxcode;var remaining;var curPixel;var n_bits;var clear_flg=false;var g_init_bits,ClearCode,EOFCode;function char_out(c,outs){accum[a_count++]=c;if(a_count>=254)flush_char(outs)}function cl_block(outs){cl_hash(HSIZE);free_ent=ClearCode+2;clear_flg=true;output(ClearCode,outs)}function cl_hash(hsize){for(var i=0;i<hsize;++i)htab[i]=-1}function compress(init_bits,outs){var fcode,c,i,ent,disp,hsize_reg,hshift;g_init_bits=init_bits;clear_flg=false;n_bits=g_init_bits;maxcode=MAXCODE(n_bits);ClearCode=1<<init_bits-1;EOFCode=ClearCode+1;free_ent=ClearCode+2;a_count=0;ent=nextPixel();hshift=0;for(fcode=HSIZE;fcode<65536;fcode*=2)++hshift;hshift=8-hshift;hsize_reg=HSIZE;cl_hash(hsize_reg);output(ClearCode,outs);outer_loop:while((c=nextPixel())!=EOF){fcode=(c<<BITS)+ent;i=c<<hshift^ent;if(htab[i]===fcode){ent=codetab[i];continue}else if(htab[i]>=0){disp=hsize_reg-i;if(i===0)disp=1;do{if((i-=disp)<0)i+=hsize_reg;if(htab[i]===fcode){ent=codetab[i];continue outer_loop}}while(htab[i]>=0)}output(ent,outs);ent=c;if(free_ent<1<<BITS){codetab[i]=free_ent++;htab[i]=fcode}else{cl_block(outs)}}output(ent,outs);output(EOFCode,outs)}function encode(outs){outs.writeByte(initCodeSize);remaining=width*height;curPixel=0;compress(initCodeSize+1,outs);outs.writeByte(0)}function flush_char(outs){if(a_count>0){outs.writeByte(a_count);outs.writeBytes(accum,0,a_count);a_count=0}}function MAXCODE(n_bits){return(1<<n_bits)-1}function nextPixel(){if(remaining===0)return EOF;--remaining;var pix=pixels[curPixel++];return pix&255}function output(code,outs){cur_accum&=masks[cur_bits];if(cur_bits>0)cur_accum|=code<<cur_bits;else cur_accum=code;cur_bits+=n_bits;while(cur_bits>=8){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}if(free_ent>maxcode||clear_flg){if(clear_flg){maxcode=MAXCODE(n_bits=g_init_bits);clear_flg=false}else{++n_bits;if(n_bits==BITS)maxcode=1<<BITS;else maxcode=MAXCODE(n_bits)}}if(code==EOFCode){while(cur_bits>0){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}flush_char(outs)}}this.encode=encode}module.exports=LZWEncoder},{}],430:[function(require,module,exports){var ncycles=100;var netsize=256;var maxnetpos=netsize-1;var netbiasshift=4;var intbiasshift=16;var intbias=1<<intbiasshift;var gammashift=10;var gamma=1<<gammashift;var betashift=10;var beta=intbias>>betashift;var betagamma=intbias<<gammashift-betashift;var initrad=netsize>>3;var radiusbiasshift=6;var radiusbias=1<<radiusbiasshift;var initradius=initrad*radiusbias;var radiusdec=30;var alphabiasshift=10;var initalpha=1<<alphabiasshift;var alphadec;var radbiasshift=8;var radbias=1<<radbiasshift;var alpharadbshift=alphabiasshift+radbiasshift;var alpharadbias=1<<alpharadbshift;var prime1=499;var prime2=491;var prime3=487;var prime4=503;var minpicturebytes=3*prime4;function NeuQuant(pixels,samplefac){var network;var netindex;var bias;var freq;var radpower;function init(){network=[];netindex=new Int32Array(256);bias=new Int32Array(netsize);freq=new Int32Array(netsize);radpower=new Int32Array(netsize>>3);var i,v;for(i=0;i<netsize;i++){v=(i<<netbiasshift+8)/netsize;network[i]=new Float64Array([v,v,v,0]);freq[i]=intbias/netsize;bias[i]=0}}function unbiasnet(){for(var i=0;i<netsize;i++){network[i][0]>>=netbiasshift;network[i][1]>>=netbiasshift;network[i][2]>>=netbiasshift;network[i][3]=i}}function altersingle(alpha,i,b,g,r){network[i][0]-=alpha*(network[i][0]-b)/initalpha;network[i][1]-=alpha*(network[i][1]-g)/initalpha;network[i][2]-=alpha*(network[i][2]-r)/initalpha}function alterneigh(radius,i,b,g,r){var lo=Math.abs(i-radius);var hi=Math.min(i+radius,netsize);var j=i+1;var k=i-1;var m=1;var p,a;while(j<hi||k>lo){a=radpower[m++];if(j<hi){p=network[j++];p[0]-=a*(p[0]-b)/alpharadbias;p[1]-=a*(p[1]-g)/alpharadbias;p[2]-=a*(p[2]-r)/alpharadbias}if(k>lo){p=network[k--];p[0]-=a*(p[0]-b)/alpharadbias;p[1]-=a*(p[1]-g)/alpharadbias;p[2]-=a*(p[2]-r)/alpharadbias}}}function contest(b,g,r){var bestd=~(1<<31);var bestbiasd=bestd;var bestpos=-1;var bestbiaspos=bestpos;var i,n,dist,biasdist,betafreq;for(i=0;i<netsize;i++){n=network[i];dist=Math.abs(n[0]-b)+Math.abs(n[1]-g)+Math.abs(n[2]-r);if(dist<bestd){bestd=dist;bestpos=i}biasdist=dist-(bias[i]>>intbiasshift-netbiasshift);if(biasdist<bestbiasd){bestbiasd=biasdist;bestbiaspos=i}betafreq=freq[i]>>betashift;freq[i]-=betafreq;bias[i]+=betafreq<<gammashift}freq[bestpos]+=beta;bias[bestpos]-=betagamma;return bestbiaspos}function inxbuild(){var i,j,p,q,smallpos,smallval,previouscol=0,startpos=0;for(i=0;i<netsize;i++){p=network[i];smallpos=i;smallval=p[1];for(j=i+1;j<netsize;j++){q=network[j];if(q[1]<smallval){smallpos=j;smallval=q[1]}}q=network[smallpos];if(i!=smallpos){j=q[0];q[0]=p[0];p[0]=j;j=q[1];q[1]=p[1];p[1]=j;j=q[2];q[2]=p[2];p[2]=j;j=q[3];q[3]=p[3];p[3]=j}if(smallval!=previouscol){netindex[previouscol]=startpos+i>>1;for(j=previouscol+1;j<smallval;j++)netindex[j]=i;previouscol=smallval;startpos=i}}netindex[previouscol]=startpos+maxnetpos>>1;for(j=previouscol+1;j<256;j++)netindex[j]=maxnetpos}function inxsearch(b,g,r){var a,p,dist;var bestd=1e3;var best=-1;var i=netindex[g];var j=i-1;while(i<netsize||j>=0){if(i<netsize){p=network[i];dist=p[1]-g;if(dist>=bestd)i=netsize;else{i++;if(dist<0)dist=-dist;a=p[0]-b;if(a<0)a=-a;dist+=a;if(dist<bestd){a=p[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}if(j>=0){p=network[j];dist=g-p[1];if(dist>=bestd)j=-1;else{j--;if(dist<0)dist=-dist;a=p[0]-b;if(a<0)a=-a;dist+=a;if(dist<bestd){a=p[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}}return best}function learn(){var i;var lengthcount=pixels.length;var alphadec=30+(samplefac-1)/3;var samplepixels=lengthcount/(3*samplefac);var delta=~~(samplepixels/ncycles);var alpha=initalpha;var radius=initradius;var rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(i=0;i<rad;i++)radpower[i]=alpha*((rad*rad-i*i)*radbias/(rad*rad));var step;if(lengthcount<minpicturebytes){samplefac=1;step=3}else if(lengthcount%prime1!==0){step=3*prime1}else if(lengthcount%prime2!==0){step=3*prime2}else if(lengthcount%prime3!==0){step=3*prime3}else{step=3*prime4}var b,g,r,j;var pix=0;i=0;while(i<samplepixels){b=(pixels[pix]&255)<<netbiasshift;g=(pixels[pix+1]&255)<<netbiasshift;r=(pixels[pix+2]&255)<<netbiasshift;j=contest(b,g,r);altersingle(alpha,j,b,g,r);if(rad!==0)alterneigh(rad,j,b,g,r);pix+=step;if(pix>=lengthcount)pix-=lengthcount;i++;if(delta===0)delta=1;if(i%delta===0){alpha-=alpha/alphadec;radius-=radius/radiusdec;rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(j=0;j<rad;j++)radpower[j]=alpha*((rad*rad-j*j)*radbias/(rad*rad))}}}function buildColormap(){init();learn();unbiasnet();inxbuild()}this.buildColormap=buildColormap;function getColormap(){var map=[];var index=[];for(var i=0;i<netsize;i++)index[network[i][3]]=i;var k=0;for(var l=0;l<netsize;l++){var j=index[l];map[k++]=network[j][0];map[k++]=network[j][1];map[k++]=network[j][2]}return map}this.getColormap=getColormap;this.lookupRGB=inxsearch}module.exports=NeuQuant},{}],431:[function(require,module,exports){(function(process){module.exports=Duplex;var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);forEach(objectKeys(Writable.prototype),function(method){if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]});function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;process.nextTick(this.end.bind(this))}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}}).call(this,require("_process"))},{"./_stream_readable":433,"./_stream_writable":435,_process:11,"core-util-is":318,inherits:454}],432:[function(require,module,exports){module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":434,"core-util-is":318,inherits:454}],433:[function(require,module,exports){(function(process){module.exports=Readable;var isArray=require("isarray");var Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;if(!EE.listenerCount)EE.listenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require("stream");var util=require("core-util-is");util.inherits=require("inherits");var StringDecoder;var debug=require("util");if(debug&&debug.debuglog){debug=debug.debuglog("stream")}else{debug=function(){}}util.inherits(Readable,Stream);function ReadableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{};var hwm=options.highWaterMark;var defaultHwm=options.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(util.isString(chunk)&&!state.objectMode){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(util.isNullOrUndefined(chunk)){state.reading=false;if(!state.ended)onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else{if(state.decoder&&!addToFront&&!encoding)chunk=state.decoder.write(chunk);if(!addToFront)state.reading=false;if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function roundUpToNextPowerOf2(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;for(var p=1;p<32;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(isNaN(n)||util.isNull(n)){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=roundUpToNextPowerOf2(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else return state.length}return n}Readable.prototype.read=function(n){debug("read",n);var state=this._readableState;var nOrig=n;if(!util.isNumber(n)||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);var ret;if(n>0)ret=fromList(n,state);else ret=null;if(util.isNull(ret)){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended&&state.length===0)endReadable(this);if(!util.isNull(ret))this.emit("data",ret);return ret};function chunkInvalid(state,chunk){var er=null;if(!util.isBuffer(chunk)&&!util.isString(chunk)&&!util.isNullOrUndefined(chunk)&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){
if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)process.nextTick(function(){emitReadable_(stream)});else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;process.nextTick(function(){maybeReadMore_(stream,state)})}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)process.nextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){debug("onunpipe");if(readable===src){cleanup()}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);src.removeListener("data",ondata);if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}src.on("data",ondata);function ondata(chunk){debug("ondata");var ret=dest.write(chunk);if(false===ret){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++;src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EE.listenerCount(dest,"error")===0)dest.emit("error",er)}if(!dest._events||!dest._events.error)dest.on("error",onerror);else if(isArray(dest._events.error))dest._events.error.unshift(onerror);else dest._events.error=[onerror,dest._events.error];function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EE.listenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&false!==this._readableState.flowing){this.resume()}if(ev==="readable"&&this.readable){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;if(!state.reading){var self=this;process.nextTick(function(){debug("readable nexttick read 0");self.read(0)})}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;if(!state.reading){debug("resume read 0");this.read(0)}resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;process.nextTick(function(){resume_(stream,state)})}}function resume_(stream,state){state.resumeScheduled=false;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);if(state.flowing){do{var chunk=stream.read()}while(null!==chunk&&state.flowing)}}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(!chunk||!state.objectMode&&!chunk.length)return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(util.isFunction(stream[i])&&util.isUndefined(this[i])){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");if(!state.endEmitted){state.ended=true;process.nextTick(function(){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}})}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{"./_stream_duplex":431,_process:11,buffer:19,"core-util-is":318,events:389,inherits:454,isarray:458,stream:969,"string_decoder/":982,util:6}],434:[function(require,module,exports){module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(!util.isNullOrUndefined(data))stream.push(data);if(cb)cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(options,this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;this.once("prefinish",function(){if(util.isFunction(this._flush))this._flush(function(er){done(stream,er)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(!util.isNull(ts.writechunk)&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":431,"core-util-is":318,inherits:454}],435:[function(require,module,exports){(function(process){module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream);function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb}function WritableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{};var hwm=options.highWaterMark;var defaultHwm=options.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.buffer=[];this.pendingcb=0;this.prefinished=false;this.errorEmitted=false}function Writable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))};function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er);process.nextTick(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=true;if(!util.isBuffer(chunk)&&!util.isString(chunk)&&!util.isNullOrUndefined(chunk)&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er);process.nextTick(function(){cb(er)});valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(util.isFunction(encoding)){cb=encoding;encoding=null}if(util.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(!util.isFunction(cb))cb=function(){};if(state.ended)writeAfterEnd(this,state,cb);else if(validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.buffer.length)clearBuffer(this,state)}};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&util.isString(chunk)){chunk=new Buffer(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(util.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked)state.buffer.push(new WriteReq(chunk,encoding,cb));else doWrite(stream,state,false,len,chunk,encoding,cb);return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){if(sync)process.nextTick(function(){state.pendingcb--;cb(er)});else{state.pendingcb--;cb(er)}stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.buffer.length){clearBuffer(stream,state)}if(sync){process.nextTick(function(){afterWrite(stream,state,finished,cb)})}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;if(stream._writev&&state.buffer.length>1){var cbs=[];for(var c=0;c<state.buffer.length;c++)cbs.push(state.buffer[c].callback);state.pendingcb++;doWrite(stream,state,true,state.length,state.buffer,"",function(err){for(var i=0;i<cbs.length;i++){state.pendingcb--;cbs[i](err)}});state.buffer=[]}else{for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c];var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);if(state.writing){c++;break}}if(c<state.buffer.length)state.buffer=state.buffer.slice(c);else state.buffer.length=0}state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(util.isFunction(chunk)){cb=chunk;chunk=null;encoding=null}else if(util.isFunction(encoding)){cb=encoding;encoding=null}if(!util.isNullOrUndefined(chunk))this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(stream,state){return state.ending&&state.length===0&&!state.finished&&!state.writing}function prefinish(stream,state){if(!state.prefinished){state.prefinished=true;stream.emit("prefinish")}}function finishMaybe(stream,state){var need=needFinish(stream,state);if(need){if(state.pendingcb===0){prefinish(stream,state);state.finished=true;stream.emit("finish")}else prefinish(stream,state)}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)process.nextTick(cb);else stream.once("finish",cb)}state.ended=true}}).call(this,require("_process"))},{"./_stream_duplex":431,_process:11,buffer:19,"core-util-is":318,inherits:454,stream:969}],436:[function(require,module,exports){(function(process){exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=require("stream");exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js");if(!process.browser&&process.env.READABLE_STREAM==="disable"){module.exports=require("stream")}}).call(this,require("_process"))},{"./lib/_stream_duplex.js":431,"./lib/_stream_passthrough.js":432,"./lib/_stream_readable.js":433,"./lib/_stream_transform.js":434,"./lib/_stream_writable.js":435,_process:11,stream:969}],437:[function(require,module,exports){module.exports={ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALPHA:6406,ALPHA_BITS:3413,ALWAYS:519,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATTACHED_SHADERS:35717,BACK:1029,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BROWSER_DEFAULT_WEBGL:37444,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_BUFFER_BIT:16384,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,COMPILE_STATUS:35713,COMPRESSED_TEXTURE_FORMATS:34467,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_LOST_WEBGL:37442,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH_ATTACHMENT:36096,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DONT_CARE:4352,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,FASTEST:4353,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GREATER:516,GREEN_BITS:3411,HIGH_FLOAT:36338,HIGH_INT:36341,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INT:5124,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE_ALPHA:6410,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_RENDERBUFFER_SIZE:34024,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIRRORED_REPEAT:33648,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NUM_COMPRESSED_TEXTURE_FORMATS:34466,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,RED_BITS:3410,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,REPEAT:10497,REPLACE:7681,RGB:6407,RGB5_A1:32855,RGB565:36194,RGBA:6408,RGBA4:32854,SAMPLER_2D:35678,SAMPLER_CUBE:35680,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SHADER_COMPILER:36346,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_CLEAR_VALUE:2961,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,TEXTURE_2D:3553,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,UNPACK_ALIGNMENT:3317,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VIEWPORT:2978,ZERO:0}},{}],438:[function(require,module,exports){exports.glMatrix=require("./gl-matrix/common.js");exports.mat2=require("./gl-matrix/mat2.js");exports.mat2d=require("./gl-matrix/mat2d.js");exports.mat3=require("./gl-matrix/mat3.js");exports.mat4=require("./gl-matrix/mat4.js");exports.quat=require("./gl-matrix/quat.js");exports.vec2=require("./gl-matrix/vec2.js");exports.vec3=require("./gl-matrix/vec3.js");exports.vec4=require("./gl-matrix/vec4.js")},{"./gl-matrix/common.js":439,"./gl-matrix/mat2.js":440,"./gl-matrix/mat2d.js":441,"./gl-matrix/mat3.js":442,"./gl-matrix/mat4.js":443,"./gl-matrix/quat.js":444,"./gl-matrix/vec2.js":445,"./gl-matrix/vec3.js":446,"./gl-matrix/vec4.js":447}],439:[function(require,module,exports){var glMatrix={};glMatrix.EPSILON=1e-6;glMatrix.ARRAY_TYPE=typeof Float32Array!=="undefined"?Float32Array:Array;glMatrix.RANDOM=Math.random;glMatrix.ENABLE_SIMD=false;glMatrix.SIMD_AVAILABLE=glMatrix.ARRAY_TYPE===Float32Array&&"SIMD"in this;glMatrix.USE_SIMD=glMatrix.ENABLE_SIMD&&glMatrix.SIMD_AVAILABLE;glMatrix.setMatrixArrayType=function(type){glMatrix.ARRAY_TYPE=type};var degree=Math.PI/180;glMatrix.toRadian=function(a){return a*degree};glMatrix.equals=function(a,b){return Math.abs(a-b)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};module.exports=glMatrix},{}],440:[function(require,module,exports){var glMatrix=require("./common.js");var mat2={};mat2.create=function(){var out=new glMatrix.ARRAY_TYPE(4);out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out};mat2.clone=function(a){var out=new glMatrix.ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};mat2.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};mat2.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out};mat2.fromValues=function(m00,m01,m10,m11){var out=new glMatrix.ARRAY_TYPE(4);out[0]=m00;out[1]=m01;out[2]=m10;out[3]=m11;return out};mat2.set=function(out,m00,m01,m10,m11){out[0]=m00;out[1]=m01;out[2]=m10;out[3]=m11;return out};mat2.transpose=function(out,a){if(out===a){var a1=a[1];out[1]=a[2];out[2]=a1}else{out[0]=a[0];out[1]=a[2];out[2]=a[1];out[3]=a[3]}return out};mat2.invert=function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],det=a0*a3-a2*a1;if(!det){return null}det=1/det;out[0]=a3*det;out[1]=-a1*det;out[2]=-a2*det;out[3]=a0*det;return out};mat2.adjoint=function(out,a){var a0=a[0];out[0]=a[3];out[1]=-a[1];out[2]=-a[2];out[3]=a0;return out};mat2.determinant=function(a){return a[0]*a[3]-a[2]*a[1]};mat2.multiply=function(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=a0*b0+a2*b1;out[1]=a1*b0+a3*b1;out[2]=a0*b2+a2*b3;out[3]=a1*b2+a3*b3;return out};mat2.mul=mat2.multiply;mat2.rotate=function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],s=Math.sin(rad),c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;return out};mat2.scale=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;return out};mat2.fromRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=-s;out[3]=c;return out};mat2.fromScaling=function(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=v[1];return out};mat2.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};mat2.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};mat2.LDU=function(L,D,U,a){L[2]=a[2]/a[0];U[0]=a[0];U[1]=a[1];U[3]=a[3]-L[2]*U[1];return[L,D,U]};mat2.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];return out};mat2.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];return out};mat2.sub=mat2.subtract;mat2.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};mat2.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))};mat2.multiplyScalar=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out};mat2.multiplyScalarAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;return out};module.exports=mat2},{"./common.js":439}],441:[function(require,module,exports){var glMatrix=require("./common.js");var mat2d={};mat2d.create=function(){var out=new glMatrix.ARRAY_TYPE(6);out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;return out};mat2d.clone=function(a){var out=new glMatrix.ARRAY_TYPE(6);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out};mat2d.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out};mat2d.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;return out};mat2d.fromValues=function(a,b,c,d,tx,ty){var out=new glMatrix.ARRAY_TYPE(6);out[0]=a;out[1]=b;out[2]=c;out[3]=d;out[4]=tx;out[5]=ty;return out};mat2d.set=function(out,a,b,c,d,tx,ty){out[0]=a;out[1]=b;out[2]=c;out[3]=d;out[4]=tx;out[5]=ty;return out};mat2d.invert=function(out,a){var aa=a[0],ab=a[1],ac=a[2],ad=a[3],atx=a[4],aty=a[5];var det=aa*ad-ab*ac;if(!det){return null}det=1/det;out[0]=ad*det;out[1]=-ab*det;out[2]=-ac*det;out[3]=aa*det;out[4]=(ac*aty-ad*atx)*det;out[5]=(ab*atx-aa*aty)*det;return out};mat2d.determinant=function(a){return a[0]*a[3]-a[1]*a[2]};mat2d.multiply=function(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];out[0]=a0*b0+a2*b1;out[1]=a1*b0+a3*b1;out[2]=a0*b2+a2*b3;out[3]=a1*b2+a3*b3;out[4]=a0*b4+a2*b5+a4;out[5]=a1*b4+a3*b5+a5;return out};mat2d.mul=mat2d.multiply;mat2d.rotate=function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],s=Math.sin(rad),c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;out[4]=a4;out[5]=a5;return out};mat2d.scale=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;out[4]=a4;out[5]=a5;return out};mat2d.translate=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],v0=v[0],v1=v[1];out[0]=a0;out[1]=a1;out[2]=a2;out[3]=a3;out[4]=a0*v0+a2*v1+a4;out[5]=a1*v0+a3*v1+a5;return out};mat2d.fromRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=-s;out[3]=c;out[4]=0;out[5]=0;return out};mat2d.fromScaling=function(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=v[1];out[4]=0;out[5]=0;return out};mat2d.fromTranslation=function(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=v[0];out[5]=v[1];return out};mat2d.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};mat2d.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};mat2d.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];return out};mat2d.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];return out};mat2d.sub=mat2d.subtract;mat2d.multiplyScalar=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;return out};mat2d.multiplyScalarAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;return out};mat2d.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]};mat2d.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=glMatrix.EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=glMatrix.EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5));
};module.exports=mat2d},{"./common.js":439}],442:[function(require,module,exports){var glMatrix=require("./common.js");var mat3={};mat3.create=function(){var out=new glMatrix.ARRAY_TYPE(9);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.fromMat4=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[4];out[4]=a[5];out[5]=a[6];out[6]=a[8];out[7]=a[9];out[8]=a[10];return out};mat3.clone=function(a){var out=new glMatrix.ARRAY_TYPE(9);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.fromValues=function(m00,m01,m02,m10,m11,m12,m20,m21,m22){var out=new glMatrix.ARRAY_TYPE(9);out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m10;out[4]=m11;out[5]=m12;out[6]=m20;out[7]=m21;out[8]=m22;return out};mat3.set=function(out,m00,m01,m02,m10,m11,m12,m20,m21,m22){out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m10;out[4]=m11;out[5]=m12;out[6]=m20;out[7]=m21;out[8]=m22;return out};mat3.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.transpose=function(out,a){if(out===a){var a01=a[1],a02=a[2],a12=a[5];out[1]=a[3];out[2]=a[6];out[3]=a01;out[5]=a[7];out[6]=a02;out[7]=a12}else{out[0]=a[0];out[1]=a[3];out[2]=a[6];out[3]=a[1];out[4]=a[4];out[5]=a[7];out[6]=a[2];out[7]=a[5];out[8]=a[8]}return out};mat3.invert=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b01=a22*a11-a12*a21,b11=-a22*a10+a12*a20,b21=a21*a10-a11*a20,det=a00*b01+a01*b11+a02*b21;if(!det){return null}det=1/det;out[0]=b01*det;out[1]=(-a22*a01+a02*a21)*det;out[2]=(a12*a01-a02*a11)*det;out[3]=b11*det;out[4]=(a22*a00-a02*a20)*det;out[5]=(-a12*a00+a02*a10)*det;out[6]=b21*det;out[7]=(-a21*a00+a01*a20)*det;out[8]=(a11*a00-a01*a10)*det;return out};mat3.adjoint=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];out[0]=a11*a22-a12*a21;out[1]=a02*a21-a01*a22;out[2]=a01*a12-a02*a11;out[3]=a12*a20-a10*a22;out[4]=a00*a22-a02*a20;out[5]=a02*a10-a00*a12;out[6]=a10*a21-a11*a20;out[7]=a01*a20-a00*a21;out[8]=a00*a11-a01*a10;return out};mat3.determinant=function(a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];return a00*(a22*a11-a12*a21)+a01*(-a22*a10+a12*a20)+a02*(a21*a10-a11*a20)};mat3.multiply=function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b00=b[0],b01=b[1],b02=b[2],b10=b[3],b11=b[4],b12=b[5],b20=b[6],b21=b[7],b22=b[8];out[0]=b00*a00+b01*a10+b02*a20;out[1]=b00*a01+b01*a11+b02*a21;out[2]=b00*a02+b01*a12+b02*a22;out[3]=b10*a00+b11*a10+b12*a20;out[4]=b10*a01+b11*a11+b12*a21;out[5]=b10*a02+b11*a12+b12*a22;out[6]=b20*a00+b21*a10+b22*a20;out[7]=b20*a01+b21*a11+b22*a21;out[8]=b20*a02+b21*a12+b22*a22;return out};mat3.mul=mat3.multiply;mat3.translate=function(out,a,v){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],x=v[0],y=v[1];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a10;out[4]=a11;out[5]=a12;out[6]=x*a00+y*a10+a20;out[7]=x*a01+y*a11+a21;out[8]=x*a02+y*a12+a22;return out};mat3.rotate=function(out,a,rad){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],s=Math.sin(rad),c=Math.cos(rad);out[0]=c*a00+s*a10;out[1]=c*a01+s*a11;out[2]=c*a02+s*a12;out[3]=c*a10-s*a00;out[4]=c*a11-s*a01;out[5]=c*a12-s*a02;out[6]=a20;out[7]=a21;out[8]=a22;return out};mat3.scale=function(out,a,v){var x=v[0],y=v[1];out[0]=x*a[0];out[1]=x*a[1];out[2]=x*a[2];out[3]=y*a[3];out[4]=y*a[4];out[5]=y*a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.fromTranslation=function(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=v[0];out[7]=v[1];out[8]=1;return out};mat3.fromRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=0;out[3]=-s;out[4]=c;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.fromScaling=function(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=0;out[4]=v[1];out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.fromMat2d=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=0;out[3]=a[2];out[4]=a[3];out[5]=0;out[6]=a[4];out[7]=a[5];out[8]=1;return out};mat3.fromQuat=function(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-yy-zz;out[3]=yx-wz;out[6]=zx+wy;out[1]=yx+wz;out[4]=1-xx-zz;out[7]=zy-wx;out[2]=zx-wy;out[5]=zy+wx;out[8]=1-xx-yy;return out};mat3.normalFromMat4=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a12*b08-a10*b11-a13*b07)*det;out[2]=(a10*b10-a11*b08+a13*b06)*det;out[3]=(a02*b10-a01*b11-a03*b09)*det;out[4]=(a00*b11-a02*b08+a03*b07)*det;out[5]=(a01*b08-a00*b10-a03*b06)*det;out[6]=(a31*b05-a32*b04+a33*b03)*det;out[7]=(a32*b02-a30*b05-a33*b01)*det;out[8]=(a30*b04-a31*b02+a33*b00)*det;return out};mat3.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};mat3.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};mat3.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];out[6]=a[6]+b[6];out[7]=a[7]+b[7];out[8]=a[8]+b[8];return out};mat3.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];out[6]=a[6]-b[6];out[7]=a[7]-b[7];out[8]=a[8]-b[8];return out};mat3.sub=mat3.subtract;mat3.multiplyScalar=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;out[6]=a[6]*b;out[7]=a[7]*b;out[8]=a[8]*b;return out};mat3.multiplyScalarAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;out[6]=a[6]+b[6]*scale;out[7]=a[7]+b[7]*scale;out[8]=a[8]+b[8]*scale;return out};mat3.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};mat3.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],a8=a[8];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=a[6],b7=b[7],b8=b[8];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=glMatrix.EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=glMatrix.EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=glMatrix.EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=glMatrix.EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=glMatrix.EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))};module.exports=mat3},{"./common.js":439}],443:[function(require,module,exports){var glMatrix=require("./common.js");var mat4={scalar:{},SIMD:{}};mat4.create=function(){var out=new glMatrix.ARRAY_TYPE(16);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.clone=function(a){var out=new glMatrix.ARRAY_TYPE(16);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.fromValues=function(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){var out=new glMatrix.ARRAY_TYPE(16);out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m03;out[4]=m10;out[5]=m11;out[6]=m12;out[7]=m13;out[8]=m20;out[9]=m21;out[10]=m22;out[11]=m23;out[12]=m30;out[13]=m31;out[14]=m32;out[15]=m33;return out};mat4.set=function(out,m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m03;out[4]=m10;out[5]=m11;out[6]=m12;out[7]=m13;out[8]=m20;out[9]=m21;out[10]=m22;out[11]=m23;out[12]=m30;out[13]=m31;out[14]=m32;out[15]=m33;return out};mat4.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.scalar.transpose=function(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3],a12=a[6],a13=a[7],a23=a[11];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a01;out[6]=a[9];out[7]=a[13];out[8]=a02;out[9]=a12;out[11]=a[14];out[12]=a03;out[13]=a13;out[14]=a23}else{out[0]=a[0];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a[1];out[5]=a[5];out[6]=a[9];out[7]=a[13];out[8]=a[2];out[9]=a[6];out[10]=a[10];out[11]=a[14];out[12]=a[3];out[13]=a[7];out[14]=a[11];out[15]=a[15]}return out};mat4.SIMD.transpose=function(out,a){var a0,a1,a2,a3,tmp01,tmp23,out0,out1,out2,out3;a0=SIMD.Float32x4.load(a,0);a1=SIMD.Float32x4.load(a,4);a2=SIMD.Float32x4.load(a,8);a3=SIMD.Float32x4.load(a,12);tmp01=SIMD.Float32x4.shuffle(a0,a1,0,1,4,5);tmp23=SIMD.Float32x4.shuffle(a2,a3,0,1,4,5);out0=SIMD.Float32x4.shuffle(tmp01,tmp23,0,2,4,6);out1=SIMD.Float32x4.shuffle(tmp01,tmp23,1,3,5,7);SIMD.Float32x4.store(out,0,out0);SIMD.Float32x4.store(out,4,out1);tmp01=SIMD.Float32x4.shuffle(a0,a1,2,3,6,7);tmp23=SIMD.Float32x4.shuffle(a2,a3,2,3,6,7);out2=SIMD.Float32x4.shuffle(tmp01,tmp23,0,2,4,6);out3=SIMD.Float32x4.shuffle(tmp01,tmp23,1,3,5,7);SIMD.Float32x4.store(out,8,out2);SIMD.Float32x4.store(out,12,out3);return out};mat4.transpose=glMatrix.USE_SIMD?mat4.SIMD.transpose:mat4.scalar.transpose;mat4.scalar.invert=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a02*b10-a01*b11-a03*b09)*det;out[2]=(a31*b05-a32*b04+a33*b03)*det;out[3]=(a22*b04-a21*b05-a23*b03)*det;out[4]=(a12*b08-a10*b11-a13*b07)*det;out[5]=(a00*b11-a02*b08+a03*b07)*det;out[6]=(a32*b02-a30*b05-a33*b01)*det;out[7]=(a20*b05-a22*b02+a23*b01)*det;out[8]=(a10*b10-a11*b08+a13*b06)*det;out[9]=(a01*b08-a00*b10-a03*b06)*det;out[10]=(a30*b04-a31*b02+a33*b00)*det;out[11]=(a21*b02-a20*b04-a23*b00)*det;out[12]=(a11*b07-a10*b09-a12*b06)*det;out[13]=(a00*b09-a01*b07+a02*b06)*det;out[14]=(a31*b01-a30*b03-a32*b00)*det;out[15]=(a20*b03-a21*b01+a22*b00)*det;return out};mat4.SIMD.invert=function(out,a){var row0,row1,row2,row3,tmp1,minor0,minor1,minor2,minor3,det,a0=SIMD.Float32x4.load(a,0),a1=SIMD.Float32x4.load(a,4),a2=SIMD.Float32x4.load(a,8),a3=SIMD.Float32x4.load(a,12);tmp1=SIMD.Float32x4.shuffle(a0,a1,0,1,4,5);row1=SIMD.Float32x4.shuffle(a2,a3,0,1,4,5);row0=SIMD.Float32x4.shuffle(tmp1,row1,0,2,4,6);row1=SIMD.Float32x4.shuffle(row1,tmp1,1,3,5,7);tmp1=SIMD.Float32x4.shuffle(a0,a1,2,3,6,7);row3=SIMD.Float32x4.shuffle(a2,a3,2,3,6,7);row2=SIMD.Float32x4.shuffle(tmp1,row3,0,2,4,6);row3=SIMD.Float32x4.shuffle(row3,tmp1,1,3,5,7);tmp1=SIMD.Float32x4.mul(row2,row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor0=SIMD.Float32x4.mul(row1,tmp1);minor1=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row1,tmp1),minor0);minor1=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor1);minor1=SIMD.Float32x4.swizzle(minor1,2,3,0,1);tmp1=SIMD.Float32x4.mul(row1,row2);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor0=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor0);minor3=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(minor0,SIMD.Float32x4.mul(row3,tmp1));minor3=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor3);minor3=SIMD.Float32x4.swizzle(minor3,2,3,0,1);tmp1=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(row1,2,3,0,1),row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);row2=SIMD.Float32x4.swizzle(row2,2,3,0,1);minor0=SIMD.Float32x4.add(SIMD.Float32x4.mul(row2,tmp1),minor0);minor2=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(minor0,SIMD.Float32x4.mul(row2,tmp1));minor2=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor2);minor2=SIMD.Float32x4.swizzle(minor2,2,3,0,1);tmp1=SIMD.Float32x4.mul(row0,row1);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor2=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor2);minor3=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row2,tmp1),minor3);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor2=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row3,tmp1),minor2);minor3=SIMD.Float32x4.sub(minor3,SIMD.Float32x4.mul(row2,tmp1));tmp1=SIMD.Float32x4.mul(row0,row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor1=SIMD.Float32x4.sub(minor1,SIMD.Float32x4.mul(row2,tmp1));minor2=SIMD.Float32x4.add(SIMD.Float32x4.mul(row1,tmp1),minor2);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor1=SIMD.Float32x4.add(SIMD.Float32x4.mul(row2,tmp1),minor1);minor2=SIMD.Float32x4.sub(minor2,SIMD.Float32x4.mul(row1,tmp1));tmp1=SIMD.Float32x4.mul(row0,row2);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor1=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor1);minor3=SIMD.Float32x4.sub(minor3,SIMD.Float32x4.mul(row1,tmp1));tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor1=SIMD.Float32x4.sub(minor1,SIMD.Float32x4.mul(row3,tmp1));minor3=SIMD.Float32x4.add(SIMD.Float32x4.mul(row1,tmp1),minor3);det=SIMD.Float32x4.mul(row0,minor0);det=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(det,2,3,0,1),det);det=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(det,1,0,3,2),det);tmp1=SIMD.Float32x4.reciprocalApproximation(det);det=SIMD.Float32x4.sub(SIMD.Float32x4.add(tmp1,tmp1),SIMD.Float32x4.mul(det,SIMD.Float32x4.mul(tmp1,tmp1)));det=SIMD.Float32x4.swizzle(det,0,0,0,0);if(!det){return null}SIMD.Float32x4.store(out,0,SIMD.Float32x4.mul(det,minor0));SIMD.Float32x4.store(out,4,SIMD.Float32x4.mul(det,minor1));SIMD.Float32x4.store(out,8,SIMD.Float32x4.mul(det,minor2));SIMD.Float32x4.store(out,12,SIMD.Float32x4.mul(det,minor3));return out};mat4.invert=glMatrix.USE_SIMD?mat4.SIMD.invert:mat4.scalar.invert;mat4.scalar.adjoint=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];out[0]=a11*(a22*a33-a23*a32)-a21*(a12*a33-a13*a32)+a31*(a12*a23-a13*a22);out[1]=-(a01*(a22*a33-a23*a32)-a21*(a02*a33-a03*a32)+a31*(a02*a23-a03*a22));out[2]=a01*(a12*a33-a13*a32)-a11*(a02*a33-a03*a32)+a31*(a02*a13-a03*a12);out[3]=-(a01*(a12*a23-a13*a22)-a11*(a02*a23-a03*a22)+a21*(a02*a13-a03*a12));out[4]=-(a10*(a22*a33-a23*a32)-a20*(a12*a33-a13*a32)+a30*(a12*a23-a13*a22));out[5]=a00*(a22*a33-a23*a32)-a20*(a02*a33-a03*a32)+a30*(a02*a23-a03*a22);out[6]=-(a00*(a12*a33-a13*a32)-a10*(a02*a33-a03*a32)+a30*(a02*a13-a03*a12));out[7]=a00*(a12*a23-a13*a22)-a10*(a02*a23-a03*a22)+a20*(a02*a13-a03*a12);out[8]=a10*(a21*a33-a23*a31)-a20*(a11*a33-a13*a31)+a30*(a11*a23-a13*a21);out[9]=-(a00*(a21*a33-a23*a31)-a20*(a01*a33-a03*a31)+a30*(a01*a23-a03*a21));out[10]=a00*(a11*a33-a13*a31)-a10*(a01*a33-a03*a31)+a30*(a01*a13-a03*a11);out[11]=-(a00*(a11*a23-a13*a21)-a10*(a01*a23-a03*a21)+a20*(a01*a13-a03*a11));out[12]=-(a10*(a21*a32-a22*a31)-a20*(a11*a32-a12*a31)+a30*(a11*a22-a12*a21));out[13]=a00*(a21*a32-a22*a31)-a20*(a01*a32-a02*a31)+a30*(a01*a22-a02*a21);out[14]=-(a00*(a11*a32-a12*a31)-a10*(a01*a32-a02*a31)+a30*(a01*a12-a02*a11));out[15]=a00*(a11*a22-a12*a21)-a10*(a01*a22-a02*a21)+a20*(a01*a12-a02*a11);return out};mat4.SIMD.adjoint=function(out,a){var a0,a1,a2,a3;var row0,row1,row2,row3;var tmp1;var minor0,minor1,minor2,minor3;var a0=SIMD.Float32x4.load(a,0);var a1=SIMD.Float32x4.load(a,4);var a2=SIMD.Float32x4.load(a,8);var a3=SIMD.Float32x4.load(a,12);tmp1=SIMD.Float32x4.shuffle(a0,a1,0,1,4,5);row1=SIMD.Float32x4.shuffle(a2,a3,0,1,4,5);row0=SIMD.Float32x4.shuffle(tmp1,row1,0,2,4,6);row1=SIMD.Float32x4.shuffle(row1,tmp1,1,3,5,7);tmp1=SIMD.Float32x4.shuffle(a0,a1,2,3,6,7);row3=SIMD.Float32x4.shuffle(a2,a3,2,3,6,7);row2=SIMD.Float32x4.shuffle(tmp1,row3,0,2,4,6);row3=SIMD.Float32x4.shuffle(row3,tmp1,1,3,5,7);tmp1=SIMD.Float32x4.mul(row2,row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor0=SIMD.Float32x4.mul(row1,tmp1);minor1=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row1,tmp1),minor0);minor1=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor1);minor1=SIMD.Float32x4.swizzle(minor1,2,3,0,1);tmp1=SIMD.Float32x4.mul(row1,row2);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor0=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor0);minor3=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(minor0,SIMD.Float32x4.mul(row3,tmp1));minor3=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor3);minor3=SIMD.Float32x4.swizzle(minor3,2,3,0,1);tmp1=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(row1,2,3,0,1),row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);row2=SIMD.Float32x4.swizzle(row2,2,3,0,1);minor0=SIMD.Float32x4.add(SIMD.Float32x4.mul(row2,tmp1),minor0);minor2=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(minor0,SIMD.Float32x4.mul(row2,tmp1));minor2=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor2);minor2=SIMD.Float32x4.swizzle(minor2,2,3,0,1);tmp1=SIMD.Float32x4.mul(row0,row1);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor2=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor2);minor3=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row2,tmp1),minor3);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor2=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row3,tmp1),minor2);minor3=SIMD.Float32x4.sub(minor3,SIMD.Float32x4.mul(row2,tmp1));tmp1=SIMD.Float32x4.mul(row0,row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor1=SIMD.Float32x4.sub(minor1,SIMD.Float32x4.mul(row2,tmp1));minor2=SIMD.Float32x4.add(SIMD.Float32x4.mul(row1,tmp1),minor2);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor1=SIMD.Float32x4.add(SIMD.Float32x4.mul(row2,tmp1),minor1);minor2=SIMD.Float32x4.sub(minor2,SIMD.Float32x4.mul(row1,tmp1));tmp1=SIMD.Float32x4.mul(row0,row2);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor1=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor1);minor3=SIMD.Float32x4.sub(minor3,SIMD.Float32x4.mul(row1,tmp1));tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor1=SIMD.Float32x4.sub(minor1,SIMD.Float32x4.mul(row3,tmp1));minor3=SIMD.Float32x4.add(SIMD.Float32x4.mul(row1,tmp1),minor3);SIMD.Float32x4.store(out,0,minor0);SIMD.Float32x4.store(out,4,minor1);SIMD.Float32x4.store(out,8,minor2);SIMD.Float32x4.store(out,12,minor3);return out};mat4.adjoint=glMatrix.USE_SIMD?mat4.SIMD.adjoint:mat4.scalar.adjoint;mat4.determinant=function(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32;return b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06};mat4.SIMD.multiply=function(out,a,b){var a0=SIMD.Float32x4.load(a,0);var a1=SIMD.Float32x4.load(a,4);var a2=SIMD.Float32x4.load(a,8);var a3=SIMD.Float32x4.load(a,12);var b0=SIMD.Float32x4.load(b,0);var out0=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b0,0,0,0,0),a0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b0,1,1,1,1),a1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b0,2,2,2,2),a2),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b0,3,3,3,3),a3))));SIMD.Float32x4.store(out,0,out0);var b1=SIMD.Float32x4.load(b,4);var out1=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b1,0,0,0,0),a0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b1,1,1,1,1),a1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b1,2,2,2,2),a2),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b1,3,3,3,3),a3))));SIMD.Float32x4.store(out,4,out1);var b2=SIMD.Float32x4.load(b,8);var out2=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b2,0,0,0,0),a0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b2,1,1,1,1),a1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b2,2,2,2,2),a2),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b2,3,3,3,3),a3))));SIMD.Float32x4.store(out,8,out2);var b3=SIMD.Float32x4.load(b,12);var out3=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b3,0,0,0,0),a0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b3,1,1,1,1),a1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b3,2,2,2,2),a2),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b3,3,3,3,3),a3))));SIMD.Float32x4.store(out,12,out3);return out};mat4.scalar.multiply=function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=b0*a00+b1*a10+b2*a20+b3*a30;out[1]=b0*a01+b1*a11+b2*a21+b3*a31;out[2]=b0*a02+b1*a12+b2*a22+b3*a32;out[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];out[4]=b0*a00+b1*a10+b2*a20+b3*a30;out[5]=b0*a01+b1*a11+b2*a21+b3*a31;out[6]=b0*a02+b1*a12+b2*a22+b3*a32;out[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];out[8]=b0*a00+b1*a10+b2*a20+b3*a30;out[9]=b0*a01+b1*a11+b2*a21+b3*a31;out[10]=b0*a02+b1*a12+b2*a22+b3*a32;out[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];out[12]=b0*a00+b1*a10+b2*a20+b3*a30;out[13]=b0*a01+b1*a11+b2*a21+b3*a31;out[14]=b0*a02+b1*a12+b2*a22+b3*a32;out[15]=b0*a03+b1*a13+b2*a23+b3*a33;return out};mat4.multiply=glMatrix.USE_SIMD?mat4.SIMD.multiply:mat4.scalar.multiply;mat4.mul=mat4.multiply;mat4.scalar.translate=function(out,a,v){var x=v[0],y=v[1],z=v[2],a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23;if(a===out){out[12]=a[0]*x+a[4]*y+a[8]*z+a[12];out[13]=a[1]*x+a[5]*y+a[9]*z+a[13];out[14]=a[2]*x+a[6]*y+a[10]*z+a[14];out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]}else{a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a03;out[4]=a10;out[5]=a11;out[6]=a12;out[7]=a13;out[8]=a20;out[9]=a21;out[10]=a22;out[11]=a23;out[12]=a00*x+a10*y+a20*z+a[12];out[13]=a01*x+a11*y+a21*z+a[13];out[14]=a02*x+a12*y+a22*z+a[14];out[15]=a03*x+a13*y+a23*z+a[15]}return out};mat4.SIMD.translate=function(out,a,v){var a0=SIMD.Float32x4.load(a,0),a1=SIMD.Float32x4.load(a,4),a2=SIMD.Float32x4.load(a,8),a3=SIMD.Float32x4.load(a,12),vec=SIMD.Float32x4(v[0],v[1],v[2],0);if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11]}a0=SIMD.Float32x4.mul(a0,SIMD.Float32x4.swizzle(vec,0,0,0,0));a1=SIMD.Float32x4.mul(a1,SIMD.Float32x4.swizzle(vec,1,1,1,1));a2=SIMD.Float32x4.mul(a2,SIMD.Float32x4.swizzle(vec,2,2,2,2));var t0=SIMD.Float32x4.add(a0,SIMD.Float32x4.add(a1,SIMD.Float32x4.add(a2,a3)));SIMD.Float32x4.store(out,12,t0);return out};mat4.translate=glMatrix.USE_SIMD?mat4.SIMD.translate:mat4.scalar.translate;mat4.scalar.scale=function(out,a,v){var x=v[0],y=v[1],z=v[2];out[0]=a[0]*x;out[1]=a[1]*x;out[2]=a[2]*x;out[3]=a[3]*x;out[4]=a[4]*y;out[5]=a[5]*y;out[6]=a[6]*y;out[7]=a[7]*y;out[8]=a[8]*z;out[9]=a[9]*z;out[10]=a[10]*z;out[11]=a[11]*z;out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.SIMD.scale=function(out,a,v){var a0,a1,a2;var vec=SIMD.Float32x4(v[0],v[1],v[2],0);a0=SIMD.Float32x4.load(a,0);SIMD.Float32x4.store(out,0,SIMD.Float32x4.mul(a0,SIMD.Float32x4.swizzle(vec,0,0,0,0)));a1=SIMD.Float32x4.load(a,4);SIMD.Float32x4.store(out,4,SIMD.Float32x4.mul(a1,SIMD.Float32x4.swizzle(vec,1,1,1,1)));a2=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(out,8,SIMD.Float32x4.mul(a2,SIMD.Float32x4.swizzle(vec,2,2,2,2)));out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.scale=glMatrix.USE_SIMD?mat4.SIMD.scale:mat4.scalar.scale;mat4.rotate=function(out,a,rad,axis){var x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z),s,c,t,a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,b00,b01,b02,b10,b11,b12,b20,b21,b22;if(Math.abs(len)<glMatrix.EPSILON){return null}len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];b00=x*x*t+c;b01=y*x*t+z*s;b02=z*x*t-y*s;b10=x*y*t-z*s;b11=y*y*t+c;b12=z*y*t+x*s;b20=x*z*t+y*s;b21=y*z*t-x*s;b22=z*z*t+c;out[0]=a00*b00+a10*b01+a20*b02;out[1]=a01*b00+a11*b01+a21*b02;out[2]=a02*b00+a12*b01+a22*b02;out[3]=a03*b00+a13*b01+a23*b02;out[4]=a00*b10+a10*b11+a20*b12;out[5]=a01*b10+a11*b11+a21*b12;out[6]=a02*b10+a12*b11+a22*b12;out[7]=a03*b10+a13*b11+a23*b12;out[8]=a00*b20+a10*b21+a20*b22;out[9]=a01*b20+a11*b21+a21*b22;out[10]=a02*b20+a12*b21+a22*b22;out[11]=a03*b20+a13*b21+a23*b22;if(a!==out){out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}return out};mat4.scalar.rotateX=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[4]=a10*c+a20*s;out[5]=a11*c+a21*s;out[6]=a12*c+a22*s;out[7]=a13*c+a23*s;out[8]=a20*c-a10*s;out[9]=a21*c-a11*s;out[10]=a22*c-a12*s;out[11]=a23*c-a13*s;return out};mat4.SIMD.rotateX=function(out,a,rad){var s=SIMD.Float32x4.splat(Math.sin(rad)),c=SIMD.Float32x4.splat(Math.cos(rad));if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}var a_1=SIMD.Float32x4.load(a,4);var a_2=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(out,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(a_1,c),SIMD.Float32x4.mul(a_2,s)));SIMD.Float32x4.store(out,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a_2,c),SIMD.Float32x4.mul(a_1,s)));return out};mat4.rotateX=glMatrix.USE_SIMD?mat4.SIMD.rotateX:mat4.scalar.rotateX;mat4.scalar.rotateY=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a20=a[8],a21=a[9],a22=a[10],a23=a[11];if(a!==out){out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c-a20*s;out[1]=a01*c-a21*s;out[2]=a02*c-a22*s;out[3]=a03*c-a23*s;out[8]=a00*s+a20*c;out[9]=a01*s+a21*c;out[10]=a02*s+a22*c;out[11]=a03*s+a23*c;return out};mat4.SIMD.rotateY=function(out,a,rad){var s=SIMD.Float32x4.splat(Math.sin(rad)),c=SIMD.Float32x4.splat(Math.cos(rad));if(a!==out){out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}var a_0=SIMD.Float32x4.load(a,0);var a_2=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(out,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a_0,c),SIMD.Float32x4.mul(a_2,s)));SIMD.Float32x4.store(out,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(a_0,s),SIMD.Float32x4.mul(a_2,c)));return out};mat4.rotateY=glMatrix.USE_SIMD?mat4.SIMD.rotateY:mat4.scalar.rotateY;mat4.scalar.rotateZ=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];if(a!==out){out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c+a10*s;out[1]=a01*c+a11*s;out[2]=a02*c+a12*s;out[3]=a03*c+a13*s;out[4]=a10*c-a00*s;out[5]=a11*c-a01*s;out[6]=a12*c-a02*s;out[7]=a13*c-a03*s;return out};mat4.SIMD.rotateZ=function(out,a,rad){var s=SIMD.Float32x4.splat(Math.sin(rad)),c=SIMD.Float32x4.splat(Math.cos(rad));if(a!==out){out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}var a_0=SIMD.Float32x4.load(a,0);var a_1=SIMD.Float32x4.load(a,4);SIMD.Float32x4.store(out,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(a_0,c),SIMD.Float32x4.mul(a_1,s)));SIMD.Float32x4.store(out,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a_1,c),SIMD.Float32x4.mul(a_0,s)));return out};mat4.rotateZ=glMatrix.USE_SIMD?mat4.SIMD.rotateZ:mat4.scalar.rotateZ;mat4.fromTranslation=function(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out};mat4.fromScaling=function(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=v[1];out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=v[2];out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.fromRotation=function(out,rad,axis){var x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z),s,c,t;if(Math.abs(len)<glMatrix.EPSILON){return null}len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;out[0]=x*x*t+c;out[1]=y*x*t+z*s;out[2]=z*x*t-y*s;out[3]=0;out[4]=x*y*t-z*s;out[5]=y*y*t+c;out[6]=z*y*t+x*s;out[7]=0;out[8]=x*z*t+y*s;out[9]=y*z*t-x*s;out[10]=z*z*t+c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.fromXRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=c;out[6]=s;out[7]=0;out[8]=0;out[9]=-s;out[10]=c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.fromYRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=0;out[2]=-s;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=s;out[9]=0;out[10]=c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.fromZRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=0;out[3]=0;out[4]=-s;out[5]=c;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.fromRotationTranslation=function(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out};mat4.getTranslation=function(out,mat){out[0]=mat[12];out[1]=mat[13];out[2]=mat[14];return out};mat4.getRotation=function(out,mat){var trace=mat[0]+mat[5]+mat[10];var S=0;if(trace>0){S=Math.sqrt(trace+1)*2;out[3]=.25*S;out[0]=(mat[6]-mat[9])/S;out[1]=(mat[8]-mat[2])/S;out[2]=(mat[1]-mat[4])/S}else if(mat[0]>mat[5]&mat[0]>mat[10]){S=Math.sqrt(1+mat[0]-mat[5]-mat[10])*2;out[3]=(mat[6]-mat[9])/S;out[0]=.25*S;out[1]=(mat[1]+mat[4])/S;out[2]=(mat[8]+mat[2])/S}else if(mat[5]>mat[10]){S=Math.sqrt(1+mat[5]-mat[0]-mat[10])*2;out[3]=(mat[8]-mat[2])/S;out[0]=(mat[1]+mat[4])/S;out[1]=.25*S;out[2]=(mat[6]+mat[9])/S}else{S=Math.sqrt(1+mat[10]-mat[0]-mat[5])*2;out[3]=(mat[1]-mat[4])/S;
out[0]=(mat[8]+mat[2])/S;out[1]=(mat[6]+mat[9])/S;out[2]=.25*S}return out};mat4.fromRotationTranslationScale=function(out,q,v,s){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=s[0],sy=s[1],sz=s[2];out[0]=(1-(yy+zz))*sx;out[1]=(xy+wz)*sx;out[2]=(xz-wy)*sx;out[3]=0;out[4]=(xy-wz)*sy;out[5]=(1-(xx+zz))*sy;out[6]=(yz+wx)*sy;out[7]=0;out[8]=(xz+wy)*sz;out[9]=(yz-wx)*sz;out[10]=(1-(xx+yy))*sz;out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out};mat4.fromRotationTranslationScaleOrigin=function(out,q,v,s,o){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=s[0],sy=s[1],sz=s[2],ox=o[0],oy=o[1],oz=o[2];out[0]=(1-(yy+zz))*sx;out[1]=(xy+wz)*sx;out[2]=(xz-wy)*sx;out[3]=0;out[4]=(xy-wz)*sy;out[5]=(1-(xx+zz))*sy;out[6]=(yz+wx)*sy;out[7]=0;out[8]=(xz+wy)*sz;out[9]=(yz-wx)*sz;out[10]=(1-(xx+yy))*sz;out[11]=0;out[12]=v[0]+ox-(out[0]*ox+out[4]*oy+out[8]*oz);out[13]=v[1]+oy-(out[1]*ox+out[5]*oy+out[9]*oz);out[14]=v[2]+oz-(out[2]*ox+out[6]*oy+out[10]*oz);out[15]=1;return out};mat4.fromQuat=function(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-yy-zz;out[1]=yx+wz;out[2]=zx-wy;out[3]=0;out[4]=yx-wz;out[5]=1-xx-zz;out[6]=zy+wx;out[7]=0;out[8]=zx+wy;out[9]=zy-wx;out[10]=1-xx-yy;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.frustum=function(out,left,right,bottom,top,near,far){var rl=1/(right-left),tb=1/(top-bottom),nf=1/(near-far);out[0]=near*2*rl;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=near*2*tb;out[6]=0;out[7]=0;out[8]=(right+left)*rl;out[9]=(top+bottom)*tb;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near*2*nf;out[15]=0;return out};mat4.perspective=function(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf=1/(near-far);out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=2*far*near*nf;out[15]=0;return out};mat4.perspectiveFromFieldOfView=function(out,fov,near,far){var upTan=Math.tan(fov.upDegrees*Math.PI/180),downTan=Math.tan(fov.downDegrees*Math.PI/180),leftTan=Math.tan(fov.leftDegrees*Math.PI/180),rightTan=Math.tan(fov.rightDegrees*Math.PI/180),xScale=2/(leftTan+rightTan),yScale=2/(upTan+downTan);out[0]=xScale;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=yScale;out[6]=0;out[7]=0;out[8]=-((leftTan-rightTan)*xScale*.5);out[9]=(upTan-downTan)*yScale*.5;out[10]=far/(near-far);out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near/(near-far);out[15]=0;return out};mat4.ortho=function(out,left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=2*nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=(far+near)*nf;out[15]=1;return out};mat4.lookAt=function(out,eye,center,up){var x0,x1,x2,y0,y1,y2,z0,z1,z2,len,eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];if(Math.abs(eyex-centerx)<glMatrix.EPSILON&&Math.abs(eyey-centery)<glMatrix.EPSILON&&Math.abs(eyez-centerz)<glMatrix.EPSILON){return mat4.identity(out)}z0=eyex-centerx;z1=eyey-centery;z2=eyez-centerz;len=1/Math.sqrt(z0*z0+z1*z1+z2*z2);z0*=len;z1*=len;z2*=len;x0=upy*z2-upz*z1;x1=upz*z0-upx*z2;x2=upx*z1-upy*z0;len=Math.sqrt(x0*x0+x1*x1+x2*x2);if(!len){x0=0;x1=0;x2=0}else{len=1/len;x0*=len;x1*=len;x2*=len}y0=z1*x2-z2*x1;y1=z2*x0-z0*x2;y2=z0*x1-z1*x0;len=Math.sqrt(y0*y0+y1*y1+y2*y2);if(!len){y0=0;y1=0;y2=0}else{len=1/len;y0*=len;y1*=len;y2*=len}out[0]=x0;out[1]=y0;out[2]=z0;out[3]=0;out[4]=x1;out[5]=y1;out[6]=z1;out[7]=0;out[8]=x2;out[9]=y2;out[10]=z2;out[11]=0;out[12]=-(x0*eyex+x1*eyey+x2*eyez);out[13]=-(y0*eyex+y1*eyey+y2*eyez);out[14]=-(z0*eyex+z1*eyey+z2*eyez);out[15]=1;return out};mat4.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};mat4.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};mat4.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];out[6]=a[6]+b[6];out[7]=a[7]+b[7];out[8]=a[8]+b[8];out[9]=a[9]+b[9];out[10]=a[10]+b[10];out[11]=a[11]+b[11];out[12]=a[12]+b[12];out[13]=a[13]+b[13];out[14]=a[14]+b[14];out[15]=a[15]+b[15];return out};mat4.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];out[6]=a[6]-b[6];out[7]=a[7]-b[7];out[8]=a[8]-b[8];out[9]=a[9]-b[9];out[10]=a[10]-b[10];out[11]=a[11]-b[11];out[12]=a[12]-b[12];out[13]=a[13]-b[13];out[14]=a[14]-b[14];out[15]=a[15]-b[15];return out};mat4.sub=mat4.subtract;mat4.multiplyScalar=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;out[6]=a[6]*b;out[7]=a[7]*b;out[8]=a[8]*b;out[9]=a[9]*b;out[10]=a[10]*b;out[11]=a[11]*b;out[12]=a[12]*b;out[13]=a[13]*b;out[14]=a[14]*b;out[15]=a[15]*b;return out};mat4.multiplyScalarAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;out[6]=a[6]+b[6]*scale;out[7]=a[7]+b[7]*scale;out[8]=a[8]+b[8]*scale;out[9]=a[9]+b[9]*scale;out[10]=a[10]+b[10]*scale;out[11]=a[11]+b[11]*scale;out[12]=a[12]+b[12]*scale;out[13]=a[13]+b[13]*scale;out[14]=a[14]+b[14]*scale;out[15]=a[15]+b[15]*scale;return out};mat4.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};mat4.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],a8=a[8],a9=a[9],a10=a[10],a11=a[11],a12=a[12],a13=a[13],a14=a[14],a15=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7],b8=b[8],b9=b[9],b10=b[10],b11=b[11],b12=b[12],b13=b[13],b14=b[14],b15=b[15];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=glMatrix.EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=glMatrix.EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=glMatrix.EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=glMatrix.EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=glMatrix.EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))&&Math.abs(a9-b9)<=glMatrix.EPSILON*Math.max(1,Math.abs(a9),Math.abs(b9))&&Math.abs(a10-b10)<=glMatrix.EPSILON*Math.max(1,Math.abs(a10),Math.abs(b10))&&Math.abs(a11-b11)<=glMatrix.EPSILON*Math.max(1,Math.abs(a11),Math.abs(b11))&&Math.abs(a12-b12)<=glMatrix.EPSILON*Math.max(1,Math.abs(a12),Math.abs(b12))&&Math.abs(a13-b13)<=glMatrix.EPSILON*Math.max(1,Math.abs(a13),Math.abs(b13))&&Math.abs(a14-b14)<=glMatrix.EPSILON*Math.max(1,Math.abs(a14),Math.abs(b14))&&Math.abs(a15-b15)<=glMatrix.EPSILON*Math.max(1,Math.abs(a15),Math.abs(b15))};module.exports=mat4},{"./common.js":439}],444:[function(require,module,exports){var glMatrix=require("./common.js");var mat3=require("./mat3.js");var vec3=require("./vec3.js");var vec4=require("./vec4.js");var quat={};quat.create=function(){var out=new glMatrix.ARRAY_TYPE(4);out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out};quat.rotationTo=function(){var tmpvec3=vec3.create();var xUnitVec3=vec3.fromValues(1,0,0);var yUnitVec3=vec3.fromValues(0,1,0);return function(out,a,b){var dot=vec3.dot(a,b);if(dot<-.999999){vec3.cross(tmpvec3,xUnitVec3,a);if(vec3.length(tmpvec3)<1e-6)vec3.cross(tmpvec3,yUnitVec3,a);vec3.normalize(tmpvec3,tmpvec3);quat.setAxisAngle(out,tmpvec3,Math.PI);return out}else if(dot>.999999){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out}else{vec3.cross(tmpvec3,a,b);out[0]=tmpvec3[0];out[1]=tmpvec3[1];out[2]=tmpvec3[2];out[3]=1+dot;return quat.normalize(out,out)}}}();quat.setAxes=function(){var matr=mat3.create();return function(out,view,right,up){matr[0]=right[0];matr[3]=right[1];matr[6]=right[2];matr[1]=up[0];matr[4]=up[1];matr[7]=up[2];matr[2]=-view[0];matr[5]=-view[1];matr[8]=-view[2];return quat.normalize(out,quat.fromMat3(out,matr))}}();quat.clone=vec4.clone;quat.fromValues=vec4.fromValues;quat.copy=vec4.copy;quat.set=vec4.set;quat.identity=function(out){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out};quat.setAxisAngle=function(out,axis,rad){rad=rad*.5;var s=Math.sin(rad);out[0]=s*axis[0];out[1]=s*axis[1];out[2]=s*axis[2];out[3]=Math.cos(rad);return out};quat.getAxisAngle=function(out_axis,q){var rad=Math.acos(q[3])*2;var s=Math.sin(rad/2);if(s!=0){out_axis[0]=q[0]/s;out_axis[1]=q[1]/s;out_axis[2]=q[2]/s}else{out_axis[0]=1;out_axis[1]=0;out_axis[2]=0}return rad};quat.add=vec4.add;quat.multiply=function(out,a,b){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];out[0]=ax*bw+aw*bx+ay*bz-az*by;out[1]=ay*bw+aw*by+az*bx-ax*bz;out[2]=az*bw+aw*bz+ax*by-ay*bx;out[3]=aw*bw-ax*bx-ay*by-az*bz;return out};quat.mul=quat.multiply;quat.scale=vec4.scale;quat.rotateX=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+aw*bx;out[1]=ay*bw+az*bx;out[2]=az*bw-ay*bx;out[3]=aw*bw-ax*bx;return out};quat.rotateY=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],by=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw-az*by;out[1]=ay*bw+aw*by;out[2]=az*bw+ax*by;out[3]=aw*bw-ay*by;return out};quat.rotateZ=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bz=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+ay*bz;out[1]=ay*bw-ax*bz;out[2]=az*bw+aw*bz;out[3]=aw*bw-az*bz;return out};quat.calculateW=function(out,a){var x=a[0],y=a[1],z=a[2];out[0]=x;out[1]=y;out[2]=z;out[3]=Math.sqrt(Math.abs(1-x*x-y*y-z*z));return out};quat.dot=vec4.dot;quat.lerp=vec4.lerp;quat.slerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];var omega,cosom,sinom,scale0,scale1;cosom=ax*bx+ay*by+az*bz+aw*bw;if(cosom<0){cosom=-cosom;bx=-bx;by=-by;bz=-bz;bw=-bw}if(1-cosom>1e-6){omega=Math.acos(cosom);sinom=Math.sin(omega);scale0=Math.sin((1-t)*omega)/sinom;scale1=Math.sin(t*omega)/sinom}else{scale0=1-t;scale1=t}out[0]=scale0*ax+scale1*bx;out[1]=scale0*ay+scale1*by;out[2]=scale0*az+scale1*bz;out[3]=scale0*aw+scale1*bw;return out};quat.sqlerp=function(){var temp1=quat.create();var temp2=quat.create();return function(out,a,b,c,d,t){quat.slerp(temp1,a,d,t);quat.slerp(temp2,b,c,t);quat.slerp(out,temp1,temp2,2*t*(1-t));return out}}();quat.invert=function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],dot=a0*a0+a1*a1+a2*a2+a3*a3,invDot=dot?1/dot:0;out[0]=-a0*invDot;out[1]=-a1*invDot;out[2]=-a2*invDot;out[3]=a3*invDot;return out};quat.conjugate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=a[3];return out};quat.length=vec4.length;quat.len=quat.length;quat.squaredLength=vec4.squaredLength;quat.sqrLen=quat.squaredLength;quat.normalize=vec4.normalize;quat.fromMat3=function(out,m){var fTrace=m[0]+m[4]+m[8];var fRoot;if(fTrace>0){fRoot=Math.sqrt(fTrace+1);out[3]=.5*fRoot;fRoot=.5/fRoot;out[0]=(m[5]-m[7])*fRoot;out[1]=(m[6]-m[2])*fRoot;out[2]=(m[1]-m[3])*fRoot}else{var i=0;if(m[4]>m[0])i=1;if(m[8]>m[i*3+i])i=2;var j=(i+1)%3;var k=(i+2)%3;fRoot=Math.sqrt(m[i*3+i]-m[j*3+j]-m[k*3+k]+1);out[i]=.5*fRoot;fRoot=.5/fRoot;out[3]=(m[j*3+k]-m[k*3+j])*fRoot;out[j]=(m[j*3+i]+m[i*3+j])*fRoot;out[k]=(m[k*3+i]+m[i*3+k])*fRoot}return out};quat.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};quat.exactEquals=vec4.exactEquals;quat.equals=vec4.equals;module.exports=quat},{"./common.js":439,"./mat3.js":442,"./vec3.js":446,"./vec4.js":447}],445:[function(require,module,exports){var glMatrix=require("./common.js");var vec2={};vec2.create=function(){var out=new glMatrix.ARRAY_TYPE(2);out[0]=0;out[1]=0;return out};vec2.clone=function(a){var out=new glMatrix.ARRAY_TYPE(2);out[0]=a[0];out[1]=a[1];return out};vec2.fromValues=function(x,y){var out=new glMatrix.ARRAY_TYPE(2);out[0]=x;out[1]=y;return out};vec2.copy=function(out,a){out[0]=a[0];out[1]=a[1];return out};vec2.set=function(out,x,y){out[0]=x;out[1]=y;return out};vec2.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];return out};vec2.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];return out};vec2.sub=vec2.subtract;vec2.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];return out};vec2.mul=vec2.multiply;vec2.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];return out};vec2.div=vec2.divide;vec2.ceil=function(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);return out};vec2.floor=function(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);return out};vec2.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);return out};vec2.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);return out};vec2.round=function(out,a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);return out};vec2.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;return out};vec2.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;return out};vec2.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.sqrt(x*x+y*y)};vec2.dist=vec2.distance;vec2.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y};vec2.sqrDist=vec2.squaredDistance;vec2.length=function(a){var x=a[0],y=a[1];return Math.sqrt(x*x+y*y)};vec2.len=vec2.length;vec2.squaredLength=function(a){var x=a[0],y=a[1];return x*x+y*y};vec2.sqrLen=vec2.squaredLength;vec2.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];return out};vec2.inverse=function(out,a){out[0]=1/a[0];out[1]=1/a[1];return out};vec2.normalize=function(out,a){var x=a[0],y=a[1];var len=x*x+y*y;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len}return out};vec2.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};vec2.cross=function(out,a,b){var z=a[0]*b[1]-a[1]*b[0];out[0]=out[1]=0;out[2]=z;return out};vec2.lerp=function(out,a,b,t){var ax=a[0],ay=a[1];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);return out};vec2.random=function(out,scale){scale=scale||1;var r=glMatrix.RANDOM()*2*Math.PI;out[0]=Math.cos(r)*scale;out[1]=Math.sin(r)*scale;return out};vec2.transformMat2=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y;out[1]=m[1]*x+m[3]*y;return out};vec2.transformMat2d=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y+m[4];out[1]=m[1]*x+m[3]*y+m[5];return out};vec2.transformMat3=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[3]*y+m[6];out[1]=m[1]*x+m[4]*y+m[7];return out};vec2.transformMat4=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[4]*y+m[12];out[1]=m[1]*x+m[5]*y+m[13];return out};vec2.forEach=function(){var vec=vec2.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=2}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1]}return a}}();vec2.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};vec2.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]};vec2.equals=function(a,b){var a0=a[0],a1=a[1];var b0=b[0],b1=b[1];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))};module.exports=vec2},{"./common.js":439}],446:[function(require,module,exports){var glMatrix=require("./common.js");var vec3={};vec3.create=function(){var out=new glMatrix.ARRAY_TYPE(3);out[0]=0;out[1]=0;out[2]=0;return out};vec3.clone=function(a){var out=new glMatrix.ARRAY_TYPE(3);out[0]=a[0];out[1]=a[1];out[2]=a[2];return out};vec3.fromValues=function(x,y,z){var out=new glMatrix.ARRAY_TYPE(3);out[0]=x;out[1]=y;out[2]=z;return out};vec3.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];return out};vec3.set=function(out,x,y,z){out[0]=x;out[1]=y;out[2]=z;return out};vec3.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];return out};vec3.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];return out};vec3.sub=vec3.subtract;vec3.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];return out};vec3.mul=vec3.multiply;vec3.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];return out};vec3.div=vec3.divide;vec3.ceil=function(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);out[2]=Math.ceil(a[2]);return out};vec3.floor=function(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);out[2]=Math.floor(a[2]);return out};vec3.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);return out};vec3.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);return out};vec3.round=function(out,a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);out[2]=Math.round(a[2]);return out};vec3.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;return out};vec3.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;return out};vec3.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return Math.sqrt(x*x+y*y+z*z)};vec3.dist=vec3.distance;vec3.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return x*x+y*y+z*z};vec3.sqrDist=vec3.squaredDistance;vec3.length=function(a){var x=a[0],y=a[1],z=a[2];return Math.sqrt(x*x+y*y+z*z)};vec3.len=vec3.length;vec3.squaredLength=function(a){var x=a[0],y=a[1],z=a[2];return x*x+y*y+z*z};vec3.sqrLen=vec3.squaredLength;vec3.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];return out};vec3.inverse=function(out,a){out[0]=1/a[0];out[1]=1/a[1];out[2]=1/a[2];return out};vec3.normalize=function(out,a){var x=a[0],y=a[1],z=a[2];var len=x*x+y*y+z*z;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len;out[2]=a[2]*len}return out};vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};vec3.cross=function(out,a,b){var ax=a[0],ay=a[1],az=a[2],bx=b[0],by=b[1],bz=b[2];out[0]=ay*bz-az*by;out[1]=az*bx-ax*bz;out[2]=ax*by-ay*bx;return out};vec3.lerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);return out};vec3.hermite=function(out,a,b,c,d,t){var factorTimes2=t*t,factor1=factorTimes2*(2*t-3)+1,factor2=factorTimes2*(t-2)+t,factor3=factorTimes2*(t-1),factor4=factorTimes2*(3-2*t);out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4;out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4;out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4;return out};vec3.bezier=function(out,a,b,c,d,t){var inverseFactor=1-t,inverseFactorTimesTwo=inverseFactor*inverseFactor,factorTimes2=t*t,factor1=inverseFactorTimesTwo*inverseFactor,factor2=3*t*inverseFactorTimesTwo,factor3=3*factorTimes2*inverseFactor,factor4=factorTimes2*t;out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4;out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4;out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4;return out};vec3.random=function(out,scale){scale=scale||1;var r=glMatrix.RANDOM()*2*Math.PI;var z=glMatrix.RANDOM()*2-1;var zScale=Math.sqrt(1-z*z)*scale;out[0]=Math.cos(r)*zScale;out[1]=Math.sin(r)*zScale;out[2]=z*scale;return out};vec3.transformMat4=function(out,a,m){var x=a[0],y=a[1],z=a[2],w=m[3]*x+m[7]*y+m[11]*z+m[15];w=w||1;out[0]=(m[0]*x+m[4]*y+m[8]*z+m[12])/w;out[1]=(m[1]*x+m[5]*y+m[9]*z+m[13])/w;out[2]=(m[2]*x+m[6]*y+m[10]*z+m[14])/w;return out};vec3.transformMat3=function(out,a,m){var x=a[0],y=a[1],z=a[2];out[0]=x*m[0]+y*m[3]+z*m[6];out[1]=x*m[1]+y*m[4]+z*m[7];out[2]=x*m[2]+y*m[5]+z*m[8];return out};vec3.transformQuat=function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;return out};vec3.rotateX=function(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[0];r[1]=p[1]*Math.cos(c)-p[2]*Math.sin(c);r[2]=p[1]*Math.sin(c)+p[2]*Math.cos(c);out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out};vec3.rotateY=function(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[2]*Math.sin(c)+p[0]*Math.cos(c);r[1]=p[1];r[2]=p[2]*Math.cos(c)-p[0]*Math.sin(c);out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out};vec3.rotateZ=function(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[0]*Math.cos(c)-p[1]*Math.sin(c);r[1]=p[0]*Math.sin(c)+p[1]*Math.cos(c);r[2]=p[2];out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out};vec3.forEach=function(){var vec=vec3.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=3}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2]}return a}}();vec3.angle=function(a,b){var tempA=vec3.fromValues(a[0],a[1],a[2]);var tempB=vec3.fromValues(b[0],b[1],b[2]);vec3.normalize(tempA,tempA);vec3.normalize(tempB,tempB);var cosine=vec3.dot(tempA,tempB);if(cosine>1){return 0}else{return Math.acos(cosine)}};vec3.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};vec3.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]};vec3.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2];var b0=b[0],b1=b[1],b2=b[2];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))};module.exports=vec3},{"./common.js":439}],447:[function(require,module,exports){var glMatrix=require("./common.js");var vec4={};vec4.create=function(){var out=new glMatrix.ARRAY_TYPE(4);out[0]=0;out[1]=0;out[2]=0;out[3]=0;return out};vec4.clone=function(a){var out=new glMatrix.ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};vec4.fromValues=function(x,y,z,w){var out=new glMatrix.ARRAY_TYPE(4);out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out};vec4.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};vec4.set=function(out,x,y,z,w){out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out};vec4.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];return out};vec4.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];return out};vec4.sub=vec4.subtract;vec4.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];out[3]=a[3]*b[3];return out};vec4.mul=vec4.multiply;vec4.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];out[3]=a[3]/b[3];return out};vec4.div=vec4.divide;vec4.ceil=function(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);out[2]=Math.ceil(a[2]);out[3]=Math.ceil(a[3]);return out};vec4.floor=function(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);out[2]=Math.floor(a[2]);out[3]=Math.floor(a[3]);return out};vec4.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);out[3]=Math.min(a[3],b[3]);return out};vec4.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);out[3]=Math.max(a[3],b[3]);return out};vec4.round=function(out,a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);out[2]=Math.round(a[2]);out[3]=Math.round(a[3]);return out};vec4.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out};vec4.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;return out};vec4.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return Math.sqrt(x*x+y*y+z*z+w*w)};vec4.dist=vec4.distance;vec4.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return x*x+y*y+z*z+w*w};vec4.sqrDist=vec4.squaredDistance;vec4.length=function(a){var x=a[0],y=a[1],z=a[2],w=a[3];return Math.sqrt(x*x+y*y+z*z+w*w)};vec4.len=vec4.length;vec4.squaredLength=function(a){var x=a[0],y=a[1],z=a[2],w=a[3];return x*x+y*y+z*z+w*w};vec4.sqrLen=vec4.squaredLength;vec4.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=-a[3];return out};vec4.inverse=function(out,a){out[0]=1/a[0];out[1]=1/a[1];out[2]=1/a[2];out[3]=1/a[3];return out};vec4.normalize=function(out,a){var x=a[0],y=a[1],z=a[2],w=a[3];var len=x*x+y*y+z*z+w*w;if(len>0){len=1/Math.sqrt(len);out[0]=x*len;out[1]=y*len;out[2]=z*len;out[3]=w*len}return out};vec4.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};vec4.lerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);out[3]=aw+t*(b[3]-aw);return out};vec4.random=function(out,scale){scale=scale||1;out[0]=glMatrix.RANDOM();out[1]=glMatrix.RANDOM();out[2]=glMatrix.RANDOM();out[3]=glMatrix.RANDOM();vec4.normalize(out,out);vec4.scale(out,out,scale);return out};vec4.transformMat4=function(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w;out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w;out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w;out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w;return out};vec4.transformQuat=function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;out[3]=a[3];return out};vec4.forEach=function(){var vec=vec4.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=4}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];vec[3]=a[i+3];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2];a[i+3]=vec[3]}return a}}();vec4.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};vec4.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};vec4.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))};module.exports=vec4},{"./common.js":439}],448:[function(require,module,exports){(function(global){var topLevel=typeof global!=="undefined"?global:typeof window!=="undefined"?window:{};var minDoc=require("min-document");if(typeof document!=="undefined"){module.exports=document}else{var doccy=topLevel["__GLOBAL_DOCUMENT_CACHE@4"];if(!doccy){doccy=topLevel["__GLOBAL_DOCUMENT_CACHE@4"]=minDoc}module.exports=doccy}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"min-document":6}],449:[function(require,module,exports){(function(global){if(typeof window!=="undefined"){module.exports=window}else if(typeof global!=="undefined"){module.exports=global}else if(typeof self!=="undefined"){module.exports=self}else{module.exports={}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],450:[function(require,module,exports){"use strict";module.exports=GridIndex;var NUM_PARAMS=3;function GridIndex(extent,n,padding){var cells=this.cells=[];if(extent instanceof ArrayBuffer){this.arrayBuffer=extent;var array=new Int32Array(this.arrayBuffer);extent=array[0];n=array[1];padding=array[2];this.d=n+2*padding;for(var k=0;k<this.d*this.d;k++){var start=array[NUM_PARAMS+k];var end=array[NUM_PARAMS+k+1];cells.push(start===end?null:array.subarray(start,end))}var keysOffset=array[NUM_PARAMS+cells.length];var bboxesOffset=array[NUM_PARAMS+cells.length+1];this.keys=array.subarray(keysOffset,bboxesOffset);this.bboxes=array.subarray(bboxesOffset);this.insert=this._insertReadonly}else{this.d=n+2*padding;for(var i=0;i<this.d*this.d;i++){cells.push([])}this.keys=[];this.bboxes=[]}this.n=n;this.extent=extent;this.padding=padding;this.scale=n/extent;this.uid=0;var p=padding/n*extent;this.min=-p;this.max=extent+p}GridIndex.prototype.insert=function(key,x1,y1,x2,y2){this._forEachCell(x1,y1,x2,y2,this._insertCell,this.uid++);this.keys.push(key);this.bboxes.push(x1);this.bboxes.push(y1);this.bboxes.push(x2);this.bboxes.push(y2)};GridIndex.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."};GridIndex.prototype._insertCell=function(x1,y1,x2,y2,cellIndex,uid){this.cells[cellIndex].push(uid)};GridIndex.prototype.query=function(x1,y1,x2,y2){var min=this.min;var max=this.max;if(x1<=min&&y1<=min&&max<=x2&&max<=y2){return Array.prototype.slice.call(this.keys)}else{var result=[];var seenUids={};this._forEachCell(x1,y1,x2,y2,this._queryCell,result,seenUids);return result}};GridIndex.prototype._queryCell=function(x1,y1,x2,y2,cellIndex,result,seenUids){var cell=this.cells[cellIndex];if(cell!==null){var keys=this.keys;var bboxes=this.bboxes;for(var u=0;u<cell.length;u++){var uid=cell[u];if(seenUids[uid]===undefined){var offset=uid*4;if(x1<=bboxes[offset+2]&&y1<=bboxes[offset+3]&&x2>=bboxes[offset+0]&&y2>=bboxes[offset+1]){seenUids[uid]=true;result.push(keys[uid])}else{seenUids[uid]=false}}}}};GridIndex.prototype._forEachCell=function(x1,y1,x2,y2,fn,arg1,arg2){var cx1=this._convertToCellCoord(x1);var cy1=this._convertToCellCoord(y1);var cx2=this._convertToCellCoord(x2);var cy2=this._convertToCellCoord(y2);for(var x=cx1;x<=cx2;x++){for(var y=cy1;y<=cy2;y++){var cellIndex=this.d*y+x;if(fn.call(this,x1,y1,x2,y2,cellIndex,arg1,arg2))return}}};GridIndex.prototype._convertToCellCoord=function(x){return Math.max(0,Math.min(this.d-1,Math.floor(x*this.scale)+this.padding))};GridIndex.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;var cells=this.cells;var metadataLength=NUM_PARAMS+this.cells.length+1+1;var totalCellLength=0;for(var i=0;i<this.cells.length;i++){totalCellLength+=this.cells[i].length}var array=new Int32Array(metadataLength+totalCellLength+this.keys.length+this.bboxes.length);array[0]=this.extent;array[1]=this.n;array[2]=this.padding;var offset=metadataLength;for(var k=0;k<cells.length;k++){var cell=cells[k];array[NUM_PARAMS+k]=offset;array.set(cell,offset);offset+=cell.length}array[NUM_PARAMS+cells.length]=offset;array.set(this.keys,offset);offset+=this.keys.length;array[NUM_PARAMS+cells.length+1]=offset;array.set(this.bboxes,offset);offset+=this.bboxes.length;return array.buffer}},{}],451:[function(require,module,exports){"use strict";var REACT_STATICS={childContextTypes:true,contextTypes:true,defaultProps:true,displayName:true,getDefaultProps:true,mixins:true,propTypes:true,type:true};var KNOWN_STATICS={name:true,length:true,prototype:true,caller:true,arguments:true,arity:true};var isGetOwnPropertySymbolsAvailable=typeof Object.getOwnPropertySymbols==="function";module.exports=function hoistNonReactStatics(targetComponent,sourceComponent,customStatics){if(typeof sourceComponent!=="string"){
var keys=Object.getOwnPropertyNames(sourceComponent);if(isGetOwnPropertySymbolsAvailable){keys=keys.concat(Object.getOwnPropertySymbols(sourceComponent))}for(var i=0;i<keys.length;++i){if(!REACT_STATICS[keys[i]]&&!KNOWN_STATICS[keys[i]]&&(!customStatics||!customStatics[keys[i]])){try{targetComponent[keys[i]]=sourceComponent[keys[i]]}catch(error){}}}}return targetComponent}},{}],452:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],453:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.Immutable=factory()})(this,function(){"use strict";var SLICE$0=Array.prototype.slice;function createClass(ctor,superClass){if(superClass){ctor.prototype=Object.create(superClass.prototype)}ctor.prototype.constructor=ctor}function Iterable(value){return isIterable(value)?value:Seq(value)}createClass(KeyedIterable,Iterable);function KeyedIterable(value){return isKeyed(value)?value:KeyedSeq(value)}createClass(IndexedIterable,Iterable);function IndexedIterable(value){return isIndexed(value)?value:IndexedSeq(value)}createClass(SetIterable,Iterable);function SetIterable(value){return isIterable(value)&&!isAssociative(value)?value:SetSeq(value)}function isIterable(maybeIterable){return!!(maybeIterable&&maybeIterable[IS_ITERABLE_SENTINEL])}function isKeyed(maybeKeyed){return!!(maybeKeyed&&maybeKeyed[IS_KEYED_SENTINEL])}function isIndexed(maybeIndexed){return!!(maybeIndexed&&maybeIndexed[IS_INDEXED_SENTINEL])}function isAssociative(maybeAssociative){return isKeyed(maybeAssociative)||isIndexed(maybeAssociative)}function isOrdered(maybeOrdered){return!!(maybeOrdered&&maybeOrdered[IS_ORDERED_SENTINEL])}Iterable.isIterable=isIterable;Iterable.isKeyed=isKeyed;Iterable.isIndexed=isIndexed;Iterable.isAssociative=isAssociative;Iterable.isOrdered=isOrdered;Iterable.Keyed=KeyedIterable;Iterable.Indexed=IndexedIterable;Iterable.Set=SetIterable;var IS_ITERABLE_SENTINEL="@@__IMMUTABLE_ITERABLE__@@";var IS_KEYED_SENTINEL="@@__IMMUTABLE_KEYED__@@";var IS_INDEXED_SENTINEL="@@__IMMUTABLE_INDEXED__@@";var IS_ORDERED_SENTINEL="@@__IMMUTABLE_ORDERED__@@";var DELETE="delete";var SHIFT=5;var SIZE=1<<SHIFT;var MASK=SIZE-1;var NOT_SET={};var CHANGE_LENGTH={value:false};var DID_ALTER={value:false};function MakeRef(ref){ref.value=false;return ref}function SetRef(ref){ref&&(ref.value=true)}function OwnerID(){}function arrCopy(arr,offset){offset=offset||0;var len=Math.max(0,arr.length-offset);var newArr=new Array(len);for(var ii=0;ii<len;ii++){newArr[ii]=arr[ii+offset]}return newArr}function ensureSize(iter){if(iter.size===undefined){iter.size=iter.__iterate(returnTrue)}return iter.size}function wrapIndex(iter,index){if(typeof index!=="number"){var uint32Index=index>>>0;if(""+uint32Index!==index||uint32Index===4294967295){return NaN}index=uint32Index}return index<0?ensureSize(iter)+index:index}function returnTrue(){return true}function wholeSlice(begin,end,size){return(begin===0||size!==undefined&&begin<=-size)&&(end===undefined||size!==undefined&&end>=size)}function resolveBegin(begin,size){return resolveIndex(begin,size,0)}function resolveEnd(end,size){return resolveIndex(end,size,size)}function resolveIndex(index,size,defaultIndex){return index===undefined?defaultIndex:index<0?Math.max(0,size+index):size===undefined?index:Math.min(size,index)}var ITERATE_KEYS=0;var ITERATE_VALUES=1;var ITERATE_ENTRIES=2;var REAL_ITERATOR_SYMBOL=typeof Symbol==="function"&&Symbol.iterator;var FAUX_ITERATOR_SYMBOL="@@iterator";var ITERATOR_SYMBOL=REAL_ITERATOR_SYMBOL||FAUX_ITERATOR_SYMBOL;function Iterator(next){this.next=next}Iterator.prototype.toString=function(){return"[Iterator]"};Iterator.KEYS=ITERATE_KEYS;Iterator.VALUES=ITERATE_VALUES;Iterator.ENTRIES=ITERATE_ENTRIES;Iterator.prototype.inspect=Iterator.prototype.toSource=function(){return this.toString()};Iterator.prototype[ITERATOR_SYMBOL]=function(){return this};function iteratorValue(type,k,v,iteratorResult){var value=type===0?k:type===1?v:[k,v];iteratorResult?iteratorResult.value=value:iteratorResult={value:value,done:false};return iteratorResult}function iteratorDone(){return{value:undefined,done:true}}function hasIterator(maybeIterable){return!!getIteratorFn(maybeIterable)}function isIterator(maybeIterator){return maybeIterator&&typeof maybeIterator.next==="function"}function getIterator(iterable){var iteratorFn=getIteratorFn(iterable);return iteratorFn&&iteratorFn.call(iterable)}function getIteratorFn(iterable){var iteratorFn=iterable&&(REAL_ITERATOR_SYMBOL&&iterable[REAL_ITERATOR_SYMBOL]||iterable[FAUX_ITERATOR_SYMBOL]);if(typeof iteratorFn==="function"){return iteratorFn}}function isArrayLike(value){return value&&typeof value.length==="number"}createClass(Seq,Iterable);function Seq(value){return value===null||value===undefined?emptySequence():isIterable(value)?value.toSeq():seqFromValue(value)}Seq.of=function(){return Seq(arguments)};Seq.prototype.toSeq=function(){return this};Seq.prototype.toString=function(){return this.__toString("Seq {","}")};Seq.prototype.cacheResult=function(){if(!this._cache&&this.__iterateUncached){this._cache=this.entrySeq().toArray();this.size=this._cache.length}return this};Seq.prototype.__iterate=function(fn,reverse){return seqIterate(this,fn,reverse,true)};Seq.prototype.__iterator=function(type,reverse){return seqIterator(this,type,reverse,true)};createClass(KeyedSeq,Seq);function KeyedSeq(value){return value===null||value===undefined?emptySequence().toKeyedSeq():isIterable(value)?isKeyed(value)?value.toSeq():value.fromEntrySeq():keyedSeqFromValue(value)}KeyedSeq.prototype.toKeyedSeq=function(){return this};createClass(IndexedSeq,Seq);function IndexedSeq(value){return value===null||value===undefined?emptySequence():!isIterable(value)?indexedSeqFromValue(value):isKeyed(value)?value.entrySeq():value.toIndexedSeq()}IndexedSeq.of=function(){return IndexedSeq(arguments)};IndexedSeq.prototype.toIndexedSeq=function(){return this};IndexedSeq.prototype.toString=function(){return this.__toString("Seq [","]")};IndexedSeq.prototype.__iterate=function(fn,reverse){return seqIterate(this,fn,reverse,false)};IndexedSeq.prototype.__iterator=function(type,reverse){return seqIterator(this,type,reverse,false)};createClass(SetSeq,Seq);function SetSeq(value){return(value===null||value===undefined?emptySequence():!isIterable(value)?indexedSeqFromValue(value):isKeyed(value)?value.entrySeq():value).toSetSeq()}SetSeq.of=function(){return SetSeq(arguments)};SetSeq.prototype.toSetSeq=function(){return this};Seq.isSeq=isSeq;Seq.Keyed=KeyedSeq;Seq.Set=SetSeq;Seq.Indexed=IndexedSeq;var IS_SEQ_SENTINEL="@@__IMMUTABLE_SEQ__@@";Seq.prototype[IS_SEQ_SENTINEL]=true;createClass(ArraySeq,IndexedSeq);function ArraySeq(array){this._array=array;this.size=array.length}ArraySeq.prototype.get=function(index,notSetValue){return this.has(index)?this._array[wrapIndex(this,index)]:notSetValue};ArraySeq.prototype.__iterate=function(fn,reverse){var array=this._array;var maxIndex=array.length-1;for(var ii=0;ii<=maxIndex;ii++){if(fn(array[reverse?maxIndex-ii:ii],ii,this)===false){return ii+1}}return ii};ArraySeq.prototype.__iterator=function(type,reverse){var array=this._array;var maxIndex=array.length-1;var ii=0;return new Iterator(function(){return ii>maxIndex?iteratorDone():iteratorValue(type,ii,array[reverse?maxIndex-ii++:ii++])})};createClass(ObjectSeq,KeyedSeq);function ObjectSeq(object){var keys=Object.keys(object);this._object=object;this._keys=keys;this.size=keys.length}ObjectSeq.prototype.get=function(key,notSetValue){if(notSetValue!==undefined&&!this.has(key)){return notSetValue}return this._object[key]};ObjectSeq.prototype.has=function(key){return this._object.hasOwnProperty(key)};ObjectSeq.prototype.__iterate=function(fn,reverse){var object=this._object;var keys=this._keys;var maxIndex=keys.length-1;for(var ii=0;ii<=maxIndex;ii++){var key=keys[reverse?maxIndex-ii:ii];if(fn(object[key],key,this)===false){return ii+1}}return ii};ObjectSeq.prototype.__iterator=function(type,reverse){var object=this._object;var keys=this._keys;var maxIndex=keys.length-1;var ii=0;return new Iterator(function(){var key=keys[reverse?maxIndex-ii:ii];return ii++>maxIndex?iteratorDone():iteratorValue(type,key,object[key])})};ObjectSeq.prototype[IS_ORDERED_SENTINEL]=true;createClass(IterableSeq,IndexedSeq);function IterableSeq(iterable){this._iterable=iterable;this.size=iterable.length||iterable.size}IterableSeq.prototype.__iterateUncached=function(fn,reverse){if(reverse){return this.cacheResult().__iterate(fn,reverse)}var iterable=this._iterable;var iterator=getIterator(iterable);var iterations=0;if(isIterator(iterator)){var step;while(!(step=iterator.next()).done){if(fn(step.value,iterations++,this)===false){break}}}return iterations};IterableSeq.prototype.__iteratorUncached=function(type,reverse){if(reverse){return this.cacheResult().__iterator(type,reverse)}var iterable=this._iterable;var iterator=getIterator(iterable);if(!isIterator(iterator)){return new Iterator(iteratorDone)}var iterations=0;return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,iterations++,step.value)})};createClass(IteratorSeq,IndexedSeq);function IteratorSeq(iterator){this._iterator=iterator;this._iteratorCache=[]}IteratorSeq.prototype.__iterateUncached=function(fn,reverse){if(reverse){return this.cacheResult().__iterate(fn,reverse)}var iterator=this._iterator;var cache=this._iteratorCache;var iterations=0;while(iterations<cache.length){if(fn(cache[iterations],iterations++,this)===false){return iterations}}var step;while(!(step=iterator.next()).done){var val=step.value;cache[iterations]=val;if(fn(val,iterations++,this)===false){break}}return iterations};IteratorSeq.prototype.__iteratorUncached=function(type,reverse){if(reverse){return this.cacheResult().__iterator(type,reverse)}var iterator=this._iterator;var cache=this._iteratorCache;var iterations=0;return new Iterator(function(){if(iterations>=cache.length){var step=iterator.next();if(step.done){return step}cache[iterations]=step.value}return iteratorValue(type,iterations,cache[iterations++])})};function isSeq(maybeSeq){return!!(maybeSeq&&maybeSeq[IS_SEQ_SENTINEL])}var EMPTY_SEQ;function emptySequence(){return EMPTY_SEQ||(EMPTY_SEQ=new ArraySeq([]))}function keyedSeqFromValue(value){var seq=Array.isArray(value)?new ArraySeq(value).fromEntrySeq():isIterator(value)?new IteratorSeq(value).fromEntrySeq():hasIterator(value)?new IterableSeq(value).fromEntrySeq():typeof value==="object"?new ObjectSeq(value):undefined;if(!seq){throw new TypeError("Expected Array or iterable object of [k, v] entries, "+"or keyed object: "+value)}return seq}function indexedSeqFromValue(value){var seq=maybeIndexedSeqFromValue(value);if(!seq){throw new TypeError("Expected Array or iterable object of values: "+value)}return seq}function seqFromValue(value){var seq=maybeIndexedSeqFromValue(value)||typeof value==="object"&&new ObjectSeq(value);if(!seq){throw new TypeError("Expected Array or iterable object of values, or keyed object: "+value)}return seq}function maybeIndexedSeqFromValue(value){return isArrayLike(value)?new ArraySeq(value):isIterator(value)?new IteratorSeq(value):hasIterator(value)?new IterableSeq(value):undefined}function seqIterate(seq,fn,reverse,useKeys){var cache=seq._cache;if(cache){var maxIndex=cache.length-1;for(var ii=0;ii<=maxIndex;ii++){var entry=cache[reverse?maxIndex-ii:ii];if(fn(entry[1],useKeys?entry[0]:ii,seq)===false){return ii+1}}return ii}return seq.__iterateUncached(fn,reverse)}function seqIterator(seq,type,reverse,useKeys){var cache=seq._cache;if(cache){var maxIndex=cache.length-1;var ii=0;return new Iterator(function(){var entry=cache[reverse?maxIndex-ii:ii];return ii++>maxIndex?iteratorDone():iteratorValue(type,useKeys?entry[0]:ii-1,entry[1])})}return seq.__iteratorUncached(type,reverse)}function fromJS(json,converter){return converter?fromJSWith(converter,json,"",{"":json}):fromJSDefault(json)}function fromJSWith(converter,json,key,parentJSON){if(Array.isArray(json)){return converter.call(parentJSON,key,IndexedSeq(json).map(function(v,k){return fromJSWith(converter,v,k,json)}))}if(isPlainObj(json)){return converter.call(parentJSON,key,KeyedSeq(json).map(function(v,k){return fromJSWith(converter,v,k,json)}))}return json}function fromJSDefault(json){if(Array.isArray(json)){return IndexedSeq(json).map(fromJSDefault).toList()}if(isPlainObj(json)){return KeyedSeq(json).map(fromJSDefault).toMap()}return json}function isPlainObj(value){return value&&(value.constructor===Object||value.constructor===undefined)}function is(valueA,valueB){if(valueA===valueB||valueA!==valueA&&valueB!==valueB){return true}if(!valueA||!valueB){return false}if(typeof valueA.valueOf==="function"&&typeof valueB.valueOf==="function"){valueA=valueA.valueOf();valueB=valueB.valueOf();if(valueA===valueB||valueA!==valueA&&valueB!==valueB){return true}if(!valueA||!valueB){return false}}if(typeof valueA.equals==="function"&&typeof valueB.equals==="function"&&valueA.equals(valueB)){return true}return false}function deepEqual(a,b){if(a===b){return true}if(!isIterable(b)||a.size!==undefined&&b.size!==undefined&&a.size!==b.size||a.__hash!==undefined&&b.__hash!==undefined&&a.__hash!==b.__hash||isKeyed(a)!==isKeyed(b)||isIndexed(a)!==isIndexed(b)||isOrdered(a)!==isOrdered(b)){return false}if(a.size===0&&b.size===0){return true}var notAssociative=!isAssociative(a);if(isOrdered(a)){var entries=a.entries();return b.every(function(v,k){var entry=entries.next().value;return entry&&is(entry[1],v)&&(notAssociative||is(entry[0],k))})&&entries.next().done}var flipped=false;if(a.size===undefined){if(b.size===undefined){if(typeof a.cacheResult==="function"){a.cacheResult()}}else{flipped=true;var _=a;a=b;b=_}}var allEqual=true;var bSize=b.__iterate(function(v,k){if(notAssociative?!a.has(v):flipped?!is(v,a.get(k,NOT_SET)):!is(a.get(k,NOT_SET),v)){allEqual=false;return false}});return allEqual&&a.size===bSize}createClass(Repeat,IndexedSeq);function Repeat(value,times){if(!(this instanceof Repeat)){return new Repeat(value,times)}this._value=value;this.size=times===undefined?Infinity:Math.max(0,times);if(this.size===0){if(EMPTY_REPEAT){return EMPTY_REPEAT}EMPTY_REPEAT=this}}Repeat.prototype.toString=function(){if(this.size===0){return"Repeat []"}return"Repeat [ "+this._value+" "+this.size+" times ]"};Repeat.prototype.get=function(index,notSetValue){return this.has(index)?this._value:notSetValue};Repeat.prototype.includes=function(searchValue){return is(this._value,searchValue)};Repeat.prototype.slice=function(begin,end){var size=this.size;return wholeSlice(begin,end,size)?this:new Repeat(this._value,resolveEnd(end,size)-resolveBegin(begin,size))};Repeat.prototype.reverse=function(){return this};Repeat.prototype.indexOf=function(searchValue){if(is(this._value,searchValue)){return 0}return-1};Repeat.prototype.lastIndexOf=function(searchValue){if(is(this._value,searchValue)){return this.size}return-1};Repeat.prototype.__iterate=function(fn,reverse){for(var ii=0;ii<this.size;ii++){if(fn(this._value,ii,this)===false){return ii+1}}return ii};Repeat.prototype.__iterator=function(type,reverse){var this$0=this;var ii=0;return new Iterator(function(){return ii<this$0.size?iteratorValue(type,ii++,this$0._value):iteratorDone()})};Repeat.prototype.equals=function(other){return other instanceof Repeat?is(this._value,other._value):deepEqual(other)};var EMPTY_REPEAT;function invariant(condition,error){if(!condition)throw new Error(error)}createClass(Range,IndexedSeq);function Range(start,end,step){if(!(this instanceof Range)){return new Range(start,end,step)}invariant(step!==0,"Cannot step a Range by 0");start=start||0;if(end===undefined){end=Infinity}step=step===undefined?1:Math.abs(step);if(end<start){step=-step}this._start=start;this._end=end;this._step=step;this.size=Math.max(0,Math.ceil((end-start)/step-1)+1);if(this.size===0){if(EMPTY_RANGE){return EMPTY_RANGE}EMPTY_RANGE=this}}Range.prototype.toString=function(){if(this.size===0){return"Range []"}return"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"};Range.prototype.get=function(index,notSetValue){return this.has(index)?this._start+wrapIndex(this,index)*this._step:notSetValue};Range.prototype.includes=function(searchValue){var possibleIndex=(searchValue-this._start)/this._step;return possibleIndex>=0&&possibleIndex<this.size&&possibleIndex===Math.floor(possibleIndex)};Range.prototype.slice=function(begin,end){if(wholeSlice(begin,end,this.size)){return this}begin=resolveBegin(begin,this.size);end=resolveEnd(end,this.size);if(end<=begin){return new Range(0,0)}return new Range(this.get(begin,this._end),this.get(end,this._end),this._step)};Range.prototype.indexOf=function(searchValue){var offsetValue=searchValue-this._start;if(offsetValue%this._step===0){var index=offsetValue/this._step;if(index>=0&&index<this.size){return index}}return-1};Range.prototype.lastIndexOf=function(searchValue){return this.indexOf(searchValue)};Range.prototype.__iterate=function(fn,reverse){var maxIndex=this.size-1;var step=this._step;var value=reverse?this._start+maxIndex*step:this._start;for(var ii=0;ii<=maxIndex;ii++){if(fn(value,ii,this)===false){return ii+1}value+=reverse?-step:step}return ii};Range.prototype.__iterator=function(type,reverse){var maxIndex=this.size-1;var step=this._step;var value=reverse?this._start+maxIndex*step:this._start;var ii=0;return new Iterator(function(){var v=value;value+=reverse?-step:step;return ii>maxIndex?iteratorDone():iteratorValue(type,ii++,v)})};Range.prototype.equals=function(other){return other instanceof Range?this._start===other._start&&this._end===other._end&&this._step===other._step:deepEqual(this,other)};var EMPTY_RANGE;createClass(Collection,Iterable);function Collection(){throw TypeError("Abstract")}createClass(KeyedCollection,Collection);function KeyedCollection(){}createClass(IndexedCollection,Collection);function IndexedCollection(){}createClass(SetCollection,Collection);function SetCollection(){}Collection.Keyed=KeyedCollection;Collection.Indexed=IndexedCollection;Collection.Set=SetCollection;var imul=typeof Math.imul==="function"&&Math.imul(4294967295,2)===-2?Math.imul:function imul(a,b){a=a|0;b=b|0;var c=a&65535;var d=b&65535;return c*d+((a>>>16)*d+c*(b>>>16)<<16>>>0)|0};function smi(i32){return i32>>>1&1073741824|i32&3221225471}function hash(o){if(o===false||o===null||o===undefined){return 0}if(typeof o.valueOf==="function"){o=o.valueOf();if(o===false||o===null||o===undefined){return 0}}if(o===true){return 1}var type=typeof o;if(type==="number"){if(o!==o||o===Infinity){return 0}var h=o|0;if(h!==o){h^=o*4294967295}while(o>4294967295){o/=4294967295;h^=o}return smi(h)}if(type==="string"){return o.length>STRING_HASH_CACHE_MIN_STRLEN?cachedHashString(o):hashString(o)}if(typeof o.hashCode==="function"){return o.hashCode()}if(type==="object"){return hashJSObj(o)}if(typeof o.toString==="function"){return hashString(o.toString())}throw new Error("Value type "+type+" cannot be hashed.")}function cachedHashString(string){var hash=stringHashCache[string];if(hash===undefined){hash=hashString(string);if(STRING_HASH_CACHE_SIZE===STRING_HASH_CACHE_MAX_SIZE){STRING_HASH_CACHE_SIZE=0;stringHashCache={}}STRING_HASH_CACHE_SIZE++;stringHashCache[string]=hash}return hash}function hashString(string){var hash=0;for(var ii=0;ii<string.length;ii++){hash=31*hash+string.charCodeAt(ii)|0}return smi(hash)}function hashJSObj(obj){var hash;if(usingWeakMap){hash=weakMap.get(obj);if(hash!==undefined){return hash}}hash=obj[UID_HASH_KEY];if(hash!==undefined){return hash}if(!canDefineProperty){hash=obj.propertyIsEnumerable&&obj.propertyIsEnumerable[UID_HASH_KEY];if(hash!==undefined){return hash}hash=getIENodeHash(obj);if(hash!==undefined){return hash}}hash=++objHashUID;if(objHashUID&1073741824){objHashUID=0}if(usingWeakMap){weakMap.set(obj,hash)}else if(isExtensible!==undefined&&isExtensible(obj)===false){throw new Error("Non-extensible objects are not allowed as keys.")}else if(canDefineProperty){Object.defineProperty(obj,UID_HASH_KEY,{enumerable:false,configurable:false,writable:false,value:hash})}else if(obj.propertyIsEnumerable!==undefined&&obj.propertyIsEnumerable===obj.constructor.prototype.propertyIsEnumerable){obj.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)};obj.propertyIsEnumerable[UID_HASH_KEY]=hash}else if(obj.nodeType!==undefined){obj[UID_HASH_KEY]=hash}else{throw new Error("Unable to set a non-enumerable property on object.")}return hash}var isExtensible=Object.isExtensible;var canDefineProperty=function(){try{Object.defineProperty({},"@",{});return true}catch(e){return false}}();function getIENodeHash(node){if(node&&node.nodeType>0){switch(node.nodeType){case 1:return node.uniqueID;case 9:return node.documentElement&&node.documentElement.uniqueID}}}var usingWeakMap=typeof WeakMap==="function";var weakMap;if(usingWeakMap){weakMap=new WeakMap}var objHashUID=0;var UID_HASH_KEY="__immutablehash__";if(typeof Symbol==="function"){UID_HASH_KEY=Symbol(UID_HASH_KEY)}var STRING_HASH_CACHE_MIN_STRLEN=16;var STRING_HASH_CACHE_MAX_SIZE=255;var STRING_HASH_CACHE_SIZE=0;var stringHashCache={};function assertNotInfinite(size){invariant(size!==Infinity,"Cannot perform this action with an infinite size.")}createClass(Map,KeyedCollection);function Map(value){return value===null||value===undefined?emptyMap():isMap(value)&&!isOrdered(value)?value:emptyMap().withMutations(function(map){var iter=KeyedIterable(value);assertNotInfinite(iter.size);iter.forEach(function(v,k){return map.set(k,v)})})}Map.of=function(){var keyValues=SLICE$0.call(arguments,0);return emptyMap().withMutations(function(map){for(var i=0;i<keyValues.length;i+=2){if(i+1>=keyValues.length){throw new Error("Missing value for key: "+keyValues[i])}map.set(keyValues[i],keyValues[i+1])}})};Map.prototype.toString=function(){return this.__toString("Map {","}")};Map.prototype.get=function(k,notSetValue){return this._root?this._root.get(0,undefined,k,notSetValue):notSetValue};Map.prototype.set=function(k,v){return updateMap(this,k,v)};Map.prototype.setIn=function(keyPath,v){return this.updateIn(keyPath,NOT_SET,function(){return v})};Map.prototype.remove=function(k){return updateMap(this,k,NOT_SET)};Map.prototype.deleteIn=function(keyPath){return this.updateIn(keyPath,function(){return NOT_SET})};Map.prototype.update=function(k,notSetValue,updater){return arguments.length===1?k(this):this.updateIn([k],notSetValue,updater)};Map.prototype.updateIn=function(keyPath,notSetValue,updater){if(!updater){updater=notSetValue;notSetValue=undefined}var updatedValue=updateInDeepMap(this,forceIterator(keyPath),notSetValue,updater);return updatedValue===NOT_SET?undefined:updatedValue};Map.prototype.clear=function(){if(this.size===0){return this}if(this.__ownerID){this.size=0;this._root=null;this.__hash=undefined;this.__altered=true;return this}return emptyMap()};Map.prototype.merge=function(){return mergeIntoMapWith(this,undefined,arguments)};Map.prototype.mergeWith=function(merger){var iters=SLICE$0.call(arguments,1);return mergeIntoMapWith(this,merger,iters)};Map.prototype.mergeIn=function(keyPath){var iters=SLICE$0.call(arguments,1);return this.updateIn(keyPath,emptyMap(),function(m){return typeof m.merge==="function"?m.merge.apply(m,iters):iters[iters.length-1]})};Map.prototype.mergeDeep=function(){return mergeIntoMapWith(this,deepMerger,arguments)};Map.prototype.mergeDeepWith=function(merger){var iters=SLICE$0.call(arguments,1);return mergeIntoMapWith(this,deepMergerWith(merger),iters)};Map.prototype.mergeDeepIn=function(keyPath){var iters=SLICE$0.call(arguments,1);return this.updateIn(keyPath,emptyMap(),function(m){return typeof m.mergeDeep==="function"?m.mergeDeep.apply(m,iters):iters[iters.length-1]})};Map.prototype.sort=function(comparator){return OrderedMap(sortFactory(this,comparator))};Map.prototype.sortBy=function(mapper,comparator){return OrderedMap(sortFactory(this,comparator,mapper))};Map.prototype.withMutations=function(fn){var mutable=this.asMutable();fn(mutable);return mutable.wasAltered()?mutable.__ensureOwner(this.__ownerID):this};Map.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new OwnerID)};Map.prototype.asImmutable=function(){return this.__ensureOwner()};Map.prototype.wasAltered=function(){return this.__altered};Map.prototype.__iterator=function(type,reverse){return new MapIterator(this,type,reverse)};Map.prototype.__iterate=function(fn,reverse){var this$0=this;var iterations=0;this._root&&this._root.iterate(function(entry){iterations++;return fn(entry[1],entry[0],this$0)},reverse);return iterations};Map.prototype.__ensureOwner=function(ownerID){if(ownerID===this.__ownerID){return this}if(!ownerID){this.__ownerID=ownerID;this.__altered=false;return this}return makeMap(this.size,this._root,ownerID,this.__hash)};function isMap(maybeMap){return!!(maybeMap&&maybeMap[IS_MAP_SENTINEL])}Map.isMap=isMap;var IS_MAP_SENTINEL="@@__IMMUTABLE_MAP__@@";var MapPrototype=Map.prototype;MapPrototype[IS_MAP_SENTINEL]=true;MapPrototype[DELETE]=MapPrototype.remove;MapPrototype.removeIn=MapPrototype.deleteIn;function ArrayMapNode(ownerID,entries){this.ownerID=ownerID;this.entries=entries}ArrayMapNode.prototype.get=function(shift,keyHash,key,notSetValue){var entries=this.entries;for(var ii=0,len=entries.length;ii<len;ii++){if(is(key,entries[ii][0])){return entries[ii][1]}}return notSetValue};ArrayMapNode.prototype.update=function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){var removed=value===NOT_SET;var entries=this.entries;var idx=0;for(var len=entries.length;idx<len;idx++){if(is(key,entries[idx][0])){break}}var exists=idx<len;if(exists?entries[idx][1]===value:removed){return this}SetRef(didAlter);(removed||!exists)&&SetRef(didChangeSize);if(removed&&entries.length===1){return}if(!exists&&!removed&&entries.length>=MAX_ARRAY_MAP_SIZE){return createNodes(ownerID,entries,key,value)}var isEditable=ownerID&&ownerID===this.ownerID;var newEntries=isEditable?entries:arrCopy(entries);if(exists){if(removed){idx===len-1?newEntries.pop():newEntries[idx]=newEntries.pop()}else{newEntries[idx]=[key,value]}}else{newEntries.push([key,value])}if(isEditable){this.entries=newEntries;return this}return new ArrayMapNode(ownerID,newEntries)};function BitmapIndexedNode(ownerID,bitmap,nodes){this.ownerID=ownerID;this.bitmap=bitmap;this.nodes=nodes}BitmapIndexedNode.prototype.get=function(shift,keyHash,key,notSetValue){if(keyHash===undefined){keyHash=hash(key)}var bit=1<<((shift===0?keyHash:keyHash>>>shift)&MASK);var bitmap=this.bitmap;return(bitmap&bit)===0?notSetValue:this.nodes[popCount(bitmap&bit-1)].get(shift+SHIFT,keyHash,key,notSetValue)};BitmapIndexedNode.prototype.update=function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){if(keyHash===undefined){keyHash=hash(key)}var keyHashFrag=(shift===0?keyHash:keyHash>>>shift)&MASK;var bit=1<<keyHashFrag;var bitmap=this.bitmap;var exists=(bitmap&bit)!==0;if(!exists&&value===NOT_SET){return this}var idx=popCount(bitmap&bit-1);var nodes=this.nodes;var node=exists?nodes[idx]:undefined;var newNode=updateNode(node,ownerID,shift+SHIFT,keyHash,key,value,didChangeSize,didAlter);if(newNode===node){return this}if(!exists&&newNode&&nodes.length>=MAX_BITMAP_INDEXED_SIZE){return expandNodes(ownerID,nodes,bitmap,keyHashFrag,newNode)}if(exists&&!newNode&&nodes.length===2&&isLeafNode(nodes[idx^1])){return nodes[idx^1]}if(exists&&newNode&&nodes.length===1&&isLeafNode(newNode)){return newNode}var isEditable=ownerID&&ownerID===this.ownerID;var newBitmap=exists?newNode?bitmap:bitmap^bit:bitmap|bit;var newNodes=exists?newNode?setIn(nodes,idx,newNode,isEditable):spliceOut(nodes,idx,isEditable):spliceIn(nodes,idx,newNode,isEditable);if(isEditable){this.bitmap=newBitmap;this.nodes=newNodes;return this}return new BitmapIndexedNode(ownerID,newBitmap,newNodes)};function HashArrayMapNode(ownerID,count,nodes){this.ownerID=ownerID;this.count=count;this.nodes=nodes}HashArrayMapNode.prototype.get=function(shift,keyHash,key,notSetValue){if(keyHash===undefined){keyHash=hash(key)}var idx=(shift===0?keyHash:keyHash>>>shift)&MASK;var node=this.nodes[idx];return node?node.get(shift+SHIFT,keyHash,key,notSetValue):notSetValue};HashArrayMapNode.prototype.update=function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){if(keyHash===undefined){keyHash=hash(key)}var idx=(shift===0?keyHash:keyHash>>>shift)&MASK;var removed=value===NOT_SET;var nodes=this.nodes;var node=nodes[idx];if(removed&&!node){return this}var newNode=updateNode(node,ownerID,shift+SHIFT,keyHash,key,value,didChangeSize,didAlter);if(newNode===node){return this}var newCount=this.count;if(!node){newCount++}else if(!newNode){newCount--;if(newCount<MIN_HASH_ARRAY_MAP_SIZE){return packNodes(ownerID,nodes,newCount,idx)}}var isEditable=ownerID&&ownerID===this.ownerID;var newNodes=setIn(nodes,idx,newNode,isEditable);if(isEditable){this.count=newCount;this.nodes=newNodes;return this}return new HashArrayMapNode(ownerID,newCount,newNodes)};function HashCollisionNode(ownerID,keyHash,entries){this.ownerID=ownerID;this.keyHash=keyHash;this.entries=entries}HashCollisionNode.prototype.get=function(shift,keyHash,key,notSetValue){var entries=this.entries;for(var ii=0,len=entries.length;ii<len;ii++){if(is(key,entries[ii][0])){return entries[ii][1]}}return notSetValue};HashCollisionNode.prototype.update=function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){if(keyHash===undefined){keyHash=hash(key)}var removed=value===NOT_SET;if(keyHash!==this.keyHash){if(removed){return this}SetRef(didAlter);SetRef(didChangeSize);return mergeIntoNode(this,ownerID,shift,keyHash,[key,value])}var entries=this.entries;var idx=0;for(var len=entries.length;idx<len;idx++){if(is(key,entries[idx][0])){break}}var exists=idx<len;if(exists?entries[idx][1]===value:removed){return this}SetRef(didAlter);(removed||!exists)&&SetRef(didChangeSize);if(removed&&len===2){return new ValueNode(ownerID,this.keyHash,entries[idx^1])}var isEditable=ownerID&&ownerID===this.ownerID;var newEntries=isEditable?entries:arrCopy(entries);if(exists){if(removed){idx===len-1?newEntries.pop():newEntries[idx]=newEntries.pop()}else{newEntries[idx]=[key,value]}}else{newEntries.push([key,value])}if(isEditable){this.entries=newEntries;return this}return new HashCollisionNode(ownerID,this.keyHash,newEntries)};function ValueNode(ownerID,keyHash,entry){this.ownerID=ownerID;this.keyHash=keyHash;this.entry=entry}ValueNode.prototype.get=function(shift,keyHash,key,notSetValue){return is(key,this.entry[0])?this.entry[1]:notSetValue;
};ValueNode.prototype.update=function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){var removed=value===NOT_SET;var keyMatch=is(key,this.entry[0]);if(keyMatch?value===this.entry[1]:removed){return this}SetRef(didAlter);if(removed){SetRef(didChangeSize);return}if(keyMatch){if(ownerID&&ownerID===this.ownerID){this.entry[1]=value;return this}return new ValueNode(ownerID,this.keyHash,[key,value])}SetRef(didChangeSize);return mergeIntoNode(this,ownerID,shift,hash(key),[key,value])};ArrayMapNode.prototype.iterate=HashCollisionNode.prototype.iterate=function(fn,reverse){var entries=this.entries;for(var ii=0,maxIndex=entries.length-1;ii<=maxIndex;ii++){if(fn(entries[reverse?maxIndex-ii:ii])===false){return false}}};BitmapIndexedNode.prototype.iterate=HashArrayMapNode.prototype.iterate=function(fn,reverse){var nodes=this.nodes;for(var ii=0,maxIndex=nodes.length-1;ii<=maxIndex;ii++){var node=nodes[reverse?maxIndex-ii:ii];if(node&&node.iterate(fn,reverse)===false){return false}}};ValueNode.prototype.iterate=function(fn,reverse){return fn(this.entry)};createClass(MapIterator,Iterator);function MapIterator(map,type,reverse){this._type=type;this._reverse=reverse;this._stack=map._root&&mapIteratorFrame(map._root)}MapIterator.prototype.next=function(){var type=this._type;var stack=this._stack;while(stack){var node=stack.node;var index=stack.index++;var maxIndex;if(node.entry){if(index===0){return mapIteratorValue(type,node.entry)}}else if(node.entries){maxIndex=node.entries.length-1;if(index<=maxIndex){return mapIteratorValue(type,node.entries[this._reverse?maxIndex-index:index])}}else{maxIndex=node.nodes.length-1;if(index<=maxIndex){var subNode=node.nodes[this._reverse?maxIndex-index:index];if(subNode){if(subNode.entry){return mapIteratorValue(type,subNode.entry)}stack=this._stack=mapIteratorFrame(subNode,stack)}continue}}stack=this._stack=this._stack.__prev}return iteratorDone()};function mapIteratorValue(type,entry){return iteratorValue(type,entry[0],entry[1])}function mapIteratorFrame(node,prev){return{node:node,index:0,__prev:prev}}function makeMap(size,root,ownerID,hash){var map=Object.create(MapPrototype);map.size=size;map._root=root;map.__ownerID=ownerID;map.__hash=hash;map.__altered=false;return map}var EMPTY_MAP;function emptyMap(){return EMPTY_MAP||(EMPTY_MAP=makeMap(0))}function updateMap(map,k,v){var newRoot;var newSize;if(!map._root){if(v===NOT_SET){return map}newSize=1;newRoot=new ArrayMapNode(map.__ownerID,[[k,v]])}else{var didChangeSize=MakeRef(CHANGE_LENGTH);var didAlter=MakeRef(DID_ALTER);newRoot=updateNode(map._root,map.__ownerID,0,undefined,k,v,didChangeSize,didAlter);if(!didAlter.value){return map}newSize=map.size+(didChangeSize.value?v===NOT_SET?-1:1:0)}if(map.__ownerID){map.size=newSize;map._root=newRoot;map.__hash=undefined;map.__altered=true;return map}return newRoot?makeMap(newSize,newRoot):emptyMap()}function updateNode(node,ownerID,shift,keyHash,key,value,didChangeSize,didAlter){if(!node){if(value===NOT_SET){return node}SetRef(didAlter);SetRef(didChangeSize);return new ValueNode(ownerID,keyHash,[key,value])}return node.update(ownerID,shift,keyHash,key,value,didChangeSize,didAlter)}function isLeafNode(node){return node.constructor===ValueNode||node.constructor===HashCollisionNode}function mergeIntoNode(node,ownerID,shift,keyHash,entry){if(node.keyHash===keyHash){return new HashCollisionNode(ownerID,keyHash,[node.entry,entry])}var idx1=(shift===0?node.keyHash:node.keyHash>>>shift)&MASK;var idx2=(shift===0?keyHash:keyHash>>>shift)&MASK;var newNode;var nodes=idx1===idx2?[mergeIntoNode(node,ownerID,shift+SHIFT,keyHash,entry)]:(newNode=new ValueNode(ownerID,keyHash,entry),idx1<idx2?[node,newNode]:[newNode,node]);return new BitmapIndexedNode(ownerID,1<<idx1|1<<idx2,nodes)}function createNodes(ownerID,entries,key,value){if(!ownerID){ownerID=new OwnerID}var node=new ValueNode(ownerID,hash(key),[key,value]);for(var ii=0;ii<entries.length;ii++){var entry=entries[ii];node=node.update(ownerID,0,undefined,entry[0],entry[1])}return node}function packNodes(ownerID,nodes,count,excluding){var bitmap=0;var packedII=0;var packedNodes=new Array(count);for(var ii=0,bit=1,len=nodes.length;ii<len;ii++,bit<<=1){var node=nodes[ii];if(node!==undefined&&ii!==excluding){bitmap|=bit;packedNodes[packedII++]=node}}return new BitmapIndexedNode(ownerID,bitmap,packedNodes)}function expandNodes(ownerID,nodes,bitmap,including,node){var count=0;var expandedNodes=new Array(SIZE);for(var ii=0;bitmap!==0;ii++,bitmap>>>=1){expandedNodes[ii]=bitmap&1?nodes[count++]:undefined}expandedNodes[including]=node;return new HashArrayMapNode(ownerID,count+1,expandedNodes)}function mergeIntoMapWith(map,merger,iterables){var iters=[];for(var ii=0;ii<iterables.length;ii++){var value=iterables[ii];var iter=KeyedIterable(value);if(!isIterable(value)){iter=iter.map(function(v){return fromJS(v)})}iters.push(iter)}return mergeIntoCollectionWith(map,merger,iters)}function deepMerger(existing,value,key){return existing&&existing.mergeDeep&&isIterable(value)?existing.mergeDeep(value):is(existing,value)?existing:value}function deepMergerWith(merger){return function(existing,value,key){if(existing&&existing.mergeDeepWith&&isIterable(value)){return existing.mergeDeepWith(merger,value)}var nextValue=merger(existing,value,key);return is(existing,nextValue)?existing:nextValue}}function mergeIntoCollectionWith(collection,merger,iters){iters=iters.filter(function(x){return x.size!==0});if(iters.length===0){return collection}if(collection.size===0&&!collection.__ownerID&&iters.length===1){return collection.constructor(iters[0])}return collection.withMutations(function(collection){var mergeIntoMap=merger?function(value,key){collection.update(key,NOT_SET,function(existing){return existing===NOT_SET?value:merger(existing,value,key)})}:function(value,key){collection.set(key,value)};for(var ii=0;ii<iters.length;ii++){iters[ii].forEach(mergeIntoMap)}})}function updateInDeepMap(existing,keyPathIter,notSetValue,updater){var isNotSet=existing===NOT_SET;var step=keyPathIter.next();if(step.done){var existingValue=isNotSet?notSetValue:existing;var newValue=updater(existingValue);return newValue===existingValue?existing:newValue}invariant(isNotSet||existing&&existing.set,"invalid keyPath");var key=step.value;var nextExisting=isNotSet?NOT_SET:existing.get(key,NOT_SET);var nextUpdated=updateInDeepMap(nextExisting,keyPathIter,notSetValue,updater);return nextUpdated===nextExisting?existing:nextUpdated===NOT_SET?existing.remove(key):(isNotSet?emptyMap():existing).set(key,nextUpdated)}function popCount(x){x=x-(x>>1&1431655765);x=(x&858993459)+(x>>2&858993459);x=x+(x>>4)&252645135;x=x+(x>>8);x=x+(x>>16);return x&127}function setIn(array,idx,val,canEdit){var newArray=canEdit?array:arrCopy(array);newArray[idx]=val;return newArray}function spliceIn(array,idx,val,canEdit){var newLen=array.length+1;if(canEdit&&idx+1===newLen){array[idx]=val;return array}var newArray=new Array(newLen);var after=0;for(var ii=0;ii<newLen;ii++){if(ii===idx){newArray[ii]=val;after=-1}else{newArray[ii]=array[ii+after]}}return newArray}function spliceOut(array,idx,canEdit){var newLen=array.length-1;if(canEdit&&idx===newLen){array.pop();return array}var newArray=new Array(newLen);var after=0;for(var ii=0;ii<newLen;ii++){if(ii===idx){after=1}newArray[ii]=array[ii+after]}return newArray}var MAX_ARRAY_MAP_SIZE=SIZE/4;var MAX_BITMAP_INDEXED_SIZE=SIZE/2;var MIN_HASH_ARRAY_MAP_SIZE=SIZE/4;createClass(List,IndexedCollection);function List(value){var empty=emptyList();if(value===null||value===undefined){return empty}if(isList(value)){return value}var iter=IndexedIterable(value);var size=iter.size;if(size===0){return empty}assertNotInfinite(size);if(size>0&&size<SIZE){return makeList(0,size,SHIFT,null,new VNode(iter.toArray()))}return empty.withMutations(function(list){list.setSize(size);iter.forEach(function(v,i){return list.set(i,v)})})}List.of=function(){return this(arguments)};List.prototype.toString=function(){return this.__toString("List [","]")};List.prototype.get=function(index,notSetValue){index=wrapIndex(this,index);if(index>=0&&index<this.size){index+=this._origin;var node=listNodeFor(this,index);return node&&node.array[index&MASK]}return notSetValue};List.prototype.set=function(index,value){return updateList(this,index,value)};List.prototype.remove=function(index){return!this.has(index)?this:index===0?this.shift():index===this.size-1?this.pop():this.splice(index,1)};List.prototype.insert=function(index,value){return this.splice(index,0,value)};List.prototype.clear=function(){if(this.size===0){return this}if(this.__ownerID){this.size=this._origin=this._capacity=0;this._level=SHIFT;this._root=this._tail=null;this.__hash=undefined;this.__altered=true;return this}return emptyList()};List.prototype.push=function(){var values=arguments;var oldSize=this.size;return this.withMutations(function(list){setListBounds(list,0,oldSize+values.length);for(var ii=0;ii<values.length;ii++){list.set(oldSize+ii,values[ii])}})};List.prototype.pop=function(){return setListBounds(this,0,-1)};List.prototype.unshift=function(){var values=arguments;return this.withMutations(function(list){setListBounds(list,-values.length);for(var ii=0;ii<values.length;ii++){list.set(ii,values[ii])}})};List.prototype.shift=function(){return setListBounds(this,1)};List.prototype.merge=function(){return mergeIntoListWith(this,undefined,arguments)};List.prototype.mergeWith=function(merger){var iters=SLICE$0.call(arguments,1);return mergeIntoListWith(this,merger,iters)};List.prototype.mergeDeep=function(){return mergeIntoListWith(this,deepMerger,arguments)};List.prototype.mergeDeepWith=function(merger){var iters=SLICE$0.call(arguments,1);return mergeIntoListWith(this,deepMergerWith(merger),iters)};List.prototype.setSize=function(size){return setListBounds(this,0,size)};List.prototype.slice=function(begin,end){var size=this.size;if(wholeSlice(begin,end,size)){return this}return setListBounds(this,resolveBegin(begin,size),resolveEnd(end,size))};List.prototype.__iterator=function(type,reverse){var index=0;var values=iterateList(this,reverse);return new Iterator(function(){var value=values();return value===DONE?iteratorDone():iteratorValue(type,index++,value)})};List.prototype.__iterate=function(fn,reverse){var index=0;var values=iterateList(this,reverse);var value;while((value=values())!==DONE){if(fn(value,index++,this)===false){break}}return index};List.prototype.__ensureOwner=function(ownerID){if(ownerID===this.__ownerID){return this}if(!ownerID){this.__ownerID=ownerID;return this}return makeList(this._origin,this._capacity,this._level,this._root,this._tail,ownerID,this.__hash)};function isList(maybeList){return!!(maybeList&&maybeList[IS_LIST_SENTINEL])}List.isList=isList;var IS_LIST_SENTINEL="@@__IMMUTABLE_LIST__@@";var ListPrototype=List.prototype;ListPrototype[IS_LIST_SENTINEL]=true;ListPrototype[DELETE]=ListPrototype.remove;ListPrototype.setIn=MapPrototype.setIn;ListPrototype.deleteIn=ListPrototype.removeIn=MapPrototype.removeIn;ListPrototype.update=MapPrototype.update;ListPrototype.updateIn=MapPrototype.updateIn;ListPrototype.mergeIn=MapPrototype.mergeIn;ListPrototype.mergeDeepIn=MapPrototype.mergeDeepIn;ListPrototype.withMutations=MapPrototype.withMutations;ListPrototype.asMutable=MapPrototype.asMutable;ListPrototype.asImmutable=MapPrototype.asImmutable;ListPrototype.wasAltered=MapPrototype.wasAltered;function VNode(array,ownerID){this.array=array;this.ownerID=ownerID}VNode.prototype.removeBefore=function(ownerID,level,index){if(index===level?1<<level:0||this.array.length===0){return this}var originIndex=index>>>level&MASK;if(originIndex>=this.array.length){return new VNode([],ownerID)}var removingFirst=originIndex===0;var newChild;if(level>0){var oldChild=this.array[originIndex];newChild=oldChild&&oldChild.removeBefore(ownerID,level-SHIFT,index);if(newChild===oldChild&&removingFirst){return this}}if(removingFirst&&!newChild){return this}var editable=editableVNode(this,ownerID);if(!removingFirst){for(var ii=0;ii<originIndex;ii++){editable.array[ii]=undefined}}if(newChild){editable.array[originIndex]=newChild}return editable};VNode.prototype.removeAfter=function(ownerID,level,index){if(index===(level?1<<level:0)||this.array.length===0){return this}var sizeIndex=index-1>>>level&MASK;if(sizeIndex>=this.array.length){return this}var newChild;if(level>0){var oldChild=this.array[sizeIndex];newChild=oldChild&&oldChild.removeAfter(ownerID,level-SHIFT,index);if(newChild===oldChild&&sizeIndex===this.array.length-1){return this}}var editable=editableVNode(this,ownerID);editable.array.splice(sizeIndex+1);if(newChild){editable.array[sizeIndex]=newChild}return editable};var DONE={};function iterateList(list,reverse){var left=list._origin;var right=list._capacity;var tailPos=getTailOffset(right);var tail=list._tail;return iterateNodeOrLeaf(list._root,list._level,0);function iterateNodeOrLeaf(node,level,offset){return level===0?iterateLeaf(node,offset):iterateNode(node,level,offset)}function iterateLeaf(node,offset){var array=offset===tailPos?tail&&tail.array:node&&node.array;var from=offset>left?0:left-offset;var to=right-offset;if(to>SIZE){to=SIZE}return function(){if(from===to){return DONE}var idx=reverse?--to:from++;return array&&array[idx]}}function iterateNode(node,level,offset){var values;var array=node&&node.array;var from=offset>left?0:left-offset>>level;var to=(right-offset>>level)+1;if(to>SIZE){to=SIZE}return function(){do{if(values){var value=values();if(value!==DONE){return value}values=null}if(from===to){return DONE}var idx=reverse?--to:from++;values=iterateNodeOrLeaf(array&&array[idx],level-SHIFT,offset+(idx<<level))}while(true)}}}function makeList(origin,capacity,level,root,tail,ownerID,hash){var list=Object.create(ListPrototype);list.size=capacity-origin;list._origin=origin;list._capacity=capacity;list._level=level;list._root=root;list._tail=tail;list.__ownerID=ownerID;list.__hash=hash;list.__altered=false;return list}var EMPTY_LIST;function emptyList(){return EMPTY_LIST||(EMPTY_LIST=makeList(0,0,SHIFT))}function updateList(list,index,value){index=wrapIndex(list,index);if(index!==index){return list}if(index>=list.size||index<0){return list.withMutations(function(list){index<0?setListBounds(list,index).set(0,value):setListBounds(list,0,index+1).set(index,value)})}index+=list._origin;var newTail=list._tail;var newRoot=list._root;var didAlter=MakeRef(DID_ALTER);if(index>=getTailOffset(list._capacity)){newTail=updateVNode(newTail,list.__ownerID,0,index,value,didAlter)}else{newRoot=updateVNode(newRoot,list.__ownerID,list._level,index,value,didAlter)}if(!didAlter.value){return list}if(list.__ownerID){list._root=newRoot;list._tail=newTail;list.__hash=undefined;list.__altered=true;return list}return makeList(list._origin,list._capacity,list._level,newRoot,newTail)}function updateVNode(node,ownerID,level,index,value,didAlter){var idx=index>>>level&MASK;var nodeHas=node&&idx<node.array.length;if(!nodeHas&&value===undefined){return node}var newNode;if(level>0){var lowerNode=node&&node.array[idx];var newLowerNode=updateVNode(lowerNode,ownerID,level-SHIFT,index,value,didAlter);if(newLowerNode===lowerNode){return node}newNode=editableVNode(node,ownerID);newNode.array[idx]=newLowerNode;return newNode}if(nodeHas&&node.array[idx]===value){return node}SetRef(didAlter);newNode=editableVNode(node,ownerID);if(value===undefined&&idx===newNode.array.length-1){newNode.array.pop()}else{newNode.array[idx]=value}return newNode}function editableVNode(node,ownerID){if(ownerID&&node&&ownerID===node.ownerID){return node}return new VNode(node?node.array.slice():[],ownerID)}function listNodeFor(list,rawIndex){if(rawIndex>=getTailOffset(list._capacity)){return list._tail}if(rawIndex<1<<list._level+SHIFT){var node=list._root;var level=list._level;while(node&&level>0){node=node.array[rawIndex>>>level&MASK];level-=SHIFT}return node}}function setListBounds(list,begin,end){if(begin!==undefined){begin=begin|0}if(end!==undefined){end=end|0}var owner=list.__ownerID||new OwnerID;var oldOrigin=list._origin;var oldCapacity=list._capacity;var newOrigin=oldOrigin+begin;var newCapacity=end===undefined?oldCapacity:end<0?oldCapacity+end:oldOrigin+end;if(newOrigin===oldOrigin&&newCapacity===oldCapacity){return list}if(newOrigin>=newCapacity){return list.clear()}var newLevel=list._level;var newRoot=list._root;var offsetShift=0;while(newOrigin+offsetShift<0){newRoot=new VNode(newRoot&&newRoot.array.length?[undefined,newRoot]:[],owner);newLevel+=SHIFT;offsetShift+=1<<newLevel}if(offsetShift){newOrigin+=offsetShift;oldOrigin+=offsetShift;newCapacity+=offsetShift;oldCapacity+=offsetShift}var oldTailOffset=getTailOffset(oldCapacity);var newTailOffset=getTailOffset(newCapacity);while(newTailOffset>=1<<newLevel+SHIFT){newRoot=new VNode(newRoot&&newRoot.array.length?[newRoot]:[],owner);newLevel+=SHIFT}var oldTail=list._tail;var newTail=newTailOffset<oldTailOffset?listNodeFor(list,newCapacity-1):newTailOffset>oldTailOffset?new VNode([],owner):oldTail;if(oldTail&&newTailOffset>oldTailOffset&&newOrigin<oldCapacity&&oldTail.array.length){newRoot=editableVNode(newRoot,owner);var node=newRoot;for(var level=newLevel;level>SHIFT;level-=SHIFT){var idx=oldTailOffset>>>level&MASK;node=node.array[idx]=editableVNode(node.array[idx],owner)}node.array[oldTailOffset>>>SHIFT&MASK]=oldTail}if(newCapacity<oldCapacity){newTail=newTail&&newTail.removeAfter(owner,0,newCapacity)}if(newOrigin>=newTailOffset){newOrigin-=newTailOffset;newCapacity-=newTailOffset;newLevel=SHIFT;newRoot=null;newTail=newTail&&newTail.removeBefore(owner,0,newOrigin)}else if(newOrigin>oldOrigin||newTailOffset<oldTailOffset){offsetShift=0;while(newRoot){var beginIndex=newOrigin>>>newLevel&MASK;if(beginIndex!==newTailOffset>>>newLevel&MASK){break}if(beginIndex){offsetShift+=(1<<newLevel)*beginIndex}newLevel-=SHIFT;newRoot=newRoot.array[beginIndex]}if(newRoot&&newOrigin>oldOrigin){newRoot=newRoot.removeBefore(owner,newLevel,newOrigin-offsetShift)}if(newRoot&&newTailOffset<oldTailOffset){newRoot=newRoot.removeAfter(owner,newLevel,newTailOffset-offsetShift)}if(offsetShift){newOrigin-=offsetShift;newCapacity-=offsetShift}}if(list.__ownerID){list.size=newCapacity-newOrigin;list._origin=newOrigin;list._capacity=newCapacity;list._level=newLevel;list._root=newRoot;list._tail=newTail;list.__hash=undefined;list.__altered=true;return list}return makeList(newOrigin,newCapacity,newLevel,newRoot,newTail)}function mergeIntoListWith(list,merger,iterables){var iters=[];var maxSize=0;for(var ii=0;ii<iterables.length;ii++){var value=iterables[ii];var iter=IndexedIterable(value);if(iter.size>maxSize){maxSize=iter.size}if(!isIterable(value)){iter=iter.map(function(v){return fromJS(v)})}iters.push(iter)}if(maxSize>list.size){list=list.setSize(maxSize)}return mergeIntoCollectionWith(list,merger,iters)}function getTailOffset(size){return size<SIZE?0:size-1>>>SHIFT<<SHIFT}createClass(OrderedMap,Map);function OrderedMap(value){return value===null||value===undefined?emptyOrderedMap():isOrderedMap(value)?value:emptyOrderedMap().withMutations(function(map){var iter=KeyedIterable(value);assertNotInfinite(iter.size);iter.forEach(function(v,k){return map.set(k,v)})})}OrderedMap.of=function(){return this(arguments)};OrderedMap.prototype.toString=function(){return this.__toString("OrderedMap {","}")};OrderedMap.prototype.get=function(k,notSetValue){var index=this._map.get(k);return index!==undefined?this._list.get(index)[1]:notSetValue};OrderedMap.prototype.clear=function(){if(this.size===0){return this}if(this.__ownerID){this.size=0;this._map.clear();this._list.clear();return this}return emptyOrderedMap()};OrderedMap.prototype.set=function(k,v){return updateOrderedMap(this,k,v)};OrderedMap.prototype.remove=function(k){return updateOrderedMap(this,k,NOT_SET)};OrderedMap.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()};OrderedMap.prototype.__iterate=function(fn,reverse){var this$0=this;return this._list.__iterate(function(entry){return entry&&fn(entry[1],entry[0],this$0)},reverse)};OrderedMap.prototype.__iterator=function(type,reverse){return this._list.fromEntrySeq().__iterator(type,reverse)};OrderedMap.prototype.__ensureOwner=function(ownerID){if(ownerID===this.__ownerID){return this}var newMap=this._map.__ensureOwner(ownerID);var newList=this._list.__ensureOwner(ownerID);if(!ownerID){this.__ownerID=ownerID;this._map=newMap;this._list=newList;return this}return makeOrderedMap(newMap,newList,ownerID,this.__hash)};function isOrderedMap(maybeOrderedMap){return isMap(maybeOrderedMap)&&isOrdered(maybeOrderedMap)}OrderedMap.isOrderedMap=isOrderedMap;OrderedMap.prototype[IS_ORDERED_SENTINEL]=true;OrderedMap.prototype[DELETE]=OrderedMap.prototype.remove;function makeOrderedMap(map,list,ownerID,hash){var omap=Object.create(OrderedMap.prototype);omap.size=map?map.size:0;omap._map=map;omap._list=list;omap.__ownerID=ownerID;omap.__hash=hash;return omap}var EMPTY_ORDERED_MAP;function emptyOrderedMap(){return EMPTY_ORDERED_MAP||(EMPTY_ORDERED_MAP=makeOrderedMap(emptyMap(),emptyList()))}function updateOrderedMap(omap,k,v){var map=omap._map;var list=omap._list;var i=map.get(k);var has=i!==undefined;var newMap;var newList;if(v===NOT_SET){if(!has){return omap}if(list.size>=SIZE&&list.size>=map.size*2){newList=list.filter(function(entry,idx){return entry!==undefined&&i!==idx});newMap=newList.toKeyedSeq().map(function(entry){return entry[0]}).flip().toMap();if(omap.__ownerID){newMap.__ownerID=newList.__ownerID=omap.__ownerID}}else{newMap=map.remove(k);newList=i===list.size-1?list.pop():list.set(i,undefined)}}else{if(has){if(v===list.get(i)[1]){return omap}newMap=map;newList=list.set(i,[k,v])}else{newMap=map.set(k,list.size);newList=list.set(list.size,[k,v])}}if(omap.__ownerID){omap.size=newMap.size;omap._map=newMap;omap._list=newList;omap.__hash=undefined;return omap}return makeOrderedMap(newMap,newList)}createClass(ToKeyedSequence,KeyedSeq);function ToKeyedSequence(indexed,useKeys){this._iter=indexed;this._useKeys=useKeys;this.size=indexed.size}ToKeyedSequence.prototype.get=function(key,notSetValue){return this._iter.get(key,notSetValue)};ToKeyedSequence.prototype.has=function(key){return this._iter.has(key)};ToKeyedSequence.prototype.valueSeq=function(){return this._iter.valueSeq()};ToKeyedSequence.prototype.reverse=function(){var this$0=this;var reversedSequence=reverseFactory(this,true);if(!this._useKeys){reversedSequence.valueSeq=function(){return this$0._iter.toSeq().reverse()}}return reversedSequence};ToKeyedSequence.prototype.map=function(mapper,context){var this$0=this;var mappedSequence=mapFactory(this,mapper,context);if(!this._useKeys){mappedSequence.valueSeq=function(){return this$0._iter.toSeq().map(mapper,context)}}return mappedSequence};ToKeyedSequence.prototype.__iterate=function(fn,reverse){var this$0=this;var ii;return this._iter.__iterate(this._useKeys?function(v,k){return fn(v,k,this$0)}:(ii=reverse?resolveSize(this):0,function(v){return fn(v,reverse?--ii:ii++,this$0)}),reverse)};ToKeyedSequence.prototype.__iterator=function(type,reverse){if(this._useKeys){return this._iter.__iterator(type,reverse)}var iterator=this._iter.__iterator(ITERATE_VALUES,reverse);var ii=reverse?resolveSize(this):0;return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,reverse?--ii:ii++,step.value,step)})};ToKeyedSequence.prototype[IS_ORDERED_SENTINEL]=true;createClass(ToIndexedSequence,IndexedSeq);function ToIndexedSequence(iter){this._iter=iter;this.size=iter.size}ToIndexedSequence.prototype.includes=function(value){return this._iter.includes(value)};ToIndexedSequence.prototype.__iterate=function(fn,reverse){var this$0=this;var iterations=0;return this._iter.__iterate(function(v){return fn(v,iterations++,this$0)},reverse)};ToIndexedSequence.prototype.__iterator=function(type,reverse){var iterator=this._iter.__iterator(ITERATE_VALUES,reverse);var iterations=0;return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,iterations++,step.value,step)})};createClass(ToSetSequence,SetSeq);function ToSetSequence(iter){this._iter=iter;this.size=iter.size}ToSetSequence.prototype.has=function(key){return this._iter.includes(key)};ToSetSequence.prototype.__iterate=function(fn,reverse){var this$0=this;return this._iter.__iterate(function(v){return fn(v,v,this$0)},reverse)};ToSetSequence.prototype.__iterator=function(type,reverse){var iterator=this._iter.__iterator(ITERATE_VALUES,reverse);return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,step.value,step.value,step)})};createClass(FromEntriesSequence,KeyedSeq);function FromEntriesSequence(entries){this._iter=entries;this.size=entries.size}FromEntriesSequence.prototype.entrySeq=function(){return this._iter.toSeq()};FromEntriesSequence.prototype.__iterate=function(fn,reverse){var this$0=this;return this._iter.__iterate(function(entry){if(entry){validateEntry(entry);var indexedIterable=isIterable(entry);return fn(indexedIterable?entry.get(1):entry[1],indexedIterable?entry.get(0):entry[0],this$0)}},reverse)};FromEntriesSequence.prototype.__iterator=function(type,reverse){var iterator=this._iter.__iterator(ITERATE_VALUES,reverse);return new Iterator(function(){while(true){var step=iterator.next();if(step.done){return step}var entry=step.value;if(entry){validateEntry(entry);var indexedIterable=isIterable(entry);return iteratorValue(type,indexedIterable?entry.get(0):entry[0],indexedIterable?entry.get(1):entry[1],step)}}})};ToIndexedSequence.prototype.cacheResult=ToKeyedSequence.prototype.cacheResult=ToSetSequence.prototype.cacheResult=FromEntriesSequence.prototype.cacheResult=cacheResultThrough;function flipFactory(iterable){var flipSequence=makeSequence(iterable);flipSequence._iter=iterable;flipSequence.size=iterable.size;flipSequence.flip=function(){return iterable};flipSequence.reverse=function(){var reversedSequence=iterable.reverse.apply(this);reversedSequence.flip=function(){return iterable.reverse()};return reversedSequence};flipSequence.has=function(key){return iterable.includes(key)};flipSequence.includes=function(key){return iterable.has(key)};flipSequence.cacheResult=cacheResultThrough;flipSequence.__iterateUncached=function(fn,reverse){var this$0=this;return iterable.__iterate(function(v,k){return fn(k,v,this$0)!==false},reverse)};flipSequence.__iteratorUncached=function(type,reverse){if(type===ITERATE_ENTRIES){var iterator=iterable.__iterator(type,reverse);return new Iterator(function(){var step=iterator.next();if(!step.done){var k=step.value[0];step.value[0]=step.value[1];step.value[1]=k}return step})}return iterable.__iterator(type===ITERATE_VALUES?ITERATE_KEYS:ITERATE_VALUES,reverse)};return flipSequence}function mapFactory(iterable,mapper,context){var mappedSequence=makeSequence(iterable);mappedSequence.size=iterable.size;mappedSequence.has=function(key){return iterable.has(key)};mappedSequence.get=function(key,notSetValue){var v=iterable.get(key,NOT_SET);return v===NOT_SET?notSetValue:mapper.call(context,v,key,iterable)};mappedSequence.__iterateUncached=function(fn,reverse){var this$0=this;return iterable.__iterate(function(v,k,c){return fn(mapper.call(context,v,k,c),k,this$0)!==false},reverse)};mappedSequence.__iteratorUncached=function(type,reverse){var iterator=iterable.__iterator(ITERATE_ENTRIES,reverse);return new Iterator(function(){var step=iterator.next();if(step.done){return step}var entry=step.value;var key=entry[0];return iteratorValue(type,key,mapper.call(context,entry[1],key,iterable),step)})};return mappedSequence}function reverseFactory(iterable,useKeys){var reversedSequence=makeSequence(iterable);reversedSequence._iter=iterable;reversedSequence.size=iterable.size;reversedSequence.reverse=function(){return iterable};if(iterable.flip){reversedSequence.flip=function(){var flipSequence=flipFactory(iterable);flipSequence.reverse=function(){return iterable.flip()};return flipSequence}}reversedSequence.get=function(key,notSetValue){return iterable.get(useKeys?key:-1-key,notSetValue)};reversedSequence.has=function(key){return iterable.has(useKeys?key:-1-key)};reversedSequence.includes=function(value){return iterable.includes(value)};reversedSequence.cacheResult=cacheResultThrough;reversedSequence.__iterate=function(fn,reverse){var this$0=this;return iterable.__iterate(function(v,k){return fn(v,k,this$0)},!reverse)};reversedSequence.__iterator=function(type,reverse){return iterable.__iterator(type,!reverse)};return reversedSequence}function filterFactory(iterable,predicate,context,useKeys){var filterSequence=makeSequence(iterable);if(useKeys){filterSequence.has=function(key){var v=iterable.get(key,NOT_SET);return v!==NOT_SET&&!!predicate.call(context,v,key,iterable)};filterSequence.get=function(key,notSetValue){var v=iterable.get(key,NOT_SET);return v!==NOT_SET&&predicate.call(context,v,key,iterable)?v:notSetValue}}filterSequence.__iterateUncached=function(fn,reverse){var this$0=this;var iterations=0;iterable.__iterate(function(v,k,c){if(predicate.call(context,v,k,c)){iterations++;return fn(v,useKeys?k:iterations-1,this$0)}},reverse);return iterations};filterSequence.__iteratorUncached=function(type,reverse){var iterator=iterable.__iterator(ITERATE_ENTRIES,reverse);var iterations=0;return new Iterator(function(){while(true){var step=iterator.next();if(step.done){return step}var entry=step.value;var key=entry[0];var value=entry[1];if(predicate.call(context,value,key,iterable)){return iteratorValue(type,useKeys?key:iterations++,value,step)}}})};return filterSequence}function countByFactory(iterable,grouper,context){var groups=Map().asMutable();iterable.__iterate(function(v,k){groups.update(grouper.call(context,v,k,iterable),0,function(a){return a+1})});return groups.asImmutable()}function groupByFactory(iterable,grouper,context){var isKeyedIter=isKeyed(iterable);var groups=(isOrdered(iterable)?OrderedMap():Map()).asMutable();iterable.__iterate(function(v,k){groups.update(grouper.call(context,v,k,iterable),function(a){return a=a||[],a.push(isKeyedIter?[k,v]:v),a})});var coerce=iterableClass(iterable);return groups.map(function(arr){return reify(iterable,coerce(arr))})}function sliceFactory(iterable,begin,end,useKeys){var originalSize=iterable.size;if(begin!==undefined){begin=begin|0}if(end!==undefined){if(end===Infinity){end=originalSize}else{end=end|0}}if(wholeSlice(begin,end,originalSize)){return iterable}var resolvedBegin=resolveBegin(begin,originalSize);var resolvedEnd=resolveEnd(end,originalSize);if(resolvedBegin!==resolvedBegin||resolvedEnd!==resolvedEnd){return sliceFactory(iterable.toSeq().cacheResult(),begin,end,useKeys)}var resolvedSize=resolvedEnd-resolvedBegin;var sliceSize;if(resolvedSize===resolvedSize){sliceSize=resolvedSize<0?0:resolvedSize}var sliceSeq=makeSequence(iterable);sliceSeq.size=sliceSize===0?sliceSize:iterable.size&&sliceSize||undefined;if(!useKeys&&isSeq(iterable)&&sliceSize>=0){sliceSeq.get=function(index,notSetValue){index=wrapIndex(this,index);return index>=0&&index<sliceSize?iterable.get(index+resolvedBegin,notSetValue):notSetValue}}sliceSeq.__iterateUncached=function(fn,reverse){var this$0=this;if(sliceSize===0){return 0}if(reverse){return this.cacheResult().__iterate(fn,reverse)}var skipped=0;var isSkipping=true;var iterations=0;iterable.__iterate(function(v,k){if(!(isSkipping&&(isSkipping=skipped++<resolvedBegin))){iterations++;return fn(v,useKeys?k:iterations-1,this$0)!==false&&iterations!==sliceSize}});return iterations};sliceSeq.__iteratorUncached=function(type,reverse){if(sliceSize!==0&&reverse){return this.cacheResult().__iterator(type,reverse)}var iterator=sliceSize!==0&&iterable.__iterator(type,reverse);var skipped=0;var iterations=0;return new Iterator(function(){while(skipped++<resolvedBegin){iterator.next()}if(++iterations>sliceSize){return iteratorDone()}var step=iterator.next();if(useKeys||type===ITERATE_VALUES){return step}else if(type===ITERATE_KEYS){return iteratorValue(type,iterations-1,undefined,step)}else{return iteratorValue(type,iterations-1,step.value[1],step);
}})};return sliceSeq}function takeWhileFactory(iterable,predicate,context){var takeSequence=makeSequence(iterable);takeSequence.__iterateUncached=function(fn,reverse){var this$0=this;if(reverse){return this.cacheResult().__iterate(fn,reverse)}var iterations=0;iterable.__iterate(function(v,k,c){return predicate.call(context,v,k,c)&&++iterations&&fn(v,k,this$0)});return iterations};takeSequence.__iteratorUncached=function(type,reverse){var this$0=this;if(reverse){return this.cacheResult().__iterator(type,reverse)}var iterator=iterable.__iterator(ITERATE_ENTRIES,reverse);var iterating=true;return new Iterator(function(){if(!iterating){return iteratorDone()}var step=iterator.next();if(step.done){return step}var entry=step.value;var k=entry[0];var v=entry[1];if(!predicate.call(context,v,k,this$0)){iterating=false;return iteratorDone()}return type===ITERATE_ENTRIES?step:iteratorValue(type,k,v,step)})};return takeSequence}function skipWhileFactory(iterable,predicate,context,useKeys){var skipSequence=makeSequence(iterable);skipSequence.__iterateUncached=function(fn,reverse){var this$0=this;if(reverse){return this.cacheResult().__iterate(fn,reverse)}var isSkipping=true;var iterations=0;iterable.__iterate(function(v,k,c){if(!(isSkipping&&(isSkipping=predicate.call(context,v,k,c)))){iterations++;return fn(v,useKeys?k:iterations-1,this$0)}});return iterations};skipSequence.__iteratorUncached=function(type,reverse){var this$0=this;if(reverse){return this.cacheResult().__iterator(type,reverse)}var iterator=iterable.__iterator(ITERATE_ENTRIES,reverse);var skipping=true;var iterations=0;return new Iterator(function(){var step,k,v;do{step=iterator.next();if(step.done){if(useKeys||type===ITERATE_VALUES){return step}else if(type===ITERATE_KEYS){return iteratorValue(type,iterations++,undefined,step)}else{return iteratorValue(type,iterations++,step.value[1],step)}}var entry=step.value;k=entry[0];v=entry[1];skipping&&(skipping=predicate.call(context,v,k,this$0))}while(skipping);return type===ITERATE_ENTRIES?step:iteratorValue(type,k,v,step)})};return skipSequence}function concatFactory(iterable,values){var isKeyedIterable=isKeyed(iterable);var iters=[iterable].concat(values).map(function(v){if(!isIterable(v)){v=isKeyedIterable?keyedSeqFromValue(v):indexedSeqFromValue(Array.isArray(v)?v:[v])}else if(isKeyedIterable){v=KeyedIterable(v)}return v}).filter(function(v){return v.size!==0});if(iters.length===0){return iterable}if(iters.length===1){var singleton=iters[0];if(singleton===iterable||isKeyedIterable&&isKeyed(singleton)||isIndexed(iterable)&&isIndexed(singleton)){return singleton}}var concatSeq=new ArraySeq(iters);if(isKeyedIterable){concatSeq=concatSeq.toKeyedSeq()}else if(!isIndexed(iterable)){concatSeq=concatSeq.toSetSeq()}concatSeq=concatSeq.flatten(true);concatSeq.size=iters.reduce(function(sum,seq){if(sum!==undefined){var size=seq.size;if(size!==undefined){return sum+size}}},0);return concatSeq}function flattenFactory(iterable,depth,useKeys){var flatSequence=makeSequence(iterable);flatSequence.__iterateUncached=function(fn,reverse){var iterations=0;var stopped=false;function flatDeep(iter,currentDepth){var this$0=this;iter.__iterate(function(v,k){if((!depth||currentDepth<depth)&&isIterable(v)){flatDeep(v,currentDepth+1)}else if(fn(v,useKeys?k:iterations++,this$0)===false){stopped=true}return!stopped},reverse)}flatDeep(iterable,0);return iterations};flatSequence.__iteratorUncached=function(type,reverse){var iterator=iterable.__iterator(type,reverse);var stack=[];var iterations=0;return new Iterator(function(){while(iterator){var step=iterator.next();if(step.done!==false){iterator=stack.pop();continue}var v=step.value;if(type===ITERATE_ENTRIES){v=v[1]}if((!depth||stack.length<depth)&&isIterable(v)){stack.push(iterator);iterator=v.__iterator(type,reverse)}else{return useKeys?step:iteratorValue(type,iterations++,v,step)}}return iteratorDone()})};return flatSequence}function flatMapFactory(iterable,mapper,context){var coerce=iterableClass(iterable);return iterable.toSeq().map(function(v,k){return coerce(mapper.call(context,v,k,iterable))}).flatten(true)}function interposeFactory(iterable,separator){var interposedSequence=makeSequence(iterable);interposedSequence.size=iterable.size&&iterable.size*2-1;interposedSequence.__iterateUncached=function(fn,reverse){var this$0=this;var iterations=0;iterable.__iterate(function(v,k){return(!iterations||fn(separator,iterations++,this$0)!==false)&&fn(v,iterations++,this$0)!==false},reverse);return iterations};interposedSequence.__iteratorUncached=function(type,reverse){var iterator=iterable.__iterator(ITERATE_VALUES,reverse);var iterations=0;var step;return new Iterator(function(){if(!step||iterations%2){step=iterator.next();if(step.done){return step}}return iterations%2?iteratorValue(type,iterations++,separator):iteratorValue(type,iterations++,step.value,step)})};return interposedSequence}function sortFactory(iterable,comparator,mapper){if(!comparator){comparator=defaultComparator}var isKeyedIterable=isKeyed(iterable);var index=0;var entries=iterable.toSeq().map(function(v,k){return[k,v,index++,mapper?mapper(v,k,iterable):v]}).toArray();entries.sort(function(a,b){return comparator(a[3],b[3])||a[2]-b[2]}).forEach(isKeyedIterable?function(v,i){entries[i].length=2}:function(v,i){entries[i]=v[1]});return isKeyedIterable?KeyedSeq(entries):isIndexed(iterable)?IndexedSeq(entries):SetSeq(entries)}function maxFactory(iterable,comparator,mapper){if(!comparator){comparator=defaultComparator}if(mapper){var entry=iterable.toSeq().map(function(v,k){return[v,mapper(v,k,iterable)]}).reduce(function(a,b){return maxCompare(comparator,a[1],b[1])?b:a});return entry&&entry[0]}else{return iterable.reduce(function(a,b){return maxCompare(comparator,a,b)?b:a})}}function maxCompare(comparator,a,b){var comp=comparator(b,a);return comp===0&&b!==a&&(b===undefined||b===null||b!==b)||comp>0}function zipWithFactory(keyIter,zipper,iters){var zipSequence=makeSequence(keyIter);zipSequence.size=new ArraySeq(iters).map(function(i){return i.size}).min();zipSequence.__iterate=function(fn,reverse){var iterator=this.__iterator(ITERATE_VALUES,reverse);var step;var iterations=0;while(!(step=iterator.next()).done){if(fn(step.value,iterations++,this)===false){break}}return iterations};zipSequence.__iteratorUncached=function(type,reverse){var iterators=iters.map(function(i){return i=Iterable(i),getIterator(reverse?i.reverse():i)});var iterations=0;var isDone=false;return new Iterator(function(){var steps;if(!isDone){steps=iterators.map(function(i){return i.next()});isDone=steps.some(function(s){return s.done})}if(isDone){return iteratorDone()}return iteratorValue(type,iterations++,zipper.apply(null,steps.map(function(s){return s.value})))})};return zipSequence}function reify(iter,seq){return isSeq(iter)?seq:iter.constructor(seq)}function validateEntry(entry){if(entry!==Object(entry)){throw new TypeError("Expected [K, V] tuple: "+entry)}}function resolveSize(iter){assertNotInfinite(iter.size);return ensureSize(iter)}function iterableClass(iterable){return isKeyed(iterable)?KeyedIterable:isIndexed(iterable)?IndexedIterable:SetIterable}function makeSequence(iterable){return Object.create((isKeyed(iterable)?KeyedSeq:isIndexed(iterable)?IndexedSeq:SetSeq).prototype)}function cacheResultThrough(){if(this._iter.cacheResult){this._iter.cacheResult();this.size=this._iter.size;return this}else{return Seq.prototype.cacheResult.call(this)}}function defaultComparator(a,b){return a>b?1:a<b?-1:0}function forceIterator(keyPath){var iter=getIterator(keyPath);if(!iter){if(!isArrayLike(keyPath)){throw new TypeError("Expected iterable or array-like: "+keyPath)}iter=getIterator(Iterable(keyPath))}return iter}createClass(Record,KeyedCollection);function Record(defaultValues,name){var hasInitialized;var RecordType=function Record(values){if(values instanceof RecordType){return values}if(!(this instanceof RecordType)){return new RecordType(values)}if(!hasInitialized){hasInitialized=true;var keys=Object.keys(defaultValues);setProps(RecordTypePrototype,keys);RecordTypePrototype.size=keys.length;RecordTypePrototype._name=name;RecordTypePrototype._keys=keys;RecordTypePrototype._defaultValues=defaultValues}this._map=Map(values)};var RecordTypePrototype=RecordType.prototype=Object.create(RecordPrototype);RecordTypePrototype.constructor=RecordType;return RecordType}Record.prototype.toString=function(){return this.__toString(recordName(this)+" {","}")};Record.prototype.has=function(k){return this._defaultValues.hasOwnProperty(k)};Record.prototype.get=function(k,notSetValue){if(!this.has(k)){return notSetValue}var defaultVal=this._defaultValues[k];return this._map?this._map.get(k,defaultVal):defaultVal};Record.prototype.clear=function(){if(this.__ownerID){this._map&&this._map.clear();return this}var RecordType=this.constructor;return RecordType._empty||(RecordType._empty=makeRecord(this,emptyMap()))};Record.prototype.set=function(k,v){if(!this.has(k)){throw new Error('Cannot set unknown key "'+k+'" on '+recordName(this))}if(this._map&&!this._map.has(k)){var defaultVal=this._defaultValues[k];if(v===defaultVal){return this}}var newMap=this._map&&this._map.set(k,v);if(this.__ownerID||newMap===this._map){return this}return makeRecord(this,newMap)};Record.prototype.remove=function(k){if(!this.has(k)){return this}var newMap=this._map&&this._map.remove(k);if(this.__ownerID||newMap===this._map){return this}return makeRecord(this,newMap)};Record.prototype.wasAltered=function(){return this._map.wasAltered()};Record.prototype.__iterator=function(type,reverse){var this$0=this;return KeyedIterable(this._defaultValues).map(function(_,k){return this$0.get(k)}).__iterator(type,reverse)};Record.prototype.__iterate=function(fn,reverse){var this$0=this;return KeyedIterable(this._defaultValues).map(function(_,k){return this$0.get(k)}).__iterate(fn,reverse)};Record.prototype.__ensureOwner=function(ownerID){if(ownerID===this.__ownerID){return this}var newMap=this._map&&this._map.__ensureOwner(ownerID);if(!ownerID){this.__ownerID=ownerID;this._map=newMap;return this}return makeRecord(this,newMap,ownerID)};var RecordPrototype=Record.prototype;RecordPrototype[DELETE]=RecordPrototype.remove;RecordPrototype.deleteIn=RecordPrototype.removeIn=MapPrototype.removeIn;RecordPrototype.merge=MapPrototype.merge;RecordPrototype.mergeWith=MapPrototype.mergeWith;RecordPrototype.mergeIn=MapPrototype.mergeIn;RecordPrototype.mergeDeep=MapPrototype.mergeDeep;RecordPrototype.mergeDeepWith=MapPrototype.mergeDeepWith;RecordPrototype.mergeDeepIn=MapPrototype.mergeDeepIn;RecordPrototype.setIn=MapPrototype.setIn;RecordPrototype.update=MapPrototype.update;RecordPrototype.updateIn=MapPrototype.updateIn;RecordPrototype.withMutations=MapPrototype.withMutations;RecordPrototype.asMutable=MapPrototype.asMutable;RecordPrototype.asImmutable=MapPrototype.asImmutable;function makeRecord(likeRecord,map,ownerID){var record=Object.create(Object.getPrototypeOf(likeRecord));record._map=map;record.__ownerID=ownerID;return record}function recordName(record){return record._name||record.constructor.name||"Record"}function setProps(prototype,names){try{names.forEach(setProp.bind(undefined,prototype))}catch(error){}}function setProp(prototype,name){Object.defineProperty(prototype,name,{get:function(){return this.get(name)},set:function(value){invariant(this.__ownerID,"Cannot set on an immutable record.");this.set(name,value)}})}createClass(Set,SetCollection);function Set(value){return value===null||value===undefined?emptySet():isSet(value)&&!isOrdered(value)?value:emptySet().withMutations(function(set){var iter=SetIterable(value);assertNotInfinite(iter.size);iter.forEach(function(v){return set.add(v)})})}Set.of=function(){return this(arguments)};Set.fromKeys=function(value){return this(KeyedIterable(value).keySeq())};Set.prototype.toString=function(){return this.__toString("Set {","}")};Set.prototype.has=function(value){return this._map.has(value)};Set.prototype.add=function(value){return updateSet(this,this._map.set(value,true))};Set.prototype.remove=function(value){return updateSet(this,this._map.remove(value))};Set.prototype.clear=function(){return updateSet(this,this._map.clear())};Set.prototype.union=function(){var iters=SLICE$0.call(arguments,0);iters=iters.filter(function(x){return x.size!==0});if(iters.length===0){return this}if(this.size===0&&!this.__ownerID&&iters.length===1){return this.constructor(iters[0])}return this.withMutations(function(set){for(var ii=0;ii<iters.length;ii++){SetIterable(iters[ii]).forEach(function(value){return set.add(value)})}})};Set.prototype.intersect=function(){var iters=SLICE$0.call(arguments,0);if(iters.length===0){return this}iters=iters.map(function(iter){return SetIterable(iter)});var originalSet=this;return this.withMutations(function(set){originalSet.forEach(function(value){if(!iters.every(function(iter){return iter.includes(value)})){set.remove(value)}})})};Set.prototype.subtract=function(){var iters=SLICE$0.call(arguments,0);if(iters.length===0){return this}iters=iters.map(function(iter){return SetIterable(iter)});var originalSet=this;return this.withMutations(function(set){originalSet.forEach(function(value){if(iters.some(function(iter){return iter.includes(value)})){set.remove(value)}})})};Set.prototype.merge=function(){return this.union.apply(this,arguments)};Set.prototype.mergeWith=function(merger){var iters=SLICE$0.call(arguments,1);return this.union.apply(this,iters)};Set.prototype.sort=function(comparator){return OrderedSet(sortFactory(this,comparator))};Set.prototype.sortBy=function(mapper,comparator){return OrderedSet(sortFactory(this,comparator,mapper))};Set.prototype.wasAltered=function(){return this._map.wasAltered()};Set.prototype.__iterate=function(fn,reverse){var this$0=this;return this._map.__iterate(function(_,k){return fn(k,k,this$0)},reverse)};Set.prototype.__iterator=function(type,reverse){return this._map.map(function(_,k){return k}).__iterator(type,reverse)};Set.prototype.__ensureOwner=function(ownerID){if(ownerID===this.__ownerID){return this}var newMap=this._map.__ensureOwner(ownerID);if(!ownerID){this.__ownerID=ownerID;this._map=newMap;return this}return this.__make(newMap,ownerID)};function isSet(maybeSet){return!!(maybeSet&&maybeSet[IS_SET_SENTINEL])}Set.isSet=isSet;var IS_SET_SENTINEL="@@__IMMUTABLE_SET__@@";var SetPrototype=Set.prototype;SetPrototype[IS_SET_SENTINEL]=true;SetPrototype[DELETE]=SetPrototype.remove;SetPrototype.mergeDeep=SetPrototype.merge;SetPrototype.mergeDeepWith=SetPrototype.mergeWith;SetPrototype.withMutations=MapPrototype.withMutations;SetPrototype.asMutable=MapPrototype.asMutable;SetPrototype.asImmutable=MapPrototype.asImmutable;SetPrototype.__empty=emptySet;SetPrototype.__make=makeSet;function updateSet(set,newMap){if(set.__ownerID){set.size=newMap.size;set._map=newMap;return set}return newMap===set._map?set:newMap.size===0?set.__empty():set.__make(newMap)}function makeSet(map,ownerID){var set=Object.create(SetPrototype);set.size=map?map.size:0;set._map=map;set.__ownerID=ownerID;return set}var EMPTY_SET;function emptySet(){return EMPTY_SET||(EMPTY_SET=makeSet(emptyMap()))}createClass(OrderedSet,Set);function OrderedSet(value){return value===null||value===undefined?emptyOrderedSet():isOrderedSet(value)?value:emptyOrderedSet().withMutations(function(set){var iter=SetIterable(value);assertNotInfinite(iter.size);iter.forEach(function(v){return set.add(v)})})}OrderedSet.of=function(){return this(arguments)};OrderedSet.fromKeys=function(value){return this(KeyedIterable(value).keySeq())};OrderedSet.prototype.toString=function(){return this.__toString("OrderedSet {","}")};function isOrderedSet(maybeOrderedSet){return isSet(maybeOrderedSet)&&isOrdered(maybeOrderedSet)}OrderedSet.isOrderedSet=isOrderedSet;var OrderedSetPrototype=OrderedSet.prototype;OrderedSetPrototype[IS_ORDERED_SENTINEL]=true;OrderedSetPrototype.__empty=emptyOrderedSet;OrderedSetPrototype.__make=makeOrderedSet;function makeOrderedSet(map,ownerID){var set=Object.create(OrderedSetPrototype);set.size=map?map.size:0;set._map=map;set.__ownerID=ownerID;return set}var EMPTY_ORDERED_SET;function emptyOrderedSet(){return EMPTY_ORDERED_SET||(EMPTY_ORDERED_SET=makeOrderedSet(emptyOrderedMap()))}createClass(Stack,IndexedCollection);function Stack(value){return value===null||value===undefined?emptyStack():isStack(value)?value:emptyStack().unshiftAll(value)}Stack.of=function(){return this(arguments)};Stack.prototype.toString=function(){return this.__toString("Stack [","]")};Stack.prototype.get=function(index,notSetValue){var head=this._head;index=wrapIndex(this,index);while(head&&index--){head=head.next}return head?head.value:notSetValue};Stack.prototype.peek=function(){return this._head&&this._head.value};Stack.prototype.push=function(){if(arguments.length===0){return this}var newSize=this.size+arguments.length;var head=this._head;for(var ii=arguments.length-1;ii>=0;ii--){head={value:arguments[ii],next:head}}if(this.__ownerID){this.size=newSize;this._head=head;this.__hash=undefined;this.__altered=true;return this}return makeStack(newSize,head)};Stack.prototype.pushAll=function(iter){iter=IndexedIterable(iter);if(iter.size===0){return this}assertNotInfinite(iter.size);var newSize=this.size;var head=this._head;iter.reverse().forEach(function(value){newSize++;head={value:value,next:head}});if(this.__ownerID){this.size=newSize;this._head=head;this.__hash=undefined;this.__altered=true;return this}return makeStack(newSize,head)};Stack.prototype.pop=function(){return this.slice(1)};Stack.prototype.unshift=function(){return this.push.apply(this,arguments)};Stack.prototype.unshiftAll=function(iter){return this.pushAll(iter)};Stack.prototype.shift=function(){return this.pop.apply(this,arguments)};Stack.prototype.clear=function(){if(this.size===0){return this}if(this.__ownerID){this.size=0;this._head=undefined;this.__hash=undefined;this.__altered=true;return this}return emptyStack()};Stack.prototype.slice=function(begin,end){if(wholeSlice(begin,end,this.size)){return this}var resolvedBegin=resolveBegin(begin,this.size);var resolvedEnd=resolveEnd(end,this.size);if(resolvedEnd!==this.size){return IndexedCollection.prototype.slice.call(this,begin,end)}var newSize=this.size-resolvedBegin;var head=this._head;while(resolvedBegin--){head=head.next}if(this.__ownerID){this.size=newSize;this._head=head;this.__hash=undefined;this.__altered=true;return this}return makeStack(newSize,head)};Stack.prototype.__ensureOwner=function(ownerID){if(ownerID===this.__ownerID){return this}if(!ownerID){this.__ownerID=ownerID;this.__altered=false;return this}return makeStack(this.size,this._head,ownerID,this.__hash)};Stack.prototype.__iterate=function(fn,reverse){if(reverse){return this.reverse().__iterate(fn)}var iterations=0;var node=this._head;while(node){if(fn(node.value,iterations++,this)===false){break}node=node.next}return iterations};Stack.prototype.__iterator=function(type,reverse){if(reverse){return this.reverse().__iterator(type)}var iterations=0;var node=this._head;return new Iterator(function(){if(node){var value=node.value;node=node.next;return iteratorValue(type,iterations++,value)}return iteratorDone()})};function isStack(maybeStack){return!!(maybeStack&&maybeStack[IS_STACK_SENTINEL])}Stack.isStack=isStack;var IS_STACK_SENTINEL="@@__IMMUTABLE_STACK__@@";var StackPrototype=Stack.prototype;StackPrototype[IS_STACK_SENTINEL]=true;StackPrototype.withMutations=MapPrototype.withMutations;StackPrototype.asMutable=MapPrototype.asMutable;StackPrototype.asImmutable=MapPrototype.asImmutable;StackPrototype.wasAltered=MapPrototype.wasAltered;function makeStack(size,head,ownerID,hash){var map=Object.create(StackPrototype);map.size=size;map._head=head;map.__ownerID=ownerID;map.__hash=hash;map.__altered=false;return map}var EMPTY_STACK;function emptyStack(){return EMPTY_STACK||(EMPTY_STACK=makeStack(0))}function mixin(ctor,methods){var keyCopier=function(key){ctor.prototype[key]=methods[key]};Object.keys(methods).forEach(keyCopier);Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(methods).forEach(keyCopier);return ctor}Iterable.Iterator=Iterator;mixin(Iterable,{toArray:function(){assertNotInfinite(this.size);var array=new Array(this.size||0);this.valueSeq().__iterate(function(v,i){array[i]=v});return array},toIndexedSeq:function(){return new ToIndexedSequence(this)},toJS:function(){return this.toSeq().map(function(value){return value&&typeof value.toJS==="function"?value.toJS():value}).__toJS()},toJSON:function(){return this.toSeq().map(function(value){return value&&typeof value.toJSON==="function"?value.toJSON():value}).__toJS()},toKeyedSeq:function(){return new ToKeyedSequence(this,true)},toMap:function(){return Map(this.toKeyedSeq())},toObject:function(){assertNotInfinite(this.size);var object={};this.__iterate(function(v,k){object[k]=v});return object},toOrderedMap:function(){return OrderedMap(this.toKeyedSeq())},toOrderedSet:function(){return OrderedSet(isKeyed(this)?this.valueSeq():this)},toSet:function(){return Set(isKeyed(this)?this.valueSeq():this)},toSetSeq:function(){return new ToSetSequence(this)},toSeq:function(){return isIndexed(this)?this.toIndexedSeq():isKeyed(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Stack(isKeyed(this)?this.valueSeq():this)},toList:function(){return List(isKeyed(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(head,tail){if(this.size===0){return head+tail}return head+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+tail},concat:function(){var values=SLICE$0.call(arguments,0);return reify(this,concatFactory(this,values))},includes:function(searchValue){return this.some(function(value){return is(value,searchValue)})},entries:function(){return this.__iterator(ITERATE_ENTRIES)},every:function(predicate,context){assertNotInfinite(this.size);var returnValue=true;this.__iterate(function(v,k,c){if(!predicate.call(context,v,k,c)){returnValue=false;return false}});return returnValue},filter:function(predicate,context){return reify(this,filterFactory(this,predicate,context,true))},find:function(predicate,context,notSetValue){var entry=this.findEntry(predicate,context);return entry?entry[1]:notSetValue},forEach:function(sideEffect,context){assertNotInfinite(this.size);return this.__iterate(context?sideEffect.bind(context):sideEffect)},join:function(separator){assertNotInfinite(this.size);separator=separator!==undefined?""+separator:",";var joined="";var isFirst=true;this.__iterate(function(v){isFirst?isFirst=false:joined+=separator;joined+=v!==null&&v!==undefined?v.toString():""});return joined},keys:function(){return this.__iterator(ITERATE_KEYS)},map:function(mapper,context){return reify(this,mapFactory(this,mapper,context))},reduce:function(reducer,initialReduction,context){assertNotInfinite(this.size);var reduction;var useFirst;if(arguments.length<2){useFirst=true}else{reduction=initialReduction}this.__iterate(function(v,k,c){if(useFirst){useFirst=false;reduction=v}else{reduction=reducer.call(context,reduction,v,k,c)}});return reduction},reduceRight:function(reducer,initialReduction,context){var reversed=this.toKeyedSeq().reverse();return reversed.reduce.apply(reversed,arguments)},reverse:function(){return reify(this,reverseFactory(this,true))},slice:function(begin,end){return reify(this,sliceFactory(this,begin,end,true))},some:function(predicate,context){return!this.every(not(predicate),context)},sort:function(comparator){return reify(this,sortFactory(this,comparator))},values:function(){return this.__iterator(ITERATE_VALUES)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==undefined?this.size===0:!this.some(function(){return true})},count:function(predicate,context){return ensureSize(predicate?this.toSeq().filter(predicate,context):this)},countBy:function(grouper,context){return countByFactory(this,grouper,context)},equals:function(other){return deepEqual(this,other)},entrySeq:function(){var iterable=this;if(iterable._cache){return new ArraySeq(iterable._cache)}var entriesSequence=iterable.toSeq().map(entryMapper).toIndexedSeq();entriesSequence.fromEntrySeq=function(){return iterable.toSeq()};return entriesSequence},filterNot:function(predicate,context){return this.filter(not(predicate),context)},findEntry:function(predicate,context,notSetValue){var found=notSetValue;this.__iterate(function(v,k,c){if(predicate.call(context,v,k,c)){found=[k,v];return false}});return found},findKey:function(predicate,context){var entry=this.findEntry(predicate,context);return entry&&entry[0]},findLast:function(predicate,context,notSetValue){return this.toKeyedSeq().reverse().find(predicate,context,notSetValue)},findLastEntry:function(predicate,context,notSetValue){return this.toKeyedSeq().reverse().findEntry(predicate,context,notSetValue)},findLastKey:function(predicate,context){return this.toKeyedSeq().reverse().findKey(predicate,context)},first:function(){return this.find(returnTrue)},flatMap:function(mapper,context){return reify(this,flatMapFactory(this,mapper,context))},flatten:function(depth){return reify(this,flattenFactory(this,depth,true))},fromEntrySeq:function(){return new FromEntriesSequence(this)},get:function(searchKey,notSetValue){return this.find(function(_,key){return is(key,searchKey)},undefined,notSetValue)},getIn:function(searchKeyPath,notSetValue){var nested=this;var iter=forceIterator(searchKeyPath);var step;while(!(step=iter.next()).done){var key=step.value;nested=nested&&nested.get?nested.get(key,NOT_SET):NOT_SET;if(nested===NOT_SET){return notSetValue}}return nested},groupBy:function(grouper,context){return groupByFactory(this,grouper,context)},has:function(searchKey){return this.get(searchKey,NOT_SET)!==NOT_SET},hasIn:function(searchKeyPath){return this.getIn(searchKeyPath,NOT_SET)!==NOT_SET},isSubset:function(iter){iter=typeof iter.includes==="function"?iter:Iterable(iter);return this.every(function(value){return iter.includes(value)})},isSuperset:function(iter){iter=typeof iter.isSubset==="function"?iter:Iterable(iter);return iter.isSubset(this)},keyOf:function(searchValue){return this.findKey(function(value){return is(value,searchValue)})},keySeq:function(){return this.toSeq().map(keyMapper).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(searchValue){return this.toKeyedSeq().reverse().keyOf(searchValue)},max:function(comparator){return maxFactory(this,comparator)},maxBy:function(mapper,comparator){return maxFactory(this,comparator,mapper)},min:function(comparator){return maxFactory(this,comparator?neg(comparator):defaultNegComparator)},minBy:function(mapper,comparator){return maxFactory(this,comparator?neg(comparator):defaultNegComparator,mapper)},rest:function(){return this.slice(1)},skip:function(amount){return this.slice(Math.max(0,amount))},skipLast:function(amount){return reify(this,this.toSeq().reverse().skip(amount).reverse())},skipWhile:function(predicate,context){return reify(this,skipWhileFactory(this,predicate,context,true))},skipUntil:function(predicate,context){return this.skipWhile(not(predicate),context)},sortBy:function(mapper,comparator){return reify(this,sortFactory(this,comparator,mapper))},take:function(amount){return this.slice(0,Math.max(0,amount))},takeLast:function(amount){return reify(this,this.toSeq().reverse().take(amount).reverse())},takeWhile:function(predicate,context){return reify(this,takeWhileFactory(this,predicate,context))},takeUntil:function(predicate,context){return this.takeWhile(not(predicate),context)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=hashIterable(this))}});var IterablePrototype=Iterable.prototype;IterablePrototype[IS_ITERABLE_SENTINEL]=true;IterablePrototype[ITERATOR_SYMBOL]=IterablePrototype.values;IterablePrototype.__toJS=IterablePrototype.toArray;IterablePrototype.__toStringMapper=quoteString;IterablePrototype.inspect=IterablePrototype.toSource=function(){return this.toString()};IterablePrototype.chain=IterablePrototype.flatMap;IterablePrototype.contains=IterablePrototype.includes;mixin(KeyedIterable,{flip:function(){return reify(this,flipFactory(this))},mapEntries:function(mapper,context){var this$0=this;var iterations=0;return reify(this,this.toSeq().map(function(v,k){return mapper.call(context,[k,v],iterations++,this$0)}).fromEntrySeq())},mapKeys:function(mapper,context){var this$0=this;return reify(this,this.toSeq().flip().map(function(k,v){return mapper.call(context,k,v,this$0)}).flip())}});var KeyedIterablePrototype=KeyedIterable.prototype;KeyedIterablePrototype[IS_KEYED_SENTINEL]=true;KeyedIterablePrototype[ITERATOR_SYMBOL]=IterablePrototype.entries;KeyedIterablePrototype.__toJS=IterablePrototype.toObject;KeyedIterablePrototype.__toStringMapper=function(v,k){return JSON.stringify(k)+": "+quoteString(v)};mixin(IndexedIterable,{toKeyedSeq:function(){return new ToKeyedSequence(this,false)},filter:function(predicate,context){return reify(this,filterFactory(this,predicate,context,false))},findIndex:function(predicate,context){var entry=this.findEntry(predicate,context);return entry?entry[0]:-1},indexOf:function(searchValue){var key=this.keyOf(searchValue);return key===undefined?-1:key},lastIndexOf:function(searchValue){var key=this.lastKeyOf(searchValue);return key===undefined?-1:key},reverse:function(){return reify(this,reverseFactory(this,false))},slice:function(begin,end){return reify(this,sliceFactory(this,begin,end,false))},splice:function(index,removeNum){var numArgs=arguments.length;removeNum=Math.max(removeNum|0,0);if(numArgs===0||numArgs===2&&!removeNum){return this}index=resolveBegin(index,index<0?this.count():this.size);var spliced=this.slice(0,index);return reify(this,numArgs===1?spliced:spliced.concat(arrCopy(arguments,2),this.slice(index+removeNum)))},findLastIndex:function(predicate,context){var entry=this.findLastEntry(predicate,context);return entry?entry[0]:-1},first:function(){return this.get(0)},flatten:function(depth){return reify(this,flattenFactory(this,depth,false))},get:function(index,notSetValue){index=wrapIndex(this,index);return index<0||(this.size===Infinity||this.size!==undefined&&index>this.size)?notSetValue:this.find(function(_,key){return key===index},undefined,notSetValue)},has:function(index){index=wrapIndex(this,index);return index>=0&&(this.size!==undefined?this.size===Infinity||index<this.size:this.indexOf(index)!==-1)},interpose:function(separator){return reify(this,interposeFactory(this,separator))},interleave:function(){var iterables=[this].concat(arrCopy(arguments));var zipped=zipWithFactory(this.toSeq(),IndexedSeq.of,iterables);var interleaved=zipped.flatten(true);if(zipped.size){interleaved.size=zipped.size*iterables.length}return reify(this,interleaved)},keySeq:function(){return Range(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(predicate,context){return reify(this,skipWhileFactory(this,predicate,context,false))},zip:function(){var iterables=[this].concat(arrCopy(arguments));return reify(this,zipWithFactory(this,defaultZipper,iterables))},zipWith:function(zipper){var iterables=arrCopy(arguments);iterables[0]=this;return reify(this,zipWithFactory(this,zipper,iterables))}});IndexedIterable.prototype[IS_INDEXED_SENTINEL]=true;IndexedIterable.prototype[IS_ORDERED_SENTINEL]=true;mixin(SetIterable,{get:function(value,notSetValue){return this.has(value)?value:notSetValue},includes:function(value){return this.has(value)},keySeq:function(){return this.valueSeq()}});SetIterable.prototype.has=IterablePrototype.includes;SetIterable.prototype.contains=SetIterable.prototype.includes;mixin(KeyedSeq,KeyedIterable.prototype);mixin(IndexedSeq,IndexedIterable.prototype);mixin(SetSeq,SetIterable.prototype);mixin(KeyedCollection,KeyedIterable.prototype);mixin(IndexedCollection,IndexedIterable.prototype);mixin(SetCollection,SetIterable.prototype);function keyMapper(v,k){return k}function entryMapper(v,k){return[k,v]}function not(predicate){return function(){
return!predicate.apply(this,arguments)}}function neg(predicate){return function(){return-predicate.apply(this,arguments)}}function quoteString(value){return typeof value==="string"?JSON.stringify(value):String(value)}function defaultZipper(){return arrCopy(arguments)}function defaultNegComparator(a,b){return a<b?1:a>b?-1:0}function hashIterable(iterable){if(iterable.size===Infinity){return 0}var ordered=isOrdered(iterable);var keyed=isKeyed(iterable);var h=ordered?1:0;var size=iterable.__iterate(keyed?ordered?function(v,k){h=31*h+hashMerge(hash(v),hash(k))|0}:function(v,k){h=h+hashMerge(hash(v),hash(k))|0}:ordered?function(v){h=31*h+hash(v)|0}:function(v){h=h+hash(v)|0});return murmurHashOfSize(size,h)}function murmurHashOfSize(size,h){h=imul(h,3432918353);h=imul(h<<15|h>>>-15,461845907);h=imul(h<<13|h>>>-13,5);h=(h+3864292196|0)^size;h=imul(h^h>>>16,2246822507);h=imul(h^h>>>13,3266489909);h=smi(h^h>>>16);return h}function hashMerge(a,b){return a^b+2654435769+(a<<6)+(a>>2)|0}var Immutable={Iterable:Iterable,Seq:Seq,Collection:Collection,Map:Map,OrderedMap:OrderedMap,List:List,Stack:Stack,Set:Set,OrderedSet:OrderedSet,Record:Record,Range:Range,Repeat:Repeat,is:is,fromJS:fromJS};return Immutable})},{}],454:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],455:[function(require,module,exports){"use strict";var invariant=function(condition,format,a,b,c,d,e,f){if("production"!=="production"){if(format===undefined){throw new Error("invariant requires an error message argument")}}if(!condition){var error;if(format===undefined){error=new Error("Minified exception occurred; use the non-minified dev environment "+"for the full error message and additional helpful warnings.")}else{var args=[a,b,c,d,e,f];var argIndex=0;error=new Error(format.replace(/%s/g,function(){return args[argIndex++]}));error.name="Invariant Violation"}error.framesToPop=1;throw error}};module.exports=invariant},{}],456:[function(require,module,exports){"use strict";function iota(n){var result=new Array(n);for(var i=0;i<n;++i){result[i]=i}return result}module.exports=iota},{}],457:[function(require,module,exports){module.exports=function(obj){return obj!=null&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)};function isBuffer(obj){return!!obj.constructor&&typeof obj.constructor.isBuffer==="function"&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return typeof obj.readFloatLE==="function"&&typeof obj.slice==="function"&&isBuffer(obj.slice(0,0))}},{}],458:[function(require,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=="[object Array]"}},{}],459:[function(require,module,exports){"use strict";var sort=require("./sort");var range=require("./range");var within=require("./within");module.exports=kdbush;function kdbush(points,getX,getY,nodeSize,ArrayType){return new KDBush(points,getX,getY,nodeSize,ArrayType)}function KDBush(points,getX,getY,nodeSize,ArrayType){getX=getX||defaultGetX;getY=getY||defaultGetY;ArrayType=ArrayType||Array;this.nodeSize=nodeSize||64;this.points=points;this.ids=new ArrayType(points.length);this.coords=new ArrayType(points.length*2);for(var i=0;i<points.length;i++){this.ids[i]=i;this.coords[2*i]=getX(points[i]);this.coords[2*i+1]=getY(points[i])}sort(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}KDBush.prototype={range:function(minX,minY,maxX,maxY){return range(this.ids,this.coords,minX,minY,maxX,maxY,this.nodeSize)},within:function(x,y,r){return within(this.ids,this.coords,x,y,r,this.nodeSize)}};function defaultGetX(p){return p[0]}function defaultGetY(p){return p[1]}},{"./range":460,"./sort":461,"./within":462}],460:[function(require,module,exports){"use strict";module.exports=range;function range(ids,coords,minX,minY,maxX,maxY,nodeSize){var stack=[0,ids.length-1,0];var result=[];var x,y;while(stack.length){var axis=stack.pop();var right=stack.pop();var left=stack.pop();if(right-left<=nodeSize){for(var i=left;i<=right;i++){x=coords[2*i];y=coords[2*i+1];if(x>=minX&&x<=maxX&&y>=minY&&y<=maxY)result.push(ids[i])}continue}var m=Math.floor((left+right)/2);x=coords[2*m];y=coords[2*m+1];if(x>=minX&&x<=maxX&&y>=minY&&y<=maxY)result.push(ids[m]);var nextAxis=(axis+1)%2;if(axis===0?minX<=x:minY<=y){stack.push(left);stack.push(m-1);stack.push(nextAxis)}if(axis===0?maxX>=x:maxY>=y){stack.push(m+1);stack.push(right);stack.push(nextAxis)}}return result}},{}],461:[function(require,module,exports){"use strict";module.exports=sortKD;function sortKD(ids,coords,nodeSize,left,right,depth){if(right-left<=nodeSize)return;var m=Math.floor((left+right)/2);select(ids,coords,m,left,right,depth%2);sortKD(ids,coords,nodeSize,left,m-1,depth+1);sortKD(ids,coords,nodeSize,m+1,right,depth+1)}function select(ids,coords,k,left,right,inc){while(right>left){if(right-left>600){var n=right-left+1;var m=k-left+1;var z=Math.log(n);var s=.5*Math.exp(2*z/3);var sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);var newLeft=Math.max(left,Math.floor(k-m*s/n+sd));var newRight=Math.min(right,Math.floor(k+(n-m)*s/n+sd));select(ids,coords,k,newLeft,newRight,inc)}var t=coords[2*k+inc];var i=left;var j=right;swapItem(ids,coords,left,k);if(coords[2*right+inc]>t)swapItem(ids,coords,left,right);while(i<j){swapItem(ids,coords,i,j);i++;j--;while(coords[2*i+inc]<t)i++;while(coords[2*j+inc]>t)j--}if(coords[2*left+inc]===t)swapItem(ids,coords,left,j);else{j++;swapItem(ids,coords,j,right)}if(j<=k)left=j+1;if(k<=j)right=j-1}}function swapItem(ids,coords,i,j){swap(ids,i,j);swap(coords,2*i,2*j);swap(coords,2*i+1,2*j+1)}function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j];arr[j]=tmp}},{}],462:[function(require,module,exports){"use strict";module.exports=within;function within(ids,coords,qx,qy,r,nodeSize){var stack=[0,ids.length-1,0];var result=[];var r2=r*r;while(stack.length){var axis=stack.pop();var right=stack.pop();var left=stack.pop();if(right-left<=nodeSize){for(var i=left;i<=right;i++){if(sqDist(coords[2*i],coords[2*i+1],qx,qy)<=r2)result.push(ids[i])}continue}var m=Math.floor((left+right)/2);var x=coords[2*m];var y=coords[2*m+1];if(sqDist(x,y,qx,qy)<=r2)result.push(ids[m]);var nextAxis=(axis+1)%2;if(axis===0?qx-r<=x:qy-r<=y){stack.push(left);stack.push(m-1);stack.push(nextAxis)}if(axis===0?qx+r>=x:qy+r>=y){stack.push(m+1);stack.push(right);stack.push(nextAxis)}}return result}function sqDist(ax,ay,bx,by){var dx=ax-bx;var dy=ay-by;return dx*dx+dy*dy}},{}],463:[function(require,module,exports){var isArray=require("lodash.isarray"),isTypedArray=require("lodash.istypedarray"),keys=require("lodash.keys");var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",stringTag="[object String]";function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;function arraySome(array,predicate){var index=-1,length=array.length;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}function baseIsEqual(value,other,customizer,isLoose,stackA,stackB){if(value===other){return true}if(value==null||other==null||!isObject(value)&&!isObjectLike(other)){return value!==value&&other!==other}return baseIsEqualDeep(value,other,baseIsEqual,customizer,isLoose,stackA,stackB)}function baseIsEqualDeep(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;if(!objIsArr){objTag=objToString.call(object);if(objTag==argsTag){objTag=objectTag}else if(objTag!=objectTag){objIsArr=isTypedArray(object)}}if(!othIsArr){othTag=objToString.call(other);if(othTag==argsTag){othTag=objectTag}else if(othTag!=objectTag){othIsArr=isTypedArray(other)}}var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&!(objIsArr||objIsObj)){return equalByTag(object,other,objTag)}if(!isLoose){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){return equalFunc(objIsWrapped?object.value():object,othIsWrapped?other.value():other,customizer,isLoose,stackA,stackB)}}if(!isSameTag){return false}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==object){return stackB[length]==other}}stackA.push(object);stackB.push(other);var result=(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,customizer,isLoose,stackA,stackB);stackA.pop();stackB.pop();return result}function equalArrays(array,other,equalFunc,customizer,isLoose,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isLoose&&othLength>arrLength)){return false}while(++index<arrLength){var arrValue=array[index],othValue=other[index],result=customizer?customizer(isLoose?othValue:arrValue,isLoose?arrValue:othValue,index):undefined;if(result!==undefined){if(result){continue}return false}if(isLoose){if(!arraySome(other,function(othValue){return arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB)})){return false}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB))){return false}}return true}function equalByTag(object,other,tag){switch(tag){case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return object!=+object?other!=+other:object==+other;case regexpTag:case stringTag:return object==other+""}return false}function equalObjects(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!=othLength&&!isLoose){return false}var index=objLength;while(index--){var key=objProps[index];if(!(isLoose?key in other:hasOwnProperty.call(other,key))){return false}}var skipCtor=isLoose;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key],result=customizer?customizer(isLoose?othValue:objValue,isLoose?objValue:othValue,key):undefined;if(!(result===undefined?equalFunc(objValue,othValue,customizer,isLoose,stackA,stackB):result)){return false}skipCtor||(skipCtor=key=="constructor")}if(!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){return false}}return true}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}module.exports=baseIsEqual},{"lodash.isarray":468,"lodash.istypedarray":470,"lodash.keys":471}],464:[function(require,module,exports){function bindCallback(func,thisArg,argCount){if(typeof func!="function"){return identity}if(thisArg===undefined){return func}switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source)}}return function(){return func.apply(thisArg,arguments)}}function identity(value){return value}module.exports=bindCallback},{}],465:[function(require,module,exports){var funcTag="[object Function]";var reIsHostCtor=/^\[object .+?Constructor\]$/;function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var fnToString=Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;var reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function getNative(object,key){var value=object==null?undefined:object[key];return isNative(value)?value:undefined}function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isNative(value){if(value==null){return false}if(isFunction(value)){return reIsNative.test(fnToString.call(value))}return isObjectLike(value)&&reIsHostCtor.test(value)}module.exports=getNative},{}],466:[function(require,module,exports){(function(global){var INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991;var argsTag="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]";var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index]}return array}var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var Symbol=root.Symbol,propertyIsEnumerable=objectProto.propertyIsEnumerable,spreadableSymbol=Symbol?Symbol.isConcatSpreadable:undefined;function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;predicate||(predicate=isFlattenable);result||(result=[]);while(++index<length){var value=array[index];if(depth>0&&predicate(value)){if(depth>1){baseFlatten(value,depth-1,predicate,isStrict,result)}else{arrayPush(result,value)}}else if(!isStrict){result[result.length]=value}}return result}function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}function flattenDeep(array){var length=array?array.length:0;return length?baseFlatten(array,INFINITY):[]}function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)}var isArray=Array.isArray;function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}module.exports=flattenDeep}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],467:[function(require,module,exports){var MAX_SAFE_INTEGER=9007199254740991;var argsTag="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]";var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var propertyIsEnumerable=objectProto.propertyIsEnumerable;function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)}function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}module.exports=isArguments},{}],468:[function(require,module,exports){var arrayTag="[object Array]",funcTag="[object Function]";var reIsHostCtor=/^\[object .+?Constructor\]$/;function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var fnToString=Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;var reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var nativeIsArray=getNative(Array,"isArray");var MAX_SAFE_INTEGER=9007199254740991;function getNative(object,key){var value=object==null?undefined:object[key];return isNative(value)?value:undefined}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}var isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag};function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isNative(value){if(value==null){return false}if(isFunction(value)){return reIsNative.test(fnToString.call(value))}return isObjectLike(value)&&reIsHostCtor.test(value)}module.exports=isArray},{}],469:[function(require,module,exports){var baseIsEqual=require("lodash._baseisequal"),bindCallback=require("lodash._bindcallback");function isEqual(value,other,customizer,thisArg){customizer=typeof customizer=="function"?bindCallback(customizer,thisArg,3):undefined;var result=customizer?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,customizer):!!result}module.exports=isEqual},{"lodash._baseisequal":463,"lodash._bindcallback":464}],470:[function(require,module,exports){var MAX_SAFE_INTEGER=9007199254740991;var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]";var arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var objectProto=Object.prototype;var objectToString=objectProto.toString;function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObjectLike(value){return!!value&&typeof value=="object"}function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objectToString.call(value)]}module.exports=isTypedArray},{}],471:[function(require,module,exports){var getNative=require("lodash._getnative"),isArguments=require("lodash.isarguments"),isArray=require("lodash.isarray");var reIsUint=/^\d+$/;var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var nativeKeys=getNative(Object,"keys");var MAX_SAFE_INTEGER=9007199254740991;function baseProperty(key){return function(object){return object==null?undefined:object[key]}}var getLength=baseProperty("length");function isArrayLike(value){return value!=null&&isLength(getLength(value))}function isIndex(value,length){value=typeof value=="number"||reIsUint.test(value)?+value:-1;length=length==null?MAX_SAFE_INTEGER:length;return value>-1&&value%1==0&&value<length}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function shimKeys(object){var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length;var allowIndexes=!!length&&isLength(length)&&(isArray(object)||isArguments(object));var index=-1,result=[];while(++index<propsLength){var key=props[index];if(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key)){result.push(key)}}return result}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}var keys=!nativeKeys?shimKeys:function(object){var Ctor=object==null?undefined:object.constructor;if(typeof Ctor=="function"&&Ctor.prototype===object||typeof object!="function"&&isArrayLike(object)){return shimKeys(object)}return isObject(object)?nativeKeys(object):[]};function keysIn(object){if(object==null){return[]}if(!isObject(object)){object=Object(object)}var length=object.length;length=length&&isLength(length)&&(isArray(object)||isArguments(object))&&length||0;var Ctor=object.constructor,index=-1,isProto=typeof Ctor=="function"&&Ctor.prototype===object,result=Array(length),skipIndexes=length>0;while(++index<length){result[index]=index+""}for(var key in object){if(!(skipIndexes&&isIndex(key,length))&&!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}module.exports=keys},{"lodash._getnative":465,"lodash.isarguments":467,"lodash.isarray":468}],472:[function(require,module,exports){var root=require("./_root");var Symbol=root.Symbol;module.exports=Symbol},{"./_root":479}],473:[function(require,module,exports){var Symbol=require("./_Symbol"),getRawTag=require("./_getRawTag"),objectToString=require("./_objectToString");var nullTag="[object Null]",undefinedTag="[object Undefined]";var symToStringTag=Symbol?Symbol.toStringTag:undefined;function baseGetTag(value){if(value==null){return value===undefined?undefinedTag:nullTag}return symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value)}module.exports=baseGetTag},{"./_Symbol":472,"./_getRawTag":476,"./_objectToString":477}],474:[function(require,module,exports){(function(global){var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;module.exports=freeGlobal}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],475:[function(require,module,exports){var overArg=require("./_overArg");var getPrototype=overArg(Object.getPrototypeOf,Object);module.exports=getPrototype},{"./_overArg":478}],476:[function(require,module,exports){var Symbol=require("./_Symbol");var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var nativeObjectToString=objectProto.toString;var symToStringTag=Symbol?Symbol.toStringTag:undefined;function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=undefined;var unmasked=true}catch(e){}var result=nativeObjectToString.call(value);if(unmasked){if(isOwn){value[symToStringTag]=tag}else{delete value[symToStringTag]}}return result}module.exports=getRawTag},{"./_Symbol":472}],477:[function(require,module,exports){var objectProto=Object.prototype;var nativeObjectToString=objectProto.toString;function objectToString(value){return nativeObjectToString.call(value)}module.exports=objectToString},{}],478:[function(require,module,exports){function overArg(func,transform){return function(arg){return func(transform(arg))}}module.exports=overArg},{}],479:[function(require,module,exports){var freeGlobal=require("./_freeGlobal");var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();module.exports=root},{"./_freeGlobal":474}],480:[function(require,module,exports){function isObjectLike(value){return value!=null&&typeof value=="object"}module.exports=isObjectLike},{}],481:[function(require,module,exports){var baseGetTag=require("./_baseGetTag"),getPrototype=require("./_getPrototype"),isObjectLike=require("./isObjectLike");var objectTag="[object Object]";var funcProto=Function.prototype,objectProto=Object.prototype;var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objectCtorString=funcToString.call(Object);function isPlainObject(value){if(!isObjectLike(value)||baseGetTag(value)!=objectTag){return false}var proto=getPrototype(value);if(proto===null){return true}var Ctor=hasOwnProperty.call(proto,"constructor")&&proto.constructor;return typeof Ctor=="function"&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}module.exports=isPlainObject},{"./_baseGetTag":473,"./_getPrototype":475,"./isObjectLike":480}],482:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _utils=require("../utils");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Queue=[];var Fx=function(){function Fx(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Fx);this.opt=(0,_utils.merge)({delay:0,duration:1e3,transition:function transition(x){return x},onCompute:_utils.noop,onComplete:_utils.noop},options)}_createClass(Fx,[{key:"start",value:function start(options){this.opt=(0,_utils.merge)(this.opt,options||{});this.time=Date.now();this.animating=true;Queue.push(this)}},{key:"step",value:function step(){if(!this.animating){return}var currentTime=Date.now(),time=this.time,opt=this.opt,delay=opt.delay,duration=opt.duration,delta=0;if(currentTime<time+delay){opt.onCompute.call(this,delta);return}if(currentTime<time+delay+duration){delta=opt.transition((currentTime-time-delay)/duration);opt.onCompute.call(this,delta)}else{this.animating=false;opt.onCompute.call(this,1);opt.onComplete.call(this)}}}],[{key:"compute",value:function compute(from,to,delta){return from+(to-from)*delta}}]);return Fx}();exports.default=Fx;Fx.Queue=Queue;Fx.Transition={linear:function linear(p){return p}};var Trans=Fx.Transition;Fx.prototype.time=null;function makeTrans(transition,params){params=(0,_utils.splat)(params);return Object.assign(transition,{easeIn:function easeIn(pos){return transition(pos,params)},easeOut:function easeOut(pos){return 1-transition(1-pos,params)},easeInOut:function easeInOut(pos){return pos<=.5?transition(2*pos,params)/2:(2-transition(2*(1-pos),params))/2}})}var transitions={Pow:function Pow(p,x){return Math.pow(p,x[0]||6)},Expo:function Expo(p){return Math.pow(2,8*(p-1))},Circ:function Circ(p){return 1-Math.sin(Math.acos(p))},Sine:function Sine(p){return 1-Math.sin((1-p)*Math.PI/2)},Back:function Back(p,x){x=x[0]||1.618;return Math.pow(p,2)*((x+1)*p-x)},Bounce:function Bounce(p){var value;for(var a=0,b=1;1;a+=b,b/=2){if(p>=(7-4*a)/11){value=b*b-Math.pow((11-6*a-11*p)/4,2);break}}return value},Elastic:function Elastic(p,x){return Math.pow(2,10*--p)*Math.cos(20*p*Math.PI*(x[0]||1)/3)}};for(var t in transitions){Trans[t]=makeTrans(transitions[t])}["Quad","Cubic","Quart","Quint"].forEach(function(elem,i){Trans[elem]=makeTrans(function(p){return Math.pow(p,[i+2])})});var global;try{global=window}catch(e){global=null}var checkFxQueue=function checkFxQueue(){var oldQueue=Queue;Queue=[];if(oldQueue.length){for(var i=0,l=oldQueue.length,fx;i<l;i++){fx=oldQueue[i];fx.step();if(fx.animating){Queue.push(fx)}}Fx.Queue=Queue}};if(global){var found=false;["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"].forEach(function(impl){if(impl in global){Fx.animationTime=function(){return global[impl]};found=true}});if(!found){Fx.animationTime=Date.now}found=false;["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"].forEach(function(impl){if(impl in global){Fx.requestAnimationFrame=function(callback){global[impl](function(){checkFxQueue();callback()})};found=true}});if(!found){Fx.requestAnimationFrame=function(callback){setTimeout(function(){checkFxQueue();callback()},1e3/60)}}}},{"../utils":536}],483:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.cancelAnimationFrame=exports.requestAnimationFrame=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class;var _autobindDecorator=require("autobind-decorator");var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);var _utils=require("../utils");var _webglChecks=require("../webgl/webgl-checks");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null;
}return desc}var requestAnimationFrame=exports.requestAnimationFrame=function requestAnimationFrame(callback){return _utils.isBrowser?window.requestAnimationFrame(callback):setTimeout(callback,1e3/60)};var cancelAnimationFrame=exports.cancelAnimationFrame=function cancelAnimationFrame(timerId){return _utils.isBrowser?window.cancelAnimationFrame(timerId):clearTimeout(timerId)};var AnimationFrame=(_class=function(){function AnimationFrame(){var _this=this;var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$gl=_ref.gl,gl=_ref$gl===undefined?null:_ref$gl,_ref$canvas=_ref.canvas,canvas=_ref$canvas===undefined?null:_ref$canvas,_ref$width=_ref.width,width=_ref$width===undefined?null:_ref$width,_ref$height=_ref.height,height=_ref$height===undefined?null:_ref$height,_ref$autoResizeViewpo=_ref.autoResizeViewport,autoResizeViewport=_ref$autoResizeViewpo===undefined?true:_ref$autoResizeViewpo,_ref$autoResizeCanvas=_ref.autoResizeCanvas,autoResizeCanvas=_ref$autoResizeCanvas===undefined?true:_ref$autoResizeCanvas,_ref$autoResizeDrawin=_ref.autoResizeDrawingBuffer,autoResizeDrawingBuffer=_ref$autoResizeDrawin===undefined?true:_ref$autoResizeDrawin,_ref$useDevicePixelRa=_ref.useDevicePixelRatio,useDevicePixelRatio=_ref$useDevicePixelRa===undefined?true:_ref$useDevicePixelRa,glOpts=_objectWithoutProperties(_ref,["gl","canvas","width","height","autoResizeViewport","autoResizeCanvas","autoResizeDrawingBuffer","useDevicePixelRatio"]);_classCallCheck(this,AnimationFrame);this.update({autoResizeViewport:autoResizeViewport,autoResizeCanvas:autoResizeCanvas,autoResizeDrawingBuffer:autoResizeDrawingBuffer,useDevicePixelRatio:useDevicePixelRatio});this.width=width;this.height=height;this._startPromise=_utils.pageLoadPromise.then(function(page){_this.gl=gl;return page})}_createClass(AnimationFrame,[{key:"update",value:function update(_ref2){var _ref2$autoResizeDrawi=_ref2.autoResizeDrawingBuffer,autoResizeDrawingBuffer=_ref2$autoResizeDrawi===undefined?true:_ref2$autoResizeDrawi,_ref2$autoResizeCanva=_ref2.autoResizeCanvas,autoResizeCanvas=_ref2$autoResizeCanva===undefined?true:_ref2$autoResizeCanva,_ref2$autoResizeViewp=_ref2.autoResizeViewport,autoResizeViewport=_ref2$autoResizeViewp===undefined?true:_ref2$autoResizeViewp,_ref2$useDevicePixelR=_ref2.useDevicePixelRatio,useDevicePixelRatio=_ref2$useDevicePixelR===undefined?true:_ref2$useDevicePixelR;this.autoResizeViewport=autoResizeViewport;this.autoResizeCanvas=autoResizeCanvas;this.autoResizeDrawingBuffer=autoResizeDrawingBuffer;this.useDevicePixelRatio=useDevicePixelRatio;return this}},{key:"context",value:function context(onCreateContext){var _this2=this;if(this.gl){throw new Error("AnimationFrame.context - context already provided")}this._startPromise=this._startPromise.then(function(){_this2.gl=onCreateContext();if(!(0,_webglChecks.isWebGLContext)(_this2.gl)){throw new Error("AnimationFrame.context - illegal context returned")}});return this}},{key:"init",value:function init(onInit){var _this3=this;this._startPromise=this._startPromise.then(function(){if(!_this3.gl){throw new Error("AnimationFrame.context - no context provided")}_this3._initializeContext();return onInit(_this3._context)||{}});return this}},{key:"setupFrame",value:function setupFrame(onSetupFrame){this._onSetupFrame=onSetupFrame;return this}},{key:"frame",value:function frame(onRenderFrame){this._onRenderFrame=onRenderFrame;this._restartFrame();return this}},{key:"start",value:function start(){var _this4=this;this._startPromise.then(function(){if(!_this4._animationFrameId){_this4._animationFrameId=requestAnimationFrame(_this4._frame)}});return this}},{key:"stop",value:function stop(){if(this._animationFrameId){cancelAnimationFrame(this._animationFrameId);this._animationFrameId=null}return this}},{key:"resizeCanvas",value:function resizeCanvas(width,height){this._resizeCanvas(width,height);return this}},{key:"_initializeContext",value:function _initializeContext(){this._context={gl:this.gl,canvas:this.gl.canvas,stop:this.stop,tick:0,tock:0};this._updateContext()}},{key:"_updateContext",value:function _updateContext(){var canvas=this._context.canvas;this._context.width=canvas.width;this._context.height=canvas.height;this._context.aspect=canvas.width/canvas.height}},{key:"_restartFrame",value:function _restartFrame(){var _this5=this;this.stop();this._startPromise.then(function(){var appContext=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_this5._initializeContext();if((typeof appContext==="undefined"?"undefined":_typeof(appContext))==="object"&&appContext!==null){_this5._context=_extends({},appContext,_this5._context)}_this5.start()})}},{key:"_frame",value:function _frame(){var canvas=this._context.canvas;if(this._onSetupFrame){this._onSetupFrame(this._context)}else{this._resizeCanvasDrawingBuffer(canvas);if(this.autoResizeViewport){this.gl.viewport(0,0,canvas.width,canvas.height)}}this._updateContext();this._onRenderFrame(this._context);this._context.tick++;this._animationFrameId=requestAnimationFrame(this._frame)}},{key:"_resizeCanvas",value:function _resizeCanvas(width,height){var canvas=this._context.canvas;if(canvas){if(this.autoResizeDrawingBuffer){var cssToDevicePixels=this.useDevicePixelRatio?window.devicePixelRatio||1:1;var displayWidth=Math.floor(width*cssToDevicePixels);var displayHeight=Math.floor(height*cssToDevicePixels);if(canvas.width!==displayWidth||canvas.height!==displayHeight){canvas.width=displayWidth;canvas.height=displayHeight}}canvas.style.width=width+"px";canvas.style.height=height+"px"}return this}},{key:"_resizeCanvasDrawingBuffer",value:function _resizeCanvasDrawingBuffer(){if(this.autoResizeDrawingBuffer){var canvas=this._context.canvas;var cssToDevicePixels=this.useDevicePixelRatio?window.devicePixelRatio||1:1;var oldWidth=window.innerWidth;var oldHeight=window.innerHeight;var displayWidth=Math.floor(oldWidth*cssToDevicePixels);var displayHeight=Math.floor(oldHeight*cssToDevicePixels);if(oldWidth!==displayWidth||oldHeight!==displayHeight){canvas.width=displayWidth;canvas.height=displayHeight;canvas.style.width=oldWidth;canvas.style.height=oldHeight}}}},{key:"_resizeDrawingBuffer",value:function _resizeDrawingBuffer(width,height){var canvas=this._context.canvas;if(canvas){canvas.width=width;canvas.height=height;this.autoResizeDrawingBuffer=false}return this}}]);return AnimationFrame}(),_applyDecoratedDescriptor(_class.prototype,"context",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"context"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"init",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"init"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"setupFrame",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"setupFrame"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"frame",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"frame"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"start",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"start"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"stop",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"stop"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_frame",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_frame"),_class.prototype),_class);exports.default=AnimationFrame},{"../utils":536,"../webgl/webgl-checks":557,"autobind-decorator":3}],484:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.OrthoCamera=exports.PerspectiveCamera=exports.Camera=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _deprecated=require("../deprecated");var _utils=require("../utils");function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Camera=exports.Camera=function(){function Camera(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Camera);opts=(0,_utils.merge)({fov:45,near:.1,far:500,aspect:1,position:new _deprecated.Vec3(0,0,0),target:new _deprecated.Vec3(0,0,-1),up:new _deprecated.Vec3(0,1,0)},opts);this.fov=opts.fov;this.near=opts.near;this.far=opts.far;this.aspect=opts.aspect;this.position=opts.position;this.target=opts.target;this.up=opts.up;this.view=new _deprecated.Mat4;this.uniforms={};this.projection=new _deprecated.Mat4;Object.seal(this);this.update()}_createClass(Camera,[{key:"project",value:function project(){return null}},{key:"unproject",value:function unproject(){return null}},{key:"getUniforms",value:function getUniforms(){return this.uniforms}},{key:"_updateUniforms",value:function _updateUniforms(){var viewProjection=this.view.mulMat4(this.projection);var viewProjectionInverse=viewProjection.invert();this.uniforms={cameraPosition:this.position,projectionMatrix:this.projection,viewMatrix:this.view,viewProjectionMatrix:viewProjection,viewInverseMatrix:this.view.invert(),viewProjectionInverseMatrix:viewProjectionInverse}}}]);return Camera}();var PerspectiveCamera=exports.PerspectiveCamera=function(_Camera){_inherits(PerspectiveCamera,_Camera);function PerspectiveCamera(){_classCallCheck(this,PerspectiveCamera);return _possibleConstructorReturn(this,(PerspectiveCamera.__proto__||Object.getPrototypeOf(PerspectiveCamera)).apply(this,arguments))}_createClass(PerspectiveCamera,[{key:"update",value:function update(){this.projection=(new _deprecated.Mat4).perspective(this.fov,this.aspect,this.near,this.far);this.view.lookAt(this.position,this.target,this.up);this._updateUniforms()}}]);return PerspectiveCamera}(Camera);var OrthoCamera=exports.OrthoCamera=function(){function OrthoCamera(){_classCallCheck(this,OrthoCamera)}_createClass(OrthoCamera,[{key:"update",value:function update(){var ymax=this.near*Math.tan(this.fov*Math.PI/360);var ymin=-ymax;var xmin=ymin*this.aspect;var xmax=ymax*this.aspect;this.projection=(new _deprecated.Mat4).ortho(xmin,xmax,ymin,ymax,this.near,this.far);this.view.lookAt(this.position,this.target,this.up);this._updateUniforms()}}]);return OrthoCamera}()},{"../deprecated":492,"../utils":536}],485:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var MAX_TEXTURES=exports.MAX_TEXTURES=10;var MAX_POINT_LIGHTS=exports.MAX_POINT_LIGHTS=4;var PICKING_RES=exports.PICKING_RES=4},{}],486:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Keys=exports.EventsProxy=exports.stop=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.get=get;exports.getWheel=getWheel;exports.getKey=getKey;exports.isRightClick=isRightClick;exports.getPos=getPos;exports.addEvents=addEvents;var _utils=require("../utils");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var KEYS={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,delete:46};function toO3D(n){return n!==true?n:false}function _getPos(elem){var bbox=elem.getBoundingClientRect();return{x:bbox.left,y:bbox.top,bbox:bbox}}function get(e,win){win=win||window;return e||win.event}function getWheel(e){return e.wheelDelta?e.wheelDelta/120:-(e.detail||0)/3}function getKey(e){var code=e.which||e.keyCode;var key=keyOf(code);var fKey=code-111;if(fKey>0&&fKey<13){key="f"+fKey}key=key||String.fromCharCode(code).toLowerCase();return{code:code,key:key,shift:e.shiftKey,control:e.ctrlKey,alt:e.altKey,meta:e.metaKey}}function isRightClick(e){return e.which===3||e.button===2}function getPos(e,win){win=win||window;e=e||win.event;var doc=win.document;doc=doc.documentElement||doc.body;if(e.touches&&e.touches.length){var touchesPos=[];var l=e.touches.length;var evt=void 0;for(var i=0;i<l;++i){evt=e.touches[i];touchesPos.push({x:evt.pageX||evt.clientX+doc.scrollLeft,y:evt.pageY||evt.clientY+doc.scrollTop})}return touchesPos}var page={x:e.pageX||e.clientX+doc.scrollLeft,y:e.pageY||e.clientY+doc.scrollTop};return[page]}function _stop(e){if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}exports.stop=_stop;var EventsProxy=exports.EventsProxy=function(){function EventsProxy(domElem,opt){_classCallCheck(this,EventsProxy);this.scene=opt.scene;this.domElem=domElem;this.pos=_getPos(domElem);this.opt=this.callbacks=opt;this.size={width:domElem.width||domElem.offsetWidth,height:domElem.height||domElem.offsetHeight};this.attachEvents()}_createClass(EventsProxy,[{key:"attachEvents",value:function attachEvents(){var _this=this;var domElem=this.domElem;var opt=this.opt;if(opt.disableContextMenu){domElem.oncontextmenu=function(){return false}}if(opt.enableMouse){["mouseup","mousedown","mousemove","mouseover","mouseout"].forEach(function(action){domElem.addEventListener(action,function(e,win){_this[action](_this.eventInfo(action,e,win))},false)});var type="";if(!document.getBoxObjectFor&&window.mozInnerScreenX===null){type="mousewheel"}else{type="DOMMouseScroll"}domElem.addEventListener(type,function(e,win){_this["mousewheel"](_this.eventInfo("mousewheel",e,win))},false)}if(opt.enableTouch){["touchstart","touchmove","touchend"].forEach(function(action){domElem.addEventListener(action,function(e,win){_this[action](_this.eventInfo(action,e,win))},false)})}if(opt.enableKeyboard){["keydown","keyup"].forEach(function(action){document.addEventListener(action,function(e,win){_this[action](_this.eventInfo(action,e,win))},false)})}}},{key:"eventInfo",value:function eventInfo(type,e,win){var domElem=this.domElem;var scene=this.scene;var opt=this.opt;var size=this.getSize();var relative=opt.relative;var centerOrigin=opt.centerOrigin;var pos=opt.cachePosition&&this.pos||_getPos(domElem);var ge=get(e,win);var epos=getPos(e,win);var origPos={x:epos[0].x,y:epos[0].y};var evt={};var x=void 0;var y=void 0;for(var i=0,l=epos.length;i<l;++i){x=epos[i].x;y=epos[i].y;if(relative){x-=pos.x;y-=pos.y;if(centerOrigin){x-=size.width/2;y-=size.height/2;y*=-1}}epos[i].x=x;epos[i].y=y}switch(type){case"mousewheel":evt.wheel=getWheel(ge);break;case"keydown":case"keyup":Object.assign(evt,getKey(ge));break;case"mouseup":evt.isRightClick=isRightClick(ge);break;default:break}var cacheTarget=void 0;Object.assign(evt,{x:epos[0].x,y:epos[0].y,posArray:epos,cache:false,stop:function stop(){_stop(ge)},getTarget:function getTarget(){if(cacheTarget){return cacheTarget}return cacheTarget=opt.picking&&scene.pick(origPos.x-pos.x,origPos.y-pos.y)||true}});evt.event=ge;return evt}},{key:"getSize",value:function getSize(){if(this.cacheSize){return this.size}var domElem=this.domElem;return{width:domElem.width||domElem.offsetWidth,height:domElem.height||domElem.offsetHeight}}},{key:"mouseup",value:function mouseup(e){if(!this.moved){if(e.isRightClick){this.callbacks.onRightClick(e,this.hovered)}else{this.callbacks.onClick(e,toO3D(this.pressed))}}if(this.pressed){if(this.moved){this.callbacks.onDragEnd(e,toO3D(this.pressed))}else{this.callbacks.onDragCancel(e,toO3D(this.pressed))}this.pressed=this.moved=false}}},{key:"mouseout",value:function mouseout(e){var rt=e.relatedTarget;var domElem=this.domElem;while(rt&&rt.parentNode){if(domElem===rt.parentNode){return}rt=rt.parentNode}if(this.hovered){this.callbacks.onMouseLeave(e,this.hovered);this.hovered=false}if(this.pressed&&this.moved){this.callbacks.onDragEnd(e);this.pressed=this.moved=false}}},{key:"mouseover",value:function mouseover(e){}},{key:"mousemove",value:function mousemove(e){if(this.pressed){this.moved=true;this.callbacks.onDragMove(e,toO3D(this.pressed));return}if(this.hovered){var target=toO3D(e.getTarget());if(!target||target.hash!==this.hash){this.callbacks.onMouseLeave(e,this.hovered);this.hovered=target;this.hash=target;if(target){this.hash=target.hash;this.callbacks.onMouseEnter(e,this.hovered)}}else{this.callbacks.onMouseMove(e,this.hovered)}}else{this.hovered=toO3D(e.getTarget());this.hash=this.hovered;if(this.hovered){this.hash=this.hovered.hash;this.callbacks.onMouseEnter(e,this.hovered)}}if(!this.opt.picking){this.callbacks.onMouseMove(e)}}},{key:"mousewheel",value:function mousewheel(e){this.callbacks.onMouseWheel(e)}},{key:"mousedown",value:function mousedown(e){this.pressed=e.getTarget();this.callbacks.onDragStart(e,toO3D(this.pressed))}},{key:"touchstart",value:function touchstart(e){this.touched=e.getTarget();this.touchedLastPosition={x:e.x,y:e.y};this.callbacks.onTouchStart(e,toO3D(this.touched))}},{key:"touchmove",value:function touchmove(e){if(this.touched){this.touchMoved=true;this.callbacks.onTouchMove(e,toO3D(this.touched))}}},{key:"touchend",value:function touchend(e){if(this.touched){if(this.touchMoved){this.callbacks.onTouchEnd(e,toO3D(this.touched))}else{e.x=isNaN(e.x)?this.touchedLastPosition.x:e.x;e.y=isNaN(e.y)?this.touchedLastPosition.y:e.y;this.callbacks.onTap(e,toO3D(this.touched));this.callbacks.onTouchCancel(e,toO3D(this.touched))}this.touched=this.touchMoved=false}}},{key:"keydown",value:function keydown(e){this.callbacks.onKeyDown(e)}},{key:"keyup",value:function keyup(e){this.callbacks.onKeyUp(e)}}]);return EventsProxy}();Object.assign(EventsProxy.prototype,{hovered:false,pressed:false,touched:false,touchedLastPosition:{x:0,y:0},touchMoved:false,moved:false});function addEvents(domElement){var opt=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};opt=_extends({cachePosition:true,cacheSize:true,relative:true,centerOrigin:true,disableContextMenu:true,bind:false,picking:false,enableTouch:true,enableMouse:true,enableKeyboard:true,onClick:_utils.noop,onRightClick:_utils.noop,onDragStart:_utils.noop,onDragMove:_utils.noop,onDragEnd:_utils.noop,onDragCancel:_utils.noop,onTouchStart:_utils.noop,onTouchMove:_utils.noop,onTouchEnd:_utils.noop,onTouchCancel:_utils.noop,onTap:_utils.noop,onMouseMove:_utils.noop,onMouseEnter:_utils.noop,onMouseLeave:_utils.noop,onMouseWheel:_utils.noop,onKeyDown:_utils.noop,onKeyUp:_utils.noop},opt);var bind=opt.bind;if(bind){for(var name in opt){if(name.match(/^on[a-zA-Z0-9]+$/)){(function(fname,fn){opt[fname]=function f(){fn.apply(bind,Array.prototype.slice.call(arguments))}})(name,opt[name])}}}return new EventsProxy(domElement,opt)}var Keys=exports.Keys=KEYS;function keyOf(code){var keyMap=Keys;for(var name in keyMap){if(keyMap[name]===code){return name}}return null}},{"../utils":536}],487:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ILLEGAL_ARG="Geometry: Illegal argument";var Geometry=function(){function Geometry(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},id=_ref.id,_ref$drawMode=_ref.drawMode,drawMode=_ref$drawMode===undefined?"TRIANGLES":_ref$drawMode,_ref$vertexCount=_ref.vertexCount,vertexCount=_ref$vertexCount===undefined?undefined:_ref$vertexCount,attributes=_ref.attributes,attrs=_objectWithoutProperties(_ref,["id","drawMode","vertexCount","attributes"]);_classCallCheck(this,Geometry);(0,_assert2.default)(drawMode,ILLEGAL_ARG);this.id=id||(0,_utils.uid)(this.constructor.name);this.drawMode=drawMode;this.vertexCount=vertexCount;this.attributes={};this.needsRedraw=true;this.userData={};Object.seal(this);if(attributes){this.setAttributes(attributes)}else{this.setAttributes(attrs)}}_createClass(Geometry,[{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.needsRedraw=redraw;return this}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref2$clearRedrawFlag=_ref2.clearRedrawFlags,clearRedrawFlags=_ref2$clearRedrawFlag===undefined?false:_ref2$clearRedrawFlag;var redraw=false;redraw=redraw||this.needsRedraw;this.needsRedraw=this.needsRedraw&&!clearRedrawFlags;return redraw}},{key:"setVertexCount",value:function setVertexCount(vertexCount){this.vertexCount=vertexCount}},{key:"getVertexCount",value:function getVertexCount(){if(this.vertexCount!==undefined){return this.vertexCount}else if(this.attributes.indices){return this.attributes.indices.value.length}else if(this.attributes.vertices){return this.attributes.vertices.value.length/3}else if(this.attributes.positions){return this.attributes.positions.value.length/3}return false}},{key:"hasAttribute",value:function hasAttribute(attributeName){return Boolean(this.attributes[attributeName])}},{key:"getAttribute",value:function getAttribute(attributeName){var attribute=this.attributes[attributeName];(0,_assert2.default)(attribute);return attribute.value}},{key:"getArray",value:function getArray(attributeName){var attribute=this.attributes[attributeName];(0,_assert2.default)(attribute);return attribute.value}},{key:"getAttributes",value:function getAttributes(){return this.attributes}},{key:"setAttributes",value:function setAttributes(attributes){for(var attributeName in attributes){var attribute=attributes[attributeName];attribute=ArrayBuffer.isView(attribute)?{value:attribute}:attribute;(0,_assert2.default)(ArrayBuffer.isView(attribute.value),this._print(attributeName)+": must be a typed array or an object"+"with value as typed array");this._autoDetectAttribute(attributeName,attribute);this.attributes[attributeName]=_extends({},attribute,{instanced:attribute.instanced||0})}this.setNeedsRedraw();return this}},{key:"_autoDetectAttribute",value:function _autoDetectAttribute(attributeName,attribute){var category=void 0;switch(attributeName){case"indices":category=category||"indices";break;case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":category="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":category="vectors";break}switch(category){case"vectors":attribute.size=attribute.size||3;break;case"uvs":attribute.size=attribute.size||2;break;case"indices":attribute.size=attribute.size||1;attribute.isIndexed=attribute.isIndexed||true;(0,_assert2.default)(attribute.value instanceof Uint16Array||attribute.value instanceof Uint32Array,'attribute array for "indices" must be of integer type');break}(0,_assert2.default)(attribute.size,"attribute "+attributeName+" needs size")}},{key:"_print",value:function _print(attributeName){return"Geometry "+this.id+" attribute "+attributeName}}]);return Geometry}();exports.default=Geometry},{"../utils":536,assert:2}],488:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _geometry=require("./geometry");Object.defineProperty(exports,"Geometry",{enumerable:true,get:function get(){return _interopRequireDefault(_geometry).default}});var _model=require("./model");Object.defineProperty(exports,"Model",{enumerable:true,get:function get(){return _interopRequireDefault(_model).default}});var _animationFrame=require("./animation-frame");Object.defineProperty(exports,"AnimationFrame",{enumerable:true,get:function get(){return _interopRequireDefault(_animationFrame).default}});Object.keys(_animationFrame).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _animationFrame[key]}})});var _camera=require("./camera");Object.keys(_camera).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _camera[key]}})});var _event=require("./event");Object.keys(_event).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _event[key]}})});Object.defineProperty(exports,"FrameAnimator",{enumerable:true,get:function get(){return _interopRequireDefault(_animationFrame).default}});Object.defineProperty(exports,"Renderer",{enumerable:true,get:function get(){return _interopRequireDefault(_animationFrame).default}});Object.defineProperty(exports,"Animation",{enumerable:true,get:function get(){return _interopRequireDefault(_animationFrame).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./animation-frame":483,"./camera":484,"./event":486,"./geometry":487,"./model":489}],489:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.Material=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("../webgl");var _object3d=require("../scenegraph/object-3d");var _object3d2=_interopRequireDefault(_object3d);var _utils=require("../utils");var _geometry=require("./geometry");var _geometry2=_interopRequireDefault(_geometry);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var MSG_INSTANCED_PARAM_DEPRECATED='Warning: Model constructor: parameter "instanced" renamed to "isInstanced".\nThis will become a hard error in a future version of luma.gl.';var MSG_TEXTURES_PARAM_REMOVED='Model: parameter "textures" removed. Use uniforms to set textures';var Material=exports.Material=function Material(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$shininess=_ref.shininess,shininess=_ref$shininess===undefined?0:_ref$shininess,_ref$reflection=_ref.reflection,reflection=_ref$reflection===undefined?0:_ref$reflection,_ref$refraction=_ref.refraction,refraction=_ref$refraction===undefined?0:_ref$refraction;_classCallCheck(this,Material);this.shininess=shininess;this.reflection=reflection;this.refraction=refraction};var Model=function(_Object3D){_inherits(Model,_Object3D);function Model(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,Model);opts=gl instanceof _webgl.WebGLRenderingContext?_extends({},opts,{gl:gl}):gl;var _this=_possibleConstructorReturn(this,(Model.__proto__||Object.getPrototypeOf(Model)).call(this,opts));_this.init(opts);return _this}_createClass(Model,[{key:"init",value:function init(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},program=_ref2.program,_ref2$gl=_ref2.gl,gl=_ref2$gl===undefined?null:_ref2$gl,_ref2$vs=_ref2.vs,vs=_ref2$vs===undefined?null:_ref2$vs,_ref2$fs=_ref2.fs,fs=_ref2$fs===undefined?null:_ref2$fs,geometry=_ref2.geometry,_ref2$material=_ref2.material,material=_ref2$material===undefined?null:_ref2$material,textures=_ref2.textures,_ref2$isInstanced=_ref2.isInstanced,isInstanced=_ref2$isInstanced===undefined?false:_ref2$isInstanced,_ref2$instanceCount=_ref2.instanceCount,instanceCount=_ref2$instanceCount===undefined?0:_ref2$instanceCount,_ref2$vertexCount=_ref2.vertexCount,vertexCount=_ref2$vertexCount===undefined?undefined:_ref2$vertexCount,_ref2$pickable=_ref2.pickable,pickable=_ref2$pickable===undefined?true:_ref2$pickable,_ref2$pick=_ref2.pick,pick=_ref2$pick===undefined?null:_ref2$pick,_ref2$uniforms=_ref2.uniforms,uniforms=_ref2$uniforms===undefined?{}:_ref2$uniforms,_ref2$attributes=_ref2.attributes,attributes=_ref2$attributes===undefined?{}:_ref2$attributes,_ref2$render=_ref2.render,render=_ref2$render===undefined?null:_ref2$render,_ref2$onBeforeRender=_ref2.onBeforeRender,onBeforeRender=_ref2$onBeforeRender===undefined?function(){}:_ref2$onBeforeRender,_ref2$onAfterRender=_ref2.onAfterRender,onAfterRender=_ref2$onAfterRender===undefined?function(){}:_ref2$onAfterRender,opts=_objectWithoutProperties(_ref2,["program","gl","vs","fs","geometry","material","textures","isInstanced","instanceCount","vertexCount","pickable","pick","uniforms","attributes","render","onBeforeRender","onAfterRender"]);
(0,_assert2.default)(geometry instanceof _geometry2.default,"Model needs a geometry");this.program=program||new _webgl.Program(gl,{vs:vs,fs:fs});(0,_assert2.default)(this.program instanceof _webgl.Program,"Model needs a program");if(opts.instanced){console.warn(MSG_INSTANCED_PARAM_DEPRECATED);isInstanced=isInstanced||opts.instanced}if(textures){throw new Error(MSG_TEXTURES_PARAM_REMOVED)}this.buffers={};this.userData={};this.drawParams={};this.dynamic=false;this.needsRedraw=true;this.material=material;this.setGeometry(geometry);this.attributes={};this.setAttributes(attributes);this.uniforms={};this.setUniforms(_extends({},this.program.defaultUniforms,uniforms));this.isInstanced=isInstanced;this.instanceCount=instanceCount;this.vertexCount=vertexCount;this.pickable=Boolean(pickable);this.pick=pick||function(){return false};this.onBeforeRender=onBeforeRender;this.onAfterRender=onAfterRender}},{key:"destroy",value:function destroy(){}},{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.needsRedraw=redraw;return this}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref3$clearRedrawFlag=_ref3.clearRedrawFlags,clearRedrawFlags=_ref3$clearRedrawFlag===undefined?false:_ref3$clearRedrawFlag;var redraw=false;redraw=redraw||this.needsRedraw;this.needsRedraw=this.needsRedraw&&!clearRedrawFlags;redraw=redraw||this.geometry.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags});return redraw}},{key:"setInstanceCount",value:function setInstanceCount(instanceCount){(0,_assert2.default)(instanceCount!==undefined);this.instanceCount=instanceCount;return this}},{key:"getInstanceCount",value:function getInstanceCount(){return this.instanceCount}},{key:"setVertexCount",value:function setVertexCount(vertexCount){this.vertexCount=vertexCount;return this}},{key:"getVertexCount",value:function getVertexCount(){return this.vertexCount===undefined?this.geometry.getVertexCount():this.vertexCount}},{key:"isPickable",value:function isPickable(){return this.pickable}},{key:"setPickable",value:function setPickable(){var pickable=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.pickable=Boolean(pickable);return this}},{key:"getProgram",value:function getProgram(){return this.program}},{key:"getGeometry",value:function getGeometry(){return this.geometry}},{key:"setGeometry",value:function setGeometry(geometry){this.geometry=geometry;this._createBuffersFromAttributeDescriptors(this.geometry.getAttributes());this.setNeedsRedraw();return this}},{key:"getAttributes",value:function getAttributes(){return this.attributes}},{key:"setAttributes",value:function setAttributes(){var attributes=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};Object.assign(this.attributes,attributes);this._createBuffersFromAttributeDescriptors(attributes);this.setNeedsRedraw();return this}},{key:"getUniforms",value:function getUniforms(){return this.uniforms}},{key:"setUniforms",value:function setUniforms(){var uniforms=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};(0,_webgl.checkUniformValues)(uniforms,this.id);Object.assign(this.uniforms,uniforms);this.setNeedsRedraw();return this}},{key:"draw",value:function draw(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref4$uniforms=_ref4.uniforms,uniforms=_ref4$uniforms===undefined?{}:_ref4$uniforms,_ref4$attributes=_ref4.attributes,attributes=_ref4$attributes===undefined?{}:_ref4$attributes,_ref4$settings=_ref4.settings,settings=_ref4$settings===undefined?{}:_ref4$settings;return this.render(uniforms)}},{key:"addViewUniforms",value:function addViewUniforms(uniforms){var camera=uniforms.camera,viewMatrix=uniforms.viewMatrix,modelMatrix=uniforms.modelMatrix,otherUniforms=_objectWithoutProperties(uniforms,["camera","viewMatrix","modelMatrix"]);var cameraUniforms=camera?camera.getUniforms():{};var viewUniforms=viewMatrix?this.getCoordinateUniforms(viewMatrix,modelMatrix):{};return _extends({},cameraUniforms,viewUniforms,otherUniforms)}},{key:"render",value:function render(){var uniforms=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var resolvedUniforms=this.addViewUniforms(uniforms);this.setUniforms(resolvedUniforms);_utils.log.log(2,">>> RENDERING MODEL "+this.id,this);this.setProgramState();this._logAttributesAndUniforms(3,resolvedUniforms);this.onBeforeRender();var drawParams=this.drawParams;if(drawParams.isInstanced&&!this.isInstanced){_utils.log.warn(0,"Found instanced attributes on non-instanced model")}var isIndexed=drawParams.isIndexed,indexType=drawParams.indexType;var geometry=this.geometry,isInstanced=this.isInstanced,instanceCount=this.instanceCount;(0,_webgl.draw)(this.program.gl,{drawMode:geometry.drawMode,vertexCount:this.getVertexCount(),isIndexed:isIndexed,indexType:indexType,isInstanced:isInstanced,instanceCount:instanceCount});this.onAfterRender();this.unsetProgramState();this.setNeedsRedraw(false);_utils.log.log(2,"<<< RENDERING MODEL "+this.id+" - complete");return this}},{key:"setProgramState",value:function setProgramState(){var program=this.program;program.use();this.drawParams={};program.setBuffers(this.buffers,{drawParams:this.drawParams});program.setUniforms(this.uniforms);return this}},{key:"unsetProgramState",value:function unsetProgramState(){this.program.unsetBuffers();return this}},{key:"_createBuffersFromAttributeDescriptors",value:function _createBuffersFromAttributeDescriptors(attributes){var gl=this.program.gl;for(var attributeName in attributes){var attribute=attributes[attributeName];if(attribute instanceof _webgl.Buffer){this.buffers[attributeName]=attribute}else{this.buffers[attributeName]=this.buffers[attributeName]||new _webgl.Buffer(gl);var buffer=this.buffers[attributeName];buffer.setData(_extends({},attribute,{data:attribute.value,target:attribute.isIndexed?_webgl.GL.ELEMENT_ARRAY_BUFFER:_webgl.GL.ARRAY_BUFFER}))}}return this}},{key:"_logAttributesAndUniforms",value:function _logAttributesAndUniforms(){var priority=arguments.length>0&&arguments[0]!==undefined?arguments[0]:3;var uniforms=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(_utils.log.priority>=priority){var attributeTable=this._getAttributesTable({header:"Attributes "+this.id,program:this.program,attributes:_extends({},this.geometry.attributes,this.attributes)});_utils.log.table(priority,attributeTable);var _getUniformsTable=(0,_webgl.getUniformsTable)({header:"Uniforms "+this.id,program:this.program,uniforms:_extends({},this.uniforms,uniforms)}),table=_getUniformsTable.table,unusedTable=_getUniformsTable.unusedTable,unusedCount=_getUniformsTable.unusedCount;_utils.log.table(priority,table);_utils.log.log(priority,(unusedCount||"No")+" unused uniforms ",unusedTable)}}},{key:"_getAttributesTable",value:function _getAttributesTable(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},attributes=_ref5.attributes,_ref5$header=_ref5.header,header=_ref5$header===undefined?"Attributes":_ref5$header,instanced=_ref5.instanced,program=_ref5.program;(0,_assert2.default)(program);var attributeLocations=program._attributeLocations;var table=_defineProperty({},header,{});for(var attributeName in attributeLocations){var attribute=attributes[attributeName];var location=attributeLocations[attributeName];table[attributeName]=this._getAttributeEntry(attribute,location)}for(var _attributeName in attributes){var _attribute=attributes[_attributeName];if(!table[_attributeName]){table[_attributeName]=this._getAttributeEntry(_attribute,null)}}return table}},{key:"_getAttributeEntry",value:function _getAttributeEntry(attribute,location){var round=function round(num){return Math.round(num*10)/10};var type="NOT PROVIDED";var instanced=0;var size="N/A";var verts="N/A";var bytes="N/A";var value="N/A";if(attribute&&location===null){location=attribute.isIndexed?"ELEMENT_ARRAY_BUFFER":"NOT USED"}if(attribute instanceof _webgl.Buffer){var buffer=attribute;type=buffer.layout.type;instanced=buffer.layout.instanced;size=buffer.layout.size;verts=round(buffer.data.length/buffer.layout.size);bytes=buffer.data.length*buffer.data.BYTES_PER_ELEMENT}else if(attribute){type=attribute.value.constructor.name;instanced=attribute.instanced;size=attribute.size;verts=round(attribute.value.length/attribute.size);bytes=attribute.value.length*attribute.value.BYTES_PER_ELEMENT;value=attribute.value}type=String(type).replace("Array","");var isInteger=type.indexOf("nt")!==-1;location=""+location+(instanced?" [instanced]":"");return{Location:location,"Type Size x Verts = Bytes":type+" "+size+" x "+verts+" = "+bytes,Value:(0,_utils.formatValue)(value,{size:size,isInteger:isInteger})}}},{key:"setTextures",value:function setTextures(){var textures=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];throw new Error("model.setTextures replaced: setUniforms({sampler2D: new Texture2D})")}},{key:"hash",get:function get(){return this.id+" "+this.$pickingIndex}}]);return Model}(_object3d2.default);exports.default=Model},{"../scenegraph/object-3d":530,"../utils":536,"../webgl":546,"./geometry":487,assert:2}],490:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function noop(){}var AttributeManager=function(){function AttributeManager(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$id=_ref.id,id=_ref$id===undefined?"attribute-manager":_ref$id,otherProps=_objectWithoutProperties(_ref,["id"]);_classCallCheck(this,AttributeManager);this.id=id;this.attributes={};this.allocedInstances=-1;this.needsRedraw=true;this.userData={};this.onUpdateStart=noop;this.onUpdateEnd=noop;this.onLog=this._defaultLog;Object.seal(this)}_createClass(AttributeManager,[{key:"add",value:function add(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this._add(attributes,updaters)}},{key:"invalidate",value:function invalidate(attributeName){var attributes=this.attributes;var attribute=attributes[attributeName];(0,_assert2.default)(attribute);attribute.needsUpdate=true;this.onLog(1,"invalidated attribute "+attributeName+" for "+this.id)}},{key:"invalidateAll",value:function invalidateAll(){var attributes=this.attributes;for(var attributeName in attributes){this.invalidate(attributeName)}}},{key:"update",value:function update(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},data=_ref2.data,numInstances=_ref2.numInstances,_ref2$buffers=_ref2.buffers,buffers=_ref2$buffers===undefined?{}:_ref2$buffers,_ref2$props=_ref2.props,props=_ref2$props===undefined?{}:_ref2$props,_ref2$context=_ref2.context,context=_ref2$context===undefined?{}:_ref2$context,opts=_objectWithoutProperties(_ref2,["data","numInstances","buffers","props","context"]);this._checkExternalBuffers(buffers,opts);this._setExternalBuffers(buffers);if(this._analyzeBuffers({numInstances:numInstances})){this.onUpdateStart(this.id);this._updateBuffers({numInstances:numInstances,data:data,props:props,context:context});this.onUpdateEnd(this.id)}}},{key:"setLogFunctions",value:function setLogFunctions(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},onLog=_ref3.onLog,onUpdateStart=_ref3.onUpdateStart,onUpdateEnd=_ref3.onUpdateEnd;this.onLog=onLog!==undefined?onLog:this.onLog;this.onUpdateStart=onUpdateStart!==undefined?onUpdateStart:this.onUpdateStart;this.onUpdateEnd=onUpdateEnd!==undefined?onUpdateEnd:this.onUpdateEnd}},{key:"getAttributes",value:function getAttributes(){return this.attributes}},{key:"getChangedAttributes",value:function getChangedAttributes(_ref4){var _ref4$clearChangedFla=_ref4.clearChangedFlags,clearChangedFlags=_ref4$clearChangedFla===undefined?false:_ref4$clearChangedFla;var attributes=this.attributes;var changedAttributes={};for(var attributeName in attributes){var attribute=attributes[attributeName];if(attribute.changed){attribute.changed=attribute.changed&&!clearChangedFlags;changedAttributes[attributeName]=attribute}}return changedAttributes}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref5$clearRedrawFlag=_ref5.clearRedrawFlags,clearRedrawFlags=_ref5$clearRedrawFlag===undefined?false:_ref5$clearRedrawFlag;var redraw=this.needsRedraw;redraw=redraw||this.needsRedraw;this.needsRedraw=this.needsRedraw&&!clearRedrawFlags;return redraw}},{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.needsRedraw=true;return this}},{key:"addDynamic",value:function addDynamic(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this._add(attributes,updaters)}},{key:"addInstanced",value:function addInstanced(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this._add(attributes,updaters,{instanced:1})}},{key:"_defaultLog",value:function _defaultLog(level,message){_utils.log.log(level,message)}},{key:"_add",value:function _add(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _extraProps=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var newAttributes={};for(var attributeName in attributes){if(attributeName in updaters){attributes[attributeName]=_extends({},attributes[attributeName],updaters[attributeName])}var attribute=attributes[attributeName];this._validate(attributeName,attribute);var attributeData=_extends({target:undefined,isIndexed:false,userData:{}},attribute,{isExternalBuffer:false,needsAlloc:false,needsUpdate:false,changed:false,size:attribute.size,value:attribute.value||null},_extraProps);Object.seal(attributeData);this.attributes[attributeName]=attributeData}Object.assign(this.attributes,newAttributes)}},{key:"_validate",value:function _validate(attributeName,attribute){(0,_assert2.default)(typeof attribute.size==="number","Attribute definition for "+attributeName+" missing size");(0,_assert2.default)(typeof attribute.update==="function"||attribute.noAlloc,"Attribute updater for "+attributeName+" missing update method")}},{key:"_checkExternalBuffers",value:function _checkExternalBuffers(){var bufferMap=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var attributes=this.attributes;for(var attributeName in bufferMap){var attribute=attributes[attributeName];if(!attribute&&!opts.ignoreUnknownAttributes){throw new Error("Unknown attribute prop "+attributeName)}}}},{key:"_setExternalBuffers",value:function _setExternalBuffers(bufferMap){var attributes=this.attributes,numInstances=this.numInstances;for(var attributeName in attributes){var attribute=attributes[attributeName];var buffer=bufferMap[attributeName];attribute.isExternalBuffer=false;if(buffer){if(!(buffer instanceof Float32Array)){throw new Error("Attribute properties must be of type Float32Array")}if(attribute.auto&&buffer.length<=numInstances*attribute.size){throw new Error("Attribute prop array must match length and size")}attribute.isExternalBuffer=true;attribute.needsUpdate=false;if(attribute.value!==buffer){attribute.value=buffer;attribute.changed=true;this.needsRedraw=true}}}}},{key:"_analyzeBuffers",value:function _analyzeBuffers(_ref6){var numInstances=_ref6.numInstances;var attributes=this.attributes;(0,_assert2.default)(numInstances!==undefined);var needsUpdate=false;for(var attributeName in attributes){var attribute=attributes[attributeName];if(!attribute.isExternalBuffer){var needsAlloc=attribute.value===null||attribute.value.length/attribute.size<numInstances;if(needsAlloc&&attribute.update){attribute.needsAlloc=true;needsUpdate=true}if(attribute.needsUpdate){needsUpdate=true}}}return needsUpdate}},{key:"_updateBuffers",value:function _updateBuffers(_ref7){var numInstances=_ref7.numInstances,data=_ref7.data,props=_ref7.props,context=_ref7.context;var attributes=this.attributes;var allocCount=Math.max(numInstances,1);for(var attributeName in attributes){var attribute=attributes[attributeName];if(attribute.needsAlloc){var ArrayType=attribute.type||Float32Array;attribute.value=new ArrayType(attribute.size*allocCount);this.onLog(2,this.id+":"+attributeName+" allocated "+allocCount);attribute.needsAlloc=false;attribute.needsUpdate=true}if(attribute.needsUpdate){var update=attribute.update;if(update){this.onLog(2,this.id+":"+attributeName+" updating "+numInstances);update.call(context,attribute,{data:data,props:props,numInstances:numInstances})}else{this.onLog(2,this.id+":"+attributeName+" missing update function")}attribute.needsUpdate=false;attribute.changed=true;this.needsRedraw=true}}this.allocedInstances=allocCount}}]);return AttributeManager}();exports.default=AttributeManager},{"../utils":536,assert:2}],491:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("../webgl/webgl");var _webglChecks=require("../webgl/webgl-checks");var _framebuffer=require("../webgl/framebuffer");var _framebuffer2=_interopRequireDefault(_framebuffer);var _renderbuffer=require("../webgl/renderbuffer");var _renderbuffer2=_interopRequireDefault(_renderbuffer);var _texture2d=require("../webgl/texture-2d");var _texture2d2=_interopRequireDefault(_texture2d);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var FramebufferObject=function(){function FramebufferObject(gl){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref$width=_ref.width,width=_ref$width===undefined?1:_ref$width,_ref$height=_ref.height,height=_ref$height===undefined?1:_ref$height,_ref$depth=_ref.depth,depth=_ref$depth===undefined?true:_ref$depth,_ref$minFilter=_ref.minFilter,minFilter=_ref$minFilter===undefined?_webgl.GL.NEAREST:_ref$minFilter,_ref$magFilter=_ref.magFilter,magFilter=_ref$magFilter===undefined?_webgl.GL.NEAREST:_ref$magFilter,_ref$format=_ref.format,format=_ref$format===undefined?_webgl.GL.RGBA:_ref$format,_ref$type=_ref.type,type=_ref$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref$type;_classCallCheck(this,FramebufferObject);(0,_webglChecks.assertWebGLContext)(gl);this.gl=gl;this.depth=depth;this.minFilter=minFilter;this.magFilter=magFilter;this.format=format;this.type=type;this.resize(width,height)}_createClass(FramebufferObject,[{key:"delete",value:function _delete(){}},{key:"resize",value:function resize(width,height){(0,_assert2.default)(width>=0&&height>=0,"Width and height need to be integers");if(width===this.width&&height===this.height){return}var gl=this.gl;var fb=new _framebuffer2.default(gl);var colorBuffer=new _texture2d2.default(gl,{minFilter:this.minFilter,magFilter:this.magFilter}).setImageData({data:null,width:width,height:height,type:this.type,format:this.format});fb.attachTexture({attachment:_webgl.GL.COLOR_ATTACHMENT0,texture:colorBuffer});if(this.colorBuffer){this.colorBuffer.delete()}this.colorBuffer=colorBuffer;if(this.depth){var depthBuffer=new _renderbuffer2.default(gl).storage({internalFormat:_webgl.GL.DEPTH_COMPONENT16,width:width,height:height});fb.attachRenderbuffer({attachment:_webgl.GL.DEPTH_ATTACHMENT,renderbuffer:depthBuffer});if(this.depthBuffer){this.depthBuffer.delete()}this.depthBuffer=depthBuffer}fb.checkStatus();this.width=width;this.height=height;if(this.fb){this.fb.delete()}this.fb=fb}},{key:"bind",value:function bind(){this.fb.bind()}},{key:"unbind",value:function unbind(){this.fb.unbind()}}]);return FramebufferObject}();exports.default=FramebufferObject},{"../webgl/framebuffer":544,"../webgl/renderbuffer":548,"../webgl/texture-2d":550,"../webgl/webgl":561,"../webgl/webgl-checks":557,assert:2}],492:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _math=require("./math");Object.keys(_math).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _math[key]}})});var _attributeManager=require("./attribute-manager");Object.defineProperty(exports,"AttributeManager",{enumerable:true,get:function get(){return _interopRequireDefault(_attributeManager).default}});var _fbo=require("./fbo");Object.defineProperty(exports,"FramebufferObject",{enumerable:true,get:function get(){return _interopRequireDefault(_fbo).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./attribute-manager":490,"./fbo":491,"./math":493}],493:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _extendableBuiltin5(cls){function ExtendableBuiltin(){var instance=Reflect.construct(cls,Array.from(arguments));Object.setPrototypeOf(instance,Object.getPrototypeOf(this));return instance}ExtendableBuiltin.prototype=Object.create(cls.prototype,{constructor:{value:cls,enumerable:false,writable:true,configurable:true}});if(Object.setPrototypeOf){Object.setPrototypeOf(ExtendableBuiltin,cls)}else{ExtendableBuiltin.__proto__=cls}return ExtendableBuiltin}function _extendableBuiltin3(cls){function ExtendableBuiltin(){var instance=Reflect.construct(cls,Array.from(arguments));Object.setPrototypeOf(instance,Object.getPrototypeOf(this));return instance}ExtendableBuiltin.prototype=Object.create(cls.prototype,{constructor:{value:cls,enumerable:false,writable:true,configurable:true}});if(Object.setPrototypeOf){Object.setPrototypeOf(ExtendableBuiltin,cls)}else{ExtendableBuiltin.__proto__=cls}return ExtendableBuiltin}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _extendableBuiltin(cls){function ExtendableBuiltin(){var instance=Reflect.construct(cls,Array.from(arguments));Object.setPrototypeOf(instance,Object.getPrototypeOf(this));return instance}ExtendableBuiltin.prototype=Object.create(cls.prototype,{constructor:{value:cls,enumerable:false,writable:true,configurable:true}});if(Object.setPrototypeOf){Object.setPrototypeOf(ExtendableBuiltin,cls)}else{ExtendableBuiltin.__proto__=cls}return ExtendableBuiltin}var sqrt=Math.sqrt;var sin=Math.sin;var cos=Math.cos;var tan=Math.tan;var pi=Math.PI;var slice=Array.prototype.slice;var Vec3=exports.Vec3=function(_extendableBuiltin2){_inherits(Vec3,_extendableBuiltin2);function Vec3(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,Vec3);var _this=_possibleConstructorReturn(this,(Vec3.__proto__||Object.getPrototypeOf(Vec3)).call(this,3));_this[0]=x;_this[1]=y;_this[2]=z;return _this}_createClass(Vec3,[{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=value}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=value}},{key:"z",get:function get(){return this[2]},set:function set(value){return this[2]=value}}],[{key:"create",value:function create(){return new Vec3(3)}}]);return Vec3}(_extendableBuiltin(Array));var generics={setVec3:function setVec3(dest,vec){dest[0]=vec[0];dest[1]=vec[1];dest[2]=vec[2];return dest},set:function set(dest,x,y,z){dest[0]=x;dest[1]=y;dest[2]=z;return dest},add:function add(dest,vec){return new Vec3(dest[0]+vec[0],dest[1]+vec[1],dest[2]+vec[2])},$add:function $add(dest,vec){dest[0]+=vec[0];dest[1]+=vec[1];dest[2]+=vec[2];return dest},add2:function add2(dest,a,b){dest[0]=a[0]+b[0];dest[1]=a[1]+b[1];dest[2]=a[2]+b[2];return dest},sub:function sub(dest,vec){return new Vec3(dest[0]-vec[0],dest[1]-vec[1],dest[2]-vec[2])},$sub:function $sub(dest,vec){dest[0]-=vec[0];dest[1]-=vec[1];dest[2]-=vec[2];return dest},sub2:function sub2(dest,a,b){dest[0]=a[0]-b[0];dest[1]=a[1]-b[1];dest[2]=a[2]-b[2];return dest},scale:function scale(dest,s){return new Vec3(dest[0]*s,dest[1]*s,dest[2]*s)},$scale:function $scale(dest,s){dest[0]*=s;dest[1]*=s;dest[2]*=s;return dest},neg:function neg(dest){return new Vec3(-dest[0],-dest[1],-dest[2])},$neg:function $neg(dest){dest[0]=-dest[0];dest[1]=-dest[1];dest[2]=-dest[2];return dest},unit:function unit(dest){var len=Vec3.norm(dest);if(len>0){return Vec3.scale(dest,1/len)}return Vec3.clone(dest)},$unit:function $unit(dest){var len=Vec3.norm(dest);if(len>0){return Vec3.$scale(dest,1/len)}return dest},cross:function cross(dest,vec){var dx=dest[0],dy=dest[1],dz=dest[2],vx=vec[0],vy=vec[1],vz=vec[2];return new Vec3(dy*vz-dz*vy,dz*vx-dx*vz,dx*vy-dy*vx)},$cross:function $cross(dest,vec){var dx=dest[0],dy=dest[1],dz=dest[2],vx=vec[0],vy=vec[1],vz=vec[2];dest[0]=dy*vz-dz*vy;dest[1]=dz*vx-dx*vz;dest[2]=dx*vy-dy*vx;return dest},distTo:function distTo(dest,vec){var dx=dest[0]-vec[0],dy=dest[1]-vec[1],dz=dest[2]-vec[2];return sqrt(dx*dx+dy*dy+dz*dz)},distToSq:function distToSq(dest,vec){var dx=dest[0]-vec[0],dy=dest[1]-vec[1],dz=dest[2]-vec[2];return dx*dx+dy*dy+dz*dz},norm:function norm(dest){var dx=dest[0],dy=dest[1],dz=dest[2];return sqrt(dx*dx+dy*dy+dz*dz)},normSq:function normSq(dest){var dx=dest[0],dy=dest[1],dz=dest[2];return dx*dx+dy*dy+dz*dz},dot:function dot(dest,vec){return dest[0]*vec[0]+dest[1]*vec[1]+dest[2]*vec[2]},clone:function clone(dest){if(dest instanceof Vec3){return new Vec3(dest[0],dest[1],dest[2])}return Vec3.setVec3(new Float32Array(3),dest)},toFloat32Array:function toFloat32Array(dest){var ans=dest.typedContainer;if(!ans){return dest}ans[0]=dest[0];ans[1]=dest[1];ans[2]=dest[2];return ans}};var proto=Vec3.prototype;for(var method in generics){Vec3[method]=generics[method];proto[method]=function _(m){return function(){var args=slice.call(arguments);args.unshift(this);return Vec3[m].apply(Vec3,args)}}(method)}var Mat4=exports.Mat4=function(_extendableBuiltin4){_inherits(Mat4,_extendableBuiltin4);function Mat4(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){_classCallCheck(this,Mat4);var _this2=_possibleConstructorReturn(this,(Mat4.__proto__||Object.getPrototypeOf(Mat4)).call(this,16));_this2.length=16;if(typeof n11==="number"){_this2.set(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44)}else{_this2.id()}_this2.typedContainer=new Float32Array(16);return _this2}_createClass(Mat4,[{key:"copy",value:function copy(src){for(var i=0;i<16;++i){this[i]=src[i]}return this}},{key:"n11",get:function get(){return this[0]},set:function set(val){this[0]=val}},{key:"n12",get:function get(){return this[4]},set:function set(val){this[4]=val}},{key:"n13",get:function get(){return this[8]},set:function set(val){this[8]=val}},{key:"n14",get:function get(){return this[12]},set:function set(val){this[12]=val}},{key:"n21",get:function get(){return this[1]},set:function set(val){this[1]=val}},{key:"n22",get:function get(){return this[5]},set:function set(val){this[5]=val}},{key:"n23",get:function get(){return this[9]},set:function set(val){this[9]=val}},{key:"n24",get:function get(){return this[13]},set:function set(val){this[13]=val}},{key:"n31",get:function get(){return this[2]},set:function set(val){this[2]=val}},{key:"n32",get:function get(){return this[6]},set:function set(val){this[6]=val}},{key:"n33",get:function get(){return this[10]},set:function set(val){this[10]=val}},{key:"n34",get:function get(){return this[14]},set:function set(val){this[14]=val}},{key:"n41",get:function get(){return this[3]},set:function set(val){this[3]=val}},{key:"n42",get:function get(){return this[7]},set:function set(val){this[7]=val}},{key:"n43",get:function get(){return this[11]},set:function set(val){this[11]=val}},{key:"n44",get:function get(){return this[15]},set:function set(val){this[15]=val}}],[{key:"create",value:function create(){return new Array(16)}}]);return Mat4}(_extendableBuiltin3(Array));generics={id:function id(dest){dest[0]=1;dest[1]=0;dest[2]=0;dest[3]=0;dest[4]=0;dest[5]=1;dest[6]=0;dest[7]=0;dest[8]=0;dest[9]=0;dest[10]=1;dest[11]=0;dest[12]=0;dest[13]=0;dest[14]=0;dest[15]=1;return dest},clone:function clone(dest){if(dest instanceof Mat4){return new Mat4(dest[0],dest[4],dest[8],dest[12],dest[1],dest[5],dest[9],dest[13],dest[2],dest[6],dest[10],dest[14],dest[3],dest[7],dest[11],dest[15])}return new typedArray(dest)},set:function set(dest,n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){dest[0]=n11;dest[4]=n12;dest[8]=n13;dest[12]=n14;dest[1]=n21;dest[5]=n22;dest[9]=n23;dest[13]=n24;dest[2]=n31;dest[6]=n32;dest[10]=n33;dest[14]=n34;dest[3]=n41;dest[7]=n42;dest[11]=n43;dest[15]=n44;return dest},mulVec3:function mulVec3(dest,vec){var ans=Vec3.clone(vec);return Mat4.$mulVec3(dest,ans)},$mulVec3:function $mulVec3(dest,vec){var vx=vec[0],vy=vec[1],vz=vec[2],d=1/(dest[3]*vx+dest[7]*vy+dest[11]*vz+dest[15]);vec[0]=(dest[0]*vx+dest[4]*vy+dest[8]*vz+dest[12])*d;
vec[1]=(dest[1]*vx+dest[5]*vy+dest[9]*vz+dest[13])*d;vec[2]=(dest[2]*vx+dest[6]*vy+dest[10]*vz+dest[14])*d;return vec},mulMat42:function mulMat42(dest,a,b){var a11=a[0],a12=a[1],a13=a[2],a14=a[3],a21=a[4],a22=a[5],a23=a[6],a24=a[7],a31=a[8],a32=a[9],a33=a[10],a34=a[11],a41=a[12],a42=a[13],a43=a[14],a44=a[15],b11=b[0],b12=b[1],b13=b[2],b14=b[3],b21=b[4],b22=b[5],b23=b[6],b24=b[7],b31=b[8],b32=b[9],b33=b[10],b34=b[11],b41=b[12],b42=b[13],b43=b[14],b44=b[15];dest[0]=b11*a11+b12*a21+b13*a31+b14*a41;dest[1]=b11*a12+b12*a22+b13*a32+b14*a42;dest[2]=b11*a13+b12*a23+b13*a33+b14*a43;dest[3]=b11*a14+b12*a24+b13*a34+b14*a44;dest[4]=b21*a11+b22*a21+b23*a31+b24*a41;dest[5]=b21*a12+b22*a22+b23*a32+b24*a42;dest[6]=b21*a13+b22*a23+b23*a33+b24*a43;dest[7]=b21*a14+b22*a24+b23*a34+b24*a44;dest[8]=b31*a11+b32*a21+b33*a31+b34*a41;dest[9]=b31*a12+b32*a22+b33*a32+b34*a42;dest[10]=b31*a13+b32*a23+b33*a33+b34*a43;dest[11]=b31*a14+b32*a24+b33*a34+b34*a44;dest[12]=b41*a11+b42*a21+b43*a31+b44*a41;dest[13]=b41*a12+b42*a22+b43*a32+b44*a42;dest[14]=b41*a13+b42*a23+b43*a33+b44*a43;dest[15]=b41*a14+b42*a24+b43*a34+b44*a44;return dest},mulMat4:function mulMat4(a,b){var m=Mat4.clone(a);return Mat4.mulMat42(m,a,b)},$mulMat4:function $mulMat4(a,b){return Mat4.mulMat42(a,a,b)},add:function add(dest,m){var copy=Mat4.clone(dest);return Mat4.$add(copy,m)},$add:function $add(dest,m){dest[0]+=m[0];dest[1]+=m[1];dest[2]+=m[2];dest[3]+=m[3];dest[4]+=m[4];dest[5]+=m[5];dest[6]+=m[6];dest[7]+=m[7];dest[8]+=m[8];dest[9]+=m[9];dest[10]+=m[10];dest[11]+=m[11];dest[12]+=m[12];dest[13]+=m[13];dest[14]+=m[14];dest[15]+=m[15];return dest},transpose:function transpose(dest){var m=Mat4.clone(dest);return Mat4.$transpose(m)},$transpose:function $transpose(dest){var n4=dest[4],n8=dest[8],n12=dest[12],n1=dest[1],n9=dest[9],n13=dest[13],n2=dest[2],n6=dest[6],n14=dest[14],n3=dest[3],n7=dest[7],n11=dest[11];dest[1]=n4;dest[2]=n8;dest[3]=n12;dest[4]=n1;dest[6]=n9;dest[7]=n13;dest[8]=n2;dest[9]=n6;dest[11]=n14;dest[12]=n3;dest[13]=n7;dest[14]=n11;return dest},rotateAxis:function rotateAxis(dest,theta,vec){var m=Mat4.clone(dest);return Mat4.$rotateAxis(m,theta,vec)},$rotateAxis:function $rotateAxis(dest,theta,vec){var s=sin(theta),c=cos(theta),nc=1-c,vx=vec[0],vy=vec[1],vz=vec[2],m11=vx*vx*nc+c,m12=vx*vy*nc+vz*s,m13=vx*vz*nc-vy*s,m21=vy*vx*nc-vz*s,m22=vy*vy*nc+c,m23=vy*vz*nc+vx*s,m31=vx*vz*nc+vy*s,m32=vy*vz*nc-vx*s,m33=vz*vz*nc+c,d11=dest[0],d12=dest[1],d13=dest[2],d14=dest[3],d21=dest[4],d22=dest[5],d23=dest[6],d24=dest[7],d31=dest[8],d32=dest[9],d33=dest[10],d34=dest[11],d41=dest[12],d42=dest[13],d43=dest[14],d44=dest[15];dest[0]=d11*m11+d21*m12+d31*m13;dest[1]=d12*m11+d22*m12+d32*m13;dest[2]=d13*m11+d23*m12+d33*m13;dest[3]=d14*m11+d24*m12+d34*m13;dest[4]=d11*m21+d21*m22+d31*m23;dest[5]=d12*m21+d22*m22+d32*m23;dest[6]=d13*m21+d23*m22+d33*m23;dest[7]=d14*m21+d24*m22+d34*m23;dest[8]=d11*m31+d21*m32+d31*m33;dest[9]=d12*m31+d22*m32+d32*m33;dest[10]=d13*m31+d23*m32+d33*m33;dest[11]=d14*m31+d24*m32+d34*m33;return dest},rotateXYZ:function rotateXYZ(dest,rx,ry,rz){var ans=Mat4.clone(dest);return Mat4.$rotateXYZ(ans,rx,ry,rz)},$rotateXYZ:function $rotateXYZ(dest,rx,ry,rz){var d11=dest[0],d12=dest[1],d13=dest[2],d14=dest[3],d21=dest[4],d22=dest[5],d23=dest[6],d24=dest[7],d31=dest[8],d32=dest[9],d33=dest[10],d34=dest[11],crx=cos(rx),cry=cos(ry),crz=cos(rz),srx=sin(rx),sry=sin(ry),srz=sin(rz),m11=cry*crz,m21=-crx*srz+srx*sry*crz,m31=srx*srz+crx*sry*crz,m12=cry*srz,m22=crx*crz+srx*sry*srz,m32=-srx*crz+crx*sry*srz,m13=-sry,m23=srx*cry,m33=crx*cry;dest[0]=d11*m11+d21*m12+d31*m13;dest[1]=d12*m11+d22*m12+d32*m13;dest[2]=d13*m11+d23*m12+d33*m13;dest[3]=d14*m11+d24*m12+d34*m13;dest[4]=d11*m21+d21*m22+d31*m23;dest[5]=d12*m21+d22*m22+d32*m23;dest[6]=d13*m21+d23*m22+d33*m23;dest[7]=d14*m21+d24*m22+d34*m23;dest[8]=d11*m31+d21*m32+d31*m33;dest[9]=d12*m31+d22*m32+d32*m33;dest[10]=d13*m31+d23*m32+d33*m33;dest[11]=d14*m31+d24*m32+d34*m33;return dest},translate:function translate(dest,x,y,z){var m=Mat4.clone(dest);return Mat4.$translate(m,x,y,z)},$translate:function $translate(dest,x,y,z){dest[12]=dest[0]*x+dest[4]*y+dest[8]*z+dest[12];dest[13]=dest[1]*x+dest[5]*y+dest[9]*z+dest[13];dest[14]=dest[2]*x+dest[6]*y+dest[10]*z+dest[14];dest[15]=dest[3]*x+dest[7]*y+dest[11]*z+dest[15];return dest},scale:function scale(dest,x,y,z){var m=Mat4.clone(dest);return Mat4.$scale(m,x,y,z)},$scale:function $scale(dest,x,y,z){dest[0]*=x;dest[1]*=x;dest[2]*=x;dest[3]*=x;dest[4]*=y;dest[5]*=y;dest[6]*=y;dest[7]*=y;dest[8]*=z;dest[9]*=z;dest[10]*=z;dest[11]*=z;return dest},invert:function invert(dest){var m=Mat4.clone(dest);return Mat4.$invert(m)},$invert:function $invert(dest){var x0=dest[0],x1=dest[1],x2=dest[2],x3=dest[3],x4=dest[4],x5=dest[5],x6=dest[6],x7=dest[7],x8=dest[8],x9=dest[9],x10=dest[10],x11=dest[11],x12=dest[12],x13=dest[13],x14=dest[14],x15=dest[15];var a0=x0*x5-x1*x4,a1=x0*x6-x2*x4,a2=x0*x7-x3*x4,a3=x1*x6-x2*x5,a4=x1*x7-x3*x5,a5=x2*x7-x3*x6,b0=x8*x13-x9*x12,b1=x8*x14-x10*x12,b2=x8*x15-x11*x12,b3=x9*x14-x10*x13,b4=x9*x15-x11*x13,b5=x10*x15-x11*x14;var invdet=1/(a0*b5-a1*b4+a2*b3+a3*b2-a4*b1+a5*b0);dest[0]=(+x5*b5-x6*b4+x7*b3)*invdet;dest[1]=(-x1*b5+x2*b4-x3*b3)*invdet;dest[2]=(+x13*a5-x14*a4+x15*a3)*invdet;dest[3]=(-x9*a5+x10*a4-x11*a3)*invdet;dest[4]=(-x4*b5+x6*b2-x7*b1)*invdet;dest[5]=(+x0*b5-x2*b2+x3*b1)*invdet;dest[6]=(-x12*a5+x14*a2-x15*a1)*invdet;dest[7]=(+x8*a5-x10*a2+x11*a1)*invdet;dest[8]=(+x4*b4-x5*b2+x7*b0)*invdet;dest[9]=(-x0*b4+x1*b2-x3*b0)*invdet;dest[10]=(+x12*a4-x13*a2+x15*a0)*invdet;dest[11]=(-x8*a4+x9*a2-x11*a0)*invdet;dest[12]=(-x4*b3+x5*b1-x6*b0)*invdet;dest[13]=(+x0*b3-x1*b1+x2*b0)*invdet;dest[14]=(-x12*a3+x13*a1-x14*a0)*invdet;dest[15]=(+x8*a3-x9*a1+x10*a0)*invdet;return dest},lookAt:function lookAt(dest,eye,center,up){var z=Vec3.sub(eye,center);z.$unit();var x=Vec3.cross(up,z);x.$unit();var y=Vec3.cross(z,x);y.$unit();return Mat4.set(dest,x[0],x[1],x[2],-x.dot(eye),y[0],y[1],y[2],-y.dot(eye),z[0],z[1],z[2],-z.dot(eye),0,0,0,1)},frustum:function frustum(dest,left,right,bottom,top,near,far){var rl=right-left,tb=top-bottom,fn=far-near;dest[0]=near*2/rl;dest[1]=0;dest[2]=0;dest[3]=0;dest[4]=0;dest[5]=near*2/tb;dest[6]=0;dest[7]=0;dest[8]=(right+left)/rl;dest[9]=(top+bottom)/tb;dest[10]=-(far+near)/fn;dest[11]=-1;dest[12]=0;dest[13]=0;dest[14]=-(far*near*2)/fn;dest[15]=0;return dest},perspective:function perspective(dest,fov,aspect,near,far){var ymax=near*tan(fov*pi/360),ymin=-ymax,xmin=ymin*aspect,xmax=ymax*aspect;return Mat4.frustum(dest,xmin,xmax,ymin,ymax,near,far)},ortho:function ortho(dest,left,right,top,bottom,near,far){var te=this.elements,w=right-left,h=top-bottom,p=far-near,x=(right+left)/w,y=(top+bottom)/h,z=(far+near)/p;dest[0]=2/w;dest[4]=0;dest[8]=0;dest[12]=-x;dest[1]=0;dest[5]=2/h;dest[9]=0;dest[13]=-y;dest[2]=0;dest[6]=0;dest[10]=-2/p;dest[14]=-z;dest[3]=0;dest[7]=0;dest[11]=0;dest[15]=1;return dest},toFloat32Array:function toFloat32Array(dest){var ans=dest.typedContainer;if(!ans){return dest}ans[0]=dest[0];ans[1]=dest[1];ans[2]=dest[2];ans[3]=dest[3];ans[4]=dest[4];ans[5]=dest[5];ans[6]=dest[6];ans[7]=dest[7];ans[8]=dest[8];ans[9]=dest[9];ans[10]=dest[10];ans[11]=dest[11];ans[12]=dest[12];ans[13]=dest[13];ans[14]=dest[14];ans[15]=dest[15];return ans}};proto=Mat4.prototype;for(method in generics){Mat4[method]=generics[method];proto[method]=function(m){return function(){var args=slice.call(arguments);args.unshift(this);return Mat4[m].apply(Mat4,args)}}(method)}var Quat=exports.Quat=function(_extendableBuiltin6){_inherits(Quat,_extendableBuiltin6);function Quat(x,y,z,w){_classCallCheck(this,Quat);var _this3=_possibleConstructorReturn(this,(Quat.__proto__||Object.getPrototypeOf(Quat)).call(this,4));_this3[0]=x||0;_this3[1]=y||0;_this3[2]=z||0;_this3[3]=w||0;_this3.typedContainer=new Float32Array(4);return _this3}_createClass(Quat,null,[{key:"create",value:function create(){return new Array(4)}},{key:"fromVec3",value:function fromVec3(v,r){return new Quat(v[0],v[1],v[2],r||0)}},{key:"fromMat4",value:function fromMat4(m){var u;var v;var w;if(m[0]>m[5]&&m[0]>m[10]){u=0;v=1;w=2}else if(m[5]>m[0]&&m[5]>m[10]){u=1;v=2;w=0}else{u=2;v=0;w=1}var r=sqrt(1+m[u*5]-m[v*5]-m[w*5]);var q=new Quat;q[u]=.5*r;q[v]=.5*(m["n"+v+""+u]+m["n"+u+""+v])/r;q[w]=.5*(m["n"+u+""+w]+m["n"+w+""+u])/r;q[3]=.5*(m["n"+v+""+w]-m["n"+w+""+v])/r;return q}},{key:"fromXRotation",value:function fromXRotation(angle){return new Quat(sin(angle/2),0,0,cos(angle/2))}},{key:"fromYRotation",value:function fromYRotation(angle){return new Quat(0,sin(angle/2),0,cos(angle/2))}},{key:"fromZRotation",value:function fromZRotation(angle){return new Quat(0,0,sin(angle/2),cos(angle/2))}},{key:"fromAxisRotation",value:function fromAxisRotation(vec,angle){var x=vec[0],y=vec[1],z=vec[2],d=1/sqrt(x*x+y*y+z*z),s=sin(angle/2),c=cos(angle/2);return new Quat(s*x*d,s*y*d,s*z*d,c)}}]);return Quat}(_extendableBuiltin5(Array));generics={setQuat:function setQuat(dest,q){dest[0]=q[0];dest[1]=q[1];dest[2]=q[2];dest[3]=q[3];return dest},set:function set(dest,x,y,z,w){dest[0]=x||0;dest[1]=y||0;dest[2]=z||0;dest[3]=w||0;return dest},clone:function clone(dest){if(dest instanceof Quat){return new Quat(dest[0],dest[1],dest[2],dest[3])}return Quat.setQuat(new typedArray(4),dest)},neg:function neg(dest){return new Quat(-dest[0],-dest[1],-dest[2],-dest[3])},$neg:function $neg(dest){dest[0]=-dest[0];dest[1]=-dest[1];dest[2]=-dest[2];dest[3]=-dest[3];return dest},add:function add(dest,q){return new Quat(dest[0]+q[0],dest[1]+q[1],dest[2]+q[2],dest[3]+q[3])},$add:function $add(dest,q){dest[0]+=q[0];dest[1]+=q[1];dest[2]+=q[2];dest[3]+=q[3];return dest},sub:function sub(dest,q){return new Quat(dest[0]-q[0],dest[1]-q[1],dest[2]-q[2],dest[3]-q[3])},$sub:function $sub(dest,q){dest[0]-=q[0];dest[1]-=q[1];dest[2]-=q[2];dest[3]-=q[3];return dest},scale:function scale(dest,s){return new Quat(dest[0]*s,dest[1]*s,dest[2]*s,dest[3]*s)},$scale:function $scale(dest,s){dest[0]*=s;dest[1]*=s;dest[2]*=s;dest[3]*=s;return dest},mulQuat:function mulQuat(dest,q){var aX=dest[0],aY=dest[1],aZ=dest[2],aW=dest[3],bX=q[0],bY=q[1],bZ=q[2],bW=q[3];return new Quat(aW*bX+aX*bW+aY*bZ-aZ*bY,aW*bY+aY*bW+aZ*bX-aX*bZ,aW*bZ+aZ*bW+aX*bY-aY*bX,aW*bW-aX*bX-aY*bY-aZ*bZ)},$mulQuat:function $mulQuat(dest,q){var aX=dest[0],aY=dest[1],aZ=dest[2],aW=dest[3],bX=q[0],bY=q[1],bZ=q[2],bW=q[3];dest[0]=aW*bX+aX*bW+aY*bZ-aZ*bY;dest[1]=aW*bY+aY*bW+aZ*bX-aX*bZ;dest[2]=aW*bZ+aZ*bW+aX*bY-aY*bX;dest[3]=aW*bW-aX*bX-aY*bY-aZ*bZ;return dest},divQuat:function divQuat(dest,q){var aX=dest[0],aY=dest[1],aZ=dest[2],aW=dest[3],bX=q[0],bY=q[1],bZ=q[2],bW=q[3];var d=1/(bW*bW+bX*bX+bY*bY+bZ*bZ);return new Quat((aX*bW-aW*bX-aY*bZ+aZ*bY)*d,(aX*bZ-aW*bY+aY*bW-aZ*bX)*d,(aY*bX+aZ*bW-aW*bZ-aX*bY)*d,(aW*bW+aX*bX+aY*bY+aZ*bZ)*d)},$divQuat:function $divQuat(dest,q){var aX=dest[0],aY=dest[1],aZ=dest[2],aW=dest[3],bX=q[0],bY=q[1],bZ=q[2],bW=q[3];var d=1/(bW*bW+bX*bX+bY*bY+bZ*bZ);dest[0]=(aX*bW-aW*bX-aY*bZ+aZ*bY)*d;dest[1]=(aX*bZ-aW*bY+aY*bW-aZ*bX)*d;dest[2]=(aY*bX+aZ*bW-aW*bZ-aX*bY)*d;dest[3]=(aW*bW+aX*bX+aY*bY+aZ*bZ)*d;return dest},invert:function invert(dest){var q0=dest[0],q1=dest[1],q2=dest[2],q3=dest[3];var d=1/(q0*q0+q1*q1+q2*q2+q3*q3);return new Quat(-q0*d,-q1*d,-q2*d,q3*d)},$invert:function $invert(dest){var q0=dest[0],q1=dest[1],q2=dest[2],q3=dest[3];var d=1/(q0*q0+q1*q1+q2*q2+q3*q3);dest[0]=-q0*d;dest[1]=-q1*d;dest[2]=-q2*d;dest[3]=q3*d;return dest},norm:function norm(dest){var a=dest[0],b=dest[1],c=dest[2],d=dest[3];return sqrt(a*a+b*b+c*c+d*d)},normSq:function normSq(dest){var a=dest[0],b=dest[1],c=dest[2],d=dest[3];return a*a+b*b+c*c+d*d},unit:function unit(dest){return Quat.scale(dest,1/Quat.norm(dest))},$unit:function $unit(dest){return Quat.$scale(dest,1/Quat.norm(dest))},conjugate:function conjugate(dest){return new Quat(-dest[0],-dest[1],-dest[2],dest[3])},$conjugate:function $conjugate(dest){dest[0]=-dest[0];dest[1]=-dest[1];dest[2]=-dest[2];return dest}};proto=Quat.prototype={};for(method in generics){Quat[method]=generics[method];proto[method]=function(m){return function(){var args=slice.call(arguments);args.unshift(this);return Quat[m].apply(Quat,args)}}(method)}Vec3.fromQuat=function(q){return new Vec3(q[0],q[1],q[2])};Mat4.fromQuat=function(q){var a=q[3],b=q[0],c=q[1],d=q[2];return new Mat4(a*a+b*b-c*c-d*d,2*b*c-2*a*d,2*b*d+2*a*c,0,2*b*c+2*a*d,a*a-b*b+c*c-d*d,2*c*d-2*a*b,0,2*b*d-2*a*c,2*c*d+2*a*b,a*a-b*b-c*c+d*d,0,0,0,0,1)}},{}],494:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _shaderCache=require("./shader-cache");Object.defineProperty(exports,"ShaderCache",{enumerable:true,get:function get(){return _interopRequireDefault(_shaderCache).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./shader-cache":495}],495:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("../webgl");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ERR_SOURCE="ShaderCache expects source strings";var ERR_CONTEXT="ShaderCache does not support caching across multiple contexts";var ShaderCache=function(){function ShaderCache(){_classCallCheck(this,ShaderCache);this.vertexShaders={};this.fragmentShaders={}}_createClass(ShaderCache,[{key:"delete",value:function _delete(){return this}},{key:"getVertexShader",value:function getVertexShader(gl,source){(0,_assert2.default)(typeof source==="string",ERR_SOURCE);var shader=this.vertexShaders[source];(0,_assert2.default)(!shader||shader.gl===gl,ERR_CONTEXT);if(!shader){shader=new _webgl.VertexShader(gl,source);this.vertexShaders[source]=shader}return shader}},{key:"getFragmentShader",value:function getFragmentShader(gl,source){(0,_assert2.default)(typeof source==="string",ERR_SOURCE);var shader=this.fragmentShaders[source];(0,_assert2.default)(!shader||shader.gl===gl,ERR_CONTEXT);if(!shader){shader=new _webgl.FragmentShader(gl,source);this.fragmentShaders[source]=shader}return shader}}]);return ShaderCache}();exports.default=ShaderCache},{"../webgl":546,assert:2}],496:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.ConeGeometry=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _truncatedCone=require("./truncated-cone");var _model=require("../core/model");var _model2=_interopRequireDefault(_model);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ConeGeometry=exports.ConeGeometry=function(_TruncatedConeGeometr){_inherits(ConeGeometry,_TruncatedConeGeometr);function ConeGeometry(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$radius=_ref.radius,radius=_ref$radius===undefined?1:_ref$radius,_ref$cap=_ref.cap,cap=_ref$cap===undefined?true:_ref$cap,opts=_objectWithoutProperties(_ref,["radius","cap"]);_classCallCheck(this,ConeGeometry);return _possibleConstructorReturn(this,(ConeGeometry.__proto__||Object.getPrototypeOf(ConeGeometry)).call(this,_extends({},opts,{topRadius:0,topCap:Boolean(cap),bottomCap:Boolean(cap),bottomRadius:radius})))}return ConeGeometry}(_truncatedCone.TruncatedConeGeometry);var Cone=function(_Model){_inherits(Cone,_Model);function Cone(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Cone);return _possibleConstructorReturn(this,(Cone.__proto__||Object.getPrototypeOf(Cone)).call(this,_extends({geometry:new ConeGeometry(opts)},opts)))}return Cone}(_model2.default);exports.default=Cone},{"../core/model":489,"./truncated-cone":503}],497:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.CubeGeometry=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _geometry=require("../core/geometry");var _geometry2=_interopRequireDefault(_geometry);var _model=require("../core/model");var _model2=_interopRequireDefault(_model);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CUBE_INDICES=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];var CUBE_POSITIONS=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1];var CUBE_NORMALS=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0];var CUBE_TEX_COORDS=[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1];var CubeGeometry=exports.CubeGeometry=function(_Geometry){_inherits(CubeGeometry,_Geometry);function CubeGeometry(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$id=_ref.id,id=_ref$id===undefined?(0,_utils.uid)("cube-geometry"):_ref$id,opts=_objectWithoutProperties(_ref,["id"]);_classCallCheck(this,CubeGeometry);return _possibleConstructorReturn(this,(CubeGeometry.__proto__||Object.getPrototypeOf(CubeGeometry)).call(this,_extends({},opts,{id:id,attributes:{indices:new Uint16Array(CUBE_INDICES),positions:new Float32Array(CUBE_POSITIONS),normals:new Float32Array(CUBE_NORMALS),texCoords:new Float32Array(CUBE_TEX_COORDS)}})))}return CubeGeometry}(_geometry2.default);var Cube=function(_Model){_inherits(Cube,_Model);function Cube(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref2$id=_ref2.id,id=_ref2$id===undefined?(0,_utils.uid)("cube"):_ref2$id,opts=_objectWithoutProperties(_ref2,["id"]);_classCallCheck(this,Cube);return _possibleConstructorReturn(this,(Cube.__proto__||Object.getPrototypeOf(Cube)).call(this,_extends({},opts,{id:id,geometry:new CubeGeometry(opts)})))}return Cube}(_model2.default);exports.default=Cube},{"../core/geometry":487,"../core/model":489,"../utils":536}],498:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.CylinderGeometry=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _truncatedCone=require("./truncated-cone");var _model=require("../core/model");var _model2=_interopRequireDefault(_model);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CylinderGeometry=exports.CylinderGeometry=function(_TruncatedConeGeometr){_inherits(CylinderGeometry,_TruncatedConeGeometr);function CylinderGeometry(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$radius=_ref.radius,radius=_ref$radius===undefined?1:_ref$radius,opts=_objectWithoutProperties(_ref,["radius"]);_classCallCheck(this,CylinderGeometry);return _possibleConstructorReturn(this,(CylinderGeometry.__proto__||Object.getPrototypeOf(CylinderGeometry)).call(this,_extends({},opts,{bottomRadius:radius,topRadius:radius})))}return CylinderGeometry}(_truncatedCone.TruncatedConeGeometry);var Cylinder=function(_Model){_inherits(Cylinder,_Model);function Cylinder(opts){_classCallCheck(this,Cylinder);return _possibleConstructorReturn(this,(Cylinder.__proto__||Object.getPrototypeOf(Cylinder)).call(this,_extends({},opts,{geometry:new CylinderGeometry(opts)})))}return Cylinder}(_model2.default);exports.default=Cylinder},{"../core/model":489,"./truncated-cone":503}],499:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.IcoSphereGeometry=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _math=require("../math");var _geometry=require("../core/geometry");var _geometry2=_interopRequireDefault(_geometry);var _model=require("../core/model");var _model2=_interopRequireDefault(_model);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function noop(){}var ICO_POSITIONS=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0];var ICO_INDICES=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1];var IcoSphereGeometry=exports.IcoSphereGeometry=function(_Geometry){_inherits(IcoSphereGeometry,_Geometry);function IcoSphereGeometry(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$iterations=_ref.iterations,iterations=_ref$iterations===undefined?0:_ref$iterations,_ref$onAddVertex=_ref.onAddVertex,onAddVertex=_ref$onAddVertex===undefined?noop:_ref$onAddVertex,opts=_objectWithoutProperties(_ref,["iterations","onAddVertex"]);_classCallCheck(this,IcoSphereGeometry);var PI=Math.PI;var PI2=PI*2;var positions=[].concat(ICO_POSITIONS);var indices=[].concat(ICO_INDICES);positions.push();indices.push();var getMiddlePoint=function(){var pointMemo={};return function(i1,i2){i1*=3;i2*=3;var mini=i1<i2?i1:i2;var maxi=i1>i2?i1:i2;var key=mini+"|"+maxi;if(key in pointMemo){return pointMemo[key]}var x1=positions[i1];var y1=positions[i1+1];var z1=positions[i1+2];var x2=positions[i2];var y2=positions[i2+1];var z2=positions[i2+2];var xm=(x1+x2)/2;var ym=(y1+y2)/2;var zm=(z1+z2)/2;var len=Math.sqrt(xm*xm+ym*ym+zm*zm);xm/=len;ym/=len;zm/=len;positions.push(xm,ym,zm);return pointMemo[key]=positions.length/3-1}}();for(var i=0;i<iterations;i++){var indices2=[];for(var j=0;j<indices.length;j+=3){var a=getMiddlePoint(indices[j+0],indices[j+1]);var b=getMiddlePoint(indices[j+1],indices[j+2]);var c=getMiddlePoint(indices[j+2],indices[j+0]);indices2.push(c,indices[j+0],a,a,indices[j+1],b,b,indices[j+2],c,a,b,c)}indices=indices2}var normals=new Array(indices.length*3);var texCoords=new Array(indices.length*2);var l=indices.length;for(var _i=l-3;_i>=0;_i-=3){var i1=indices[_i+0];var i2=indices[_i+1];var i3=indices[_i+2];var in1=i1*3;var in2=i2*3;var in3=i3*3;var iu1=i1*2;var iu2=i2*2;var iu3=i3*2;var x1=positions[in1+0];var y1=positions[in1+1];var z1=positions[in1+2];var theta1=Math.acos(z1/Math.sqrt(x1*x1+y1*y1+z1*z1));var phi1=Math.atan2(y1,x1)+PI;var v1=theta1/PI;var u1=1-phi1/PI2;var x2=positions[in2+0];var y2=positions[in2+1];var z2=positions[in2+2];var theta2=Math.acos(z2/Math.sqrt(x2*x2+y2*y2+z2*z2));var phi2=Math.atan2(y2,x2)+PI;var v2=theta2/PI;var u2=1-phi2/PI2;var x3=positions[in3+0];var y3=positions[in3+1];var z3=positions[in3+2];var theta3=Math.acos(z3/Math.sqrt(x3*x3+y3*y3+z3*z3));var phi3=Math.atan2(y3,x3)+PI;var v3=theta3/PI;var u3=1-phi3/PI2;var vec1=[x3-x2,y3-y2,z3-z2];var vec2=[x1-x2,y1-y2,z1-z2];var normal=_math.Vector3.cross(vec1,vec2).normalize();var newIndex=void 0;if((u1===0||u2===0||u3===0)&&(u1===0||u1>.5)&&(u2===0||u2>.5)&&(u3===0||u3>.5)){positions.push(positions[in1+0],positions[in1+1],positions[in1+2]);newIndex=positions.length/3-1;indices.push(newIndex);texCoords[newIndex*2+0]=1;texCoords[newIndex*2+1]=v1;normals[newIndex*3+0]=normal.x;normals[newIndex*3+1]=normal.y;normals[newIndex*3+2]=normal.z;positions.push(positions[in2+0],positions[in2+1],positions[in2+2]);newIndex=positions.length/3-1;indices.push(newIndex);texCoords[newIndex*2+0]=1;texCoords[newIndex*2+1]=v2;normals[newIndex*3+0]=normal.x;normals[newIndex*3+1]=normal.y;normals[newIndex*3+2]=normal.z;positions.push(positions[in3+0],positions[in3+1],positions[in3+2]);newIndex=positions.length/3-1;indices.push(newIndex);texCoords[newIndex*2+0]=1;texCoords[newIndex*2+1]=v3;normals[newIndex*3+0]=normal.x;normals[newIndex*3+1]=normal.y;normals[newIndex*3+2]=normal.z}normals[in1+0]=normals[in2+0]=normals[in3+0]=normal.x;normals[in1+1]=normals[in2+1]=normals[in3+1]=normal.y;normals[in1+2]=normals[in2+2]=normals[in3+2]=normal.z;texCoords[iu1+0]=u1;texCoords[iu1+1]=v1;texCoords[iu2+0]=u2;texCoords[iu2+1]=v2;texCoords[iu3+0]=u3;texCoords[iu3+1]=v3}return _possibleConstructorReturn(this,(IcoSphereGeometry.__proto__||Object.getPrototypeOf(IcoSphereGeometry)).call(this,_extends({},opts,{attributes:{positions:new Float32Array(positions),normals:new Float32Array(normals),texCoords:new Float32Array(texCoords),indices:new Uint16Array(indices)}})))}return IcoSphereGeometry}(_geometry2.default);var IcoSphere=function(_Model){_inherits(IcoSphere,_Model);function IcoSphere(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,IcoSphere);return _possibleConstructorReturn(this,(IcoSphere.__proto__||Object.getPrototypeOf(IcoSphere)).call(this,_extends({},opts,{geometry:new IcoSphereGeometry(opts)})))}return IcoSphere}(_model2.default);exports.default=IcoSphere},{"../core/geometry":487,"../core/model":489,"../math":517}],500:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _cone=require("./cone");Object.defineProperty(exports,"Cone",{enumerable:true,get:function get(){return _interopRequireDefault(_cone).default}});Object.defineProperty(exports,"ConeGeometry",{enumerable:true,get:function get(){return _cone.ConeGeometry}});var _cube=require("./cube");Object.defineProperty(exports,"Cube",{enumerable:true,get:function get(){return _interopRequireDefault(_cube).default}});Object.defineProperty(exports,"CubeGeometry",{enumerable:true,get:function get(){return _cube.CubeGeometry}});var _cylinder=require("./cylinder");Object.defineProperty(exports,"Cylinder",{enumerable:true,get:function get(){return _interopRequireDefault(_cylinder).default}});Object.defineProperty(exports,"CylinderGeometry",{enumerable:true,get:function get(){return _cylinder.CylinderGeometry}});var _icoSphere=require("./ico-sphere");Object.defineProperty(exports,"IcoSphere",{enumerable:true,get:function get(){return _interopRequireDefault(_icoSphere).default}});Object.defineProperty(exports,"IcoSphereGeometry",{enumerable:true,get:function get(){return _icoSphere.IcoSphereGeometry}});var _plane=require("./plane");Object.defineProperty(exports,"Plane",{enumerable:true,get:function get(){return _interopRequireDefault(_plane).default}});Object.defineProperty(exports,"PlaneGeometry",{enumerable:true,get:function get(){return _plane.PlaneGeometry}});var _sphere=require("./sphere");Object.defineProperty(exports,"Sphere",{enumerable:true,get:function get(){return _interopRequireDefault(_sphere).default}});Object.defineProperty(exports,"SphereGeometry",{enumerable:true,get:function get(){return _sphere.SphereGeometry}});Object.defineProperty(exports,"TruncatedCone",{enumerable:true,get:function get(){return _interopRequireDefault(_cone).default}});Object.defineProperty(exports,"TruncatedConeGeometry",{enumerable:true,get:function get(){return _cone.TruncatedConeGeometry}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./cone":496,"./cube":497,"./cylinder":498,"./ico-sphere":499,"./plane":501,"./sphere":502
}],501:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.PlaneGeometry=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _geometry=require("../core/geometry");var _geometry2=_interopRequireDefault(_geometry);var _model=require("../core/model");var _model2=_interopRequireDefault(_model);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var PlaneGeometry=exports.PlaneGeometry=function(_Geometry){_inherits(PlaneGeometry,_Geometry);function PlaneGeometry(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$type=_ref.type,type=_ref$type===undefined?"x,y":_ref$type,_ref$offset=_ref.offset,offset=_ref$offset===undefined?0:_ref$offset,_ref$flipCull=_ref.flipCull,flipCull=_ref$flipCull===undefined?false:_ref$flipCull,_ref$unpack=_ref.unpack,unpack=_ref$unpack===undefined?false:_ref$unpack,_ref$id=_ref.id,id=_ref$id===undefined?(0,_utils.uid)("plane-geometry"):_ref$id,opts=_objectWithoutProperties(_ref,["type","offset","flipCull","unpack","id"]);_classCallCheck(this,PlaneGeometry);var coords=type.split(",");var c1len=opts[coords[0]+"len"];var c2len=opts[coords[1]+"len"];var subdivisions1=opts["n"+coords[0]]||1;var subdivisions2=opts["n"+coords[1]]||1;var numVertices=(subdivisions1+1)*(subdivisions2+1);var positions=new Float32Array(numVertices*3);var normals=new Float32Array(numVertices*3);var texCoords=new Float32Array(numVertices*2);if(flipCull){c1len=-c1len}var i2=0;var i3=0;for(var z=0;z<=subdivisions2;z++){for(var x=0;x<=subdivisions1;x++){var u=x/subdivisions1;var v=z/subdivisions2;texCoords[i2+0]=flipCull?1-u:u;texCoords[i2+1]=v;switch(type){case"x,y":positions[i3+0]=c1len*u-c1len*.5;positions[i3+1]=c2len*v-c2len*.5;positions[i3+2]=offset;normals[i3+0]=0;normals[i3+1]=0;normals[i3+2]=flipCull?1:-1;break;case"x,z":positions[i3+0]=c1len*u-c1len*.5;positions[i3+1]=offset;positions[i3+2]=c2len*v-c2len*.5;normals[i3+0]=0;normals[i3+1]=flipCull?1:-1;normals[i3+2]=0;break;case"y,z":positions[i3+0]=offset;positions[i3+1]=c1len*u-c1len*.5;positions[i3+2]=c2len*v-c2len*.5;normals[i3+0]=flipCull?1:-1;normals[i3+1]=0;normals[i3+2]=0;break;default:break}i2+=2;i3+=3}}var numVertsAcross=subdivisions1+1;var indices=new Uint16Array(subdivisions1*subdivisions2*6);for(var _z=0;_z<subdivisions2;_z++){for(var _x2=0;_x2<subdivisions1;_x2++){var index=(_z*subdivisions1+_x2)*6;indices[index+0]=(_z+0)*numVertsAcross+_x2;indices[index+1]=(_z+1)*numVertsAcross+_x2;indices[index+2]=(_z+0)*numVertsAcross+_x2+1;indices[index+3]=(_z+1)*numVertsAcross+_x2;indices[index+4]=(_z+1)*numVertsAcross+_x2+1;indices[index+5]=(_z+0)*numVertsAcross+_x2+1}}if(unpack){var positions2=new Float32Array(indices.length*3);var normals2=new Float32Array(indices.length*3);var texCoords2=new Float32Array(indices.length*2);for(var _x3=0;_x3<indices.length;++_x3){var _index=indices[_x3];positions2[_x3*3+0]=positions[_index*3+0];positions2[_x3*3+1]=positions[_index*3+1];positions2[_x3*3+2]=positions[_index*3+2];normals2[_x3*3+0]=normals[_index*3+0];normals2[_x3*3+1]=normals[_index*3+1];normals2[_x3*3+2]=normals[_index*3+2];texCoords2[_x3*2+0]=texCoords[_index*2+0];texCoords2[_x3*2+1]=texCoords[_index*2+1]}positions=positions2;normals=normals2;texCoords=texCoords2;indices=undefined}return _possibleConstructorReturn(this,(PlaneGeometry.__proto__||Object.getPrototypeOf(PlaneGeometry)).call(this,_extends({},opts,{id:id,attributes:_extends({positions:positions,normals:normals,texCoords:texCoords},indices?{indices:indices}:{})})))}return PlaneGeometry}(_geometry2.default);var Plane=function(_Model){_inherits(Plane,_Model);function Plane(_ref2){var _ref2$id=_ref2.id,id=_ref2$id===undefined?(0,_utils.uid)("plane"):_ref2$id,opts=_objectWithoutProperties(_ref2,["id"]);_classCallCheck(this,Plane);return _possibleConstructorReturn(this,(Plane.__proto__||Object.getPrototypeOf(Plane)).call(this,_extends({},opts,{id:id,geometry:new PlaneGeometry(opts)})))}return Plane}(_model2.default);exports.default=Plane},{"../core/geometry":487,"../core/model":489,"../utils":536}],502:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.SphereGeometry=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _geometry=require("../core/geometry");var _geometry2=_interopRequireDefault(_geometry);var _model=require("../core/model");var _model2=_interopRequireDefault(_model);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SphereGeometry=exports.SphereGeometry=function(_Geometry){_inherits(SphereGeometry,_Geometry);function SphereGeometry(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$nlat=_ref.nlat,nlat=_ref$nlat===undefined?10:_ref$nlat,_ref$nlong=_ref.nlong,nlong=_ref$nlong===undefined?10:_ref$nlong,_ref$radius=_ref.radius,radius=_ref$radius===undefined?1:_ref$radius,_ref$id=_ref.id,id=_ref$id===undefined?(0,_utils.uid)("sphere-geometry"):_ref$id,opts=_objectWithoutProperties(_ref,["nlat","nlong","radius","id"]);_classCallCheck(this,SphereGeometry);var startLat=0;var endLat=Math.PI;var latRange=endLat-startLat;var startLong=0;var endLong=2*Math.PI;var longRange=endLong-startLong;var numVertices=(nlat+1)*(nlong+1);if(typeof radius==="number"){(function(){var value=radius;radius=function radius(n1,n2,n3,u,v){return value}})()}var positions=new Float32Array(numVertices*3);var normals=new Float32Array(numVertices*3);var texCoords=new Float32Array(numVertices*2);var indices=new Uint16Array(nlat*nlong*6);for(var y=0;y<=nlat;y++){for(var x=0;x<=nlong;x++){var u=x/nlong;var v=y/nlat;var index=x+y*(nlong+1);var i2=index*2;var i3=index*3;var theta=longRange*u;var phi=latRange*v;var sinTheta=Math.sin(theta);var cosTheta=Math.cos(theta);var sinPhi=Math.sin(phi);var cosPhi=Math.cos(phi);var ux=cosTheta*sinPhi;var uy=cosPhi;var uz=sinTheta*sinPhi;var r=radius(ux,uy,uz,u,v);positions[i3+0]=r*ux;positions[i3+1]=r*uy;positions[i3+2]=r*uz;normals[i3+0]=ux;normals[i3+1]=uy;normals[i3+2]=uz;texCoords[i2+0]=u;texCoords[i2+1]=v}}var numVertsAround=nlat+1;for(var _x2=0;_x2<nlat;_x2++){for(var _y=0;_y<nlong;_y++){var _index=(_x2*nlong+_y)*6;indices[_index+0]=_y*numVertsAround+_x2;indices[_index+1]=_y*numVertsAround+_x2+1;indices[_index+2]=(_y+1)*numVertsAround+_x2;indices[_index+3]=(_y+1)*numVertsAround+_x2;indices[_index+4]=_y*numVertsAround+_x2+1;indices[_index+5]=(_y+1)*numVertsAround+_x2+1}}return _possibleConstructorReturn(this,(SphereGeometry.__proto__||Object.getPrototypeOf(SphereGeometry)).call(this,_extends({},opts,{id:id,attributes:{positions:positions,indices:indices,normals:normals,texCoords:texCoords}})))}return SphereGeometry}(_geometry2.default);var Sphere=function(_Model){_inherits(Sphere,_Model);function Sphere(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref2$id=_ref2.id,id=_ref2$id===undefined?(0,_utils.uid)("sphere"):_ref2$id,opts=_objectWithoutProperties(_ref2,["id"]);_classCallCheck(this,Sphere);return _possibleConstructorReturn(this,(Sphere.__proto__||Object.getPrototypeOf(Sphere)).call(this,_extends({},opts,{id:id,geometry:new SphereGeometry(opts)})))}return Sphere}(_model2.default);exports.default=Sphere},{"../core/geometry":487,"../core/model":489,"../utils":536}],503:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.TruncatedConeGeometry=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _geometry=require("../core/geometry");var _geometry2=_interopRequireDefault(_geometry);var _model=require("../core/model");var _model2=_interopRequireDefault(_model);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TruncatedConeGeometry=exports.TruncatedConeGeometry=function(_Geometry){_inherits(TruncatedConeGeometry,_Geometry);function TruncatedConeGeometry(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$bottomRadius=_ref.bottomRadius,bottomRadius=_ref$bottomRadius===undefined?0:_ref$bottomRadius,_ref$topRadius=_ref.topRadius,topRadius=_ref$topRadius===undefined?0:_ref$topRadius,_ref$height=_ref.height,height=_ref$height===undefined?1:_ref$height,_ref$nradial=_ref.nradial,nradial=_ref$nradial===undefined?10:_ref$nradial,_ref$nvertical=_ref.nvertical,nvertical=_ref$nvertical===undefined?10:_ref$nvertical,_ref$topCap=_ref.topCap,topCap=_ref$topCap===undefined?false:_ref$topCap,_ref$bottomCap=_ref.bottomCap,bottomCap=_ref$bottomCap===undefined?false:_ref$bottomCap,opts=_objectWithoutProperties(_ref,["bottomRadius","topRadius","height","nradial","nvertical","topCap","bottomCap"]);_classCallCheck(this,TruncatedConeGeometry);var extra=(topCap?2:0)+(bottomCap?2:0);var numVertices=(nradial+1)*(nvertical+1+extra);var slant=Math.atan2(bottomRadius-topRadius,height);var msin=Math.sin;var mcos=Math.cos;var mpi=Math.PI;var cosSlant=mcos(slant);var sinSlant=msin(slant);var start=topCap?-2:0;var end=nvertical+(bottomCap?2:0);var vertsAroundEdge=nradial+1;var positions=new Float32Array(numVertices*3);var normals=new Float32Array(numVertices*3);var texCoords=new Float32Array(numVertices*2);var indices=new Uint16Array(nradial*(nvertical+extra)*6);var i3=0;var i2=0;for(var i=start;i<=end;i++){var v=i/nvertical;var y=height*v;var ringRadius=void 0;if(i<0){y=0;v=1;ringRadius=bottomRadius}else if(i>nvertical){y=height;v=1;ringRadius=topRadius}else{ringRadius=bottomRadius+(topRadius-bottomRadius)*(i/nvertical)}if(i===-2||i===nvertical+2){ringRadius=0;v=0}y-=height/2;for(var j=0;j<vertsAroundEdge;j++){var sin=msin(j*mpi*2/nradial);var cos=mcos(j*mpi*2/nradial);positions[i3+0]=sin*ringRadius;positions[i3+1]=y;positions[i3+2]=cos*ringRadius;normals[i3+0]=i<0||i>nvertical?0:sin*cosSlant;normals[i3+1]=i<0?-1:i>nvertical?1:sinSlant;normals[i3+2]=i<0||i>nvertical?0:cos*cosSlant;texCoords[i2+0]=j/nradial;texCoords[i2+1]=v;i2+=2;i3+=3}}for(var _i=0;_i<nvertical+extra;_i++){for(var _j=0;_j<nradial;_j++){var index=(_i*nradial+_j)*6;indices[index+0]=vertsAroundEdge*(_i+0)+0+_j;indices[index+1]=vertsAroundEdge*(_i+0)+1+_j;indices[index+2]=vertsAroundEdge*(_i+1)+1+_j;indices[index+3]=vertsAroundEdge*(_i+0)+0+_j;indices[index+4]=vertsAroundEdge*(_i+1)+1+_j;indices[index+5]=vertsAroundEdge*(_i+1)+0+_j}}return _possibleConstructorReturn(this,(TruncatedConeGeometry.__proto__||Object.getPrototypeOf(TruncatedConeGeometry)).call(this,_extends({},opts,{attributes:{positions:positions,normals:normals,texCoords:texCoords,indices:indices}})))}return TruncatedConeGeometry}(_geometry2.default);var TruncatedCone=function(_Model){_inherits(TruncatedCone,_Model);function TruncatedCone(opts){_classCallCheck(this,TruncatedCone);return _possibleConstructorReturn(this,(TruncatedCone.__proto__||Object.getPrototypeOf(TruncatedCone)).call(this,_extends({},opts,{geometry:new TruncatedConeGeometry(opts)})))}return TruncatedCone}(_model2.default);exports.default=TruncatedCone},{"../core/geometry":487,"../core/model":489}],504:[function(require,module,exports){(function(global){"use strict";var _isBrowser=require("./utils/is-browser");var _isBrowser2=_interopRequireDefault(_isBrowser);var _package=require("../package.json");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _global=_isBrowser2.default?window:global;var luma={VERSION:_package.version,globals:{headlessGL:null,headlessTypes:null,modules:{},nodeIO:{}},global:_global};if(_global.luma&&_global.luma.VERSION!==luma.VERSION){var versions=_global.luma.VERSION+" vs "+luma.VERSION;throw new Error("luma.gl - multiple versions detected: "+versions)}_global.luma=luma;module.exports=luma}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../package.json":565,"./utils/is-browser":537}],505:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _withoutIo=require("./without-io");Object.keys(_withoutIo).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _withoutIo[key]}})});var _io=require("./io");Object.keys(_io).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _io[key]}})});var _globals=require("./globals");var _globals2=_interopRequireDefault(_globals);var io=_interopRequireWildcard(_io);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.assign(_globals2.default,io)},{"./globals":504,"./io":510,"./without-io":564}],506:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.writeFile=writeFile;exports.readFile=readFile;var _utils=require("../../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var savedNavigatorExists="navigator"in global;var savedNavigator=global.navigator;if(!_utils.isBrowser){global.navigator={userAgent:"MSIE 9."}}var saveAs=require("filesaver.js");if(!_utils.isBrowser){if(savedNavigatorExists){global.navigator=savedNavigator}else{delete global.navigator}}var window=require("global/window");var File=window.File;var Blob=window.Blob;function writeFile(file,data,options){var callback=arguments.length>3&&arguments[3]!==undefined?arguments[3]:function(){};if(callback===undefined&&typeof options==="function"){options=undefined;callback=options}if(typeof data==="string"){data=new Blob(data)}return new Promise(function(resolve,reject){var result=void 0;try{result=saveAs(data,file,options)}catch(error){reject(error);return callback(error,null)}resolve();return callback(null,result)})}function readFile(file){return new Promise(function(resolve,reject){try{(function(){(0,_assert2.default)(File,"window.File not defined. Must run under browser.");(0,_assert2.default)(file instanceof File,"parameter must be a File object");var reader=new window.FileReader;reader.onerror=function(e){return reject(new Error(getFileErrorMessage(e)))};reader.onabort=function(){return reject(new Error("Read operation was aborted."))};reader.onload=function(){return resolve(reader.result)};reader.readAsText(file)})()}catch(error){reject(error)}})}function getFileErrorMessage(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:return"File not found.";case e.target.error.NOT_READABLE_ERR:return"File not readable.";case e.target.error.ABORT_ERR:return"Read operation was aborted.";case e.target.error.SECURITY_ERR:return"File is in a locked state.";case e.target.error.ENCODING_ERR:return'File is too long to encode in "data://" URL.';default:return"Read error."}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../../utils":536,assert:2,"filesaver.js":415,"global/window":449}],507:[function(require,module,exports){(function(process,Buffer){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.compressImage=compressImage;exports.loadImage=loadImage;var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);var _through=require("through");var _through2=_interopRequireDefault(_through);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function compressImage(image,type){if(image instanceof HTMLCanvasElement){var _canvas=image;return _canvas.toDataURL(type)}(0,_assert2.default)(image instanceof Image,"getImageData accepts image or canvas");var canvas=document.createElement("canvas");canvas.width=image.width;canvas.height=image.height;canvas.getContext("2d").drawImage(image,0,0);var data=canvas.toDataURL(type||"png").replace(/^data:image\/(png|jpg);base64,/,"");var result=(0,_through2.default)();process.nextTick(function(){return result.end(new Buffer(data,"base64"))});return result}function loadImage(url){return new Promise(function(resolve,reject){try{(function(){var image=new Image;image.onload=function(){return resolve(image)};image.onerror=function(){return reject(new Error("Could not load image "+url+"."))};image.src=url})()}catch(error){reject(error)}})}}).call(this,require("_process"),require("buffer").Buffer)},{_process:11,assert:2,buffer:19,through:988}],508:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.loadFile=loadFile;function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function noop(){}var XHR_STATES={UNINITIALIZED:0,LOADING:1,LOADED:2,INTERACTIVE:3,COMPLETED:4};var XHR=function(){function XHR(_ref){var url=_ref.url,_ref$path=_ref.path,path=_ref$path===undefined?null:_ref$path,_ref$method=_ref.method,method=_ref$method===undefined?"GET":_ref$method,_ref$async=_ref.async,async=_ref$async===undefined?true:_ref$async,_ref$noCache=_ref.noCache,noCache=_ref$noCache===undefined?false:_ref$noCache,_ref$sendAsBinary=_ref.sendAsBinary,sendAsBinary=_ref$sendAsBinary===undefined?false:_ref$sendAsBinary,_ref$responseType=_ref.responseType,responseType=_ref$responseType===undefined?false:_ref$responseType,_ref$onProgress=_ref.onProgress,onProgress=_ref$onProgress===undefined?noop:_ref$onProgress,_ref$onSuccess=_ref.onSuccess,onSuccess=_ref$onSuccess===undefined?noop:_ref$onSuccess,_ref$onError=_ref.onError,onError=_ref$onError===undefined?noop:_ref$onError,_ref$onAbort=_ref.onAbort,onAbort=_ref$onAbort===undefined?noop:_ref$onAbort,_ref$onComplete=_ref.onComplete,onComplete=_ref$onComplete===undefined?noop:_ref$onComplete,opt=_objectWithoutProperties(_ref,["url","path","method","async","noCache","sendAsBinary","responseType","onProgress","onSuccess","onError","onAbort","onComplete"]);_classCallCheck(this,XHR);this.url=path?path.join(path,url):url;this.method=method;this.async=async;this.noCache=noCache;this.sendAsBinary=sendAsBinary;this.responseType=responseType;this.req=new XMLHttpRequest;this.req.onload=function(e){return onComplete(e)};this.req.onerror=function(e){return onError(e)};this.req.onabort=function(e){return onAbort(e)};this.req.onprogress=function(e){if(e.lengthComputable){onProgress(e,Math.round(e.loaded/e.total*100))}else{onProgress(e,-1)}}}_createClass(XHR,[{key:"setRequestHeader",value:function setRequestHeader(header,value){this.req.setRequestHeader(header,value);return this}},{key:"sendAsync",value:function sendAsync(){var _this=this;var body=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.body||null;return new Promise(function(resolve,reject){try{(function(){var req=_this.req,method=_this.method,async=_this.async,noCache=_this.noCache,sendAsBinary=_this.sendAsBinary,responseType=_this.responseType;var url=noCache?_this.url+(_this.url.indexOf("?")>=0?"&":"?")+Date.now():_this.url;req.open(method,url,async);if(responseType){req.responseType=responseType}if(async){req.onreadystatechange=function(e){if(req.readyState===XHR_STATES.COMPLETED){if(req.status===200){resolve(req.responseType?req.response:req.responseText)}else{reject(new Error(req.status+": "+url))}}}}if(sendAsBinary){req.sendAsBinary(body)}else{req.send(body)}if(!async){if(req.status===200){resolve(req.responseType?req.response:req.responseText)}else{reject(new Error(req.status+": "+url))}}})()}catch(error){reject(error)}})}}]);return XHR}();function loadFile(opts){var xhr=new XHR(opts);return xhr.sendAsync()}},{}],509:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.browserFs=exports.loadFile=undefined;var _browserRequest=require("./browser-request");Object.defineProperty(exports,"loadFile",{enumerable:true,get:function get(){return _browserRequest.loadFile}});var _browserImageIo=require("./browser-image-io");Object.keys(_browserImageIo).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _browserImageIo[key]}})});var _browserFs=require("./browser-fs");var browserFs=_interopRequireWildcard(_browserFs);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}exports.browserFs=browserFs},{"./browser-fs":506,"./browser-image-io":507,"./browser-request":508}],510:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _platform=require("./platform");Object.keys(_platform).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _platform[key]}})});var _loadFiles=require("./load-files");Object.keys(_loadFiles).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _loadFiles[key]}})})},{"./load-files":511,"./platform":514}],511:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.loadFiles=loadFiles;exports.loadImages=loadImages;exports.loadTextures=loadTextures;exports.loadProgram=loadProgram;exports.loadModel=loadModel;exports.parseModel=parseModel;var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);var _platform=require("./platform");var _webgl=require("../webgl");var _core=require("../core");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function noop(){}function loadFiles(_ref){var urls=_ref.urls,_ref$onProgress=_ref.onProgress,onProgress=_ref$onProgress===undefined?noop:_ref$onProgress,opts=_objectWithoutProperties(_ref,["urls","onProgress"]);(0,_assert2.default)(urls.every(function(url){return typeof url==="string"}),"loadImages: {urls} must be array of strings");var count=0;return Promise.all(urls.map(function(url){var promise=(0,_platform.loadFile)(_extends({url:url},opts));promise.then(function(file){return onProgress({progress:++count/urls.length,count:count,total:urls.length,url:url})});return promise}))}function loadImages(_ref2){var urls=_ref2.urls,_ref2$onProgress=_ref2.onProgress,onProgress=_ref2$onProgress===undefined?noop:_ref2$onProgress,opts=_objectWithoutProperties(_ref2,["urls","onProgress"]);(0,_assert2.default)(urls.every(function(url){return typeof url==="string"}),"loadImages: {urls} must be array of strings");var count=0;return Promise.all(urls.map(function(url){var promise=(0,_platform.loadImage)(url);promise.then(function(file){return onProgress({progress:++count/urls.length,count:count,total:urls.length,url:url})});return promise}))}function loadTextures(gl,_ref3){var urls=_ref3.urls,_ref3$onProgress=_ref3.onProgress,onProgress=_ref3$onProgress===undefined?noop:_ref3$onProgress,opts=_objectWithoutProperties(_ref3,["urls","onProgress"]);(0,_assert2.default)(urls.every(function(url){return typeof url==="string"}),"loadTextures: {urls} must be array of strings");return loadImages(_extends({urls:urls,onProgress:onProgress},opts)).then(function(images){return images.map(function(img,i){var params=Array.isArray(opts.parameters)?opts.parameters[i]:opts.parameters;params=params===undefined?{}:params;return new _webgl.Texture2D(gl,_extends({id:urls[i]},params,{data:img}))})})}function loadProgram(gl,_ref4){var vs=_ref4.vs,fs=_ref4.fs,_ref4$onProgress=_ref4.onProgress,onProgress=_ref4$onProgress===undefined?noop:_ref4$onProgress,opts=_objectWithoutProperties(_ref4,["vs","fs","onProgress"]);return loadFiles(_extends({urls:[vs,fs],onProgress:onProgress},opts)).then(function(_ref5){var _ref6=_slicedToArray(_ref5,2),vsText=_ref6[0],fsText=_ref6[1];return new _webgl.Program(gl,_extends({vs:vsText,fs:fsText},opts))})}function loadModel(gl,_ref7){var url=_ref7.url,_ref7$onProgress=_ref7.onProgress,onProgress=_ref7$onProgress===undefined?noop:_ref7$onProgress,opts=_objectWithoutProperties(_ref7,["url","onProgress"]);return loadFiles(_extends({urls:[url],onProgress:onProgress},opts)).then(function(_ref8){var _ref9=_slicedToArray(_ref8,1),file=_ref9[0];return parseModel(gl,_extends({file:file},opts))})}function parseModel(gl,_ref10){var file=_ref10.file,_ref10$program=_ref10.program,program=_ref10$program===undefined?new _webgl.Program(gl):_ref10$program,opts=_objectWithoutProperties(_ref10,["file","program"]);var json=typeof file==="string"?parseJSON(file):file;var attributes={};var modelOptions={};for(var key in json){var value=json[key];if(Array.isArray(value)){attributes[key]=key==="indices"?new Uint16Array(value):new Float32Array(value)}else{modelOptions[key]=value}}return new _core.Model(_extends({program:program,geometry:new _core.Geometry({attributes:attributes})},modelOptions,opts))}function parseJSON(file){try{return JSON.parse(file)}catch(error){throw new Error("Failed to parse JSON: "+error)}}},{"../core":488,"../webgl":546,"./platform":514,assert:2}],512:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.compressImage=compressImage;exports.loadImage=loadImage;var _getPixels=require("get-pixels");var _getPixels2=_interopRequireDefault(_getPixels);var _savePixels=require("save-pixels");var _savePixels2=_interopRequireDefault(_savePixels);var _ndarray=require("ndarray");var _ndarray2=_interopRequireDefault(_ndarray);var _fs=require("fs");var _utils=require("../../utils");var _globals=require("../../globals");var _globals2=_interopRequireDefault(_globals);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function compressImage(image){var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"png";return(0,_savePixels2.default)((0,_ndarray2.default)(image.data,[image.width,image.height,4],[4,image.width*4,1],0),type.replace("image/",""))}var getPixelsAsync=(0,_utils.promisify)(_getPixels2.default);function loadImage(url){return getPixelsAsync(url)}_globals2.default.globals.modules.getPixels=_getPixels2.default;_globals2.default.globals.modules.savePixels=_savePixels2.default;_globals2.default.globals.modules.ndarray=_ndarray2.default;_globals2.default.globals.nodeIO={readFile:_fs.readFile,writeFile:_fs.writeFile,compressImage:compressImage,loadImage:loadImage}},{"../../globals":504,"../../utils":536,fs:9,"get-pixels":427,
ndarray:731,"save-pixels":967}],513:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _headlessIo=require("./headless-io");Object.keys(_headlessIo).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _headlessIo[key]}})})},{"./headless-io":512}],514:[function(require,module,exports){"use strict";var _utils=require("../utils");module.exports=_utils.isBrowser?require("./browser"):require("./node")},{"../utils":536,"./browser":509,"./node":513}],515:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.glMatrix=undefined;exports.configure=configure;exports.formatValue=formatValue;exports.isArray=isArray;exports.clone=clone;exports.radians=radians;exports.degrees=degrees;exports.sin=sin;exports.cos=cos;exports.tan=tan;exports.asin=asin;exports.acos=acos;exports.atan=atan;exports.clamp=clamp;exports.equals=equals;var _glMatrix=require("gl-matrix");_glMatrix.glMatrix.debug=true;_glMatrix.glMatrix.printRowMajor=true;exports.glMatrix=_glMatrix.glMatrix;function configure(options){if("epsilon"in options){_glMatrix.glMatrix.EPSILON=options.epsilon}if("debug"in options){_glMatrix.glMatrix.debug=options.debug}}function formatValue(value){var precision=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_glMatrix.glMatrix.precision||4;return parseFloat(value.toPrecision(precision))}function isArray(value){return Array.isArray(value)||ArrayBuffer.isView(value)&&value.length}function clone(array){return array.clone?array.clone():new Array(array)}function map(value,func){if(isArray(value)){var result=clone(value);for(var i=0;i<result.length;++i){result[i]=func(result[i],i,result)}return result}return func(value)}function radians(degrees){return map(degrees,function(degrees){return degrees/180*Math.PI})}function degrees(radians){return map(radians,function(radians){return radians*180/Math.PI})}function sin(radians){return map(radians,function(angle){return Math.sin(angle)})}function cos(radians){return map(radians,function(angle){return Math.cos(angle)})}function tan(radians){return map(radians,function(angle){return Math.tan(angle)})}function asin(radians){return map(radians,function(angle){return Math.asin(angle)})}function acos(radians){return map(radians,function(angle){return Math.acos(angle)})}function atan(radians){return map(radians,function(angle){return Math.atan(angle)})}function clamp(value,min,max){return Math.max(min,Math.min(max,value))}function equals(a,b){return Math.abs(a-b)<=_glMatrix.glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))}},{"gl-matrix":438}],516:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _matrix=require("./matrix4");var _quaternion=require("./quaternion");var _vector=require("./vector3");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ERR_UNKNOWN_ORDER="Unknown Euler angle order";var ALMOST_ONE=.99999;function validateOrder(value){return value>=0&&value<6}function checkOrder(value){if(value<0&&value>=6){throw new Error(ERR_UNKNOWN_ORDER)}return value}var Euler=function(_MathArray){_inherits(Euler,_MathArray);_createClass(Euler,[{key:"ELEMENTS",get:function get(){return 4}}],[{key:"rotationOrder",value:function rotationOrder(order){return Euler.RotationOrders[order]}},{key:"ZYX",get:function get(){return 0}},{key:"YXZ",get:function get(){return 1}},{key:"XZY",get:function get(){return 2}},{key:"ZXY",get:function get(){return 3}},{key:"YZX",get:function get(){return 4}},{key:"XYZ",get:function get(){return 5}},{key:"RollPitchYaw",get:function get(){return 0}},{key:"DefaultOrder",get:function get(){return Euler.ZYX}},{key:"RotationOrders",get:function get(){return["ZYX","YXZ","XZY","ZXY","YZX","XYZ"]}}]);function Euler(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var order=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Euler.DefaultOrder;_classCallCheck(this,Euler);var _this=_possibleConstructorReturn(this,(Euler.__proto__||Object.getPrototypeOf(Euler)).call(this));if(arguments.length>0&&Array.isArray(arguments[0])){_this.fromVector3.apply(_this,arguments)}else{_this.set(x,y,z,order)}return _this}_createClass(Euler,[{key:"copy",value:function copy(array){for(var i=0;i<3;++i){this[i]=array[i]}this[3]=Number.isFinite(array[3])||this.order;this.check();return this}},{key:"set",value:function set(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var order=arguments[3];this[0]=x;this[1]=y;this[2]=z;this[3]=Number.isFinite(order)?order:this[3];this.check();return this}},{key:"validate",value:function validate(){return validateOrder(this[3])&&Number.isFinite(this[0])&&Number.isFinite(this[1])&&Number.isFinite(this[2])}},{key:"toArray",value:function toArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;array[offset]=this[0];array[offset+1]=this[1];array[offset+2]=this[2];return array}},{key:"toArray4",value:function toArray4(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;array[offset]=this[0];array[offset+1]=this[1];array[offset+2]=this[2];array[offset+3]=this[3];return array}},{key:"toVector3",value:function toVector3(optionalResult){if(optionalResult){return optionalResult.set(this[0],this[1],this[2])}return new _vector.Vector3(this[0],this[1],this[2])}},{key:"fromVector3",value:function fromVector3(v,order){return this.set(v[0],v[1],v[2],Number.isFinite(order)?order:this[3])}},{key:"fromArray",value:function fromArray(array){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;this[0]=array[0+offset];this[1]=array[1+offset];this[2]=array[2+offset];if(array[3]!==undefined){this[3]=array[3]}this.check();return this}},{key:"fromRollPitchYaw",value:function fromRollPitchYaw(roll,pitch,yaw){return this.set(roll,pitch,yaw,Euler.ZYX)}},{key:"fromQuaternion",value:function fromQuaternion(q,order){this._fromRotationMatrix(_matrix.Matrix4.fromQuaternion(q),order);this.check();return this}},{key:"fromRotationMatrix",value:function fromRotationMatrix(m){var order=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Euler.DefaultOrder;this._fromRotationMatrix(m,order);this.check();return this}},{key:"getRotationMatrix",value:function getRotationMatrix(){var m=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new _matrix.Matrix4;this._getRotationMatrix(m);return m}},{key:"getQuaternion",value:function getQuaternion(){var q=new _quaternion.Quaternion;switch(this[4]){case Euler.XYZ:return q.rotateX(this[0]).rotateY(this[1]).rotateZ(this[2]);case Euler.YXZ:return q.rotateY(this[0]).rotateX(this[1]).rotateZ(this[2]);case Euler.ZXY:return q.rotateZ(this[0]).rotateX(this[1]).rotateY(this[2]);case Euler.ZYX:return q.rotateZ(this[0]).rotateY(this[1]).rotateX(this[2]);case Euler.YZX:return q.rotateY(this[0]).rotateZ(this[1]).rotateX(this[2]);case Euler.XZY:return q.rotateX(this[0]).rotateZ(this[1]).rotateY(this[2]);default:throw new Error(ERR_UNKNOWN_ORDER)}}},{key:"_fromRotationMatrix",value:function _fromRotationMatrix(m){var order=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Euler.DefaultOrder;var te=m.elements;var m11=te[0],m12=te[4],m13=te[8];var m21=te[1],m22=te[5],m23=te[9];var m31=te[2],m32=te[6],m33=te[10];order=order||this[3];switch(order){case Euler.XYZ:this[1]=Math.asin((0,_common.clamp)(m13,-1,1));if(Math.abs(m13)<ALMOST_ONE){this[0]=Math.atan2(-m23,m33);this[2]=Math.atan2(-m12,m11)}else{this[0]=Math.atan2(m32,m22);this[2]=0}break;case Euler.YXZ:this[0]=Math.asin(-(0,_common.clamp)(m23,-1,1));if(Math.abs(m23)<ALMOST_ONE){this[1]=Math.atan2(m13,m33);this[2]=Math.atan2(m21,m22)}else{this[1]=Math.atan2(-m31,m11);this[2]=0}break;case Euler.ZXY:this[0]=Math.asin((0,_common.clamp)(m32,-1,1));if(Math.abs(m32)<ALMOST_ONE){this[1]=Math.atan2(-m31,m33);this[2]=Math.atan2(-m12,m22)}else{this[1]=0;this[2]=Math.atan2(m21,m11)}break;case Euler.ZYX:this[1]=Math.asin(-(0,_common.clamp)(m31,-1,1));if(Math.abs(m31)<ALMOST_ONE){this[0]=Math.atan2(m32,m33);this[2]=Math.atan2(m21,m11)}else{this[0]=0;this[2]=Math.atan2(-m12,m22)}break;case Euler.YZX:this[2]=Math.asin((0,_common.clamp)(m21,-1,1));if(Math.abs(m21)<ALMOST_ONE){this[0]=Math.atan2(-m23,m22);this[1]=Math.atan2(-m31,m11)}else{this[0]=0;this[1]=Math.atan2(m13,m33)}break;case Euler.XZY:this[2]=Math.asin(-(0,_common.clamp)(m12,-1,1));if(Math.abs(m12)<ALMOST_ONE){this[0]=Math.atan2(m32,m22);this[1]=Math.atan2(m13,m11)}else{this[0]=Math.atan2(-m23,m33);this[1]=0}break;default:throw new Error(ERR_UNKNOWN_ORDER)}this[3]=order;return this}},{key:"_getRotationMatrix",value:function _getRotationMatrix(){var te=new _matrix.Matrix4;var x=this.x,y=this.y,z=this.z;var a=Math.cos(x);var c=Math.cos(y);var e=Math.cos(z);var b=Math.sin(x);var d=Math.sin(y);var f=Math.sin(z);switch(this[3]){case Euler.XYZ:{var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=-c*f;te[8]=d;te[1]=af+be*d;te[5]=ae-bf*d;te[9]=-b*c;te[2]=bf-ae*d;te[6]=be+af*d;te[10]=a*c;break}case Euler.YXZ:{var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce+df*b;te[4]=de*b-cf;te[8]=a*d;te[1]=a*f;te[5]=a*e;te[9]=-b;te[2]=cf*b-de;te[6]=df+ce*b;te[10]=a*c;break}case Euler.ZXY:{var _ce=c*e,_cf=c*f,_de=d*e,_df=d*f;te[0]=_ce-_df*b;te[4]=-a*f;te[8]=_de+_cf*b;te[1]=_cf+_de*b;te[5]=a*e;te[9]=_df-_ce*b;te[2]=-a*d;te[6]=b;te[10]=a*c;break}case Euler.ZYX:{var _ae=a*e,_af=a*f,_be=b*e,_bf=b*f;te[0]=c*e;te[4]=_be*d-_af;te[8]=_ae*d+_bf;te[1]=c*f;te[5]=_bf*d+_ae;te[9]=_af*d-_be;te[2]=-d;te[6]=b*c;te[10]=a*c;break}case Euler.YZX:{var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=bd-ac*f;te[8]=bc*f+ad;te[1]=f;te[5]=a*e;te[9]=-b*e;te[2]=-d*e;te[6]=ad*f+bc;te[10]=ac-bd*f;break}case Euler.XZY:{var _ac=a*c,_ad=a*d,_bc=b*c,_bd=b*d;te[0]=c*e;te[4]=-f;te[8]=d*e;te[1]=_ac*f+_bd;te[5]=a*e;te[9]=_ad*f-_bc;te[2]=_bc*f-_ad;te[6]=b*e;te[10]=_bd*f+_ac;break}default:throw new Error(ERR_UNKNOWN_ORDER)}te[3]=0;te[7]=0;te[11]=0;te[12]=0;te[13]=0;te[14]=0;te[15]=1;return this}},{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"z",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"alpha",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"beta",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"gamma",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"phi",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"theta",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"psi",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"order",get:function get(){return this[3]},set:function set(value){return this[3]=checkOrder(value)}}]);return Euler}(_mathArray2.default);exports.default=Euler},{"./common":515,"./math-array":518,"./matrix4":519,"./quaternion":520,"./vector3":524}],517:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _common=require("./common");Object.keys(_common).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _common[key]}})});var _vector=require("./vector2");Object.defineProperty(exports,"Vector2",{enumerable:true,get:function get(){return _interopRequireDefault(_vector).default}});var _vector2=require("./vector3");Object.defineProperty(exports,"Vector3",{enumerable:true,get:function get(){return _interopRequireDefault(_vector2).default}});var _vector3=require("./vector4");Object.defineProperty(exports,"Vector4",{enumerable:true,get:function get(){return _interopRequireDefault(_vector3).default}});var _matrix=require("./matrix4");Object.defineProperty(exports,"Matrix4",{enumerable:true,get:function get(){return _interopRequireDefault(_matrix).default}});var _quaternion=require("./quaternion");Object.defineProperty(exports,"Quaternion",{enumerable:true,get:function get(){return _interopRequireDefault(_quaternion).default}});var _euler=require("./euler");Object.defineProperty(exports,"Euler",{enumerable:true,get:function get(){return _interopRequireDefault(_euler).default}});exports.tapeEquals=tapeEquals;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function tapeEquals(t,a,b,msg,extra){t._assert(a.equals(b),{message:msg||"should be equal",operator:"equal",actual:a,expected:b,extra:extra})}},{"./common":515,"./euler":516,"./matrix4":519,"./quaternion":520,"./vector2":523,"./vector3":524,"./vector4":525}],518:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _common=require("./common");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _extendableBuiltin(cls){function ExtendableBuiltin(){var instance=Reflect.construct(cls,Array.from(arguments));Object.setPrototypeOf(instance,Object.getPrototypeOf(this));return instance}ExtendableBuiltin.prototype=Object.create(cls.prototype,{constructor:{value:cls,enumerable:false,writable:true,configurable:true}});if(Object.setPrototypeOf){Object.setPrototypeOf(ExtendableBuiltin,cls)}else{ExtendableBuiltin.__proto__=cls}return ExtendableBuiltin}var MathArray=function(_extendableBuiltin2){_inherits(MathArray,_extendableBuiltin2);function MathArray(){_classCallCheck(this,MathArray);return _possibleConstructorReturn(this,(MathArray.__proto__||Object.getPrototypeOf(MathArray)).apply(this,arguments))}_createClass(MathArray,[{key:"clone",value:function clone(){var Subclass=this.constructor;var clone=(new Subclass).copy(this);clone.check();return clone}},{key:"copy",value:function copy(array){for(var i=0;i<this.ELEMENTS;++i){this[i]=array[i]}this.check();return this}},{key:"set",value:function set(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}for(var i=0;i<this.ELEMENTS;++i){this[i]=args[i]||0}this.check();return this}},{key:"fromArray",value:function fromArray(array){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;for(var i=0;i<this.ELEMENTS;++i){this[i]=array[i+offset]}this.check();return this}},{key:"toString",value:function toString(){var string="";for(var i=0;i<this.ELEMENTS;++i){string+=(i>0?", ":"")+(0,_common.formatValue)(this[i])}return this.constructor.name+"("+string+")"}},{key:"toArray",value:function toArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;for(var i=0;i<this.ELEMENTS;++i){array[offset+i]=this[i]}return array}},{key:"toFloat32Array",value:function toFloat32Array(){return new Float32Array(this)}},{key:"equals",value:function equals(array){if(this.length!==array.length){return false}for(var i=0;i<this.ELEMENTS;++i){if(!(0,_common.equals)(this[i],array[i])){return false}}return true}},{key:"exactEquals",value:function exactEquals(array){if(this.length!==array.length){return false}for(var i=0;i<this.ELEMENTS;++i){if(this[i]!==array[i]){return false}}return true}},{key:"validate",value:function validate(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this;var valid=array.length===this.ELEMENTS;for(var i=0;i<this.ELEMENTS;++i){valid=valid&&Number.isFinite(array[i])}return valid}},{key:"check",value:function check(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this;if(_common.glMatrix.debug&&!this.validate(array)){throw new Error("Invalid "+this.constructor.name)}}}]);return MathArray}(_extendableBuiltin(Array));exports.default=MathArray},{"./common":515}],519:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class;var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _vector=require("./vector2");var _vector2=_interopRequireDefault(_vector);var _vector3=require("./vector3");var _vector4=_interopRequireDefault(_vector3);var _vector5=require("./vector4");var _vector6=_interopRequireDefault(_vector5);var _decorators=require("./utils/decorators");var _glMatrix=require("gl-matrix");var _validators=require("./utils/validators");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}var Matrix4=(_class=function(_MathArray){_inherits(Matrix4,_MathArray);function Matrix4(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_classCallCheck(this,Matrix4);var _this=_possibleConstructorReturn(this,(Matrix4.__proto__||Object.getPrototypeOf(Matrix4)).call(this));if(Array.isArray(args[0])&&arguments.length===1){_this.copy(args[0])}else{_this.identity()}return _this}_createClass(Matrix4,[{key:"setRowMajor",value:function setRowMajor(){var m00=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var m10=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var m20=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var m30=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var m01=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var m11=arguments.length>5&&arguments[5]!==undefined?arguments[5]:1;var m21=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var m31=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var m02=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var m12=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var m22=arguments.length>10&&arguments[10]!==undefined?arguments[10]:1;var m32=arguments.length>11&&arguments[11]!==undefined?arguments[11]:0;var m03=arguments.length>12&&arguments[12]!==undefined?arguments[12]:0;var m13=arguments.length>13&&arguments[13]!==undefined?arguments[13]:0;var m23=arguments.length>14&&arguments[14]!==undefined?arguments[14]:0;var m33=arguments.length>15&&arguments[15]!==undefined?arguments[15]:1;_glMatrix.mat4.set(this,m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33);this.check();return this}},{key:"setColumnMajor",value:function setColumnMajor(){var m00=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var m01=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var m02=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var m03=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var m10=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var m11=arguments.length>5&&arguments[5]!==undefined?arguments[5]:1;var m12=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var m13=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var m20=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var m21=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var m22=arguments.length>10&&arguments[10]!==undefined?arguments[10]:1;var m23=arguments.length>11&&arguments[11]!==undefined?arguments[11]:0;var m30=arguments.length>12&&arguments[12]!==undefined?arguments[12]:0;var m31=arguments.length>13&&arguments[13]!==undefined?arguments[13]:0;var m32=arguments.length>14&&arguments[14]!==undefined?arguments[14]:0;var m33=arguments.length>15&&arguments[15]!==undefined?arguments[15]:1;_glMatrix.mat4.set(this,m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33);this.check();return this}},{key:"equals",value:function equals(a){return _glMatrix.mat4.equals(this,a)}},{key:"exactEquals",value:function exactEquals(a){return _glMatrix.mat4.exactEquals(this,a)}},{key:"toString",value:function toString(){if(_common.glMatrix.printRowMajor){_glMatrix.mat4.str(this)}else{_glMatrix.mat4.str(this)}}},{key:"determinant",value:function determinant(){return _glMatrix.mat4.determinant(this)}},{key:"getRotation",value:function getRotation(){}},{key:"identity",value:function identity(){_glMatrix.mat4.identity(this);this.check();return this}},{key:"frustum",value:function frustum(_ref){var left=_ref.left,right=_ref.right,bottom=_ref.bottom,top=_ref.top,near=_ref.near,far=_ref.far;_glMatrix.mat4.frustum(this,left,right,bottom,top,near,far);this.check();return this}},{key:"lookAt",value:function lookAt(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},eye=_ref2.eye,_ref2$center=_ref2.center,center=_ref2$center===undefined?[0,0,0]:_ref2$center,_ref2$up=_ref2.up,up=_ref2$up===undefined?[0,1,0]:_ref2$up;_glMatrix.mat4.lookAt(this,eye,center,up);this.check();return this}},{key:"ortho",value:function ortho(_ref3){var left=_ref3.left,right=_ref3.right,bottom=_ref3.bottom,top=_ref3.top,_ref3$near=_ref3.near,near=_ref3$near===undefined?.1:_ref3$near,_ref3$far=_ref3.far,far=_ref3$far===undefined?500:_ref3$far;_glMatrix.mat4.ortho(this,left,right,bottom,top,near,far);this.check();return this}},{key:"perspective",value:function perspective(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref4$fov=_ref4.fov,fov=_ref4$fov===undefined?45*Math.PI/180:_ref4$fov,_ref4$aspect=_ref4.aspect,aspect=_ref4$aspect===undefined?1:_ref4$aspect,_ref4$near=_ref4.near,near=_ref4$near===undefined?.1:_ref4$near,_ref4$far=_ref4.far,far=_ref4$far===undefined?500:_ref4$far;if(fov>Math.PI*2){throw Error("radians")}_glMatrix.mat4.perspective(this,fov,aspect,near,far);this.check();return this}},{key:"perspectiveFromFieldOfView",value:function perspectiveFromFieldOfView(out,fov,near,far){_glMatrix.mat4.perspectiveFromFieldOfView(out,fov,near,far);this.check();return this}},{key:"fromQuaternion",value:function fromQuaternion(q){_glMatrix.mat4.fromQuat(this,q);this.check();return this}},{key:"fromQuat",value:function fromQuat(q){_glMatrix.mat4.fromQuat(this,q);this.check();return this}},{key:"fromRotation",value:function fromRotation(rad,axis){_glMatrix.mat4.fromRotation(this,rad,axis);this.check();return this}},{key:"fromRotationTranslation",value:function fromRotationTranslation(q,v){_glMatrix.mat4.fromRotationTranslation(this,q,v);this.check();return this}},{key:"fromRotationTranslationScale",value:function fromRotationTranslationScale(q,v,s){_glMatrix.mat4.fromRotationTranslationScale(this,q,v,s);this.check();return this}},{key:"fromRotationTranslationScaleOrigin",value:function fromRotationTranslationScaleOrigin(q,v,s,o){_glMatrix.mat4.fromRotationTranslationScaleOrigin(this,q,v,s,o);this.check();return this}},{key:"fromScaling",value:function fromScaling(v){_glMatrix.mat4.fromScaling(this,v);this.check();return this}},{key:"fromTranslation",value:function fromTranslation(v){_glMatrix.mat4.fromTranslation(this,v);this.check();return this}},{key:"fromXRotation",value:function fromXRotation(rad){_glMatrix.mat4.fromXRotation(this,rad);this.check();return this}},{key:"fromYRotation",value:function fromYRotation(rad){_glMatrix.mat4.fromYRotation(this,rad);this.check();return this}},{key:"fromZRotation",value:function fromZRotation(rad){_glMatrix.mat4.fromZRotation(this,rad);this.check();return this}},{key:"transpose",value:function transpose(){_glMatrix.mat4.transpose(this,this);this.check();return this}},{key:"invert",value:function invert(){_glMatrix.mat4.invert(this,this);this.check();return this}},{key:"adjoint",value:function adjoint(){_glMatrix.mat4.adjoint(this,this);this.check();return this}},{key:"add",value:function add(a,b){_glMatrix.mat4.add(this,this,a);this.check();return this}},{key:"multiplyLeft",value:function multiplyLeft(a){_glMatrix.mat4.multiply(this,a,this);this.check();return this}},{key:"multiplyRight",value:function multiplyRight(a){_glMatrix.mat4.multiply(this,this,a);this.check();return this}},{key:"rotateX",value:function rotateX(radians){_glMatrix.mat4.rotateX(this,this,radians);this.check();return this}},{key:"rotateY",value:function rotateY(radians){_glMatrix.mat4.rotateY(this,this,radians);this.check();return this}},{key:"rotateZ",value:function rotateZ(radians){_glMatrix.mat4.rotateZ(this,this,radians);this.check();return this}},{key:"rotateXYZ",value:function rotateXYZ(_ref5){var _ref6=_slicedToArray(_ref5,3),rx=_ref6[0],ry=_ref6[1],rz=_ref6[2];var d11=this[0];var d12=this[1];var d13=this[2];var d14=this[3];var d21=this[4];var d22=this[5];var d23=this[6];var d24=this[7];var d31=this[8];var d32=this[9];var d33=this[10];var d34=this[11];var crx=Math.cos(rx);var cry=Math.cos(ry);var crz=Math.cos(rz);var srx=Math.sin(rx);var sry=Math.sin(ry);var srz=Math.sin(rz);var m11=cry*crz;var m21=-crx*srz+srx*sry*crz;var m31=srx*srz+crx*sry*crz;var m12=cry*srz;var m22=crx*crz+srx*sry*srz;var m32=-srx*crz+crx*sry*srz;var m13=-sry;var m23=srx*cry;var m33=crx*cry;this[0]=d11*m11+d21*m12+d31*m13;this[1]=d12*m11+d22*m12+d32*m13;this[2]=d13*m11+d23*m12+d33*m13;this[3]=d14*m11+d24*m12+d34*m13;this[4]=d11*m21+d21*m22+d31*m23;this[5]=d12*m21+d22*m22+d32*m23;this[6]=d13*m21+d23*m22+d33*m23;this[7]=d14*m21+d24*m22+d34*m23;this[8]=d11*m31+d21*m32+d31*m33;this[9]=d12*m31+d22*m32+d32*m33;this[10]=d13*m31+d23*m32+d33*m33;this[11]=d14*m31+d24*m32+d34*m33;this.check();return this}},{key:"scale",value:function scale(vec){_glMatrix.mat4.scale(this,this,vec);this.check();return this}},{key:"translate",value:function translate(vec){_glMatrix.mat4.translate(this,this,vec);this.check();return this}},{key:"transformVector2",value:function transformVector2(vector){var out=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new _vector2.default;_glMatrix.vec2.transformMat4(out,vector,this);(0,_validators.checkVector2)(out);return out}},{key:"transformVector3",value:function transformVector3(vector){var out=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new _vector4.default;_glMatrix.vec3.transformMat4(out,vector,this);(0,_validators.checkVector3)(out);return out}},{key:"transformVector4",value:function transformVector4(vector){var out=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new _vector6.default;_glMatrix.vec4.transformMat4(out,vector,this);(0,_validators.checkVector4)(out);
return out}},{key:"transformVector",value:function transformVector(vector){switch(vector.length){case 2:return this.transformVector2(vector);case 3:return this.transformVector3(vector);case 4:return this.transformVector4(vector);default:throw new Error("Illegal vector")}}},{key:"ELEMENTS",get:function get(){return 16}},{key:"m00",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"m01",get:function get(){return this[4]},set:function set(value){return this[4]=(0,_common.checkNumber)(value)}},{key:"m02",get:function get(){return this[8]},set:function set(value){return this[8]=(0,_common.checkNumber)(value)}},{key:"m03",get:function get(){return this[12]},set:function set(value){return this[12]=(0,_common.checkNumber)(value)}},{key:"m10",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"m11",get:function get(){return this[5]},set:function set(value){return this[5]=(0,_common.checkNumber)(value)}},{key:"m12",get:function get(){return this[9]},set:function set(value){return this[9]=(0,_common.checkNumber)(value)}},{key:"m13",get:function get(){return this[13]},set:function set(value){return this[13]=(0,_common.checkNumber)(value)}},{key:"m20",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"m21",get:function get(){return this[6]},set:function set(value){return this[6]=(0,_common.checkNumber)(value)}},{key:"m22",get:function get(){return this[10]},set:function set(value){return this[10]=(0,_common.checkNumber)(value)}},{key:"m23",get:function get(){return this[14]},set:function set(value){return this[14]=(0,_common.checkNumber)(value)}},{key:"m30",get:function get(){return this[3]},set:function set(value){return this[3]=(0,_common.checkNumber)(value)}},{key:"m31",get:function get(){return this[7]},set:function set(value){return this[7]=(0,_common.checkNumber)(value)}},{key:"m32",get:function get(){return this[11]},set:function set(value){return this[11]=(0,_common.checkNumber)(value)}},{key:"m33",get:function get(){return this[15]},set:function set(value){return this[15]=(0,_common.checkNumber)(value)}}]);return Matrix4}(_mathArray2.default),_applyDecoratedDescriptor(_class.prototype,"equals",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"equals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"exactEquals",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"exactEquals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"toString",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"toString"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"determinant",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"determinant"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"lookAt",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"lookAt"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"ortho",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"ortho"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"perspective",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"perspective"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"perspectiveFromFieldOfView",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"perspectiveFromFieldOfView"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"transpose",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"transpose"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"invert",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"invert"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"adjoint",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"adjoint"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"add",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"add"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"multiplyLeft",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"multiplyLeft"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"multiplyRight",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"multiplyRight"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"scale",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"scale"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"translate",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"translate"),_class.prototype),_class);exports.default=Matrix4},{"./common":515,"./math-array":518,"./utils/decorators":521,"./utils/validators":522,"./vector2":523,"./vector3":524,"./vector4":525,"gl-matrix":438}],520:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class;var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _glMatrix=require("gl-matrix");var _decorators=require("./utils/decorators");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}var Quaternion=(_class=function(_MathArray){_inherits(Quaternion,_MathArray);function Quaternion(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var w=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,Quaternion);var _this=_possibleConstructorReturn(this,(Quaternion.__proto__||Object.getPrototypeOf(Quaternion)).call(this));if(Array.isArray(x)&&arguments.length===1){_this.copy(x)}else{_this.set(x,y,z,w)}return _this}_createClass(Quaternion,[{key:"fromMatrix3",value:function fromMatrix3(m){_glMatrix.quat.fromMat3(this,m);this.check();return this}},{key:"fromValues",value:function fromValues(x,y,z,w){return this.set(x,y,z,w)}},{key:"identity",value:function identity(){_glMatrix.quat.identity(this);this.check();return this}},{key:"equals",value:function equals(quaternion){return _glMatrix.quat.equals(this,quaternion)}},{key:"exactEquals",value:function exactEquals(quaternion){return _glMatrix.quat.exactEquals(this,quaternion)}},{key:"length",value:function length(){return _glMatrix.quat.length(this)}},{key:"squaredLength",value:function squaredLength(a){return _glMatrix.quat.squaredLength(this)}},{key:"dot",value:function dot(a,b){if(b!==undefined){throw new Error("Quaternion.dot only takes one argument")}return _glMatrix.quat.dot(this,a)}},{key:"getAxisAngle",value:function getAxisAngle(){var axis=[];var angle=_glMatrix.quat.getAxisAngle(axis,this);return{axis:axis,angle:angle}}},{key:"rotationTo",value:function rotationTo(vectorA,vectorB){_glMatrix.quat.rotationTo(this,vectorA,vectorB);this.check();return this}},{key:"add",value:function add(a,b){if(b!==undefined){throw new Error("Quaternion.add only takes one argument")}_glMatrix.quat.add(this,a);this.check();return this}},{key:"calculateW",value:function calculateW(){_glMatrix.quat.calculateW(this,this);this.check();return this}},{key:"conjugate",value:function conjugate(){_glMatrix.quat.conjugate(this,this);this.check();return this}},{key:"invert",value:function invert(){_glMatrix.quat.invert(this,this);this.check();return this}},{key:"lerp",value:function lerp(a,b,t){_glMatrix.quat.lerp(this,a,b,t);this.check();return this}},{key:"multiply",value:function multiply(a,b){if(b!==undefined){throw new Error("Quaternion.multiply only takes one argument")}_glMatrix.quat.multiply(this,this,b);this.check();return this}},{key:"normalize",value:function normalize(){_glMatrix.quat.normalize(this,this);this.check();return this}},{key:"rotateX",value:function rotateX(rad){_glMatrix.quat.rotateX(this,this,rad);this.check();return this}},{key:"rotateY",value:function rotateY(rad){_glMatrix.quat.rotateY(this,this,rad);this.check();return this}},{key:"rotateZ",value:function rotateZ(rad){_glMatrix.quat.rotateZ(this,this,rad);this.check();return this}},{key:"scale",value:function scale(b){_glMatrix.quat.scale(this,this,b);this.check();return this}},{key:"set",value:function set(i,j,k,l){_glMatrix.quat.set(this,i,j,k,l);this.check();return this}},{key:"setAxisAngle",value:function setAxisAngle(axis,rad){_glMatrix.quat.setAxisAngle(this,axis,rad);this.check();return this}},{key:"slerp",value:function slerp(a,b,t){_glMatrix.quat.slerp(this,a,b,t);this.check();return this}},{key:"ELEMENTS",get:function get(){return 4}},{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"z",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"w",get:function get(){return this[3]},set:function set(value){return this[3]=(0,_common.checkNumber)(value)}}]);return Quaternion}(_mathArray2.default),_applyDecoratedDescriptor(_class.prototype,"equals",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"equals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"exactEquals",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"exactEquals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"add",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"add"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"multiply",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"multiply"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"normalize",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"normalize"),_class.prototype),_class);exports.default=Quaternion},{"./common":515,"./math-array":518,"./utils/decorators":521,"gl-matrix":438}],521:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.unary=unary;exports.staticMethod=staticMethod;exports.binary=binary;exports.spread=spread;function _toArray(arr){return Array.isArray(arr)?arr:Array.from(arr)}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function isDescriptor(descriptor){if(!descriptor||!descriptor.hasOwnProperty){return false}var keys=["value","initializer","get","set"];for(var i=0,l=keys.length;i<l;i++){if(descriptor.hasOwnProperty(keys[i])){return true}}return false}function decorate(entryArgs,handleDescriptor){if(isDescriptor(entryArgs[entryArgs.length-1])){return handleDescriptor.apply(undefined,_toConsumableArray(entryArgs).concat([[]]))}return function _decorate(){return handleDescriptor.apply(undefined,Array.prototype.slice.call(arguments).concat([entryArgs]))}}function unary(){for(var _len=arguments.length,decoratorArgs=Array(_len),_key=0;_key<_len;_key++){decoratorArgs[_key]=arguments[_key]}return decorate(decoratorArgs,function(target,methodKey,descriptor,_ref){var _ref2=_toArray(_ref);var Class=target.constructor;Class[methodKey]=function(){var _ref3;return(_ref3=new Class)[methodKey].apply(_ref3,arguments)};return _extends({},descriptor,{value:function unaryWrapper(){return descriptor.value.apply(this,arguments)}})})}function staticMethod(){for(var _len2=arguments.length,decoratorArgs=Array(_len2),_key2=0;_key2<_len2;_key2++){decoratorArgs[_key2]=arguments[_key2]}return decorate(decoratorArgs,function(target,methodKey,descriptor,_ref4){var _ref5=_toArray(_ref4);var Class=target.constructor;Class[methodKey]=function(){var _ref6;return(_ref6=new Class)[methodKey].apply(_ref6,arguments)};return _extends({},descriptor,{value:function staticMethodWrapper(){return descriptor.value.apply(this,arguments)}})})}function binary(){for(var _len3=arguments.length,args=Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3]}return decorate(args,function(target,methodKey,descriptor,_ref7){var _ref8=_toArray(_ref7);var Class=target.constructor;Class[methodKey]=function(a,b){return(new Class).copy(a)[methodKey](b)};return _extends({},descriptor,{value:function binaryWrapper(){return descriptor.value.apply(this,arguments)}})})}function spread(){for(var _len4=arguments.length,args=Array(_len4),_key4=0;_key4<_len4;_key4++){args[_key4]=arguments[_key4]}return decorate(args,function(target,methodKey,descriptor,_ref9){var _ref10=_toArray(_ref9);var Class=target.constructor;Class[methodKey]=function(a){for(var _len5=arguments.length,rest=Array(_len5>1?_len5-1:0),_key5=1;_key5<_len5;_key5++){rest[_key5-1]=arguments[_key5]}return rest.reduce(function(acc,elt){return acc[methodKey](elt)},(new Class).copy(a))};return _extends({},descriptor,{value:function spreadWrapper(){return descriptor.value.apply(this,arguments)}})})}},{}],522:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.checkArguments=checkArguments;exports.validateVector2=validateVector2;exports.checkVector2=checkVector2;exports.validateVector3=validateVector3;exports.checkVector3=checkVector3;exports.validateVector4=validateVector4;exports.checkVector4=checkVector4;exports.validateQuaternion=validateQuaternion;exports.checkQuaternion=checkQuaternion;exports.validateMatrix2=validateMatrix2;exports.checkMatrix2=checkMatrix2;exports.validateMatrix2d=validateMatrix2d;exports.checkMatrix2d=checkMatrix2d;exports.validateMatrix3=validateMatrix3;exports.checkMatrix3=checkMatrix3;exports.validateMatrix4=validateMatrix4;exports.checkMatrix4=checkMatrix4;var _glMatrix=require("gl-matrix");function checkArguments(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}for(var i=0;i<args.length;++i){if(args[i]===undefined){throw new Error("Invalid math argument")}}}function validateVector2(v){return v.length===2&&Number.isFinite(v[0])&&Number.isFinite(v[1])}function checkVector2(v){if(_glMatrix.glMatrix.debug&&!validateVector2(v)){throw new Error("Invalid Vector2")}}function validateVector3(v){return v.length===3&&Number.isFinite(v[0])&&Number.isFinite(v[1])&&Number.isFinite(v[2])}function checkVector3(v){if(_glMatrix.glMatrix.debug&&!validateVector3(v)){throw new Error("Invalid Vector3")}}function validateVector4(v){return v.length===4&&Number.isFinite(v[0])&&Number.isFinite(v[1])&&Number.isFinite(v[2])&&Number.isFinite(v[3])}function checkVector4(v){if(_glMatrix.glMatrix.debug&&!validateVector4(v)){throw new Error("Invalid Vector4")}}function validateQuaternion(q){return q.length===4&&Number.isFinite(q[0])&&Number.isFinite(q[1])&&Number.isFinite(q[2])&&Number.isFinite(q[3])}function checkQuaternion(q){if(_glMatrix.glMatrix.debug&&!validateQuaternion(q)){throw new Error("Invalid Quaternion")}}function validateMatrix2(m){return m.length===4&&Number.isFinite(m[0])&&Number.isFinite(m[1])&&Number.isFinite(m[2])&&Number.isFinite(m[3])}function checkMatrix2(m){if(_glMatrix.glMatrix.debug&&!validateMatrix2(m)){throw new Error("Invalid Matrix2")}}function validateMatrix2d(m){return m.length===6&&Number.isFinite(m[0])&&Number.isFinite(m[1])&&Number.isFinite(m[2])&&Number.isFinite(m[3])&&Number.isFinite(m[4])&&Number.isFinite(m[5])}function checkMatrix2d(m){if(_glMatrix.glMatrix.debug&&!validateMatrix2d(m)){throw new Error("Invalid Matrix2d")}}function validateMatrix3(m){return m.length===9&&Number.isFinite(m[0])&&Number.isFinite(m[1])&&Number.isFinite(m[2])&&Number.isFinite(m[3])&&Number.isFinite(m[4])&&Number.isFinite(m[5])&&Number.isFinite(m[6])&&Number.isFinite(m[7])&&Number.isFinite(m[8])}function checkMatrix3(m){if(_glMatrix.glMatrix.debug&&!validateMatrix3(m)){throw new Error("Invalid Matrix3")}}function validateMatrix4(m){return m.length===16&&Number.isFinite(m[0])&&Number.isFinite(m[1])&&Number.isFinite(m[2])&&Number.isFinite(m[3])&&Number.isFinite(m[4])&&Number.isFinite(m[5])&&Number.isFinite(m[6])&&Number.isFinite(m[7])&&Number.isFinite(m[8])&&Number.isFinite(m[9])&&Number.isFinite(m[10])&&Number.isFinite(m[11])&&Number.isFinite(m[12])&&Number.isFinite(m[13])&&Number.isFinite(m[14])&&Number.isFinite(m[15])}function checkMatrix4(m){if(_glMatrix.glMatrix.debug&&!validateMatrix4(m)){throw new Error("Invalid Matrix4")}}},{"gl-matrix":438}],523:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class;var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _glMatrix=require("gl-matrix");var _decorators=require("./utils/decorators");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}var Vector2=(_class=function(_MathArray){_inherits(Vector2,_MathArray);function Vector2(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,Vector2);var _this=_possibleConstructorReturn(this,(Vector2.__proto__||Object.getPrototypeOf(Vector2)).call(this));if(Array.isArray(x)&&arguments.length===1){_this.copy(x)}else{_this.set(x,y)}return _this}_createClass(Vector2,[{key:"set",value:function set(x,y){_glMatrix.vec2.set(this,x,y);this.check();return this}},{key:"equals",value:function equals(vector){return _glMatrix.vec2.equals(this,vector)}},{key:"exactEquals",value:function exactEquals(vector){return _glMatrix.vec2.exactEquals(this,vector)}},{key:"add",value:function add(){for(var _len=arguments.length,vectors=Array(_len),_key=0;_key<_len;_key++){vectors[_key]=arguments[_key]}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=vectors[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var vector=_step.value;_glMatrix.vec2.add(this,vector)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return this}},{key:"ELEMENTS",get:function get(){return 2}},{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}}]);return Vector2}(_mathArray2.default),_applyDecoratedDescriptor(_class.prototype,"equals",[_decorators.staticMethod],Object.getOwnPropertyDescriptor(_class.prototype,"equals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"exactEquals",[_decorators.staticMethod],Object.getOwnPropertyDescriptor(_class.prototype,"exactEquals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"add",[_decorators.staticMethod],Object.getOwnPropertyDescriptor(_class.prototype,"add"),_class.prototype),_class);exports.default=Vector2},{"./common":515,"./math-array":518,"./utils/decorators":521,"gl-matrix":438}],524:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class;var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _glMatrix=require("gl-matrix");var _decorators=require("./utils/decorators");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}var Vector3=(_class=function(_MathArray){_inherits(Vector3,_MathArray);function Vector3(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,Vector3);var _this=_possibleConstructorReturn(this,(Vector3.__proto__||Object.getPrototypeOf(Vector3)).call(this));if(Array.isArray(x)&&arguments.length===1){_this.copy(x)}else{_this.set(x,y,z)}return _this}_createClass(Vector3,[{key:"set",value:function set(x,y,z){_glMatrix.vec3.set(this,x,y,z);this.check();return this}},{key:"equals",value:function equals(vector){return _glMatrix.vec3.equals(this,vector)}},{key:"exactEquals",value:function exactEquals(vector){return _glMatrix.vec3.exactEquals(this,vector)}},{key:"distance",value:function distance(vector){return _glMatrix.vec3.distance(vector)}},{key:"dist",value:function dist(vector){return _glMatrix.vec3.dist(vector)}},{key:"angle",value:function angle(vector){return _glMatrix.vec3.angle(vector)}},{key:"add",value:function add(){for(var _len=arguments.length,vectors=Array(_len),_key=0;_key<_len;_key++){vectors[_key]=arguments[_key]}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=vectors[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var vector=_step.value;_glMatrix.vec3.add(this,vector)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.check();return this}},{key:"subtract",value:function subtract(){for(var _len2=arguments.length,vectors=Array(_len2),_key2=0;_key2<_len2;_key2++){vectors[_key2]=arguments[_key2]}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=vectors[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var vector=_step2.value;_glMatrix.vec3.subtract(this,vector)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}this.check();return this}},{key:"multiply",value:function multiply(){for(var _len3=arguments.length,vectors=Array(_len3),_key3=0;_key3<_len3;_key3++){vectors[_key3]=arguments[_key3]}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=vectors[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var vector=_step3.value;_glMatrix.vec3.multiply(this,vector)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}this.check();return this}},{key:"divide",value:function divide(){for(var _len4=arguments.length,vectors=Array(_len4),_key4=0;_key4<_len4;_key4++){vectors[_key4]=arguments[_key4]}var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=vectors[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var vector=_step4.value;_glMatrix.vec3.divide(this,vector)}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}this.check();return this}},{key:"ceil",value:function ceil(){_glMatrix.vec3.ceil(this,this);this.check();return this}},{key:"floor",value:function floor(){_glMatrix.vec3.floor(this,this);this.check();return this}},{key:"min",value:function min(){_glMatrix.vec3.min(this,this);this.check();return this}},{key:"max",value:function max(){_glMatrix.vec3.max(this,this);this.check();return this}},{key:"scale",value:function scale(_scale){_glMatrix.vec3.scale(this,this,_scale);this.check();return this}},{key:"scaleAndAdd",value:function scaleAndAdd(vector,scale){_glMatrix.vec3.scaleAndAdd(this,this,vector,scale);this.check();return this}},{key:"negate",value:function negate(){_glMatrix.vec3.negate(this,this);this.check();return this}},{key:"inverse",value:function inverse(){_glMatrix.vec3.inverse(this,this);this.check();return this}},{key:"normalize",value:function normalize(){_glMatrix.vec3.normalize(this,this);this.check();return this}},{key:"dot",value:function dot(vector){_glMatrix.vec3.dot(this,this,vector);this.check();return this}},{key:"cross",value:function cross(vector){_glMatrix.vec3.cross(this,this,vector);this.check();return this}},{key:"lerp",value:function lerp(scale){_glMatrix.vec3.lerp(this,this,scale);this.check();return this}},{key:"hermite",value:function hermite(scale){_glMatrix.vec3.hermite(this,this,scale);this.check();return this}},{key:"bezier",value:function bezier(scale){_glMatrix.vec3.bezier(this,this,scale);this.check();return this}},{key:"random",value:function random(scale){_glMatrix.vec3.cross(this,this,scale);this.check();return this}},{key:"rotateX",value:function rotateX(origin,angle){_glMatrix.vec3.rotateX(this,this,origin,angle);this.check();return this}},{key:"rotateY",value:function rotateY(origin,angle){_glMatrix.vec3.rotateY(this,this,origin,angle);this.check();return this}},{key:"rotateZ",value:function rotateZ(origin,angle){_glMatrix.vec3.rotateZ(this,this,origin,angle);this.check();return this}},{key:"ELEMENTS",get:function get(){return 3}},{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"z",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}}]);return Vector3}(_mathArray2.default),
_applyDecoratedDescriptor(_class.prototype,"equals",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"equals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"exactEquals",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"exactEquals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"distance",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"distance"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"dist",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"dist"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"angle",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"angle"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"add",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"add"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"subtract",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"subtract"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"multiply",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"multiply"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"divide",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"divide"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"ceil",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"ceil"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"floor",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"floor"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"min",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"min"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"max",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"max"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"scale",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"scale"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"negate",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"negate"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"inverse",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"inverse"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"normalize",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"normalize"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"dot",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"dot"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"cross",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"cross"),_class.prototype),_class);exports.default=Vector3},{"./common":515,"./math-array":518,"./utils/decorators":521,"gl-matrix":438}],525:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class;var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _glMatrix=require("gl-matrix");var _decorators=require("./utils/decorators");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}var Vector4=(_class=function(_MathArray){_inherits(Vector4,_MathArray);function Vector4(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var w=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,Vector4);var _this=_possibleConstructorReturn(this,(Vector4.__proto__||Object.getPrototypeOf(Vector4)).call(this));if(Array.isArray(x)&&arguments.length===1){_this.copy(x)}else{_this.set(x,y,z,w)}return _this}_createClass(Vector4,[{key:"set",value:function set(x,y,z,w){_glMatrix.vec4.set(this,x,y,z,w);this.check();return this}},{key:"equals",value:function equals(vector){return _glMatrix.vec4.equals(this,vector)}},{key:"exactEquals",value:function exactEquals(vector){return _glMatrix.vec4.exactEquals(this,vector)}},{key:"distance",value:function distance(vector){return _glMatrix.vec4.distance(vector)}},{key:"dist",value:function dist(vector){return _glMatrix.vec4.dist(vector)}},{key:"angle",value:function angle(vector){return _glMatrix.vec4.angle(vector)}},{key:"add",value:function add(){for(var _len=arguments.length,vectors=Array(_len),_key=0;_key<_len;_key++){vectors[_key]=arguments[_key]}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=vectors[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var vector=_step.value;_glMatrix.vec4.add(this,vector)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.check();return this}},{key:"subtract",value:function subtract(){for(var _len2=arguments.length,vectors=Array(_len2),_key2=0;_key2<_len2;_key2++){vectors[_key2]=arguments[_key2]}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=vectors[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var vector=_step2.value;_glMatrix.vec4.subtract(this,vector)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}this.check();return this}},{key:"multiply",value:function multiply(){for(var _len3=arguments.length,vectors=Array(_len3),_key3=0;_key3<_len3;_key3++){vectors[_key3]=arguments[_key3]}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=vectors[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var vector=_step3.value;_glMatrix.vec4.multiply(this,vector)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}this.check();return this}},{key:"divide",value:function divide(){for(var _len4=arguments.length,vectors=Array(_len4),_key4=0;_key4<_len4;_key4++){vectors[_key4]=arguments[_key4]}var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=vectors[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var vector=_step4.value;_glMatrix.vec4.divide(this,vector)}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}this.check();return this}},{key:"ceil",value:function ceil(){_glMatrix.vec4.ceil(this,this);this.check();return this}},{key:"floor",value:function floor(){_glMatrix.vec4.floor(this,this);this.check();return this}},{key:"min",value:function min(){_glMatrix.vec4.min(this,this);this.check();return this}},{key:"max",value:function max(){_glMatrix.vec4.max(this,this);this.check();return this}},{key:"scale",value:function scale(_scale){_glMatrix.vec4.scale(this,this,_scale);this.check();return this}},{key:"scaleAndAdd",value:function scaleAndAdd(vector,scale){_glMatrix.vec4.scaleAndAdd(this,this,vector,scale);this.check();return this}},{key:"negate",value:function negate(){_glMatrix.vec4.negate(this,this);this.check();return this}},{key:"inverse",value:function inverse(){_glMatrix.vec4.inverse(this,this);this.check();return this}},{key:"normalize",value:function normalize(){_glMatrix.vec4.normalize(this,this);this.check();return this}},{key:"dot",value:function dot(scale){_glMatrix.vec4.dot(this,this,scale);this.check();return this}},{key:"cross",value:function cross(scale){_glMatrix.vec4.cross(this,this,scale);this.check();return this}},{key:"lerp",value:function lerp(scale){_glMatrix.vec4.lerp(this,this,scale);this.check();return this}},{key:"hermite",value:function hermite(scale){_glMatrix.vec4.hermite(this,this,scale);this.check();return this}},{key:"bezier",value:function bezier(scale){_glMatrix.vec4.bezier(this,this,scale);this.check();return this}},{key:"random",value:function random(scale){_glMatrix.vec4.random(this,this,scale);this.check();return this}},{key:"rotateX",value:function rotateX(origin,angle){_glMatrix.vec4.rotateX(this,this,origin,angle);this.check();return this}},{key:"rotateY",value:function rotateY(origin,angle){_glMatrix.vec4.rotateY(this,this,origin,angle);this.check();return this}},{key:"rotateZ",value:function rotateZ(origin,angle){_glMatrix.vec4.rotateZ(this,this,origin,angle);this.check();return this}},{key:"ELEMENTS",get:function get(){return 4}},{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"z",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"w",get:function get(){return this[3]},set:function set(value){return this[3]=(0,_common.checkNumber)(value)}}]);return Vector4}(_mathArray2.default),_applyDecoratedDescriptor(_class.prototype,"equals",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"equals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"exactEquals",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"exactEquals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"distance",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"distance"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"dist",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"dist"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"angle",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"angle"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"add",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"add"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"subtract",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"subtract"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"multiply",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"multiply"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"divide",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"divide"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"negate",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"negate"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"inverse",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"inverse"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"normalize",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"normalize"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"dot",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"dot"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"cross",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"cross"),_class.prototype),_class);exports.default=Vector4},{"./common":515,"./math-array":518,"./utils/decorators":521,"gl-matrix":438}],526:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _core=require("../core");var _webgl=require("../webgl");function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CLIPSPACE_QUAD_VERTEX_SHADER="attribute vec2 aClipSpacePosition;\nattribute vec2 aTexCoord;\nattribute vec2 aCoordinate;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(aClipSpacePosition, 0., 1.);\n  position = aClipSpacePosition;\n  coordinate = aCoordinate;\n  uv = aTexCoord;\n}\n";var POSITIONS=[-1,-1,1,-1,-1,1,1,1];var TEX_COORDS=POSITIONS.map(function(coord){return coord===-1?0:coord});var ClipSpaceQuad=function(_Model){_inherits(ClipSpaceQuad,_Model);function ClipSpaceQuad(_ref){var gl=_ref.gl,opts=_objectWithoutProperties(_ref,["gl"]);_classCallCheck(this,ClipSpaceQuad);var _this=_possibleConstructorReturn(this,(ClipSpaceQuad.__proto__||Object.getPrototypeOf(ClipSpaceQuad)).call(this,_extends({gl:gl},opts,{vs:CLIPSPACE_QUAD_VERTEX_SHADER,geometry:new _core.Geometry({drawMode:_webgl.GL.TRIANGLE_STRIP,attributes:{aClipSpacePosition:{value:new Float32Array(POSITIONS),size:2},aTexCoord:{value:new Float32Array(TEX_COORDS),size:2},aCoordinate:{value:new Float32Array(TEX_COORDS),size:2}}})})));_this.setVertexCount(4);return _this}return ClipSpaceQuad}(_core.Model);exports.default=ClipSpaceQuad},{"../core":488,"../webgl":546}],527:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _clipSpaceQuad=require("./clip-space-quad");Object.defineProperty(exports,"ClipSpaceQuad",{enumerable:true,get:function get(){return _interopRequireDefault(_clipSpaceQuad).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./clip-space-quad":526}],528:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _object3d=require("./object-3d");var _object3d2=_interopRequireDefault(_object3d);var _deprecated=require("../deprecated");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Group=function(_Object3D){_inherits(Group,_Object3D);function Group(_ref){var _ref$children=_ref.children,children=_ref$children===undefined?[]:_ref$children,opts=_objectWithoutProperties(_ref,["children"]);_classCallCheck(this,Group);children.every(function(child){return(0,_assert2.default)(child instanceof _object3d2.default)});var _this=_possibleConstructorReturn(this,(Group.__proto__||Object.getPrototypeOf(Group)).call(this,opts));_this.children=children;return _this}_createClass(Group,[{key:"add",value:function add(){for(var _len=arguments.length,children=Array(_len),_key=0;_key<_len;_key++){children[_key]=arguments[_key]}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=children[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var child=_step.value;if(Array.isArray(child)){this.add.apply(this,_toConsumableArray(child))}else{this.children.push(child)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return this}},{key:"remove",value:function remove(child){var children=this.children;var indexOf=children.indexOf(child);if(indexOf>-1){children.splice(indexOf,1)}return this}},{key:"removeAll",value:function removeAll(){this.children=[];return this}},{key:"traverse",value:regeneratorRuntime.mark(function traverse(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref2$viewMatrix=_ref2.viewMatrix,viewMatrix=_ref2$viewMatrix===undefined?new _deprecated.Mat4:_ref2$viewMatrix;var _iteratorNormalCompletion2,_didIteratorError2,_iteratorError2,_iterator2,_step2,child,matrix,worldMatrix;return regeneratorRuntime.wrap(function traverse$(_context){while(1){switch(_context.prev=_context.next){case 0:_iteratorNormalCompletion2=true;_didIteratorError2=false;_iteratorError2=undefined;_context.prev=3;_iterator2=this.children[Symbol.iterator]();case 5:if(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done){_context.next=19;break}child=_step2.value;matrix=child.matrix;worldMatrix=viewMatrix.mulMat4(matrix);if(!(child instanceof Group)){_context.next=13;break}return _context.delegateYield(child.traverse({matrix:matrix,worldMatrix:worldMatrix}),"t0",11);case 11:_context.next=16;break;case 13:if(child.program){child.program.use();child.program.setUniforms({worldMatrix:worldMatrix})}_context.next=16;return child;case 16:_iteratorNormalCompletion2=true;_context.next=5;break;case 19:_context.next=25;break;case 21:_context.prev=21;_context.t1=_context["catch"](3);_didIteratorError2=true;_iteratorError2=_context.t1;case 25:_context.prev=25;_context.prev=26;if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}case 28:_context.prev=28;if(!_didIteratorError2){_context.next=31;break}throw _iteratorError2;case 31:return _context.finish(28);case 32:return _context.finish(25);case 33:case"end":return _context.stop()}}},traverse,this,[[3,21,25,33],[26,,28,32]])})},{key:"traverseReverse",value:regeneratorRuntime.mark(function traverseReverse(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref3$viewMatrix=_ref3.viewMatrix,viewMatrix=_ref3$viewMatrix===undefined?new _deprecated.Mat4:_ref3$viewMatrix;var i,child,matrix,worldMatrix;return regeneratorRuntime.wrap(function traverseReverse$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:i=this.children.length-1;case 1:if(!(i>=0)){_context2.next=15;break}child=this.children[i];matrix=child.matrix;worldMatrix=viewMatrix.mulMat4(matrix);if(!(child instanceof Group)){_context2.next=9;break}return _context2.delegateYield(child.traverseReverse({matrix:matrix,worldMatrix:worldMatrix}),"t0",7);case 7:_context2.next=12;break;case 9:if(child.program){child.program.use();child.program.setUniforms({worldMatrix:worldMatrix})}_context2.next=12;return child;case 12:--i;_context2.next=1;break;case 15:case"end":return _context2.stop()}}},traverseReverse,this)})}]);return Group}(_object3d2.default);exports.default=Group},{"../deprecated":492,"./object-3d":530,assert:2}],529:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _object3d=require("./object-3d");Object.defineProperty(exports,"Object3D",{enumerable:true,get:function get(){return _interopRequireDefault(_object3d).default}});var _group=require("./group");Object.defineProperty(exports,"Group",{enumerable:true,get:function get(){return _interopRequireDefault(_group).default}});var _scene=require("./scene");Object.defineProperty(exports,"Scene",{enumerable:true,get:function get(){return _interopRequireDefault(_scene).default}});var _pick=require("./pick");Object.keys(_pick).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _pick[key]}})});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./group":528,"./object-3d":530,"./pick":531,"./scene":532}],530:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _deprecated=require("../deprecated");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Object3D=function(){function Object3D(_ref){var id=_ref.id,_ref$display=_ref.display,display=_ref$display===undefined?true:_ref$display;_classCallCheck(this,Object3D);this.position=new _deprecated.Vec3;this.rotation=new _deprecated.Vec3;this.scale=new _deprecated.Vec3(1,1,1);this.matrix=new _deprecated.Mat4;this.id=id||(0,_utils.uid)(this.constructor.name);this.display=true;this.userData={}}_createClass(Object3D,[{key:"setPosition",value:function setPosition(position){(0,_assert2.default)(position.length===3,"setPosition requires vector argument");this.position=position;return this}},{key:"setRotation",value:function setRotation(rotation){(0,_assert2.default)(rotation.length===3,"setRotation requires vector argument");this.rotation=rotation;return this}},{key:"setScale",value:function setScale(scale){(0,_assert2.default)(scale.length===3,"setScale requires vector argument");this.scale=scale;return this}},{key:"setMatrixComponents",value:function setMatrixComponents(_ref2){var position=_ref2.position,rotation=_ref2.rotation,scale=_ref2.scale,_ref2$update=_ref2.update,update=_ref2$update===undefined?true:_ref2$update;if(position){this.setPosition(position)}if(rotation){this.setRotation(rotation)}if(scale){this.setScale(scale)}if(update){this.updateMatrix()}return this}},{key:"updateMatrix",value:function updateMatrix(){var pos=this.position;var rot=this.rotation;var scale=this.scale;this.matrix.id();this.matrix.$translate(pos[0],pos[1],pos[2]);this.matrix.$rotateXYZ(rot[0],rot[1],rot[2]);this.matrix.$scale(scale[0],scale[1],scale[2]);return this}},{key:"update",value:function update(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},position=_ref3.position,rotation=_ref3.rotation,scale=_ref3.scale;if(position){this.setPosition(position)}if(rotation){this.setRotation(rotation)}if(scale){this.setScale(scale)}this.updateMatrix();return this}},{key:"getCoordinateUniforms",value:function getCoordinateUniforms(viewMatrix,modelMatrix){(0,_assert2.default)(viewMatrix);modelMatrix=modelMatrix||this.matrix;var worldMatrix=(new _deprecated.Mat4).copy(viewMatrix).mulMat4(modelMatrix);var worldInverse=worldMatrix.invert();var worldInverseTranspose=worldInverse.transpose();return{viewMatrix:viewMatrix,modelMatrix:modelMatrix,objectMatrix:modelMatrix,worldMatrix:worldMatrix,worldInverseMatrix:worldInverse,worldInverseTransposeMatrix:worldInverseTranspose}}},{key:"transform",value:function transform(){if(!this.parent){this.endPosition.setVec3(this.position);this.endRotation.setVec3(this.rotation);this.endScale.setVec3(this.scale)}else{var parent=this.parent;this.endPosition.setVec3(this.position.add(parent.endPosition));this.endRotation.setVec3(this.rotation.add(parent.endRotation));this.endScale.setVec3(this.scale.add(parent.endScale))}var ch=this.children;for(var i=0;i<ch.length;++i){ch[i].transform()}return this}}]);return Object3D}();exports.default=Object3D},{"../deprecated":492,"../utils":536,assert:2}],531:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.pickModels=pickModels;var _webgl=require("../webgl");var _webglChecks=require("../webgl/webgl-checks");var _group=require("./group");var _group2=_interopRequireDefault(_group);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ILLEGAL_ARG="Illegal argument to pick";function pickModels(gl,_ref){var group=_ref.group,uniforms=_ref.uniforms,x=_ref.x,y=_ref.y,_ref$pickingFBO=_ref.pickingFBO,pickingFBO=_ref$pickingFBO===undefined?null:_ref$pickingFBO,_ref$pickingProgram=_ref.pickingProgram,pickingProgram=_ref$pickingProgram===undefined?null:_ref$pickingProgram,_ref$pickingColors=_ref.pickingColors,pickingColors=_ref$pickingColors===undefined?null:_ref$pickingColors;(0,_webglChecks.assertWebGLContext)(gl);(0,_assert2.default)(group instanceof _group2.default,ILLEGAL_ARG);var dpr=typeof window!=="undefined"?window.devicePixelRatio:1;var deviceX=x*dpr;var deviceY=gl.canvas.height-y*dpr;pickingFBO=pickingFBO||new _webgl.Framebuffer(gl,{width:gl.canvas.width,height:gl.canvas.height});return(0,_webgl.glContextWithState)(gl,{frameBuffer:pickingFBO,scissorTest:{x:deviceX,y:deviceY,w:1,h:1}},function(){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=group.traverseReverse()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var model=_step.value;if(model.isPickable()){gl.clear(_webgl.GL.COLOR_BUFFER_BIT|_webgl.GL.DEPTH_BUFFER_BIT);model.setUniforms({renderPickingBuffer:1,enablePicking:true});model.render(uniforms);model.setUniforms({renderPickingBuffer:false,enablePicking:false});var color=new Uint8Array(4);gl.readPixels(deviceX,deviceY,1,1,gl.RGBA,gl.UNSIGNED_BYTE,color);var isPicked=color[0]!==0||color[1]!==0||color[2]!==0||color[3]!==0;if(isPicked){return{model:model,color:color,x:x,y:y,deviceX:deviceX,deviceY:deviceY}}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return null})}},{"../webgl":546,"../webgl/webgl-checks":557,"./group":528,assert:2}],532:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _config=require("../core/config");var config=_interopRequireWildcard(_config);var _math=require("../math");var _utils=require("../utils");var _group=require("./group");var _group2=_interopRequireDefault(_group);var _pick=require("./pick");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj;
}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var INVALID_ARGUMENT="LumaGL.Scene invalid argument";var DEFAULT_SCENE_OPTS={lights:{enable:false,ambient:{r:.2,g:.2,b:.2},directional:{direction:{x:1,y:1,z:1},color:{r:0,g:0,b:0}}},effects:{fog:false},clearColor:true,clearDepth:true,backgroundColor:{r:0,g:0,b:0,a:1},backgroundDepth:1};var Scene=function(_Group){_inherits(Scene,_Group);function Scene(gl,opts){_classCallCheck(this,Scene);(0,_assert2.default)(gl,INVALID_ARGUMENT);opts=(0,_utils.merge)(DEFAULT_SCENE_OPTS,opts);var _this=_possibleConstructorReturn(this,(Scene.__proto__||Object.getPrototypeOf(Scene)).call(this,opts));_this.gl=gl;_this.config=opts;_this.needsRedraw=false;Object.seal(_this);return _this}_createClass(Scene,[{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.needsRedraw=redraw;return this}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$clearRedrawFlags=_ref.clearRedrawFlags,clearRedrawFlags=_ref$clearRedrawFlags===undefined?false:_ref$clearRedrawFlags;var redraw=false;redraw=redraw||this.needsRedraw;this.needsRedraw=this.needsRedraw&&!clearRedrawFlags;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.traverse()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var model=_step.value;redraw=redraw||model.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags})}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return redraw}},{key:"clear",value:function clear(){var gl=this.gl;if(this.config.clearColor){var bg=this.config.backgroundColor;gl.clearColor(bg.r,bg.g,bg.b,bg.a)}if(this.config.clearDepth){gl.clearDepth(this.config.backgroundDepth)}if(this.config.clearColor&&this.config.clearDepth){gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)}else if(this.config.clearColor){gl.clear(gl.COLOR_BUFFER_BIT)}else if(this.config.clearDepth){gl.clear(gl.DEPTH_BUFFER_BIT)}return this}},{key:"render",value:function render(){var uniforms=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.clear();var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.traverse()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var model=_step2.value;if(model.display){this.renderObject({model:model,uniforms:uniforms})}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return this}},{key:"renderObject",value:function renderObject(_ref2){var model=_ref2.model,uniforms=_ref2.uniforms;model.render(_extends({},this.getSceneUniforms(),uniforms));return this}},{key:"pickModels",value:function pickModels(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},x=_ref3.x,y=_ref3.y,_ref3$uniforms=_ref3.uniforms,uniforms=_ref3$uniforms===undefined?{}:_ref3$uniforms,opts=_objectWithoutProperties(_ref3,["x","y","uniforms"]);return(0,_pick.pickModels)(this.gl,_extends({group:this,x:x,y:y,uniforms:_extends({},uniforms)},opts))}},{key:"getSceneUniforms",value:function getSceneUniforms(){var _config$lights=this.config.lights,enable=_config$lights.enable,ambient=_config$lights.ambient,directional=_config$lights.directional,points=_config$lights.points;return _extends({},this.getEffectsUniforms(),{enableLights:enable},enable&&ambient?this.getAmbientUniforms(ambient):{},enable&&directional?this.getDirectionalUniforms(directional):{},enable&&points?this.getPointUniforms(points):{})}},{key:"getAmbientUniforms",value:function getAmbientUniforms(ambient){return{ambientColor:[ambient.r,ambient.g,ambient.b]}}},{key:"getDirectionalUniforms",value:function getDirectionalUniforms(directional){var color=directional.color,direction=directional.direction;var dir=new _math.Vector3(direction.x,direction.y,direction.z).normalize().scale(-1,-1,-1);return{directionalColor:[color.r,color.g,color.b],lightingDirection:[dir.x,dir.y,dir.z]}}},{key:"getPointUniforms",value:function getPointUniforms(points){points=points instanceof Array?points:[points];var numberPoints=points.length;var uniforms={numberPoints:numberPoints};var pointLocations=[];var pointColors=[];var enableSpecular=[];var pointSpecularColors=[];var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=points[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var point=_step3.value;var position=point.position,color=point.color,diffuse=point.diffuse,specular=point.specular;var pointColor=color||diffuse;pointLocations.push(position.x,position.y,position.z);pointColors.push(pointColor.r,pointColor.g,pointColor.b);enableSpecular.push(Number(Boolean(specular)));if(specular){pointSpecularColors.push(specular.r,specular.g,specular.b)}else{pointSpecularColors.push(0,0,0)}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}if(pointLocations.length){Object.assign(uniforms,{pointLocation:pointLocations,pointColor:pointColors,enableSpecular:enableSpecular,pointSpecularColor:pointSpecularColors})}return uniforms}},{key:"getEffectsUniforms",value:function getEffectsUniforms(){var fog=this.config.effects.fog;if(fog){var _fog$color=fog.color,color=_fog$color===undefined?{r:.5,g:.5,b:.5}:_fog$color;return{hasFog:true,fogNear:fog.near,fogFar:fog.far,fogColor:[color.r,color.g,color.b]}}return{hasFog:false}}}]);return Scene}(_group2.default);exports.default=Scene;Scene.MAX_TEXTURES=config.MAX_TEXTURES;Scene.MAX_POINT_LIGHTS=config.MAX_POINT_LIGHTS;Scene.PICKING_RES=config.PICKING_RES},{"../core/config":485,"../math":517,"../utils":536,"./group":528,"./pick":531,assert:2}],533:[function(require,module,exports){"use strict";module.exports={hasTexture1:false,hasTextureCube1:false,enableLights:false,useReflection:false,enablePicking:false,hasPickingColors:false,hasFog:false}},{}],534:[function(require,module,exports){"use strict";var _path=require("path");var vs="#define SHADER_NAME luma-default-vertex\n\n#define LIGHT_MAX 4\n\n// object attributes\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec4 colors;\nattribute vec4 pickingColors;\nattribute vec2 texCoords;\n\n// camera and object matrices\nuniform mat4 viewMatrix;\nuniform mat4 viewInverseMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewProjectionMatrix;\n\n// objectMatrix * viewMatrix = worldMatrix\nuniform mat4 worldMatrix;\nuniform mat4 worldInverseMatrix;\nuniform mat4 worldInverseTransposeMatrix;\nuniform mat4 objectMatrix;\nuniform vec3 cameraPosition;\n\n// lighting configuration\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\n\n// point lights configuration\nuniform vec3 pointLocation[LIGHT_MAX];\nuniform vec3 pointColor[LIGHT_MAX];\nuniform int numberPoints;\n\n// reflection / refraction configuration\nuniform bool useReflection;\n\n// varyings\nvarying vec3 vReflection;\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec4 vNormal;\nvarying vec3 lightWeighting;\n\nvoid main(void) {\n  vec4 mvPosition = worldMatrix * vec4(positions, 1.0);\n  vec4 transformedNormal = worldInverseTransposeMatrix * vec4(normals, 1.0);\n\n  // lighting code\n  if(!enableLights) {\n    lightWeighting = vec3(1.0, 1.0, 1.0);\n  } else {\n    vec3 plightDirection;\n    vec3 pointWeight = vec3(0.0, 0.0, 0.0);\n    float directionalLightWeighting =\n      max(dot(transformedNormal.xyz, lightingDirection), 0.0);\n    for (int i = 0; i < LIGHT_MAX; i++) {\n      if (i < numberPoints) {\n        plightDirection = normalize(\n          (viewMatrix * vec4(pointLocation[i], 1.0)).xyz - mvPosition.xyz);\n         pointWeight += max(\n          dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor[i];\n       } else {\n         break;\n       }\n     }\n\n    lightWeighting = ambientColor +\n      (directionalColor * directionalLightWeighting) + pointWeight;\n  }\n\n  // refraction / reflection code\n  if (useReflection) {\n    vReflection =\n      (viewInverseMatrix[3] - (worldMatrix * vec4(positions, 1.0))).xyz;\n  } else {\n    vReflection = vec3(1.0, 1.0, 1.0);\n  }\n\n  // pass results to varyings\n  vColor = colors;\n  vPickingColor = pickingColors;\n  vTexCoord = texCoords;\n  vNormal = transformedNormal;\n  gl_Position = projectionMatrix * worldMatrix * vec4(positions, 1.0);\n}\n";var fs="#define SHADER_NAME luma-default-fragment\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\n// varyings\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nvarying vec3 vReflection;\nvarying vec4 vNormal;\n\n// texture configs\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\nuniform bool hasTextureCube1;\nuniform samplerCube samplerCube1;\n\n// picking configs\nuniform bool enablePicking;\nuniform bool hasPickingColors;\nuniform vec3 pickColor;\n\n// reflection / refraction configs\nuniform float reflection;\nuniform float refraction;\n\n// fog configuration\nuniform bool hasFog;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\n\nvoid main(){\n  // set color from texture\n  if (!hasTexture1) {\n    gl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n  } else {\n    gl_FragColor =\n      vec4(texture2D(sampler1, vec2(vTexCoord.s, vTexCoord.t)).rgb *\n      lightWeighting, 1.0);\n  }\n\n  // has cube texture then apply reflection\n  // if (hasTextureCube1) {\n  //   vec3 nReflection = normalize(vReflection);\n  //   vec3 reflectionValue;\n  //   if (refraction > 0.0) {\n  //    reflectionValue = refract(nReflection, vNormal.xyz, refraction);\n  //   } else {\n  //    reflectionValue = -reflect(nReflection, vNormal.xyz);\n  //   }\n\n  //   // TODO(nico): check whether this is right.\n  //   vec4 cubeColor = textureCube(samplerCube1,\n  //       vec3(-reflectionValue.x, -reflectionValue.y, reflectionValue.z));\n  //   gl_FragColor = vec4(mix(gl_FragColor.xyz, cubeColor.xyz, reflection), 1.0);\n  // }\n\n  // set picking\n  if (enablePicking) {\n    if (hasPickingColors) {\n      gl_FragColor = vPickingColor;\n    } else {\n      gl_FragColor = vec4(pickColor, 1.0);\n    }\n  }\n\n  // handle fog\n  // if (hasFog) {\n  //   float depth = gl_FragCoord.z / gl_FragCoord.w;\n  //   float fogFactor = smoothstep(fogNear, fogFar, depth);\n  //   gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n  // }\n}\n";var defaultUniforms=require("./default-uniforms");module.exports={DEFAULT:{vs:vs,fs:fs,defaultUniforms:defaultUniforms}}},{"./default-uniforms":533,path:745}],535:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.pageLoadPromise=exports.isPageLoaded=undefined;var _isBrowser=require("./is-browser");var _isBrowser2=_interopRequireDefault(_isBrowser);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var isPageLoaded=exports.isPageLoaded=false;var pageLoadPromise=exports.pageLoadPromise=_isBrowser2.default?new Promise(function(resolve,reject){window.onload=function(){exports.isPageLoaded=isPageLoaded=true;resolve(document)}}):Promise.resolve({})},{"./is-browser":537}],536:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _isBrowser=require("./is-browser");Object.keys(_isBrowser).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _isBrowser[key]}})});var _browserUtils=require("./browser-utils");Object.keys(_browserUtils).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _browserUtils[key]}})});var _promiseUtils=require("./promise-utils");Object.keys(_promiseUtils).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _promiseUtils[key]}})});var _utils=require("./utils");Object.keys(_utils).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _utils[key]}})});var _log=require("./log");Object.keys(_log).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _log[key]}})});Object.defineProperty(exports,"log",{enumerable:true,get:function get(){return _interopRequireDefault(_log).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./browser-utils":535,"./is-browser":537,"./log":538,"./promise-utils":539,"./utils":540}],537:[function(require,module,exports){(function(process){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var isNode=exports.isNode=(typeof process==="undefined"?"undefined":_typeof(process))==="object"&&String(process)==="[object process]"&&!process.browser;var isBrowser=exports.isBrowser=!isNode;exports.default=isBrowser}).call(this,require("_process"))},{_process:11}],538:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.formatValue=formatValue;var _globals=require("../globals");var _globals2=_interopRequireDefault(_globals);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _log={priority:0,table:function table(priority,_table){if(priority<=_log.priority&&_table){console.table(_table)}},log:function log(priority){if(priority<=_log.priority){var _console;for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}(_console=console).debug.apply(_console,args)}},info:function info(priority){if(priority<=_log.priority){var _console2;for(var _len2=arguments.length,args=Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){args[_key2-1]=arguments[_key2]}(_console2=console).log.apply(_console2,args)}},warn:function warn(priority){if(priority<=_log.priority){var _console3;for(var _len3=arguments.length,args=Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++){args[_key3-1]=arguments[_key3]}(_console3=console).warn.apply(_console3,args)}}};function formatArrayValue(v,opts){var _opts$maxElts=opts.maxElts,maxElts=_opts$maxElts===undefined?16:_opts$maxElts,_opts$size=opts.size,size=_opts$size===undefined?1:_opts$size;var string="[";for(var i=0;i<v.length&&i<maxElts;++i){if(i>0){string+=","+(i%size===0?" ":"")}string+=formatValue(v[i],opts)}var terminator=v.length>maxElts?"...":"]";return""+string+terminator}function formatValue(v){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _opts$isInteger=opts.isInteger,isInteger=_opts$isInteger===undefined?false:_opts$isInteger;if(Array.isArray(v)||ArrayBuffer.isView(v)){return formatArrayValue(v,opts)}if(!Number.isFinite(v)){return String(v)}if(isInteger){return v.toFixed(0)}if(Math.abs(v)>100&&Math.abs(v)<1e4){return v.toFixed(0)}var string=v.toPrecision(2);var decimal=string.indexOf(".0");return decimal===string.length-2?string.slice(0,-1):string}_globals2.default.log=_log;exports.default=_log},{"../globals":504}],539:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.promisify=promisify;function promisify(func){return function promisifiedFunction(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return new Promise(function(resolve,reject){function callback(error,data){try{if(error){reject(error)}else{resolve(data)}}catch(e){reject(e)}}func.apply(undefined,args.concat([callback]))})}}},{}],540:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.splat=splat;exports.noop=noop;exports.uid=uid;exports.merge=merge;function splat(a){return a?Array.isArray(a)?a:[a]:[]}function noop(){}var uidCounters={};function uid(){var id=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"id";uidCounters[id]=uidCounters[id]||1;var count=uidCounters[id]++;return id+"-"+count}function merge(objects){var mix={};for(var i=0,l=arguments.length;i<l;i++){var object=arguments[i];if(!object||object.constructor.name!=="Object"){continue}for(var key in object){var op=object[key];var mp=mix[key];if(mp&&op.constructor.name==="Object"&&mp.constructor.name==="Object"){mix[key]=merge(mp,op)}else{mix[key]=detach(op)}}}return mix}function detach(elem){var t=elem.constructor.name;var ans=void 0;if(t==="Object"){ans={};for(var p in elem){ans[p]=detach(elem[p])}}else if(t==="Array"){ans=[];for(var i=0,l=elem.length;i<l;i++){ans[i]=detach(elem[i])}}else{ans=elem}return ans}},{}],541:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.BufferLayout=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var BufferLayout=exports.BufferLayout=function BufferLayout(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},type=_ref.type,_ref$size=_ref.size,size=_ref$size===undefined?1:_ref$size,_ref$offset=_ref.offset,offset=_ref$offset===undefined?0:_ref$offset,_ref$stride=_ref.stride,stride=_ref$stride===undefined?0:_ref$stride,_ref$normalized=_ref.normalized,normalized=_ref$normalized===undefined?false:_ref$normalized,_ref$integer=_ref.integer,integer=_ref$integer===undefined?false:_ref$integer,_ref$instanced=_ref.instanced,instanced=_ref$instanced===undefined?0:_ref$instanced;_classCallCheck(this,BufferLayout);this.type=type;this.size=size;this.offset=offset;this.stride=stride;this.normalized=normalized;this.integer=integer;this.instanced=instanced};var Buffer=function(){_createClass(Buffer,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof Buffer?object:new Buffer(gl).setData({handle:object.handle||object})}}]);function Buffer(){var gl=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},id=_ref2.id,handle=_ref2.handle;_classCallCheck(this,Buffer);(0,_webglChecks.assertWebGLContext)(gl);handle=handle||gl.createBuffer();if(!(handle instanceof _webgl.WebGLBuffer)){throw new Error("Failed to create WebGLBuffer")}this.gl=gl;this.handle=handle;this.id=id;this.bytes=undefined;this.data=null;this.target=_webgl.GL.ARRAY_BUFFER;this.layout=null;this.userData={};Object.seal(this)}_createClass(Buffer,[{key:"delete",value:function _delete(){var gl=this.gl;if(this.handle){gl.deleteBuffer(this.handle);this.handle=null}return this}},{key:"setData",value:function setData(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},data=_ref3.data,bytes=_ref3.bytes,_ref3$target=_ref3.target,target=_ref3$target===undefined?_webgl.GL.ARRAY_BUFFER:_ref3$target,_ref3$usage=_ref3.usage,usage=_ref3$usage===undefined?_webgl.GL.STATIC_DRAW:_ref3$usage,layout=_ref3.layout,type=_ref3.type,_ref3$size=_ref3.size,size=_ref3$size===undefined?1:_ref3$size,_ref3$offset=_ref3.offset,offset=_ref3$offset===undefined?0:_ref3$offset,_ref3$stride=_ref3.stride,stride=_ref3$stride===undefined?0:_ref3$stride,_ref3$normalized=_ref3.normalized,normalized=_ref3$normalized===undefined?false:_ref3$normalized,_ref3$integer=_ref3.integer,integer=_ref3$integer===undefined?false:_ref3$integer,_ref3$instanced=_ref3.instanced,instanced=_ref3$instanced===undefined?0:_ref3$instanced;var gl=this.gl;(0,_assert2.default)(data||bytes>=0,"Buffer.setData needs data or bytes");type=type||(0,_webgl.glTypeFromArray)(data);if(data){(0,_webglChecks.assertArrayTypeMatch)(data,type,"in Buffer.setData")}this.bytes=bytes;this.data=data;this.target=target;this.layout=layout||new BufferLayout({type:type,size:size,offset:offset,stride:stride,normalized:normalized,integer:integer,instanced:instanced});this.bind({target:target});gl.bufferData(target,data||bytes,usage);this.unbind({target:target});return this}},{key:"subData",value:function subData(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},data=_ref4.data,_ref4$offset=_ref4.offset,offset=_ref4$offset===undefined?0:_ref4$offset;var gl=this.gl;(0,_assert2.default)(data,"Buffer.updateData needs data");this.bind({target:_webgl.GL.ARRAY_BUFFER});gl.bufferSubData(_webgl.GL.ARRAY_BUFFER,offset,data);this.unbind({target:_webgl.GL.ARRAY_BUFFER});return this}},{key:"bind",value:function bind(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref5$target=_ref5.target,target=_ref5$target===undefined?this.target:_ref5$target;this.gl.bindBuffer(target,this.handle);return this}},{key:"unbind",value:function unbind(){var _ref6=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref6$target=_ref6.target,target=_ref6$target===undefined?this.target:_ref6$target;return this}},{key:"bindBase",value:function bindBase(){var _ref7=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref7$target=_ref7.target,target=_ref7$target===undefined?this.target:_ref7$target,index=_ref7.index;(0,_webglChecks.assertWebGL2Context)(this.gl);this.gl.bindBufferBase(target,index,this.handle);return this}},{key:"unbindBase",value:function unbindBase(){var _ref8=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref8$target=_ref8.target,target=_ref8$target===undefined?this.target:_ref8$target,index=_ref8.index;(0,_webglChecks.assertWebGL2Context)(this.gl);this.gl.bindBufferBase(target,index,null);return this}},{key:"bindRange",value:function bindRange(){var _ref9=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref9$target=_ref9.target,target=_ref9$target===undefined?this.target:_ref9$target,index=_ref9.index,_ref9$offset=_ref9.offset,offset=_ref9$offset===undefined?0:_ref9$offset,size=_ref9.size;(0,_webglChecks.assertWebGL2Context)(this.gl);this.gl.bindBufferRange(target,index,this.handle,offset,size);return this}},{key:"unbindRange",value:function unbindRange(){var _ref10=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref10$target=_ref10.target,target=_ref10$target===undefined?this.target:_ref10$target,index=_ref10.index;(0,_webglChecks.assertWebGL2Context)(this.gl);this.gl.bindBufferBase(target,index,null);return this}}]);return Buffer}();exports.default=Buffer},{"./webgl":561,"./webgl-checks":557,assert:2}],542:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createGLContext=createGLContext;exports.getGLExtension=getGLExtension;exports.poll=poll;exports.glContextWithState=glContextWithState;exports.glGetDebugInfo=glGetDebugInfo;exports.getExtension=getExtension;var _webglDebug=require("webgl-debug");var _webglDebug2=_interopRequireDefault(_webglDebug);var _webglTypes=require("./webgl-types");var _webglChecks=require("./webgl-checks");var _queryManager=require("./helpers/query-manager");var _queryManager2=_interopRequireDefault(_queryManager);var _utils=require("../utils");var _globals=require("../globals");var _globals2=_interopRequireDefault(_globals);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}var ERR_WEBGL_MISSING_BROWSER="WebGL API is missing. Check your if your browser supports WebGL or\ninstall a recent version of a major browser.";var ERR_WEBGL_MISSING_NODE="WebGL API is missing. To run luma.gl under Node.js, please \"npm install gl\"\nand import 'luma.gl/headless' before importing 'luma.gl'.";var ERR_HEADLESSGL_NOT_AVAILABLE="Cannot create headless WebGL context, headlessGL not available";var ERR_HEADLESSGL_FAILED="headlessGL failed to create headless WebGL context";var STARTUP_MESSAGE="Assign luma.log.priority in console to control logging: 0: none, 1: minimal, 2: verbose, 3: attribute/uniforms, 4: gl logs\nluma.log.break[], set to gl funcs, luma.log.profile[] set to model names";function createGLContext(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},canvas=_ref.canvas,_ref$width=_ref.width,width=_ref$width===undefined?800:_ref$width,_ref$height=_ref.height,height=_ref$height===undefined?600:_ref$height,_ref$webgl=_ref.webgl2,webgl2=_ref$webgl===undefined?false:_ref$webgl,_ref$debug=_ref.debug,debug=_ref$debug===undefined?true:_ref$debug,opts=_objectWithoutProperties(_ref,["canvas","width","height","webgl2","debug"]);var gl=void 0;if(!_utils.isBrowser){gl=_createHeadlessContext(width,height,opts)}else{if(!_webglTypes.webGLTypesAvailable){throw new Error(ERR_WEBGL_MISSING_BROWSER)}canvas=canvas;if(typeof canvas==="string"){if(!_utils.isPageLoaded){throw new Error("createGLContext called on canvas '"+canvas+"' before page was loaded")}canvas=document.getElementById(canvas)}if(!canvas){canvas=_createCanvas()}canvas.addEventListener("webglcontextcreationerror",function(e){_utils.log.log(0,e.statusMessage||"Unknown error")},false);if(webgl2){gl=canvas.getContext("webgl2",opts);gl=gl||canvas.getContext("experimental-webgl2",opts)}gl=gl||canvas.getContext("webgl",opts);gl=gl||canvas.getContext("experimental-webgl",opts);(0,_assert2.default)(gl,"Failed to create WebGLRenderingContext")}if(_utils.isBrowser&&debug){var debugGL=_webglDebug2.default.makeDebugContext(gl,throwOnError,validateArgsAndLog);var WebGLDebugContext=function WebGLDebugContext(){_classCallCheck(this,WebGLDebugContext)};Object.assign(WebGLDebugContext.prototype,debugGL);gl=debugGL;gl.debug=true;_utils.log.priority=_utils.log.priority<1?1:_utils.log.priority;logInfo(gl);_utils.log.log(0,STARTUP_MESSAGE)}return gl}function _createCanvas(){var canvas=document.createElement("canvas");canvas.id="lumagl-canvas";canvas.style.width="100%";canvas.style.height="100%";_utils.pageLoadPromise.then(function(document){var body=document.body;body.insertBefore(canvas,body.firstChild)});return canvas}function _createHeadlessContext(width,height,opts){if(!_webglTypes.webGLTypesAvailable){throw new Error(ERR_WEBGL_MISSING_NODE)}if(!_globals2.default.globals.headlessGL){throw new Error(ERR_HEADLESSGL_NOT_AVAILABLE)}var gl=_globals2.default.globals.headlessGL(width,height,opts);if(!gl){throw new Error(ERR_HEADLESSGL_FAILED)}return gl}function getGLExtension(gl,extensionName){var ERROR="Illegal arg to getExtension";(0,_assert2.default)(gl instanceof _webglTypes.WebGLRenderingContext,ERROR);(0,_assert2.default)(typeof extensionName==="string",ERROR);var extension=gl.getExtension(extensionName);(0,_assert2.default)(extension,extensionName+" not supported!");return extension}function poll(gl){(0,_webglChecks.assertWebGLContext)(gl);_queryManager2.default.poll(gl)}function glContextWithState(gl,_ref2,func){var scissorTest=_ref2.scissorTest,framebuffer=_ref2.framebuffer;var scissorTestWasEnabled=void 0;if(scissorTest){scissorTestWasEnabled=gl.isEnabled(gl.SCISSOR_TEST);var x=scissorTest.x,y=scissorTest.y,w=scissorTest.w,h=scissorTest.h;gl.enable(gl.SCISSOR_TEST);gl.scissor(x,y,w,h)}if(framebuffer){framebuffer.bind()}var value=void 0;try{value=func(gl)}finally{if(!scissorTestWasEnabled){gl.disable(gl.SCISSOR_TEST)}if(framebuffer){gl.bindFramebuffer(gl.FRAMEBUFFER,null)}}return value}function glGetDebugInfo(gl){var info=gl.getExtension("WEBGL_debug_renderer_info");return{vendor:info&&info.UNMASKED_VENDOR_WEBGL?gl.getParameter(info.UNMASKED_VENDOR_WEBGL):"unknown",renderer:info&&info.UNMASKED_RENDERER_WEBGL?gl.getParameter(info.UNMASKED_RENDERER_WEBGL):"unknown"}}function logInfo(gl){var webGL=(0,_webglChecks.isWebGL2Context)(gl)?"WebGL2":"WebGL1";var info=glGetDebugInfo(gl);var driver=info?"using driver: "+info.vendor+" "+info.renderer:"";var debug=gl.debug?"debug":"";_utils.log.log(0,"luma.gl "+_globals2.default.VERSION+": "+webGL+" "+debug+" context "+driver,gl)}function getFunctionString(functionName,functionArgs){var args=_webglDebug2.default.glFunctionArgsToString(functionName,functionArgs);args=""+args.slice(0,100)+(args.length>100?"...":"");return"gl."+functionName+"("+args+")"}function throwOnError(err,functionName,args){var errorMessage=_webglDebug2.default.glEnumToString(err);var functionArgs=_webglDebug2.default.glFunctionArgsToString(functionName,args);throw new Error(errorMessage+" was caused by call to: "+("gl."+functionName+"("+functionArgs+")"))}function validateArgsAndLog(functionName,functionArgs){var functionString=void 0;if(_utils.log.priority>=4){functionString=getFunctionString(functionName,functionArgs);_utils.log.info(4,""+functionString)}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=functionArgs[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var arg=_step.value;if(arg===undefined){functionString=functionString||getFunctionString(functionName,functionArgs);throw new Error("Undefined argument: "+functionString)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{
try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}if(_utils.log.break){functionString=functionString||getFunctionString(functionName,functionArgs);var isBreakpoint=_utils.log.break&&_utils.log.break.every(function(breakString){return functionString.indexOf(breakString)!==-1});if(isBreakpoint){debugger}}}function getExtension(gl,extensionName){_utils.log.warn(0,"luma.gl: getExtension is deprecated");return getGLExtension(gl,extensionName)}},{"../globals":504,"../utils":536,"./helpers/query-manager":545,"./webgl-checks":557,"./webgl-types":560,assert:2,"webgl-debug":1006}],543:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.draw=draw;var _context=require("./context");var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function draw(gl,_ref){var _ref$drawMode=_ref.drawMode,drawMode=_ref$drawMode===undefined?_webgl.GL.TRIANGLES:_ref$drawMode,vertexCount=_ref.vertexCount,_ref$offset=_ref.offset,offset=_ref$offset===undefined?0:_ref$offset,_ref$isIndexed=_ref.isIndexed,isIndexed=_ref$isIndexed===undefined?false:_ref$isIndexed,_ref$indexType=_ref.indexType,indexType=_ref$indexType===undefined?_webgl.GL.UNSIGNED_SHORT:_ref$indexType,_ref$isInstanced=_ref.isInstanced,isInstanced=_ref$isInstanced===undefined?false:_ref$isInstanced,_ref$instanceCount=_ref.instanceCount,instanceCount=_ref$instanceCount===undefined?0:_ref$instanceCount;(0,_webglChecks.assertWebGLContext)(gl);drawMode=(0,_webgl.glGet)(drawMode);indexType=(0,_webgl.glGet)(indexType);(0,_webglChecks.assertDrawMode)(drawMode,"in draw");if(isIndexed){(0,_webglChecks.assertIndexType)(indexType,"in draw")}if(isInstanced){var extension=gl.getExtension("ANGLE_instanced_arrays");if(isIndexed){extension.drawElementsInstancedANGLE(drawMode,vertexCount,indexType,offset,instanceCount)}else{extension.drawArraysInstancedANGLE(drawMode,offset,vertexCount,instanceCount)}}else if(isIndexed){gl.drawElements(drawMode,vertexCount,indexType,offset)}else{gl.drawArrays(drawMode,offset,vertexCount)}}},{"./context":542,"./webgl":561,"./webgl-checks":557,assert:2}],544:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _texture2d=require("./texture-2d");var _texture2d2=_interopRequireDefault(_texture2d);var _renderbuffer=require("./renderbuffer");var _renderbuffer2=_interopRequireDefault(_renderbuffer);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function glFormatToComponents(format){switch(format){case _webgl.GL.ALPHA:return 1;case _webgl.GL.RGB:return 3;case _webgl.GL.RGBA:return 4;default:throw new Error("Unknown format")}}var Framebuffer=function(){_createClass(Framebuffer,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof Framebuffer?object:new Framebuffer(gl,{handle:object.handle||object})}}]);function Framebuffer(gl){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},id=_ref.id,params=_objectWithoutProperties(_ref,["id"]);_classCallCheck(this,Framebuffer);(0,_webglChecks.assertWebGLContext)(gl);var handle=gl.createFramebuffer();if(!handle){throw new Error("Failed to create WebGL Framebuffer")}this.gl=gl;this.id=(0,_utils.uid)(id);this.handle=handle;this.colorBuffer=null;this.depthBuffer=null;this.stencilBuffer=null;this.texture=null;this.userData={};this.width=0;this.height=0;Object.seal(this);this.resize(params)}_createClass(Framebuffer,[{key:"delete",value:function _delete(){var gl=this.gl;gl.deleteFramebuffer(this.handle)}},{key:"resize",value:function resize(_ref2){var width=_ref2.width,height=_ref2.height;this.update({width:width,height:height})}},{key:"update",value:function update(_ref3){var _ref3$width=_ref3.width,width=_ref3$width===undefined?1:_ref3$width,_ref3$height=_ref3.height,height=_ref3$height===undefined?1:_ref3$height,_ref3$depth=_ref3.depth,depth=_ref3$depth===undefined?true:_ref3$depth,_ref3$minFilter=_ref3.minFilter,minFilter=_ref3$minFilter===undefined?_webgl.GL.NEAREST:_ref3$minFilter,_ref3$magFilter=_ref3.magFilter,magFilter=_ref3$magFilter===undefined?_webgl.GL.NEAREST:_ref3$magFilter,_ref3$format=_ref3.format,format=_ref3$format===undefined?_webgl.GL.RGBA:_ref3$format,_ref3$type=_ref3.type,type=_ref3$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref3$type;(0,_assert2.default)(width>=0&&height>=0,"Width and height need to be integers");if(width===this.width&&height===this.height){return}_utils.log.log(1,"Resizing framebuffer "+this.id+" to "+width+"x"+height);var gl=this.gl;var colorBuffer=new _texture2d2.default(gl,{minFilter:this.minFilter,magFilter:this.magFilter}).setImageData({data:null,width:width,height:height,type:type,format:format});this.attachTexture({attachment:_webgl.GL.COLOR_ATTACHMENT0,texture:colorBuffer});if(this.colorBuffer){this.colorBuffer.delete()}this.colorBuffer=colorBuffer;this.texture=colorBuffer;if(depth){var depthBuffer=new _renderbuffer2.default(gl).storage({internalFormat:_webgl.GL.DEPTH_COMPONENT16,width:width,height:height});this.attachRenderbuffer({attachment:_webgl.GL.DEPTH_ATTACHMENT,renderbuffer:depthBuffer});if(this.depthBuffer){this.depthBuffer.delete()}this.depthBuffer=depthBuffer}this.checkStatus();this.width=width;this.height=height}},{key:"bind",value:function bind(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref4$target=_ref4.target,target=_ref4$target===undefined?_webgl.GL.FRAMEBUFFER:_ref4$target;var gl=this.gl;gl.bindFramebuffer(target,this.handle);return this}},{key:"unbind",value:function unbind(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref5$target=_ref5.target,target=_ref5$target===undefined?_webgl.GL.FRAMEBUFFER:_ref5$target;var gl=this.gl;gl.bindFramebuffer(target,null);return this}},{key:"readPixels",value:function readPixels(_ref6){var _ref6$x=_ref6.x,x=_ref6$x===undefined?0:_ref6$x,_ref6$y=_ref6.y,y=_ref6$y===undefined?0:_ref6$y,width=_ref6.width,height=_ref6.height,_ref6$format=_ref6.format,format=_ref6$format===undefined?_webgl.GL.RGBA:_ref6$format,type=_ref6.type,_ref6$pixelArray=_ref6.pixelArray,pixelArray=_ref6$pixelArray===undefined?null:_ref6$pixelArray;var gl=this.gl;if(!pixelArray){type=type||_webgl.GL.UNSIGNED_BYTE;var ArrayType=(0,_webgl.glTypeToArray)(type);var components=glFormatToComponents(format);pixelArray=pixelArray||new ArrayType(width*height*components)}type=type||(0,_webgl.glTypeFromArray)(pixelArray);this.bind();gl.readPixels(x,y,width,height,format,type,pixelArray);this.unbind();return pixelArray}},{key:"attachTexture",value:function attachTexture(){var _ref7=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref7$texture=_ref7.texture,texture=_ref7$texture===undefined?null:_ref7$texture,_ref7$target=_ref7.target,target=_ref7$target===undefined?_webgl.GL.FRAMEBUFFER:_ref7$target,_ref7$attachment=_ref7.attachment,attachment=_ref7$attachment===undefined?_webgl.GL.COLOR_ATTACHMENT0:_ref7$attachment,_ref7$textureTarget=_ref7.textureTarget,textureTarget=_ref7$textureTarget===undefined?_webgl.GL.TEXTURE_2D:_ref7$textureTarget,_ref7$mipmapLevel=_ref7.mipmapLevel,mipmapLevel=_ref7$mipmapLevel===undefined?0:_ref7$mipmapLevel;var gl=this.gl;texture=texture&&_texture2d2.default.makeFrom(gl,texture);this.bind({target:target});gl.framebufferTexture2D(target,(0,_webgl.glGet)(attachment),(0,_webgl.glGet)(textureTarget),texture.handle,mipmapLevel);this.unbind();return this}},{key:"attachRenderbuffer",value:function attachRenderbuffer(){var _ref8=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref8$renderbuffer=_ref8.renderbuffer,renderbuffer=_ref8$renderbuffer===undefined?null:_ref8$renderbuffer,_ref8$attachment=_ref8.attachment,attachment=_ref8$attachment===undefined?_webgl.GL.COLOR_ATTACHMENT0:_ref8$attachment,_ref8$target=_ref8.target,target=_ref8$target===undefined?_webgl.GL.FRAMEBUFFER:_ref8$target,_ref8$renderbufferTar=_ref8.renderbufferTarget,renderbufferTarget=_ref8$renderbufferTar===undefined?_webgl.GL.RENDERBUFFER:_ref8$renderbufferTar;var gl=this.gl;renderbuffer=renderbuffer&&_renderbuffer2.default.makeFrom(gl,renderbuffer);this.bind({target:target});gl.framebufferRenderbuffer(target,(0,_webgl.glGet)(attachment),(0,_webgl.glGet)(renderbufferTarget),renderbuffer.handle);this.unbind({target:target});return this}},{key:"checkStatus",value:function checkStatus(){var _ref9=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref9$target=_ref9.target,target=_ref9$target===undefined?_webgl.GL.FRAMEBUFFER:_ref9$target;var gl=this.gl;this.bind({target:target});var status=gl.checkFramebufferStatus(target);this.unbind({target:target});if(status!==gl.FRAMEBUFFER_COMPLETE){throw new Error(this._getFrameBufferStatus(status))}return this}},{key:"blit",value:function blit(_ref10){var srcX0=_ref10.srcX0,srcY0=_ref10.srcY0,srcX1=_ref10.srcX1,srcY1=_ref10.srcY1,dstX0=_ref10.dstX0,dstY0=_ref10.dstY0,dstX1=_ref10.dstX1,dstY1=_ref10.dstY1,mask=_ref10.mask,_ref10$filter=_ref10.filter,filter=_ref10$filter===undefined?_webgl.GL.NEAREST:_ref10$filter;var gl=this.gl;(0,_webglChecks.assertWebGL2)(gl);gl.blitFramebuffer(srcX0,srcY0,srcX1,srcY1,dstX0,dstY0,dstX1,dstY1,mask,filter);return this}},{key:"textureLayer",value:function textureLayer(){var _ref11=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref11$target=_ref11.target,target=_ref11$target===undefined?_webgl.GL.FRAMEBUFFER:_ref11$target,attachment=_ref11.attachment,texture=_ref11.texture,level=_ref11.level,layer=_ref11.layer;var gl=this.gl;(0,_webglChecks.assertWebGL2)(gl);gl.framebufferTextureLayer(target,attachment,texture,level,layer);return this}},{key:"invalidate",value:function invalidate(_ref12){var _ref12$target=_ref12.target,target=_ref12$target===undefined?_webgl.GL.FRAMEBUFFER:_ref12$target,_ref12$attachments=_ref12.attachments,attachments=_ref12$attachments===undefined?[]:_ref12$attachments;var gl=this.gl;(0,_webglChecks.assertWebGL2)(gl);gl.invalidateFramebuffer(target,attachments);return this}},{key:"invalidateSub",value:function invalidateSub(_ref13){var _ref13$target=_ref13.target,target=_ref13$target===undefined?_webgl.GL.FRAMEBUFFER:_ref13$target,_ref13$attachments=_ref13.attachments,attachments=_ref13$attachments===undefined?[]:_ref13$attachments,_ref13$x=_ref13.x,x=_ref13$x===undefined?0:_ref13$x,_ref13$y=_ref13.y,y=_ref13$y===undefined?0:_ref13$y,width=_ref13.width,height=_ref13.height;var gl=this.gl;(0,_webglChecks.assertWebGL2)(gl);gl.invalidateFramebuffer(target,attachments,x,y,width,height);return this}},{key:"readBuffer",value:function readBuffer(_ref14){var src=_ref14.src;var gl=this.gl;(0,_webglChecks.assertWebGL2)(gl);gl.readBuffer(src);return this}},{key:"alphaSize",value:function alphaSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE)}},{key:"blueSize",value:function blueSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE)}},{key:"colorEncoding",value:function colorEncoding(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING)}},{key:"componentType",value:function componentType(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE)}},{key:"depthSize",value:function depthSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE)}},{key:"greenSize",value:function greenSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE)}},{key:"objectName",value:function objectName(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME)}},{key:"objectType",value:function objectType(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE)}},{key:"redSize",value:function redSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_RED_SIZE)}},{key:"stencilSize",value:function stencilSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE)}},{key:"cubeMapFace",value:function cubeMapFace(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE)}},{key:"layer",value:function layer(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER)}},{key:"level",value:function level(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL)}},{key:"getParameters",value:function getParameters(){return{redSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_RED_SIZE),greenSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE),blueSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE),alphaSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE),depthSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE),stencilSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE),colorEncoding:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING),componentType:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE),objectName:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME),objectType:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE),cubeMapFace:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE),layer:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER),level:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL)}}},{key:"getAttachmentParameter",value:function getAttachmentParameter(){var _ref15=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},pname=_ref15.pname,target=_ref15.target,attachment=_ref15.attachment;var gl=this.gl;(0,_webglChecks.assertWebGL2)(gl);var value=gl.getFramebufferAttachmentParameter(target,attachment,pname);return value}},{key:"_getFrameBufferStatus",value:function _getFrameBufferStatus(status){var error=void 0;switch(status){case _webgl.GL.FRAMEBUFFER_COMPLETE:error="Success. Framebuffer is correctly set up";break;case _webgl.GL.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:error="The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.";break;case _webgl.GL.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:error="There is no attachment.";break;case _webgl.GL.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:error="Height and width of the attachment are not the same.";break;case _webgl.GL.FRAMEBUFFER_UNSUPPORTED:error="The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer.";break;case _webgl.GL.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:error="The values of GL.RENDERBUFFER_SAMPLES are different among attached renderbuffers, or are non-zero if the attached images are a mix of renderbuffers and textures.";break;default:error="Framebuffer error "+status;break}return error}}]);return Framebuffer}();exports.default=Framebuffer},{"../utils":536,"./renderbuffer":548,"./texture-2d":550,"./webgl":561,"./webgl-checks":557,assert:2}],545:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ERR_DELETED="Query was deleted before result was available";var ERR_CANCEL="Query was canceled before result was available";var noop=function noop(x){return x};var QueryManager=function(){function QueryManager(){_classCallCheck(this,QueryManager);this.pendingQueries=new Set;this.invalidQueryType=null;this.invalidErrorMessage="";this.checkInvalid=function(){return false}}_createClass(QueryManager,[{key:"poll",value:function poll(gl){this.cancelInvalidQueries(gl);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.pendingQueries.values()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var query=_step.value;var resultAvailable=query.isResultAvailable();if(resultAvailable){var result=query.getResult();this.resolveQuery(query,result)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"setInvalidator",value:function setInvalidator(_ref){var queryType=_ref.queryType,errorMessage=_ref.errorMessage,checkInvalid=_ref.checkInvalid;this.invalidQueryType=queryType;this.invalidErrorMessage=errorMessage;this.checkInvalid=checkInvalid}},{key:"beginQuery",value:function beginQuery(query){var onComplete=arguments.length>1&&arguments[1]!==undefined?arguments[1]:noop;var onError=arguments.length>2&&arguments[2]!==undefined?arguments[2]:noop;this.cancelInvalidQueries(query.gl);this.cancelQuery(query);var resolvers={};query.promise=new Promise(function(resolve,reject){resolvers.resolve=resolve;resolvers.reject=reject});Object.assign(query.promise,resolvers);this.pendingQueries.add(query);return query.promise.then(onComplete).catch(onError)}},{key:"resolveQuery",value:function resolveQuery(query,result){this.pendingQueries.delete(query);query.promise.resolve(result)}},{key:"rejectQuery",value:function rejectQuery(query,errorMessage){this.pendingQueries.delete(query);if(query.promise){query.promise.reject(new Error(errorMessage))}}},{key:"deleteQuery",value:function deleteQuery(query){return this.rejectQuery(query,ERR_DELETED)}},{key:"cancelQuery",value:function cancelQuery(query){return this.rejectQuery(query,ERR_CANCEL)}},{key:"invalidateQuery",value:function invalidateQuery(query){if(query instanceof this.invalidQueryType){this.rejectQuery(query,this.invalidErrorMessage)}}},{key:"cancelInvalidQueries",value:function cancelInvalidQueries(gl){if(this.checkInvalid(gl)){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.pendingQueries.values()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var query=_step2.value;this.invalidateQuery(query)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}}}]);return QueryManager}();exports.default=new QueryManager},{}],546:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TimerQuery=exports.VertexAttributes=exports.TextureCube=exports.Texture2D=exports.Renderbuffer=exports.Framebuffer=exports.Program=exports.FragmentShader=exports.VertexShader=exports.Shader=exports.Buffer=undefined;var _webgl=require("./webgl");Object.keys(_webgl).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _webgl[key]}})});var _buffer=require("./buffer");Object.defineProperty(exports,"Buffer",{enumerable:true,get:function get(){return _interopRequireDefault(_buffer).default}});var _shader=require("./shader");Object.defineProperty(exports,"Shader",{enumerable:true,get:function get(){return _interopRequireDefault(_shader).default}});Object.defineProperty(exports,"VertexShader",{enumerable:true,get:function get(){return _shader.VertexShader}});Object.defineProperty(exports,"FragmentShader",{enumerable:true,get:function get(){return _shader.FragmentShader}});var _program=require("./program");Object.defineProperty(exports,"Program",{enumerable:true,get:function get(){return _interopRequireDefault(_program).default}});var _framebuffer=require("./framebuffer");Object.defineProperty(exports,"Framebuffer",{enumerable:true,get:function get(){return _interopRequireDefault(_framebuffer).default}});var _renderbuffer=require("./renderbuffer");Object.defineProperty(exports,"Renderbuffer",{enumerable:true,get:function get(){return _interopRequireDefault(_renderbuffer).default}});var _texture2d=require("./texture-2d");Object.defineProperty(exports,"Texture2D",{enumerable:true,get:function get(){return _interopRequireDefault(_texture2d).default}});var _textureCube=require("./texture-cube");Object.defineProperty(exports,"TextureCube",{enumerable:true,get:function get(){return _interopRequireDefault(_textureCube).default}});var _timerQuery=require("./timer-query");Object.defineProperty(exports,"TimerQuery",{enumerable:true,get:function get(){return _interopRequireDefault(_timerQuery).default}});var _context=require("./context");Object.keys(_context).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _context[key]}})});var _draw=require("./draw");Object.keys(_draw).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _draw[key]}})});var _uniforms=require("./uniforms");Object.keys(_uniforms).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _uniforms[key]}})});var _vertexAttributes=require("./vertex-attributes");var VertexAttributes=_interopRequireWildcard(_vertexAttributes);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.VertexAttributes=VertexAttributes},{"./buffer":541,"./context":542,"./draw":543,"./framebuffer":544,"./program":547,"./renderbuffer":548,"./shader":549,"./texture-2d":550,"./texture-cube":551,"./timer-query":553,"./uniforms":554,"./vertex-attributes":555,"./webgl":561}],547:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.getUniformDescriptors=getUniformDescriptors;var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _vertexAttributes=require("./vertex-attributes");var VertexAttributes=_interopRequireWildcard(_vertexAttributes);var _buffer2=require("./buffer");var _buffer3=_interopRequireDefault(_buffer2);var _texture=require("./texture");var _texture2=_interopRequireDefault(_texture);var _uniforms=require("./uniforms");var _shader=require("./shader");var _shaderlib=require("../shaderlib");var _shaderlib2=_interopRequireDefault(_shaderlib);var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Program=function(){_createClass(Program,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof Program?object:new Program(gl).setData({handle:object.handle||object})}}]);function Program(gl){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},id=_ref.id,_ref$vs=_ref.vs,vs=_ref$vs===undefined?_shaderlib2.default.DEFAULT.vs:_ref$vs,_ref$fs=_ref.fs,fs=_ref$fs===undefined?_shaderlib2.default.DEFAULT.fs:_ref$fs,defaultUniforms=_ref.defaultUniforms,handle=_ref.handle;_classCallCheck(this,Program);(0,_webglChecks.assertWebGLContext)(gl);if(vs===_shaderlib2.default.DEFAULT.vs||fs===_shaderlib2.default.DEFAULT.fs&&defaultUniforms===undefined){defaultUniforms=_shaderlib2.default.DEFAULT.defaultUniforms}this.vs=typeof vs==="string"?new _shader.VertexShader(gl,vs):vs;this.fs=typeof vs==="string"?new _shader.FragmentShader(gl,fs):fs;(0,_assert2.default)(this.vs instanceof _shader.VertexShader,"Program: bad vertex shader");(0,_assert2.default)(this.fs instanceof _shader.FragmentShader,"Program: bad fragment shader");var programName=this.vs.getName()||this.fs.getName();programName=programName?programName+"-program":"program";this.id=id||(0,_utils.uid)(programName);this.gl=gl;this.defaultUniforms=defaultUniforms;this.handle=handle;if(!this.handle){this.handle=gl.createProgram();this._compileAndLink()}if(!this.handle){throw new Error("Failed to create program")}this._attributeLocations=this._getAttributeLocations();this._attributeCount=this.getAttributeCount();this._warn=[];this._filledLocations={};this._uniformSetters=this._getUniformSetters();this._uniformCount=this.getUniformCount();this._textureIndexCounter=0;this.userData={};Object.seal(this)}_createClass(Program,[{key:"delete",value:function _delete(){var gl=this.gl;if(this.handle){gl.deleteProgram(this.handle)}this.handle=null;return this}},{key:"use",value:function use(){var gl=this.gl;gl.useProgram(this.handle);return this}},{key:"clearBuffers",value:function clearBuffers(){this._filledLocations={};return this}},{key:"_print",value:function _print(bufferName){return"Program "+this.id+": Attribute "+bufferName}},{key:"setBuffers",value:function setBuffers(buffers){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref2$clear=_ref2.clear,clear=_ref2$clear===undefined?true:_ref2$clear,_ref2$check=_ref2.check,check=_ref2$check===undefined?true:_ref2$check,_ref2$drawParams=_ref2.drawParams,drawParams=_ref2$drawParams===undefined?{}:_ref2$drawParams;var gl=this.gl;if(Array.isArray(buffers)){throw new Error("Program.setBuffers expects map of buffers")}if(clear){this.clearBuffers()}drawParams.isInstanced=false;drawParams.isIndexed=false;drawParams.indexType=null;var _sortBuffersByLocatio=this._sortBuffersByLocation(buffers),locations=_sortBuffersByLocatio.locations,elements=_sortBuffersByLocatio.elements;for(var location=0;location<locations.length;++location){var bufferName=locations[location];var buffer=buffers[bufferName];if(!buffer){VertexAttributes.disable(gl,location)}else{var divisor=buffer.layout.instanced?1:0;VertexAttributes.enable(gl,location);VertexAttributes.setBuffer({gl:gl,location:location,buffer:buffer});VertexAttributes.setDivisor(gl,location,divisor);drawParams.isInstanced=buffer.layout.instanced>0;this._filledLocations[bufferName]=true}}if(elements){var _buffer=buffers[elements];_buffer.bind();drawParams.isIndexed=true;drawParams.indexType=_buffer.layout.type}if(check){this.checkBuffers()}return this}},{key:"checkBuffers",value:function checkBuffers(){for(var attributeName in this._attributeLocations){if(!this._filledLocations[attributeName]&&!this._warn[attributeName]){var location=this._attributeLocations[attributeName];_utils.log.warn(0,"Program "+this.id+": "+("Attribute "+location+":"+attributeName+" not supplied"));this._warn[attributeName]=true}}return this}},{key:"unsetBuffers",value:function unsetBuffers(){var gl=this.gl;var length=this._attributeCount;for(var i=1;i<length;++i){VertexAttributes.disable(gl,i)}gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null);return this}},{key:"setUniforms",value:function setUniforms(uniforms){for(var uniformName in uniforms){var uniform=uniforms[uniformName];var uniformSetter=this._uniformSetters[uniformName];if(uniformSetter){if(uniform instanceof _texture2.default){if(uniformSetter.textureIndex===undefined){uniformSetter.textureIndex=this._textureIndexCounter++}var texture=uniform;var textureIndex=uniformSetter.textureIndex;texture.bind(textureIndex);uniformSetter(textureIndex)}else{uniformSetter(uniform)}}}return this}},{key:"getAttachedShadersCount",value:function getAttachedShadersCount(){return this.getProgramParameter(_webgl.GL.ATTACHED_SHADERS)}},{key:"getAttributeCount",value:function getAttributeCount(){return this.getProgramParameter(_webgl.GL.ACTIVE_ATTRIBUTES)}},{key:"getAttributeInfo",value:function getAttributeInfo(location){return this.gl.getActiveAttrib(this.handle,location)}},{key:"getAttributeName",value:function getAttributeName(location){return this.getAttributeInfo(location).name}},{key:"getAttributeLocation",value:function getAttributeLocation(attributeName){return this.gl.getAttribLocation(this.handle,attributeName)}},{key:"getUniformCount",value:function getUniformCount(){return this.getProgramParameter(_webgl.GL.ACTIVE_UNIFORMS)}},{key:"getUniformInfo",value:function getUniformInfo(index){return this.gl.getActiveUniform(this.handle,index)}},{key:"getUniformLocation",value:function getUniformLocation(name){return this.gl.getUniformLocation(this.handle,name)}},{key:"getUniformValue",value:function getUniformValue(location){return this.gl.getUniform(this.handle,location)}},{key:"isFlaggedForDeletion",value:function isFlaggedForDeletion(){return this.getProgramParameter(_webgl.GL.DELETE_STATUS)}},{key:"getLastLinkStatus",value:function getLastLinkStatus(){return this.getProgramParameter(_webgl.GL.LINK_STATUS)}},{key:"getLastValidationStatus",value:function getLastValidationStatus(){return this.getProgramParameter(_webgl.GL.VALIDATE_STATUS)}},{key:"getTransformFeedbackBufferMode",value:function getTransformFeedbackBufferMode(){(0,_webglChecks.assertWebGL2Context)(this.gl);return this.getProgramParameter(this.gl.TRANSFORM_FEEDBACK_BUFFER_MODE)}},{key:"getTransformFeedbackVaryingsCount",value:function getTransformFeedbackVaryingsCount(){(0,_webglChecks.assertWebGL2Context)(this.gl);
return this.getProgramParameter(this.gl.TRANSFORM_FEEDBACK_VARYINGS)}},{key:"getActiveUniformBlocksCount",value:function getActiveUniformBlocksCount(){(0,_webglChecks.assertWebGL2Context)(this.gl);return this.getProgramParameter(this.gl.ACTIVE_UNIFORM_BLOCKS)}},{key:"getFragDataLocation",value:function getFragDataLocation(varyingName){(0,_webglChecks.assertWebGL2Context)(this.gl);return this.gl.getFragDataLocation(this.handle,varyingName)}},{key:"getProgramParameter",value:function getProgramParameter(pname){return this.gl.getProgramParameter(this.handle,pname)}},{key:"_compileAndLink",value:function _compileAndLink(){var gl=this.gl;gl.attachShader(this.handle,this.vs.handle);gl.attachShader(this.handle,this.fs.handle);gl.linkProgram(this.handle);gl.validateProgram(this.handle);var linked=gl.getProgramParameter(this.handle,gl.LINK_STATUS);if(!linked){throw new Error("Error linking "+gl.getProgramInfoLog(this.handle))}}},{key:"_sortBuffersByLocation",value:function _sortBuffersByLocation(buffers){var elements=null;var locations=new Array(this._attributeCount);for(var bufferName in buffers){var buffer=_buffer3.default.makeFrom(this.gl,buffers[bufferName]);var location=this._attributeLocations[bufferName];if(location===undefined){if(buffer.target===_webgl.GL.ELEMENT_ARRAY_BUFFER&&elements){throw new Error(this._print(bufferName)+" duplicate gl.ELEMENT_ARRAY_BUFFER")}else if(buffer.target===_webgl.GL.ELEMENT_ARRAY_BUFFER){elements=bufferName}else if(!this._warn[bufferName]){_utils.log.warn(2,this._print(bufferName)+" not used");this._warn[bufferName]=true}}else{if(buffer.target===_webgl.GL.ELEMENT_ARRAY_BUFFER){throw new Error(this._print(bufferName)+":"+location+" "+"has both location and type gl.ELEMENT_ARRAY_BUFFER")}locations[location]=bufferName}}return{locations:locations,elements:elements}}},{key:"_areAllAttributesEnabled",value:function _areAllAttributesEnabled(){var gl=this.gl;var length=this._attributeCount;for(var i=0;i<length;++i){if(!VertexAttributes.isEnabled(gl,i)){return false}}return true}},{key:"_getAttributeLocations",value:function _getAttributeLocations(){var attributeLocations={};var length=this.getAttributeCount();for(var location=0;location<length;location++){var name=this.getAttributeName(location);attributeLocations[name]=this.getAttributeLocation(name)}return attributeLocations}},{key:"_getUniformSetters",value:function _getUniformSetters(){var gl=this.gl;var uniformSetters={};var length=this.getUniformCount();for(var i=0;i<length;i++){var info=this.getUniformInfo(i);var parsedName=(0,_uniforms.parseUniformName)(info.name);var location=this.getUniformLocation(parsedName.name);uniformSetters[parsedName.name]=(0,_uniforms.getUniformSetter)(gl,location,info,parsedName.isArray)}return uniformSetters}}]);return Program}();exports.default=Program;function getUniformDescriptors(gl,program){var uniformDescriptors={};var length=program.getUniformCount();for(var i=0;i<length;i++){var info=program.getUniformInfo(i);var location=program.getUniformLocation(info.name);var descriptor=(0,_uniforms.getUniformSetter)(gl,location,info);uniformDescriptors[descriptor.name]=descriptor}return uniformDescriptors}},{"../shaderlib":534,"../utils":536,"./buffer":541,"./shader":549,"./texture":552,"./uniforms":554,"./vertex-attributes":555,"./webgl":561,"./webgl-checks":557,assert:2}],548:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webgl2=_interopRequireDefault(_webgl);var _webglChecks=require("./webgl-checks");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Renderbuffer=function(){_createClass(Renderbuffer,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof Renderbuffer?object:new Renderbuffer(gl,{handle:object.handle||object})}}]);function Renderbuffer(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,Renderbuffer);(0,_webglChecks.assertWebGLContext)(gl);this.gl=gl;this.handle=gl.createRenderbuffer();if(!this.handle){throw new Error("Failed to create WebGL Renderbuffer")}}_createClass(Renderbuffer,[{key:"delete",value:function _delete(){this.gl.deleteRenderbuffer(this.handle);return this}},{key:"bind",value:function bind(){this.gl.bindRenderbuffer(_webgl2.default.RENDERBUFFER,this.handle);return this}},{key:"unbind",value:function unbind(){this.gl.bindRenderbuffer(_webgl2.default.RENDERBUFFER,null);return this}},{key:"storage",value:function storage(_ref){var internalFormat=_ref.internalFormat,width=_ref.width,height=_ref.height;var gl=this.gl;(0,_assert2.default)(internalFormat,"Needs internalFormat");this.bind();gl.renderbufferStorage(_webgl2.default.RENDERBUFFER,(0,_webgl.glGet)(internalFormat),width,height);this.unbind();return this}},{key:"getParameter",value:function getParameter(pname){var gl=this.gl;this.bind();var value=gl.getRenderbufferParameter(_webgl2.default.RENDERBUFFER,(0,_webgl.glGet)(pname));this.unbind();return value}},{key:"storageMultisample",value:function storageMultisample(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},samples=_ref2.samples,internalformat=_ref2.internalformat,width=_ref2.width,height=_ref2.height;var gl=this.gl;(0,_webglChecks.assertWebGL2Context)(gl);gl.renderbufferStorageMultisample(_webgl2.default.RENDERBUFFER,samples,internalformat,width,height);return this}},{key:"getInternalformatParameter",value:function getInternalformatParameter(_ref3){var internalformat=_ref3.internalformat,_ref3$pname=_ref3.pname,pname=_ref3$pname===undefined?"SAMPLES":_ref3$pname;var gl=this.gl;(0,_webglChecks.assertWebGL2Context)(gl);return gl.getInternalformatParameter(_webgl2.default.RENDERBUFFER,internalformat,pname)}},{key:"width",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_WIDTH)}},{key:"height",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_HEIGHT)}},{key:"internalFormat",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_INTERNAL_FORMAT)}},{key:"greenSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_GREEN_SIZE)}},{key:"blueSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_BLUE_SIZE)}},{key:"redSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_RED_SIZE)}},{key:"alphaSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_ALPHA_SIZE)}},{key:"depthSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_DEPTH_SIZE)}},{key:"stencilSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_STENCIL_SIZE)}},{key:"samples",get:function get(){return this.getParameter(this.gl.RENDERBUFFER_SAMPLES)}}]);return Renderbuffer}();exports.default=Renderbuffer},{"./webgl":561,"./webgl-checks":557,assert:2}],549:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FragmentShader=exports.VertexShader=exports.Shader=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _webglFormatGlslError=require("./webgl-format-glsl-error");var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ERR_SOURCE="Shader: GLSL source code must be a JavaScript string";var Shader=exports.Shader=function(){function Shader(gl,source,shaderType){_classCallCheck(this,Shader);(0,_webglChecks.assertWebGLContext)(gl);(0,_assert2.default)(typeof source==="string",ERR_SOURCE);this.id=(0,_webglFormatGlslError.getShaderName)(source)||(0,_utils.uid)(this.getTypeName(shaderType));this.gl=gl;this.shaderType=shaderType;this.source=source;this.handle=gl.createShader(shaderType);if(this.handle===null){throw new Error("Error creating shader with type "+shaderType)}this.compile()}_createClass(Shader,[{key:"delete",value:function _delete(){var gl=this.gl;if(this.handle){gl.deleteShader(this.handle);this.handle=null}}},{key:"toString",value:function toString(){return this.getTypeName(this.shaderType)+":"+this.id}},{key:"getName",value:function getName(){return(0,_webglFormatGlslError.getShaderName)(this.source)}},{key:"getTypeName",value:function getTypeName(shaderType){switch(shaderType){case _webgl.GL.VERTEX_SHADER:return"vertex-shader";case _webgl.GL.FRAGMENT_SHADER:return"fragment-shader";default:return"shader"}}},{key:"compile",value:function compile(){var gl=this.gl;gl.shaderSource(this.handle,this.source);gl.compileShader(this.handle);var compiled=gl.getShaderParameter(this.handle,_webgl.GL.COMPILE_STATUS);if(!compiled){var infoLog=gl.getShaderInfoLog(this.handle);var error=(0,_webglFormatGlslError.formatCompilerError)(infoLog,this.source,this.shaderType);if(_utils.log.priority>0){this.copyToClipboard(this.source)}this.delete();throw new Error("Error while compiling the shader "+error)}}},{key:"copyToClipboard",value:function copyToClipboard(text){if(_utils.isBrowser){var input=document.createElement("textarea");document.body.appendChild(input);input.value=text;input.focus();input.select();if(!document.execCommand("copy")){console.log("Failed to copy to clipboard")}input.remove()}}}]);return Shader}();var VertexShader=exports.VertexShader=function(_Shader){_inherits(VertexShader,_Shader);function VertexShader(gl,source){_classCallCheck(this,VertexShader);return _possibleConstructorReturn(this,(VertexShader.__proto__||Object.getPrototypeOf(VertexShader)).call(this,gl,source,_webgl.GL.VERTEX_SHADER))}return VertexShader}(Shader);var FragmentShader=exports.FragmentShader=function(_Shader2){_inherits(FragmentShader,_Shader2);function FragmentShader(gl,source){_classCallCheck(this,FragmentShader);return _possibleConstructorReturn(this,(FragmentShader.__proto__||Object.getPrototypeOf(FragmentShader)).call(this,gl,source,_webgl.GL.FRAGMENT_SHADER))}return FragmentShader}(Shader)},{"../utils":536,"./webgl":561,"./webgl-checks":557,"./webgl-format-glsl-error":559,assert:2}],550:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _texture=require("./texture");var _texture2=_interopRequireDefault(_texture);var _buffer=require("./buffer");var _buffer2=_interopRequireDefault(_buffer);var _framebuffer=require("./framebuffer");var _framebuffer2=_interopRequireDefault(_framebuffer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Texture2D=function(_Texture){_inherits(Texture2D,_Texture);_createClass(Texture2D,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof Texture2D?object:new Texture2D(gl,{handle:object.handle||object})}},{key:"makeFromSolidColor",value:function makeFromSolidColor(gl,_ref){var _ref2=_slicedToArray(_ref,4),_ref2$=_ref2[0],r=_ref2$===undefined?0:_ref2$,_ref2$2=_ref2[1],g=_ref2$2===undefined?0:_ref2$2,_ref2$3=_ref2[2],b=_ref2$3===undefined?0:_ref2$3,_ref2$4=_ref2[3],a=_ref2$4===undefined?1:_ref2$4;return new Texture2D(gl,{pixels:new Uint8Array([r,g,b,a]),width:1,format:gl.RGBA,magFilter:gl.NEAREST,minFilter:gl.NEAREST})}},{key:"makeFromPixelArray",value:function makeFromPixelArray(gl,_ref3){var dataArray=_ref3.dataArray,format=_ref3.format,width=_ref3.width,height=_ref3.height,opts=_objectWithoutProperties(_ref3,["dataArray","format","width","height"]);var dataTypedArray=new Uint8Array(dataArray);return new Texture2D(gl,_extends({pixels:dataTypedArray,width:1,format:gl.RGBA},opts))}}]);function Texture2D(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,Texture2D);(0,_webglChecks.assertWebGLContext)(gl);var _this=_possibleConstructorReturn(this,(Texture2D.__proto__||Object.getPrototypeOf(Texture2D)).call(this,gl,_extends({},opts,{target:gl.TEXTURE_2D})));_this.width=null;_this.height=null;Object.seal(_this);_this.setImageData(opts);if(opts.generateMipmap){_this.generateMipmap()}return _this}_createClass(Texture2D,[{key:"bind",value:function bind(){var textureUnit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.textureUnit;var gl=this.gl;if(textureUnit===undefined){throw new Error("Texture.bind: must specify texture unit")}this.textureUnit=textureUnit;gl.activeTexture(gl.TEXTURE0+textureUnit);gl.bindTexture(this.target,this.handle);return textureUnit}},{key:"unbind",value:function unbind(){var gl=this.gl;if(this.textureUnit===undefined){throw new Error("Texture.unbind: texture unit not specified")}gl.activeTexture(gl.TEXTURE0+this.textureUnit);gl.bindTexture(this.target,null);return this.textureUnit}},{key:"getActiveUnit",value:function getActiveUnit(){return this.gl.getParameter(_webgl.GL.ACTIVE_TEXTURE)-_webgl.GL.TEXTURE0}},{key:"setPixels",value:function setPixels(_ref4){var buffer=_ref4.buffer,_ref4$offset=_ref4.offset,offset=_ref4$offset===undefined?0:_ref4$offset,_ref4$width=_ref4.width,width=_ref4$width===undefined?null:_ref4$width,_ref4$height=_ref4.height,height=_ref4$height===undefined?null:_ref4$height,_ref4$mipmapLevel=_ref4.mipmapLevel,mipmapLevel=_ref4$mipmapLevel===undefined?0:_ref4$mipmapLevel,_ref4$internalFormat=_ref4.internalFormat,internalFormat=_ref4$internalFormat===undefined?_webgl.GL.RGBA:_ref4$internalFormat,_ref4$format=_ref4.format,format=_ref4$format===undefined?_webgl.GL.RGBA:_ref4$format,_ref4$type=_ref4.type,type=_ref4$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref4$type,_ref4$border=_ref4.border,border=_ref4$border===undefined?0:_ref4$border,opts=_objectWithoutProperties(_ref4,["buffer","offset","width","height","mipmapLevel","internalFormat","format","type","border"]);var gl=this.gl;buffer=_buffer2.default.makeFrom(buffer);gl.bindBuffer(_webgl.GL.PIXEL_UNPACK_BUFFER,buffer.target);this.bind();gl.texImage2D(gl.TEXTURE_2D,mipmapLevel,format,width,height,border,format,type,buffer.target);this.unbind();gl.bindBuffer(_webgl.GL.GL_PIXEL_UNPACK_BUFFER,null);return this}},{key:"setImageDataFromCompressedBuffer",value:function setImageDataFromCompressedBuffer(_ref5){var buffer=_ref5.buffer,_ref5$offset=_ref5.offset,offset=_ref5$offset===undefined?0:_ref5$offset,_ref5$width=_ref5.width,width=_ref5$width===undefined?null:_ref5$width,_ref5$height=_ref5.height,height=_ref5$height===undefined?null:_ref5$height,_ref5$mipmapLevel=_ref5.mipmapLevel,mipmapLevel=_ref5$mipmapLevel===undefined?0:_ref5$mipmapLevel,_ref5$internalFormat=_ref5.internalFormat,internalFormat=_ref5$internalFormat===undefined?_webgl.GL.RGBA:_ref5$internalFormat,_ref5$format=_ref5.format,format=_ref5$format===undefined?_webgl.GL.RGBA:_ref5$format,_ref5$type=_ref5.type,type=_ref5$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref5$type,_ref5$border=_ref5.border,border=_ref5$border===undefined?0:_ref5$border,opts=_objectWithoutProperties(_ref5,["buffer","offset","width","height","mipmapLevel","internalFormat","format","type","border"]);var gl=this.gl;gl.compressedTexImage2D(this.target,mipmapLevel,internalFormat,width,height,border,buffer);return this}},{key:"copyImageFromFramebuffer",value:function copyImageFromFramebuffer(_ref6){var framebuffer=_ref6.framebuffer,_ref6$offset=_ref6.offset,offset=_ref6$offset===undefined?0:_ref6$offset,x=_ref6.x,y=_ref6.y,width=_ref6.width,height=_ref6.height,_ref6$mipmapLevel=_ref6.mipmapLevel,mipmapLevel=_ref6$mipmapLevel===undefined?0:_ref6$mipmapLevel,_ref6$internalFormat=_ref6.internalFormat,internalFormat=_ref6$internalFormat===undefined?_webgl.GL.RGBA:_ref6$internalFormat,_ref6$type=_ref6.type,type=_ref6$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref6$type,_ref6$border=_ref6.border,border=_ref6$border===undefined?0:_ref6$border,opts=_objectWithoutProperties(_ref6,["framebuffer","offset","x","y","width","height","mipmapLevel","internalFormat","type","border"]);var gl=this.gl;framebuffer=_framebuffer2.default.makeFrom(framebuffer);framebuffer.bind();this.bind();gl.copyTexImage2D(this.target,mipmapLevel,internalFormat,x,y,width,height,border);this.unbind();framebuffer.unbind()}},{key:"copySubImage",value:function copySubImage(_ref7){var pixels=_ref7.pixels,_ref7$offset=_ref7.offset,offset=_ref7$offset===undefined?0:_ref7$offset,x=_ref7.x,y=_ref7.y,width=_ref7.width,height=_ref7.height,_ref7$mipmapLevel=_ref7.mipmapLevel,mipmapLevel=_ref7$mipmapLevel===undefined?0:_ref7$mipmapLevel,_ref7$internalFormat=_ref7.internalFormat,internalFormat=_ref7$internalFormat===undefined?_webgl.GL.RGBA:_ref7$internalFormat,_ref7$type=_ref7.type,type=_ref7$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref7$type,_ref7$border=_ref7.border,border=_ref7$border===undefined?0:_ref7$border}}]);return Texture2D}(_texture2.default);exports.default=Texture2D},{"./buffer":541,"./framebuffer":544,"./texture":552,"./webgl":561,"./webgl-checks":557}],551:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _texture=require("./texture");var _texture2=_interopRequireDefault(_texture);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TextureCube=function(_Texture){_inherits(TextureCube,_Texture);_createClass(TextureCube,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof TextureCube?object:new TextureCube(gl,{handle:object.handle||object})}}]);function TextureCube(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,TextureCube);(0,_webglChecks.assertWebGLContext)(gl);var _this=_possibleConstructorReturn(this,(TextureCube.__proto__||Object.getPrototypeOf(TextureCube)).call(this,gl,_extends({},opts,{target:_webgl.GL.TEXTURE_CUBE_MAP})));_this.setCubeMapImageData(opts);return _this}_createClass(TextureCube,[{key:"bind",value:function bind(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},index=_ref.index;var gl=this.gl;if(index!==undefined){gl.activeTexture(_webgl.GL.TEXTURE0+index)}gl.bindTexture(_webgl.GL.TEXTURE_CUBE_MAP,this.handle);if(index===undefined){var result=gl.getParameter(gl.ACTIVE_TEXTURE)-_webgl.GL.TEXTURE0;return result}return index}},{key:"unbind",value:function unbind(){var gl=this.gl;gl.bindTexture(_webgl.GL.TEXTURE_CUBE_MAP,null)}},{key:"setCubeMapImageData",value:function setCubeMapImageData(_ref2){var width=_ref2.width,height=_ref2.height,pixels=_ref2.pixels,data=_ref2.data,_ref2$border=_ref2.border,border=_ref2$border===undefined?0:_ref2$border,_ref2$format=_ref2.format,format=_ref2$format===undefined?_webgl.GL.RGBA:_ref2$format,_ref2$type=_ref2.type,type=_ref2$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref2$type,_ref2$generateMipmap=_ref2.generateMipmap,generateMipmap=_ref2$generateMipmap===undefined?false:_ref2$generateMipmap,opts=_objectWithoutProperties(_ref2,["width","height","pixels","data","border","format","type","generateMipmap"]);var gl=this.gl;pixels=pixels||data;this.bind();if(this.width||this.height){gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_X,0,format,width,height,border,format,type,pixels.pos.x);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_Y,0,format,width,height,border,format,type,pixels.pos.y);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_Z,0,format,width,height,border,format,type,pixels.pos.z);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_X,0,format,width,height,border,format,type,pixels.neg.x);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,format,width,height,border,format,type,pixels.neg.y);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,format,width,height,border,format,type,pixels.neg.z)}else{gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_X,0,format,format,type,pixels.pos.x);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_Y,0,format,format,type,pixels.pos.y);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_Z,0,format,format,type,pixels.pos.z);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_X,0,format,format,type,pixels.neg.x);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,format,format,type,pixels.neg.y);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,format,format,type,pixels.neg.z)}this.unbind();if(generateMipmap){this.generateMipmap()}return this}}]);return TextureCube}(_texture2.default);exports.default=TextureCube},{"./texture":552,"./webgl":561,"./webgl-checks":557}],552:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _buffer=require("./buffer");var _buffer2=_interopRequireDefault(_buffer);var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Texture=function(){function Texture(gl,_ref){var _ref$id=_ref.id,id=_ref$id===undefined?(0,_utils.uid)("texture"):_ref$id,_ref$unpackFlipY=_ref.unpackFlipY,unpackFlipY=_ref$unpackFlipY===undefined?true:_ref$unpackFlipY,_ref$magFilter=_ref.magFilter,magFilter=_ref$magFilter===undefined?_webgl.GL.NEAREST:_ref$magFilter,_ref$minFilter=_ref.minFilter,minFilter=_ref$minFilter===undefined?_webgl.GL.NEAREST:_ref$minFilter,_ref$wrapS=_ref.wrapS,wrapS=_ref$wrapS===undefined?_webgl.GL.CLAMP_TO_EDGE:_ref$wrapS,_ref$wrapT=_ref.wrapT,wrapT=_ref$wrapT===undefined?_webgl.GL.CLAMP_TO_EDGE:_ref$wrapT,_ref$target=_ref.target,target=_ref$target===undefined?_webgl.GL.TEXTURE_2D:_ref$target,handle=_ref.handle,opts=_objectWithoutProperties(_ref,["id","unpackFlipY","magFilter","minFilter","wrapS","wrapT","target","handle"]);_classCallCheck(this,Texture);(0,_webglChecks.assertWebGLContext)(gl);this.handle=handle||gl.createTexture();this.id=id;this.gl=gl;this.target=target;this.hasFloatTexture=gl.getExtension("OES_texture_float");this.width=null;this.height=null;this.textureUnit=undefined;this.userData={};this.setPixelStorageModes(_extends({},opts,{unpackFlipY:unpackFlipY}));this.setParameters(_extends({},opts,{magFilter:magFilter,minFilter:minFilter,wrapS:wrapS,wrapT:wrapT}))}_createClass(Texture,[{key:"delete",value:function _delete(){if(this.handle){this.gl.deleteTexture(this.handle);this.handle=null}return this}},{key:"toString",value:function toString(){return"Texture("+this.id+","+this.width+"x"+this.height+")"}},{key:"generateMipmap",value:function generateMipmap(){this.gl.bindTexture(this.target,this.handle);this.gl.generateMipmap(this.target);this.gl.bindTexture(this.target,null);return this}},{key:"setImageData",value:function setImageData(_ref2){var _ref2$target=_ref2.target,target=_ref2$target===undefined?this.target:_ref2$target,_ref2$pixels=_ref2.pixels,pixels=_ref2$pixels===undefined?null:_ref2$pixels,_ref2$data=_ref2.data,data=_ref2$data===undefined?null:_ref2$data,width=_ref2.width,height=_ref2.height,_ref2$mipmapLevel=_ref2.mipmapLevel,mipmapLevel=_ref2$mipmapLevel===undefined?0:_ref2$mipmapLevel,_ref2$format=_ref2.format,format=_ref2$format===undefined?_webgl.GL.RGBA:_ref2$format,type=_ref2.type,_ref2$offset=_ref2.offset,offset=_ref2$offset===undefined?0:_ref2$offset,_ref2$border=_ref2.border,border=_ref2$border===undefined?0:_ref2$border,opts=_objectWithoutProperties(_ref2,["target","pixels","data","width","height","mipmapLevel","format","type","offset","border"]);var gl=this.gl;pixels=pixels||data;if(pixels&&pixels.data){var ndarray=pixels;pixels=ndarray.data;width=ndarray.shape[0];height=ndarray.shape[1]}gl.bindTexture(this.target,this.handle);if(pixels===null){width=width||1;height=height||1;type=type||_webgl.GL.UNSIGNED_BYTE;gl.texImage2D(target,mipmapLevel,format,width,height,border,format,type,pixels);this.width=width;this.height=height}else if(ArrayBuffer.isView(pixels)){(0,_assert2.default)(width>0&&height>0,"Texture2D: Width and height required");type=type||(0,_webgl.glTypeFromArray)(pixels);if(type===gl.FLOAT&&!this.hasFloatTexture){throw new Error("floating point textures are not supported.")}gl.texImage2D(target,mipmapLevel,format,width,height,border,format,type,pixels);this.width=width;this.height=height}else if(pixels instanceof _webgl.WebGLBuffer||pixels instanceof _buffer2.default){(0,_assert2.default)(gl instanceof _webgl.WebGL2RenderingContext,"Requires WebGL2");type=type||_webgl.GL.UNSIGNED_BYTE;var buffer=_buffer2.default.makeFrom(pixels);gl.bindBuffer(_webgl.GL.PIXEL_UNPACK_BUFFER,buffer.handle);gl.texImage2D(target,mipmapLevel,format,width,height,border,format,type,offset);gl.bindBuffer(_webgl.GL.GL_PIXEL_UNPACK_BUFFER,null);this.width=width;this.height=height;
}else{var imageSize=this._deduceImageSize(pixels);(0,_assert2.default)(width===undefined&&height===undefined,"Texture2D.setImageData: Width and height must not be provided");type=type||_webgl.GL.UNSIGNED_BYTE;gl.texImage2D(target,mipmapLevel,format,format,type,pixels);this.width=imageSize.width;this.height=imageSize.height}gl.bindTexture(this.target,null);return this}},{key:"_deduceImageSize",value:function _deduceImageSize(image){if(typeof ImageData!=="undefined"&&image instanceof ImageData){return{width:image.width,height:image.height}}else if(typeof HTMLImageElement!=="undefined"&&image instanceof HTMLImageElement){return{width:image.naturalWidth,height:image.naturalHeight}}else if(typeof HTMLCanvasElement!=="undefined"&&image instanceof HTMLCanvasElement){return{width:image.width,height:image.height}}else if(typeof HTMLVideoElement!=="undefined"&&image instanceof HTMLVideoElement){return{width:image.videoWidth,height:image.videoHeight}}throw new Error("Unknown image data format. Failed to deduce image size")}},{key:"setPixelStorageModes",value:function setPixelStorageModes(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},packAlignment=_ref3.packAlignment,unpackAlignment=_ref3.unpackAlignment,unpackFlipY=_ref3.unpackFlipY,unpackPremultiplyAlpha=_ref3.unpackPremultiplyAlpha,unpackColorspaceConversion=_ref3.unpackColorspaceConversion,packRowLength=_ref3.packRowLength,packSkipPixels=_ref3.packSkipPixels,packSkipRows=_ref3.packSkipRows,unpackRowLength=_ref3.unpackRowLength,unpackImageHeight=_ref3.unpackImageHeight,unpackSkipPixels=_ref3.unpackSkipPixels,unpackSkipRows=_ref3.unpackSkipRows,unpackSkipImages=_ref3.unpackSkipImages;var gl=this.gl;gl.bindTexture(this.target,this.handle);if(packAlignment){gl.pixelStorei(gl.PACK_ALIGNMENT,packAlignment)}if(unpackAlignment){gl.pixelStorei(gl.UNPACK_ALIGNMENT,unpackAlignment)}if(unpackFlipY){gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,unpackFlipY)}if(unpackPremultiplyAlpha){gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,unpackPremultiplyAlpha)}if(unpackColorspaceConversion){gl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,unpackColorspaceConversion)}if(packRowLength){gl.pixelStorei(gl.PACK_ROW_LENGTH,packRowLength)}if(packSkipPixels){gl.pixelStorei(gl.PACK_SKIP_PIXELS,packSkipPixels)}if(packSkipRows){gl.pixelStorei(gl.PACK_SKIP_ROWS,packSkipRows)}if(unpackRowLength){gl.pixelStorei(gl.UNPACK_ROW_LENGTH,unpackRowLength)}if(unpackImageHeight){gl.pixelStorei(gl.UNPACK_IMAGE_HEIGHT,unpackImageHeight)}if(unpackSkipPixels){gl.pixelStorei(gl.UNPACK_SKIP_PIXELS,unpackSkipPixels)}if(unpackSkipRows){gl.pixelStorei(gl.UNPACK_SKIP_ROWS,unpackSkipRows)}if(unpackSkipImages){gl.pixelStorei(gl.UNPACK_SKIP_IMAGES,unpackSkipImages)}gl.bindTexture(this.target,null);return this}},{key:"setParameters",value:function setParameters(_ref4){var magFilter=_ref4.magFilter,minFilter=_ref4.minFilter,wrapS=_ref4.wrapS,wrapT=_ref4.wrapT,wrapR=_ref4.wrapR,baseLevel=_ref4.baseLevel,maxLevel=_ref4.maxLevel,minLOD=_ref4.minLOD,maxLOD=_ref4.maxLOD,compareFunc=_ref4.compareFunc,compareMode=_ref4.compareMode;var gl=this.gl;gl.bindTexture(this.target,this.handle);if(magFilter){gl.texParameteri(this.target,gl.TEXTURE_MAG_FILTER,magFilter)}if(minFilter){gl.texParameteri(this.target,gl.TEXTURE_MIN_FILTER,minFilter)}if(wrapS){gl.texParameteri(this.target,gl.TEXTURE_WRAP_S,wrapS)}if(wrapT){gl.texParameteri(this.target,gl.TEXTURE_WRAP_T,wrapT)}if(wrapR){gl.texParameteri(this.target,gl.TEXTURE_WRAP_R,wrapR)}if(baseLevel){gl.texParameteri(this.target,gl.TEXTURE_BASE_LEVEL,baseLevel)}if(maxLevel){gl.texParameteri(this.target,gl.TEXTURE_MAX_LEVEL,maxLevel)}if(compareFunc){gl.texParameteri(this.target,gl.TEXTURE_COMPARE_FUNC,compareFunc)}if(compareMode){gl.texParameteri(this.target,gl.TEXTURE_COMPARE_MODE,compareMode)}if(minLOD){gl.texParameterf(this.target,gl.TEXTURE_MIN_LOD,minLOD)}if(maxLOD){gl.texParameterf(this.target,gl.TEXTURE_MAX_LOD,maxLOD)}gl.bindTexture(this.target,null);return this}},{key:"getParameters",value:function getParameters(){var gl=this.gl;gl.bindTexture(this.target,this.handle);var webglParams={magFilter:gl.getTexParameter(this.target,gl.TEXTURE_MAG_FILTER),minFilter:gl.getTexParameter(this.target,gl.TEXTURE_MIN_FILTER),wrapS:gl.getTexParameter(this.target,gl.TEXTURE_WRAP_S),wrapT:gl.getTexParameter(this.target,gl.TEXTURE_WRAP_T)};gl.bindTexture(this.target,null);return webglParams}},{key:"image2D",value:function image2D(_ref5){var pixels=_ref5.pixels,_ref5$format=_ref5.format,format=_ref5$format===undefined?_webgl.GL.RGBA:_ref5$format,_ref5$type=_ref5.type,type=_ref5$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref5$type;if(type===_webgl.GL.FLOAT&&!this.hasFloatTexture){throw new Error("floating point textures are not supported.")}this.gl.bindTexture(this.target,this.handle);this.gl.texImage2D(_webgl.GL.TEXTURE_2D,0,format,format,type,pixels);this.gl.bindTexture(this.target,null);return this}},{key:"update",value:function update(opts){throw new Error("Texture.update() is deprecated()")}}]);return Texture}();exports.default=Texture},{"../utils":536,"./buffer":541,"./webgl":561,"./webgl-checks":557,assert:2}],553:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webglChecks=require("../webgl/webgl-checks");var _queryManager=require("./helpers/query-manager");var _queryManager2=_interopRequireDefault(_queryManager);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var GL_QUERY_COUNTER_BITS_EXT=34916;var GL_QUERY_RESULT_EXT=34918;var GL_QUERY_RESULT_AVAILABLE_EXT=34919;var GL_TIME_ELAPSED_EXT=35007;var GL_TIMESTAMP_EXT=36392;var GL_GPU_DISJOINT_EXT=36795;var noop=function noop(x){return x};var ERR_GPU_DISJOINT="Disjoint GPU operation invalidated timer queries";var ERR_TIMER_QUERY_NOT_SUPPORTED='Timer queries require "EXT_disjoint_timer_query" extension';var TimerQuery=function(){_createClass(TimerQuery,null,[{key:"isSupported",value:function isSupported(gl){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref$requireTimestamp=_ref.requireTimestamps,requireTimestamps=_ref$requireTimestamp===undefined?false:_ref$requireTimestamp;(0,_webglChecks.assertWebGLContext)(gl);var ext=gl.getExtension("EXT_disjoint_timer_query");var queryCounterBits=ext?ext.getQueryEXT(GL_TIMESTAMP_EXT,GL_QUERY_COUNTER_BITS_EXT):0;var timestampsSupported=queryCounterBits>0;return Boolean(ext)&&(!requireTimestamps||timestampsSupported)}}]);function TimerQuery(gl){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref2$onComplete=_ref2.onComplete,onComplete=_ref2$onComplete===undefined?noop:_ref2$onComplete,_ref2$onError=_ref2.onError,onError=_ref2$onError===undefined?noop:_ref2$onError;_classCallCheck(this,TimerQuery);(0,_webglChecks.assertWebGLContext)(gl);this.gl=gl;this.ext=this.gl.getExtension("EXT_disjoint_timer_query");this.handle=this.ext?this.ext.createQueryEXT():null;this.target=null;this.userData={};this.onComplete=onComplete;this.onError=onError;this.promise=null;Object.seal(this)}_createClass(TimerQuery,[{key:"delete",value:function _delete(){if(this.handle){_queryManager2.default.deleteQuery(this);this.ext.deleteQueryEXT(this.handle);(0,_webglChecks.glCheckError)(this.gl);this.handle=null}return this}},{key:"begin",value:function begin(){_queryManager2.default.beginQuery(this,this.onComplete,this.onError);if(this.ext){this.target=GL_TIME_ELAPSED_EXT;this.ext.beginQueryEXT(this.target,this.handle)}else{_queryManager2.default.rejectQuery(this,ERR_TIMER_QUERY_NOT_SUPPORTED)}return this}},{key:"end",value:function end(){if(this.target){this.ext.endQueryEXT(this.target);this.target=null}return this}},{key:"timestamp",value:function timestamp(){_queryManager2.default.beginQuery(this,this.onComplete,this.onError);if(this.ext){this.ext.queryCounterEXT(this.handle,GL_TIMESTAMP_EXT)}else{_queryManager2.default.rejectQuery(this,ERR_TIMER_QUERY_NOT_SUPPORTED)}return this}},{key:"cancel",value:function cancel(){this.end();_queryManager2.default.cancelQuery(this);return this}},{key:"isResultAvailable",value:function isResultAvailable(){return this.ext&&this.ext.getQueryObjectEXT(this.handle,GL_QUERY_RESULT_AVAILABLE_EXT)}},{key:"getResult",value:function getResult(){return this.ext?this.ext.getQueryObjectEXT(this.handle,GL_QUERY_RESULT_EXT)/1e6:0}}]);return TimerQuery}();exports.default=TimerQuery;_queryManager2.default.setInvalidator({queryType:TimerQuery,errorMessage:ERR_GPU_DISJOINT,checkInvalid:function checkInvalid(gl){return gl.getParameter(GL_GPU_DISJOINT_EXT)}})},{"../webgl/webgl-checks":557,"./helpers/query-manager":545}],554:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _UNIFORM_BASE_DESCRIP;exports.parseUniformName=parseUniformName;exports.getUniformSetter=getUniformSetter;exports.checkUniformValues=checkUniformValues;exports.getUniformsTable=getUniformsTable;var _webgl=require("./webgl");var _texture=require("./texture");var _texture2=_interopRequireDefault(_texture);var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var UNIFORM_BASE_DESCRIPTORS=(_UNIFORM_BASE_DESCRIP={},_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT,{function:"uniform1f",type:Float32Array}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.INT,{function:"uniform1i",type:Uint16Array}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.BOOL,{function:"uniform1i",type:Uint16Array}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_VEC2,{function:"uniform2fv",type:Float32Array,elements:2}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_VEC3,{function:"uniform3fv",type:Float32Array,elements:3}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_VEC4,{function:"uniform4fv",type:Float32Array,elements:4}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.INT_VEC2,{function:"uniform2iv",type:Uint16Array,elements:2}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.INT_VEC3,{function:"uniform3iv",type:Uint16Array,elements:3}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.INT_VEC4,{function:"uniform4iv",type:Uint16Array,elements:4}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.BOOL_VEC2,{function:"uniform2iv",type:Uint16Array,elements:2}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.BOOL_VEC3,{function:"uniform3fv",type:Uint16Array,elements:3}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.BOOL_VEC4,{function:"uniform4iv",type:Uint16Array,elements:4}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_MAT2,{function:"uniformMatrix2fv",type:Float32Array,matrix:true,elements:4}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_MAT3,{mfunction:"uniformMatrix3fv",type:Float32Array,matrix:true,elements:9}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_MAT4,{function:"uniformMatrix4fv",type:Float32Array,matrix:true,elements:16}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.SAMPLER_2D,{function:"uniform1i",type:Uint16Array,texture:true}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.SAMPLER_CUBE,{function:"uniform1i",type:Uint16Array,texture:true}),_UNIFORM_BASE_DESCRIP);function parseUniformName(name){var UNIFORM_NAME_REGEXP=/([^\[]*)(\[[0-9]+\])?/;var matches=name.match(UNIFORM_NAME_REGEXP);if(!matches||matches.length<2){throw new Error("Failed to parse GLSL uniform name "+name)}return{name:matches[1],length:matches[2]||1,isArray:Boolean(matches[2])}}function getUniformSetter(gl,location,info){var descriptor=UNIFORM_BASE_DESCRIPTORS[info.type];if(!descriptor){throw new Error("Unknown GLSL uniform type "+info.type)}var glFunction=gl[descriptor.function].bind(gl);var TypedArray=descriptor.type;var flatArrayLength=info.size*(descriptor.elements||1);var setter=void 0;if(flatArrayLength>1){setter=function setter(val){if(!(val instanceof TypedArray)){var typedArray=new TypedArray(flatArrayLength);typedArray.set(val);val=typedArray}(0,_assert2.default)(val.length===flatArrayLength);if(descriptor.matrix){glFunction(location,false,val)}else{glFunction(location,val)}}}else{setter=function setter(val){return glFunction(location,val)}}return setter}function checkUniformValues(uniforms,source){for(var uniformName in uniforms){var value=uniforms[uniformName];if(!checkUniformValue(value)){source=source?source+" ":"";console.error(source+" Bad uniform "+uniformName,value);throw new Error(source+" Bad uniform "+uniformName)}}return true}function checkUniformValue(value){var ok=true;if(value instanceof _texture2.default){ok=true}else if(Array.isArray(value)){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=value[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var element=_step.value;if(!isFinite(element)){ok=false}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}ok=ok&&value.length>0}else if(ArrayBuffer.isView(value)){ok=value.length>0}else if(!isFinite(value)){ok=false}return ok}function getUniformsTable(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$header=_ref.header,header=_ref$header===undefined?"Uniforms":_ref$header,program=_ref.program,uniforms=_ref.uniforms;(0,_assert2.default)(program);var uniformLocations=program._uniformSetters;var table=_defineProperty({},header,{});for(var uniformName in uniformLocations){var uniform=uniforms[uniformName];if(uniform!==undefined){table[uniformName]={Type:uniform,Value:(0,_utils.formatValue)(uniform)}}}for(var _uniformName in uniformLocations){var _uniform=uniforms[_uniformName];if(_uniform===undefined){table[_uniformName]={Type:"NOT PROVIDED",Value:"N/A"}}}var unusedTable={};var unusedCount=0;for(var _uniformName2 in uniforms){var _uniform2=uniforms[_uniformName2];if(!table[_uniformName2]){unusedCount++;unusedTable[_uniformName2]={Type:"NOT USED: "+_uniform2,Value:(0,_utils.formatValue)(_uniform2)}}}return{table:table,unusedTable:unusedTable,unusedCount:unusedCount}}},{"../utils":536,"./texture":552,"./webgl":561,assert:2}],555:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getMaxAttributes=getMaxAttributes;exports.hasDivisor=hasDivisor;exports.isEnabled=isEnabled;exports.getBuffer=getBuffer;exports.getGeneric=getGeneric;exports.getSize=getSize;exports.getType=getType;exports.isNormalized=isNormalized;exports.isInteger=isInteger;exports.getStride=getStride;exports.getOffset=getOffset;exports.enable=enable;exports.disable=disable;exports.setDivisor=setDivisor;exports.getDivisor=getDivisor;exports.setBuffer=setBuffer;exports.setGeneric=setGeneric;exports.setGenericValues=setGenericValues;var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _buffer=require("./buffer");var _buffer2=_interopRequireDefault(_buffer);var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function glGetLumaInfo(gl){if(!gl.luma){gl.luma={extensions:{}}}if(gl.luma.extensions["ANGLE_instanced_arrays"]===undefined){gl.luma.extensions["ANGLE_instanced_arrays"]=gl.getExtension("ANGLE_instanced_arrays")}return gl.luma}function getMaxAttributes(gl){(0,_webglChecks.assertWebGLContext)(gl);return gl.getParameter(gl.MAX_VERTEX_ATTRIBS)}function hasDivisor(gl){(0,_webglChecks.assertWebGLContext)(gl);return Boolean((0,_webglChecks.isWebGL2Context)(gl)||gl.getExtension(gl,"ANGLE_instanced_arrays"))}function isEnabled(gl,location){return Boolean(get(gl,location,gl.VERTEX_ATTRIB_ARRAY_ENABLED))}function getBuffer(gl,location){return get(gl,location,gl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING)}function getGeneric(gl,location){return get(gl,gl.CURRENT_VERTEX_ATTRIB)}function getSize(gl,location){return get(location,gl.VERTEX_ATTRIB_ARRAY_SIZE)}function getType(gl,location){return get(location,gl.VERTEX_ATTRIB_ARRAY_TYPE)}function isNormalized(gl,location){return get(location,gl.VERTEX_ATTRIB_ARRAY_NORMALIZED)}function isInteger(gl,location){(0,_webglChecks.assertWebGL2Context)(gl);return get(location,gl.VERTEX_ATTRIB_ARRAY_INTEGER)}function getStride(gl,location){return get(location,gl.VERTEX_ATTRIB_ARRAY_STRIDE)}function getOffset(gl,location){var pname=arguments.length>2&&arguments[2]!==undefined?arguments[2]:gl.VERTEX_ATTRIB_ARRAY_POINTER;return gl.getVertexAttribOffset(location,pname)}function get(gl,location,pname){(0,_webglChecks.assertWebGLContext)(gl);return gl.getVertexAttrib(location,pname)}function enable(gl,location){gl.enableVertexAttribArray(location)}function disable(gl,location){if(location>0){gl.disableVertexAttribArray(location)}}function setDivisor(gl,location,divisor){if((0,_webglChecks.isWebGL2Context)(gl)){gl.vertexAttribDivisor(location,divisor);return}var ext=glGetLumaInfo(gl).extensions["ANGLE_instanced_arrays"];if(ext){ext.vertexAttribDivisorANGLE(location,divisor);return}if(divisor!==0){throw new Error("WebGL instanced rendering not supported")}}function getDivisor(gl,location){(0,_assert2.default)(location>0);if((0,_webglChecks.isWebGL2Context)(gl)){var divisor=get(location,gl.VERTEX_ATTRIB_ARRAY_DIVISOR);return divisor}var ext=glGetLumaInfo(gl).extensions["ANGLE_instanced_arrays"];if(ext){var _divisor=get(location,ext.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE);return _divisor}return 0}function setBuffer(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},gl=_ref.gl,location=_ref.location,buffer=_ref.buffer,target=_ref.target,layout=_ref.layout;(0,_webglChecks.assertWebGLContext)(gl);buffer=_buffer2.default.makeFrom(gl,buffer);target=(0,_webgl.glGet)(target!==undefined?target:buffer.target);layout=layout!==undefined?layout:buffer.layout;(0,_assert2.default)(target,"setBuffer needs target");(0,_assert2.default)(layout,"setBuffer called on uninitialized buffer");buffer.bind({target:gl.ARRAY_BUFFER});if(!layout.integer){gl.vertexAttribPointer(location,layout.size,(0,_webgl.glGet)(layout.type),layout.normalized,layout.stride,layout.offset)}else{(0,_webglChecks.assertWebGL2Context)(gl);gl.vertexAttribIPointer(location,layout.size,(0,_webgl.glGet)(layout.type),layout.stride,layout.offset)}buffer.unbind({target:gl.ARRAY_BUFFER})}function setGeneric(_ref2){var gl=_ref2.gl,location=_ref2.location,array=_ref2.array;_utils.log.warn(0,"VertexAttributes.setGeneric is not well tested");if(array instanceof Float32Array){gl.vertexAttrib4fv(location,array)}else if(array instanceof Int32Array){(0,_webglChecks.assertWebGL2Context)(gl);gl.vertexAttribI4iv(location,array)}else if(array instanceof Uint32Array){(0,_webglChecks.assertWebGL2Context)(gl);gl.vertexAttribI4uiv(location,array)}}function setGenericValues(gl,location,v0,v1,v2,v3){_utils.log.warn(0,"VertexAttributes.setGenericValues is not well tested");switch(arguments.length-1){case 1:gl.vertexAttrib1f(location,v0);break;case 2:gl.vertexAttrib2f(location,v0,v1);break;case 3:gl.vertexAttrib3f(location,v0,v1,v2);break;case 4:gl.vertexAttrib4f(location,v0,v1,v2,v3);break;default:throw new Error("vertex attribute size must be between 1 and 4")}}},{"../utils":536,"./buffer":541,"./webgl":561,"./webgl-checks":557,assert:2}],556:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.glArrayFromType=undefined;exports.glTypeFromArray=glTypeFromArray;exports.glTypeToArray=glTypeToArray;var _webglConstants=require("./webgl-constants");var _webglConstants2=_interopRequireDefault(_webglConstants);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function glTypeFromArray(arrayOrType){var type=ArrayBuffer.isView(arrayOrType)?arrayOrType.constructor:arrayOrType;switch(type){case Float32Array:return _webglConstants2.default.FLOAT;case Uint16Array:return _webglConstants2.default.UNSIGNED_SHORT;case Uint32Array:return _webglConstants2.default.UNSIGNED_INT;case Uint8Array:return _webglConstants2.default.UNSIGNED_BYTE;case Uint8ClampedArray:return _webglConstants2.default.UNSIGNED_BYTE;case Int8Array:return _webglConstants2.default.BYTE;case Int16Array:return _webglConstants2.default.SHORT;case Int32Array:return _webglConstants2.default.INT;default:throw new Error("Failed to deduce type from array/array type")}}function glTypeToArray(glType){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref$clamped=_ref.clamped,clamped=_ref$clamped===undefined?true:_ref$clamped;switch(glType){case _webglConstants2.default.FLOAT:return Float32Array;case _webglConstants2.default.UNSIGNED_SHORT:case _webglConstants2.default.UNSIGNED_SHORT_5_6_5:case _webglConstants2.default.UNSIGNED_SHORT_4_4_4_4:case _webglConstants2.default.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;case _webglConstants2.default.UNSIGNED_INT:return Uint32Array;case _webglConstants2.default.UNSIGNED_BYTE:return clamped?Uint8ClampedArray:Uint8Array;case _webglConstants2.default.BYTE:return Int8Array;case _webglConstants2.default.SHORT:return Int16Array;case _webglConstants2.default.INT:return Int32Array;default:throw new Error("Failed to deduce type from array")}}exports.glArrayFromType=glTypeToArray},{"./webgl-constants":558}],557:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.GL_BUFFER_USAGE=exports.GL_TARGETS=exports.GL_DRAW_MODES=exports.GL_INDEX_TYPES=undefined;exports.isWebGLContext=isWebGLContext;exports.isWebGL2Context=isWebGL2Context;exports.assertWebGLContext=assertWebGLContext;exports.assertWebGL2Context=assertWebGL2Context;exports.isIndexType=isIndexType;exports.assertIndexType=assertIndexType;exports.isDrawMode=isDrawMode;exports.assertDrawMode=assertDrawMode;exports.assertArrayTypeMatch=assertArrayTypeMatch;exports.glGetError=glGetError;exports.glCheckError=glCheckError;var _webglTypes=require("./webgl-types");var _webglConstants=require("./webgl-constants");var _webglConstants2=_interopRequireDefault(_webglConstants);var _webglArrays=require("./webgl-arrays");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ERR_CONTEXT="Invalid WebGLRenderingContext";var ERR_WEBGL2="Requires WebGL2";function isWebGLContext(gl){return gl instanceof _webglTypes.WebGLRenderingContext||gl&&gl.ARRAY_BUFFER===34962}function isWebGL2Context(gl){return gl instanceof _webglTypes.WebGL2RenderingContext||gl&&gl.TEXTURE_BINDING_3D===32874}function assertWebGLContext(gl){(0,_assert2.default)(isWebGLContext(gl),ERR_CONTEXT)}function assertWebGL2Context(gl){(0,_assert2.default)(isWebGL2Context(gl),ERR_WEBGL2)}var GL_INDEX_TYPES=exports.GL_INDEX_TYPES=[_webglConstants2.default.UNSIGNED_BYTE,_webglConstants2.default.UNSIGNED_SHORT,_webglConstants2.default.UNSIGNED_INT];function isIndexType(type){return GL_INDEX_TYPES.indexOf(type)!==-1}function assertIndexType(glType,source){(0,_assert2.default)(isIndexType(glType),"Bad index type "+(0,_webglConstants.glKey)(glType)+" "+source)}var GL_DRAW_MODES=exports.GL_DRAW_MODES=[_webglConstants2.default.POINTS,_webglConstants2.default.LINE_STRIP,_webglConstants2.default.LINE_LOOP,_webglConstants2.default.LINES,_webglConstants2.default.TRIANGLE_STRIP,_webglConstants2.default.TRIANGLE_FAN,_webglConstants2.default.TRIANGLES];function isDrawMode(glMode){return GL_DRAW_MODES.indexOf(glMode)!==-1}function assertDrawMode(glType,source){(0,_assert2.default)(isDrawMode(glType),"Bad draw mode "+(0,_webglConstants.glKey)(glType)+" "+source)}var GL_TARGETS=exports.GL_TARGETS=[_webglConstants2.default.ARRAY_BUFFER,_webglConstants2.default.ELEMENT_ARRAY_BUFFER,_webglConstants2.default.COPY_READ_BUFFER,_webglConstants2.default.COPY_WRITE_BUFFER,_webglConstants2.default.TRANSFORM_FEEDBACK_BUFFER,_webglConstants2.default.UNIFORM_BUFFER,_webglConstants2.default.PIXEL_PACK_BUFFER,_webglConstants2.default.PIXEL_UNPACK_BUFFER];var GL_BUFFER_USAGE=exports.GL_BUFFER_USAGE=[_webglConstants2.default.STATIC_DRAW,_webglConstants2.default.DYNAMIC_DRAW,_webglConstants2.default.STREAM_DRAW,_webglConstants2.default.STATIC_READ,_webglConstants2.default.DYNAMIC_READ,_webglConstants2.default.STREAM_READ,_webglConstants2.default.STATIC_COPY,_webglConstants2.default.DYNAMIC_COPY,_webglConstants2.default.STREAM_COPY];function assertArrayTypeMatch(array,type,source){(0,_assert2.default)(type===(0,_webglArrays.glTypeFromArray)(array),(array.constructor.name||"Array")+" "+("does not match element type "+(0,_webglConstants.glKey)(type)+" "+source))}function glGetError(gl){var errorStack=[];var glError=gl.getError();while(glError!==gl.NO_ERROR){errorStack.push(glGetErrorMessage(gl,glError));glError=gl.getError()}return errorStack.length?new Error(errorStack.join("\n")):null}function glCheckError(gl){if(gl.debug){var error=glGetError(gl);if(error){throw error}}}function glGetErrorMessage(gl,glError){switch(glError){case _webglConstants2.default.CONTEXT_LOST_WEBGL:return"WebGL context lost";case _webglConstants2.default.INVALID_ENUM:return"WebGL invalid enumerated argument";case _webglConstants2.default.INVALID_VALUE:return"WebGL invalid value";case _webglConstants2.default.INVALID_OPERATION:return"WebGL invalid operation";case _webglConstants2.default.INVALID_FRAMEBUFFER_OPERATION:return"WebGL invalid framebuffer operation";case _webglConstants2.default.OUT_OF_MEMORY:return"WebGL out of memory";default:return"WebGL unknown error "+glError}}},{"./webgl-arrays":556,"./webgl-constants":558,"./webgl-types":560,assert:2}],558:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.GL=undefined;exports.glGet=glGet;exports.glKey=glKey;var _glConstants=require("gl-constants");var _glConstants2=_interopRequireDefault(_glConstants);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.GL=_glConstants2.default;exports.default=_glConstants2.default;function glGet(name){var value=name;if(typeof name==="string"){value=_glConstants2.default[name];(0,_assert2.default)(value!==undefined,"Accessing GL."+name)}return value}function glKey(value){for(var key in _glConstants2.default){if(_glConstants2.default[key]===value){return"GL."+key}}return String(value)}},{assert:2,"gl-constants":437}],559:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getShaderName=getShaderName;exports.default=formatGLSLCompilerError;var _webglConstants=require("./webgl-constants");var _webglConstants2=_interopRequireDefault(_webglConstants);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getShaderName(shader){return"unnamed"}function formatGLSLCompilerError(errLog,src,shaderType){var errorStrings=errLog.split(/\r?\n/);var errors={};for(var i=0;i<errorStrings.length;i++){var errorString=errorStrings[i];if(errorString.length<=1){continue}var lineNo=parseInt(errorString.split(":")[2],10);if(isNaN(lineNo)){return"Could not parse GLSL compiler error: "+errLog}errors[lineNo]=errorString}var message="";var lines=addLineNumbers(src).split(/\r?\n/);for(var _i=0;_i<lines.length;_i++){var line=lines[_i];if(!errors[_i+3]&&!errors[_i+2]&&!errors[_i+1]){continue}message+=line+"\n";if(errors[_i+1]){var e=errors[_i+1];e=e.substr(e.split(":",3).join(":").length+1).trim();message+="^^^ "+e+"\n\n"}}var name=getShaderName(src)||"unknown name";var type=getShaderTypeName(shaderType);return"GLSL error in "+type+" shader "+name+"\n"+message}function addLineNumbers(string){var start=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var delim=arguments.length>2&&arguments[2]!==undefined?arguments[2]:": ";var lines=string.split(/\r?\n/);var maxDigits=String(lines.length+start-1).length;return lines.map(function(line,i){var lineNumber=i+start;var digits=String(lineNumber).length;var prefix=padLeft(lineNumber,maxDigits-digits);return prefix+delim+line}).join("\n")}function padLeft(string,digits){var result="";for(var i=0;i<digits;++i){result+=" "}return""+result+string}function getShaderTypeName(type){switch(type){case _webglConstants2.default.FRAGMENT_SHADER:return"fragment";case _webglConstants2.default.VERTEX_SHADER:return"vertex";default:return"unknown type"}}},{"./webgl-constants":558}],560:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.WebGL2RenderingContext=exports.WebGLShaderPrecisionFormat=exports.WebGLActiveInfo=exports.WebGLUniformLocation=exports.WebGLTexture=exports.WebGLRenderbuffer=exports.WebGLFramebuffer=exports.WebGLBuffer=exports.WebGLShader=exports.WebGLProgram=exports.WebGLRenderingContext=exports.Image=exports.webGLTypesAvailable=undefined;var _globals=require("../globals");var _globals2=_interopRequireDefault(_globals);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var global=_globals2.default.global;var DummyType=function DummyType(){_classCallCheck(this,DummyType)};var _ref=_globals2.default.globals.headlessTypes||global,_ref$WebGLRenderingCo=_ref.WebGLRenderingContext,WebGLRenderingContext=_ref$WebGLRenderingCo===undefined?DummyType:_ref$WebGLRenderingCo,_ref$WebGLProgram=_ref.WebGLProgram,WebGLProgram=_ref$WebGLProgram===undefined?DummyType:_ref$WebGLProgram,_ref$WebGLShader=_ref.WebGLShader,WebGLShader=_ref$WebGLShader===undefined?DummyType:_ref$WebGLShader,_ref$WebGLBuffer=_ref.WebGLBuffer,WebGLBuffer=_ref$WebGLBuffer===undefined?DummyType:_ref$WebGLBuffer,_ref$WebGLFramebuffer=_ref.WebGLFramebuffer,WebGLFramebuffer=_ref$WebGLFramebuffer===undefined?DummyType:_ref$WebGLFramebuffer,_ref$WebGLRenderbuffe=_ref.WebGLRenderbuffer,WebGLRenderbuffer=_ref$WebGLRenderbuffe===undefined?DummyType:_ref$WebGLRenderbuffe,_ref$WebGLTexture=_ref.WebGLTexture,WebGLTexture=_ref$WebGLTexture===undefined?DummyType:_ref$WebGLTexture,_ref$WebGLUniformLoca=_ref.WebGLUniformLocation,WebGLUniformLocation=_ref$WebGLUniformLoca===undefined?DummyType:_ref$WebGLUniformLoca,_ref$WebGLActiveInfo=_ref.WebGLActiveInfo,WebGLActiveInfo=_ref$WebGLActiveInfo===undefined?DummyType:_ref$WebGLActiveInfo,_ref$WebGLShaderPreci=_ref.WebGLShaderPrecisionFormat,WebGLShaderPrecisionFormat=_ref$WebGLShaderPreci===undefined?DummyType:_ref$WebGLShaderPreci;var webGLTypesAvailable=exports.webGLTypesAvailable=WebGLRenderingContext!==DummyType&&WebGLProgram!==DummyType&&WebGLShader!==DummyType&&WebGLBuffer!==DummyType&&WebGLFramebuffer!==DummyType&&WebGLRenderbuffer!==DummyType&&WebGLTexture!==DummyType&&WebGLUniformLocation!==DummyType&&WebGLActiveInfo!==DummyType&&WebGLShaderPrecisionFormat!==DummyType;function getWebGL2RenderingContext(){var WebGL2RenderingContextNotSupported=function WebGL2RenderingContextNotSupported(){
_classCallCheck(this,WebGL2RenderingContextNotSupported)};return global.WebGL2RenderingContext||WebGL2RenderingContextNotSupported}function getImage(){var ImageNotSupported=function ImageNotSupported(){_classCallCheck(this,ImageNotSupported)};return global.Image||ImageNotSupported}var WebGL2RenderingContext=getWebGL2RenderingContext();var Image=getImage();exports.Image=Image;exports.WebGLRenderingContext=WebGLRenderingContext;exports.WebGLProgram=WebGLProgram;exports.WebGLShader=WebGLShader;exports.WebGLBuffer=WebGLBuffer;exports.WebGLFramebuffer=WebGLFramebuffer;exports.WebGLRenderbuffer=WebGLRenderbuffer;exports.WebGLTexture=WebGLTexture;exports.WebGLUniformLocation=WebGLUniformLocation;exports.WebGLActiveInfo=WebGLActiveInfo;exports.WebGLShaderPrecisionFormat=WebGLShaderPrecisionFormat;exports.WebGL2RenderingContext=WebGL2RenderingContext},{"../globals":504}],561:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _webglTypes=require("./webgl-types");Object.keys(_webglTypes).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _webglTypes[key]}})});var _webglArrays=require("./webgl-arrays");Object.keys(_webglArrays).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _webglArrays[key]}})});var _webglConstants=require("./webgl-constants");Object.keys(_webglConstants).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _webglConstants[key]}})});Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_webglConstants).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./webgl-arrays":556,"./webgl-constants":558,"./webgl-types":560}],562:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _vertexArrayObject=require("./vertex-array-object");Object.defineProperty(exports,"VertexArrayObject",{enumerable:true,get:function get(){return _interopRequireDefault(_vertexArrayObject).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./vertex-array-object":563}],563:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.isVertexArray=isVertexArray;var _webglTypes=require("../webgl/webgl-types");var _webglChecks=require("../webgl/webgl-checks");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var OES_vertex_array_object="OES_vertex_array_object";var VertexArrayObject=function(){_createClass(VertexArrayObject,null,[{key:"isSupported",value:function isSupported(gl){(0,_webglChecks.assertWebGLContext)(gl);return gl instanceof _webglTypes.WebGL2RenderingContext||gl.getExtension("OES_vertex_array_object")}},{key:"wrap",value:function wrap(gl,object){return object instanceof VertexArrayObject?object:new VertexArrayObject(gl,{handle:object.handle||object})}}]);function VertexArrayObject(gl){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},handle=_ref.handle;_classCallCheck(this,VertexArrayObject);(0,_webglChecks.assertWebGLContext)(gl);(0,_assert2.default)(VertexArrayObject.isSupported(gl),"VertexArrayObject: WebGL2 or OES_vertex_array_object required");handle=handle||createVertexArray(gl);if(!handle){throw new Error("Could not create VertexArrayObject")}this.gl=gl;this.handle=handle;this.userData={};Object.seal(this)}_createClass(VertexArrayObject,[{key:"delete",value:function _delete(){deleteVertexArray(this.gl,this.handle);return this}},{key:"bind",value:function bind(){bindVertexArray(this.gl,this.handle);return this}},{key:"unbind",value:function unbind(){bindVertexArray(this.gl,null);return this}}]);return VertexArrayObject}();exports.default=VertexArrayObject;function createVertexArray(gl){if(gl instanceof _webglTypes.WebGL2RenderingContext){return gl.createVertexArray()}var ext=gl.getExtension(OES_vertex_array_object);if(ext){return ext.createVertexArrayOES()}return null}function deleteVertexArray(gl,vertexArray){if(gl instanceof _webglTypes.WebGL2RenderingContext){gl.deleteVertexArray(vertexArray)}var ext=gl.getExtension(OES_vertex_array_object);if(ext){ext.deleteVertexArrayOES(vertexArray)}}function isVertexArray(gl,vertexArray){if(gl instanceof _webglTypes.WebGL2RenderingContext){return gl.isVertexArray(vertexArray)}var ext=gl.getExtension(OES_vertex_array_object);if(ext){return ext.isVertexArrayOES(vertexArray)}return false}function bindVertexArray(gl,vertexArray){if(gl instanceof _webglTypes.WebGL2RenderingContext){gl.bindVertexArray(vertexArray)}var ext=gl.getExtension(OES_vertex_array_object);if(ext){ext.bindVertexArrayOES(vertexArray)}}},{"../webgl/webgl-checks":557,"../webgl/webgl-types":560,assert:2}],564:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Fx=exports.Shaders=undefined;var _webgl=require("./webgl");Object.keys(_webgl).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _webgl[key]}})});var _webgl2=require("./webgl2");Object.keys(_webgl2).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _webgl2[key]}})});var _math=require("./math");Object.keys(_math).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _math[key]}})});var _scenegraph=require("./scenegraph");Object.keys(_scenegraph).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _scenegraph[key]}})});var _core=require("./core");Object.keys(_core).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _core[key]}})});var _geometry=require("./geometry");Object.keys(_geometry).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _geometry[key]}})});var _models=require("./models");Object.keys(_models).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _models[key]}})});var _shaderlib=require("./shaderlib");Object.defineProperty(exports,"Shaders",{enumerable:true,get:function get(){return _interopRequireDefault(_shaderlib).default}});var _fx=require("./addons/fx");Object.defineProperty(exports,"Fx",{enumerable:true,get:function get(){return _interopRequireDefault(_fx).default}});var _deprecated=require("./deprecated");Object.keys(_deprecated).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _deprecated[key]}})});var webgl=_interopRequireWildcard(_webgl);var webgl2=_interopRequireWildcard(_webgl2);var math=_interopRequireWildcard(_math);var scenegraph=_interopRequireWildcard(_scenegraph);var core=_interopRequireWildcard(_core);var geometry=_interopRequireWildcard(_geometry);var models=_interopRequireWildcard(_models);var _experimental=require("./experimental");var experimental=_interopRequireWildcard(_experimental);var _shaderlib2=_interopRequireDefault(_shaderlib);var _fx2=_interopRequireDefault(_fx);var deprecated=_interopRequireWildcard(_deprecated);var _globals=require("./globals");var _globals2=_interopRequireDefault(_globals);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.assign(_globals2.default,webgl,webgl2,math,scenegraph,core,geometry,models,experimental,_shaderlib2.default,deprecated,{Fx:_fx2.default})},{"./addons/fx":482,"./core":488,"./deprecated":492,"./experimental":494,"./geometry":500,"./globals":504,"./math":517,"./models":527,"./scenegraph":529,"./shaderlib":534,"./webgl":546,"./webgl2":562}],565:[function(require,module,exports){module.exports={_args:[[{raw:"luma.gl",scope:null,escapedName:"luma.gl",name:"luma.gl",rawSpec:"",spec:"latest",type:"tag"},"/home/khome/dev/map-test"]],_from:"luma.gl@latest",_id:"luma.gl@2.10.4",_inCache:true,_location:"/luma.gl",_nodeVersion:"6.9.1",_npmOperationalInternal:{host:"packages-12-west.internal.npmjs.com",tmp:"tmp/luma.gl-2.10.4.tgz_1481945526442_0.3162013702094555"},_npmUser:{name:"ibgreen",email:"ib.green.home@gmail.com"},_npmVersion:"3.10.8",_phantomChildren:{},_requested:{raw:"luma.gl",scope:null,escapedName:"luma.gl",name:"luma.gl",rawSpec:"",spec:"latest",type:"tag"},_requiredBy:["#USER","/"],_resolved:"https://registry.npmjs.org/luma.gl/-/luma.gl-2.10.4.tgz",_shasum:"c6952da21a972a65cb9142eea7ada8619bdb3a5d",_shrinkwrap:null,_spec:"luma.gl",_where:"/home/khome/dev/map-test",bugs:{url:"https://github.com/uber/luma.gl/issues"},contributors:[{name:"Ib Green",email:"ib@uber.com"},{name:"Nicolas Belmonte",email:"nico@uber.com"},{name:"Rye Terrell"},{name:"Shan He",email:"shan@uber.com"},{name:"Mikola Lysenko"},{name:"Wesam Manassra",email:"manassra@uber.com"}],dependencies:{"autobind-decorator":"^1.3.3","babel-polyfill":"^6.5.0","canvas-to-blob":"0.0.0","filesaver.js":"^0.2.0","get-pixels":"^3.3.0","gl-constants":"^1.0.0","gl-matrix":"^2.3.2",global:"^4.3.1",ndarray:"^1.0.18","save-pixels":"^2.3.2",through:"^2.3.8","webgl-debug":"^1.0.2"},description:"A WebGL JavaScript visualization library.",devDependencies:{"babel-cli":"^6.3.15","babel-core":"^6.7.7","babel-eslint":"^6.0.0","babel-plugin-static-fs":"^1.1.0","babel-plugin-transform-builtin-extend":"^1.1.0","babel-plugin-transform-decorators-legacy":"^1.3.4","babel-preset-es2015":"^6.3.13","babel-preset-stage-2":"^6.3.13",babelify:"^7.2.0",bl:"^1.1.2","blue-tape":"^0.2.0","brfs-babel":"^1.0.0",browserify:"^13.0.0",budo:"^8.0.3","cookie-cutter":"^0.1.1","d3-format":"^1.0.0",disc:"^1.3.2","electron-prebuilt":"^0.37.2",eslint:"^2.0","eslint-config-uber-es2015":"^2.0.0",faucet:"0.0.1",gl:"^4.0.2",husky:"^0.10.2",mkdirp:"^0.5.1","source-map-support":"^0.4.2","tap-browser-color":"^0.1.2","tape-catch":"^1.0.4","tape-promise":"^1.1.0",testron:"^1.2.0","uglify-js":"^2.6.1"},directories:{},dist:{shasum:"c6952da21a972a65cb9142eea7ada8619bdb3a5d",tarball:"https://registry.npmjs.org/luma.gl/-/luma.gl-2.10.4.tgz"},files:["dist","shaderlib","src","headless.js","node-io.js","experimental.js"],gitHead:"c99684cde6e809e639cd332ac883f7d080f97b2f",homepage:"https://github.com/uber/luma.gl#readme",keywords:["webgl","w3c","visualization","canvas","animation","3d"],license:"MIT",main:"dist/index.js",maintainers:[{name:"gnavvy",email:"gnavvy@gmail.com"},{name:"heshan0131",email:"heshan0131@gmail.com"},{name:"ibgreen",email:"ib.green.home@gmail.com"},{name:"pessimistress",email:"cxiaoji@gmail.com"}],name:"luma.gl",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+https://github.com/uber/luma.gl.git"},scripts:{build:"npm run build-clean && npm run build-compile && npm run build-script","build-clean":"rm -fr dist/*","build-compile":"babel src -d dist --source-maps inline --copy-files","build-script":"browserify src/bundle.js --debug -o dist/lumagl.js -t babelify -t brfs-babel && cat dist/lumagl.js | uglifyjs > dist/lumagl.min.js","build-watch":"babel src -d dist --source-maps inline --copy-files --watch & babel examples -d dist --source-maps inline --copy-files --watch &",docs:"npm run docs-build && open ./_docs/docs/index.html","docs-build":"rm -fr _docs/* && jekyll build --config=docs/_config.yml --layouts docs/_layouts","docs-gh-pages":"git subtree push --prefix _docs origin gh-pages","docs-gh-pages-force":"git push origin `git subtree split --prefix _docs dev`:gh-pages --force","docs-publish":"npm run docs-build && git add _docs -f && git commit -m 'UPDATE DOCS' --no-verify && npm run docs-gh-pages",lint:"eslint src",mypublish:"npm run build && npm run test && npm publish",precommit:"npm test","profile-disc":"browserify src/bundle.js --full-paths -t babelify -t brfs-babel | discify --open",start:"npm run build-watch && budo dist/bundle.js:dist/lumagl.js --live --open --port 3000 --watch-glob '**/*.{html,css,js,glsl}' -- -t brfs-babel",test:"npm run lint && npm run test-headless && npm run test-headless-nowebgl","test-browser":"budo test/browser.js:build/test-bundle.js --dir test --live --open --port 3001 --watch-glob '**/*.{html,css,js,glsl}' -- -t babelify","test-electron":"browserify test/electron.js | testron | faucet","test-headless":"babel-node --include='' test/headless.js | faucet","test-headless-nowebgl":"babel-node --include='' test/headless-nowebgl.js | faucet"},version:"2.10.4"}},{}],566:[function(require,module,exports){var Kn=18,Xn=.95047,Yn=1,Zn=1.08883,t0=4/29,t1=6/29,t2=3*t1*t1,t3=t1*t1*t1,deg2rad=Math.PI/180,rad2deg=180/Math.PI;function xyz2lab(t){return t>t3?Math.pow(t,1/3):t/t2+t0}function lab2xyz(t){return t>t1?t*t*t:t2*(t-t0)}function xyz2rgb(x){return 255*(x<=.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055)}function rgb2xyz(x){return(x/=255)<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function rgbToLab(rgbColor){var b=rgb2xyz(rgbColor[0]),a=rgb2xyz(rgbColor[1]),l=rgb2xyz(rgbColor[2]),x=xyz2lab((.4124564*b+.3575761*a+.1804375*l)/Xn),y=xyz2lab((.2126729*b+.7151522*a+.072175*l)/Yn),z=xyz2lab((.0193339*b+.119192*a+.9503041*l)/Zn);return[116*y-16,500*(x-y),200*(y-z),rgbColor[3]]}function labToRgb(labColor){var y=(labColor[0]+16)/116,x=isNaN(labColor[1])?y:y+labColor[1]/500,z=isNaN(labColor[2])?y:y-labColor[2]/200;y=Yn*lab2xyz(y);x=Xn*lab2xyz(x);z=Zn*lab2xyz(z);return[xyz2rgb(3.2404542*x-1.5371385*y-.4985314*z),xyz2rgb(-.969266*x+1.8760108*y+.041556*z),xyz2rgb(.0556434*x-.2040259*y+1.0572252*z),labColor[3]]}function rgbToHcl(rgbColor){var labColor=rgbToLab(rgbColor);var l=labColor[0],a=labColor[1],b=labColor[2];var h=Math.atan2(b,a)*rad2deg;return[h<0?h+360:h,Math.sqrt(a*a+b*b),l,rgbColor[3]]}function hclToRgb(hclColor){var h=hclColor[0]*deg2rad,c=hclColor[1],l=hclColor[2];return labToRgb([l,Math.cos(h)*c,Math.sin(h)*c,hclColor[3]])}module.exports={lab:{forward:rgbToLab,reverse:labToRgb},hcl:{forward:rgbToHcl,reverse:hclToRgb}}},{}],567:[function(require,module,exports){"use strict";var colorSpaces=require("./color_spaces");function identityFunction(x){return x}function createFunction(parameters,defaultType){var fun;if(!isFunctionDefinition(parameters)){fun=function(){return parameters};fun.isFeatureConstant=true;fun.isZoomConstant=true}else{var zoomAndFeatureDependent=parameters.stops&&typeof parameters.stops[0][0]==="object";var featureDependent=zoomAndFeatureDependent||parameters.property!==undefined;var zoomDependent=zoomAndFeatureDependent||!featureDependent;var inputType=parameters.stops&&typeof(zoomAndFeatureDependent?parameters.stops[0][0].property:parameters.stops[0][0]);var type=parameters.type||defaultType||(inputType==="string"?"categorical":"exponential");var innerFun;if(type==="exponential"){innerFun=evaluateExponentialFunction}else if(type==="interval"){innerFun=evaluateIntervalFunction}else if(type==="categorical"){innerFun=evaluateCategoricalFunction}else if(type==="identity"){innerFun=evaluateIdentityFunction}else{throw new Error('Unknown function type "'+type+'"')}var outputFunction;if(parameters.colorSpace&&parameters.colorSpace!=="rgb"){if(colorSpaces[parameters.colorSpace]){var colorspace=colorSpaces[parameters.colorSpace];parameters=JSON.parse(JSON.stringify(parameters));for(var s=0;s<parameters.stops.length;s++){parameters.stops[s]=[parameters.stops[s][0],colorspace.forward(parameters.stops[s][1])]}outputFunction=colorspace.reverse}else{throw new Error("Unknown color space: "+parameters.colorSpace)}}else{outputFunction=identityFunction}if(innerFun===evaluateCategoricalFunction){var hashedStops=Object.create(null);for(var i=0;i<parameters.stops.length;i++){hashedStops[parameters.stops[i][0]]=parameters.stops[i][1]}}if(zoomAndFeatureDependent){var featureFunctions={};var featureFunctionStops=[];for(s=0;s<parameters.stops.length;s++){var stop=parameters.stops[s];if(featureFunctions[stop[0].zoom]===undefined){featureFunctions[stop[0].zoom]={zoom:stop[0].zoom,type:parameters.type,property:parameters.property,stops:[]}}featureFunctions[stop[0].zoom].stops.push([stop[0].value,stop[1]])}for(var z in featureFunctions){featureFunctionStops.push([featureFunctions[z].zoom,createFunction(featureFunctions[z])])}fun=function(zoom,feature){return outputFunction(evaluateExponentialFunction({stops:featureFunctionStops,base:parameters.base},zoom)(zoom,feature))};fun.isFeatureConstant=false;fun.isZoomConstant=false}else if(zoomDependent){fun=function(zoom){if(innerFun===evaluateCategoricalFunction){return outputFunction(innerFun(parameters,zoom,hashedStops))}else return outputFunction(innerFun(parameters,zoom))};fun.isFeatureConstant=true;fun.isZoomConstant=false}else{fun=function(zoom,feature){if(innerFun===evaluateCategoricalFunction){return outputFunction(innerFun(parameters,feature[parameters.property],hashedStops))}else return outputFunction(innerFun(parameters,feature[parameters.property]))};fun.isFeatureConstant=false;fun.isZoomConstant=true}}return fun}function evaluateCategoricalFunction(parameters,input,hashedStops){var value=hashedStops[input];if(value===undefined){return parameters.stops[0][1]}return value}function evaluateIntervalFunction(parameters,input){var n=parameters.stops.length;if(n===1)return parameters.stops[0][1];if(input===undefined||input===null)return parameters.stops[n-1][1];if(input<=parameters.stops[0][0])return parameters.stops[0][1];if(input>=parameters.stops[n-1][0])return parameters.stops[n-1][1];var index=binarySearchForIndex(parameters.stops,input);return parameters.stops[index][1]}function evaluateExponentialFunction(parameters,input){var base=parameters.base!==undefined?parameters.base:1;var n=parameters.stops.length;if(n===1)return parameters.stops[0][1];if(input===undefined||input===null)return parameters.stops[n-1][1];if(input<=parameters.stops[0][0])return parameters.stops[0][1];if(input>=parameters.stops[n-1][0])return parameters.stops[n-1][1];var index=binarySearchForIndex(parameters.stops,input);return interpolate(input,base,parameters.stops[index][0],parameters.stops[index+1][0],parameters.stops[index][1],parameters.stops[index+1][1])}function evaluateIdentityFunction(parameters,input){return input}function binarySearchForIndex(stops,input){var n=stops.length;var lowerIndex=0;var upperIndex=n-1;var currentIndex=0;var currentValue,upperValue;while(lowerIndex<=upperIndex){currentIndex=Math.floor((lowerIndex+upperIndex)/2);currentValue=stops[currentIndex][0];upperValue=stops[currentIndex+1][0];if(input>=currentValue&&input<upperValue){return currentIndex}else if(currentValue<input){lowerIndex=currentIndex+1}else if(currentValue>input){upperIndex=currentIndex-1}}return Math.max(currentIndex-1,0)}function interpolate(input,base,inputLower,inputUpper,outputLower,outputUpper){if(typeof outputLower==="function"){return function(){var evaluatedLower=outputLower.apply(undefined,arguments);var evaluatedUpper=outputUpper.apply(undefined,arguments);return interpolate(input,base,inputLower,inputUpper,evaluatedLower,evaluatedUpper)}}else if(outputLower.length){return interpolateArray(input,base,inputLower,inputUpper,outputLower,outputUpper)}else{return interpolateNumber(input,base,inputLower,inputUpper,outputLower,outputUpper)}}function interpolateNumber(input,base,inputLower,inputUpper,outputLower,outputUpper){var difference=inputUpper-inputLower;var progress=input-inputLower;var ratio;if(base===1){ratio=progress/difference}else{ratio=(Math.pow(base,progress)-1)/(Math.pow(base,difference)-1)}return outputLower*(1-ratio)+outputUpper*ratio}function interpolateArray(input,base,inputLower,inputUpper,outputLower,outputUpper){var output=[];for(var i=0;i<outputLower.length;i++){output[i]=interpolateNumber(input,base,inputLower,inputUpper,outputLower[i],outputUpper[i])}return output}function isFunctionDefinition(value){return typeof value==="object"&&(value.stops||value.type==="identity")}module.exports.isFunctionDefinition=isFunctionDefinition;module.exports.interpolated=function(parameters){return createFunction(parameters,"exponential")};module.exports["piecewise-constant"]=function(parameters){return createFunction(parameters,"interval")}},{"./color_spaces":566}],568:[function(require,module,exports){"use strict";var refProperties=require("./util/ref_properties");function deref(layer,parent){var result={};for(var k in layer){if(k!=="ref"){result[k]=layer[k]}}refProperties.forEach(function(k){if(k in parent){result[k]=parent[k]}});return result}module.exports=derefLayers;function derefLayers(layers){layers=layers.slice();var map=Object.create(null),i;for(i=0;i<layers.length;i++){map[layers[i].id]=layers[i]}for(i=0;i<layers.length;i++){if("ref"in layers[i]){layers[i]=deref(layers[i],map[layers[i].ref])}}return layers}},{"./util/ref_properties":574}],569:[function(require,module,exports){"use strict";var isEqual=require("lodash.isequal");var operations={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function diffSources(before,after,commands,sourcesRemoved){before=before||{};after=after||{};var sourceId;for(sourceId in before){if(!before.hasOwnProperty(sourceId))continue;if(!after.hasOwnProperty(sourceId)){commands.push({command:operations.removeSource,args:[sourceId]});sourcesRemoved[sourceId]=true}}for(sourceId in after){if(!after.hasOwnProperty(sourceId))continue;if(!before.hasOwnProperty(sourceId)){commands.push({command:operations.addSource,args:[sourceId,after[sourceId]]})}else if(!isEqual(before[sourceId],after[sourceId])){commands.push({command:operations.removeSource,args:[sourceId]});commands.push({command:operations.addSource,args:[sourceId,after[sourceId]]});sourcesRemoved[sourceId]=true}}}function diffLayerPropertyChanges(before,after,commands,layerId,klass,command){before=before||{};after=after||{};var prop;for(prop in before){if(!before.hasOwnProperty(prop))continue;if(!isEqual(before[prop],after[prop])){commands.push({command:command,args:[layerId,prop,after[prop],klass]})}}for(prop in after){if(!after.hasOwnProperty(prop)||before.hasOwnProperty(prop))continue;if(!isEqual(before[prop],after[prop])){commands.push({command:command,args:[layerId,prop,after[prop],klass]})}}}function pluckId(layer){return layer.id}function indexById(group,layer){group[layer.id]=layer;return group}function diffLayers(before,after,commands){before=before||[];after=after||[];var beforeOrder=before.map(pluckId);var afterOrder=after.map(pluckId);var beforeIndex=before.reduce(indexById,{});var afterIndex=after.reduce(indexById,{});var tracker=beforeOrder.slice();var clean=Object.create(null);var i,d,layerId,beforeLayer,afterLayer,insertBeforeLayerId,prop;for(i=0,d=0;i<beforeOrder.length;i++){layerId=beforeOrder[i];if(!afterIndex.hasOwnProperty(layerId)){commands.push({command:operations.removeLayer,args:[layerId]});tracker.splice(tracker.indexOf(layerId,d),1)}else{d++}}for(i=0,d=0;i<afterOrder.length;i++){layerId=afterOrder[afterOrder.length-1-i];if(tracker[tracker.length-1-i]===layerId)continue;if(beforeIndex.hasOwnProperty(layerId)){commands.push({command:operations.removeLayer,args:[layerId]});tracker.splice(tracker.lastIndexOf(layerId,tracker.length-d),1)}else{d++}insertBeforeLayerId=tracker[tracker.length-i];commands.push({command:operations.addLayer,args:[afterIndex[layerId],insertBeforeLayerId]});tracker.splice(tracker.length-i,0,layerId);clean[layerId]=true}for(i=0;i<afterOrder.length;i++){layerId=afterOrder[i];beforeLayer=beforeIndex[layerId];afterLayer=afterIndex[layerId];if(clean[layerId]||isEqual(beforeLayer,afterLayer))continue;if(!isEqual(beforeLayer.source,afterLayer.source)||!isEqual(beforeLayer["source-layer"],afterLayer["source-layer"])||!isEqual(beforeLayer.type,afterLayer.type)){commands.push({command:operations.removeLayer,args:[layerId]});insertBeforeLayerId=tracker[tracker.lastIndexOf(layerId)+1];commands.push({command:operations.addLayer,args:[afterLayer,insertBeforeLayerId]});continue}diffLayerPropertyChanges(beforeLayer.layout,afterLayer.layout,commands,layerId,null,operations.setLayoutProperty);diffLayerPropertyChanges(beforeLayer.paint,afterLayer.paint,commands,layerId,null,operations.setPaintProperty);if(!isEqual(beforeLayer.filter,afterLayer.filter)){commands.push({command:operations.setFilter,args:[layerId,afterLayer.filter]})}if(!isEqual(beforeLayer.minzoom,afterLayer.minzoom)||!isEqual(beforeLayer.maxzoom,afterLayer.maxzoom)){commands.push({command:operations.setLayerZoomRange,args:[layerId,afterLayer.minzoom,afterLayer.maxzoom]})}for(prop in beforeLayer){if(!beforeLayer.hasOwnProperty(prop))continue;if(prop==="layout"||prop==="paint"||prop==="filter"||prop==="metadata"||prop==="minzoom"||prop==="maxzoom")continue;if(prop.indexOf("paint.")===0){diffLayerPropertyChanges(beforeLayer[prop],afterLayer[prop],commands,layerId,prop.slice(6),operations.setPaintProperty)}else if(!isEqual(beforeLayer[prop],afterLayer[prop])){commands.push({command:operations.setLayerProperty,args:[layerId,prop,afterLayer[prop]]})}}for(prop in afterLayer){if(!afterLayer.hasOwnProperty(prop)||beforeLayer.hasOwnProperty(prop))continue;if(prop==="layout"||prop==="paint"||prop==="filter"||prop==="metadata"||prop==="minzoom"||prop==="maxzoom")continue;if(prop.indexOf("paint.")===0){diffLayerPropertyChanges(beforeLayer[prop],afterLayer[prop],commands,layerId,prop.slice(6),operations.setPaintProperty)}else if(!isEqual(beforeLayer[prop],afterLayer[prop])){commands.push({command:operations.setLayerProperty,args:[layerId,prop,afterLayer[prop]]})}}}}function diffStyles(before,after){if(!before)return[{command:operations.setStyle,args:[after]}];var commands=[];try{if(!isEqual(before.version,after.version)){return[{command:operations.setStyle,args:[after]}]}if(!isEqual(before.center,after.center)){commands.push({command:operations.setCenter,args:[after.center]})}if(!isEqual(before.zoom,after.zoom)){commands.push({command:operations.setZoom,args:[after.zoom]})}if(!isEqual(before.bearing,after.bearing)){commands.push({command:operations.setBearing,args:[after.bearing]})}if(!isEqual(before.pitch,after.pitch)){commands.push({command:operations.setPitch,args:[after.pitch]})}if(!isEqual(before.sprite,after.sprite)){commands.push({command:operations.setSprite,args:[after.sprite]})}if(!isEqual(before.glyphs,after.glyphs)){commands.push({command:operations.setGlyphs,args:[after.glyphs]})}if(!isEqual(before.transition,after.transition)){commands.push({command:operations.setTransition,args:[after.transition]})}if(!isEqual(before.light,after.light)){commands.push({command:operations.setLight,args:[after.light]})}var sourcesRemoved={};var removeOrAddSourceCommands=[];diffSources(before.sources,after.sources,removeOrAddSourceCommands,sourcesRemoved);var beforeLayers=[];if(before.layers){before.layers.forEach(function(layer){if(sourcesRemoved[layer.source]){commands.push({command:operations.removeLayer,args:[layer.id]})}else{beforeLayers.push(layer)}})}commands=commands.concat(removeOrAddSourceCommands);diffLayers(beforeLayers,after.layers,commands)}catch(e){console.warn("Unable to compute style diff:",e);commands=[{command:operations.setStyle,args:[after]}]}return commands}module.exports=diffStyles;module.exports.operations=operations},{"lodash.isequal":469}],570:[function(require,module,exports){"use strict";var format=require("util").format;function ValidationError(key,value){this.message=(key?key+": ":"")+format.apply(format,Array.prototype.slice.call(arguments,2));if(value!==null&&value!==undefined&&value.__line__){this.line=value.__line__}}module.exports=ValidationError},{util:996}],571:[function(require,module,exports){"use strict";var refProperties=require("./util/ref_properties");var stringify=require("fast-stable-stringify");function key(layer){return stringify(refProperties.map(function(k){return layer[k]}))}module.exports=groupByLayout;function groupByLayout(layers){var groups={},i,k;for(i=0;i<layers.length;i++){k=key(layers[i]);var group=groups[k];if(!group){group=groups[k]=[]}group.push(layers[i])}var result=[];for(k in groups){result.push(groups[k])}return result}},{"./util/ref_properties":574,"fast-stable-stringify":390}],572:[function(require,module,exports){"use strict";module.exports=function(output){for(var i=1;i<arguments.length;i++){var input=arguments[i];for(var k in input){output[k]=input[k]}}return output}},{}],573:[function(require,module,exports){"use strict";module.exports=function getType(val){if(val instanceof Number){return"number"}else if(val instanceof String){return"string"}else if(val instanceof Boolean){return"boolean"}else if(Array.isArray(val)){return"array"}else if(val===null){return"null"}else{return typeof val}}},{}],574:[function(require,module,exports){"use strict";module.exports=["type","source","source-layer","minzoom","maxzoom","filter","layout"]},{}],575:[function(require,module,exports){"use strict";module.exports=function unbundle(value){if(value instanceof Number||value instanceof String||value instanceof Boolean){return value.valueOf()}else{return value}}},{}],576:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var getType=require("../util/get_type");var extend=require("../util/extend");module.exports=function validate(options){var validateFunction=require("./validate_function");var validateObject=require("./validate_object");var VALIDATORS={"*":function(){return[]},array:require("./validate_array"),boolean:require("./validate_boolean"),number:require("./validate_number"),color:require("./validate_color"),constants:require("./validate_constants"),enum:require("./validate_enum"),filter:require("./validate_filter"),function:require("./validate_function"),layer:require("./validate_layer"),object:require("./validate_object"),source:require("./validate_source"),light:require("./validate_light"),string:require("./validate_string")};var value=options.value;var valueSpec=options.valueSpec;var key=options.key;var styleSpec=options.styleSpec;var style=options.style;if(getType(value)==="string"&&value[0]==="@"){if(styleSpec.$version>7){return[new ValidationError(key,value,"constants have been deprecated as of v8")]}if(!(value in style.constants)){return[new ValidationError(key,value,'constant "%s" not found',value)];
}options=extend({},options,{value:style.constants[value]})}if(valueSpec.function&&getType(value)==="object"){return validateFunction(options)}else if(valueSpec.type&&VALIDATORS[valueSpec.type]){return VALIDATORS[valueSpec.type](options)}else{return validateObject(extend({},options,{valueSpec:valueSpec.type?styleSpec[valueSpec.type]:valueSpec}))}}},{"../error/validation_error":570,"../util/extend":572,"../util/get_type":573,"./validate_array":577,"./validate_boolean":578,"./validate_color":579,"./validate_constants":580,"./validate_enum":581,"./validate_filter":582,"./validate_function":583,"./validate_layer":585,"./validate_light":587,"./validate_number":588,"./validate_object":589,"./validate_source":591,"./validate_string":592}],577:[function(require,module,exports){"use strict";var getType=require("../util/get_type");var validate=require("./validate");var ValidationError=require("../error/validation_error");module.exports=function validateArray(options){var array=options.value;var arraySpec=options.valueSpec;var style=options.style;var styleSpec=options.styleSpec;var key=options.key;var validateArrayElement=options.arrayElementValidator||validate;if(getType(array)!=="array"){return[new ValidationError(key,array,"array expected, %s found",getType(array))]}if(arraySpec.length&&array.length!==arraySpec.length){return[new ValidationError(key,array,"array length %d expected, length %d found",arraySpec.length,array.length)]}if(arraySpec["min-length"]&&array.length<arraySpec["min-length"]){return[new ValidationError(key,array,"array length at least %d expected, length %d found",arraySpec["min-length"],array.length)]}var arrayElementSpec={type:arraySpec.value};if(styleSpec.$version<7){arrayElementSpec.function=arraySpec.function}if(getType(arraySpec.value)==="object"){arrayElementSpec=arraySpec.value}var errors=[];for(var i=0;i<array.length;i++){errors=errors.concat(validateArrayElement({array:array,arrayIndex:i,value:array[i],valueSpec:arrayElementSpec,style:style,styleSpec:styleSpec,key:key+"["+i+"]"}))}return errors}},{"../error/validation_error":570,"../util/get_type":573,"./validate":576}],578:[function(require,module,exports){"use strict";var getType=require("../util/get_type");var ValidationError=require("../error/validation_error");module.exports=function validateBoolean(options){var value=options.value;var key=options.key;var type=getType(value);if(type!=="boolean"){return[new ValidationError(key,value,"boolean expected, %s found",type)]}return[]}},{"../error/validation_error":570,"../util/get_type":573}],579:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var getType=require("../util/get_type");var parseCSSColor=require("csscolorparser").parseCSSColor;module.exports=function validateColor(options){var key=options.key;var value=options.value;var type=getType(value);if(type!=="string"){return[new ValidationError(key,value,"color expected, %s found",type)]}if(parseCSSColor(value)===null){return[new ValidationError(key,value,'color expected, "%s" found',value)]}return[]}},{"../error/validation_error":570,"../util/get_type":573,csscolorparser:319}],580:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var getType=require("../util/get_type");module.exports=function validateConstants(options){var key=options.key;var constants=options.value;var styleSpec=options.styleSpec;if(styleSpec.$version>7){if(constants){return[new ValidationError(key,constants,"constants have been deprecated as of v8")]}else{return[]}}else{var type=getType(constants);if(type!=="object"){return[new ValidationError(key,constants,"object expected, %s found",type)]}var errors=[];for(var constantName in constants){if(constantName[0]!=="@"){errors.push(new ValidationError(key+"."+constantName,constants[constantName],'constants must start with "@"'))}}return errors}}},{"../error/validation_error":570,"../util/get_type":573}],581:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var unbundle=require("../util/unbundle_jsonlint");module.exports=function validateEnum(options){var key=options.key;var value=options.value;var valueSpec=options.valueSpec;var errors=[];if(Array.isArray(valueSpec.values)){if(valueSpec.values.indexOf(unbundle(value))===-1){errors.push(new ValidationError(key,value,"expected one of [%s], %s found",valueSpec.values.join(", "),value))}}else{if(Object.keys(valueSpec.values).indexOf(unbundle(value))===-1){errors.push(new ValidationError(key,value,"expected one of [%s], %s found",Object.keys(valueSpec.values).join(", "),value))}}return errors}},{"../error/validation_error":570,"../util/unbundle_jsonlint":575}],582:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var validateEnum=require("./validate_enum");var getType=require("../util/get_type");var unbundle=require("../util/unbundle_jsonlint");module.exports=function validateFilter(options){var value=options.value;var key=options.key;var styleSpec=options.styleSpec;var type;var errors=[];if(getType(value)!=="array"){return[new ValidationError(key,value,"array expected, %s found",getType(value))]}if(value.length<1){return[new ValidationError(key,value,"filter array must have at least 1 element")]}errors=errors.concat(validateEnum({key:key+"[0]",value:value[0],valueSpec:styleSpec.filter_operator,style:options.style,styleSpec:options.styleSpec}));switch(unbundle(value[0])){case"<":case"<=":case">":case">=":if(value.length>=2&&value[1]=="$type"){errors.push(new ValidationError(key,value,'"$type" cannot be use with operator "%s"',value[0]))}case"==":case"!=":if(value.length!=3){errors.push(new ValidationError(key,value,'filter array for operator "%s" must have 3 elements',value[0]))}case"in":case"!in":if(value.length>=2){type=getType(value[1]);if(type!=="string"){errors.push(new ValidationError(key+"[1]",value[1],"string expected, %s found",type))}else if(value[1][0]==="@"){errors.push(new ValidationError(key+"[1]",value[1],"filter key cannot be a constant"))}}for(var i=2;i<value.length;i++){type=getType(value[i]);if(value[1]=="$type"){errors=errors.concat(validateEnum({key:key+"["+i+"]",value:value[i],valueSpec:styleSpec.geometry_type,style:options.style,styleSpec:options.styleSpec}))}else if(type==="string"&&value[i][0]==="@"){errors.push(new ValidationError(key+"["+i+"]",value[i],"filter value cannot be a constant"))}else if(type!=="string"&&type!=="number"&&type!=="boolean"){errors.push(new ValidationError(key+"["+i+"]",value[i],"string, number, or boolean expected, %s found",type))}}break;case"any":case"all":case"none":for(i=1;i<value.length;i++){errors=errors.concat(validateFilter({key:key+"["+i+"]",value:value[i],style:options.style,styleSpec:options.styleSpec}))}break;case"has":case"!has":type=getType(value[1]);if(value.length!==2){errors.push(new ValidationError(key,value,'filter array for "%s" operator must have 2 elements',value[0]))}else if(type!=="string"){errors.push(new ValidationError(key+"[1]",value[1],"string expected, %s found",type))}else if(value[1][0]==="@"){errors.push(new ValidationError(key+"[1]",value[1],"filter key cannot be a constant"))}break}return errors}},{"../error/validation_error":570,"../util/get_type":573,"../util/unbundle_jsonlint":575,"./validate_enum":581}],583:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var getType=require("../util/get_type");var validate=require("./validate");var validateObject=require("./validate_object");var validateArray=require("./validate_array");var validateNumber=require("./validate_number");var unbundle=require("../util/unbundle_jsonlint");module.exports=function validateFunction(options){var functionValueSpec=options.valueSpec;var functionType=unbundle(options.value.type);var stopKeyType;var isZoomFunction=options.value.property===undefined;var isPropertyFunction=options.value.property!==undefined;var isZoomAndPropertyFunction=getType(options.value.stops)==="array"&&getType(options.value.stops[0])==="array"&&getType(options.value.stops[0][0])==="object";var errors=validateObject({key:options.key,value:options.value,valueSpec:options.styleSpec.function,style:options.style,styleSpec:options.styleSpec,objectElementValidators:{stops:validateFunctionStops}});if(functionType!=="identity"&&!options.value.stops){errors.push(new ValidationError(options.key,options.value,'missing required property "stops"'))}if(options.styleSpec.$version>=8){if(isPropertyFunction&&!options.valueSpec["property-function"]){errors.push(new ValidationError(options.key,options.value,"property functions not supported"))}else if(isZoomFunction&&!options.valueSpec["zoom-function"]){errors.push(new ValidationError(options.key,options.value,"zoom functions not supported"))}}return errors;function validateFunctionStops(options){if(functionType==="identity"){return[new ValidationError(options.key,options.value,'identity function may not have a "stops" property')]}var errors=[];var value=options.value;errors=errors.concat(validateArray({key:options.key,value:value,valueSpec:options.valueSpec,style:options.style,styleSpec:options.styleSpec,arrayElementValidator:validateFunctionStop}));if(getType(value)==="array"&&value.length===0){errors.push(new ValidationError(options.key,value,"array must have at least one stop"))}return errors}function validateFunctionStop(options){var errors=[];var value=options.value;var key=options.key;if(getType(value)!=="array"){return[new ValidationError(key,value,"array expected, %s found",getType(value))]}if(value.length!==2){return[new ValidationError(key,value,"array length %d expected, length %d found",2,value.length)]}if(isZoomAndPropertyFunction){if(getType(value[0])!=="object"){return[new ValidationError(key,value,"object expected, %s found",getType(value[0]))]}if(value[0].zoom===undefined){return[new ValidationError(key,value,"object stop key must have zoom")]}if(value[0].value===undefined){return[new ValidationError(key,value,"object stop key must have value")]}errors=errors.concat(validateObject({key:key+"[0]",value:value[0],valueSpec:{zoom:{}},style:options.style,styleSpec:options.styleSpec,objectElementValidators:{zoom:validateNumber,value:validateStopDomainValue}}))}else{errors=errors.concat((isZoomFunction?validateNumber:validateStopDomainValue)({key:key+"[0]",value:value[0],valueSpec:{},style:options.style,styleSpec:options.styleSpec}))}errors=errors.concat(validate({key:key+"[1]",value:value[1],valueSpec:functionValueSpec,style:options.style,styleSpec:options.styleSpec}));if(getType(value[0])==="number"){if(functionValueSpec.function==="piecewise-constant"&&value[0]%1!==0){errors.push(new ValidationError(key+"[0]",value[0],"zoom level for piecewise-constant functions must be an integer"))}if(options.arrayIndex!==0){if(value[0]<options.array[options.arrayIndex-1][0]){errors.push(new ValidationError(key+"[0]",value[0],"array stops must appear in ascending order"))}}}return errors}function validateStopDomainValue(options){var type=getType(options.value);if(!stopKeyType){stopKeyType=type;if(!functionType&&type==="string"){functionType="categorical"}}else if(type!==stopKeyType){return[new ValidationError(options.key,options.value,"%s stop domain type must match previous stop domain type %s",type,stopKeyType)]}if(type!=="number"&&type!=="string"){return[new ValidationError(options.key,options.value,"property value must be a number or string")]}if(type!=="number"&&functionType!=="categorical"){return[new ValidationError(options.key,options.value,"number expected, %s found",type)]}return[]}}},{"../error/validation_error":570,"../util/get_type":573,"../util/unbundle_jsonlint":575,"./validate":576,"./validate_array":577,"./validate_number":588,"./validate_object":589}],584:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var validateString=require("./validate_string");module.exports=function(options){var value=options.value;var key=options.key;var errors=validateString(options);if(errors.length)return errors;if(value.indexOf("{fontstack}")===-1){errors.push(new ValidationError(key,value,'"glyphs" url must include a "{fontstack}" token'))}if(value.indexOf("{range}")===-1){errors.push(new ValidationError(key,value,'"glyphs" url must include a "{range}" token'))}return errors}},{"../error/validation_error":570,"./validate_string":592}],585:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var unbundle=require("../util/unbundle_jsonlint");var validateObject=require("./validate_object");var validateFilter=require("./validate_filter");var validatePaintProperty=require("./validate_paint_property");var validateLayoutProperty=require("./validate_layout_property");var extend=require("../util/extend");module.exports=function validateLayer(options){var errors=[];var layer=options.value;var key=options.key;var style=options.style;var styleSpec=options.styleSpec;if(!layer.type&&!layer.ref){errors.push(new ValidationError(key,layer,'either "type" or "ref" is required'))}var type=unbundle(layer.type);var ref=unbundle(layer.ref);if(layer.id){for(var i=0;i<options.arrayIndex;i++){var otherLayer=style.layers[i];if(unbundle(otherLayer.id)===unbundle(layer.id)){errors.push(new ValidationError(key,layer.id,'duplicate layer id "%s", previously used at line %d',layer.id,otherLayer.id.__line__))}}}if("ref"in layer){["type","source","source-layer","filter","layout"].forEach(function(p){if(p in layer){errors.push(new ValidationError(key,layer[p],'"%s" is prohibited for ref layers',p))}});var parent;style.layers.forEach(function(layer){if(layer.id==ref)parent=layer});if(!parent){errors.push(new ValidationError(key,layer.ref,'ref layer "%s" not found',ref))}else if(parent.ref){errors.push(new ValidationError(key,layer.ref,"ref cannot reference another ref layer"))}else{type=unbundle(parent.type)}}else if(type!=="background"){if(!layer.source){errors.push(new ValidationError(key,layer,'missing required property "source"'))}else{var source=style.sources&&style.sources[layer.source];if(!source){errors.push(new ValidationError(key,layer.source,'source "%s" not found',layer.source))}else if(source.type=="vector"&&type=="raster"){errors.push(new ValidationError(key,layer.source,'layer "%s" requires a raster source',layer.id))}else if(source.type=="raster"&&type!="raster"){errors.push(new ValidationError(key,layer.source,'layer "%s" requires a vector source',layer.id))}else if(source.type=="vector"&&!layer["source-layer"]){errors.push(new ValidationError(key,layer,'layer "%s" must specify a "source-layer"',layer.id))}}}errors=errors.concat(validateObject({key:key,value:layer,valueSpec:styleSpec.layer,style:options.style,styleSpec:options.styleSpec,objectElementValidators:{"*":function(){return[]},filter:validateFilter,layout:function(options){return validateObject({layer:layer,key:options.key,value:options.value,style:options.style,styleSpec:options.styleSpec,objectElementValidators:{"*":function(options){return validateLayoutProperty(extend({layerType:type},options))}}})},paint:function(options){return validateObject({layer:layer,key:options.key,value:options.value,style:options.style,styleSpec:options.styleSpec,objectElementValidators:{"*":function(options){return validatePaintProperty(extend({layerType:type},options))}}})}}}));return errors}},{"../error/validation_error":570,"../util/extend":572,"../util/unbundle_jsonlint":575,"./validate_filter":582,"./validate_layout_property":586,"./validate_object":589,"./validate_paint_property":590}],586:[function(require,module,exports){"use strict";var validate=require("./validate");var ValidationError=require("../error/validation_error");module.exports=function validateLayoutProperty(options){var key=options.key;var style=options.style;var styleSpec=options.styleSpec;var value=options.value;var propertyKey=options.objectKey;var layerSpec=styleSpec["layout_"+options.layerType];if(!layerSpec)return[];if(options.valueSpec||layerSpec[propertyKey]){var errors=[];if(options.layerType==="symbol"){if(propertyKey==="icon-image"&&style&&!style.sprite){errors.push(new ValidationError(key,value,'use of "icon-image" requires a style "sprite" property'))}else if(propertyKey==="text-field"&&style&&!style.glyphs){errors.push(new ValidationError(key,value,'use of "text-field" requires a style "glyphs" property'))}}return errors.concat(validate({key:options.key,value:value,valueSpec:options.valueSpec||layerSpec[propertyKey],style:style,styleSpec:styleSpec}))}else{return[new ValidationError(key,value,'unknown property "%s"',propertyKey)]}}},{"../error/validation_error":570,"./validate":576}],587:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var getType=require("../util/get_type");var validate=require("./validate");module.exports=function validateLight(options){var light=options.value;var styleSpec=options.styleSpec;var lightSpec=styleSpec.light;var style=options.style;var errors=[];var rootType=getType(light);if(light===undefined){return errors}else if(rootType!=="object"){errors=errors.concat([new ValidationError("light",light,"object expected, %s found",rootType)]);return errors}for(var key in light){var transitionMatch=key.match(/^(.*)-transition$/);if(transitionMatch&&lightSpec[transitionMatch[1]]&&lightSpec[transitionMatch[1]].transition){errors=errors.concat(validate({key:key,value:light[key],valueSpec:styleSpec.transition,style:style,styleSpec:styleSpec}))}else if(lightSpec[key]){errors=errors.concat(validate({key:key,value:light[key],valueSpec:lightSpec[key],style:style,styleSpec:styleSpec}))}else{errors=errors.concat([new ValidationError(key,light[key],'unknown property "%s"',key)])}}return errors}},{"../error/validation_error":570,"../util/get_type":573,"./validate":576}],588:[function(require,module,exports){"use strict";var getType=require("../util/get_type");var ValidationError=require("../error/validation_error");module.exports=function validateNumber(options){var key=options.key;var value=options.value;var valueSpec=options.valueSpec;var type=getType(value);if(type!=="number"){return[new ValidationError(key,value,"number expected, %s found",type)]}if("minimum"in valueSpec&&value<valueSpec.minimum){return[new ValidationError(key,value,"%s is less than the minimum value %s",value,valueSpec.minimum)]}if("maximum"in valueSpec&&value>valueSpec.maximum){return[new ValidationError(key,value,"%s is greater than the maximum value %s",value,valueSpec.maximum)]}return[]}},{"../error/validation_error":570,"../util/get_type":573}],589:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var getType=require("../util/get_type");var validateSpec=require("./validate");module.exports=function validateObject(options){var key=options.key;var object=options.value;var elementSpecs=options.valueSpec||{};var elementValidators=options.objectElementValidators||{};var style=options.style;var styleSpec=options.styleSpec;var errors=[];var type=getType(object);if(type!=="object"){return[new ValidationError(key,object,"object expected, %s found",type)]}for(var objectKey in object){var elementSpecKey=objectKey.split(".")[0];var elementSpec=elementSpecs[elementSpecKey]||elementSpecs["*"];var validateElement;if(elementValidators[elementSpecKey]){validateElement=elementValidators[elementSpecKey]}else if(elementSpecs[elementSpecKey]){validateElement=validateSpec}else if(elementValidators["*"]){validateElement=elementValidators["*"]}else if(elementSpecs["*"]){validateElement=validateSpec}else{errors.push(new ValidationError(key,object[objectKey],'unknown property "%s"',objectKey));continue}errors=errors.concat(validateElement({key:(key?key+".":key)+objectKey,value:object[objectKey],valueSpec:elementSpec,style:style,styleSpec:styleSpec,object:object,objectKey:objectKey}))}for(elementSpecKey in elementSpecs){if(elementSpecs[elementSpecKey].required&&elementSpecs[elementSpecKey]["default"]===undefined&&object[elementSpecKey]===undefined){errors.push(new ValidationError(key,object,'missing required property "%s"',elementSpecKey))}}return errors}},{"../error/validation_error":570,"../util/get_type":573,"./validate":576}],590:[function(require,module,exports){"use strict";var validate=require("./validate");var ValidationError=require("../error/validation_error");module.exports=function validatePaintProperty(options){var key=options.key;var style=options.style;var styleSpec=options.styleSpec;var value=options.value;var propertyKey=options.objectKey;var layerSpec=styleSpec["paint_"+options.layerType];if(!layerSpec)return[];var transitionMatch=propertyKey.match(/^(.*)-transition$/);if(transitionMatch&&layerSpec[transitionMatch[1]]&&layerSpec[transitionMatch[1]].transition){return validate({key:key,value:value,valueSpec:styleSpec.transition,style:style,styleSpec:styleSpec})}else if(options.valueSpec||layerSpec[propertyKey]){return validate({key:options.key,value:value,valueSpec:options.valueSpec||layerSpec[propertyKey],style:style,styleSpec:styleSpec})}else{return[new ValidationError(key,value,'unknown property "%s"',propertyKey)]}}},{"../error/validation_error":570,"./validate":576}],591:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var unbundle=require("../util/unbundle_jsonlint");var validateObject=require("./validate_object");var validateEnum=require("./validate_enum");module.exports=function validateSource(options){var value=options.value;var key=options.key;var styleSpec=options.styleSpec;var style=options.style;if(!value.type){return[new ValidationError(key,value,'"type" is required')]}var type=unbundle(value.type);switch(type){case"vector":case"raster":var errors=[];errors=errors.concat(validateObject({key:key,value:value,valueSpec:styleSpec.source_tile,style:options.style,styleSpec:styleSpec}));if("url"in value){for(var prop in value){if(["type","url","tileSize"].indexOf(prop)<0){errors.push(new ValidationError(key+"."+prop,value[prop],'a source with a "url" property may not include a "%s" property',prop))}}}return errors;case"geojson":return validateObject({key:key,value:value,valueSpec:styleSpec.source_geojson,style:style,styleSpec:styleSpec});case"video":return validateObject({key:key,value:value,valueSpec:styleSpec.source_video,style:style,styleSpec:styleSpec});case"image":return validateObject({key:key,value:value,valueSpec:styleSpec.source_image,style:style,styleSpec:styleSpec});default:return validateEnum({key:key+".type",value:value.type,valueSpec:{values:["vector","raster","geojson","video","image"]},style:style,styleSpec:styleSpec})}}},{"../error/validation_error":570,"../util/unbundle_jsonlint":575,"./validate_enum":581,"./validate_object":589}],592:[function(require,module,exports){"use strict";var getType=require("../util/get_type");var ValidationError=require("../error/validation_error");module.exports=function validateString(options){var value=options.value;var key=options.key;var type=getType(value);if(type!=="string"){return[new ValidationError(key,value,"string expected, %s found",type)]}return[]}},{"../error/validation_error":570,"../util/get_type":573}],593:[function(require,module,exports){"use strict";var validateConstants=require("./validate/validate_constants");var validate=require("./validate/validate");var latestStyleSpec=require("../reference/latest.min");var validateGlyphsURL=require("./validate/validate_glyphs_url");function validateStyleMin(style,styleSpec){styleSpec=styleSpec||latestStyleSpec;var errors=[];errors=errors.concat(validate({key:"",value:style,valueSpec:styleSpec.$root,styleSpec:styleSpec,style:style,objectElementValidators:{glyphs:validateGlyphsURL,"*":function(){return[]}}}));if(styleSpec.$version>7&&style.constants){errors=errors.concat(validateConstants({key:"constants",value:style.constants,style:style,styleSpec:styleSpec}))}return sortErrors(errors)}validateStyleMin.source=wrapCleanErrors(require("./validate/validate_source"));validateStyleMin.light=wrapCleanErrors(require("./validate/validate_light"));validateStyleMin.layer=wrapCleanErrors(require("./validate/validate_layer"));validateStyleMin.filter=wrapCleanErrors(require("./validate/validate_filter"));validateStyleMin.paintProperty=wrapCleanErrors(require("./validate/validate_paint_property"));validateStyleMin.layoutProperty=wrapCleanErrors(require("./validate/validate_layout_property"));function sortErrors(errors){return[].concat(errors).sort(function(a,b){return a.line-b.line})}function wrapCleanErrors(inner){return function(){return sortErrors(inner.apply(this,arguments))}}module.exports=validateStyleMin},{"../reference/latest.min":594,"./validate/validate":576,"./validate/validate_constants":580,"./validate/validate_filter":582,"./validate/validate_glyphs_url":584,"./validate/validate_layer":585,"./validate/validate_layout_property":586,"./validate/validate_light":587,"./validate/validate_paint_property":590,"./validate/validate_source":591}],594:[function(require,module,exports){module.exports=require("./v8.min.json")},{"./v8.min.json":595}],595:[function(require,module,exports){module.exports={$version:8,$root:{version:{required:true,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:true,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:true,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_tile","source_geojson","source_video","source_image"],source_tile:{type:{required:true,type:"enum",values:{vector:{},raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},"*":{type:"*"}},source_geojson:{type:{required:true,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:false},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"}},source_video:{type:{required:true,type:"enum",values:{video:{}}},urls:{required:true,type:"array",value:"string"},coordinates:{required:true,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:true,type:"enum",values:{image:{}}},url:{required:true,type:"string"},coordinates:{required:true,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:true},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},"fill-extrusion":{},raster:{},background:{}}},metadata:{type:"*"},ref:{type:"string"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"},"paint.*":{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_fill-extrusion","layout_symbol","layout_raster","layout_background"],layout_background:{visibility:{type:"enum",function:"piecewise-constant","zoom-function":true,values:{visible:{},none:{}},default:"visible"}},layout_fill:{visibility:{type:"enum",function:"piecewise-constant","zoom-function":true,values:{visible:{},none:{}},default:"visible"}},layout_circle:{visibility:{type:"enum",function:"piecewise-constant","zoom-function":true,values:{visible:{},none:{}},default:"visible"}},"layout_fill-extrusion":{visibility:{type:"enum",function:"piecewise-constant","zoom-function":true,values:{visible:{},none:{}},default:"visible"}},layout_line:{"line-cap":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":true,values:{butt:{},round:{},square:{}},default:"butt"},"line-join":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":true,values:{bevel:{},round:{},miter:{}},default:"miter"},"line-miter-limit":{type:"number",default:2,function:"interpolated","zoom-function":true,"property-function":true,requires:[{"line-join":"miter"}]},"line-round-limit":{type:"number",default:1.05,function:"interpolated","zoom-function":true,"property-function":true,requires:[{"line-join":"round"}]},visibility:{type:"enum",function:"piecewise-constant","zoom-function":true,values:{visible:{},none:{}},default:"visible"}},layout_symbol:{"symbol-placement":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":true,values:{point:{},line:{}},default:"point"},"symbol-spacing":{type:"number",default:250,minimum:1,function:"interpolated","zoom-function":true,"property-function":true,units:"pixels",requires:[{"symbol-placement":"line"}]},"symbol-avoid-edges":{type:"boolean",function:"piecewise-constant","zoom-function":true,"property-function":true,default:false},"icon-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":true,"property-function":true,default:false,requires:["icon-image"]},"icon-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":true,"property-function":true,default:false,requires:["icon-image"]},"icon-optional":{type:"boolean",function:"piecewise-constant","zoom-function":true,"property-function":true,default:false,requires:["icon-image","text-field"]},"icon-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":true,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"]},"icon-size":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":true,"property-function":true,requires:["icon-image"]},"icon-text-fit":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":false,values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"]},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",function:"interpolated","zoom-function":true,"property-function":true,requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}]},"icon-image":{type:"string",function:"piecewise-constant","zoom-function":true,"property-function":true,tokens:true},"icon-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":true,"property-function":true,units:"degrees",requires:["icon-image"]},"icon-padding":{type:"number",default:2,minimum:0,function:"interpolated","zoom-function":true,"property-function":true,units:"pixels",requires:["icon-image"]},"icon-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":true,"property-function":true,default:false,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":true,"property-function":true,requires:["icon-image"]},"text-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":true,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"]},"text-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":true,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"]},"text-field":{type:"string",function:"piecewise-constant","zoom-function":true,"property-function":true,default:"",tokens:true},"text-font":{type:"array",value:"string",function:"piecewise-constant","zoom-function":true,"property-function":true,default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"]},"text-size":{type:"number",default:16,
minimum:0,units:"pixels",function:"interpolated","zoom-function":true,"property-function":true,requires:["text-field"]},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",function:"interpolated","zoom-function":true,"property-function":true,requires:["text-field"]},"text-line-height":{type:"number",default:1.2,units:"ems",function:"interpolated","zoom-function":true,"property-function":true,requires:["text-field"]},"text-letter-spacing":{type:"number",default:0,units:"ems",function:"interpolated","zoom-function":true,"property-function":true,requires:["text-field"]},"text-justify":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":true,values:{left:{},center:{},right:{}},default:"center",requires:["text-field"]},"text-anchor":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":true,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field"]},"text-max-angle":{type:"number",default:45,units:"degrees",function:"interpolated","zoom-function":true,"property-function":true,requires:["text-field",{"symbol-placement":"line"}]},"text-rotate":{type:"number",default:0,period:360,units:"degrees",function:"interpolated","zoom-function":true,"property-function":true,requires:["text-field"]},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",function:"interpolated","zoom-function":true,"property-function":true,requires:["text-field"]},"text-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":true,"property-function":true,default:true,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":true,values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"]},"text-offset":{type:"array",value:"number",units:"ems",function:"interpolated","zoom-function":true,"property-function":true,length:2,default:[0,0],requires:["text-field"]},"text-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":true,"property-function":true,default:false,requires:["text-field"]},"text-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":true,"property-function":true,default:false,requires:["text-field"]},"text-optional":{type:"boolean",function:"piecewise-constant","zoom-function":true,"property-function":true,default:false,requires:["text-field","icon-image"]},visibility:{type:"enum",function:"piecewise-constant","zoom-function":true,values:{visible:{},none:{}},default:"visible"}},layout_raster:{visibility:{type:"enum",function:"piecewise-constant","zoom-function":true,values:{visible:{},none:{}},default:"visible"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},transition:false},position:{type:"array",default:[1.15,210,30],length:3,value:"number",transition:true,function:"interpolated","zoom-function":true,"property-function":false},color:{type:"color",default:"#ffffff",function:"interpolated","zoom-function":true,"property-function":false,transition:true},intensity:{type:"number",default:.5,minimum:0,maximum:1,function:"interpolated","zoom-function":true,"property-function":false,transition:true}},paint:["paint_fill","paint_line","paint_circle","paint_fill-extrusion","paint_symbol","paint_raster","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",function:"piecewise-constant","zoom-function":true,"property-function":true,default:true},"fill-opacity":{type:"number",function:"interpolated","zoom-function":true,"property-function":true,default:1,minimum:0,maximum:1,transition:true},"fill-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":true,"property-function":true,transition:true,requires:[{"!":"fill-pattern"}]},"fill-outline-color":{type:"color",function:"interpolated","zoom-function":true,"property-function":true,transition:true,requires:[{"!":"fill-pattern"},{"fill-antialias":true}]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels"},"fill-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":true,values:{map:{},viewport:{}},default:"map",requires:["fill-translate"]},"fill-pattern":{type:"string",function:"piecewise-constant","zoom-function":true,"property-function":true,transition:true}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",function:"interpolated","zoom-function":true,"property-function":false,default:1,minimum:0,maximum:1,transition:true},"fill-extrusion-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":true,"property-function":true,transition:true,requires:[{"!":"fill-pattern"}]},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":true,"property-function":false,transition:true,units:"pixels"},"fill-extrusion-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":false,values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"]},"fill-extrusion-pattern":{type:"string",function:"piecewise-constant","zoom-function":true,"property-function":false,transition:true},"fill-extrusion-height":{type:"number",function:"interpolated","zoom-function":true,"property-function":true,default:0,minimum:0,units:"meters",transition:true},"fill-extrusion-base":{type:"number",function:"interpolated","zoom-function":true,"property-function":true,default:0,minimum:0,units:"meters",transition:true,requires:[{"<=":"fill-extrusion-height"}]}},paint_line:{"line-opacity":{type:"number",function:"interpolated","zoom-function":true,"property-function":true,default:1,minimum:0,maximum:1,transition:true},"line-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":true,"property-function":true,transition:true,requires:[{"!":"line-pattern"}]},"line-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels"},"line-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":true,values:{map:{},viewport:{}},default:"map",requires:["line-translate"]},"line-width":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels"},"line-gap-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels"},"line-offset":{type:"number",default:0,function:"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels"},"line-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels"},"line-dasharray":{type:"array",value:"number",function:"piecewise-constant","zoom-function":true,"property-function":true,minimum:0,transition:true,units:"line widths",requires:[{"!":"line-pattern"}]},"line-pattern":{type:"string",function:"piecewise-constant","zoom-function":true,"property-function":true,transition:true}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,function:"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels"},"circle-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":true,"property-function":true,transition:true},"circle-blur":{type:"number",default:0,function:"interpolated","zoom-function":true,"property-function":true,transition:true},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":true,"property-function":true,transition:true},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels"},"circle-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":true,values:{map:{},viewport:{}},default:"map",requires:["circle-translate"]},"circle-pitch-scale":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":true,values:{map:{},viewport:{}},default:"map"},"circle-stroke-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels"},"circle-stroke-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":true,"property-function":true,transition:true},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":true,"property-function":true,transition:true}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":true,"property-function":true,transition:true,requires:["icon-image"]},"icon-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":true,"property-function":true,transition:true,requires:["icon-image"]},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":true,"property-function":true,transition:true,requires:["icon-image"]},"icon-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels",requires:["icon-image"]},"icon-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels",requires:["icon-image"]},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels",requires:["icon-image"]},"icon-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":true,values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"]},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":true,"property-function":true,transition:true,requires:["text-field"]},"text-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":true,"property-function":true,transition:true,requires:["text-field"]},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":true,"property-function":true,transition:true,requires:["text-field"]},"text-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels",requires:["text-field"]},"text-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels",requires:["text-field"]},"text-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels",requires:["text-field"]},"text-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":true,"property-function":true,values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"]}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":true,transition:true},"raster-hue-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":true,transition:true,units:"degrees"},"raster-brightness-min":{type:"number",function:"interpolated","zoom-function":true,default:0,minimum:0,maximum:1,transition:true},"raster-brightness-max":{type:"number",function:"interpolated","zoom-function":true,default:1,minimum:0,maximum:1,transition:true},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":true,transition:true},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":true,transition:true},"raster-fade-duration":{type:"number",default:300,minimum:0,function:"interpolated","zoom-function":true,transition:true,units:"milliseconds"}},paint_background:{"background-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":true,transition:true,requires:[{"!":"background-pattern"}]},"background-pattern":{type:"string",function:"piecewise-constant","zoom-function":true,transition:true},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":true,transition:true}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}}}},{}],596:[function(require,module,exports){"use strict";if(typeof module!=="undefined"&&module.exports){module.exports=isSupported}else if(window){window.mapboxgl=window.mapboxgl||{};window.mapboxgl.supported=isSupported}function isSupported(options){return!!(isBrowser()&&isArraySupported()&&isFunctionSupported()&&isObjectSupported()&&isJSONSupported()&&isWorkerSupported()&&isUint8ClampedArraySupported()&&isWebGLSupportedCached(options&&options.failIfMajorPerformanceCaveat))}function isBrowser(){return typeof window!=="undefined"&&typeof document!=="undefined"}function isArraySupported(){return Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray}function isFunctionSupported(){return Function.prototype&&Function.prototype.bind}function isObjectSupported(){return Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions}function isJSONSupported(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON}function isWorkerSupported(){return"Worker"in window}function isUint8ClampedArraySupported(){return"Uint8ClampedArray"in window}var isWebGLSupportedCache={};function isWebGLSupportedCached(failIfMajorPerformanceCaveat){if(isWebGLSupportedCache[failIfMajorPerformanceCaveat]===undefined){isWebGLSupportedCache[failIfMajorPerformanceCaveat]=isWebGLSupported(failIfMajorPerformanceCaveat)}return isWebGLSupportedCache[failIfMajorPerformanceCaveat]}isSupported.webGLContextAttributes={antialias:false,alpha:true,stencil:true,depth:true};function isWebGLSupported(failIfMajorPerformanceCaveat){var canvas=document.createElement("canvas");var attributes=Object.create(isSupported.webGLContextAttributes);attributes.failIfMajorPerformanceCaveat=failIfMajorPerformanceCaveat;if(canvas.probablySupportsContext){return canvas.probablySupportsContext("webgl",attributes)||canvas.probablySupportsContext("experimental-webgl",attributes)}else if(canvas.supportsContext){return canvas.supportsContext("webgl",attributes)||canvas.supportsContext("experimental-webgl",attributes)}else{return canvas.getContext("webgl",attributes)||canvas.getContext("experimental-webgl",attributes)}}},{}],597:[function(require,module,exports){"use strict";var ProgramConfiguration=require("./program_configuration");var Segment=function Segment(vertexOffset,primitiveOffset){this.vertexOffset=vertexOffset;this.primitiveOffset=primitiveOffset;this.vertexLength=0;this.primitiveLength=0};var ArrayGroup=function ArrayGroup(programInterface,layers,zoom){var this$1=this;this.globalProperties={zoom:zoom};var LayoutVertexArrayType=programInterface.layoutVertexArrayType;this.layoutVertexArray=new LayoutVertexArrayType;var ElementArrayType=programInterface.elementArrayType;if(ElementArrayType)this.elementArray=new ElementArrayType;var ElementArrayType2=programInterface.elementArrayType2;if(ElementArrayType2)this.elementArray2=new ElementArrayType2;this.layerData={};for(var i=0,list=layers;i<list.length;i+=1){var layer=list[i];var programConfiguration=ProgramConfiguration.createDynamic(programInterface.paintAttributes||[],layer,zoom);this$1.layerData[layer.id]={layer:layer,programConfiguration:programConfiguration,paintVertexArray:new programConfiguration.PaintVertexArray}}this.segments=[];this.segments2=[]};ArrayGroup.prototype.prepareSegment=function prepareSegment(numVertices){var segment=this.segments[this.segments.length-1];if(!segment||segment.vertexLength+numVertices>ArrayGroup.MAX_VERTEX_ARRAY_LENGTH){segment=new Segment(this.layoutVertexArray.length,this.elementArray.length);this.segments.push(segment)}return segment};ArrayGroup.prototype.prepareSegment2=function prepareSegment2(numVertices){var segment=this.segments2[this.segments2.length-1];if(!segment||segment.vertexLength+numVertices>ArrayGroup.MAX_VERTEX_ARRAY_LENGTH){segment=new Segment(this.layoutVertexArray.length,this.elementArray2.length);this.segments2.push(segment)}return segment};ArrayGroup.prototype.populatePaintArrays=function populatePaintArrays(featureProperties){var this$1=this;for(var key in this.layerData){var layerData=this$1.layerData[key];if(layerData.paintVertexArray.bytesPerElement===0)continue;layerData.programConfiguration.populatePaintArray(layerData.layer,layerData.paintVertexArray,this$1.layoutVertexArray.length,this$1.globalProperties,featureProperties)}};ArrayGroup.prototype.isEmpty=function isEmpty(){return this.layoutVertexArray.length===0};ArrayGroup.prototype.serialize=function serialize(transferables){return{layoutVertexArray:this.layoutVertexArray.serialize(transferables),elementArray:this.elementArray&&this.elementArray.serialize(transferables),elementArray2:this.elementArray2&&this.elementArray2.serialize(transferables),paintVertexArrays:serializePaintVertexArrays(this.layerData,transferables),segments:this.segments,segments2:this.segments2}};function serializePaintVertexArrays(layerData,transferables){var paintVertexArrays={};for(var layerId in layerData){var inputArray=layerData[layerId].paintVertexArray;if(inputArray.length===0)continue;var array=inputArray.serialize(transferables);var type=inputArray.constructor.serialize();paintVertexArrays[layerId]={array:array,type:type}}return paintVertexArrays}ArrayGroup.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1;module.exports=ArrayGroup},{"./program_configuration":611}],598:[function(require,module,exports){"use strict";var ArrayGroup=require("./array_group");var BufferGroup=require("./buffer_group");var util=require("../util/util");var Bucket=function Bucket(options,programInterface){this.zoom=options.zoom;this.overscaling=options.overscaling;this.layers=options.layers;this.index=options.index;if(options.arrays){this.buffers=new BufferGroup(programInterface,options.layers,options.zoom,options.arrays)}else{this.arrays=new ArrayGroup(programInterface,options.layers,options.zoom)}};Bucket.prototype.populate=function populate(features,options){var this$1=this;for(var i=0,list=features;i<list.length;i+=1){var feature=list[i];if(this$1.layers[0].filter(feature)){this$1.addFeature(feature);options.featureIndex.insert(feature,this$1.index)}}};Bucket.prototype.isEmpty=function isEmpty(){return this.arrays.isEmpty()};Bucket.prototype.serialize=function serialize(transferables){return{zoom:this.zoom,layerIds:this.layers.map(function(l){return l.id}),arrays:this.arrays.serialize(transferables)}};Bucket.prototype.destroy=function destroy(){if(this.buffers){this.buffers.destroy();this.buffers=null}};module.exports=Bucket;Bucket.deserialize=function(input,style){if(!style)return;var output={};for(var i=0,list=input;i<list.length;i+=1){var serialized=list[i];var layers=serialized.layerIds.map(function(id){return style.getLayer(id)}).filter(Boolean);if(layers.length===0){continue}var bucket=layers[0].createBucket(util.extend({layers:layers},serialized));for(var i$1=0,list$1=layers;i$1<list$1.length;i$1+=1){var layer=list$1[i$1];output[layer.id]=bucket}}return output}},{"../util/util":723,"./array_group":597,"./buffer_group":605}],599:[function(require,module,exports){"use strict";var Bucket=require("../bucket");var createVertexArrayType=require("../vertex_array_type");var createElementArrayType=require("../element_array_type");var loadGeometry=require("../load_geometry");var EXTENT=require("../extent");var circleInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:createElementArrayType(),paintAttributes:[{property:"circle-color",type:"Uint8"},{property:"circle-radius",type:"Uint16",multiplier:10},{property:"circle-blur",type:"Uint16",multiplier:10},{property:"circle-opacity",type:"Uint8",multiplier:255},{property:"circle-stroke-color",type:"Uint8"},{property:"circle-stroke-width",type:"Uint16",multiplier:10},{property:"circle-stroke-opacity",type:"Uint8",multiplier:255}]};function addCircleVertex(layoutVertexArray,x,y,extrudeX,extrudeY){layoutVertexArray.emplaceBack(x*2+(extrudeX+1)/2,y*2+(extrudeY+1)/2)}var CircleBucket=function(Bucket){function CircleBucket(options){Bucket.call(this,options,circleInterface)}if(Bucket)CircleBucket.__proto__=Bucket;CircleBucket.prototype=Object.create(Bucket&&Bucket.prototype);CircleBucket.prototype.constructor=CircleBucket;CircleBucket.prototype.addFeature=function addFeature(feature){var arrays=this.arrays;for(var i=0,list=loadGeometry(feature);i<list.length;i+=1){var ring=list[i];for(var i$1=0,list$1=ring;i$1<list$1.length;i$1+=1){var point=list$1[i$1];var x=point.x;var y=point.y;if(x<0||x>=EXTENT||y<0||y>=EXTENT)continue;var segment=arrays.prepareSegment(4);var index=segment.vertexLength;addCircleVertex(arrays.layoutVertexArray,x,y,-1,-1);addCircleVertex(arrays.layoutVertexArray,x,y,1,-1);addCircleVertex(arrays.layoutVertexArray,x,y,1,1);addCircleVertex(arrays.layoutVertexArray,x,y,-1,1);arrays.elementArray.emplaceBack(index,index+1,index+2);arrays.elementArray.emplaceBack(index,index+3,index+2);segment.vertexLength+=4;segment.primitiveLength+=2}}arrays.populatePaintArrays(feature.properties)};return CircleBucket}(Bucket);module.exports=CircleBucket},{"../bucket":598,"../element_array_type":606,"../extent":607,"../load_geometry":609,"../vertex_array_type":613}],600:[function(require,module,exports){"use strict";var Bucket=require("../bucket");var createVertexArrayType=require("../vertex_array_type");var createElementArrayType=require("../element_array_type");var loadGeometry=require("../load_geometry");var earcut=require("earcut");var classifyRings=require("../../util/classify_rings");var EARCUT_MAX_RINGS=500;var fillInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:createElementArrayType(3),elementArrayType2:createElementArrayType(2),paintAttributes:[{property:"fill-color",type:"Uint8"},{property:"fill-outline-color",type:"Uint8"},{property:"fill-opacity",type:"Uint8",multiplier:255}]};var FillBucket=function(Bucket){function FillBucket(options){Bucket.call(this,options,fillInterface)}if(Bucket)FillBucket.__proto__=Bucket;FillBucket.prototype=Object.create(Bucket&&Bucket.prototype);FillBucket.prototype.constructor=FillBucket;FillBucket.prototype.addFeature=function addFeature(feature){var arrays=this.arrays;for(var i$2=0,list=classifyRings(loadGeometry(feature),EARCUT_MAX_RINGS);i$2<list.length;i$2+=1){var polygon=list[i$2];var numVertices=0;for(var i$3=0,list$1=polygon;i$3<list$1.length;i$3+=1){var ring=list$1[i$3];numVertices+=ring.length}var triangleSegment=arrays.prepareSegment(numVertices);var triangleIndex=triangleSegment.vertexLength;var flattened=[];var holeIndices=[];for(var i$4=0,list$2=polygon;i$4<list$2.length;i$4+=1){var ring$1=list$2[i$4];if(ring$1.length===0){continue}if(ring$1!==polygon[0]){holeIndices.push(flattened.length/2)}var lineSegment=arrays.prepareSegment2(ring$1.length);var lineIndex=lineSegment.vertexLength;arrays.layoutVertexArray.emplaceBack(ring$1[0].x,ring$1[0].y);arrays.elementArray2.emplaceBack(lineIndex+ring$1.length-1,lineIndex);flattened.push(ring$1[0].x);flattened.push(ring$1[0].y);for(var i=1;i<ring$1.length;i++){arrays.layoutVertexArray.emplaceBack(ring$1[i].x,ring$1[i].y);arrays.elementArray2.emplaceBack(lineIndex+i-1,lineIndex+i);flattened.push(ring$1[i].x);flattened.push(ring$1[i].y)}lineSegment.vertexLength+=ring$1.length;lineSegment.primitiveLength+=ring$1.length}var indices=earcut(flattened,holeIndices);for(var i$1=0;i$1<indices.length;i$1+=3){arrays.elementArray.emplaceBack(triangleIndex+indices[i$1],triangleIndex+indices[i$1+1],triangleIndex+indices[i$1+2])}triangleSegment.vertexLength+=numVertices;triangleSegment.primitiveLength+=indices.length/3}arrays.populatePaintArrays(feature.properties)};return FillBucket}(Bucket);module.exports=FillBucket},{"../../util/classify_rings":707,"../bucket":598,"../element_array_type":606,"../load_geometry":609,"../vertex_array_type":613,earcut:388}],601:[function(require,module,exports){"use strict";var Bucket=require("../bucket");var createVertexArrayType=require("../vertex_array_type");var createElementArrayType=require("../element_array_type");var loadGeometry=require("../load_geometry");var EXTENT=require("../extent");var earcut=require("earcut");var classifyRings=require("../../util/classify_rings");var EARCUT_MAX_RINGS=500;var fillExtrusionInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal",components:3,type:"Int16"},{name:"a_edgedistance",components:1,type:"Int16"}]),elementArrayType:createElementArrayType(3),paintAttributes:[{property:"fill-extrusion-base",type:"Uint16"},{property:"fill-extrusion-height",type:"Uint16"},{property:"fill-extrusion-color",type:"Uint8"}]};var FACTOR=Math.pow(2,13);function addVertex(vertexArray,x,y,nx,ny,nz,t,e){vertexArray.emplaceBack(x,y,Math.floor(nx*FACTOR)*2+t,ny*FACTOR*2,nz*FACTOR*2,Math.round(e))}var FillExtrusionBucket=function(Bucket){function FillExtrusionBucket(options){Bucket.call(this,options,fillExtrusionInterface)}if(Bucket)FillExtrusionBucket.__proto__=Bucket;FillExtrusionBucket.prototype=Object.create(Bucket&&Bucket.prototype);FillExtrusionBucket.prototype.constructor=FillExtrusionBucket;FillExtrusionBucket.prototype.addFeature=function addFeature(feature){var arrays=this.arrays;for(var i=0,list=classifyRings(loadGeometry(feature),EARCUT_MAX_RINGS);i<list.length;i+=1){var polygon=list[i];var numVertices=0;for(var i$1=0,list$1=polygon;i$1<list$1.length;i$1+=1){var ring=list$1[i$1];numVertices+=ring.length}var segment=arrays.prepareSegment(numVertices*5);var flattened=[];var holeIndices=[];var indices=[];for(var i$2=0,list$2=polygon;i$2<list$2.length;i$2+=1){var ring$1=list$2[i$2];if(ring$1.length===0){continue}if(ring$1!==polygon[0]){holeIndices.push(flattened.length/2)}var edgeDistance=0;for(var p=0;p<ring$1.length;p++){var p1=ring$1[p];addVertex(arrays.layoutVertexArray,p1.x,p1.y,0,0,1,1,0);indices.push(segment.vertexLength++);if(p>=1){var p2=ring$1[p-1];if(!isBoundaryEdge(p1,p2)){var perp=p1.sub(p2)._perp()._unit();addVertex(arrays.layoutVertexArray,p1.x,p1.y,perp.x,perp.y,0,0,edgeDistance);addVertex(arrays.layoutVertexArray,p1.x,p1.y,perp.x,perp.y,0,1,edgeDistance);edgeDistance+=p2.dist(p1);addVertex(arrays.layoutVertexArray,p2.x,p2.y,perp.x,perp.y,0,0,edgeDistance);addVertex(arrays.layoutVertexArray,p2.x,p2.y,perp.x,perp.y,0,1,edgeDistance);var bottomRight=segment.vertexLength;arrays.elementArray.emplaceBack(bottomRight,bottomRight+1,bottomRight+2);arrays.elementArray.emplaceBack(bottomRight+1,bottomRight+2,bottomRight+3);segment.vertexLength+=4;segment.primitiveLength+=2}}flattened.push(p1.x);flattened.push(p1.y)}}var triangleIndices=earcut(flattened,holeIndices);for(var j=0;j<triangleIndices.length;j+=3){arrays.elementArray.emplaceBack(indices[triangleIndices[j]],indices[triangleIndices[j+1]],indices[triangleIndices[j+2]])}segment.primitiveLength+=triangleIndices.length/3}arrays.populatePaintArrays(feature.properties)};return FillExtrusionBucket}(Bucket);module.exports=FillExtrusionBucket;function isBoundaryEdge(p1,p2){return p1.x===p2.x&&(p1.x<0||p1.x>EXTENT)||p1.y===p2.y&&(p1.y<0||p1.y>EXTENT)}},{"../../util/classify_rings":707,"../bucket":598,"../element_array_type":606,"../extent":607,"../load_geometry":609,"../vertex_array_type":613,earcut:388}],602:[function(require,module,exports){"use strict";var Bucket=require("../bucket");var createVertexArrayType=require("../vertex_array_type");var createElementArrayType=require("../element_array_type");var loadGeometry=require("../load_geometry");var EXTENT=require("../extent");var EXTRUDE_SCALE=63;var COS_HALF_SHARP_CORNER=Math.cos(75/2*(Math.PI/180));var SHARP_CORNER_OFFSET=15;var LINE_DISTANCE_BUFFER_BITS=15;var LINE_DISTANCE_SCALE=1/2;var MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE;var lineInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}]),paintAttributes:[{property:"line-color",type:"Uint8"},{property:"line-blur",multiplier:10,type:"Uint8"},{property:"line-opacity",multiplier:10,type:"Uint8"},{property:"line-gap-width",multiplier:10,type:"Uint8",name:"a_gapwidth"},{property:"line-offset",multiplier:1,type:"Int8"}],elementArrayType:createElementArrayType()};function addLineVertex(layoutVertexBuffer,point,extrude,tx,ty,dir,linesofar){layoutVertexBuffer.emplaceBack(point.x<<1|tx,point.y<<1|ty,Math.round(EXTRUDE_SCALE*extrude.x)+128,Math.round(EXTRUDE_SCALE*extrude.y)+128,(dir===0?0:dir<0?-1:1)+1|(linesofar*LINE_DISTANCE_SCALE&63)<<2,linesofar*LINE_DISTANCE_SCALE>>6)}var LineBucket=function(Bucket){function LineBucket(options){Bucket.call(this,options,lineInterface)}if(Bucket)LineBucket.__proto__=Bucket;LineBucket.prototype=Object.create(Bucket&&Bucket.prototype);LineBucket.prototype.constructor=LineBucket;LineBucket.prototype.addFeature=function addFeature(feature){var this$1=this;var layout=this.layers[0].layout;var join=layout["line-join"];var cap=layout["line-cap"];var miterLimit=layout["line-miter-limit"];var roundLimit=layout["line-round-limit"];for(var i=0,list=loadGeometry(feature,LINE_DISTANCE_BUFFER_BITS);i<list.length;i+=1){var line=list[i];this$1.addLine(line,feature.properties,join,cap,miterLimit,roundLimit)}};LineBucket.prototype.addLine=function addLine(vertices,featureProperties,join,cap,miterLimit,roundLimit){var this$1=this;var len=vertices.length;while(len>2&&vertices[len-1].equals(vertices[len-2])){len--}if(vertices.length<2)return;if(join==="bevel")miterLimit=1.05;var sharpCornerOffset=SHARP_CORNER_OFFSET*(EXTENT/(512*this.overscaling));var firstVertex=vertices[0],lastVertex=vertices[len-1],closed=firstVertex.equals(lastVertex);var arrays=this.arrays;var segment=arrays.prepareSegment(len*10);if(len===2&&closed)return;this.distance=0;var beginCap=cap,endCap=closed?"butt":cap;var startOfLine=true;var currentVertex,prevVertex,nextVertex,prevNormal,nextNormal,offsetA,offsetB;this.e1=this.e2=this.e3=-1;if(closed){currentVertex=vertices[len-2];nextNormal=firstVertex.sub(currentVertex)._unit()._perp()}for(var i=0;i<len;i++){nextVertex=closed&&i===len-1?vertices[1]:vertices[i+1];
if(nextVertex&&vertices[i].equals(nextVertex))continue;if(nextNormal)prevNormal=nextNormal;if(currentVertex)prevVertex=currentVertex;currentVertex=vertices[i];nextNormal=nextVertex?nextVertex.sub(currentVertex)._unit()._perp():prevNormal;prevNormal=prevNormal||nextNormal;var joinNormal=prevNormal.add(nextNormal)._unit();var cosHalfAngle=joinNormal.x*nextNormal.x+joinNormal.y*nextNormal.y;var miterLength=1/cosHalfAngle;var isSharpCorner=cosHalfAngle<COS_HALF_SHARP_CORNER&&prevVertex&&nextVertex;if(isSharpCorner&&i>0){var prevSegmentLength=currentVertex.dist(prevVertex);if(prevSegmentLength>2*sharpCornerOffset){var newPrevVertex=currentVertex.sub(currentVertex.sub(prevVertex)._mult(sharpCornerOffset/prevSegmentLength)._round());this$1.distance+=newPrevVertex.dist(prevVertex);this$1.addCurrentVertex(newPrevVertex,this$1.distance,prevNormal.mult(1),0,0,false,segment);prevVertex=newPrevVertex}}var middleVertex=prevVertex&&nextVertex;var currentJoin=middleVertex?join:nextVertex?beginCap:endCap;if(middleVertex&&currentJoin==="round"){if(miterLength<roundLimit){currentJoin="miter"}else if(miterLength<=2){currentJoin="fakeround"}}if(currentJoin==="miter"&&miterLength>miterLimit){currentJoin="bevel"}if(currentJoin==="bevel"){if(miterLength>2)currentJoin="flipbevel";if(miterLength<miterLimit)currentJoin="miter"}if(prevVertex)this$1.distance+=currentVertex.dist(prevVertex);if(currentJoin==="miter"){joinNormal._mult(miterLength);this$1.addCurrentVertex(currentVertex,this$1.distance,joinNormal,0,0,false,segment)}else if(currentJoin==="flipbevel"){if(miterLength>100){joinNormal=nextNormal.clone()}else{var direction=prevNormal.x*nextNormal.y-prevNormal.y*nextNormal.x>0?-1:1;var bevelLength=miterLength*prevNormal.add(nextNormal).mag()/prevNormal.sub(nextNormal).mag();joinNormal._perp()._mult(bevelLength*direction)}this$1.addCurrentVertex(currentVertex,this$1.distance,joinNormal,0,0,false,segment);this$1.addCurrentVertex(currentVertex,this$1.distance,joinNormal.mult(-1),0,0,false,segment)}else if(currentJoin==="bevel"||currentJoin==="fakeround"){var lineTurnsLeft=prevNormal.x*nextNormal.y-prevNormal.y*nextNormal.x>0;var offset=-Math.sqrt(miterLength*miterLength-1);if(lineTurnsLeft){offsetB=0;offsetA=offset}else{offsetA=0;offsetB=offset}if(!startOfLine){this$1.addCurrentVertex(currentVertex,this$1.distance,prevNormal,offsetA,offsetB,false,segment)}if(currentJoin==="fakeround"){var n=Math.floor((.5-(cosHalfAngle-.5))*8);var approxFractionalJoinNormal;for(var m=0;m<n;m++){approxFractionalJoinNormal=nextNormal.mult((m+1)/(n+1))._add(prevNormal)._unit();this$1.addPieSliceVertex(currentVertex,this$1.distance,approxFractionalJoinNormal,lineTurnsLeft,segment)}this$1.addPieSliceVertex(currentVertex,this$1.distance,joinNormal,lineTurnsLeft,segment);for(var k=n-1;k>=0;k--){approxFractionalJoinNormal=prevNormal.mult((k+1)/(n+1))._add(nextNormal)._unit();this$1.addPieSliceVertex(currentVertex,this$1.distance,approxFractionalJoinNormal,lineTurnsLeft,segment)}}if(nextVertex){this$1.addCurrentVertex(currentVertex,this$1.distance,nextNormal,-offsetA,-offsetB,false,segment)}}else if(currentJoin==="butt"){if(!startOfLine){this$1.addCurrentVertex(currentVertex,this$1.distance,prevNormal,0,0,false,segment)}if(nextVertex){this$1.addCurrentVertex(currentVertex,this$1.distance,nextNormal,0,0,false,segment)}}else if(currentJoin==="square"){if(!startOfLine){this$1.addCurrentVertex(currentVertex,this$1.distance,prevNormal,1,1,false,segment);this$1.e1=this$1.e2=-1}if(nextVertex){this$1.addCurrentVertex(currentVertex,this$1.distance,nextNormal,-1,-1,false,segment)}}else if(currentJoin==="round"){if(!startOfLine){this$1.addCurrentVertex(currentVertex,this$1.distance,prevNormal,0,0,false,segment);this$1.addCurrentVertex(currentVertex,this$1.distance,prevNormal,1,1,true,segment);this$1.e1=this$1.e2=-1}if(nextVertex){this$1.addCurrentVertex(currentVertex,this$1.distance,nextNormal,-1,-1,true,segment);this$1.addCurrentVertex(currentVertex,this$1.distance,nextNormal,0,0,false,segment)}}if(isSharpCorner&&i<len-1){var nextSegmentLength=currentVertex.dist(nextVertex);if(nextSegmentLength>2*sharpCornerOffset){var newCurrentVertex=currentVertex.add(nextVertex.sub(currentVertex)._mult(sharpCornerOffset/nextSegmentLength)._round());this$1.distance+=newCurrentVertex.dist(currentVertex);this$1.addCurrentVertex(newCurrentVertex,this$1.distance,nextNormal.mult(1),0,0,false,segment);currentVertex=newCurrentVertex}}startOfLine=false}arrays.populatePaintArrays(featureProperties)};LineBucket.prototype.addCurrentVertex=function addCurrentVertex(currentVertex,distance,normal,endLeft,endRight,round,segment){var tx=round?1:0;var extrude;var arrays=this.arrays;var layoutVertexArray=arrays.layoutVertexArray;var elementArray=arrays.elementArray;extrude=normal.clone();if(endLeft)extrude._sub(normal.perp()._mult(endLeft));addLineVertex(layoutVertexArray,currentVertex,extrude,tx,0,endLeft,distance);this.e3=segment.vertexLength++;if(this.e1>=0&&this.e2>=0){elementArray.emplaceBack(this.e1,this.e2,this.e3);segment.primitiveLength++}this.e1=this.e2;this.e2=this.e3;extrude=normal.mult(-1);if(endRight)extrude._sub(normal.perp()._mult(endRight));addLineVertex(layoutVertexArray,currentVertex,extrude,tx,1,-endRight,distance);this.e3=segment.vertexLength++;if(this.e1>=0&&this.e2>=0){elementArray.emplaceBack(this.e1,this.e2,this.e3);segment.primitiveLength++}this.e1=this.e2;this.e2=this.e3;if(distance>MAX_LINE_DISTANCE/2){this.distance=0;this.addCurrentVertex(currentVertex,this.distance,normal,endLeft,endRight,round,segment)}};LineBucket.prototype.addPieSliceVertex=function addPieSliceVertex(currentVertex,distance,extrude,lineTurnsLeft,segment){var ty=lineTurnsLeft?1:0;extrude=extrude.mult(lineTurnsLeft?-1:1);var arrays=this.arrays;var layoutVertexArray=arrays.layoutVertexArray;var elementArray=arrays.elementArray;addLineVertex(layoutVertexArray,currentVertex,extrude,0,ty,0,distance);this.e3=segment.vertexLength++;if(this.e1>=0&&this.e2>=0){elementArray.emplaceBack(this.e1,this.e2,this.e3);segment.primitiveLength++}if(lineTurnsLeft){this.e2=this.e3}else{this.e1=this.e3}};return LineBucket}(Bucket);module.exports=LineBucket},{"../bucket":598,"../element_array_type":606,"../extent":607,"../load_geometry":609,"../vertex_array_type":613}],603:[function(require,module,exports){"use strict";var Point=require("point-geometry");var ArrayGroup=require("../array_group");var BufferGroup=require("../buffer_group");var createVertexArrayType=require("../vertex_array_type");var createElementArrayType=require("../element_array_type");var EXTENT=require("../extent");var Anchor=require("../../symbol/anchor");var getAnchors=require("../../symbol/get_anchors");var resolveTokens=require("../../util/token");var Quads=require("../../symbol/quads");var Shaping=require("../../symbol/shaping");var resolveText=require("../../symbol/resolve_text");var mergeLines=require("../../symbol/mergelines");var clipLine=require("../../symbol/clip_line");var util=require("../../util/util");var scriptDetection=require("../../util/script_detection");var loadGeometry=require("../load_geometry");var CollisionFeature=require("../../symbol/collision_feature");var findPoleOfInaccessibility=require("../../util/find_pole_of_inaccessibility");var classifyRings=require("../../util/classify_rings");var VectorTileFeature=require("vector-tile").VectorTileFeature;var shapeText=Shaping.shapeText;var shapeIcon=Shaping.shapeIcon;var WritingMode=Shaping.WritingMode;var getGlyphQuads=Quads.getGlyphQuads;var getIconQuads=Quads.getIconQuads;var elementArrayType=createElementArrayType();var layoutVertexArrayType=createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_offset",components:2,type:"Int16"},{name:"a_texture_pos",components:2,type:"Uint16"},{name:"a_data",components:4,type:"Uint8"}]);var symbolInterfaces={glyph:{layoutVertexArrayType:layoutVertexArrayType,elementArrayType:elementArrayType},icon:{layoutVertexArrayType:layoutVertexArrayType,elementArrayType:elementArrayType},collisionBox:{layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"},{name:"a_data",components:2,type:"Uint8"}]),elementArrayType:createElementArrayType(2)}};function addVertex(array,x,y,ox,oy,tx,ty,minzoom,maxzoom,labelminzoom,labelangle){array.emplaceBack(x,y,Math.round(ox*64),Math.round(oy*64),tx/4,ty/4,(labelminzoom||0)*10,labelangle,(minzoom||0)*10,Math.min(maxzoom||25,25)*10)}function addCollisionBoxVertex(layoutVertexArray,point,extrude,maxZoom,placementZoom){return layoutVertexArray.emplaceBack(point.x,point.y,Math.round(extrude.x),Math.round(extrude.y),maxZoom*10,placementZoom*10)}var SymbolBucket=function SymbolBucket(options){var this$1=this;this.collisionBoxArray=options.collisionBoxArray;this.symbolQuadsArray=options.symbolQuadsArray;this.symbolInstancesArray=options.symbolInstancesArray;this.zoom=options.zoom;this.overscaling=options.overscaling;this.layers=options.layers;this.index=options.index;this.sdfIcons=options.sdfIcons;this.iconsNeedLinear=options.iconsNeedLinear;this.adjustedTextSize=options.adjustedTextSize;this.adjustedIconSize=options.adjustedIconSize;this.fontstack=options.fontstack;if(options.arrays){this.buffers={};for(var id in options.arrays){if(options.arrays[id]){this$1.buffers[id]=new BufferGroup(symbolInterfaces[id],options.layers,options.zoom,options.arrays[id])}}}};SymbolBucket.prototype.populate=function populate(features,options){var this$1=this;var layout=this.layers[0].layout;var textField=layout["text-field"];var textFont=layout["text-font"];var iconImage=layout["icon-image"];var hasText=textField&&textFont;var hasIcon=iconImage;this.features=[];if(!hasText&&!hasIcon){return}var icons=options.iconDependencies;var stacks=options.glyphDependencies;var stack=stacks[textFont]=stacks[textFont]||{};for(var i=0;i<features.length;i++){var feature=features[i];if(!this$1.layers[0].filter(feature)){continue}var text;if(hasText){text=resolveText(feature,layout)}var icon;if(hasIcon){icon=resolveTokens(feature.properties,iconImage)}if(!text&&!icon){continue}this$1.features.push({text:text,icon:icon,index:i,sourceLayerIndex:feature.sourceLayerIndex,geometry:loadGeometry(feature),properties:feature.properties,type:VectorTileFeature.types[feature.type]});if(icon){icons[icon]=true}if(text){for(var i$1=0;i$1<text.length;i$1++){stack[text.charCodeAt(i$1)]=true}}}if(layout["symbol-placement"]==="line"){this.features=mergeLines(this.features)}};SymbolBucket.prototype.isEmpty=function isEmpty(){return this.arrays.icon.isEmpty()&&this.arrays.glyph.isEmpty()&&this.arrays.collisionBox.isEmpty()};SymbolBucket.prototype.serialize=function serialize(transferables){return{zoom:this.zoom,layerIds:this.layers.map(function(l){return l.id}),sdfIcons:this.sdfIcons,iconsNeedLinear:this.iconsNeedLinear,adjustedTextSize:this.adjustedTextSize,adjustedIconSize:this.adjustedIconSize,fontstack:this.fontstack,arrays:util.mapObject(this.arrays,function(a){return a.isEmpty()?null:a.serialize(transferables)})}};SymbolBucket.prototype.destroy=function destroy(){if(this.buffers){if(this.buffers.icon)this.buffers.icon.destroy();if(this.buffers.glyph)this.buffers.glyph.destroy();if(this.buffers.collisionBox)this.buffers.collisionBox.destroy();this.buffers=null}};SymbolBucket.prototype.createArrays=function createArrays(){var this$1=this;this.arrays=util.mapObject(symbolInterfaces,function(programInterface){return new ArrayGroup(programInterface,this$1.layers,this$1.zoom)})};SymbolBucket.prototype.prepare=function prepare(stacks,icons){var this$1=this;this.createArrays();this.adjustedTextMaxSize=this.layers[0].getLayoutValue("text-size",{zoom:18});this.adjustedTextSize=this.layers[0].getLayoutValue("text-size",{zoom:this.zoom+1});this.adjustedIconMaxSize=this.layers[0].getLayoutValue("icon-size",{zoom:18});this.adjustedIconSize=this.layers[0].getLayoutValue("icon-size",{zoom:this.zoom+1});var tileSize=512*this.overscaling;this.tilePixelRatio=EXTENT/tileSize;this.compareText={};this.iconsNeedLinear=false;this.symbolInstancesStartIndex=this.symbolInstancesArray.length;var layout=this.layers[0].layout;var horizontalAlign=.5,verticalAlign=.5;switch(layout["text-anchor"]){case"right":case"top-right":case"bottom-right":horizontalAlign=1;break;case"left":case"top-left":case"bottom-left":horizontalAlign=0;break}switch(layout["text-anchor"]){case"bottom":case"bottom-right":case"bottom-left":verticalAlign=1;break;case"top":case"top-right":case"top-left":verticalAlign=0;break}var justify=layout["text-justify"]==="right"?1:layout["text-justify"]==="left"?0:.5;var oneEm=24;var lineHeight=layout["text-line-height"]*oneEm;var maxWidth=layout["symbol-placement"]!=="line"?layout["text-max-width"]*oneEm:0;var spacing=layout["text-letter-spacing"]*oneEm;var textOffset=[layout["text-offset"][0]*oneEm,layout["text-offset"][1]*oneEm];var fontstack=this.fontstack=layout["text-font"].join(",");var textAlongLine=layout["text-rotation-alignment"]==="map"&&layout["symbol-placement"]==="line";for(var i=0,list=this.features;i<list.length;i+=1){var feature=list[i];var shapedTextOrientations;if(feature.text){var allowsVerticalWritingMode=scriptDetection.allowsVerticalWritingMode(feature.text);shapedTextOrientations={};shapedTextOrientations[WritingMode.horizontal]=shapeText(feature.text,stacks[fontstack],maxWidth,lineHeight,horizontalAlign,verticalAlign,justify,spacing,textOffset,oneEm,WritingMode.horizontal);shapedTextOrientations[WritingMode.vertical]=allowsVerticalWritingMode&&textAlongLine&&shapeText(feature.text,stacks[fontstack],maxWidth,lineHeight,horizontalAlign,verticalAlign,justify,spacing,textOffset,oneEm,WritingMode.vertical)}else{shapedTextOrientations={}}var shapedIcon;if(feature.icon){var image=icons[feature.icon];var iconOffset=this$1.layers[0].getLayoutValue("icon-offset",{zoom:this$1.zoom},feature.properties);shapedIcon=shapeIcon(image,iconOffset);if(image){if(this$1.sdfIcons===undefined){this$1.sdfIcons=image.sdf}else if(this$1.sdfIcons!==image.sdf){util.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer")}if(image.pixelRatio!==1){this$1.iconsNeedLinear=true}else if(layout["icon-rotate"]!==0||!this$1.layers[0].isLayoutValueFeatureConstant("icon-rotate")){this$1.iconsNeedLinear=true}}}if(shapedTextOrientations[WritingMode.horizontal]||shapedIcon){this$1.addFeature(feature,shapedTextOrientations,shapedIcon)}}this.symbolInstancesEndIndex=this.symbolInstancesArray.length};SymbolBucket.prototype.addFeature=function addFeature(feature,shapedTextOrientations,shapedIcon){var this$1=this;var layout=this.layers[0].layout,glyphSize=24,fontScale=this.adjustedTextSize/glyphSize,textMaxSize=this.adjustedTextMaxSize!==undefined?this.adjustedTextMaxSize:this.adjustedTextSize,textBoxScale=this.tilePixelRatio*fontScale,textMaxBoxScale=this.tilePixelRatio*textMaxSize/glyphSize,iconBoxScale=this.tilePixelRatio*this.adjustedIconSize,symbolMinDistance=this.tilePixelRatio*layout["symbol-spacing"],avoidEdges=layout["symbol-avoid-edges"],textPadding=layout["text-padding"]*this.tilePixelRatio,iconPadding=layout["icon-padding"]*this.tilePixelRatio,textMaxAngle=layout["text-max-angle"]/180*Math.PI,textAlongLine=layout["text-rotation-alignment"]==="map"&&layout["symbol-placement"]==="line",iconAlongLine=layout["icon-rotation-alignment"]==="map"&&layout["symbol-placement"]==="line",mayOverlap=layout["text-allow-overlap"]||layout["icon-allow-overlap"]||layout["text-ignore-placement"]||layout["icon-ignore-placement"],symbolPlacement=layout["symbol-placement"],textRepeatDistance=symbolMinDistance/2;var addSymbolInstance=function(line,anchor){var inside=!(anchor.x<0||anchor.x>EXTENT||anchor.y<0||anchor.y>EXTENT);if(avoidEdges&&!inside)return;var addToBuffers=inside||mayOverlap;this$1.addSymbolInstance(anchor,line,shapedTextOrientations,shapedIcon,this$1.layers[0],addToBuffers,this$1.symbolInstancesArray.length,this$1.collisionBoxArray,feature.index,feature.sourceLayerIndex,this$1.index,textBoxScale,textPadding,textAlongLine,iconBoxScale,iconPadding,iconAlongLine,{zoom:this$1.zoom},feature.properties)};if(symbolPlacement==="line"){for(var i=0,list=clipLine(feature.geometry,0,0,EXTENT,EXTENT);i<list.length;i+=1){var line=list[i];var anchors=getAnchors(line,symbolMinDistance,textMaxAngle,shapedTextOrientations[WritingMode.vertical]||shapedTextOrientations[WritingMode.horizontal],shapedIcon,glyphSize,textMaxBoxScale,this$1.overscaling,EXTENT);for(var i$1=0,list$1=anchors;i$1<list$1.length;i$1+=1){var anchor=list$1[i$1];var shapedText=shapedTextOrientations[WritingMode.horizontal];if(!shapedText||!this$1.anchorIsTooClose(shapedText.text,textRepeatDistance,anchor)){addSymbolInstance(line,anchor)}}}}else if(feature.type==="Polygon"){for(var i$2=0,list$2=classifyRings(feature.geometry,0);i$2<list$2.length;i$2+=1){var polygon=list$2[i$2];var poi=findPoleOfInaccessibility(polygon,16);addSymbolInstance(polygon[0],new Anchor(poi.x,poi.y,0))}}else if(feature.type==="LineString"){for(var i$3=0,list$3=feature.geometry;i$3<list$3.length;i$3+=1){var line$1=list$3[i$3];addSymbolInstance(line$1,new Anchor(line$1[0].x,line$1[0].y,0))}}else if(feature.type==="Point"){for(var i$4=0,list$4=feature.geometry;i$4<list$4.length;i$4+=1){var points=list$4[i$4];for(var i$5=0,list$5=points;i$5<list$5.length;i$5+=1){var point=list$5[i$5];addSymbolInstance([point],new Anchor(point.x,point.y,0))}}}};SymbolBucket.prototype.anchorIsTooClose=function anchorIsTooClose(text,repeatDistance,anchor){var compareText=this.compareText;if(!(text in compareText)){compareText[text]=[]}else{var otherAnchors=compareText[text];for(var k=otherAnchors.length-1;k>=0;k--){if(anchor.dist(otherAnchors[k])<repeatDistance){return true}}}compareText[text].push(anchor);return false};SymbolBucket.prototype.place=function place(collisionTile,showCollisionBoxes){var this$1=this;this.createArrays();var layout=this.layers[0].layout;var maxScale=collisionTile.maxScale;var textAlongLine=layout["text-rotation-alignment"]==="map"&&layout["symbol-placement"]==="line";var iconAlongLine=layout["icon-rotation-alignment"]==="map"&&layout["symbol-placement"]==="line";var mayOverlap=layout["text-allow-overlap"]||layout["icon-allow-overlap"]||layout["text-ignore-placement"]||layout["icon-ignore-placement"];if(mayOverlap){var symbolInstancesStructTypeArray=this.symbolInstancesArray.toArray(this.symbolInstancesStartIndex,this.symbolInstancesEndIndex);var angle=collisionTile.angle;var sin=Math.sin(angle),cos=Math.cos(angle);this.sortedSymbolInstances=symbolInstancesStructTypeArray.sort(function(a,b){var aRotated=sin*a.anchorPointX+cos*a.anchorPointY|0;var bRotated=sin*b.anchorPointX+cos*b.anchorPointY|0;return aRotated-bRotated||b.index-a.index})}for(var p=this.symbolInstancesStartIndex;p<this.symbolInstancesEndIndex;p++){var symbolInstance=this$1.sortedSymbolInstances?this$1.sortedSymbolInstances[p-this$1.symbolInstancesStartIndex]:this$1.symbolInstancesArray.get(p);var textCollisionFeature={boxStartIndex:symbolInstance.textBoxStartIndex,boxEndIndex:symbolInstance.textBoxEndIndex};var iconCollisionFeature={boxStartIndex:symbolInstance.iconBoxStartIndex,boxEndIndex:symbolInstance.iconBoxEndIndex};var hasText=!(symbolInstance.textBoxStartIndex===symbolInstance.textBoxEndIndex);var hasIcon=!(symbolInstance.iconBoxStartIndex===symbolInstance.iconBoxEndIndex);var iconWithoutText=layout["text-optional"]||!hasText,textWithoutIcon=layout["icon-optional"]||!hasIcon;var glyphScale=hasText?collisionTile.placeCollisionFeature(textCollisionFeature,layout["text-allow-overlap"],layout["symbol-avoid-edges"]):collisionTile.minScale;var iconScale=hasIcon?collisionTile.placeCollisionFeature(iconCollisionFeature,layout["icon-allow-overlap"],layout["symbol-avoid-edges"]):collisionTile.minScale;if(!iconWithoutText&&!textWithoutIcon){iconScale=glyphScale=Math.max(iconScale,glyphScale)}else if(!textWithoutIcon&&glyphScale){glyphScale=Math.max(iconScale,glyphScale)}else if(!iconWithoutText&&iconScale){iconScale=Math.max(iconScale,glyphScale)}if(hasText){collisionTile.insertCollisionFeature(textCollisionFeature,glyphScale,layout["text-ignore-placement"]);if(glyphScale<=maxScale){this$1.addSymbols(this$1.arrays.glyph,symbolInstance.glyphQuadStartIndex,symbolInstance.glyphQuadEndIndex,glyphScale,layout["text-keep-upright"],textAlongLine,collisionTile.angle,symbolInstance.writingModes)}}if(hasIcon){collisionTile.insertCollisionFeature(iconCollisionFeature,iconScale,layout["icon-ignore-placement"]);if(iconScale<=maxScale){this$1.addSymbols(this$1.arrays.icon,symbolInstance.iconQuadStartIndex,symbolInstance.iconQuadEndIndex,iconScale,layout["icon-keep-upright"],iconAlongLine,collisionTile.angle)}}}if(showCollisionBoxes)this.addToDebugBuffers(collisionTile)};SymbolBucket.prototype.addSymbols=function addSymbols(arrays,quadsStart,quadsEnd,scale,keepUpright,alongLine,placementAngle,writingModes){var this$1=this;var elementArray=arrays.elementArray;var layoutVertexArray=arrays.layoutVertexArray;var zoom=this.zoom;var placementZoom=Math.max(Math.log(scale)/Math.LN2+zoom,0);for(var k=quadsStart;k<quadsEnd;k++){var symbol=this$1.symbolQuadsArray.get(k).SymbolQuad;var a=(symbol.anchorAngle+placementAngle+Math.PI)%(Math.PI*2);if(writingModes&WritingMode.vertical){if(alongLine&&symbol.writingMode===WritingMode.vertical){if(keepUpright&&alongLine&&a<=Math.PI*5/4||a>Math.PI*7/4)continue}else if(keepUpright&&alongLine&&a<=Math.PI*3/4||a>Math.PI*5/4)continue}else if(keepUpright&&alongLine&&(a<=Math.PI/2||a>Math.PI*3/2))continue;var tl=symbol.tl,tr=symbol.tr,bl=symbol.bl,br=symbol.br,tex=symbol.tex,anchorPoint=symbol.anchorPoint;var minZoom=Math.max(zoom+Math.log(symbol.minScale)/Math.LN2,placementZoom);var maxZoom=Math.min(zoom+Math.log(symbol.maxScale)/Math.LN2,25);if(maxZoom<=minZoom)continue;if(minZoom===placementZoom)minZoom=0;var glyphAngle=Math.round(symbol.glyphAngle/(Math.PI*2)*256);var segment=arrays.prepareSegment(4);var index=segment.vertexLength;addVertex(layoutVertexArray,anchorPoint.x,anchorPoint.y,tl.x,tl.y,tex.x,tex.y,minZoom,maxZoom,placementZoom,glyphAngle);addVertex(layoutVertexArray,anchorPoint.x,anchorPoint.y,tr.x,tr.y,tex.x+tex.w,tex.y,minZoom,maxZoom,placementZoom,glyphAngle);addVertex(layoutVertexArray,anchorPoint.x,anchorPoint.y,bl.x,bl.y,tex.x,tex.y+tex.h,minZoom,maxZoom,placementZoom,glyphAngle);addVertex(layoutVertexArray,anchorPoint.x,anchorPoint.y,br.x,br.y,tex.x+tex.w,tex.y+tex.h,minZoom,maxZoom,placementZoom,glyphAngle);elementArray.emplaceBack(index,index+1,index+2);elementArray.emplaceBack(index+1,index+2,index+3);segment.vertexLength+=4;segment.primitiveLength+=2}};SymbolBucket.prototype.addToDebugBuffers=function addToDebugBuffers(collisionTile){var this$1=this;var arrays=this.arrays.collisionBox;var layoutVertexArray=arrays.layoutVertexArray;var elementArray=arrays.elementArray;var angle=-collisionTile.angle;var yStretch=collisionTile.yStretch;for(var j=this.symbolInstancesStartIndex;j<this.symbolInstancesEndIndex;j++){var symbolInstance=this$1.symbolInstancesArray.get(j);symbolInstance.textCollisionFeature={boxStartIndex:symbolInstance.textBoxStartIndex,boxEndIndex:symbolInstance.textBoxEndIndex};symbolInstance.iconCollisionFeature={boxStartIndex:symbolInstance.iconBoxStartIndex,boxEndIndex:symbolInstance.iconBoxEndIndex};for(var i=0;i<2;i++){var feature=symbolInstance[i===0?"textCollisionFeature":"iconCollisionFeature"];if(!feature)continue;for(var b=feature.boxStartIndex;b<feature.boxEndIndex;b++){var box=this$1.collisionBoxArray.get(b);var anchorPoint=box.anchorPoint;var tl=new Point(box.x1,box.y1*yStretch)._rotate(angle);var tr=new Point(box.x2,box.y1*yStretch)._rotate(angle);var bl=new Point(box.x1,box.y2*yStretch)._rotate(angle);var br=new Point(box.x2,box.y2*yStretch)._rotate(angle);var maxZoom=Math.max(0,Math.min(25,this$1.zoom+Math.log(box.maxScale)/Math.LN2));var placementZoom=Math.max(0,Math.min(25,this$1.zoom+Math.log(box.placementScale)/Math.LN2));var segment=arrays.prepareSegment(4);var index=segment.vertexLength;addCollisionBoxVertex(layoutVertexArray,anchorPoint,tl,maxZoom,placementZoom);addCollisionBoxVertex(layoutVertexArray,anchorPoint,tr,maxZoom,placementZoom);addCollisionBoxVertex(layoutVertexArray,anchorPoint,br,maxZoom,placementZoom);addCollisionBoxVertex(layoutVertexArray,anchorPoint,bl,maxZoom,placementZoom);elementArray.emplaceBack(index,index+1);elementArray.emplaceBack(index+1,index+2);elementArray.emplaceBack(index+2,index+3);elementArray.emplaceBack(index+3,index);segment.vertexLength+=4;segment.primitiveLength+=4}}}};SymbolBucket.prototype.addSymbolInstance=function addSymbolInstance(anchor,line,shapedTextOrientations,shapedIcon,layer,addToBuffers,index,collisionBoxArray,featureIndex,sourceLayerIndex,bucketIndex,textBoxScale,textPadding,textAlongLine,iconBoxScale,iconPadding,iconAlongLine,globalProperties,featureProperties){var this$1=this;var textCollisionFeature,iconCollisionFeature,iconQuads;var glyphQuads=[];for(var writingModeString in shapedTextOrientations){var writingMode=parseInt(writingModeString,10);if(!shapedTextOrientations[writingMode])continue;glyphQuads=glyphQuads.concat(addToBuffers?getGlyphQuads(anchor,shapedTextOrientations[writingMode],textBoxScale,line,layer,textAlongLine,writingMode):[]);textCollisionFeature=new CollisionFeature(collisionBoxArray,line,anchor,featureIndex,sourceLayerIndex,bucketIndex,shapedTextOrientations[writingMode],textBoxScale,textPadding,textAlongLine,false)}var glyphQuadStartIndex=this.symbolQuadsArray.length;if(glyphQuads&&glyphQuads.length){for(var i=0;i<glyphQuads.length;i++){this$1.addSymbolQuad(glyphQuads[i])}}var glyphQuadEndIndex=this.symbolQuadsArray.length;var textBoxStartIndex=textCollisionFeature?textCollisionFeature.boxStartIndex:this.collisionBoxArray.length;var textBoxEndIndex=textCollisionFeature?textCollisionFeature.boxEndIndex:this.collisionBoxArray.length;if(shapedIcon){iconQuads=addToBuffers?getIconQuads(anchor,shapedIcon,iconBoxScale,line,layer,iconAlongLine,shapedTextOrientations[WritingMode.horizontal],globalProperties,featureProperties):[];iconCollisionFeature=new CollisionFeature(collisionBoxArray,line,anchor,featureIndex,sourceLayerIndex,bucketIndex,shapedIcon,iconBoxScale,iconPadding,iconAlongLine,true)}var iconQuadStartIndex=this.symbolQuadsArray.length;if(iconQuads&&iconQuads.length===1){this.addSymbolQuad(iconQuads[0])}var iconQuadEndIndex=this.symbolQuadsArray.length;var iconBoxStartIndex=iconCollisionFeature?iconCollisionFeature.boxStartIndex:this.collisionBoxArray.length;var iconBoxEndIndex=iconCollisionFeature?iconCollisionFeature.boxEndIndex:this.collisionBoxArray.length;if(iconQuadEndIndex>SymbolBucket.MAX_QUADS)util.warnOnce("Too many symbols being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907");if(glyphQuadEndIndex>SymbolBucket.MAX_QUADS)util.warnOnce("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907");var writingModes=(shapedTextOrientations[WritingMode.vertical]?WritingMode.vertical:0)|(shapedTextOrientations[WritingMode.horizontal]?WritingMode.horizontal:0);return this.symbolInstancesArray.emplaceBack(textBoxStartIndex,textBoxEndIndex,iconBoxStartIndex,iconBoxEndIndex,glyphQuadStartIndex,glyphQuadEndIndex,iconQuadStartIndex,iconQuadEndIndex,anchor.x,anchor.y,index,writingModes)};SymbolBucket.prototype.addSymbolQuad=function addSymbolQuad(symbolQuad){return this.symbolQuadsArray.emplaceBack(symbolQuad.anchorPoint.x,symbolQuad.anchorPoint.y,symbolQuad.tl.x,symbolQuad.tl.y,symbolQuad.tr.x,symbolQuad.tr.y,symbolQuad.bl.x,symbolQuad.bl.y,symbolQuad.br.x,symbolQuad.br.y,symbolQuad.tex.h,symbolQuad.tex.w,symbolQuad.tex.x,symbolQuad.tex.y,symbolQuad.anchorAngle,symbolQuad.glyphAngle,symbolQuad.maxScale,symbolQuad.minScale,symbolQuad.writingMode)};SymbolBucket.MAX_QUADS=65535;module.exports=SymbolBucket},{"../../symbol/anchor":669,"../../symbol/clip_line":671,"../../symbol/collision_feature":673,"../../symbol/get_anchors":675,"../../symbol/mergelines":678,"../../symbol/quads":679,"../../symbol/resolve_text":680,"../../symbol/shaping":681,"../../util/classify_rings":707,"../../util/find_pole_of_inaccessibility":713,"../../util/script_detection":720,"../../util/token":722,"../../util/util":723,"../array_group":597,"../buffer_group":605,"../element_array_type":606,"../extent":607,"../load_geometry":609,"../vertex_array_type":613,"point-geometry":769,"vector-tile":997}],604:[function(require,module,exports){"use strict";var AttributeType={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT"};var Buffer=function Buffer(array,arrayType,type){this.arrayBuffer=array.arrayBuffer;this.length=array.length;this.attributes=arrayType.members;this.itemSize=arrayType.bytesPerElement;this.type=type;this.arrayType=arrayType};Buffer.fromStructArray=function fromStructArray(array,type){return new Buffer(array.serialize(),array.constructor.serialize(),type)};Buffer.prototype.bind=function bind(gl){var type=gl[this.type];if(!this.buffer){this.gl=gl;this.buffer=gl.createBuffer();gl.bindBuffer(type,this.buffer);gl.bufferData(type,this.arrayBuffer,gl.STATIC_DRAW);this.arrayBuffer=null}else{gl.bindBuffer(type,this.buffer)}};Buffer.prototype.setVertexAttribPointers=function setVertexAttribPointers(gl,program,vertexOffset){var this$1=this;for(var j=0;j<this.attributes.length;j++){var member=this$1.attributes[j];var attribIndex=program[member.name];if(attribIndex!==undefined){gl.vertexAttribPointer(attribIndex,member.components,gl[AttributeType[member.type]],false,this$1.arrayType.bytesPerElement,member.offset+(this$1.arrayType.bytesPerElement*vertexOffset||0))}}};Buffer.prototype.destroy=function destroy(){if(this.buffer){this.gl.deleteBuffer(this.buffer)}};Buffer.BufferType={VERTEX:"ARRAY_BUFFER",ELEMENT:"ELEMENT_ARRAY_BUFFER"};module.exports=Buffer},{}],605:[function(require,module,exports){"use strict";var util=require("../util/util");var Buffer=require("./buffer");var ProgramConfiguration=require("./program_configuration");var VertexArrayObject=require("../render/vertex_array_object");var BufferGroup=function BufferGroup(programInterface,layers,zoom,arrays){var this$1=this;this.layoutVertexBuffer=new Buffer(arrays.layoutVertexArray,programInterface.layoutVertexArrayType.serialize(),Buffer.BufferType.VERTEX);if(arrays.elementArray){this.elementBuffer=new Buffer(arrays.elementArray,programInterface.elementArrayType.serialize(),Buffer.BufferType.ELEMENT)}if(arrays.elementArray2){this.elementBuffer2=new Buffer(arrays.elementArray2,programInterface.elementArrayType2.serialize(),Buffer.BufferType.ELEMENT)}this.layerData={};for(var i=0,list=layers;i<list.length;i+=1){var layer=list[i];var array=arrays.paintVertexArrays&&arrays.paintVertexArrays[layer.id];var programConfiguration=ProgramConfiguration.createDynamic(programInterface.paintAttributes||[],layer,zoom);var paintVertexBuffer=array?new Buffer(array.array,array.type,Buffer.BufferType.VERTEX):null;this$1.layerData[layer.id]={programConfiguration:programConfiguration,paintVertexBuffer:paintVertexBuffer}}this.segments=arrays.segments;this.segments2=arrays.segments2;for(var i$1=0,list$1=[this.segments,this.segments2];i$1<list$1.length;i$1+=1){var segments=list$1[i$1];for(var i$2=0,list$2=segments||[];i$2<list$2.length;i$2+=1){var segment=list$2[i$2];segment.vaos=util.mapObject(this$1.layerData,function(){return new VertexArrayObject})}}};BufferGroup.prototype.destroy=function destroy(){var this$1=this;this.layoutVertexBuffer.destroy();if(this.elementBuffer){this.elementBuffer.destroy()}if(this.elementBuffer2){this.elementBuffer2.destroy()}for(var layerId in this.layerData){var paintVertexBuffer=this$1.layerData[layerId].paintVertexBuffer;if(paintVertexBuffer){paintVertexBuffer.destroy()}}for(var i=0,list=[this.segments,this.segments2];i<list.length;i+=1){var segments=list[i];for(var i$1=0,list$1=segments||[];i$1<list$1.length;i$1+=1){var segment=list$1[i$1];for(var k in segment.vaos){segment.vaos[k].destroy()}}}};module.exports=BufferGroup},{"../render/vertex_array_object":635,
"../util/util":723,"./buffer":604,"./program_configuration":611}],606:[function(require,module,exports){"use strict";var createStructArrayType=require("../util/struct_array");module.exports=createElementArrayType;function createElementArrayType(components){return createStructArrayType({members:[{type:"Uint16",name:"vertices",components:components||3}]})}},{"../util/struct_array":721}],607:[function(require,module,exports){"use strict";module.exports=8192},{}],608:[function(require,module,exports){"use strict";var Point=require("point-geometry");var loadGeometry=require("./load_geometry");var EXTENT=require("./extent");var featureFilter=require("feature-filter");var createStructArrayType=require("../util/struct_array");var Grid=require("grid-index");var DictionaryCoder=require("../util/dictionary_coder");var vt=require("vector-tile");var Protobuf=require("pbf");var GeoJSONFeature=require("../util/vectortile_to_geojson");var arraysIntersect=require("../util/util").arraysIntersect;var intersection=require("../util/intersection_tests");var multiPolygonIntersectsBufferedMultiPoint=intersection.multiPolygonIntersectsBufferedMultiPoint;var multiPolygonIntersectsMultiPolygon=intersection.multiPolygonIntersectsMultiPolygon;var multiPolygonIntersectsBufferedMultiLine=intersection.multiPolygonIntersectsBufferedMultiLine;var FeatureIndexArray=createStructArrayType({members:[{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]});var FeatureIndex=function FeatureIndex(coord,overscaling,collisionTile){if(coord.grid){var serialized=coord;var rawTileData=overscaling;coord=serialized.coord;overscaling=serialized.overscaling;this.grid=new Grid(serialized.grid);this.featureIndexArray=new FeatureIndexArray(serialized.featureIndexArray);this.rawTileData=rawTileData;this.bucketLayerIDs=serialized.bucketLayerIDs}else{this.grid=new Grid(EXTENT,16,0);this.featureIndexArray=new FeatureIndexArray}this.coord=coord;this.overscaling=overscaling;this.x=coord.x;this.y=coord.y;this.z=coord.z-Math.log(overscaling)/Math.LN2;this.setCollisionTile(collisionTile)};FeatureIndex.prototype.insert=function insert(feature,bucketIndex){var this$1=this;var key=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(feature.index,feature.sourceLayerIndex,bucketIndex);var geometry=loadGeometry(feature);for(var r=0;r<geometry.length;r++){var ring=geometry[r];var bbox=[Infinity,Infinity,-Infinity,-Infinity];for(var i=0;i<ring.length;i++){var p=ring[i];bbox[0]=Math.min(bbox[0],p.x);bbox[1]=Math.min(bbox[1],p.y);bbox[2]=Math.max(bbox[2],p.x);bbox[3]=Math.max(bbox[3],p.y)}this$1.grid.insert(key,bbox[0],bbox[1],bbox[2],bbox[3])}};FeatureIndex.prototype.setCollisionTile=function setCollisionTile(collisionTile){this.collisionTile=collisionTile};FeatureIndex.prototype.serialize=function serialize(transferables){var grid=this.grid.toArrayBuffer();if(transferables){transferables.push(grid)}return{coord:this.coord,overscaling:this.overscaling,grid:grid,featureIndexArray:this.featureIndexArray.serialize(transferables),bucketLayerIDs:this.bucketLayerIDs}};FeatureIndex.prototype.query=function query(args,styleLayers){if(!this.vtLayers){this.vtLayers=new vt.VectorTile(new Protobuf(this.rawTileData)).layers;this.sourceLayerCoder=new DictionaryCoder(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])}var result={};var params=args.params||{},pixelsToTileUnits=EXTENT/args.tileSize/args.scale,filter=featureFilter(params.filter);var additionalRadius=0;for(var id in styleLayers){var styleLayer=styleLayers[id];var paint=styleLayer.paint;var styleLayerDistance=0;if(styleLayer.type==="line"){styleLayerDistance=getLineWidth(paint)/2+Math.abs(paint["line-offset"])+translateDistance(paint["line-translate"])}else if(styleLayer.type==="fill"){styleLayerDistance=translateDistance(paint["fill-translate"])}else if(styleLayer.type==="fill-extrusion"){styleLayerDistance=translateDistance(paint["fill-extrusion-translate"])}else if(styleLayer.type==="circle"){styleLayerDistance=paint["circle-radius"]+translateDistance(paint["circle-translate"])}additionalRadius=Math.max(additionalRadius,styleLayerDistance*pixelsToTileUnits)}var queryGeometry=args.queryGeometry.map(function(q){return q.map(function(p){return new Point(p.x,p.y)})});var minX=Infinity;var minY=Infinity;var maxX=-Infinity;var maxY=-Infinity;for(var i=0;i<queryGeometry.length;i++){var ring=queryGeometry[i];for(var k=0;k<ring.length;k++){var p=ring[k];minX=Math.min(minX,p.x);minY=Math.min(minY,p.y);maxX=Math.max(maxX,p.x);maxY=Math.max(maxY,p.y)}}var matching=this.grid.query(minX-additionalRadius,minY-additionalRadius,maxX+additionalRadius,maxY+additionalRadius);matching.sort(topDownFeatureComparator);this.filterMatching(result,matching,this.featureIndexArray,queryGeometry,filter,params.layers,styleLayers,args.bearing,pixelsToTileUnits);var matchingSymbols=this.collisionTile.queryRenderedSymbols(queryGeometry,args.scale);matchingSymbols.sort();this.filterMatching(result,matchingSymbols,this.collisionTile.collisionBoxArray,queryGeometry,filter,params.layers,styleLayers,args.bearing,pixelsToTileUnits);return result};FeatureIndex.prototype.filterMatching=function filterMatching(result,matching,array,queryGeometry,filter,filterLayerIDs,styleLayers,bearing,pixelsToTileUnits){var this$1=this;var previousIndex;for(var k=0;k<matching.length;k++){var index=matching[k];if(index===previousIndex)continue;previousIndex=index;var match=array.get(index);var layerIDs=this$1.bucketLayerIDs[match.bucketIndex];if(filterLayerIDs&&!arraysIntersect(filterLayerIDs,layerIDs))continue;var sourceLayerName=this$1.sourceLayerCoder.decode(match.sourceLayerIndex);var sourceLayer=this$1.vtLayers[sourceLayerName];var feature=sourceLayer.feature(match.featureIndex);if(!filter(feature))continue;var geometry=null;for(var l=0;l<layerIDs.length;l++){var layerID=layerIDs[l];if(filterLayerIDs&&filterLayerIDs.indexOf(layerID)<0){continue}var styleLayer=styleLayers[layerID];if(!styleLayer)continue;var translatedPolygon;if(styleLayer.type!=="symbol"){if(!geometry)geometry=loadGeometry(feature);var paint=styleLayer.paint;if(styleLayer.type==="line"){translatedPolygon=translate(queryGeometry,paint["line-translate"],paint["line-translate-anchor"],bearing,pixelsToTileUnits);var halfWidth=getLineWidth(paint)/2*pixelsToTileUnits;if(paint["line-offset"]){geometry=offsetLine(geometry,paint["line-offset"]*pixelsToTileUnits)}if(!multiPolygonIntersectsBufferedMultiLine(translatedPolygon,geometry,halfWidth))continue}else if(styleLayer.type==="fill"||styleLayer.type==="fill-extrusion"){var typePrefix=styleLayer.type;translatedPolygon=translate(queryGeometry,paint[typePrefix+"-translate"],paint[typePrefix+"-translate-anchor"],bearing,pixelsToTileUnits);if(!multiPolygonIntersectsMultiPolygon(translatedPolygon,geometry))continue}else if(styleLayer.type==="circle"){translatedPolygon=translate(queryGeometry,paint["circle-translate"],paint["circle-translate-anchor"],bearing,pixelsToTileUnits);var circleRadius=paint["circle-radius"]*pixelsToTileUnits;if(!multiPolygonIntersectsBufferedMultiPoint(translatedPolygon,geometry,circleRadius))continue}}var geojsonFeature=new GeoJSONFeature(feature,this$1.z,this$1.x,this$1.y);geojsonFeature.layer=styleLayer.serialize();var layerResult=result[layerID];if(layerResult===undefined){layerResult=result[layerID]=[]}layerResult.push(geojsonFeature)}}};module.exports=FeatureIndex;function translateDistance(translate){return Math.sqrt(translate[0]*translate[0]+translate[1]*translate[1])}function topDownFeatureComparator(a,b){return b-a}function getLineWidth(paint){if(paint["line-gap-width"]>0){return paint["line-gap-width"]+2*paint["line-width"]}else{return paint["line-width"]}}function translate(queryGeometry,translate,translateAnchor,bearing,pixelsToTileUnits){if(!translate[0]&&!translate[1]){return queryGeometry}translate=Point.convert(translate);if(translateAnchor==="viewport"){translate._rotate(-bearing)}var translated=[];for(var i=0;i<queryGeometry.length;i++){var ring=queryGeometry[i];var translatedRing=[];for(var k=0;k<ring.length;k++){translatedRing.push(ring[k].sub(translate._mult(pixelsToTileUnits)))}translated.push(translatedRing)}return translated}function offsetLine(rings,offset){var newRings=[];var zero=new Point(0,0);for(var k=0;k<rings.length;k++){var ring=rings[k];var newRing=[];for(var i=0;i<ring.length;i++){var a=ring[i-1];var b=ring[i];var c=ring[i+1];var aToB=i===0?zero:b.sub(a)._unit()._perp();var bToC=i===ring.length-1?zero:c.sub(b)._unit()._perp();var extrude=aToB._add(bToC)._unit();var cosHalfAngle=extrude.x*bToC.x+extrude.y*bToC.y;extrude._mult(1/cosHalfAngle);newRing.push(extrude._mult(offset)._add(b))}newRings.push(newRing)}return newRings}},{"../util/dictionary_coder":709,"../util/intersection_tests":716,"../util/struct_array":721,"../util/util":723,"../util/vectortile_to_geojson":724,"./extent":607,"./load_geometry":609,"feature-filter":414,"grid-index":450,pbf:747,"point-geometry":769,"vector-tile":997}],609:[function(require,module,exports){"use strict";var util=require("../util/util");var EXTENT=require("./extent");function createBounds(bits){return{min:-1*Math.pow(2,bits-1),max:Math.pow(2,bits-1)-1}}var boundsLookup={15:createBounds(15),16:createBounds(16)};module.exports=function loadGeometry(feature,bits){var bounds=boundsLookup[bits||16];var scale=EXTENT/feature.extent;var geometry=feature.loadGeometry();for(var r=0;r<geometry.length;r++){var ring=geometry[r];for(var p=0;p<ring.length;p++){var point=ring[p];point.x=Math.round(point.x*scale);point.y=Math.round(point.y*scale);if(point.x<bounds.min||point.x>bounds.max||point.y<bounds.min||point.y>bounds.max){util.warnOnce("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}}return geometry}},{"../util/util":723,"./extent":607}],610:[function(require,module,exports){"use strict";var createStructArrayType=require("../util/struct_array");var PosArray=createStructArrayType({members:[{name:"a_pos",type:"Int16",components:2}]});module.exports=PosArray},{"../util/struct_array":721}],611:[function(require,module,exports){"use strict";var createVertexArrayType=require("./vertex_array_type");var util=require("../util/util");var ProgramConfiguration=function ProgramConfiguration(){this.attributes=[];this.uniforms=[];this.interpolationUniforms=[];this.pragmas={vertex:{},fragment:{}};this.cacheKey=""};ProgramConfiguration.createDynamic=function createDynamic(attributes,layer,zoom){var self=new ProgramConfiguration;for(var i=0,list=attributes;i<list.length;i+=1){var attributeConfig=list[i];var attribute=normalizePaintAttribute(attributeConfig,layer);var name=attribute.name.slice(2);if(layer.isPaintValueFeatureConstant(attribute.property)){self.addZoomAttribute(name,attribute)}else if(layer.isPaintValueZoomConstant(attribute.property)){self.addPropertyAttribute(name,attribute)}else{self.addZoomAndPropertyAttribute(name,attribute,layer,zoom)}}self.PaintVertexArray=createVertexArrayType(self.attributes);return self};ProgramConfiguration.createStatic=function createStatic(uniformNames){var self=new ProgramConfiguration;for(var i=0,list=uniformNames;i<list.length;i+=1){var name=list[i];self.addUniform(name,"u_"+name)}return self};ProgramConfiguration.prototype.addUniform=function addUniform(name,inputName){var pragmas=this.getPragmas(name);pragmas.define.push("uniform {precision} {type} "+inputName+";");pragmas.initialize.push("{precision} {type} "+name+" = "+inputName+";");this.cacheKey+="/u_"+name};ProgramConfiguration.prototype.addZoomAttribute=function addZoomAttribute(name,attribute){this.uniforms.push(attribute);this.addUniform(name,attribute.name)};ProgramConfiguration.prototype.addPropertyAttribute=function addPropertyAttribute(name,attribute){var pragmas=this.getPragmas(name);this.attributes.push(attribute);pragmas.define.push("varying {precision} {type} "+name+";");pragmas.vertex.define.push("attribute {precision} {type} "+attribute.name+";");pragmas.vertex.initialize.push(name+" = "+attribute.name+" / "+attribute.multiplier+".0;");this.cacheKey+="/a_"+name};ProgramConfiguration.prototype.addZoomAndPropertyAttribute=function addZoomAndPropertyAttribute(name,attribute,layer,zoom){var this$1=this;var pragmas=this.getPragmas(name);pragmas.define.push("varying {precision} {type} "+name+";");var numStops=0;var zoomLevels=layer.getPaintValueStopZoomLevels(attribute.property);while(numStops<zoomLevels.length&&zoomLevels[numStops]<zoom)numStops++;var stopOffset=Math.max(0,Math.min(zoomLevels.length-4,numStops-2));var tName="u_"+name+"_t";pragmas.vertex.define.push("uniform lowp float "+tName+";");this.interpolationUniforms.push({name:tName,property:attribute.property,stopOffset:stopOffset});var zoomStops=[];for(var s=0;s<4;s++){zoomStops.push(zoomLevels[Math.min(stopOffset+s,zoomLevels.length-1)])}var componentNames=[];if(attribute.components===1){this.attributes.push(util.extend({},attribute,{components:4,zoomStops:zoomStops}));pragmas.vertex.define.push("attribute {precision} vec4 "+attribute.name+";");componentNames.push(attribute.name)}else{for(var k=0;k<4;k++){var componentName=attribute.name+k;componentNames.push(componentName);this$1.attributes.push(util.extend({},attribute,{name:componentName,zoomStops:[zoomStops[k]]}));pragmas.vertex.define.push("attribute {precision} {type} "+componentName+";")}}pragmas.vertex.initialize.push(name+" = evaluate_zoom_function_"+attribute.components+"(            "+componentNames.join(", ")+", "+tName+") / "+attribute.multiplier+".0;");this.cacheKey+="/z_"+name};ProgramConfiguration.prototype.getPragmas=function getPragmas(name){if(!this.pragmas[name]){this.pragmas[name]={define:[],initialize:[]};this.pragmas[name].fragment={define:[],initialize:[]};this.pragmas[name].vertex={define:[],initialize:[]}}return this.pragmas[name]};ProgramConfiguration.prototype.applyPragmas=function applyPragmas(source,shaderType){var this$1=this;return source.replace(/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,function(match,operation,precision,type,name){return this$1.pragmas[name][operation].concat(this$1.pragmas[name][shaderType][operation]).join("\n").replace(/{type}/g,type).replace(/{precision}/g,precision)})};ProgramConfiguration.prototype.populatePaintArray=function populatePaintArray(layer,paintArray,length,globalProperties,featureProperties){var start=paintArray.length;paintArray.resize(length);for(var i$1=0,list=this.attributes;i$1<list.length;i$1+=1){var attribute=list[i$1];var value=getPaintAttributeValue(attribute,layer,globalProperties,featureProperties);for(var i=start;i<length;i++){var vertex=paintArray.get(i);if(attribute.components===4){for(var c=0;c<4;c++){vertex[attribute.name+c]=value[c]*attribute.multiplier}}else{vertex[attribute.name]=value*attribute.multiplier}}}};ProgramConfiguration.prototype.setUniforms=function setUniforms(gl,program,layer,globalProperties){for(var i=0,list=this.uniforms;i<list.length;i+=1){var uniform=list[i];var value=layer.getPaintValue(uniform.property,globalProperties);if(uniform.components===4){gl.uniform4fv(program[uniform.name],value)}else{gl.uniform1f(program[uniform.name],value)}}for(var i$1=0,list$1=this.interpolationUniforms;i$1<list$1.length;i$1+=1){var uniform$1=list$1[i$1];var stopInterp=layer.getPaintInterpolationT(uniform$1.property,globalProperties);gl.uniform1f(program[uniform$1.name],Math.max(0,Math.min(4,stopInterp-uniform$1.stopOffset)))}};function getPaintAttributeValue(attribute,layer,globalProperties,featureProperties){if(!attribute.zoomStops){return layer.getPaintValue(attribute.property,globalProperties,featureProperties)}var values=attribute.zoomStops.map(function(zoom){return layer.getPaintValue(attribute.property,util.extend({},globalProperties,{zoom:zoom}),featureProperties)});return values.length===1?values[0]:values}function normalizePaintAttribute(attribute,layer){var name=attribute.property.replace(layer.type+"-","").replace(/-/g,"_");var isColor=layer._paintSpecifications[attribute.property].type==="color";return util.extend({name:"a_"+name,components:isColor?4:1,multiplier:isColor?255:1},attribute)}module.exports=ProgramConfiguration},{"../util/util":723,"./vertex_array_type":613}],612:[function(require,module,exports){"use strict";var createStructArrayType=require("../util/struct_array");var RasterBoundsArray=createStructArrayType({members:[{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]});module.exports=RasterBoundsArray},{"../util/struct_array":721}],613:[function(require,module,exports){"use strict";var createStructArrayType=require("../util/struct_array");module.exports=createVertexArrayType;function createVertexArrayType(members){return createStructArrayType({members:members,alignment:4})}},{"../util/struct_array":721}],614:[function(require,module,exports){"use strict";var Coordinate=function Coordinate(column,row,zoom){this.column=column;this.row=row;this.zoom=zoom};Coordinate.prototype.clone=function clone(){return new Coordinate(this.column,this.row,this.zoom)};Coordinate.prototype.zoomTo=function zoomTo(zoom){return this.clone()._zoomTo(zoom)};Coordinate.prototype.sub=function sub(c){return this.clone()._sub(c)};Coordinate.prototype._zoomTo=function _zoomTo(zoom){var scale=Math.pow(2,zoom-this.zoom);this.column*=scale;this.row*=scale;this.zoom=zoom;return this};Coordinate.prototype._sub=function _sub(c){c=c.zoomTo(this.zoom);this.column-=c.column;this.row-=c.row;return this};module.exports=Coordinate},{}],615:[function(require,module,exports){"use strict";var wrap=require("../util/util").wrap;var LngLat=function LngLat(lng,lat){if(isNaN(lng)||isNaN(lat)){throw new Error("Invalid LngLat object: ("+lng+", "+lat+")")}this.lng=+lng;this.lat=+lat;if(this.lat>90||this.lat<-90){throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}};LngLat.prototype.wrap=function wrap$1(){return new LngLat(wrap(this.lng,-180,180),this.lat)};LngLat.prototype.toArray=function toArray(){return[this.lng,this.lat]};LngLat.prototype.toString=function toString(){return"LngLat("+this.lng+", "+this.lat+")"};LngLat.convert=function(input){if(input instanceof LngLat){return input}else if(input&&input.hasOwnProperty("lng")&&input.hasOwnProperty("lat")){return new LngLat(input.lng,input.lat)}else if(Array.isArray(input)&&input.length===2){return new LngLat(input[0],input[1])}else{throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}};module.exports=LngLat},{"../util/util":723}],616:[function(require,module,exports){"use strict";var LngLat=require("./lng_lat");var LngLatBounds=function LngLatBounds(sw,ne){if(!sw){return}else if(ne){this.setSouthWest(sw).setNorthEast(ne)}else if(sw.length===4){this.setSouthWest([sw[0],sw[1]]).setNorthEast([sw[2],sw[3]])}else{this.setSouthWest(sw[0]).setNorthEast(sw[1])}};LngLatBounds.prototype.setNorthEast=function setNorthEast(ne){this._ne=LngLat.convert(ne);return this};LngLatBounds.prototype.setSouthWest=function setSouthWest(sw){this._sw=LngLat.convert(sw);return this};LngLatBounds.prototype.extend=function extend(obj){var sw=this._sw,ne=this._ne;var sw2,ne2;if(obj instanceof LngLat){sw2=obj;ne2=obj}else if(obj instanceof LngLatBounds){sw2=obj._sw;ne2=obj._ne;if(!sw2||!ne2)return this}else{if(Array.isArray(obj)){if(obj.every(Array.isArray)){return this.extend(LngLatBounds.convert(obj))}else{return this.extend(LngLat.convert(obj))}}return this}if(!sw&&!ne){this._sw=new LngLat(sw2.lng,sw2.lat);this._ne=new LngLat(ne2.lng,ne2.lat)}else{sw.lng=Math.min(sw2.lng,sw.lng);sw.lat=Math.min(sw2.lat,sw.lat);ne.lng=Math.max(ne2.lng,ne.lng);ne.lat=Math.max(ne2.lat,ne.lat)}return this};LngLatBounds.prototype.getCenter=function getCenter(){return new LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)};LngLatBounds.prototype.getSouthWest=function getSouthWest(){return this._sw};LngLatBounds.prototype.getNorthEast=function getNorthEast(){return this._ne};LngLatBounds.prototype.getNorthWest=function getNorthWest(){return new LngLat(this.getWest(),this.getNorth())};LngLatBounds.prototype.getSouthEast=function getSouthEast(){return new LngLat(this.getEast(),this.getSouth())};LngLatBounds.prototype.getWest=function getWest(){return this._sw.lng};LngLatBounds.prototype.getSouth=function getSouth(){return this._sw.lat};LngLatBounds.prototype.getEast=function getEast(){return this._ne.lng};LngLatBounds.prototype.getNorth=function getNorth(){return this._ne.lat};LngLatBounds.prototype.toArray=function toArray(){return[this._sw.toArray(),this._ne.toArray()]};LngLatBounds.prototype.toString=function toString(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"};LngLatBounds.convert=function(input){if(!input||input instanceof LngLatBounds)return input;return new LngLatBounds(input)};module.exports=LngLatBounds},{"./lng_lat":615}],617:[function(require,module,exports){"use strict";var LngLat=require("./lng_lat"),Point=require("point-geometry"),Coordinate=require("./coordinate"),util=require("../util/util"),interp=require("../util/interpolate"),TileCoord=require("../source/tile_coord"),EXTENT=require("../data/extent"),glmatrix=require("@mapbox/gl-matrix");var vec4=glmatrix.vec4,mat4=glmatrix.mat4,mat2=glmatrix.mat2;var Transform=function Transform(minZoom,maxZoom,renderWorldCopies){this.tileSize=512;this._renderWorldCopies=renderWorldCopies===undefined?true:renderWorldCopies;this._minZoom=minZoom||0;this._maxZoom=maxZoom||22;this.latRange=[-85.05113,85.05113];this.width=0;this.height=0;this._center=new LngLat(0,0);this.zoom=0;this.angle=0;this._fov=.6435011087932844;this._pitch=0;this._unmodified=true};var prototypeAccessors={minZoom:{},maxZoom:{},worldSize:{},centerPoint:{},size:{},bearing:{},pitch:{},fov:{},zoom:{},center:{},unmodified:{},x:{},y:{},point:{}};prototypeAccessors.minZoom.get=function(){return this._minZoom};prototypeAccessors.minZoom.set=function(zoom){if(this._minZoom===zoom)return;this._minZoom=zoom;this.zoom=Math.max(this.zoom,zoom)};prototypeAccessors.maxZoom.get=function(){return this._maxZoom};prototypeAccessors.maxZoom.set=function(zoom){if(this._maxZoom===zoom)return;this._maxZoom=zoom;this.zoom=Math.min(this.zoom,zoom)};prototypeAccessors.worldSize.get=function(){return this.tileSize*this.scale};prototypeAccessors.centerPoint.get=function(){return this.size._div(2)};prototypeAccessors.size.get=function(){return new Point(this.width,this.height)};prototypeAccessors.bearing.get=function(){return-this.angle/Math.PI*180};prototypeAccessors.bearing.set=function(bearing){var b=-util.wrap(bearing,-180,180)*Math.PI/180;if(this.angle===b)return;this._unmodified=false;this.angle=b;this._calcMatrices();this.rotationMatrix=mat2.create();mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle)};prototypeAccessors.pitch.get=function(){return this._pitch/Math.PI*180};prototypeAccessors.pitch.set=function(pitch){var p=util.clamp(pitch,0,60)/180*Math.PI;if(this._pitch===p)return;this._unmodified=false;this._pitch=p;this._calcMatrices()};prototypeAccessors.fov.get=function(){return this._fov/Math.PI*180};prototypeAccessors.fov.set=function(fov){fov=Math.max(.01,Math.min(60,fov));if(this._fov===fov)return;this._unmodified=false;this._fov=fov/180*Math.PI;this._calcMatrices()};prototypeAccessors.zoom.get=function(){return this._zoom};prototypeAccessors.zoom.set=function(zoom){var z=Math.min(Math.max(zoom,this.minZoom),this.maxZoom);if(this._zoom===z)return;this._unmodified=false;this._zoom=z;this.scale=this.zoomScale(z);this.tileZoom=Math.floor(z);this.zoomFraction=z-this.tileZoom;this._constrain();this._calcMatrices()};prototypeAccessors.center.get=function(){return this._center};prototypeAccessors.center.set=function(center){if(center.lat===this._center.lat&&center.lng===this._center.lng)return;this._unmodified=false;this._center=center;this._constrain();this._calcMatrices()};Transform.prototype.coveringZoomLevel=function coveringZoomLevel(options){return(options.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/options.tileSize))};Transform.prototype.coveringTiles=function coveringTiles(options){var z=this.coveringZoomLevel(options);var actualZ=z;if(z<options.minzoom)return[];if(z>options.maxzoom)z=options.maxzoom;var centerCoord=this.pointCoordinate(this.centerPoint,z);var centerPoint=new Point(centerCoord.column-.5,centerCoord.row-.5);var cornerCoords=[this.pointCoordinate(new Point(0,0),z),this.pointCoordinate(new Point(this.width,0),z),this.pointCoordinate(new Point(this.width,this.height),z),this.pointCoordinate(new Point(0,this.height),z)];return TileCoord.cover(z,cornerCoords,options.reparseOverscaled?actualZ:z,this._renderWorldCopies).sort(function(a,b){return centerPoint.dist(a)-centerPoint.dist(b)})};Transform.prototype.resize=function resize(width,height){this.width=width;this.height=height;this.pixelsToGLUnits=[2/width,-2/height];this._constrain();this._calcMatrices()};prototypeAccessors.unmodified.get=function(){return this._unmodified};Transform.prototype.zoomScale=function zoomScale(zoom){return Math.pow(2,zoom)};Transform.prototype.scaleZoom=function scaleZoom(scale){return Math.log(scale)/Math.LN2};Transform.prototype.project=function project(lnglat){return new Point(this.lngX(lnglat.lng),this.latY(lnglat.lat))};Transform.prototype.unproject=function unproject(point){return new LngLat(this.xLng(point.x),this.yLat(point.y))};prototypeAccessors.x.get=function(){return this.lngX(this.center.lng)};prototypeAccessors.y.get=function(){return this.latY(this.center.lat)};prototypeAccessors.point.get=function(){return new Point(this.x,this.y)};Transform.prototype.lngX=function lngX(lng){return(180+lng)*this.worldSize/360};Transform.prototype.latY=function latY(lat){var y=180/Math.PI*Math.log(Math.tan(Math.PI/4+lat*Math.PI/360));return(180-y)*this.worldSize/360};Transform.prototype.xLng=function xLng(x){return x*360/this.worldSize-180};Transform.prototype.yLat=function yLat(y){var y2=180-y*360/this.worldSize;return 360/Math.PI*Math.atan(Math.exp(y2*Math.PI/180))-90};Transform.prototype.setLocationAtPoint=function setLocationAtPoint(lnglat,point){var translate=this.pointCoordinate(point)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(lnglat)._sub(translate))};Transform.prototype.locationPoint=function locationPoint(lnglat){return this.coordinatePoint(this.locationCoordinate(lnglat))};Transform.prototype.pointLocation=function pointLocation(p){return this.coordinateLocation(this.pointCoordinate(p))};Transform.prototype.locationCoordinate=function locationCoordinate(lnglat){return new Coordinate(this.lngX(lnglat.lng)/this.tileSize,this.latY(lnglat.lat)/this.tileSize,this.zoom).zoomTo(this.tileZoom)};Transform.prototype.coordinateLocation=function coordinateLocation(coord){var zoomedCoord=coord.zoomTo(this.zoom);return new LngLat(this.xLng(zoomedCoord.column*this.tileSize),this.yLat(zoomedCoord.row*this.tileSize))};Transform.prototype.pointCoordinate=function pointCoordinate(p,zoom){if(zoom===undefined)zoom=this.tileZoom;var targetZ=0;var coord0=[p.x,p.y,0,1];var coord1=[p.x,p.y,1,1];vec4.transformMat4(coord0,coord0,this.pixelMatrixInverse);vec4.transformMat4(coord1,coord1,this.pixelMatrixInverse);var w0=coord0[3];var w1=coord1[3];var x0=coord0[0]/w0;var x1=coord1[0]/w1;var y0=coord0[1]/w0;var y1=coord1[1]/w1;var z0=coord0[2]/w0;var z1=coord1[2]/w1;var t=z0===z1?0:(targetZ-z0)/(z1-z0);return new Coordinate(interp(x0,x1,t)/this.tileSize,interp(y0,y1,t)/this.tileSize,this.zoom)._zoomTo(zoom)};Transform.prototype.coordinatePoint=function coordinatePoint(coord){var zoomedCoord=coord.zoomTo(this.zoom);var p=[zoomedCoord.column*this.tileSize,zoomedCoord.row*this.tileSize,0,1];vec4.transformMat4(p,p,this.pixelMatrix);return new Point(p[0]/p[3],p[1]/p[3])};Transform.prototype.calculatePosMatrix=function calculatePosMatrix(tileCoord,maxZoom){var coord=tileCoord.toCoordinate(maxZoom);var scale=this.worldSize/this.zoomScale(coord.zoom);var posMatrix=mat4.identity(new Float64Array(16));mat4.translate(posMatrix,posMatrix,[coord.column*scale,coord.row*scale,0]);mat4.scale(posMatrix,posMatrix,[scale/EXTENT,scale/EXTENT,1]);mat4.multiply(posMatrix,this.projMatrix,posMatrix);return new Float32Array(posMatrix)};Transform.prototype._constrain=function _constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=true;var minY,maxY,minX,maxX,sy,sx,x2,y2;var size=this.size,unmodified=this._unmodified;if(this.latRange){minY=this.latY(this.latRange[1]);maxY=this.latY(this.latRange[0]);sy=maxY-minY<size.y?size.y/(maxY-minY):0}if(this.lngRange){minX=this.lngX(this.lngRange[0]);maxX=this.lngX(this.lngRange[1]);sx=maxX-minX<size.x?size.x/(maxX-minX):0}var s=Math.max(sx||0,sy||0);if(s){this.center=this.unproject(new Point(sx?(maxX+minX)/2:this.x,sy?(maxY+minY)/2:this.y));this.zoom+=this.scaleZoom(s);this._unmodified=unmodified;this._constraining=false;return}if(this.latRange){var y=this.y,h2=size.y/2;if(y-h2<minY)y2=minY+h2;if(y+h2>maxY)y2=maxY-h2}if(this.lngRange){var x=this.x,w2=size.x/2;if(x-w2<minX)x2=minX+w2;if(x+w2>maxX)x2=maxX-w2}if(x2!==undefined||y2!==undefined){this.center=this.unproject(new Point(x2!==undefined?x2:this.x,y2!==undefined?y2:this.y))}this._unmodified=unmodified;this._constraining=false};Transform.prototype._calcMatrices=function _calcMatrices(){if(!this.height)return;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var halfFov=this._fov/2;var groundAngle=Math.PI/2+this._pitch;var topHalfSurfaceDistance=Math.sin(halfFov)*this.cameraToCenterDistance/Math.sin(Math.PI-groundAngle-halfFov);var furthestDistance=Math.cos(Math.PI/2-this._pitch)*topHalfSurfaceDistance+this.cameraToCenterDistance;var farZ=furthestDistance*1.01;var m=new Float64Array(16);mat4.perspective(m,this._fov,this.width/this.height,1,farZ);mat4.scale(m,m,[1,-1,1]);mat4.translate(m,m,[0,0,-this.cameraToCenterDistance]);mat4.rotateX(m,m,this._pitch);mat4.rotateZ(m,m,this.angle);mat4.translate(m,m,[-this.x,-this.y,0]);var verticalScale=this.worldSize/(2*Math.PI*6378137*Math.abs(Math.cos(this.center.lat*(Math.PI/180))));mat4.scale(m,m,[1,1,verticalScale,1]);this.projMatrix=m;m=mat4.create();mat4.scale(m,m,[this.width/2,-this.height/2,1]);mat4.translate(m,m,[1,-1,0]);this.pixelMatrix=mat4.multiply(new Float64Array(16),m,this.projMatrix);m=mat4.invert(new Float64Array(16),this.pixelMatrix);if(!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m};Object.defineProperties(Transform.prototype,prototypeAccessors);module.exports=Transform},{"../data/extent":607,"../source/tile_coord":647,"../util/interpolate":715,"../util/util":723,"./coordinate":614,"./lng_lat":615,"@mapbox/gl-matrix":1,"point-geometry":769}],618:[function(require,module,exports){"use strict";var WorkerPool=require("./util/worker_pool");var globalWorkerPool;module.exports=function getGlobalWorkerPool(){if(!globalWorkerPool){globalWorkerPool=new WorkerPool}return globalWorkerPool}},{"./util/worker_pool":726}],619:[function(require,module,exports){"use strict";var simplexFont={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],
"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};module.exports=function textVertices(text,left,baseline,scale){scale=scale||1;var strokes=[];var i,len,j,len2,glyph,x,y,prev;for(i=0,len=text.length;i<len;i++){glyph=simplexFont[text[i]];if(!glyph)continue;prev=null;for(j=0,len2=glyph[1].length;j<len2;j+=2){if(glyph[1][j]===-1&&glyph[1][j+1]===-1){prev=null}else{x=left+glyph[1][j]*scale;y=baseline-glyph[1][j+1]*scale;if(prev){strokes.push(prev.x,prev.y,x,y)}prev={x:x,y:y}}}left+=glyph[0]*scale}return strokes}},{}],620:[function(require,module,exports){"use strict";var browser=require("./util/browser");var mapboxgl=module.exports={};mapboxgl.version=require("../package.json").version;mapboxgl.workerCount=Math.max(Math.floor(browser.hardwareConcurrency/2),1);mapboxgl.Map=require("./ui/map");mapboxgl.NavigationControl=require("./ui/control/navigation_control");mapboxgl.GeolocateControl=require("./ui/control/geolocate_control");mapboxgl.AttributionControl=require("./ui/control/attribution_control");mapboxgl.ScaleControl=require("./ui/control/scale_control");mapboxgl.Popup=require("./ui/popup");mapboxgl.Marker=require("./ui/marker");mapboxgl.Style=require("./style/style");mapboxgl.LngLat=require("./geo/lng_lat");mapboxgl.LngLatBounds=require("./geo/lng_lat_bounds");mapboxgl.Point=require("point-geometry");mapboxgl.Evented=require("./util/evented");mapboxgl.util=require("./util/util");mapboxgl.supported=require("./util/browser").supported;var ajax=require("./util/ajax");mapboxgl.util.getJSON=ajax.getJSON;mapboxgl.util.getArrayBuffer=ajax.getArrayBuffer;var config=require("./util/config");mapboxgl.config=config;Object.defineProperty(mapboxgl,"accessToken",{get:function(){return config.ACCESS_TOKEN},set:function(token){config.ACCESS_TOKEN=token}})},{"../package.json":727,"./geo/lng_lat":615,"./geo/lng_lat_bounds":616,"./style/style":657,"./ui/control/attribution_control":687,"./ui/control/geolocate_control":688,"./ui/control/navigation_control":689,"./ui/control/scale_control":690,"./ui/map":699,"./ui/marker":700,"./ui/popup":701,"./util/ajax":703,"./util/browser":704,"./util/config":708,"./util/evented":712,"./util/util":723,"point-geometry":769}],621:[function(require,module,exports){"use strict";var pattern=require("./pattern");module.exports=drawBackground;function drawBackground(painter,sourceCache,layer){var gl=painter.gl;var transform=painter.transform;var tileSize=transform.tileSize;var color=layer.paint["background-color"];var image=layer.paint["background-pattern"];var opacity=layer.paint["background-opacity"];var isOpaque=!image&&color[3]===1&&opacity===1;if(painter.isOpaquePass!==isOpaque)return;gl.disable(gl.STENCIL_TEST);painter.setDepthSublayer(0);var program;if(image){program=painter.useProgram("fillPattern",painter.basicFillProgramConfiguration);pattern.prepare(image,painter,program);painter.tileExtentPatternVAO.bind(gl,program,painter.tileExtentBuffer)}else{program=painter.useProgram("fill",painter.basicFillProgramConfiguration);gl.uniform4fv(program.u_color,color);painter.tileExtentVAO.bind(gl,program,painter.tileExtentBuffer)}gl.uniform1f(program.u_opacity,opacity);var coords=transform.coveringTiles({tileSize:tileSize});for(var i=0,list=coords;i<list.length;i+=1){var coord=list[i];if(image){pattern.setTile({coord:coord,tileSize:tileSize},painter,program)}gl.uniformMatrix4fv(program.u_matrix,false,painter.transform.calculatePosMatrix(coord));gl.drawArrays(gl.TRIANGLE_STRIP,0,painter.tileExtentBuffer.length)}}},{"./pattern":633}],622:[function(require,module,exports){"use strict";var browser=require("../util/browser");module.exports=drawCircles;function drawCircles(painter,sourceCache,layer,coords){if(painter.isOpaquePass)return;var gl=painter.gl;painter.setDepthSublayer(0);painter.depthMask(false);gl.disable(gl.STENCIL_TEST);for(var i=0;i<coords.length;i++){var coord=coords[i];var tile=sourceCache.getTile(coord);var bucket=tile.getBucket(layer);if(!bucket)continue;var buffers=bucket.buffers;var layerData=buffers.layerData[layer.id];var programConfiguration=layerData.programConfiguration;var program=painter.useProgram("circle",programConfiguration);programConfiguration.setUniforms(gl,program,layer,{zoom:painter.transform.zoom});if(layer.paint["circle-pitch-scale"]==="map"){gl.uniform1i(program.u_scale_with_map,true);gl.uniform2f(program.u_extrude_scale,painter.transform.pixelsToGLUnits[0]*painter.transform.cameraToCenterDistance,painter.transform.pixelsToGLUnits[1]*painter.transform.cameraToCenterDistance)}else{gl.uniform1i(program.u_scale_with_map,false);gl.uniform2fv(program.u_extrude_scale,painter.transform.pixelsToGLUnits)}gl.uniform1f(program.u_devicepixelratio,browser.devicePixelRatio);gl.uniformMatrix4fv(program.u_matrix,false,painter.translatePosMatrix(coord.posMatrix,tile,layer.paint["circle-translate"],layer.paint["circle-translate-anchor"]));for(var i$1=0,list=buffers.segments;i$1<list.length;i$1+=1){var segment=list[i$1];segment.vaos[layer.id].bind(gl,program,buffers.layoutVertexBuffer,buffers.elementBuffer,layerData.paintVertexBuffer,segment.vertexOffset);gl.drawElements(gl.TRIANGLES,segment.primitiveLength*3,gl.UNSIGNED_SHORT,segment.primitiveOffset*3*2)}}}},{"../util/browser":704}],623:[function(require,module,exports){"use strict";module.exports=drawCollisionDebug;function drawCollisionDebug(painter,sourceCache,layer,coords){var gl=painter.gl;gl.enable(gl.STENCIL_TEST);var program=painter.useProgram("collisionBox");for(var i=0;i<coords.length;i++){var coord=coords[i];var tile=sourceCache.getTile(coord);var bucket=tile.getBucket(layer);if(!bucket)continue;var buffers=bucket.buffers.collisionBox;if(!buffers)continue;gl.uniformMatrix4fv(program.u_matrix,false,coord.posMatrix);painter.enableTileClippingMask(coord);painter.lineWidth(1);gl.uniform1f(program.u_scale,Math.pow(2,painter.transform.zoom-tile.coord.z));gl.uniform1f(program.u_zoom,painter.transform.zoom*10);gl.uniform1f(program.u_maxzoom,(tile.coord.z+1)*10);for(var i$1=0,list=buffers.segments;i$1<list.length;i$1+=1){var segment=list[i$1];segment.vaos[layer.id].bind(gl,program,buffers.layoutVertexBuffer,buffers.elementBuffer,null,segment.vertexOffset);gl.drawElements(gl.LINES,segment.primitiveLength*2,gl.UNSIGNED_SHORT,segment.primitiveOffset*2*2)}}}},{}],624:[function(require,module,exports){"use strict";var textVertices=require("../lib/debugtext");var browser=require("../util/browser");var mat4=require("@mapbox/gl-matrix").mat4;var EXTENT=require("../data/extent");var Buffer=require("../data/buffer");var VertexArrayObject=require("./vertex_array_object");var PosArray=require("../data/pos_array");module.exports=drawDebug;function drawDebug(painter,sourceCache,coords){for(var i=0;i<coords.length;i++){drawDebugTile(painter,sourceCache,coords[i])}}function drawDebugTile(painter,sourceCache,coord){var gl=painter.gl;gl.disable(gl.STENCIL_TEST);painter.lineWidth(1*browser.devicePixelRatio);var posMatrix=coord.posMatrix;var program=painter.useProgram("debug");gl.uniformMatrix4fv(program.u_matrix,false,posMatrix);gl.uniform4f(program.u_color,1,0,0,1);painter.debugVAO.bind(gl,program,painter.debugBuffer);gl.drawArrays(gl.LINE_STRIP,0,painter.debugBuffer.length);var vertices=textVertices(coord.toString(),50,200,5);var debugTextArray=new PosArray;for(var v=0;v<vertices.length;v+=2){debugTextArray.emplaceBack(vertices[v],vertices[v+1])}var debugTextBuffer=Buffer.fromStructArray(debugTextArray,Buffer.BufferType.VERTEX);var debugTextVAO=new VertexArrayObject;debugTextVAO.bind(gl,program,debugTextBuffer);gl.uniform4f(program.u_color,1,1,1,1);var tileSize=sourceCache.getTile(coord).tileSize;var onePixel=EXTENT/(Math.pow(2,painter.transform.zoom-coord.z)*tileSize);var translations=[[-1,-1],[-1,1],[1,-1],[1,1]];for(var i=0;i<translations.length;i++){var translation=translations[i];gl.uniformMatrix4fv(program.u_matrix,false,mat4.translate([],posMatrix,[onePixel*translation[0],onePixel*translation[1],0]));gl.drawArrays(gl.LINES,0,debugTextBuffer.length)}gl.uniform4f(program.u_color,0,0,0,1);gl.uniformMatrix4fv(program.u_matrix,false,posMatrix);gl.drawArrays(gl.LINES,0,debugTextBuffer.length)}},{"../data/buffer":604,"../data/extent":607,"../data/pos_array":610,"../lib/debugtext":619,"../util/browser":704,"./vertex_array_object":635,"@mapbox/gl-matrix":1}],625:[function(require,module,exports){"use strict";var pattern=require("./pattern");module.exports=drawFill;function drawFill(painter,sourceCache,layer,coords){var gl=painter.gl;gl.enable(gl.STENCIL_TEST);var isOpaque=!layer.paint["fill-pattern"]&&layer.isPaintValueFeatureConstant("fill-color")&&layer.isPaintValueFeatureConstant("fill-opacity")&&layer.paint["fill-color"][3]===1&&layer.paint["fill-opacity"]===1;if(painter.isOpaquePass===isOpaque){painter.setDepthSublayer(1);drawFillTiles(painter,sourceCache,layer,coords,drawFillTile)}if(!painter.isOpaquePass&&layer.paint["fill-antialias"]){painter.lineWidth(2);painter.depthMask(false);painter.setDepthSublayer(layer.getPaintProperty("fill-outline-color")?2:0);drawFillTiles(painter,sourceCache,layer,coords,drawStrokeTile)}}function drawFillTiles(painter,sourceCache,layer,coords,drawFn){var firstTile=true;for(var i=0,list=coords;i<list.length;i+=1){var coord=list[i];var tile=sourceCache.getTile(coord);var bucket=tile.getBucket(layer);if(!bucket)continue;painter.enableTileClippingMask(coord);drawFn(painter,sourceCache,layer,tile,coord,bucket.buffers,firstTile);firstTile=false}}function drawFillTile(painter,sourceCache,layer,tile,coord,buffers,firstTile){var gl=painter.gl;var layerData=buffers.layerData[layer.id];var program=setFillProgram("fill",layer.paint["fill-pattern"],painter,layerData,layer,tile,coord,firstTile);for(var i=0,list=buffers.segments;i<list.length;i+=1){var segment=list[i];segment.vaos[layer.id].bind(gl,program,buffers.layoutVertexBuffer,buffers.elementBuffer,layerData.paintVertexBuffer,segment.vertexOffset);gl.drawElements(gl.TRIANGLES,segment.primitiveLength*3,gl.UNSIGNED_SHORT,segment.primitiveOffset*3*2)}}function drawStrokeTile(painter,sourceCache,layer,tile,coord,buffers,firstTile){var gl=painter.gl;var layerData=buffers.layerData[layer.id];var usePattern=layer.paint["fill-pattern"]&&!layer.getPaintProperty("fill-outline-color");var program=setFillProgram("fillOutline",usePattern,painter,layerData,layer,tile,coord,firstTile);gl.uniform2f(program.u_world,gl.drawingBufferWidth,gl.drawingBufferHeight);for(var i=0,list=buffers.segments2;i<list.length;i+=1){var segment=list[i];segment.vaos[layer.id].bind(gl,program,buffers.layoutVertexBuffer,buffers.elementBuffer2,layerData.paintVertexBuffer,segment.vertexOffset);gl.drawElements(gl.LINES,segment.primitiveLength*2,gl.UNSIGNED_SHORT,segment.primitiveOffset*2*2)}}function setFillProgram(programId,usePattern,painter,layerData,layer,tile,coord,firstTile){var program;var prevProgram=painter.currentProgram;if(!usePattern){program=painter.useProgram(programId,layerData.programConfiguration);if(firstTile||program!==prevProgram){layerData.programConfiguration.setUniforms(painter.gl,program,layer,{zoom:painter.transform.zoom})}}else{program=painter.useProgram(programId+"Pattern",layerData.programConfiguration);if(firstTile||program!==prevProgram){layerData.programConfiguration.setUniforms(painter.gl,program,layer,{zoom:painter.transform.zoom});pattern.prepare(layer.paint["fill-pattern"],painter,program)}pattern.setTile(tile,painter,program)}painter.gl.uniformMatrix4fv(program.u_matrix,false,painter.translatePosMatrix(coord.posMatrix,tile,layer.paint["fill-translate"],layer.paint["fill-translate-anchor"]));return program}},{"./pattern":633}],626:[function(require,module,exports){"use strict";var glMatrix=require("@mapbox/gl-matrix");var Buffer=require("../data/buffer");var VertexArrayObject=require("./vertex_array_object");var PosArray=require("../data/pos_array");var pattern=require("./pattern");var mat3=glMatrix.mat3;var mat4=glMatrix.mat4;var vec3=glMatrix.vec3;module.exports=draw;function draw(painter,source,layer,coords){if(layer.paint["fill-extrusion-opacity"]===0)return;var gl=painter.gl;gl.disable(gl.STENCIL_TEST);gl.enable(gl.DEPTH_TEST);painter.depthMask(true);var texture=new ExtrusionTexture(gl,painter,layer);texture.bindFramebuffer();gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);for(var i=0;i<coords.length;i++){drawExtrusion(painter,source,layer,coords[i])}texture.unbindFramebuffer();texture.renderToMap()}function ExtrusionTexture(gl,painter,layer){this.gl=gl;this.width=painter.width;this.height=painter.height;this.painter=painter;this.layer=layer;this.texture=null;this.fbo=null;this.fbos=this.painter.preFbos[this.width]&&this.painter.preFbos[this.width][this.height]}ExtrusionTexture.prototype.bindFramebuffer=function(){var gl=this.gl;this.texture=this.painter.getViewportTexture(this.width,this.height);gl.activeTexture(gl.TEXTURE1);if(!this.texture){this.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.width,this.height,0,gl.RGBA,gl.UNSIGNED_BYTE,null);this.texture.width=this.width;this.texture.height=this.height}else{gl.bindTexture(gl.TEXTURE_2D,this.texture)}if(!this.fbos){this.fbo=gl.createFramebuffer();var stencil=gl.createRenderbuffer();var depthRenderBuffer=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,stencil);gl.bindRenderbuffer(gl.RENDERBUFFER,depthRenderBuffer);gl.renderbufferStorage(gl.RENDERBUFFER,gl.RGBA4,this.width,this.height);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,this.width,this.height);gl.bindFramebuffer(gl.FRAMEBUFFER,this.fbo);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,stencil);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,depthRenderBuffer);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texture,0)}else{this.fbo=this.fbos.pop();gl.bindFramebuffer(gl.FRAMEBUFFER,this.fbo);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texture,0)}};ExtrusionTexture.prototype.unbindFramebuffer=function(){this.painter.bindDefaultFramebuffer();if(this.fbos){this.fbos.push(this.fbo)}else{if(!this.painter.preFbos[this.width])this.painter.preFbos[this.width]={};this.painter.preFbos[this.width][this.height]=[this.fbo]}this.painter.saveViewportTexture(this.texture)};ExtrusionTexture.prototype.renderToMap=function(){var gl=this.gl;var painter=this.painter;var program=painter.useProgram("extrusionTexture");gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.uniform1f(program.u_opacity,this.layer.paint["fill-extrusion-opacity"]);gl.uniform1i(program.u_texture,1);gl.uniformMatrix4fv(program.u_matrix,false,mat4.ortho(mat4.create(),0,painter.width,painter.height,0,0,1));gl.disable(gl.DEPTH_TEST);gl.uniform1i(program.u_xdim,painter.width);gl.uniform1i(program.u_ydim,painter.height);var array=new PosArray;array.emplaceBack(0,0);array.emplaceBack(painter.width,0);array.emplaceBack(0,painter.height);array.emplaceBack(painter.width,painter.height);var buffer=Buffer.fromStructArray(array,Buffer.BufferType.VERTEX);var vao=new VertexArrayObject;vao.bind(gl,program,buffer);gl.drawArrays(gl.TRIANGLE_STRIP,0,4);gl.enable(gl.DEPTH_TEST)};function drawExtrusion(painter,source,layer,coord){if(painter.isOpaquePass)return;var tile=source.getTile(coord);var bucket=tile.getBucket(layer);if(!bucket)return;var buffers=bucket.buffers;var gl=painter.gl;var image=layer.paint["fill-extrusion-pattern"];var layerData=buffers.layerData[layer.id];var programConfiguration=layerData.programConfiguration;var program=painter.useProgram(image?"fillExtrusionPattern":"fillExtrusion",programConfiguration);programConfiguration.setUniforms(gl,program,layer,{zoom:painter.transform.zoom});if(image){pattern.prepare(image,painter,program);pattern.setTile(tile,painter,program);gl.uniform1f(program.u_height_factor,-Math.pow(2,coord.z)/tile.tileSize/8)}painter.gl.uniformMatrix4fv(program.u_matrix,false,painter.translatePosMatrix(coord.posMatrix,tile,layer.paint["fill-extrusion-translate"],layer.paint["fill-extrusion-translate-anchor"]));setLight(program,painter);for(var i=0,list=buffers.segments;i<list.length;i+=1){var segment=list[i];segment.vaos[layer.id].bind(gl,program,buffers.layoutVertexBuffer,buffers.elementBuffer,layerData.paintVertexBuffer,segment.vertexOffset);gl.drawElements(gl.TRIANGLES,segment.primitiveLength*3,gl.UNSIGNED_SHORT,segment.primitiveOffset*3*2)}}function setLight(program,painter){var gl=painter.gl;var light=painter.style.light;var _lp=light.calculated.position,lightPos=[_lp.x,_lp.y,_lp.z];var lightMat=mat3.create();if(light.calculated.anchor==="viewport")mat3.fromRotation(lightMat,-painter.transform.angle);vec3.transformMat3(lightPos,lightPos,lightMat);gl.uniform3fv(program.u_lightpos,lightPos);gl.uniform1f(program.u_lightintensity,light.calculated.intensity);gl.uniform3fv(program.u_lightcolor,light.calculated.color.slice(0,3))}},{"../data/buffer":604,"../data/pos_array":610,"./pattern":633,"./vertex_array_object":635,"@mapbox/gl-matrix":1}],627:[function(require,module,exports){"use strict";var browser=require("../util/browser");var pixelsToTileUnits=require("../source/pixels_to_tile_units");module.exports=function drawLine(painter,sourceCache,layer,coords){if(painter.isOpaquePass)return;painter.setDepthSublayer(0);painter.depthMask(false);var gl=painter.gl;gl.enable(gl.STENCIL_TEST);if(layer.paint["line-width"]<=0)return;var programId=layer.paint["line-dasharray"]?"lineSDF":layer.paint["line-pattern"]?"linePattern":"line";var prevTileZoom;var firstTile=true;for(var i=0,list=coords;i<list.length;i+=1){var coord=list[i];var tile=sourceCache.getTile(coord);var bucket=tile.getBucket(layer);if(!bucket)continue;var layerData=bucket.buffers.layerData[layer.id];var prevProgram=painter.currentProgram;var program=painter.useProgram(programId,layerData.programConfiguration);var programChanged=firstTile||program!==prevProgram;var tileRatioChanged=prevTileZoom!==tile.coord.z;if(programChanged){layerData.programConfiguration.setUniforms(painter.gl,program,layer,{zoom:painter.transform.zoom})}drawLineTile(program,painter,tile,bucket.buffers,layer,coord,layerData,programChanged,tileRatioChanged);prevTileZoom=tile.coord.z;firstTile=false}};function drawLineTile(program,painter,tile,buffers,layer,coord,layerData,programChanged,tileRatioChanged){var gl=painter.gl;var dasharray=layer.paint["line-dasharray"];var image=layer.paint["line-pattern"];var posA,posB,imagePosA,imagePosB;if(programChanged||tileRatioChanged){var tileRatio=1/pixelsToTileUnits(tile,1,painter.transform.tileZoom);if(dasharray){posA=painter.lineAtlas.getDash(dasharray.from,layer.layout["line-cap"]==="round");posB=painter.lineAtlas.getDash(dasharray.to,layer.layout["line-cap"]==="round");var widthA=posA.width*dasharray.fromScale;var widthB=posB.width*dasharray.toScale;gl.uniform2f(program.u_patternscale_a,tileRatio/widthA,-posA.height/2);gl.uniform2f(program.u_patternscale_b,tileRatio/widthB,-posB.height/2);gl.uniform1f(program.u_sdfgamma,painter.lineAtlas.width/(Math.min(widthA,widthB)*256*browser.devicePixelRatio)/2)}else if(image){imagePosA=painter.spriteAtlas.getPosition(image.from,true);imagePosB=painter.spriteAtlas.getPosition(image.to,true);if(!imagePosA||!imagePosB)return;gl.uniform2f(program.u_pattern_size_a,imagePosA.size[0]*image.fromScale/tileRatio,imagePosB.size[1]);gl.uniform2f(program.u_pattern_size_b,imagePosB.size[0]*image.toScale/tileRatio,imagePosB.size[1])}gl.uniform2f(program.u_gl_units_to_pixels,1/painter.transform.pixelsToGLUnits[0],1/painter.transform.pixelsToGLUnits[1])}if(programChanged){if(dasharray){gl.uniform1i(program.u_image,0);gl.activeTexture(gl.TEXTURE0);painter.lineAtlas.bind(gl);gl.uniform1f(program.u_tex_y_a,posA.y);gl.uniform1f(program.u_tex_y_b,posB.y);gl.uniform1f(program.u_mix,dasharray.t)}else if(image){gl.uniform1i(program.u_image,0);gl.activeTexture(gl.TEXTURE0);painter.spriteAtlas.bind(gl,true);gl.uniform2fv(program.u_pattern_tl_a,imagePosA.tl);gl.uniform2fv(program.u_pattern_br_a,imagePosA.br);gl.uniform2fv(program.u_pattern_tl_b,imagePosB.tl);gl.uniform2fv(program.u_pattern_br_b,imagePosB.br);gl.uniform1f(program.u_fade,image.t)}gl.uniform1f(program.u_width,layer.paint["line-width"])}painter.enableTileClippingMask(coord);var posMatrix=painter.translatePosMatrix(coord.posMatrix,tile,layer.paint["line-translate"],layer.paint["line-translate-anchor"]);gl.uniformMatrix4fv(program.u_matrix,false,posMatrix);gl.uniform1f(program.u_ratio,1/pixelsToTileUnits(tile,1,painter.transform.zoom));for(var i=0,list=buffers.segments;i<list.length;i+=1){var segment=list[i];segment.vaos[layer.id].bind(gl,program,buffers.layoutVertexBuffer,buffers.elementBuffer,layerData.paintVertexBuffer,segment.vertexOffset);gl.drawElements(gl.TRIANGLES,segment.primitiveLength*3,gl.UNSIGNED_SHORT,segment.primitiveOffset*3*2)}}},{"../source/pixels_to_tile_units":641,"../util/browser":704}],628:[function(require,module,exports){"use strict";var util=require("../util/util");module.exports=drawRaster;function drawRaster(painter,sourceCache,layer,coords){if(painter.isOpaquePass)return;var gl=painter.gl;gl.enable(gl.DEPTH_TEST);painter.depthMask(true);gl.depthFunc(gl.LESS);var minTileZ=coords.length&&coords[0].z;for(var i=0;i<coords.length;i++){var coord=coords[i];painter.setDepthSublayer(coord.z-minTileZ);drawRasterTile(painter,sourceCache,layer,coord)}gl.depthFunc(gl.LEQUAL)}function drawRasterTile(painter,sourceCache,layer,coord){var gl=painter.gl;gl.disable(gl.STENCIL_TEST);var tile=sourceCache.getTile(coord);var posMatrix=painter.transform.calculatePosMatrix(coord,sourceCache.getSource().maxzoom);tile.registerFadeDuration(painter.style.animationLoop,layer.paint["raster-fade-duration"]);var program=painter.useProgram("raster");gl.uniformMatrix4fv(program.u_matrix,false,posMatrix);gl.uniform1f(program.u_brightness_low,layer.paint["raster-brightness-min"]);gl.uniform1f(program.u_brightness_high,layer.paint["raster-brightness-max"]);gl.uniform1f(program.u_saturation_factor,saturationFactor(layer.paint["raster-saturation"]));gl.uniform1f(program.u_contrast_factor,contrastFactor(layer.paint["raster-contrast"]));gl.uniform3fv(program.u_spin_weights,spinWeights(layer.paint["raster-hue-rotate"]));var parentTile=tile.sourceCache&&tile.sourceCache.findLoadedParent(coord,0,{}),fade=getFadeValues(tile,parentTile,layer,painter.transform);var parentScaleBy,parentTL;gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,tile.texture);gl.activeTexture(gl.TEXTURE1);if(parentTile){gl.bindTexture(gl.TEXTURE_2D,parentTile.texture);parentScaleBy=Math.pow(2,parentTile.coord.z-tile.coord.z);parentTL=[tile.coord.x*parentScaleBy%1,tile.coord.y*parentScaleBy%1]}else{gl.bindTexture(gl.TEXTURE_2D,tile.texture)}gl.uniform2fv(program.u_tl_parent,parentTL||[0,0]);gl.uniform1f(program.u_scale_parent,parentScaleBy||1);gl.uniform1f(program.u_buffer_scale,1);gl.uniform1f(program.u_fade_t,fade.mix);gl.uniform1f(program.u_opacity,fade.opacity*layer.paint["raster-opacity"]);gl.uniform1i(program.u_image0,0);gl.uniform1i(program.u_image1,1);var buffer=tile.boundsBuffer||painter.rasterBoundsBuffer;var vao=tile.boundsVAO||painter.rasterBoundsVAO;vao.bind(gl,program,buffer);gl.drawArrays(gl.TRIANGLE_STRIP,0,buffer.length)}function spinWeights(angle){angle*=Math.PI/180;var s=Math.sin(angle);var c=Math.cos(angle);return[(2*c+1)/3,(-Math.sqrt(3)*s-c+1)/3,(Math.sqrt(3)*s-c+1)/3]}function contrastFactor(contrast){return contrast>0?1/(1-contrast):1+contrast}function saturationFactor(saturation){return saturation>0?1-1/(1.001-saturation):-saturation}function getFadeValues(tile,parentTile,layer,transform){var fadeDuration=layer.paint["raster-fade-duration"];if(tile.sourceCache&&fadeDuration>0){var now=Date.now();var sinceTile=(now-tile.timeAdded)/fadeDuration;var sinceParent=parentTile?(now-parentTile.timeAdded)/fadeDuration:-1;var source=tile.sourceCache.getSource();var idealZ=transform.coveringZoomLevel({tileSize:source.tileSize,roundZoom:source.roundZoom});var fadeIn=!parentTile||Math.abs(parentTile.coord.z-idealZ)>Math.abs(tile.coord.z-idealZ);var childOpacity=util.clamp(fadeIn?sinceTile:1-sinceParent,0,1);if(parentTile){return{opacity:1,mix:1-childOpacity}}else{return{opacity:childOpacity,mix:0}}}else{return{opacity:1,mix:0}}}},{"../util/util":723}],629:[function(require,module,exports){"use strict";var browser=require("../util/browser");var drawCollisionDebug=require("./draw_collision_debug");var pixelsToTileUnits=require("../source/pixels_to_tile_units");module.exports=drawSymbols;var sdfPx=8;var blurOffset=1.19;var haloOffset=6;var gamma=.105/browser.devicePixelRatio;function drawSymbols(painter,sourceCache,layer,coords){if(painter.isOpaquePass)return;var drawAcrossEdges=!layer.layout["text-allow-overlap"]&&!layer.layout["icon-allow-overlap"]&&!layer.layout["text-ignore-placement"]&&!layer.layout["icon-ignore-placement"];var gl=painter.gl;if(drawAcrossEdges){gl.disable(gl.STENCIL_TEST)}else{gl.enable(gl.STENCIL_TEST)}painter.setDepthSublayer(0);painter.depthMask(false);drawLayerSymbols(painter,sourceCache,layer,coords,false,layer.paint["icon-translate"],layer.paint["icon-translate-anchor"],layer.layout["icon-rotation-alignment"],layer.layout["icon-rotation-alignment"],layer.layout["icon-size"],layer.paint["icon-halo-width"],layer.paint["icon-halo-color"],layer.paint["icon-halo-blur"],layer.paint["icon-opacity"],layer.paint["icon-color"]);drawLayerSymbols(painter,sourceCache,layer,coords,true,layer.paint["text-translate"],layer.paint["text-translate-anchor"],layer.layout["text-rotation-alignment"],layer.layout["text-pitch-alignment"],layer.layout["text-size"],layer.paint["text-halo-width"],layer.paint["text-halo-color"],layer.paint["text-halo-blur"],layer.paint["text-opacity"],layer.paint["text-color"]);
if(sourceCache.map.showCollisionBoxes){drawCollisionDebug(painter,sourceCache,layer,coords)}}function drawLayerSymbols(painter,sourceCache,layer,coords,isText,translate,translateAnchor,rotationAlignment,pitchAlignment,size,haloWidth,haloColor,haloBlur,opacity,color){if(!isText&&painter.style.sprite&&!painter.style.sprite.loaded())return;var gl=painter.gl;var rotateWithMap=rotationAlignment==="map";var pitchWithMap=pitchAlignment==="map";var depthOn=pitchWithMap;if(depthOn){gl.enable(gl.DEPTH_TEST)}else{gl.disable(gl.DEPTH_TEST)}var program;for(var i=0,list=coords;i<list.length;i+=1){var coord=list[i];var tile=sourceCache.getTile(coord);var bucket=tile.getBucket(layer);if(!bucket)continue;var buffers=isText?bucket.buffers.glyph:bucket.buffers.icon;if(!buffers||!buffers.segments.length)continue;var isSDF=isText||bucket.sdfIcons;if(!program){program=painter.useProgram(isSDF?"symbolSDF":"symbolIcon");setSymbolDrawState(program,painter,isText,isSDF,rotateWithMap,pitchWithMap,bucket.fontstack,size,bucket.iconsNeedLinear,isText?bucket.adjustedTextSize:bucket.adjustedIconSize,opacity)}painter.enableTileClippingMask(coord);gl.uniformMatrix4fv(program.u_matrix,false,painter.translatePosMatrix(coord.posMatrix,tile,translate,translateAnchor));drawTileSymbols(program,painter,layer,tile,buffers,isText,isSDF,pitchWithMap,size,haloWidth,haloColor,haloBlur,color)}if(!depthOn)gl.enable(gl.DEPTH_TEST)}function setSymbolDrawState(program,painter,isText,isSDF,rotateWithMap,pitchWithMap,fontstack,size,iconsNeedLinear,adjustedSize,opacity){var gl=painter.gl;var tr=painter.transform;gl.uniform1i(program.u_rotate_with_map,rotateWithMap);gl.uniform1i(program.u_pitch_with_map,pitchWithMap);gl.activeTexture(gl.TEXTURE0);gl.uniform1i(program.u_texture,0);if(isText){var glyphAtlas=fontstack&&painter.glyphSource.getGlyphAtlas(fontstack);if(!glyphAtlas)return;glyphAtlas.updateTexture(gl);gl.uniform2f(program.u_texsize,glyphAtlas.width/4,glyphAtlas.height/4)}else{var mapMoving=painter.options.rotating||painter.options.zooming;var iconScaled=size!==1||browser.devicePixelRatio!==painter.spriteAtlas.pixelRatio||iconsNeedLinear;var iconTransformed=pitchWithMap||tr.pitch;painter.spriteAtlas.bind(gl,isSDF||mapMoving||iconScaled||iconTransformed);gl.uniform2f(program.u_texsize,painter.spriteAtlas.width/4,painter.spriteAtlas.height/4)}gl.activeTexture(gl.TEXTURE1);painter.frameHistory.bind(gl);gl.uniform1i(program.u_fadetexture,1);var zoomAdjust=Math.log(size/adjustedSize)/Math.LN2||0;gl.uniform1f(program.u_zoom,(tr.zoom-zoomAdjust)*10);gl.uniform1f(program.u_pitch,tr.pitch/360*2*Math.PI);gl.uniform1f(program.u_bearing,tr.bearing/360*2*Math.PI);gl.uniform1f(program.u_aspect_ratio,tr.width/tr.height);gl.uniform1f(program.u_opacity,opacity)}function drawTileSymbols(program,painter,layer,tile,buffers,isText,isSDF,pitchWithMap,size,haloWidth,haloColor,haloBlur,color){var gl=painter.gl;var tr=painter.transform;var fontScale=size/(isText?24:1);if(pitchWithMap){var s=pixelsToTileUnits(tile,fontScale,tr.zoom);gl.uniform2f(program.u_extrude_scale,s,s)}else{var s$1=tr.cameraToCenterDistance*fontScale;gl.uniform2f(program.u_extrude_scale,tr.pixelsToGLUnits[0]*s$1,tr.pixelsToGLUnits[1]*s$1)}if(isSDF){var gammaScale=fontScale*(pitchWithMap?Math.cos(tr._pitch):1)*tr.cameraToCenterDistance;if(haloWidth){gl.uniform1f(program.u_gamma,(haloBlur*blurOffset/sdfPx+gamma)/gammaScale);gl.uniform4fv(program.u_color,haloColor);gl.uniform1f(program.u_buffer,(haloOffset-haloWidth/fontScale)/sdfPx);drawSymbolElements(buffers,layer,gl,program)}gl.uniform1f(program.u_gamma,gamma/gammaScale);gl.uniform4fv(program.u_color,color);gl.uniform1f(program.u_buffer,(256-64)/256)}drawSymbolElements(buffers,layer,gl,program)}function drawSymbolElements(buffers,layer,gl,program){for(var i=0,list=buffers.segments;i<list.length;i+=1){var segment=list[i];segment.vaos[layer.id].bind(gl,program,buffers.layoutVertexBuffer,buffers.elementBuffer,null,segment.vertexOffset);gl.drawElements(gl.TRIANGLES,segment.primitiveLength*3,gl.UNSIGNED_SHORT,segment.primitiveOffset*3*2)}}},{"../source/pixels_to_tile_units":641,"../util/browser":704,"./draw_collision_debug":623}],630:[function(require,module,exports){"use strict";var FrameHistory=function FrameHistory(){this.changeTimes=new Float64Array(256);this.changeOpacities=new Uint8Array(256);this.opacities=new Uint8ClampedArray(256);this.array=new Uint8Array(this.opacities.buffer);this.previousZoom=0;this.firstFrame=true};FrameHistory.prototype.record=function record(now,zoom,duration){var this$1=this;if(this.firstFrame){now=0;this.firstFrame=false}zoom=Math.floor(zoom*10);var z;if(zoom<this.previousZoom){for(z=zoom+1;z<=this.previousZoom;z++){this$1.changeTimes[z]=now;this$1.changeOpacities[z]=this$1.opacities[z]}}else{for(z=zoom;z>this.previousZoom;z--){this$1.changeTimes[z]=now;this$1.changeOpacities[z]=this$1.opacities[z]}}for(z=0;z<256;z++){var timeSince=now-this$1.changeTimes[z];var opacityChange=(duration?timeSince/duration:1)*255;if(z<=zoom){this$1.opacities[z]=this$1.changeOpacities[z]+opacityChange}else{this$1.opacities[z]=this$1.changeOpacities[z]-opacityChange}}this.changed=true;this.previousZoom=zoom};FrameHistory.prototype.bind=function bind(gl){if(!this.texture){this.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texImage2D(gl.TEXTURE_2D,0,gl.ALPHA,256,1,0,gl.ALPHA,gl.UNSIGNED_BYTE,this.array)}else{gl.bindTexture(gl.TEXTURE_2D,this.texture);if(this.changed){gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,256,1,gl.ALPHA,gl.UNSIGNED_BYTE,this.array);this.changed=false}}};module.exports=FrameHistory},{}],631:[function(require,module,exports){"use strict";var util=require("../util/util");var LineAtlas=function LineAtlas(width,height){this.width=width;this.height=height;this.nextRow=0;this.bytes=4;this.data=new Uint8Array(this.width*this.height*this.bytes);this.positions={}};LineAtlas.prototype.setSprite=function setSprite(sprite){this.sprite=sprite};LineAtlas.prototype.getDash=function getDash(dasharray,round){var key=dasharray.join(",")+round;if(!this.positions[key]){this.positions[key]=this.addDash(dasharray,round)}return this.positions[key]};LineAtlas.prototype.addDash=function addDash(dasharray,round){var this$1=this;var n=round?7:0;var height=2*n+1;var offset=128;if(this.nextRow+height>this.height){util.warnOnce("LineAtlas out of space");return null}var length=0;for(var i=0;i<dasharray.length;i++){length+=dasharray[i]}var stretch=this.width/length;var halfWidth=stretch/2;var oddLength=dasharray.length%2===1;for(var y=-n;y<=n;y++){var row=this$1.nextRow+n+y;var index=this$1.width*row;var left=oddLength?-dasharray[dasharray.length-1]:0;var right=dasharray[0];var partIndex=1;for(var x=0;x<this.width;x++){while(right<x/stretch){left=right;right=right+dasharray[partIndex];if(oddLength&&partIndex===dasharray.length-1){right+=dasharray[0]}partIndex++}var distLeft=Math.abs(x-left*stretch);var distRight=Math.abs(x-right*stretch);var dist=Math.min(distLeft,distRight);var inside=partIndex%2===1;var signedDistance;if(round){var distMiddle=n?y/n*(halfWidth+1):0;if(inside){var distEdge=halfWidth-Math.abs(distMiddle);signedDistance=Math.sqrt(dist*dist+distEdge*distEdge)}else{signedDistance=halfWidth-Math.sqrt(dist*dist+distMiddle*distMiddle)}}else{signedDistance=(inside?1:-1)*dist}this$1.data[3+(index+x)*4]=Math.max(0,Math.min(255,signedDistance+offset))}}var pos={y:(this.nextRow+n+.5)/this.height,height:2*n/this.height,width:length};this.nextRow+=height;this.dirty=true;return pos};LineAtlas.prototype.bind=function bind(gl){if(!this.texture){this.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.width,this.height,0,gl.RGBA,gl.UNSIGNED_BYTE,this.data)}else{gl.bindTexture(gl.TEXTURE_2D,this.texture);if(this.dirty){this.dirty=false;gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,this.width,this.height,gl.RGBA,gl.UNSIGNED_BYTE,this.data)}}};module.exports=LineAtlas},{"../util/util":723}],632:[function(require,module,exports){"use strict";var browser=require("../util/browser");var mat4=require("@mapbox/gl-matrix").mat4;var FrameHistory=require("./frame_history");var SourceCache=require("../source/source_cache");var EXTENT=require("../data/extent");var pixelsToTileUnits=require("../source/pixels_to_tile_units");var util=require("../util/util");var Buffer=require("../data/buffer");var VertexArrayObject=require("./vertex_array_object");var RasterBoundsArray=require("../data/raster_bounds_array");var PosArray=require("../data/pos_array");var ProgramConfiguration=require("../data/program_configuration");var shaders=require("./shaders");var draw={symbol:require("./draw_symbol"),circle:require("./draw_circle"),line:require("./draw_line"),fill:require("./draw_fill"),"fill-extrusion":require("./draw_fill_extrusion"),raster:require("./draw_raster"),background:require("./draw_background"),debug:require("./draw_debug")};var Painter=function Painter(gl,transform){this.gl=gl;this.transform=transform;this.reusableTextures={};this.preFbos={};this.frameHistory=new FrameHistory;this.setup();this.numSublayers=SourceCache.maxUnderzooming+SourceCache.maxOverzooming+1;this.depthEpsilon=1/Math.pow(2,16);this.lineWidthRange=gl.getParameter(gl.ALIASED_LINE_WIDTH_RANGE);this.basicFillProgramConfiguration=ProgramConfiguration.createStatic(["color","opacity"]);this.emptyProgramConfiguration=new ProgramConfiguration};Painter.prototype.resize=function resize(width,height){var gl=this.gl;this.width=width*browser.devicePixelRatio;this.height=height*browser.devicePixelRatio;gl.viewport(0,0,this.width,this.height)};Painter.prototype.setup=function setup(){var gl=this.gl;gl.verbose=true;gl.enable(gl.BLEND);gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);gl.enable(gl.STENCIL_TEST);gl.enable(gl.DEPTH_TEST);gl.depthFunc(gl.LEQUAL);this._depthMask=false;gl.depthMask(false);var tileExtentArray=new PosArray;tileExtentArray.emplaceBack(0,0);tileExtentArray.emplaceBack(EXTENT,0);tileExtentArray.emplaceBack(0,EXTENT);tileExtentArray.emplaceBack(EXTENT,EXTENT);this.tileExtentBuffer=Buffer.fromStructArray(tileExtentArray,Buffer.BufferType.VERTEX);this.tileExtentVAO=new VertexArrayObject;this.tileExtentPatternVAO=new VertexArrayObject;var debugArray=new PosArray;debugArray.emplaceBack(0,0);debugArray.emplaceBack(EXTENT,0);debugArray.emplaceBack(EXTENT,EXTENT);debugArray.emplaceBack(0,EXTENT);debugArray.emplaceBack(0,0);this.debugBuffer=Buffer.fromStructArray(debugArray,Buffer.BufferType.VERTEX);this.debugVAO=new VertexArrayObject;var rasterBoundsArray=new RasterBoundsArray;rasterBoundsArray.emplaceBack(0,0,0,0);rasterBoundsArray.emplaceBack(EXTENT,0,32767,0);rasterBoundsArray.emplaceBack(0,EXTENT,0,32767);rasterBoundsArray.emplaceBack(EXTENT,EXTENT,32767,32767);this.rasterBoundsBuffer=Buffer.fromStructArray(rasterBoundsArray,Buffer.BufferType.VERTEX);this.rasterBoundsVAO=new VertexArrayObject};Painter.prototype.clearColor=function clearColor(){var gl=this.gl;gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT)};Painter.prototype.clearStencil=function clearStencil(){var gl=this.gl;gl.clearStencil(0);gl.stencilMask(255);gl.clear(gl.STENCIL_BUFFER_BIT)};Painter.prototype.clearDepth=function clearDepth(){var gl=this.gl;gl.clearDepth(1);this.depthMask(true);gl.clear(gl.DEPTH_BUFFER_BIT)};Painter.prototype._renderTileClippingMasks=function _renderTileClippingMasks(coords){var this$1=this;var gl=this.gl;gl.colorMask(false,false,false,false);this.depthMask(false);gl.disable(gl.DEPTH_TEST);gl.enable(gl.STENCIL_TEST);gl.stencilMask(248);gl.stencilOp(gl.KEEP,gl.KEEP,gl.REPLACE);var idNext=1;this._tileClippingMaskIDs={};for(var i=0,list=coords;i<list.length;i+=1){var coord=list[i];var id=this$1._tileClippingMaskIDs[coord.id]=idNext++<<3;gl.stencilFunc(gl.ALWAYS,id,248);var program=this$1.useProgram("fill",this$1.basicFillProgramConfiguration);gl.uniformMatrix4fv(program.u_matrix,false,coord.posMatrix);this$1.tileExtentVAO.bind(gl,program,this$1.tileExtentBuffer);gl.drawArrays(gl.TRIANGLE_STRIP,0,this$1.tileExtentBuffer.length)}gl.stencilMask(0);gl.colorMask(true,true,true,true);this.depthMask(true);gl.enable(gl.DEPTH_TEST)};Painter.prototype.enableTileClippingMask=function enableTileClippingMask(coord){var gl=this.gl;gl.stencilFunc(gl.EQUAL,this._tileClippingMaskIDs[coord.id],248)};Painter.prototype.prepareBuffers=function prepareBuffers(){};Painter.prototype.bindDefaultFramebuffer=function bindDefaultFramebuffer(){var gl=this.gl;gl.bindFramebuffer(gl.FRAMEBUFFER,null)};Painter.prototype.render=function render(style,options){this.style=style;this.options=options;this.lineAtlas=style.lineAtlas;this.spriteAtlas=style.spriteAtlas;this.spriteAtlas.setSprite(style.sprite);this.glyphSource=style.glyphSource;this.frameHistory.record(Date.now(),this.transform.zoom,style.getTransition().duration);this.prepareBuffers();this.clearColor();this.clearDepth();this.showOverdrawInspector(options.showOverdrawInspector);this.depthRange=(style._order.length+2)*this.numSublayers*this.depthEpsilon;this.isOpaquePass=true;this.renderPass();this.isOpaquePass=false;this.renderPass();if(this.options.showTileBoundaries){var sourceCache=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];if(sourceCache){draw.debug(this,sourceCache,sourceCache.getVisibleCoordinates())}}};Painter.prototype.renderPass=function renderPass(){var this$1=this;var layerIds=this.style._order;var sourceCache,coords;this.currentLayer=this.isOpaquePass?layerIds.length-1:0;if(this.isOpaquePass){if(!this._showOverdrawInspector){this.gl.disable(this.gl.BLEND)}}else{this.gl.enable(this.gl.BLEND)}for(var i=0;i<layerIds.length;i++){var layer=this$1.style._layers[layerIds[this$1.currentLayer]];if(layer.source!==(sourceCache&&sourceCache.id)){sourceCache=this$1.style.sourceCaches[layer.source];coords=[];if(sourceCache){if(sourceCache.prepare)sourceCache.prepare();this$1.clearStencil();coords=sourceCache.getVisibleCoordinates();if(sourceCache.getSource().isTileClipped){this$1._renderTileClippingMasks(coords)}}if(!this$1.isOpaquePass){coords.reverse()}}this$1.renderLayer(this$1,sourceCache,layer,coords);this$1.currentLayer+=this$1.isOpaquePass?-1:1}};Painter.prototype.depthMask=function depthMask(mask){if(mask!==this._depthMask){this._depthMask=mask;this.gl.depthMask(mask)}};Painter.prototype.renderLayer=function renderLayer(painter,sourceCache,layer,coords){if(layer.isHidden(this.transform.zoom))return;if(layer.type!=="background"&&!coords.length)return;this.id=layer.id;draw[layer.type](painter,sourceCache,layer,coords)};Painter.prototype.setDepthSublayer=function setDepthSublayer(n){var farDepth=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;var nearDepth=farDepth-1+this.depthRange;this.gl.depthRange(nearDepth,farDepth)};Painter.prototype.translatePosMatrix=function translatePosMatrix(matrix,tile,translate,anchor){if(!translate[0]&&!translate[1])return matrix;if(anchor==="viewport"){var sinA=Math.sin(-this.transform.angle);var cosA=Math.cos(-this.transform.angle);translate=[translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA]}var translation=[pixelsToTileUnits(tile,translate[0],this.transform.zoom),pixelsToTileUnits(tile,translate[1],this.transform.zoom),0];var translatedMatrix=new Float32Array(16);mat4.translate(translatedMatrix,matrix,translation);return translatedMatrix};Painter.prototype.saveTileTexture=function saveTileTexture(texture){var textures=this.reusableTextures[texture.size];if(!textures){this.reusableTextures[texture.size]=[texture]}else{textures.push(texture)}};Painter.prototype.saveViewportTexture=function saveViewportTexture(texture){if(!this.reusableTextures.viewport)this.reusableTextures.viewport={};this.reusableTextures.viewport.texture=texture};Painter.prototype.getTileTexture=function getTileTexture(width,height){var widthTextures=this.reusableTextures[width];if(widthTextures){var textures=widthTextures[height||width];return textures&&textures.length>0?textures.pop():null}};Painter.prototype.getViewportTexture=function getViewportTexture(width,height){if(!this.reusableTextures.viewport)return;var texture=this.reusableTextures.viewport.texture;if(texture.width===width&&texture.height===height){return texture}else{this.gl.deleteTexture(texture);this.reusableTextures.viewport.texture=null;return}};Painter.prototype.lineWidth=function lineWidth(width){this.gl.lineWidth(util.clamp(width,this.lineWidthRange[0],this.lineWidthRange[1]))};Painter.prototype.showOverdrawInspector=function showOverdrawInspector(enabled){if(!enabled&&!this._showOverdrawInspector)return;this._showOverdrawInspector=enabled;var gl=this.gl;if(enabled){gl.blendFunc(gl.CONSTANT_COLOR,gl.ONE);var numOverdrawSteps=8;var a=1/numOverdrawSteps;gl.blendColor(a,a,a,0);gl.clearColor(0,0,0,1);gl.clear(gl.COLOR_BUFFER_BIT)}else{gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA)}};Painter.prototype.createProgram=function createProgram(name,configuration){var gl=this.gl;var program=gl.createProgram();var definition=shaders[name];var definesSource="#define MAPBOX_GL_JS\n#define DEVICE_PIXEL_RATIO "+browser.devicePixelRatio.toFixed(1)+"\n";if(this._showOverdrawInspector){definesSource+="#define OVERDRAW_INSPECTOR;\n"}var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragmentShader,configuration.applyPragmas(definesSource+shaders.prelude.fragmentSource+definition.fragmentSource,"fragment"));gl.compileShader(fragmentShader);gl.attachShader(program,fragmentShader);var vertexShader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vertexShader,configuration.applyPragmas(definesSource+shaders.prelude.vertexSource+definition.vertexSource,"vertex"));gl.compileShader(vertexShader);gl.attachShader(program,vertexShader);gl.linkProgram(program);var numAttributes=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES);var result={program:program,numAttributes:numAttributes};for(var i=0;i<numAttributes;i++){var attribute=gl.getActiveAttrib(program,i);result[attribute.name]=gl.getAttribLocation(program,attribute.name)}var numUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS);for(var i$1=0;i$1<numUniforms;i$1++){var uniform=gl.getActiveUniform(program,i$1);result[uniform.name]=gl.getUniformLocation(program,uniform.name)}return result};Painter.prototype._createProgramCached=function _createProgramCached(name,programConfiguration){this.cache=this.cache||{};var key=""+name+(programConfiguration.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");if(!this.cache[key]){this.cache[key]=this.createProgram(name,programConfiguration)}return this.cache[key]};Painter.prototype.useProgram=function useProgram(name,programConfiguration){var gl=this.gl;var nextProgram=this._createProgramCached(name,programConfiguration||this.emptyProgramConfiguration);if(this.currentProgram!==nextProgram){gl.useProgram(nextProgram.program);this.currentProgram=nextProgram}return nextProgram};module.exports=Painter},{"../data/buffer":604,"../data/extent":607,"../data/pos_array":610,"../data/program_configuration":611,"../data/raster_bounds_array":612,"../source/pixels_to_tile_units":641,"../source/source_cache":645,"../util/browser":704,"../util/util":723,"./draw_background":621,"./draw_circle":622,"./draw_debug":624,"./draw_fill":625,"./draw_fill_extrusion":626,"./draw_line":627,"./draw_raster":628,"./draw_symbol":629,"./frame_history":630,"./shaders":634,"./vertex_array_object":635,"@mapbox/gl-matrix":1}],633:[function(require,module,exports){"use strict";var pixelsToTileUnits=require("../source/pixels_to_tile_units");exports.prepare=function(image,painter,program){var gl=painter.gl;var imagePosA=painter.spriteAtlas.getPosition(image.from,true);var imagePosB=painter.spriteAtlas.getPosition(image.to,true);if(!imagePosA||!imagePosB)return;gl.uniform1i(program.u_image,0);gl.uniform2fv(program.u_pattern_tl_a,imagePosA.tl);gl.uniform2fv(program.u_pattern_br_a,imagePosA.br);gl.uniform2fv(program.u_pattern_tl_b,imagePosB.tl);gl.uniform2fv(program.u_pattern_br_b,imagePosB.br);gl.uniform1f(program.u_mix,image.t);gl.uniform2fv(program.u_pattern_size_a,imagePosA.size);gl.uniform2fv(program.u_pattern_size_b,imagePosB.size);gl.uniform1f(program.u_scale_a,image.fromScale);gl.uniform1f(program.u_scale_b,image.toScale);gl.activeTexture(gl.TEXTURE0);painter.spriteAtlas.bind(gl,true)};exports.setTile=function(tile,painter,program){var gl=painter.gl;gl.uniform1f(program.u_tile_units_to_pixels,1/pixelsToTileUnits(tile,1,painter.transform.tileZoom));var numTiles=Math.pow(2,tile.coord.z);var tileSizeAtNearestZoom=tile.tileSize*Math.pow(2,painter.transform.tileZoom)/numTiles;var pixelX=tileSizeAtNearestZoom*(tile.coord.x+tile.coord.w*numTiles);var pixelY=tileSizeAtNearestZoom*tile.coord.y;gl.uniform2f(program.u_pixel_coord_upper,pixelX>>16,pixelY>>16);gl.uniform2f(program.u_pixel_coord_lower,pixelX&65535,pixelY&65535)}},{"../source/pixels_to_tile_units":641}],634:[function(require,module,exports){"use strict";var path=require("path");module.exports={prelude:{fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n",vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nfloat evaluate_zoom_function_1(const vec4 values, const float t) {\n    if (t < 1.0) {\n        return mix(values[0], values[1], t);\n    } else if (t < 2.0) {\n        return mix(values[1], values[2], t - 1.0);\n    } else {\n        return mix(values[2], values[3], t - 2.0);\n    }\n}\nvec4 evaluate_zoom_function_4(const vec4 value0, const vec4 value1, const vec4 value2, const vec4 value3, const float t) {\n    if (t < 1.0) {\n        return mix(value0, value1, t);\n    } else if (t < 2.0) {\n        return mix(value1, value2, t - 1.0);\n    } else {\n        return mix(value2, value3, t - 2.0);\n    }\n}\n\n// The offset depends on how many pixels are between the world origin and the edge of the tile:\n// vec2 offset = mod(pixel_coord, size)\n//\n// At high zoom levels there are a ton of pixels between the world origin and the edge of the tile.\n// The glsl spec only guarantees 16 bits of precision for highp floats. We need more than that.\n//\n// The pixel_coord is passed in as two 16 bit values:\n// pixel_coord_upper = floor(pixel_coord / 2^16)\n// pixel_coord_lower = mod(pixel_coord, 2^16)\n//\n// The offset is calculated in a series of steps that should preserve this precision:\nvec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,\n    const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {\n\n    vec2 offset = mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);\n    return (tile_units_to_pixels * pos + offset) / pattern_size;\n}\n"},circle:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec2 v_extrude;\nvarying lowp float v_antialiasblur;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    float extrude_length = length(v_extrude);\n    float antialiased_blur = -max(blur, v_antialiasblur);\n\n    float opacity_t = smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    float color_t = stroke_width < 0.01 ? 0.0 : smoothstep(\n        antialiased_blur,\n        0.0,\n        extrude_length - radius / (radius + stroke_width)\n    );\n\n    gl_FragColor = opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform bool u_scale_with_map;\nuniform vec2 u_extrude_scale;\n\nattribute vec2 a_pos;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec2 v_extrude;\nvarying lowp float v_antialiasblur;\n\nvoid main(void) {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    v_extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    vec2 extrude = v_extrude * (radius + stroke_width) * u_extrude_scale;\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    gl_Position = u_matrix * vec4(floor(a_pos * 0.5), 0, 1);\n\n    if (u_scale_with_map) {\n        gl_Position.xy += extrude;\n    } else {\n        gl_Position.xy += extrude * gl_Position.w;\n    }\n\n    // This is a minimum blur distance that serves as a faux-antialiasing for\n    // the circle. since blur is a ratio of the circle's size and the intent is\n    // to keep the blur at roughly 1px, the two are inversely related.\n    v_antialiasblur = 1.0 / DEVICE_PIXEL_RATIO / (radius + stroke_width);\n}\n"},collisionBox:{fragmentSource:"uniform float u_zoom;\nuniform float u_maxzoom;\n\nvarying float v_max_zoom;\nvarying float v_placement_zoom;\n\nvoid main() {\n\n    float alpha = 0.5;\n\n    gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0) * alpha;\n\n    if (v_placement_zoom > u_zoom) {\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\n    }\n\n    if (u_zoom >= v_max_zoom) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0) * alpha * 0.25;\n    }\n\n    if (v_placement_zoom >= u_maxzoom) {\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0) * alpha * 0.2;\n    }\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_extrude;\nattribute vec2 a_data;\n\nuniform mat4 u_matrix;\nuniform float u_scale;\n\nvarying float v_max_zoom;\nvarying float v_placement_zoom;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos + a_extrude / u_scale, 0.0, 1.0);\n\n    v_max_zoom = a_data.x;\n    v_placement_zoom = a_data.y;\n}\n"},debug:{fragmentSource:"uniform lowp vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, step(32767.0, a_pos.x), 1);\n}\n"},fill:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_FragColor = color * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fillOutline:{fragmentSource:"#pragma mapbox: define lowp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_pos;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = smoothstep(1.0, 0.0, dist);\n    gl_FragColor = outline_color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\nuniform vec2 u_world;\n\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillOutlinePattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    // find distance to outline for alpha interpolation\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = smoothstep(1.0, 0.0, dist);\n\n\n    gl_FragColor = mix(color1, color2, u_mix) * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"
},fillExtrusion:{fragmentSource:"varying vec4 v_color;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize lowp vec4 color\n\n    gl_FragColor = v_color;\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\nuniform lowp vec4 u_outline_color;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec4 v_color;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\n#pragma mapbox: define lowp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize lowp vec4 color\n\n    float ed = a_edgedistance; // use each attrib in order to not trip a VAO assert\n    float t = mod(a_normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? height : base, 1);\n\n#ifdef OUTLINE\n    color = u_outline_color;\n#endif\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(a_normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n}\n"},fillExtrusionPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    vec4 mixedColor = mix(color1, color2, u_mix);\n\n    gl_FragColor = mixedColor * v_lighting;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\nuniform float u_height_factor;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\nvarying float v_directional;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    float t = mod(a_normal.x, 2.0);\n    float z = t > 0.0 ? height : base;\n\n    gl_Position = u_matrix * vec4(a_pos, z, 1);\n\n    vec2 pos = a_normal.x == 1.0 && a_normal.y == 0.0 && a_normal.z == 16384.0\n        ? a_pos // extrusion top\n        : vec2(a_edgedistance, z * u_height_factor); // extrusion side\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, pos);\n\n    v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n    float directional = clamp(dot(a_normal / 16383.0, u_lightpos), 0.0, 1.0);\n    directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}\n"},extrusionTexture:{fragmentSource:"uniform sampler2D u_texture;\nuniform float u_opacity;\n\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_FragColor = texture2D(u_texture, v_pos) * u_opacity;\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform int u_xdim;\nuniform int u_ydim;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos.x = a_pos.x / float(u_xdim);\n    v_pos.y = 1.0 - a_pos.y / float(u_ydim);\n}\n"},line:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},linePattern:{fragmentSource:"uniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_fade;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float x_a = mod(v_linesofar / u_pattern_size_a.x, 1.0);\n    float x_b = mod(v_linesofar / u_pattern_size_b.x, 1.0);\n    float y_a = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_a.y);\n    float y_b = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_b.y);\n    vec2 pos_a = mix(u_pattern_tl_a, u_pattern_br_a, vec2(x_a, y_a));\n    vec2 pos_b = mix(u_pattern_tl_b, u_pattern_br_b, vec2(x_b, y_b));\n\n    vec4 color = mix(texture2D(u_image, pos_a), texture2D(u_image, pos_b), u_fade);\n\n    gl_FragColor = color * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float gapwidth\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_linesofar = a_linesofar;\n    v_width2 = vec2(outset, inset);\n}\n"},lineSDF:{fragmentSource:"\nuniform sampler2D u_image;\nuniform float u_sdfgamma;\nuniform float u_mix;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float sdfdist_a = texture2D(u_image, v_tex_a).a;\n    float sdfdist_b = texture2D(u_image, v_tex_b).a;\n    float sdfdist = mix(sdfdist_a, sdfdist_b, u_mix);\n    alpha *= smoothstep(0.5 - u_sdfgamma, 0.5 + u_sdfgamma, sdfdist);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_patternscale_a;\nuniform float u_tex_y_a;\nuniform vec2 u_patternscale_b;\nuniform float u_tex_y_b;\nuniform vec2 u_gl_units_to_pixels;\nuniform mediump float u_width;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset;\n \n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist =outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_tex_a = vec2(a_linesofar * u_patternscale_a.x, normal.y * u_patternscale_a.y + u_tex_y_a);\n    v_tex_b = vec2(a_linesofar * u_patternscale_b.x, normal.y * u_patternscale_b.y + u_tex_y_b);\n\n    v_width2 = vec2(outset, inset);\n}\n"},raster:{fragmentSource:"uniform float u_fade_t;\nuniform float u_opacity;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nuniform float u_brightness_low;\nuniform float u_brightness_high;\n\nuniform float u_saturation_factor;\nuniform float u_contrast_factor;\nuniform vec3 u_spin_weights;\n\nvoid main() {\n\n    // read and cross-fade colors from the main and parent tiles\n    vec4 color0 = texture2D(u_image0, v_pos0);\n    vec4 color1 = texture2D(u_image1, v_pos1);\n    vec4 color = mix(color0, color1, u_fade_t);\n    color.a *= u_opacity;\n    vec3 rgb = color.rgb;\n\n    // spin\n    rgb = vec3(\n        dot(rgb, u_spin_weights.xyz),\n        dot(rgb, u_spin_weights.zxy),\n        dot(rgb, u_spin_weights.yzx));\n\n    // saturation\n    float average = (color.r + color.g + color.b) / 3.0;\n    rgb += (average - rgb) * u_saturation_factor;\n\n    // contrast\n    rgb = (rgb - 0.5) * u_contrast_factor + 0.5;\n\n    // brightness\n    vec3 u_high_vec = vec3(u_brightness_low, u_brightness_low, u_brightness_low);\n    vec3 u_low_vec = vec3(u_brightness_high, u_brightness_high, u_brightness_high);\n\n    gl_FragColor = vec4(mix(u_high_vec, u_low_vec, rgb) * color.a, color.a);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_tl_parent;\nuniform float u_scale_parent;\nuniform float u_buffer_scale;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos0 = (((a_texture_pos / 32767.0) - 0.5) / u_buffer_scale ) + 0.5;\n    v_pos1 = (v_pos0 * u_scale_parent) + u_tl_parent;\n}\n"},symbolIcon:{fragmentSource:"uniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\nuniform lowp float u_opacity;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    lowp float alpha = texture2D(u_fadetexture, v_fade_tex).a * u_opacity;\n    gl_FragColor = texture2D(u_texture, v_tex) * alpha;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\n\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n    if (u_rotate_with_map) {\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    } else {\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"},symbolSDF:{fragmentSource:"uniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\nuniform lowp vec4 u_color;\nuniform lowp float u_opacity;\nuniform lowp float u_buffer;\nuniform lowp float u_gamma;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\n\nvoid main() {\n    lowp float dist = texture2D(u_texture, v_tex).a;\n    lowp float fade_alpha = texture2D(u_fadetexture, v_fade_tex).a;\n    lowp float gamma = u_gamma * v_gamma_scale;\n    lowp float alpha = smoothstep(u_buffer - gamma, u_buffer + gamma, dist) * fade_alpha;\n\n    gl_FragColor = u_color * (alpha * u_opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\n\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform bool u_pitch_with_map;\nuniform mediump float u_pitch;\nuniform mediump float u_bearing;\nuniform mediump float u_aspect_ratio;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\n\nvoid main() {\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    // pitch-alignment: map\n    // rotation-alignment: map | viewport\n    if (u_pitch_with_map) {\n        lowp float angle = u_rotate_with_map ? (a_data[1] / 256.0 * 2.0 * PI) : u_bearing;\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, asin, -1.0 * asin, acos);\n        vec2 offset = RotationMatrix * a_offset;\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: map\n    } else if (u_rotate_with_map) {\n        // foreshortening factor to apply on pitched maps\n        // as a label goes from horizontal <=> vertical in angle\n        // it goes from 0% foreshortening to up to around 70% foreshortening\n        lowp float pitchfactor = 1.0 - cos(u_pitch * sin(u_pitch * 0.75));\n\n        lowp float lineangle = a_data[1] / 256.0 * 2.0 * PI;\n\n        // use the lineangle to position points a,b along the line\n        // project the points and calculate the label angle in projected space\n        // this calculation allows labels to be rendered unskewed on pitched maps\n        vec4 a = u_matrix * vec4(a_pos, 0, 1);\n        vec4 b = u_matrix * vec4(a_pos + vec2(cos(lineangle),sin(lineangle)), 0, 1);\n        lowp float angle = atan((b[1]/b[3] - a[1]/a[3])/u_aspect_ratio, b[0]/b[3] - a[0]/a[3]);\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, -1.0 * asin, asin, acos);\n\n        vec2 offset = RotationMatrix * (vec2((1.0-pitchfactor)+(pitchfactor*cos(angle*2.0)), 1.0) * a_offset);\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: viewport\n    } else {\n        vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_gamma_scale = gl_Position.w;\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"}}},{path:745}],635:[function(require,module,exports){"use strict";var VertexArrayObject=function VertexArrayObject(){this.boundProgram=null;this.boundVertexBuffer=null;this.boundVertexBuffer2=null;this.boundElementBuffer=null;this.boundVertexOffset=null;this.vao=null};VertexArrayObject.prototype.bind=function bind(gl,program,layoutVertexBuffer,elementBuffer,vertexBuffer2,vertexOffset){if(gl.extVertexArrayObject===undefined){gl.extVertexArrayObject=gl.getExtension("OES_vertex_array_object")}var isFreshBindRequired=!this.vao||this.boundProgram!==program||this.boundVertexBuffer!==layoutVertexBuffer||this.boundVertexBuffer2!==vertexBuffer2||this.boundElementBuffer!==elementBuffer||this.boundVertexOffset!==vertexOffset;if(!gl.extVertexArrayObject||isFreshBindRequired){this.freshBind(gl,program,layoutVertexBuffer,elementBuffer,vertexBuffer2,vertexOffset);this.gl=gl}else{gl.extVertexArrayObject.bindVertexArrayOES(this.vao)}};VertexArrayObject.prototype.freshBind=function freshBind(gl,program,layoutVertexBuffer,elementBuffer,vertexBuffer2,vertexOffset){var numPrevAttributes;var numNextAttributes=program.numAttributes;if(gl.extVertexArrayObject){if(this.vao)this.destroy();this.vao=gl.extVertexArrayObject.createVertexArrayOES();gl.extVertexArrayObject.bindVertexArrayOES(this.vao);numPrevAttributes=0;this.boundProgram=program;this.boundVertexBuffer=layoutVertexBuffer;this.boundVertexBuffer2=vertexBuffer2;this.boundElementBuffer=elementBuffer;this.boundVertexOffset=vertexOffset}else{numPrevAttributes=gl.currentNumAttributes||0;for(var i=numNextAttributes;i<numPrevAttributes;i++){gl.disableVertexAttribArray(i)}}for(var j=numPrevAttributes;j<numNextAttributes;j++){gl.enableVertexAttribArray(j)}layoutVertexBuffer.bind(gl);layoutVertexBuffer.setVertexAttribPointers(gl,program,vertexOffset);if(vertexBuffer2){vertexBuffer2.bind(gl);vertexBuffer2.setVertexAttribPointers(gl,program,vertexOffset)}if(elementBuffer){elementBuffer.bind(gl)}gl.currentNumAttributes=numNextAttributes};VertexArrayObject.prototype.destroy=function destroy(){if(this.vao){this.gl.extVertexArrayObject.deleteVertexArrayOES(this.vao);this.vao=null}};module.exports=VertexArrayObject},{}],636:[function(require,module,exports){"use strict";var Evented=require("../util/evented");var util=require("../util/util");var window=require("../util/window");var EXTENT=require("../data/extent");var GeoJSONSource=function(Evented){function GeoJSONSource(id,options,dispatcher,eventedParent){Evented.call(this);options=options||{};this.id=id;this.type="geojson";this.minzoom=0;this.maxzoom=18;this.tileSize=512;this.isTileClipped=true;this.reparseOverscaled=true;this.dispatcher=dispatcher;this.setEventedParent(eventedParent);this._data=options.data;if(options.maxzoom!==undefined)this.maxzoom=options.maxzoom;if(options.type)this.type=options.type;var scale=EXTENT/this.tileSize;this.workerOptions=util.extend({source:this.id,cluster:options.cluster||false,geojsonVtOptions:{buffer:(options.buffer!==undefined?options.buffer:128)*scale,tolerance:(options.tolerance!==undefined?options.tolerance:.375)*scale,extent:EXTENT,maxZoom:this.maxzoom},superclusterOptions:{maxZoom:Math.min(options.clusterMaxZoom,this.maxzoom-1)||this.maxzoom-1,extent:EXTENT,radius:(options.clusterRadius||50)*scale,log:false}},options.workerOptions)}if(Evented)GeoJSONSource.__proto__=Evented;GeoJSONSource.prototype=Object.create(Evented&&Evented.prototype);GeoJSONSource.prototype.constructor=GeoJSONSource;GeoJSONSource.prototype.load=function load(){
var this$1=this;this.fire("dataloading",{dataType:"source"});this._updateWorkerData(function(err){if(err){this$1.fire("error",{error:err});return}this$1.fire("data",{dataType:"source"});this$1.fire("source.load")})};GeoJSONSource.prototype.onAdd=function onAdd(map){this.load();this.map=map};GeoJSONSource.prototype.setData=function setData(data){var this$1=this;this._data=data;this.fire("dataloading",{dataType:"source"});this._updateWorkerData(function(err){if(err){return this$1.fire("error",{error:err})}this$1.fire("data",{dataType:"source"})});return this};GeoJSONSource.prototype._updateWorkerData=function _updateWorkerData(callback){var this$1=this;var options=util.extend({},this.workerOptions);var data=this._data;if(typeof data==="string"){options.url=resolveURL(data)}else{options.data=JSON.stringify(data)}this.workerID=this.dispatcher.send(this.type+".loadData",options,function(err){this$1._loaded=true;callback(err)})};GeoJSONSource.prototype.loadTile=function loadTile(tile,callback){var this$1=this;var overscaling=tile.coord.z>this.maxzoom?Math.pow(2,tile.coord.z-this.maxzoom):1;var params={type:this.type,uid:tile.uid,coord:tile.coord,zoom:tile.coord.z,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,overscaling:overscaling,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};tile.workerID=this.dispatcher.send("loadTile",params,function(err,data){tile.unloadVectorData();if(tile.aborted)return;if(err){return callback(err)}tile.loadVectorData(data,this$1.map.painter);if(tile.redoWhenDone){tile.redoWhenDone=false;tile.redoPlacement(this$1)}return callback(null)},this.workerID)};GeoJSONSource.prototype.abortTile=function abortTile(tile){tile.aborted=true};GeoJSONSource.prototype.unloadTile=function unloadTile(tile){tile.unloadVectorData();this.dispatcher.send("removeTile",{uid:tile.uid,type:this.type,source:this.id},function(){},tile.workerID)};GeoJSONSource.prototype.onRemove=function onRemove(){this.dispatcher.broadcast("removeSource",{type:this.type,source:this.id},function(){})};GeoJSONSource.prototype.serialize=function serialize(){return{type:this.type,data:this._data}};return GeoJSONSource}(Evented);function resolveURL(url){var a=window.document.createElement("a");a.href=url;return a.href}module.exports=GeoJSONSource},{"../data/extent":607,"../util/evented":712,"../util/util":723,"../util/window":706}],637:[function(require,module,exports){"use strict";var ajax=require("../util/ajax");var rewind=require("geojson-rewind");var GeoJSONWrapper=require("./geojson_wrapper");var vtpbf=require("vt-pbf");var supercluster=require("supercluster");var geojsonvt=require("geojson-vt");var VectorTileWorkerSource=require("./vector_tile_worker_source");var GeoJSONWorkerSource=function(VectorTileWorkerSource){function GeoJSONWorkerSource(actor,layerIndex,loadGeoJSON){VectorTileWorkerSource.call(this,actor,layerIndex);if(loadGeoJSON){this.loadGeoJSON=loadGeoJSON}this._geoJSONIndexes={}}if(VectorTileWorkerSource)GeoJSONWorkerSource.__proto__=VectorTileWorkerSource;GeoJSONWorkerSource.prototype=Object.create(VectorTileWorkerSource&&VectorTileWorkerSource.prototype);GeoJSONWorkerSource.prototype.constructor=GeoJSONWorkerSource;GeoJSONWorkerSource.prototype.loadVectorData=function loadVectorData(params,callback){var source=params.source,coord=params.coord;if(!this._geoJSONIndexes[source]){return callback(null,null)}var geoJSONTile=this._geoJSONIndexes[source].getTile(Math.min(coord.z,params.maxZoom),coord.x,coord.y);if(!geoJSONTile){return callback(null,null)}var geojsonWrapper=new GeoJSONWrapper(geoJSONTile.features);geojsonWrapper.name="_geojsonTileLayer";var pbf=vtpbf({layers:{_geojsonTileLayer:geojsonWrapper}});if(pbf.byteOffset!==0||pbf.byteLength!==pbf.buffer.byteLength){pbf=new Uint8Array(pbf)}geojsonWrapper.rawData=pbf.buffer;callback(null,geojsonWrapper)};GeoJSONWorkerSource.prototype.loadData=function loadData(params,callback){var handleData=function(err,data){var this$1=this;if(err)return callback(err);if(typeof data!="object"){return callback(new Error("Input data is not a valid GeoJSON object."))}rewind(data,true);this._indexData(data,params,function(err,indexed){if(err){return callback(err)}this$1._geoJSONIndexes[params.source]=indexed;callback(null)})}.bind(this);this.loadGeoJSON(params,handleData)};GeoJSONWorkerSource.prototype.loadGeoJSON=function loadGeoJSON(params,callback){if(params.url){ajax.getJSON(params.url,callback)}else if(typeof params.data==="string"){try{return callback(null,JSON.parse(params.data))}catch(e){return callback(new Error("Input data is not a valid GeoJSON object."))}}else{return callback(new Error("Input data is not a valid GeoJSON object."))}};GeoJSONWorkerSource.prototype.removeSource=function removeSource(params){if(this._geoJSONIndexes[params.source]){delete this._geoJSONIndexes[params.source]}};GeoJSONWorkerSource.prototype._indexData=function _indexData(data,params,callback){try{if(params.cluster){callback(null,supercluster(params.superclusterOptions).load(data.features))}else{callback(null,geojsonvt(data,params.geojsonVtOptions))}}catch(err){return callback(err)}};return GeoJSONWorkerSource}(VectorTileWorkerSource);module.exports=GeoJSONWorkerSource},{"../util/ajax":703,"./geojson_wrapper":638,"./vector_tile_worker_source":649,"geojson-rewind":418,"geojson-vt":422,supercluster:983,"vt-pbf":1003}],638:[function(require,module,exports){"use strict";var Point=require("point-geometry");var VectorTileFeature=require("vector-tile").VectorTileFeature;var EXTENT=require("../data/extent");var FeatureWrapper=function FeatureWrapper(feature){var this$1=this;this.type=feature.type;if(feature.type===1){this.rawGeometry=[];for(var i=0;i<feature.geometry.length;i++){this$1.rawGeometry.push([feature.geometry[i]])}}else{this.rawGeometry=feature.geometry}this.properties=feature.tags;this.extent=EXTENT};FeatureWrapper.prototype.loadGeometry=function loadGeometry(){var this$1=this;var rings=this.rawGeometry;this.geometry=[];for(var i=0;i<rings.length;i++){var ring=rings[i],newRing=[];for(var j=0;j<ring.length;j++){newRing.push(new Point(ring[j][0],ring[j][1]))}this$1.geometry.push(newRing)}return this.geometry};FeatureWrapper.prototype.bbox=function bbox(){if(!this.geometry)this.loadGeometry();var rings=this.geometry;var x1=Infinity,x2=-Infinity,y1=Infinity,y2=-Infinity;for(var i=0;i<rings.length;i++){var ring=rings[i];for(var j=0;j<ring.length;j++){var coord=ring[j];x1=Math.min(x1,coord.x);x2=Math.max(x2,coord.x);y1=Math.min(y1,coord.y);y2=Math.max(y2,coord.y)}}return[x1,y1,x2,y2]};FeatureWrapper.prototype.toGeoJSON=function toGeoJSON(){VectorTileFeature.prototype.toGeoJSON.call(this)};var GeoJSONWrapper=function GeoJSONWrapper(features){this.features=features;this.length=features.length;this.extent=EXTENT};GeoJSONWrapper.prototype.feature=function feature(i){return new FeatureWrapper(this.features[i])};module.exports=GeoJSONWrapper},{"../data/extent":607,"point-geometry":769,"vector-tile":997}],639:[function(require,module,exports){"use strict";var util=require("../util/util");var window=require("../util/window");var TileCoord=require("./tile_coord");var LngLat=require("../geo/lng_lat");var Point=require("point-geometry");var Evented=require("../util/evented");var ajax=require("../util/ajax");var EXTENT=require("../data/extent");var RasterBoundsArray=require("../data/raster_bounds_array");var Buffer=require("../data/buffer");var VertexArrayObject=require("../render/vertex_array_object");var ImageSource=function(Evented){function ImageSource(id,options,dispatcher,eventedParent){Evented.call(this);this.id=id;this.dispatcher=dispatcher;this.coordinates=options.coordinates;this.minzoom=0;this.maxzoom=22;this.tileSize=512;this.setEventedParent(eventedParent);this.options=options}if(Evented)ImageSource.__proto__=Evented;ImageSource.prototype=Object.create(Evented&&Evented.prototype);ImageSource.prototype.constructor=ImageSource;ImageSource.prototype.load=function load(){var this$1=this;this.fire("dataloading",{dataType:"source"});this.url=this.options.url;ajax.getImage(this.options.url,function(err,image){if(err)return this$1.fire("error",{error:err});this$1.image=image;this$1._finishLoading()})};ImageSource.prototype._finishLoading=function _finishLoading(){this.fire("source.load");if(this.map){this.setCoordinates(this.coordinates)}};ImageSource.prototype.onAdd=function onAdd(map){this.load();this.map=map;if(this.image){this.setCoordinates(this.coordinates)}};ImageSource.prototype.setCoordinates=function setCoordinates(coordinates){this.coordinates=coordinates;var map=this.map;var cornerZ0Coords=coordinates.map(function(coord){return map.transform.locationCoordinate(LngLat.convert(coord)).zoomTo(0)});var centerCoord=this.centerCoord=util.getCoordinatesCenter(cornerZ0Coords);centerCoord.column=Math.round(centerCoord.column);centerCoord.row=Math.round(centerCoord.row);this.minzoom=this.maxzoom=centerCoord.zoom;this.coord=new TileCoord(centerCoord.zoom,centerCoord.column,centerCoord.row);this._tileCoords=cornerZ0Coords.map(function(coord){var zoomedCoord=coord.zoomTo(centerCoord.zoom);return new Point(Math.round((zoomedCoord.column-centerCoord.column)*EXTENT),Math.round((zoomedCoord.row-centerCoord.row)*EXTENT))});this.fire("data",{dataType:"source"});return this};ImageSource.prototype._setTile=function _setTile(tile){this.tile=tile;var maxInt16=32767;var array=new RasterBoundsArray;array.emplaceBack(this._tileCoords[0].x,this._tileCoords[0].y,0,0);array.emplaceBack(this._tileCoords[1].x,this._tileCoords[1].y,maxInt16,0);array.emplaceBack(this._tileCoords[3].x,this._tileCoords[3].y,0,maxInt16);array.emplaceBack(this._tileCoords[2].x,this._tileCoords[2].y,maxInt16,maxInt16);this.tile.buckets={};this.tile.boundsBuffer=Buffer.fromStructArray(array,Buffer.BufferType.VERTEX);this.tile.boundsVAO=new VertexArrayObject};ImageSource.prototype.prepare=function prepare(){if(!this.tile||!this.image)return;this._prepareImage(this.map.painter.gl,this.image)};ImageSource.prototype._prepareImage=function _prepareImage(gl,image){if(this.tile.state!=="loaded"){this.tile.state="loaded";this.tile.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.tile.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,image)}else if(image instanceof window.HTMLVideoElement){gl.bindTexture(gl.TEXTURE_2D,this.tile.texture);gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,gl.RGBA,gl.UNSIGNED_BYTE,image)}};ImageSource.prototype.loadTile=function loadTile(tile,callback){if(this.coord&&this.coord.toString()===tile.coord.toString()){this._setTile(tile);callback(null)}else{tile.state="errored";callback(null)}};ImageSource.prototype.serialize=function serialize(){return{type:"image",urls:this.url,coordinates:this.coordinates}};return ImageSource}(Evented);module.exports=ImageSource},{"../data/buffer":604,"../data/extent":607,"../data/raster_bounds_array":612,"../geo/lng_lat":615,"../render/vertex_array_object":635,"../util/ajax":703,"../util/evented":712,"../util/util":723,"../util/window":706,"./tile_coord":647,"point-geometry":769}],640:[function(require,module,exports){"use strict";var util=require("../util/util");var ajax=require("../util/ajax");var browser=require("../util/browser");var normalizeURL=require("../util/mapbox").normalizeSourceURL;module.exports=function(options,callback){var loaded=function(err,tileJSON){if(err){return callback(err)}var result=util.pick(tileJSON,["tiles","minzoom","maxzoom","attribution"]);if(tileJSON.vector_layers){result.vectorLayers=tileJSON.vector_layers;result.vectorLayerIds=result.vectorLayers.map(function(layer){return layer.id})}callback(null,result)};if(options.url){ajax.getJSON(normalizeURL(options.url),loaded)}else{browser.frame(loaded.bind(null,null,options))}}},{"../util/ajax":703,"../util/browser":704,"../util/mapbox":719,"../util/util":723}],641:[function(require,module,exports){"use strict";var EXTENT=require("../data/extent");module.exports=function(tile,pixelValue,z){return pixelValue*(EXTENT/(tile.tileSize*Math.pow(2,z-tile.coord.z)))}},{"../data/extent":607}],642:[function(require,module,exports){"use strict";var TileCoord=require("./tile_coord");exports.rendered=function(sourceCache,styleLayers,queryGeometry,params,zoom,bearing){var tilesIn=sourceCache.tilesIn(queryGeometry);tilesIn.sort(sortTilesIn);var renderedFeatureLayers=[];for(var r=0;r<tilesIn.length;r++){var tileIn=tilesIn[r];if(!tileIn.tile.featureIndex)continue;renderedFeatureLayers.push(tileIn.tile.featureIndex.query({queryGeometry:tileIn.queryGeometry,scale:tileIn.scale,tileSize:tileIn.tile.tileSize,bearing:bearing,params:params},styleLayers))}return mergeRenderedFeatureLayers(renderedFeatureLayers)};exports.source=function(sourceCache,params){var tiles=sourceCache.getRenderableIds().map(function(id){return sourceCache.getTileByID(id)});var result=[];var dataTiles={};for(var i=0;i<tiles.length;i++){var tile=tiles[i];var dataID=new TileCoord(Math.min(tile.sourceMaxZoom,tile.coord.z),tile.coord.x,tile.coord.y,0).id;if(!dataTiles[dataID]){dataTiles[dataID]=true;tile.querySourceFeatures(result,params)}}return result};function sortTilesIn(a,b){var coordA=a.coord;var coordB=b.coord;return coordA.z-coordB.z||coordA.y-coordB.y||coordA.w-coordB.w||coordA.x-coordB.x}function mergeRenderedFeatureLayers(tiles){var result=tiles[0]||{};for(var i=1;i<tiles.length;i++){var tile=tiles[i];for(var layerID in tile){var tileFeatures=tile[layerID];var resultFeatures=result[layerID];if(resultFeatures===undefined){resultFeatures=result[layerID]=tileFeatures}else{for(var f=0;f<tileFeatures.length;f++){resultFeatures.push(tileFeatures[f])}}}}return result}},{"./tile_coord":647}],643:[function(require,module,exports){"use strict";var util=require("../util/util");var ajax=require("../util/ajax");var Evented=require("../util/evented");var loadTileJSON=require("./load_tilejson");var normalizeURL=require("../util/mapbox").normalizeTileURL;var RasterTileSource=function(Evented){function RasterTileSource(id,options,dispatcher,eventedParent){Evented.call(this);this.id=id;this.dispatcher=dispatcher;this.setEventedParent(eventedParent);this.minzoom=0;this.maxzoom=22;this.roundZoom=true;this.scheme="xyz";this.tileSize=512;this._loaded=false;this.options=options;util.extend(this,util.pick(options,["url","scheme","tileSize"]))}if(Evented)RasterTileSource.__proto__=Evented;RasterTileSource.prototype=Object.create(Evented&&Evented.prototype);RasterTileSource.prototype.constructor=RasterTileSource;RasterTileSource.prototype.load=function load(){var this$1=this;this.fire("dataloading",{dataType:"source"});loadTileJSON(this.options,function(err,tileJSON){if(err){return this$1.fire("error",err)}util.extend(this$1,tileJSON);this$1.fire("data",{dataType:"source"});this$1.fire("source.load")})};RasterTileSource.prototype.onAdd=function onAdd(map){this.load();this.map=map};RasterTileSource.prototype.serialize=function serialize(){return{type:"raster",url:this.url,tileSize:this.tileSize,tiles:this.tiles}};RasterTileSource.prototype.loadTile=function loadTile(tile,callback){var url=normalizeURL(tile.coord.url(this.tiles,null,this.scheme),this.url,this.tileSize);tile.request=ajax.getImage(url,done.bind(this));function done(err,img){delete tile.request;if(tile.aborted){this.state="unloaded";return callback(null)}if(err){this.state="errored";return callback(err)}var gl=this.map.painter.gl;tile.texture=this.map.painter.getTileTexture(img.width);if(tile.texture){gl.bindTexture(gl.TEXTURE_2D,tile.texture);gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,gl.RGBA,gl.UNSIGNED_BYTE,img)}else{tile.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,tile.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,img);tile.texture.size=img.width}gl.generateMipmap(gl.TEXTURE_2D);tile.state="loaded";callback(null)}};RasterTileSource.prototype.abortTile=function abortTile(tile){if(tile.request){tile.request.abort();delete tile.request}};RasterTileSource.prototype.unloadTile=function unloadTile(tile){if(tile.texture)this.map.painter.saveTileTexture(tile.texture)};return RasterTileSource}(Evented);module.exports=RasterTileSource},{"../util/ajax":703,"../util/evented":712,"../util/mapbox":719,"../util/util":723,"./load_tilejson":640}],644:[function(require,module,exports){"use strict";var util=require("../util/util");var sourceTypes={vector:require("../source/vector_tile_source"),raster:require("../source/raster_tile_source"),geojson:require("../source/geojson_source"),video:require("../source/video_source"),image:require("../source/image_source")};exports.create=function(id,source,dispatcher,eventedParent){source=new sourceTypes[source.type](id,source,dispatcher,eventedParent);if(source.id!==id){throw new Error("Expected Source id to be "+id+" instead of "+source.id)}util.bindAll(["load","abort","unload","serialize","prepare"],source);return source};exports.getType=function(name){return sourceTypes[name]};exports.setType=function(name,type){sourceTypes[name]=type}},{"../source/geojson_source":636,"../source/image_source":639,"../source/raster_tile_source":643,"../source/vector_tile_source":648,"../source/video_source":650,"../util/util":723}],645:[function(require,module,exports){"use strict";var Source=require("./source");var Tile=require("./tile");var Evented=require("../util/evented");var TileCoord=require("./tile_coord");var Cache=require("../util/lru_cache");var Coordinate=require("../geo/coordinate");var util=require("../util/util");var EXTENT=require("../data/extent");var SourceCache=function(Evented){function SourceCache(id,options,dispatcher){Evented.call(this);this.id=id;this.dispatcher=dispatcher;this.on("source.load",function(){this._sourceLoaded=true});this.on("error",function(){this._sourceErrored=true});this.on("data",function(event){if(this._sourceLoaded&&event.dataType==="source"){this.reload();if(this.transform){this.update(this.transform)}}});this._source=Source.create(id,options,dispatcher,this);this._tiles={};this._cache=new Cache(0,this.unloadTile.bind(this));this._isIdRenderable=this._isIdRenderable.bind(this)}if(Evented)SourceCache.__proto__=Evented;SourceCache.prototype=Object.create(Evented&&Evented.prototype);SourceCache.prototype.constructor=SourceCache;SourceCache.prototype.onAdd=function onAdd(map){this.map=map;if(this._source&&this._source.onAdd){this._source.onAdd(map)}};SourceCache.prototype.onRemove=function onRemove(map){if(this._source&&this._source.onRemove){this._source.onRemove(map)}};SourceCache.prototype.loaded=function loaded(){var this$1=this;if(this._sourceErrored){return true}if(!this._sourceLoaded){return false}for(var t in this._tiles){var tile=this$1._tiles[t];if(tile.state!=="loaded"&&tile.state!=="errored")return false}return true};SourceCache.prototype.getSource=function getSource(){return this._source};SourceCache.prototype.loadTile=function loadTile(tile,callback){return this._source.loadTile(tile,callback)};SourceCache.prototype.unloadTile=function unloadTile(tile){if(this._source.unloadTile)return this._source.unloadTile(tile)};SourceCache.prototype.abortTile=function abortTile(tile){if(this._source.abortTile)return this._source.abortTile(tile)};SourceCache.prototype.serialize=function serialize(){return this._source.serialize()};SourceCache.prototype.prepare=function prepare(){if(this._sourceLoaded&&this._source.prepare)return this._source.prepare()};SourceCache.prototype.getIds=function getIds(){return Object.keys(this._tiles).map(Number).sort(compareKeyZoom)};SourceCache.prototype.getRenderableIds=function getRenderableIds(){return this.getIds().filter(this._isIdRenderable)};SourceCache.prototype._isIdRenderable=function _isIdRenderable(id){return this._tiles[id].hasData()&&!this._coveredTiles[id]};SourceCache.prototype.reload=function reload(){var this$1=this;this._cache.reset();for(var i in this._tiles){var tile=this$1._tiles[i];if(tile.state!=="loading"){tile.state="reloading"}this$1.loadTile(this$1._tiles[i],this$1._tileLoaded.bind(this$1,this$1._tiles[i]))}};SourceCache.prototype._tileLoaded=function _tileLoaded(tile,err){if(err){tile.state="errored";this._source.fire("error",{tile:tile,error:err});return}tile.sourceCache=this;tile.timeAdded=(new Date).getTime();this._source.fire("data",{tile:tile,coord:tile.coord,dataType:"tile"});if(this.map)this.map.painter.tileExtentVAO.vao=null};SourceCache.prototype.getTile=function getTile(coord){return this.getTileByID(coord.id)};SourceCache.prototype.getTileByID=function getTileByID(id){return this._tiles[id]};SourceCache.prototype.getZoom=function getZoom(transform){return transform.zoom+transform.scaleZoom(transform.tileSize/this._source.tileSize)};SourceCache.prototype.findLoadedChildren=function findLoadedChildren(coord,maxCoveringZoom,retain){var this$1=this;var found=false;for(var id in this._tiles){var tile=this$1._tiles[id];if(retain[id]||!tile.hasData()||tile.coord.z<=coord.z||tile.coord.z>maxCoveringZoom)continue;var z2=Math.pow(2,Math.min(tile.coord.z,this$1._source.maxzoom)-Math.min(coord.z,this$1._source.maxzoom));if(Math.floor(tile.coord.x/z2)!==coord.x||Math.floor(tile.coord.y/z2)!==coord.y)continue;retain[id]=true;found=true;while(tile&&tile.coord.z-1>coord.z){var parentId=tile.coord.parent(this$1._source.maxzoom).id;tile=this$1._tiles[parentId];if(tile&&tile.hasData()){delete retain[id];retain[parentId]=true}}}return found};SourceCache.prototype.findLoadedParent=function findLoadedParent(coord,minCoveringZoom,retain){var this$1=this;for(var z=coord.z-1;z>=minCoveringZoom;z--){coord=coord.parent(this$1._source.maxzoom);var tile=this$1._tiles[coord.id];if(tile&&tile.hasData()){retain[coord.id]=true;return tile}if(this$1._cache.has(coord.id)){retain[coord.id]=true;return this$1._cache.get(coord.id)}}};SourceCache.prototype.updateCacheSize=function updateCacheSize(transform){var widthInTiles=Math.ceil(transform.width/transform.tileSize)+1;var heightInTiles=Math.ceil(transform.height/transform.tileSize)+1;var approxTilesInView=widthInTiles*heightInTiles;var commonZoomRange=5;this._cache.setMaxSize(Math.floor(approxTilesInView*commonZoomRange))};SourceCache.prototype.update=function update(transform){var this$1=this;if(!this._sourceLoaded){return}var i;var coord;var tile;var parentTile;this.updateCacheSize(transform);var zoom=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(transform));var minCoveringZoom=Math.max(zoom-SourceCache.maxOverzooming,this._source.minzoom);var maxCoveringZoom=Math.max(zoom+SourceCache.maxUnderzooming,this._source.minzoom);var retain={};this._coveredTiles={};var visibleCoords;if(!this.used){visibleCoords=[]}else if(this._source.coord){visibleCoords=[this._source.coord]}else{visibleCoords=transform.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled})}for(i=0;i<visibleCoords.length;i++){coord=visibleCoords[i];tile=this$1.addTile(coord);retain[coord.id]=true;if(tile.hasData())continue;if(!this$1.findLoadedChildren(coord,maxCoveringZoom,retain)){parentTile=this$1.findLoadedParent(coord,minCoveringZoom,retain);if(parentTile){this$1.addTile(parentTile.coord)}}}var parentsForFading={};var ids=Object.keys(retain);for(var k=0;k<ids.length;k++){var id=ids[k];coord=TileCoord.fromID(id);tile=this$1._tiles[id];if(tile&&tile.fadeEndTime>=Date.now()){if(this$1.findLoadedChildren(coord,maxCoveringZoom,retain)){retain[id]=true}parentTile=this$1.findLoadedParent(coord,minCoveringZoom,parentsForFading);if(parentTile){this$1.addTile(parentTile.coord)}}}var fadedParent;for(fadedParent in parentsForFading){if(!retain[fadedParent]){this$1._coveredTiles[fadedParent]=true}}for(fadedParent in parentsForFading){retain[fadedParent]=true}var remove=util.keysDifference(this._tiles,retain);for(i=0;i<remove.length;i++){this$1.removeTile(+remove[i])}this.transform=transform};SourceCache.prototype.addTile=function addTile(coord){var tile=this._tiles[coord.id];if(tile)return tile;var wrapped=coord.wrapped();tile=this._tiles[wrapped.id];if(!tile){tile=this._cache.get(wrapped.id);if(tile){tile.redoPlacement(this._source)}}if(!tile){var zoom=coord.z;var overscaling=zoom>this._source.maxzoom?Math.pow(2,zoom-this._source.maxzoom):1;tile=new Tile(wrapped,this._source.tileSize*overscaling,this._source.maxzoom);this.loadTile(tile,this._tileLoaded.bind(this,tile))}tile.uses++;this._tiles[coord.id]=tile;this._source.fire("dataloading",{tile:tile,coord:tile.coord,dataType:"tile"});return tile};SourceCache.prototype.removeTile=function removeTile(id){var tile=this._tiles[id];if(!tile)return;tile.uses--;delete this._tiles[id];this._source.fire("data",{tile:tile,coord:tile.coord,dataType:"tile"});if(tile.uses>0)return;if(tile.hasData()){this._cache.add(tile.coord.wrapped().id,tile)}else{tile.aborted=true;this.abortTile(tile);this.unloadTile(tile)}};SourceCache.prototype.clearTiles=function clearTiles(){var this$1=this;for(var id in this._tiles)this$1.removeTile(id);this._cache.reset()};SourceCache.prototype.tilesIn=function tilesIn(queryGeometry){var this$1=this;var tileResults={};var ids=this.getIds();var minX=Infinity;var minY=Infinity;var maxX=-Infinity;var maxY=-Infinity;var z=queryGeometry[0].zoom;for(var k=0;k<queryGeometry.length;k++){var p=queryGeometry[k];minX=Math.min(minX,p.column);minY=Math.min(minY,p.row);maxX=Math.max(maxX,p.column);maxY=Math.max(maxY,p.row)}for(var i=0;i<ids.length;i++){var tile=this$1._tiles[ids[i]];var coord=TileCoord.fromID(ids[i]);var tileSpaceBounds=[coordinateToTilePoint(coord,tile.sourceMaxZoom,new Coordinate(minX,minY,z)),coordinateToTilePoint(coord,tile.sourceMaxZoom,new Coordinate(maxX,maxY,z))];if(tileSpaceBounds[0].x<EXTENT&&tileSpaceBounds[0].y<EXTENT&&tileSpaceBounds[1].x>=0&&tileSpaceBounds[1].y>=0){var tileSpaceQueryGeometry=[];for(var j=0;j<queryGeometry.length;j++){tileSpaceQueryGeometry.push(coordinateToTilePoint(coord,tile.sourceMaxZoom,queryGeometry[j]))}var tileResult=tileResults[tile.coord.id];if(tileResult===undefined){tileResult=tileResults[tile.coord.id]={tile:tile,coord:coord,queryGeometry:[],scale:Math.pow(2,this$1.transform.zoom-tile.coord.z)}}tileResult.queryGeometry.push(tileSpaceQueryGeometry)}}var results=[];for(var t in tileResults){results.push(tileResults[t])}return results};SourceCache.prototype.redoPlacement=function redoPlacement(){var this$1=this;var ids=this.getIds();for(var i=0;i<ids.length;i++){var tile=this$1.getTileByID(ids[i]);tile.redoPlacement(this$1._source)}};SourceCache.prototype.getVisibleCoordinates=function getVisibleCoordinates(){var this$1=this;var coords=this.getRenderableIds().map(TileCoord.fromID);for(var i=0,list=coords;i<list.length;i+=1){var coord=list[i];coord.posMatrix=this$1.transform.calculatePosMatrix(coord,this$1._source.maxzoom)}return coords};return SourceCache}(Evented);SourceCache.maxOverzooming=10;SourceCache.maxUnderzooming=3;function coordinateToTilePoint(tileCoord,sourceMaxZoom,coord){var zoomedCoord=coord.zoomTo(Math.min(tileCoord.z,sourceMaxZoom));return{x:(zoomedCoord.column-(tileCoord.x+tileCoord.w*Math.pow(2,tileCoord.z)))*EXTENT,y:(zoomedCoord.row-tileCoord.y)*EXTENT}}function compareKeyZoom(a,b){return a%32-b%32}module.exports=SourceCache},{"../data/extent":607,"../geo/coordinate":614,"../util/evented":712,"../util/lru_cache":718,"../util/util":723,"./source":644,"./tile":646,"./tile_coord":647}],646:[function(require,module,exports){"use strict";var util=require("../util/util");var Bucket=require("../data/bucket");var FeatureIndex=require("../data/feature_index");var vt=require("vector-tile");var Protobuf=require("pbf");var GeoJSONFeature=require("../util/vectortile_to_geojson");var featureFilter=require("feature-filter");var CollisionTile=require("../symbol/collision_tile");var CollisionBoxArray=require("../symbol/collision_box");var SymbolInstancesArray=require("../symbol/symbol_instances");var SymbolQuadsArray=require("../symbol/symbol_quads");var Tile=function Tile(coord,size,sourceMaxZoom){this.coord=coord;this.uid=util.uniqueId();this.uses=0;this.tileSize=size;this.sourceMaxZoom=sourceMaxZoom;this.buckets={};this.state="loading"};Tile.prototype.registerFadeDuration=function registerFadeDuration(animationLoop,duration){var fadeEndTime=duration+this.timeAdded;if(fadeEndTime<Date.now())return;if(this.fadeEndTime&&fadeEndTime<this.fadeEndTime)return;this.fadeEndTime=fadeEndTime;animationLoop.set(this.fadeEndTime-Date.now())};Tile.prototype.loadVectorData=function loadVectorData(data,painter){if(this.hasData()){this.unloadVectorData(painter)}this.state="loaded";if(!data)return;if(data.rawTileData){this.rawTileData=data.rawTileData}this.collisionBoxArray=new CollisionBoxArray(data.collisionBoxArray);this.collisionTile=new CollisionTile(data.collisionTile,this.collisionBoxArray);this.symbolInstancesArray=new SymbolInstancesArray(data.symbolInstancesArray);this.symbolQuadsArray=new SymbolQuadsArray(data.symbolQuadsArray);this.featureIndex=new FeatureIndex(data.featureIndex,this.rawTileData,this.collisionTile);this.buckets=Bucket.deserialize(data.buckets,painter.style)};Tile.prototype.reloadSymbolData=function reloadSymbolData(data,style){var this$1=this;if(this.state==="unloaded")return;this.collisionTile=new CollisionTile(data.collisionTile,this.collisionBoxArray);this.featureIndex.setCollisionTile(this.collisionTile);for(var id in this.buckets){var bucket=this$1.buckets[id];if(bucket.layers[0].type==="symbol"){bucket.destroy();delete this$1.buckets[id]}}util.extend(this.buckets,Bucket.deserialize(data.buckets,style))};Tile.prototype.unloadVectorData=function unloadVectorData(){var this$1=this;for(var id in this.buckets){this$1.buckets[id].destroy()}this.buckets={};this.collisionBoxArray=null;this.symbolQuadsArray=null;this.symbolInstancesArray=null;this.collisionTile=null;this.featureIndex=null;this.state="unloaded"};Tile.prototype.redoPlacement=function redoPlacement(source){if(source.type!=="vector"&&source.type!=="geojson"){return}if(this.state!=="loaded"||this.state==="reloading"){this.redoWhenDone=true;return}this.state="reloading";source.dispatcher.send("redoPlacement",{type:source.type,uid:this.uid,source:source.id,angle:source.map.transform.angle,pitch:source.map.transform.pitch,showCollisionBoxes:source.map.showCollisionBoxes},done.bind(this),this.workerID);function done(_,data){this.reloadSymbolData(data,source.map.style);source.fire("data",{tile:this,coord:this.coord,dataType:"tile"});if(source.map)source.map.painter.tileExtentVAO.vao=null;this.state="loaded";if(this.redoWhenDone){this.redoPlacement(source);this.redoWhenDone=false}}};Tile.prototype.getBucket=function getBucket(layer){return this.buckets[layer.id]};Tile.prototype.querySourceFeatures=function querySourceFeatures(result,params){var this$1=this;if(!this.rawTileData)return;if(!this.vtLayers){this.vtLayers=new vt.VectorTile(new Protobuf(this.rawTileData)).layers}var layer=this.vtLayers._geojsonTileLayer||this.vtLayers[params.sourceLayer];if(!layer)return;var filter=featureFilter(params&&params.filter);var coord={z:this.coord.z,x:this.coord.x,y:this.coord.y};for(var i=0;i<layer.length;i++){var feature=layer.feature(i);if(filter(feature)){var geojsonFeature=new GeoJSONFeature(feature,this$1.coord.z,this$1.coord.x,this$1.coord.y);geojsonFeature.tile=coord;result.push(geojsonFeature)}}};Tile.prototype.hasData=function hasData(){return this.state==="loaded"||this.state==="reloading"};module.exports=Tile},{"../data/bucket":598,"../data/feature_index":608,
"../symbol/collision_box":672,"../symbol/collision_tile":674,"../symbol/symbol_instances":683,"../symbol/symbol_quads":684,"../util/util":723,"../util/vectortile_to_geojson":724,"feature-filter":414,pbf:747,"vector-tile":997}],647:[function(require,module,exports){"use strict";var WhooTS=require("whoots-js");var Coordinate=require("../geo/coordinate");var TileCoord=function TileCoord(z,x,y,w){if(isNaN(w))w=0;this.z=+z;this.x=+x;this.y=+y;this.w=+w;w*=2;if(w<0)w=w*-1-1;var dim=1<<this.z;this.id=(dim*dim*w+dim*this.y+this.x)*32+this.z;this.posMatrix=null};TileCoord.prototype.toString=function toString(){return this.z+"/"+this.x+"/"+this.y};TileCoord.prototype.toCoordinate=function toCoordinate(sourceMaxZoom){var zoom=Math.min(this.z,sourceMaxZoom===undefined?this.z:sourceMaxZoom);var tileScale=Math.pow(2,zoom);var row=this.y;var column=this.x+tileScale*this.w;return new Coordinate(column,row,zoom)};TileCoord.prototype.url=function url(urls,sourceMaxZoom,scheme){var bbox=WhooTS.getTileBBox(this.x,this.y,this.z);var quadkey=getQuadkey(this.z,this.x,this.y);return urls[(this.x+this.y)%urls.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",Math.min(this.z,sourceMaxZoom||this.z)).replace("{x}",this.x).replace("{y}",scheme==="tms"?Math.pow(2,this.z)-this.y-1:this.y).replace("{quadkey}",quadkey).replace("{bbox-epsg-3857}",bbox)};TileCoord.prototype.parent=function parent(sourceMaxZoom){if(this.z===0)return null;if(this.z>sourceMaxZoom){return new TileCoord(this.z-1,this.x,this.y,this.w)}return new TileCoord(this.z-1,Math.floor(this.x/2),Math.floor(this.y/2),this.w)};TileCoord.prototype.wrapped=function wrapped(){return new TileCoord(this.z,this.x,this.y,0)};TileCoord.prototype.children=function children(sourceMaxZoom){if(this.z>=sourceMaxZoom){return[new TileCoord(this.z+1,this.x,this.y,this.w)]}var z=this.z+1;var x=this.x*2;var y=this.y*2;return[new TileCoord(z,x,y,this.w),new TileCoord(z,x+1,y,this.w),new TileCoord(z,x,y+1,this.w),new TileCoord(z,x+1,y+1,this.w)]};function edge(a,b){if(a.row>b.row){var t=a;a=b;b=t}return{x0:a.column,y0:a.row,x1:b.column,y1:b.row,dx:b.column-a.column,dy:b.row-a.row}}function scanSpans(e0,e1,ymin,ymax,scanLine){var y0=Math.max(ymin,Math.floor(e1.y0));var y1=Math.min(ymax,Math.ceil(e1.y1));if(e0.x0===e1.x0&&e0.y0===e1.y0?e0.x0+e1.dy/e0.dy*e0.dx<e1.x1:e0.x1-e1.dy/e0.dy*e0.dx<e1.x0){var t=e0;e0=e1;e1=t}var m0=e0.dx/e0.dy;var m1=e1.dx/e1.dy;var d0=e0.dx>0;var d1=e1.dx<0;for(var y=y0;y<y1;y++){var x0=m0*Math.max(0,Math.min(e0.dy,y+d0-e0.y0))+e0.x0;var x1=m1*Math.max(0,Math.min(e1.dy,y+d1-e1.y0))+e1.x0;scanLine(Math.floor(x1),Math.ceil(x0),y)}}function scanTriangle(a,b,c,ymin,ymax,scanLine){var ab=edge(a,b),bc=edge(b,c),ca=edge(c,a);var t;if(ab.dy>bc.dy){t=ab;ab=bc;bc=t}if(ab.dy>ca.dy){t=ab;ab=ca;ca=t}if(bc.dy>ca.dy){t=bc;bc=ca;ca=t}if(ab.dy)scanSpans(ca,ab,ymin,ymax,scanLine);if(bc.dy)scanSpans(ca,bc,ymin,ymax,scanLine)}TileCoord.cover=function(z,bounds,actualZ,renderWorldCopies){if(renderWorldCopies===undefined){renderWorldCopies=true}var tiles=1<<z;var t={};function scanLine(x0,x1,y){var x,w,wx,coord;if(y>=0&&y<=tiles){for(x=x0;x<x1;x++){w=Math.floor(x/tiles);wx=(x%tiles+tiles)%tiles;if(w===0||renderWorldCopies===true){coord=new TileCoord(actualZ,wx,y,w);t[coord.id]=coord}}}}scanTriangle(bounds[0],bounds[1],bounds[2],0,tiles,scanLine);scanTriangle(bounds[2],bounds[3],bounds[0],0,tiles,scanLine);return Object.keys(t).map(function(id){return t[id]})};TileCoord.fromID=function(id){var z=id%32,dim=1<<z;var xy=(id-z)/32;var x=xy%dim,y=(xy-x)/dim%dim;var w=Math.floor(xy/(dim*dim));if(w%2!==0)w=w*-1-1;w/=2;return new TileCoord(z,x,y,w)};function getQuadkey(z,x,y){var quadkey="",mask;for(var i=z;i>0;i--){mask=1<<i-1;quadkey+=(x&mask?1:0)+(y&mask?2:0)}return quadkey}module.exports=TileCoord},{"../geo/coordinate":614,"whoots-js":1009}],648:[function(require,module,exports){"use strict";var Evented=require("../util/evented");var util=require("../util/util");var loadTileJSON=require("./load_tilejson");var normalizeURL=require("../util/mapbox").normalizeTileURL;var VectorTileSource=function(Evented){function VectorTileSource(id,options,dispatcher,eventedParent){Evented.call(this);this.id=id;this.dispatcher=dispatcher;this.type="vector";this.minzoom=0;this.maxzoom=22;this.scheme="xyz";this.tileSize=512;this.reparseOverscaled=true;this.isTileClipped=true;util.extend(this,util.pick(options,["url","scheme","tileSize"]));this._options=util.extend({type:"vector"},options);if(this.tileSize!==512){throw new Error("vector tile sources must have a tileSize of 512")}this.setEventedParent(eventedParent)}if(Evented)VectorTileSource.__proto__=Evented;VectorTileSource.prototype=Object.create(Evented&&Evented.prototype);VectorTileSource.prototype.constructor=VectorTileSource;VectorTileSource.prototype.load=function load(){var this$1=this;this.fire("dataloading",{dataType:"source"});loadTileJSON(this._options,function(err,tileJSON){if(err){this$1.fire("error",err);return}util.extend(this$1,tileJSON);this$1.fire("data",{dataType:"source"});this$1.fire("source.load")})};VectorTileSource.prototype.onAdd=function onAdd(map){this.load();this.map=map};VectorTileSource.prototype.serialize=function serialize(){return util.extend({},this._options)};VectorTileSource.prototype.loadTile=function loadTile(tile,callback){var overscaling=tile.coord.z>this.maxzoom?Math.pow(2,tile.coord.z-this.maxzoom):1;var params={url:normalizeURL(tile.coord.url(this.tiles,this.maxzoom,this.scheme),this.url),uid:tile.uid,coord:tile.coord,zoom:tile.coord.z,tileSize:this.tileSize*overscaling,type:this.type,source:this.id,overscaling:overscaling,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};if(!tile.workerID){tile.workerID=this.dispatcher.send("loadTile",params,done.bind(this))}else if(tile.state==="loading"){tile.reloadCallback=callback}else{this.dispatcher.send("reloadTile",params,done.bind(this),tile.workerID)}function done(err,data){if(tile.aborted)return;if(err){return callback(err)}tile.loadVectorData(data,this.map.painter);if(tile.redoWhenDone){tile.redoWhenDone=false;tile.redoPlacement(this)}callback(null);if(tile.reloadCallback){this.loadTile(tile,tile.reloadCallback);tile.reloadCallback=null}}};VectorTileSource.prototype.abortTile=function abortTile(tile){this.dispatcher.send("abortTile",{uid:tile.uid,type:this.type,source:this.id},null,tile.workerID)};VectorTileSource.prototype.unloadTile=function unloadTile(tile){tile.unloadVectorData();this.dispatcher.send("removeTile",{uid:tile.uid,type:this.type,source:this.id},null,tile.workerID)};return VectorTileSource}(Evented);module.exports=VectorTileSource},{"../util/evented":712,"../util/mapbox":719,"../util/util":723,"./load_tilejson":640}],649:[function(require,module,exports){"use strict";var ajax=require("../util/ajax");var vt=require("vector-tile");var Protobuf=require("pbf");var WorkerTile=require("./worker_tile");var util=require("../util/util");var VectorTileWorkerSource=function VectorTileWorkerSource(actor,layerIndex,loadVectorData){this.actor=actor;this.layerIndex=layerIndex;if(loadVectorData){this.loadVectorData=loadVectorData}this.loading={};this.loaded={}};VectorTileWorkerSource.prototype.loadTile=function loadTile(params,callback){var source=params.source,uid=params.uid;if(!this.loading[source])this.loading[source]={};var workerTile=this.loading[source][uid]=new WorkerTile(params);workerTile.abort=this.loadVectorData(params,done.bind(this));function done(err,vectorTile){delete this.loading[source][uid];if(err)return callback(err);if(!vectorTile)return callback(null,null);workerTile.vectorTile=vectorTile;workerTile.parse(vectorTile,this.layerIndex,this.actor,function(err,result,transferrables){if(err)return callback(err);callback(null,util.extend({rawTileData:vectorTile.rawData},result),transferrables)});this.loaded[source]=this.loaded[source]||{};this.loaded[source][uid]=workerTile}};VectorTileWorkerSource.prototype.reloadTile=function reloadTile(params,callback){var loaded=this.loaded[params.source],uid=params.uid,vtSource=this;if(loaded&&loaded[uid]){var workerTile=loaded[uid];if(workerTile.status==="parsing"){workerTile.reloadCallback=callback}else if(workerTile.status==="done"){workerTile.parse(workerTile.vectorTile,this.layerIndex,this.actor,done.bind(workerTile))}}function done(err,data){if(this.reloadCallback){var reloadCallback=this.reloadCallback;delete this.reloadCallback;this.parse(this.vectorTile,vtSource.layerIndex,vtSource.actor,reloadCallback)}callback(err,data)}};VectorTileWorkerSource.prototype.abortTile=function abortTile(params){var loading=this.loading[params.source],uid=params.uid;if(loading&&loading[uid]&&loading[uid].abort){loading[uid].abort();delete loading[uid]}};VectorTileWorkerSource.prototype.removeTile=function removeTile(params){var loaded=this.loaded[params.source],uid=params.uid;if(loaded&&loaded[uid]){delete loaded[uid]}};VectorTileWorkerSource.prototype.loadVectorData=function loadVectorData(params,callback){var xhr=ajax.getArrayBuffer(params.url,done.bind(this));return function abort(){xhr.abort()};function done(err,arrayBuffer){if(err){return callback(err)}var vectorTile=new vt.VectorTile(new Protobuf(arrayBuffer));vectorTile.rawData=arrayBuffer;callback(err,vectorTile)}};VectorTileWorkerSource.prototype.redoPlacement=function redoPlacement(params,callback){var loaded=this.loaded[params.source],loading=this.loading[params.source],uid=params.uid;if(loaded&&loaded[uid]){var workerTile=loaded[uid];var result=workerTile.redoPlacement(params.angle,params.pitch,params.showCollisionBoxes);if(result.result){callback(null,result.result,result.transferables)}}else if(loading&&loading[uid]){loading[uid].angle=params.angle}};module.exports=VectorTileWorkerSource},{"../util/ajax":703,"../util/util":723,"./worker_tile":652,pbf:747,"vector-tile":997}],650:[function(require,module,exports){"use strict";var ajax=require("../util/ajax");var ImageSource=require("./image_source");var VideoSource=function(ImageSource){function VideoSource(id,options,dispatcher,eventedParent){ImageSource.call(this,id,options,dispatcher,eventedParent);this.roundZoom=true;this.options=options}if(ImageSource)VideoSource.__proto__=ImageSource;VideoSource.prototype=Object.create(ImageSource&&ImageSource.prototype);VideoSource.prototype.constructor=VideoSource;VideoSource.prototype.load=function load(){var this$1=this;var options=this.options;this.urls=options.urls;ajax.getVideo(options.urls,function(err,video){if(err)return this$1.fire("error",{error:err});this$1.video=video;this$1.video.loop=true;var loopID;this$1.video.addEventListener("playing",function(){loopID=this$1.map.style.animationLoop.set(Infinity);this$1.map._rerender()});this$1.video.addEventListener("pause",function(){this$1.map.style.animationLoop.cancel(loopID)});if(this$1.map){this$1.video.play()}this$1._finishLoading()})};VideoSource.prototype.getVideo=function getVideo(){return this.video};VideoSource.prototype.onAdd=function onAdd(map){if(this.map)return;this.load();this.map=map;if(this.video){this.video.play();this.setCoordinates(this.coordinates)}};VideoSource.prototype.prepare=function prepare(){if(!this.tile||this.video.readyState<2)return;this._prepareImage(this.map.painter.gl,this.video)};VideoSource.prototype.serialize=function serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}};return VideoSource}(ImageSource);module.exports=VideoSource},{"../util/ajax":703,"./image_source":639}],651:[function(require,module,exports){"use strict";var Actor=require("../util/actor");var StyleLayerIndex=require("../style/style_layer_index");var VectorTileWorkerSource=require("./vector_tile_worker_source");var GeoJSONWorkerSource=require("./geojson_worker_source");var Worker=function Worker(self){var this$1=this;this.self=self;this.actor=new Actor(self,this);this.layerIndexes={};this.workerSourceTypes={vector:VectorTileWorkerSource,geojson:GeoJSONWorkerSource};this.workerSources={};this.self.registerWorkerSource=function(name,WorkerSource){if(this$1.workerSourceTypes[name]){throw new Error('Worker source with name "'+name+'" already registered.')}this$1.workerSourceTypes[name]=WorkerSource}};Worker.prototype.setLayers=function setLayers(mapId,layers){this.getLayerIndex(mapId).replace(layers)};Worker.prototype.updateLayers=function updateLayers(mapId,params){this.getLayerIndex(mapId).update(params.layers,params.removedIds,params.symbolOrder)};Worker.prototype.loadTile=function loadTile(mapId,params,callback){this.getWorkerSource(mapId,params.type).loadTile(params,callback)};Worker.prototype.reloadTile=function reloadTile(mapId,params,callback){this.getWorkerSource(mapId,params.type).reloadTile(params,callback)};Worker.prototype.abortTile=function abortTile(mapId,params){this.getWorkerSource(mapId,params.type).abortTile(params)};Worker.prototype.removeTile=function removeTile(mapId,params){this.getWorkerSource(mapId,params.type).removeTile(params)};Worker.prototype.removeSource=function removeSource(mapId,params){var worker=this.getWorkerSource(mapId,params.type);if(worker.removeSource!==undefined){worker.removeSource(params)}};Worker.prototype.redoPlacement=function redoPlacement(mapId,params,callback){this.getWorkerSource(mapId,params.type).redoPlacement(params,callback)};Worker.prototype.loadWorkerSource=function loadWorkerSource(map,params,callback){try{this.self.importScripts(params.url);callback()}catch(e){callback(e)}};Worker.prototype.getLayerIndex=function getLayerIndex(mapId){var layerIndexes=this.layerIndexes[mapId];if(!layerIndexes){layerIndexes=this.layerIndexes[mapId]=new StyleLayerIndex}return layerIndexes};Worker.prototype.getWorkerSource=function getWorkerSource(mapId,type){var this$1=this;if(!this.workerSources[mapId])this.workerSources[mapId]={};if(!this.workerSources[mapId][type]){var actor={send:function(type,data,callback,buffers){this$1.actor.send(type,data,callback,buffers,mapId)}};this.workerSources[mapId][type]=new this.workerSourceTypes[type](actor,this.getLayerIndex(mapId))}return this.workerSources[mapId][type]};module.exports=function createWorker(self){return new Worker(self)}},{"../style/style_layer_index":665,"../util/actor":702,"./geojson_worker_source":637,"./vector_tile_worker_source":649}],652:[function(require,module,exports){"use strict";var FeatureIndex=require("../data/feature_index");var CollisionTile=require("../symbol/collision_tile");var CollisionBoxArray=require("../symbol/collision_box");var DictionaryCoder=require("../util/dictionary_coder");var util=require("../util/util");var SymbolInstancesArray=require("../symbol/symbol_instances");var SymbolQuadsArray=require("../symbol/symbol_quads");var WorkerTile=function WorkerTile(params){this.coord=params.coord;this.uid=params.uid;this.zoom=params.zoom;this.tileSize=params.tileSize;this.source=params.source;this.overscaling=params.overscaling;this.angle=params.angle;this.pitch=params.pitch;this.showCollisionBoxes=params.showCollisionBoxes};WorkerTile.prototype.parse=function parse(data,layerIndex,actor,callback){var this$1=this;if(!data.layers){data={layers:{_geojsonTileLayer:data}}}this.status="parsing";this.data=data;this.collisionBoxArray=new CollisionBoxArray;this.symbolInstancesArray=new SymbolInstancesArray;this.symbolQuadsArray=new SymbolQuadsArray;var sourceLayerCoder=new DictionaryCoder(Object.keys(data.layers).sort());var featureIndex=new FeatureIndex(this.coord,this.overscaling);featureIndex.bucketLayerIDs={};var buckets={};var bucketIndex=0;var options={featureIndex:featureIndex,iconDependencies:{},glyphDependencies:{}};var layerFamilies=layerIndex.familiesBySource[this.source];for(var sourceLayerId in layerFamilies){var sourceLayer=data.layers[sourceLayerId];if(!sourceLayer){continue}if(sourceLayer.version===1){util.warnOnce('Vector tile source "'+this$1.source+'" layer "'+sourceLayerId+'" does not use vector tile spec v2 '+"and therefore may have some rendering errors.")}var sourceLayerIndex=sourceLayerCoder.encode(sourceLayerId);var features=[];for(var i=0;i<sourceLayer.length;i++){var feature=sourceLayer.feature(i);feature.index=i;feature.sourceLayerIndex=sourceLayerIndex;features.push(feature)}for(var i$2=0,list=layerFamilies[sourceLayerId];i$2<list.length;i$2+=1){var family=list[i$2];var layer=family[0];if(layer.minzoom&&this$1.zoom<layer.minzoom)continue;if(layer.maxzoom&&this$1.zoom>=layer.maxzoom)continue;if(layer.layout&&layer.layout.visibility==="none")continue;for(var i$3=0,list$1=family;i$3<list$1.length;i$3+=1){var layer$1=list$1[i$3];layer$1.recalculate(this$1.zoom)}var bucket=buckets[layer.id]=layer.createBucket({index:bucketIndex,layers:family,zoom:this$1.zoom,overscaling:this$1.overscaling,collisionBoxArray:this$1.collisionBoxArray,symbolQuadsArray:this$1.symbolQuadsArray,symbolInstancesArray:this$1.symbolInstancesArray});bucket.populate(features,options);featureIndex.bucketLayerIDs[bucketIndex]=family.map(function(l){return l.id});bucketIndex++}}var done=function(collisionTile){this$1.status="done";var transferables=[];callback(null,{buckets:serializeBuckets(util.values(buckets),transferables),featureIndex:featureIndex.serialize(transferables),collisionTile:collisionTile.serialize(transferables),collisionBoxArray:this$1.collisionBoxArray.serialize(),symbolInstancesArray:this$1.symbolInstancesArray.serialize(),symbolQuadsArray:this$1.symbolQuadsArray.serialize()},transferables)};this.symbolBuckets=[];for(var i$1=layerIndex.symbolOrder.length-1;i$1>=0;i$1--){var bucket$1=buckets[layerIndex.symbolOrder[i$1]];if(bucket$1){this$1.symbolBuckets.push(bucket$1)}}if(this.symbolBuckets.length===0){return done(new CollisionTile(this.angle,this.pitch,this.collisionBoxArray))}var deps=0;var icons=Object.keys(options.iconDependencies);var stacks=util.mapObject(options.glyphDependencies,function(glyphs){return Object.keys(glyphs).map(Number)});var gotDependency=function(err){if(err)return callback(err);deps++;if(deps===2){var collisionTile=new CollisionTile(this$1.angle,this$1.pitch,this$1.collisionBoxArray);for(var i=0,list=this$1.symbolBuckets;i<list.length;i+=1){var bucket=list[i];recalculateLayers(bucket,this$1.zoom);bucket.prepare(stacks,icons);bucket.place(collisionTile,this$1.showCollisionBoxes)}done(collisionTile)}};if(Object.keys(stacks).length){actor.send("getGlyphs",{uid:this.uid,stacks:stacks},function(err,newStacks){stacks=newStacks;gotDependency(err)})}else{gotDependency()}if(icons.length){actor.send("getIcons",{icons:icons},function(err,newIcons){icons=newIcons;gotDependency(err)})}else{gotDependency()}};WorkerTile.prototype.redoPlacement=function redoPlacement(angle,pitch,showCollisionBoxes){var this$1=this;this.angle=angle;this.pitch=pitch;if(this.status!=="done"){return{}}var collisionTile=new CollisionTile(this.angle,this.pitch,this.collisionBoxArray);for(var i=0,list=this.symbolBuckets;i<list.length;i+=1){var bucket=list[i];recalculateLayers(bucket,this$1.zoom);bucket.place(collisionTile,showCollisionBoxes)}var transferables=[];return{result:{buckets:serializeBuckets(this.symbolBuckets,transferables),collisionTile:collisionTile.serialize(transferables)},transferables:transferables}};function recalculateLayers(bucket,zoom){for(var i=0,list=bucket.layers;i<list.length;i+=1){var layer=list[i];layer.recalculate(zoom)}}function serializeBuckets(buckets,transferables){return buckets.filter(function(b){return!b.isEmpty()}).map(function(b){return b.serialize(transferables)})}module.exports=WorkerTile},{"../data/feature_index":608,"../symbol/collision_box":672,"../symbol/collision_tile":674,"../symbol/symbol_instances":683,"../symbol/symbol_quads":684,"../util/dictionary_coder":709,"../util/util":723}],653:[function(require,module,exports){"use strict";var AnimationLoop=function AnimationLoop(){this.n=0;this.times=[]};AnimationLoop.prototype.stopped=function stopped(){this.times=this.times.filter(function(t){return t.time>=(new Date).getTime()});return!this.times.length};AnimationLoop.prototype.set=function set(t){this.times.push({id:this.n,time:t+(new Date).getTime()});return this.n++};AnimationLoop.prototype.cancel=function cancel(n){this.times=this.times.filter(function(t){return t.id!==n})};module.exports=AnimationLoop},{}],654:[function(require,module,exports){"use strict";var Evented=require("../util/evented");var ajax=require("../util/ajax");var browser=require("../util/browser");var normalizeURL=require("../util/mapbox").normalizeSpriteURL;var SpritePosition=function SpritePosition(){this.x=0;this.y=0;this.width=0;this.height=0;this.pixelRatio=1;this.sdf=false};var ImageSprite=function(Evented){function ImageSprite(base,eventedParent){var this$1=this;Evented.call(this);this.base=base;this.retina=browser.devicePixelRatio>1;this.setEventedParent(eventedParent);var format=this.retina?"@2x":"";ajax.getJSON(normalizeURL(base,format,".json"),function(err,data){if(err){this$1.fire("error",{error:err});return}this$1.data=data;if(this$1.imgData)this$1.fire("data",{dataType:"style"})});ajax.getImage(normalizeURL(base,format,".png"),function(err,img){if(err){this$1.fire("error",{error:err});return}this$1.imgData=browser.getImageData(img);for(var i=0;i<this$1.imgData.length;i+=4){var alpha=this$1.imgData[i+3]/255;this$1.imgData[i+0]*=alpha;this$1.imgData[i+1]*=alpha;this$1.imgData[i+2]*=alpha}this$1.width=img.width;if(this$1.data)this$1.fire("data",{dataType:"style"})})}if(Evented)ImageSprite.__proto__=Evented;ImageSprite.prototype=Object.create(Evented&&Evented.prototype);ImageSprite.prototype.constructor=ImageSprite;ImageSprite.prototype.toJSON=function toJSON(){return this.base};ImageSprite.prototype.loaded=function loaded(){return!!(this.data&&this.imgData)};ImageSprite.prototype.resize=function resize(){var this$1=this;if(browser.devicePixelRatio>1!==this.retina){var newSprite=new ImageSprite(this.base);newSprite.on("data",function(){this$1.data=newSprite.data;this$1.imgData=newSprite.imgData;this$1.width=newSprite.width;this$1.retina=newSprite.retina})}};ImageSprite.prototype.getSpritePosition=function getSpritePosition(name){if(!this.loaded())return new SpritePosition;var pos=this.data&&this.data[name];if(pos&&this.imgData)return pos;return new SpritePosition};return ImageSprite}(Evented);module.exports=ImageSprite},{"../util/ajax":703,"../util/browser":704,"../util/evented":712,"../util/mapbox":719}],655:[function(require,module,exports){"use strict";var styleSpec=require("./style_spec");var util=require("../util/util");var Evented=require("../util/evented");var validateStyle=require("./validate_style");var StyleDeclaration=require("./style_declaration");var StyleTransition=require("./style_transition");var TRANSITION_SUFFIX="-transition";var Light=function(Evented){function Light(lightOptions){Evented.call(this);this.properties=["anchor","color","position","intensity"];this._specifications=styleSpec.light;this.set(lightOptions)}if(Evented)Light.__proto__=Evented;Light.prototype=Object.create(Evented&&Evented.prototype);Light.prototype.constructor=Light;Light.prototype.set=function set(lightOpts){var this$1=this;if(this._validate(validateStyle.light,lightOpts))return;this._declarations={};this._transitions={};this._transitionOptions={};this.calculated={};lightOpts=util.extend({anchor:this._specifications.anchor.default,color:this._specifications.color.default,position:this._specifications.position.default,intensity:this._specifications.intensity.default},lightOpts);for(var i=0,list=this.properties;i<list.length;i+=1){var prop=list[i];this$1._declarations[prop]=new StyleDeclaration(this$1._specifications[prop],lightOpts[prop])}return this};Light.prototype.getLight=function getLight(){return{anchor:this.getLightProperty("anchor"),color:this.getLightProperty("color"),position:this.getLightProperty("position"),intensity:this.getLightProperty("intensity")}};Light.prototype.getLightProperty=function getLightProperty(property){if(util.endsWith(property,TRANSITION_SUFFIX)){return this._transitionOptions[property]}else{return this._declarations[property]&&this._declarations[property].value}};Light.prototype.getLightValue=function getLightValue(property,globalProperties){if(property==="position"){var calculated=this._transitions[property].calculate(globalProperties),cartesian=util.sphericalToCartesian(calculated);return{x:cartesian[0],y:cartesian[1],z:cartesian[2]}}return this._transitions[property].calculate(globalProperties)};Light.prototype.setLight=function setLight(options){var this$1=this;if(this._validate(validateStyle.light,options))return;for(var key in options){var value=options[key];if(util.endsWith(key,TRANSITION_SUFFIX)){this$1._transitionOptions[key]=value}else if(value===null||value===undefined){delete this$1._declarations[key]}else{this$1._declarations[key]=new StyleDeclaration(this$1._specifications[key],value)}}};Light.prototype.recalculate=function recalculate(zoom){var this$1=this;for(var property in this._declarations){this$1.calculated[property]=this$1.getLightValue(property,{zoom:zoom})}};Light.prototype._applyLightDeclaration=function _applyLightDeclaration(property,declaration,options,globalOptions,animationLoop){var oldTransition=options.transition?this._transitions[property]:undefined;var spec=this._specifications[property];if(declaration===null||declaration===undefined){declaration=new StyleDeclaration(spec,spec.default)}if(oldTransition&&oldTransition.declaration.json===declaration.json)return;var transitionOptions=util.extend({duration:300,delay:0},globalOptions,this.getLightProperty(property+TRANSITION_SUFFIX));var newTransition=this._transitions[property]=new StyleTransition(spec,declaration,oldTransition,transitionOptions);if(!newTransition.instant()){newTransition.loopID=animationLoop.set(newTransition.endTime-Date.now())}if(oldTransition){animationLoop.cancel(oldTransition.loopID)}};Light.prototype.updateLightTransitions=function updateLightTransitions(options,globalOptions,animationLoop){var this$1=this;var property;for(property in this._declarations){this$1._applyLightDeclaration(property,this$1._declarations[property],options,globalOptions,animationLoop)}};Light.prototype._validate=function _validate(validate,value){return validateStyle.emitErrors(this,validate.call(validateStyle,util.extend({value:value,style:{glyphs:true,sprite:true},styleSpec:styleSpec})))};return Light}(Evented);module.exports=Light},{"../util/evented":712,"../util/util":723,"./style_declaration":658,"./style_spec":666,"./style_transition":667,"./validate_style":668}],656:[function(require,module,exports){"use strict";var parseColorString=require("csscolorparser").parseCSSColor;var util=require("../util/util");var MapboxGLFunction=require("mapbox-gl-function");var cache={};module.exports=function parseColor(input){if(input&&MapboxGLFunction.isFunctionDefinition(input)){if(!input.stops)return input;else return util.extend({},input,{stops:input.stops.map(function(stop){return[stop[0],parseColor(stop[1])]})})}else if(typeof input==="string"){if(!cache[input]){var rgba=parseColorString(input);if(!rgba){throw new Error("Invalid color "+input)}cache[input]=[rgba[0]/255*rgba[3],rgba[1]/255*rgba[3],rgba[2]/255*rgba[3],rgba[3]]}return cache[input]}else if(Array.isArray(input)){return input}else{throw new Error("Invalid color "+input)}}},{"../util/util":723,csscolorparser:319,"mapbox-gl-function":567}],657:[function(require,module,exports){"use strict";var Evented=require("../util/evented");var StyleLayer=require("./style_layer");var ImageSprite=require("./image_sprite");var Light=require("./light");var GlyphSource=require("../symbol/glyph_source");var SpriteAtlas=require("../symbol/sprite_atlas");var LineAtlas=require("../render/line_atlas");var util=require("../util/util");var ajax=require("../util/ajax");var mapbox=require("../util/mapbox");var browser=require("../util/browser");var Dispatcher=require("../util/dispatcher");var AnimationLoop=require("./animation_loop");var validateStyle=require("./validate_style");var Source=require("../source/source");var QueryFeatures=require("../source/query_features");var SourceCache=require("../source/source_cache");var styleSpec=require("./style_spec");var MapboxGLFunction=require("mapbox-gl-function");var getWorkerPool=require("../global_worker_pool");var deref=require("mapbox-gl-style-spec/lib/deref");var diff=require("mapbox-gl-style-spec/lib/diff");var supportedDiffOperations=util.pick(diff.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition"]);var ignoredDiffOperations=util.pick(diff.operations,["setCenter","setZoom","setBearing","setPitch"]);var Style=function(Evented){function Style(stylesheet,map,options){var this$1=this;Evented.call(this);this.map=map;this.animationLoop=map&&map.animationLoop||new AnimationLoop;this.dispatcher=new Dispatcher(getWorkerPool(),this);this.spriteAtlas=new SpriteAtlas(1024,1024);this.lineAtlas=new LineAtlas(256,512);this._layers={};this._order=[];this.sourceCaches={};this.zoomHistory={};this._loaded=false;util.bindAll(["_redoPlacement"],this);this._resetUpdates();options=util.extend({validate:typeof stylesheet==="string"?!mapbox.isMapboxURL(stylesheet):true},options);this.setEventedParent(map);this.fire("dataloading",{dataType:"style"});var stylesheetLoaded=function(err,stylesheet){if(err){this$1.fire("error",{error:err});return}if(options.validate&&validateStyle.emitErrors(this$1,validateStyle(stylesheet)))return;this$1._loaded=true;this$1.stylesheet=stylesheet;this$1.updateClasses();for(var id in stylesheet.sources){this$1.addSource(id,stylesheet.sources[id],options)}if(stylesheet.sprite){this$1.sprite=new ImageSprite(stylesheet.sprite,this$1)}this$1.glyphSource=new GlyphSource(stylesheet.glyphs);this$1._resolve();this$1.fire("data",{dataType:"style"});this$1.fire("style.load")};if(typeof stylesheet==="string"){ajax.getJSON(mapbox.normalizeStyleURL(stylesheet),stylesheetLoaded)}else{browser.frame(stylesheetLoaded.bind(this,null,stylesheet))}this.on("source.load",function(event){var source=this$1.sourceCaches[event.sourceId].getSource();if(source&&source.vectorLayerIds){for(var layerId in this$1._layers){var layer=this$1._layers[layerId];if(layer.source===source.id){this$1._validateLayer(layer)}}}})}if(Evented)Style.__proto__=Evented;Style.prototype=Object.create(Evented&&Evented.prototype);Style.prototype.constructor=Style;Style.prototype._validateLayer=function _validateLayer(layer){var sourceCache=this.sourceCaches[layer.source];if(!layer.sourceLayer)return;if(!sourceCache)return;var source=sourceCache.getSource();if(source.type==="geojson"||source.vectorLayerIds&&source.vectorLayerIds.indexOf(layer.sourceLayer)===-1){this.fire("error",{error:new Error('Source layer "'+layer.sourceLayer+'" '+'does not exist on source "'+source.id+'" '+'as specified by style layer "'+layer.id+'"')})}};Style.prototype.loaded=function loaded(){var this$1=this;if(!this._loaded)return false;if(Object.keys(this._updatedSources).length)return false;for(var id in this.sourceCaches)if(!this$1.sourceCaches[id].loaded())return false;if(this.sprite&&!this.sprite.loaded())return false;return true};Style.prototype._resolve=function _resolve(){var this$1=this;var layers=deref(this.stylesheet.layers);this._order=layers.map(function(layer){return layer.id});this._layers={};for(var i=0,list=layers;i<list.length;i+=1){var layer=list[i];layer=StyleLayer.create(layer);layer.setEventedParent(this$1,{layer:{id:layer.id}});this$1._layers[layer.id]=layer}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order));this.light=new Light(this.stylesheet.light)};Style.prototype._serializeLayers=function _serializeLayers(ids){var this$1=this;return ids.map(function(id){return this$1._layers[id].serialize()})};Style.prototype._applyClasses=function _applyClasses(classes,options){var this$1=this;if(!this._loaded)return;classes=classes||[];options=options||{transition:true};var transition=this.stylesheet.transition||{};
var layers=this._updatedAllPaintProps?this._layers:this._updatedPaintProps;for(var id in layers){var layer=this$1._layers[id];var props=this$1._updatedPaintProps[id];if(this$1._updatedAllPaintProps||props.all){layer.updatePaintTransitions(classes,options,transition,this$1.animationLoop,this$1.zoomHistory)}else{for(var paintName in props){this$1._layers[id].updatePaintTransition(paintName,classes,options,transition,this$1.animationLoop,this$1.zoomHistory)}}}this.light.updateLightTransitions(options,transition,this.animationLoop)};Style.prototype._recalculate=function _recalculate(z){var this$1=this;if(!this._loaded)return;for(var sourceId in this.sourceCaches)this$1.sourceCaches[sourceId].used=false;this._updateZoomHistory(z);for(var i=0,list=this._order;i<list.length;i+=1){var layerId=list[i];var layer=this$1._layers[layerId];layer.recalculate(z);if(!layer.isHidden(z)&&layer.source){this$1.sourceCaches[layer.source].used=true}}this.light.recalculate(z);var maxZoomTransitionDuration=300;if(Math.floor(this.z)!==Math.floor(z)){this.animationLoop.set(maxZoomTransitionDuration)}this.z=z};Style.prototype._updateZoomHistory=function _updateZoomHistory(z){var zh=this.zoomHistory;if(zh.lastIntegerZoom===undefined){zh.lastIntegerZoom=Math.floor(z);zh.lastIntegerZoomTime=0;zh.lastZoom=z}if(Math.floor(zh.lastZoom)<Math.floor(z)){zh.lastIntegerZoom=Math.floor(z);zh.lastIntegerZoomTime=Date.now()}else if(Math.floor(zh.lastZoom)>Math.floor(z)){zh.lastIntegerZoom=Math.floor(z+1);zh.lastIntegerZoomTime=Date.now()}zh.lastZoom=z};Style.prototype._checkLoaded=function _checkLoaded(){if(!this._loaded){throw new Error("Style is not done loading")}};Style.prototype.update=function update(classes,options){var this$1=this;if(!this._changed)return;var updatedIds=Object.keys(this._updatedLayers);var removedIds=Object.keys(this._removedLayers);if(updatedIds.length||removedIds.length||this._updatedSymbolOrder){this._updateWorkerLayers(updatedIds,removedIds)}for(var id in this._updatedSources){var action=this$1._updatedSources[id];if(action==="reload"){this$1._reloadSource(id)}else if(action==="clear"){this$1._clearSource(id)}}this._applyClasses(classes,options);this._resetUpdates();this.fire("data",{dataType:"style"})};Style.prototype._updateWorkerLayers=function _updateWorkerLayers(updatedIds,removedIds){var this$1=this;var symbolOrder=this._updatedSymbolOrder?this._order.filter(function(id){return this$1._layers[id].type==="symbol"}):null;this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(updatedIds),removedIds:removedIds,symbolOrder:symbolOrder})};Style.prototype._resetUpdates=function _resetUpdates(){this._changed=false;this._updatedLayers={};this._removedLayers={};this._updatedSymbolOrder=false;this._updatedSources={};this._updatedPaintProps={};this._updatedAllPaintProps=false};Style.prototype.setState=function setState(nextState){var this$1=this;this._checkLoaded();if(validateStyle.emitErrors(this,validateStyle(nextState)))return false;nextState=util.extend({},nextState);nextState.layers=deref(nextState.layers);var changes=diff(this.serialize(),nextState).filter(function(op){return!(op.command in ignoredDiffOperations)});if(changes.length===0){return false}var unimplementedOps=changes.filter(function(op){return!(op.command in supportedDiffOperations)});if(unimplementedOps.length>0){throw new Error("Unimplemented: "+unimplementedOps.map(function(op){return op.command}).join(", ")+".")}changes.forEach(function(op){if(op.command==="setTransition"){return}this$1[op.command].apply(this$1,op.args)});this.stylesheet=nextState;return true};Style.prototype.addSource=function addSource(id,source,options){this._checkLoaded();if(this.sourceCaches[id]!==undefined){throw new Error("There is already a source with this ID")}if(!source.type){throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(source)+".")}var builtIns=["vector","raster","geojson","video","image"];var shouldValidate=builtIns.indexOf(source.type)>=0;if(shouldValidate&&this._validate(validateStyle.source,"sources."+id,source,null,options))return;var sourceCache=this.sourceCaches[id]=new SourceCache(id,source,this.dispatcher);sourceCache.style=this;sourceCache.setEventedParent(this,function(){return{isSourceLoaded:sourceCache.loaded(),source:sourceCache.serialize(),sourceId:id}});sourceCache.onAdd(this.map);this._changed=true};Style.prototype.removeSource=function removeSource(id){this._checkLoaded();if(this.sourceCaches[id]===undefined){throw new Error("There is no source with this ID")}var sourceCache=this.sourceCaches[id];delete this.sourceCaches[id];delete this._updatedSources[id];sourceCache.setEventedParent(null);sourceCache.clearTiles();if(sourceCache.onRemove)sourceCache.onRemove(this.map);this._changed=true};Style.prototype.getSource=function getSource(id){return this.sourceCaches[id]&&this.sourceCaches[id].getSource()};Style.prototype.addLayer=function addLayer(layerObject,before,options){this._checkLoaded();var id=layerObject.id;if(typeof layerObject.source==="object"){this.addSource(id,layerObject.source);layerObject=util.extend(layerObject,{source:id})}if(this._validate(validateStyle.layer,"layers."+id,layerObject,{arrayIndex:-1},options))return;var layer=StyleLayer.create(layerObject);this._validateLayer(layer);layer.setEventedParent(this,{layer:{id:id}});var index=before?this._order.indexOf(before):this._order.length;this._order.splice(index,0,id);this._layers[id]=layer;if(this._removedLayers[id]&&layer.source){delete this._removedLayers[id];this._updatedSources[layer.source]="clear"}this._updateLayer(layer);if(layer.type==="symbol"){this._updatedSymbolOrder=true}this.updateClasses(id)};Style.prototype.moveLayer=function moveLayer(id,before){this._checkLoaded();this._changed=true;var layer=this._layers[id];if(!layer){this.fire("error",{error:new Error("The layer '"+id+"' does not exist in "+"the map's style and cannot be moved.")});return}var index=this._order.indexOf(id);this._order.splice(index,1);var newIndex=before?this._order.indexOf(before):this._order.length;this._order.splice(newIndex,0,id);if(layer.type==="symbol"){this._updatedSymbolOrder=true;if(layer.source&&!this._updatedSources[layer.source]){this._updatedSources[layer.source]="reload"}}};Style.prototype.removeLayer=function removeLayer(id){this._checkLoaded();var layer=this._layers[id];if(!layer){this.fire("error",{error:new Error("The layer '"+id+"' does not exist in "+"the map's style and cannot be removed.")});return}layer.setEventedParent(null);var index=this._order.indexOf(id);this._order.splice(index,1);if(layer.type==="symbol"){this._updatedSymbolOrder=true}this._changed=true;this._removedLayers[id]=true;delete this._layers[id];delete this._updatedLayers[id];delete this._updatedPaintProps[id]};Style.prototype.getLayer=function getLayer(id){return this._layers[id]};Style.prototype.setLayerZoomRange=function setLayerZoomRange(layerId,minzoom,maxzoom){this._checkLoaded();var layer=this.getLayer(layerId);if(!layer){this.fire("error",{error:new Error("The layer '"+layerId+"' does not exist in "+"the map's style and cannot have zoom extent.")});return}if(layer.minzoom===minzoom&&layer.maxzoom===maxzoom)return;if(minzoom!=null){layer.minzoom=minzoom}if(maxzoom!=null){layer.maxzoom=maxzoom}this._updateLayer(layer)};Style.prototype.setFilter=function setFilter(layerId,filter){this._checkLoaded();var layer=this.getLayer(layerId);if(!layer){this.fire("error",{error:new Error("The layer '"+layerId+"' does not exist in "+"the map's style and cannot be filtered.")});return}if(filter!==null&&filter!==undefined&&this._validate(validateStyle.filter,"layers."+layer.id+".filter",filter))return;if(util.deepEqual(layer.filter,filter))return;layer.filter=util.clone(filter);this._updateLayer(layer)};Style.prototype.getFilter=function getFilter(layer){return util.clone(this.getLayer(layer).filter)};Style.prototype.setLayoutProperty=function setLayoutProperty(layerId,name,value){this._checkLoaded();var layer=this.getLayer(layerId);if(!layer){this.fire("error",{error:new Error("The layer '"+layerId+"' does not exist in "+"the map's style and cannot be styled.")});return}if(util.deepEqual(layer.getLayoutProperty(name),value))return;layer.setLayoutProperty(name,value);this._updateLayer(layer)};Style.prototype.getLayoutProperty=function getLayoutProperty(layer,name){return this.getLayer(layer).getLayoutProperty(name)};Style.prototype.setPaintProperty=function setPaintProperty(layerId,name,value,klass){this._checkLoaded();var layer=this.getLayer(layerId);if(!layer){this.fire("error",{error:new Error("The layer '"+layerId+"' does not exist in "+"the map's style and cannot be styled.")});return}if(util.deepEqual(layer.getPaintProperty(name,klass),value))return;var wasFeatureConstant=layer.isPaintValueFeatureConstant(name);layer.setPaintProperty(name,value,klass);var isFeatureConstant=!(value&&MapboxGLFunction.isFunctionDefinition(value)&&value.property!=="$zoom"&&value.property!==undefined);if(!isFeatureConstant||!wasFeatureConstant){this._updateLayer(layer)}this.updateClasses(layerId,name)};Style.prototype.getPaintProperty=function getPaintProperty(layer,name,klass){return this.getLayer(layer).getPaintProperty(name,klass)};Style.prototype.getTransition=function getTransition(){return util.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)};Style.prototype.updateClasses=function updateClasses(layerId,paintName){this._changed=true;if(!layerId){this._updatedAllPaintProps=true}else{var props=this._updatedPaintProps;if(!props[layerId])props[layerId]={};props[layerId][paintName||"all"]=true}};Style.prototype.serialize=function serialize(){var this$1=this;return util.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:util.mapObject(this.sourceCaches,function(source){return source.serialize()}),layers:this._order.map(function(id){return this$1._layers[id].serialize()})},function(value){return value!==undefined})};Style.prototype._updateLayer=function _updateLayer(layer){this._updatedLayers[layer.id]=true;if(layer.source&&!this._updatedSources[layer.source]){this._updatedSources[layer.source]="reload"}this._changed=true};Style.prototype._flattenRenderedFeatures=function _flattenRenderedFeatures(sourceResults){var this$1=this;var features=[];for(var l=this._order.length-1;l>=0;l--){var layerId=this$1._order[l];for(var i=0,list=sourceResults;i<list.length;i+=1){var sourceResult=list[i];var layerFeatures=sourceResult[layerId];if(layerFeatures){for(var i$1=0,list$1=layerFeatures;i$1<list$1.length;i$1+=1){var feature=list$1[i$1];features.push(feature)}}}}return features};Style.prototype.queryRenderedFeatures=function queryRenderedFeatures(queryGeometry,params,zoom,bearing){var this$1=this;if(params&&params.filter){this._validate(validateStyle.filter,"queryRenderedFeatures.filter",params.filter)}var includedSources={};if(params&&params.layers){for(var i=0,list=params.layers;i<list.length;i+=1){var layerId=list[i];var layer=this$1._layers[layerId];if(!layer){this$1.fire("error",{error:"The layer '"+layerId+"' does not exist in the map's style and cannot be queried for features."});return}includedSources[layer.source]=true}}var sourceResults=[];for(var id in this.sourceCaches){if(params.layers&&!includedSources[id])continue;var results=QueryFeatures.rendered(this$1.sourceCaches[id],this$1._layers,queryGeometry,params,zoom,bearing);sourceResults.push(results)}return this._flattenRenderedFeatures(sourceResults)};Style.prototype.querySourceFeatures=function querySourceFeatures(sourceID,params){if(params&&params.filter){this._validate(validateStyle.filter,"querySourceFeatures.filter",params.filter)}var sourceCache=this.sourceCaches[sourceID];return sourceCache?QueryFeatures.source(sourceCache,params):[]};Style.prototype.addSourceType=function addSourceType(name,SourceType,callback){if(Source.getType(name)){return callback(new Error('A source type called "'+name+'" already exists.'))}Source.setType(name,SourceType);if(!SourceType.workerSourceURL){return callback(null,null)}this.dispatcher.broadcast("loadWorkerSource",{name:name,url:SourceType.workerSourceURL},callback)};Style.prototype.getLight=function getLight(){return this.light.getLight()};Style.prototype.setLight=function setLight(lightOptions,transitionOptions){this._checkLoaded();var light=this.light.getLight();var _update=false;for(var key in lightOptions){if(!util.deepEqual(lightOptions[key],light[key])){_update=true;break}}if(!_update)return;var transition=this.stylesheet.transition||{};this.light.setLight(lightOptions);this.light.updateLightTransitions(transitionOptions||{transition:true},transition,this.animationLoop)};Style.prototype._validate=function _validate(validate,key,value,props,options){if(options&&options.validate===false){return false}return validateStyle.emitErrors(this,validate.call(validateStyle,util.extend({key:key,style:this.serialize(),value:value,styleSpec:styleSpec},props)))};Style.prototype._remove=function _remove(){var this$1=this;for(var id in this.sourceCaches){this$1.sourceCaches[id].clearTiles()}this.dispatcher.remove()};Style.prototype._clearSource=function _clearSource(id){this.sourceCaches[id].clearTiles()};Style.prototype._reloadSource=function _reloadSource(id){this.sourceCaches[id].reload()};Style.prototype._updateSources=function _updateSources(transform){var this$1=this;for(var id in this.sourceCaches){this$1.sourceCaches[id].update(transform)}};Style.prototype._redoPlacement=function _redoPlacement(){var this$1=this;for(var id in this.sourceCaches){this$1.sourceCaches[id].redoPlacement()}};Style.prototype.getIcons=function getIcons(mapId,params,callback){var this$1=this;var updateSpriteAtlas=function(){this$1.spriteAtlas.setSprite(this$1.sprite);this$1.spriteAtlas.addIcons(params.icons,callback)};if(this.sprite.loaded()){updateSpriteAtlas()}else{this.sprite.on("data",updateSpriteAtlas)}};Style.prototype.getGlyphs=function getGlyphs(mapId,params,callback){var this$1=this;var stacks=params.stacks;var remaining=Object.keys(stacks).length;var allGlyphs={};for(var fontName in stacks){this$1.glyphSource.getSimpleGlyphs(fontName,stacks[fontName],params.uid,done)}function done(err,glyphs,fontName){if(err)console.error(err);allGlyphs[fontName]=glyphs;remaining--;if(remaining===0)callback(null,allGlyphs)}};return Style}(Evented);module.exports=Style},{"../global_worker_pool":618,"../render/line_atlas":631,"../source/query_features":642,"../source/source":644,"../source/source_cache":645,"../symbol/glyph_source":677,"../symbol/sprite_atlas":682,"../util/ajax":703,"../util/browser":704,"../util/dispatcher":710,"../util/evented":712,"../util/mapbox":719,"../util/util":723,"./animation_loop":653,"./image_sprite":654,"./light":655,"./style_layer":659,"./style_spec":666,"./validate_style":668,"mapbox-gl-function":567,"mapbox-gl-style-spec/lib/deref":568,"mapbox-gl-style-spec/lib/diff":569}],658:[function(require,module,exports){"use strict";var MapboxGLFunction=require("mapbox-gl-function");var parseColor=require("./parse_color");var util=require("../util/util");var StyleDeclaration=function StyleDeclaration(reference,value){var this$1=this;this.value=util.clone(value);this.isFunction=MapboxGLFunction.isFunctionDefinition(value);this.json=JSON.stringify(this.value);this.minimum=reference.minimum;this.isColor=reference.type==="color";var parsedValue=this.isColor&&this.value?parseColor(this.value):value;var specDefault=reference.default;if(specDefault&&reference.type==="color")specDefault=parseColor(specDefault);this.function=MapboxGLFunction[reference.function||"piecewise-constant"](parsedValue,specDefault);this.isFeatureConstant=this.function.isFeatureConstant;this.isZoomConstant=this.function.isZoomConstant;if(!this.isFeatureConstant&&!this.isZoomConstant){this.stopZoomLevels=[];var interpolationAmountStops=[];for(var i=0,list=this.value.stops;i<list.length;i+=1){var stop=list[i];var zoom=stop[0].zoom;if(this$1.stopZoomLevels.indexOf(zoom)<0){this$1.stopZoomLevels.push(zoom);interpolationAmountStops.push([zoom,interpolationAmountStops.length])}}this.functionInterpolationT=MapboxGLFunction.interpolated({stops:interpolationAmountStops,base:value.base,colorSpace:value.colorSpace})}};StyleDeclaration.prototype.calculate=function calculate(globalProperties,featureProperties){var value=this.function(globalProperties&&globalProperties.zoom,featureProperties||{});if(this.isColor&&value){return parseColor(value)}if(this.minimum!==undefined&&value<this.minimum){return this.minimum}return value};StyleDeclaration.prototype.calculateInterpolationT=function calculateInterpolationT(globalProperties,featureProperties){return this.functionInterpolationT(globalProperties&&globalProperties.zoom,featureProperties||{})};module.exports=StyleDeclaration},{"../util/util":723,"./parse_color":656,"mapbox-gl-function":567}],659:[function(require,module,exports){"use strict";var util=require("../util/util");var StyleTransition=require("./style_transition");var StyleDeclaration=require("./style_declaration");var styleSpec=require("./style_spec");var validateStyle=require("./validate_style");var parseColor=require("./parse_color");var Evented=require("../util/evented");var TRANSITION_SUFFIX="-transition";var StyleLayer=function(Evented){function StyleLayer(layer){var this$1=this;Evented.call(this);this.id=layer.id;this.metadata=layer.metadata;this.type=layer.type;this.source=layer.source;this.sourceLayer=layer["source-layer"];this.minzoom=layer.minzoom;this.maxzoom=layer.maxzoom;this.filter=layer.filter;this.paint={};this.layout={};this._paintSpecifications=styleSpec["paint_"+this.type];this._layoutSpecifications=styleSpec["layout_"+this.type];this._paintTransitions={};this._paintTransitionOptions={};this._paintDeclarations={};this._layoutDeclarations={};this._layoutFunctions={};var paintName,layoutName;var options={validate:false};for(var key in layer){var match=key.match(/^paint(?:\.(.*))?$/);if(match){var klass=match[1]||"";for(paintName in layer[key]){this$1.setPaintProperty(paintName,layer[key][paintName],klass,options)}}}for(layoutName in layer.layout){this$1.setLayoutProperty(layoutName,layer.layout[layoutName],options)}for(paintName in this._paintSpecifications){this$1.paint[paintName]=this$1.getPaintValue(paintName)}for(layoutName in this._layoutSpecifications){this$1._updateLayoutValue(layoutName)}}if(Evented)StyleLayer.__proto__=Evented;StyleLayer.prototype=Object.create(Evented&&Evented.prototype);StyleLayer.prototype.constructor=StyleLayer;StyleLayer.prototype.setLayoutProperty=function setLayoutProperty(name,value,options){if(value==null){delete this._layoutDeclarations[name]}else{var key="layers."+this.id+".layout."+name;if(this._validate(validateStyle.layoutProperty,key,name,value,options))return;this._layoutDeclarations[name]=new StyleDeclaration(this._layoutSpecifications[name],value)}this._updateLayoutValue(name)};StyleLayer.prototype.getLayoutProperty=function getLayoutProperty(name){return this._layoutDeclarations[name]&&this._layoutDeclarations[name].value};StyleLayer.prototype.getLayoutValue=function getLayoutValue(name,globalProperties,featureProperties){var specification=this._layoutSpecifications[name];var declaration=this._layoutDeclarations[name];if(declaration){return declaration.calculate(globalProperties,featureProperties)}else{return specification.default}};StyleLayer.prototype.setPaintProperty=function setPaintProperty(name,value,klass,options){var validateStyleKey="layers."+this.id+(klass?'["paint.'+klass+'"].':".paint.")+name;if(util.endsWith(name,TRANSITION_SUFFIX)){if(!this._paintTransitionOptions[klass||""]){this._paintTransitionOptions[klass||""]={}}if(value===null||value===undefined){delete this._paintTransitionOptions[klass||""][name]}else{if(this._validate(validateStyle.paintProperty,validateStyleKey,name,value,options))return;this._paintTransitionOptions[klass||""][name]=value}}else{if(!this._paintDeclarations[klass||""]){this._paintDeclarations[klass||""]={}}if(value===null||value===undefined){delete this._paintDeclarations[klass||""][name]}else{if(this._validate(validateStyle.paintProperty,validateStyleKey,name,value,options))return;this._paintDeclarations[klass||""][name]=new StyleDeclaration(this._paintSpecifications[name],value)}}};StyleLayer.prototype.getPaintProperty=function getPaintProperty(name,klass){klass=klass||"";if(util.endsWith(name,TRANSITION_SUFFIX)){return this._paintTransitionOptions[klass]&&this._paintTransitionOptions[klass][name]}else{return this._paintDeclarations[klass]&&this._paintDeclarations[klass][name]&&this._paintDeclarations[klass][name].value}};StyleLayer.prototype.getPaintValue=function getPaintValue(name,globalProperties,featureProperties){var specification=this._paintSpecifications[name];var transition=this._paintTransitions[name];if(transition){return transition.calculate(globalProperties,featureProperties)}else if(specification.type==="color"&&specification.default){return parseColor(specification.default)}else{return specification.default}};StyleLayer.prototype.getPaintValueStopZoomLevels=function getPaintValueStopZoomLevels(name){var transition=this._paintTransitions[name];if(transition){return transition.declaration.stopZoomLevels}else{return[]}};StyleLayer.prototype.getPaintInterpolationT=function getPaintInterpolationT(name,globalProperties){var transition=this._paintTransitions[name];return transition.declaration.calculateInterpolationT(globalProperties)};StyleLayer.prototype.isPaintValueFeatureConstant=function isPaintValueFeatureConstant(name){var transition=this._paintTransitions[name];if(transition){return transition.declaration.isFeatureConstant}else{return true}};StyleLayer.prototype.isLayoutValueFeatureConstant=function isLayoutValueFeatureConstant(name){var declaration=this._layoutDeclarations[name];if(declaration){return declaration.isFeatureConstant}else{return true}};StyleLayer.prototype.isPaintValueZoomConstant=function isPaintValueZoomConstant(name){var transition=this._paintTransitions[name];if(transition){return transition.declaration.isZoomConstant}else{return true}};StyleLayer.prototype.isHidden=function isHidden(zoom){if(this.minzoom&&zoom<this.minzoom)return true;if(this.maxzoom&&zoom>=this.maxzoom)return true;if(this.layout["visibility"]==="none")return true;return false};StyleLayer.prototype.updatePaintTransitions=function updatePaintTransitions(classes,options,globalOptions,animationLoop,zoomHistory){var this$1=this;var declarations=util.extend({},this._paintDeclarations[""]);for(var i=0;i<classes.length;i++){util.extend(declarations,this$1._paintDeclarations[classes[i]])}var name;for(name in declarations){this$1._applyPaintDeclaration(name,declarations[name],options,globalOptions,animationLoop,zoomHistory)}for(name in this._paintTransitions){if(!(name in declarations))this$1._applyPaintDeclaration(name,null,options,globalOptions,animationLoop,zoomHistory)}};StyleLayer.prototype.updatePaintTransition=function updatePaintTransition(name,classes,options,globalOptions,animationLoop,zoomHistory){var this$1=this;var declaration=this._paintDeclarations[""][name];for(var i=0;i<classes.length;i++){var classPaintDeclarations=this$1._paintDeclarations[classes[i]];if(classPaintDeclarations&&classPaintDeclarations[name]){declaration=classPaintDeclarations[name]}}this._applyPaintDeclaration(name,declaration,options,globalOptions,animationLoop,zoomHistory)};StyleLayer.prototype.recalculate=function recalculate(zoom){var this$1=this;for(var paintName in this._paintTransitions){this$1.paint[paintName]=this$1.getPaintValue(paintName,{zoom:zoom})}for(var layoutName in this._layoutFunctions){this$1.layout[layoutName]=this$1.getLayoutValue(layoutName,{zoom:zoom})}};StyleLayer.prototype.serialize=function serialize(){var this$1=this;var output={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:util.mapObject(this._layoutDeclarations,getDeclarationValue)};for(var klass in this._paintDeclarations){var key=klass===""?"paint":"paint."+klass;output[key]=util.mapObject(this$1._paintDeclarations[klass],getDeclarationValue)}return util.filterObject(output,function(value,key){return value!==undefined&&!(key==="layout"&&!Object.keys(value).length)})};StyleLayer.prototype._applyPaintDeclaration=function _applyPaintDeclaration(name,declaration,options,globalOptions,animationLoop,zoomHistory){var oldTransition=options.transition?this._paintTransitions[name]:undefined;var spec=this._paintSpecifications[name];if(declaration===null||declaration===undefined){declaration=new StyleDeclaration(spec,spec.default)}if(oldTransition&&oldTransition.declaration.json===declaration.json)return;var transitionOptions=util.extend({duration:300,delay:0},globalOptions,this.getPaintProperty(name+TRANSITION_SUFFIX));var newTransition=this._paintTransitions[name]=new StyleTransition(spec,declaration,oldTransition,transitionOptions,zoomHistory);if(!newTransition.instant()){newTransition.loopID=animationLoop.set(newTransition.endTime-Date.now())}if(oldTransition){animationLoop.cancel(oldTransition.loopID)}};StyleLayer.prototype._updateLayoutValue=function _updateLayoutValue(name){var declaration=this._layoutDeclarations[name];if(declaration&&declaration.isFunction){this._layoutFunctions[name]=true}else{delete this._layoutFunctions[name];this.layout[name]=this.getLayoutValue(name)}};StyleLayer.prototype._validate=function _validate(validate,key,name,value,options){if(options&&options.validate===false){return false}return validateStyle.emitErrors(this,validate.call(validateStyle,{key:key,layerType:this.type,objectKey:name,value:value,styleSpec:styleSpec,style:{glyphs:true,sprite:true}}))};return StyleLayer}(Evented);module.exports=StyleLayer;var subclasses={circle:require("./style_layer/circle_style_layer"),fill:require("./style_layer/fill_style_layer"),"fill-extrusion":require("./style_layer/fill_extrusion_style_layer"),line:require("./style_layer/line_style_layer"),symbol:require("./style_layer/symbol_style_layer")};StyleLayer.create=function(layer){var LayerClass=subclasses[layer.type]||StyleLayer;return new LayerClass(layer)};function getDeclarationValue(declaration){return declaration.value}},{"../util/evented":712,"../util/util":723,"./parse_color":656,"./style_declaration":658,"./style_layer/circle_style_layer":660,"./style_layer/fill_extrusion_style_layer":661,"./style_layer/fill_style_layer":662,"./style_layer/line_style_layer":663,"./style_layer/symbol_style_layer":664,"./style_spec":666,"./style_transition":667,"./validate_style":668}],660:[function(require,module,exports){"use strict";var StyleLayer=require("../style_layer");var CircleBucket=require("../../data/bucket/circle_bucket");var CircleStyleLayer=function(StyleLayer){function CircleStyleLayer(){StyleLayer.apply(this,arguments)}if(StyleLayer)CircleStyleLayer.__proto__=StyleLayer;CircleStyleLayer.prototype=Object.create(StyleLayer&&StyleLayer.prototype);CircleStyleLayer.prototype.constructor=CircleStyleLayer;CircleStyleLayer.prototype.createBucket=function createBucket(options){return new CircleBucket(options)};return CircleStyleLayer}(StyleLayer);module.exports=CircleStyleLayer},{"../../data/bucket/circle_bucket":599,"../style_layer":659}],661:[function(require,module,exports){"use strict";var StyleLayer=require("../style_layer");var FillExtrusionBucket=require("../../data/bucket/fill_extrusion_bucket");var FillExtrusionStyleLayer=function(StyleLayer){function FillExtrusionStyleLayer(){StyleLayer.apply(this,arguments)}if(StyleLayer)FillExtrusionStyleLayer.__proto__=StyleLayer;FillExtrusionStyleLayer.prototype=Object.create(StyleLayer&&StyleLayer.prototype);FillExtrusionStyleLayer.prototype.constructor=FillExtrusionStyleLayer;FillExtrusionStyleLayer.prototype.getPaintValue=function getPaintValue(name,globalProperties,featureProperties){var value=StyleLayer.prototype.getPaintValue.call(this,name,globalProperties,featureProperties);if(name==="fill-extrusion-color"&&value){value[3]=1}return value};FillExtrusionStyleLayer.prototype.createBucket=function createBucket(options){return new FillExtrusionBucket(options)};return FillExtrusionStyleLayer}(StyleLayer);module.exports=FillExtrusionStyleLayer},{"../../data/bucket/fill_extrusion_bucket":601,"../style_layer":659}],662:[function(require,module,exports){"use strict";var StyleLayer=require("../style_layer");var FillBucket=require("../../data/bucket/fill_bucket");var FillStyleLayer=function(StyleLayer){function FillStyleLayer(){StyleLayer.apply(this,arguments)}if(StyleLayer)FillStyleLayer.__proto__=StyleLayer;FillStyleLayer.prototype=Object.create(StyleLayer&&StyleLayer.prototype);FillStyleLayer.prototype.constructor=FillStyleLayer;FillStyleLayer.prototype.getPaintValue=function getPaintValue(name,globalProperties,featureProperties){if(name==="fill-outline-color"&&this.getPaintProperty("fill-outline-color")===undefined){return StyleLayer.prototype.getPaintValue.call(this,"fill-color",globalProperties,featureProperties)}else{return StyleLayer.prototype.getPaintValue.call(this,name,globalProperties,featureProperties)}};FillStyleLayer.prototype.getPaintValueStopZoomLevels=function getPaintValueStopZoomLevels(name){if(name==="fill-outline-color"&&this.getPaintProperty("fill-outline-color")===undefined){return StyleLayer.prototype.getPaintValueStopZoomLevels.call(this,"fill-color")}else{return StyleLayer.prototype.getPaintValueStopZoomLevels.call(this,name)}};FillStyleLayer.prototype.getPaintInterpolationT=function getPaintInterpolationT(name,globalProperties){if(name==="fill-outline-color"&&this.getPaintProperty("fill-outline-color")===undefined){return StyleLayer.prototype.getPaintInterpolationT.call(this,"fill-color",globalProperties)}else{return StyleLayer.prototype.getPaintInterpolationT.call(this,name,globalProperties)}};FillStyleLayer.prototype.isPaintValueFeatureConstant=function isPaintValueFeatureConstant(name){if(name==="fill-outline-color"&&this.getPaintProperty("fill-outline-color")===undefined){return StyleLayer.prototype.isPaintValueFeatureConstant.call(this,"fill-color")}else{return StyleLayer.prototype.isPaintValueFeatureConstant.call(this,name)}};FillStyleLayer.prototype.isPaintValueZoomConstant=function isPaintValueZoomConstant(name){if(name==="fill-outline-color"&&this.getPaintProperty("fill-outline-color")===undefined){return StyleLayer.prototype.isPaintValueZoomConstant.call(this,"fill-color")}else{return StyleLayer.prototype.isPaintValueZoomConstant.call(this,name)}};FillStyleLayer.prototype.createBucket=function createBucket(options){return new FillBucket(options)};return FillStyleLayer}(StyleLayer);module.exports=FillStyleLayer},{"../../data/bucket/fill_bucket":600,"../style_layer":659}],663:[function(require,module,exports){"use strict";var StyleLayer=require("../style_layer");var LineBucket=require("../../data/bucket/line_bucket");var util=require("../../util/util");var LineStyleLayer=function(StyleLayer){function LineStyleLayer(){StyleLayer.apply(this,arguments)}if(StyleLayer)LineStyleLayer.__proto__=StyleLayer;LineStyleLayer.prototype=Object.create(StyleLayer&&StyleLayer.prototype);LineStyleLayer.prototype.constructor=LineStyleLayer;LineStyleLayer.prototype.getPaintValue=function getPaintValue(name,globalProperties,featureProperties){var value=StyleLayer.prototype.getPaintValue.call(this,name,globalProperties,featureProperties);if(value&&name==="line-dasharray"){var width=this.getPaintValue("line-width",util.extend({},globalProperties,{zoom:Math.floor(globalProperties.zoom)}),featureProperties);value.fromScale*=width;value.toScale*=width}return value};LineStyleLayer.prototype.createBucket=function createBucket(options){
return new LineBucket(options)};return LineStyleLayer}(StyleLayer);module.exports=LineStyleLayer},{"../../data/bucket/line_bucket":602,"../../util/util":723,"../style_layer":659}],664:[function(require,module,exports){"use strict";var StyleLayer=require("../style_layer");var SymbolBucket=require("../../data/bucket/symbol_bucket");var SymbolStyleLayer=function(StyleLayer){function SymbolStyleLayer(){StyleLayer.apply(this,arguments)}if(StyleLayer)SymbolStyleLayer.__proto__=StyleLayer;SymbolStyleLayer.prototype=Object.create(StyleLayer&&StyleLayer.prototype);SymbolStyleLayer.prototype.constructor=SymbolStyleLayer;SymbolStyleLayer.prototype.getLayoutValue=function getLayoutValue(name,globalProperties,featureProperties){var value=StyleLayer.prototype.getLayoutValue.call(this,name,globalProperties,featureProperties);if(value!=="auto"){return value}switch(name){case"text-rotation-alignment":case"icon-rotation-alignment":return this.getLayoutValue("symbol-placement",globalProperties,featureProperties)==="line"?"map":"viewport";case"text-pitch-alignment":return this.getLayoutValue("text-rotation-alignment",globalProperties,featureProperties);default:return value}};SymbolStyleLayer.prototype.createBucket=function createBucket(options){return new SymbolBucket(options)};return SymbolStyleLayer}(StyleLayer);module.exports=SymbolStyleLayer},{"../../data/bucket/symbol_bucket":603,"../style_layer":659}],665:[function(require,module,exports){"use strict";var StyleLayer=require("./style_layer");var util=require("../util/util");var featureFilter=require("feature-filter");var groupByLayout=require("mapbox-gl-style-spec/lib/group_by_layout");var StyleLayerIndex=function StyleLayerIndex(layerConfigs){if(layerConfigs){this.replace(layerConfigs)}};StyleLayerIndex.prototype.replace=function replace(layerConfigs){var this$1=this;this.symbolOrder=[];for(var i=0,list=layerConfigs;i<list.length;i+=1){var layerConfig=list[i];if(layerConfig.type==="symbol"){this$1.symbolOrder.push(layerConfig.id)}}this._layerConfigs={};this._layers={};this.update(layerConfigs,[])};StyleLayerIndex.prototype.update=function update(layerConfigs,removedIds,symbolOrder){var this$1=this;for(var i=0,list=layerConfigs;i<list.length;i+=1){var layerConfig=list[i];this$1._layerConfigs[layerConfig.id]=layerConfig;var layer=this$1._layers[layerConfig.id]=StyleLayer.create(layerConfig);layer.updatePaintTransitions({},{transition:false});layer.filter=featureFilter(layer.filter)}for(var i$1=0,list$1=removedIds;i$1<list$1.length;i$1+=1){var id=list$1[i$1];delete this$1._layerConfigs[id];delete this$1._layers[id]}if(symbolOrder){this.symbolOrder=symbolOrder}this.familiesBySource={};var groups=groupByLayout(util.values(this._layerConfigs));for(var i$2=0,list$2=groups;i$2<list$2.length;i$2+=1){var layerConfigs$1=list$2[i$2];var layers=layerConfigs$1.map(function(layerConfig){return this$1._layers[layerConfig.id]});var layer$1=layers[0];if(layer$1.layout&&layer$1.layout.visibility==="none"){continue}var sourceId=layer$1.source||"";var sourceGroup=this$1.familiesBySource[sourceId];if(!sourceGroup){sourceGroup=this$1.familiesBySource[sourceId]={}}var sourceLayerId=layer$1.sourceLayer||"_geojsonTileLayer";var sourceLayerFamilies=sourceGroup[sourceLayerId];if(!sourceLayerFamilies){sourceLayerFamilies=sourceGroup[sourceLayerId]=[]}sourceLayerFamilies.push(layers)}};module.exports=StyleLayerIndex},{"../util/util":723,"./style_layer":659,"feature-filter":414,"mapbox-gl-style-spec/lib/group_by_layout":571}],666:[function(require,module,exports){"use strict";module.exports=require("mapbox-gl-style-spec/reference/latest.min")},{"mapbox-gl-style-spec/reference/latest.min":594}],667:[function(require,module,exports){"use strict";var util=require("../util/util");var interpolate=require("../util/interpolate");var fakeZoomHistory={lastIntegerZoom:0,lastIntegerZoomTime:0,lastZoom:0};var StyleTransition=function StyleTransition(reference,declaration,oldTransition,options,zoomHistory){this.declaration=declaration;this.startTime=this.endTime=(new Date).getTime();this.oldTransition=oldTransition;this.duration=options.duration||0;this.delay=options.delay||0;this.zoomTransitioned=reference.function==="piecewise-constant"&&reference.transition;this.interp=this.zoomTransitioned?interpZoomTransitioned:interpolate[reference.type];this.zoomHistory=zoomHistory||fakeZoomHistory;if(!this.instant()){this.endTime=this.startTime+this.duration+this.delay}if(oldTransition&&oldTransition.endTime<=this.startTime){delete oldTransition.oldTransition}};StyleTransition.prototype.instant=function instant(){return!this.oldTransition||!this.interp||this.duration===0&&this.delay===0};StyleTransition.prototype.calculate=function calculate(globalProperties,featureProperties,time){var value=this._calculateTargetValue(globalProperties,featureProperties);if(this.instant())return value;time=time||Date.now();if(time>=this.endTime)return value;var oldValue=this.oldTransition.calculate(globalProperties,featureProperties,this.startTime);var t=util.easeCubicInOut((time-this.startTime-this.delay)/this.duration);return this.interp(oldValue,value,t)};StyleTransition.prototype._calculateTargetValue=function _calculateTargetValue(globalProperties,featureProperties){if(!this.zoomTransitioned)return this.declaration.calculate(globalProperties,featureProperties);var z=globalProperties.zoom;var lastIntegerZoom=this.zoomHistory.lastIntegerZoom;var fromScale=z>lastIntegerZoom?2:.5;var from=this.declaration.calculate({zoom:z>lastIntegerZoom?z-1:z+1},featureProperties);var to=this.declaration.calculate({zoom:z},featureProperties);var timeFraction=Math.min((Date.now()-this.zoomHistory.lastIntegerZoomTime)/this.duration,1);var zoomFraction=Math.abs(z-lastIntegerZoom);var t=interpolate(timeFraction,1,zoomFraction);if(from===undefined||to===undefined)return undefined;return{from:from,fromScale:fromScale,to:to,toScale:1,t:t}};module.exports=StyleTransition;function interpZoomTransitioned(from,to,t){if(from===undefined||to===undefined)return undefined;return{from:from.to,fromScale:from.toScale,to:to.to,toScale:to.toScale,t:t}}},{"../util/interpolate":715,"../util/util":723}],668:[function(require,module,exports){"use strict";module.exports=require("mapbox-gl-style-spec/lib/validate_style.min");module.exports.emitErrors=function(emitter,errors){if(errors&&errors.length){for(var i=0;i<errors.length;i++){emitter.fire("error",{error:new Error(errors[i].message)})}return true}else{return false}}},{"mapbox-gl-style-spec/lib/validate_style.min":593}],669:[function(require,module,exports){"use strict";var Point=require("point-geometry");var Anchor=function(Point){function Anchor(x,y,angle,segment){Point.call(this,x,y);this.angle=angle;if(segment!==undefined){this.segment=segment}}if(Point)Anchor.__proto__=Point;Anchor.prototype=Object.create(Point&&Point.prototype);Anchor.prototype.constructor=Anchor;Anchor.prototype.clone=function clone(){return new Anchor(this.x,this.y,this.angle,this.segment)};return Anchor}(Point);module.exports=Anchor},{"point-geometry":769}],670:[function(require,module,exports){"use strict";module.exports=checkMaxAngle;function checkMaxAngle(line,anchor,labelLength,windowSize,maxAngle){if(anchor.segment===undefined)return true;var p=anchor;var index=anchor.segment+1;var anchorDistance=0;while(anchorDistance>-labelLength/2){index--;if(index<0)return false;anchorDistance-=line[index].dist(p);p=line[index]}anchorDistance+=line[index].dist(line[index+1]);index++;var recentCorners=[];var recentAngleDelta=0;while(anchorDistance<labelLength/2){var prev=line[index-1];var current=line[index];var next=line[index+1];if(!next)return false;var angleDelta=prev.angleTo(current)-current.angleTo(next);angleDelta=Math.abs((angleDelta+3*Math.PI)%(Math.PI*2)-Math.PI);recentCorners.push({distance:anchorDistance,angleDelta:angleDelta});recentAngleDelta+=angleDelta;while(anchorDistance-recentCorners[0].distance>windowSize){recentAngleDelta-=recentCorners.shift().angleDelta}if(recentAngleDelta>maxAngle)return false;index++;anchorDistance+=current.dist(next)}return true}},{}],671:[function(require,module,exports){"use strict";var Point=require("point-geometry");module.exports=clipLine;function clipLine(lines,x1,y1,x2,y2){var clippedLines=[];for(var l=0;l<lines.length;l++){var line=lines[l];var clippedLine;for(var i=0;i<line.length-1;i++){var p0=line[i];var p1=line[i+1];if(p0.x<x1&&p1.x<x1){continue}else if(p0.x<x1){p0=new Point(x1,p0.y+(p1.y-p0.y)*((x1-p0.x)/(p1.x-p0.x)))._round()}else if(p1.x<x1){p1=new Point(x1,p0.y+(p1.y-p0.y)*((x1-p0.x)/(p1.x-p0.x)))._round()}if(p0.y<y1&&p1.y<y1){continue}else if(p0.y<y1){p0=new Point(p0.x+(p1.x-p0.x)*((y1-p0.y)/(p1.y-p0.y)),y1)._round()}else if(p1.y<y1){p1=new Point(p0.x+(p1.x-p0.x)*((y1-p0.y)/(p1.y-p0.y)),y1)._round()}if(p0.x>=x2&&p1.x>=x2){continue}else if(p0.x>=x2){p0=new Point(x2,p0.y+(p1.y-p0.y)*((x2-p0.x)/(p1.x-p0.x)))._round()}else if(p1.x>=x2){p1=new Point(x2,p0.y+(p1.y-p0.y)*((x2-p0.x)/(p1.x-p0.x)))._round()}if(p0.y>=y2&&p1.y>=y2){continue}else if(p0.y>=y2){p0=new Point(p0.x+(p1.x-p0.x)*((y2-p0.y)/(p1.y-p0.y)),y2)._round()}else if(p1.y>=y2){p1=new Point(p0.x+(p1.x-p0.x)*((y2-p0.y)/(p1.y-p0.y)),y2)._round()}if(!clippedLine||!p0.equals(clippedLine[clippedLine.length-1])){clippedLine=[p0];clippedLines.push(clippedLine)}clippedLine.push(p1)}}return clippedLines}},{"point-geometry":769}],672:[function(require,module,exports){"use strict";var createStructArrayType=require("../util/struct_array");var Point=require("point-geometry");var CollisionBoxArray=createStructArrayType({members:[{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Float32",name:"maxScale"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"bbox0"},{type:"Int16",name:"bbox1"},{type:"Int16",name:"bbox2"},{type:"Int16",name:"bbox3"},{type:"Float32",name:"placementScale"}]});Object.defineProperty(CollisionBoxArray.prototype.StructType.prototype,"anchorPoint",{get:function get(){return new Point(this.anchorPointX,this.anchorPointY)}});module.exports=CollisionBoxArray},{"../util/struct_array":721,"point-geometry":769}],673:[function(require,module,exports){"use strict";var CollisionFeature=function CollisionFeature(collisionBoxArray,line,anchor,featureIndex,sourceLayerIndex,bucketIndex,shaped,boxScale,padding,alignLine,straight){var y1=shaped.top*boxScale-padding;var y2=shaped.bottom*boxScale+padding;var x1=shaped.left*boxScale-padding;var x2=shaped.right*boxScale+padding;this.boxStartIndex=collisionBoxArray.length;if(alignLine){var height=y2-y1;var length=x2-x1;if(height>0){height=Math.max(10*boxScale,height);if(straight){var vector=line[anchor.segment+1].sub(line[anchor.segment])._unit()._mult(length);var straightLine=[anchor.sub(vector),anchor.add(vector)];this._addLineCollisionBoxes(collisionBoxArray,straightLine,anchor,0,length,height,featureIndex,sourceLayerIndex,bucketIndex)}else{this._addLineCollisionBoxes(collisionBoxArray,line,anchor,anchor.segment,length,height,featureIndex,sourceLayerIndex,bucketIndex)}}}else{collisionBoxArray.emplaceBack(anchor.x,anchor.y,x1,y1,x2,y2,Infinity,featureIndex,sourceLayerIndex,bucketIndex,0,0,0,0,0)}this.boxEndIndex=collisionBoxArray.length};CollisionFeature.prototype._addLineCollisionBoxes=function _addLineCollisionBoxes(collisionBoxArray,line,anchor,segment,labelLength,boxSize,featureIndex,sourceLayerIndex,bucketIndex){var step=boxSize/2;var nBoxes=Math.floor(labelLength/step);var firstBoxOffset=-boxSize/2;var bboxes=this.boxes;var p=anchor;var index=segment+1;var anchorDistance=firstBoxOffset;do{index--;if(index<0)return bboxes;anchorDistance-=line[index].dist(p);p=line[index]}while(anchorDistance>-labelLength/2);var segmentLength=line[index].dist(line[index+1]);for(var i=0;i<nBoxes;i++){var boxDistanceToAnchor=-labelLength/2+i*step;while(anchorDistance+segmentLength<boxDistanceToAnchor){anchorDistance+=segmentLength;index++;if(index+1>=line.length)return bboxes;segmentLength=line[index].dist(line[index+1])}var segmentBoxDistance=boxDistanceToAnchor-anchorDistance;var p0=line[index];var p1=line[index+1];var boxAnchorPoint=p1.sub(p0)._unit()._mult(segmentBoxDistance)._add(p0)._round();var distanceToInnerEdge=Math.max(Math.abs(boxDistanceToAnchor-firstBoxOffset)-step/2,0);var maxScale=labelLength/2/distanceToInnerEdge;collisionBoxArray.emplaceBack(boxAnchorPoint.x,boxAnchorPoint.y,-boxSize/2,-boxSize/2,boxSize/2,boxSize/2,maxScale,featureIndex,sourceLayerIndex,bucketIndex,0,0,0,0,0)}return bboxes};module.exports=CollisionFeature},{}],674:[function(require,module,exports){"use strict";var Point=require("point-geometry");var EXTENT=require("../data/extent");var Grid=require("grid-index");var intersectionTests=require("../util/intersection_tests");var CollisionTile=function CollisionTile(angle,pitch,collisionBoxArray){if(typeof angle==="object"){var serialized=angle;collisionBoxArray=pitch;angle=serialized.angle;pitch=serialized.pitch;this.grid=new Grid(serialized.grid);this.ignoredGrid=new Grid(serialized.ignoredGrid)}else{this.grid=new Grid(EXTENT,12,6);this.ignoredGrid=new Grid(EXTENT,12,0)}this.minScale=.5;this.maxScale=2;this.angle=angle;this.pitch=pitch;var sin=Math.sin(angle),cos=Math.cos(angle);this.rotationMatrix=[cos,-sin,sin,cos];this.reverseRotationMatrix=[cos,sin,-sin,cos];this.yStretch=1/Math.cos(pitch/180*Math.PI);this.yStretch=Math.pow(this.yStretch,1.3);this.collisionBoxArray=collisionBoxArray;if(collisionBoxArray.length===0){collisionBoxArray.emplaceBack();var maxInt16=32767;collisionBoxArray.emplaceBack(0,0,0,-maxInt16,0,maxInt16,maxInt16,0,0,0,0,0,0,0,0,0);collisionBoxArray.emplaceBack(EXTENT,0,0,-maxInt16,0,maxInt16,maxInt16,0,0,0,0,0,0,0,0,0);collisionBoxArray.emplaceBack(0,0,-maxInt16,0,maxInt16,0,maxInt16,0,0,0,0,0,0,0,0,0);collisionBoxArray.emplaceBack(0,EXTENT,-maxInt16,0,maxInt16,0,maxInt16,0,0,0,0,0,0,0,0,0)}this.tempCollisionBox=collisionBoxArray.get(0);this.edges=[collisionBoxArray.get(1),collisionBoxArray.get(2),collisionBoxArray.get(3),collisionBoxArray.get(4)]};CollisionTile.prototype.serialize=function serialize(transferables){var grid=this.grid.toArrayBuffer();var ignoredGrid=this.ignoredGrid.toArrayBuffer();if(transferables){transferables.push(grid);transferables.push(ignoredGrid)}return{angle:this.angle,pitch:this.pitch,grid:grid,ignoredGrid:ignoredGrid}};CollisionTile.prototype.placeCollisionFeature=function placeCollisionFeature(collisionFeature,allowOverlap,avoidEdges){var this$1=this;var collisionBoxArray=this.collisionBoxArray;var minPlacementScale=this.minScale;var rotationMatrix=this.rotationMatrix;var yStretch=this.yStretch;for(var b=collisionFeature.boxStartIndex;b<collisionFeature.boxEndIndex;b++){var box=collisionBoxArray.get(b);var anchorPoint=box.anchorPoint._matMult(rotationMatrix);var x=anchorPoint.x;var y=anchorPoint.y;var x1=x+box.x1;var y1=y+box.y1*yStretch;var x2=x+box.x2;var y2=y+box.y2*yStretch;box.bbox0=x1;box.bbox1=y1;box.bbox2=x2;box.bbox3=y2;if(!allowOverlap){var blockingBoxes=this$1.grid.query(x1,y1,x2,y2);for(var i=0;i<blockingBoxes.length;i++){var blocking=collisionBoxArray.get(blockingBoxes[i]);var blockingAnchorPoint=blocking.anchorPoint._matMult(rotationMatrix);minPlacementScale=this$1.getPlacementScale(minPlacementScale,anchorPoint,box,blockingAnchorPoint,blocking);if(minPlacementScale>=this$1.maxScale){return minPlacementScale}}}if(avoidEdges){var rotatedCollisionBox;if(this$1.angle){var reverseRotationMatrix=this$1.reverseRotationMatrix;var tl=new Point(box.x1,box.y1).matMult(reverseRotationMatrix);var tr=new Point(box.x2,box.y1).matMult(reverseRotationMatrix);var bl=new Point(box.x1,box.y2).matMult(reverseRotationMatrix);var br=new Point(box.x2,box.y2).matMult(reverseRotationMatrix);rotatedCollisionBox=this$1.tempCollisionBox;rotatedCollisionBox.anchorPointX=box.anchorPoint.x;rotatedCollisionBox.anchorPointY=box.anchorPoint.y;rotatedCollisionBox.x1=Math.min(tl.x,tr.x,bl.x,br.x);rotatedCollisionBox.y1=Math.min(tl.y,tr.x,bl.x,br.x);rotatedCollisionBox.x2=Math.max(tl.x,tr.x,bl.x,br.x);rotatedCollisionBox.y2=Math.max(tl.y,tr.x,bl.x,br.x);rotatedCollisionBox.maxScale=box.maxScale}else{rotatedCollisionBox=box}for(var k=0;k<this.edges.length;k++){var edgeBox=this$1.edges[k];minPlacementScale=this$1.getPlacementScale(minPlacementScale,box.anchorPoint,rotatedCollisionBox,edgeBox.anchorPoint,edgeBox);if(minPlacementScale>=this$1.maxScale){return minPlacementScale}}}}return minPlacementScale};CollisionTile.prototype.queryRenderedSymbols=function queryRenderedSymbols(queryGeometry,scale){var sourceLayerFeatures={};var result=[];if(queryGeometry.length===0||this.grid.length===0&&this.ignoredGrid.length===0){return result}var collisionBoxArray=this.collisionBoxArray;var rotationMatrix=this.rotationMatrix;var yStretch=this.yStretch;var rotatedQuery=[];var minX=Infinity;var minY=Infinity;var maxX=-Infinity;var maxY=-Infinity;for(var i=0;i<queryGeometry.length;i++){var ring=queryGeometry[i];for(var k=0;k<ring.length;k++){var p=ring[k].matMult(rotationMatrix);minX=Math.min(minX,p.x);minY=Math.min(minY,p.y);maxX=Math.max(maxX,p.x);maxY=Math.max(maxY,p.y);rotatedQuery.push(p)}}var features=this.grid.query(minX,minY,maxX,maxY);var ignoredFeatures=this.ignoredGrid.query(minX,minY,maxX,maxY);for(var i$1=0;i$1<ignoredFeatures.length;i$1++){features.push(ignoredFeatures[i$1])}var roundedScale=Math.pow(2,Math.ceil(Math.log(scale)/Math.LN2*10)/10);for(var i$2=0;i$2<features.length;i$2++){var blocking=collisionBoxArray.get(features[i$2]);var sourceLayer=blocking.sourceLayerIndex;var featureIndex=blocking.featureIndex;if(sourceLayerFeatures[sourceLayer]===undefined){sourceLayerFeatures[sourceLayer]={}}if(sourceLayerFeatures[sourceLayer][featureIndex])continue;if(roundedScale<blocking.placementScale||roundedScale>blocking.maxScale)continue;var anchor=blocking.anchorPoint.matMult(rotationMatrix);var x1=anchor.x+blocking.x1/scale;var y1=anchor.y+blocking.y1/scale*yStretch;var x2=anchor.x+blocking.x2/scale;var y2=anchor.y+blocking.y2/scale*yStretch;var bbox=[new Point(x1,y1),new Point(x2,y1),new Point(x2,y2),new Point(x1,y2)];if(!intersectionTests.polygonIntersectsPolygon(rotatedQuery,bbox))continue;sourceLayerFeatures[sourceLayer][featureIndex]=true;result.push(features[i$2])}return result};CollisionTile.prototype.getPlacementScale=function getPlacementScale(minPlacementScale,anchorPoint,box,blockingAnchorPoint,blocking){var anchorDiffX=anchorPoint.x-blockingAnchorPoint.x;var anchorDiffY=anchorPoint.y-blockingAnchorPoint.y;var s1=(blocking.x1-box.x2)/anchorDiffX;var s2=(blocking.x2-box.x1)/anchorDiffX;var s3=(blocking.y1-box.y2)*this.yStretch/anchorDiffY;var s4=(blocking.y2-box.y1)*this.yStretch/anchorDiffY;if(isNaN(s1)||isNaN(s2))s1=s2=1;if(isNaN(s3)||isNaN(s4))s3=s4=1;var collisionFreeScale=Math.min(Math.max(s1,s2),Math.max(s3,s4));var blockingMaxScale=blocking.maxScale;var boxMaxScale=box.maxScale;if(collisionFreeScale>blockingMaxScale){collisionFreeScale=blockingMaxScale}if(collisionFreeScale>boxMaxScale){collisionFreeScale=boxMaxScale}if(collisionFreeScale>minPlacementScale&&collisionFreeScale>=blocking.placementScale){minPlacementScale=collisionFreeScale}return minPlacementScale};CollisionTile.prototype.insertCollisionFeature=function insertCollisionFeature(collisionFeature,minPlacementScale,ignorePlacement){var this$1=this;var grid=ignorePlacement?this.ignoredGrid:this.grid;var collisionBoxArray=this.collisionBoxArray;for(var k=collisionFeature.boxStartIndex;k<collisionFeature.boxEndIndex;k++){var box=collisionBoxArray.get(k);box.placementScale=minPlacementScale;if(minPlacementScale<this$1.maxScale){grid.insert(k,box.bbox0,box.bbox1,box.bbox2,box.bbox3)}}};module.exports=CollisionTile},{"../data/extent":607,"../util/intersection_tests":716,"grid-index":450,"point-geometry":769}],675:[function(require,module,exports){"use strict";var interpolate=require("../util/interpolate");var Anchor=require("../symbol/anchor");var checkMaxAngle=require("./check_max_angle");module.exports=getAnchors;function getAnchors(line,spacing,maxAngle,shapedText,shapedIcon,glyphSize,boxScale,overscaling,tileExtent){var angleWindowSize=shapedText?3/5*glyphSize*boxScale:0;var labelLength=Math.max(shapedText?shapedText.right-shapedText.left:0,shapedIcon?shapedIcon.right-shapedIcon.left:0);var isLineContinued=line[0].x===0||line[0].x===tileExtent||line[0].y===0||line[0].y===tileExtent;if(spacing-labelLength*boxScale<spacing/4){spacing=labelLength*boxScale+spacing/4}var fixedExtraOffset=glyphSize*2;var offset=!isLineContinued?(labelLength/2+fixedExtraOffset)*boxScale*overscaling%spacing:spacing/2*overscaling%spacing;return resample(line,offset,spacing,angleWindowSize,maxAngle,labelLength*boxScale,isLineContinued,false,tileExtent)}function resample(line,offset,spacing,angleWindowSize,maxAngle,labelLength,isLineContinued,placeAtMiddle,tileExtent){var halfLabelLength=labelLength/2;var lineLength=0;for(var k=0;k<line.length-1;k++){lineLength+=line[k].dist(line[k+1])}var distance=0,markedDistance=offset-spacing;var anchors=[];for(var i=0;i<line.length-1;i++){var a=line[i],b=line[i+1];var segmentDist=a.dist(b),angle=b.angleTo(a);while(markedDistance+spacing<distance+segmentDist){markedDistance+=spacing;var t=(markedDistance-distance)/segmentDist,x=interpolate(a.x,b.x,t),y=interpolate(a.y,b.y,t);if(x>=0&&x<tileExtent&&y>=0&&y<tileExtent&&markedDistance-halfLabelLength>=0&&markedDistance+halfLabelLength<=lineLength){var anchor=new Anchor(x,y,angle,i)._round();if(!angleWindowSize||checkMaxAngle(line,anchor,labelLength,angleWindowSize,maxAngle)){anchors.push(anchor)}}}distance+=segmentDist}if(!placeAtMiddle&&!anchors.length&&!isLineContinued){anchors=resample(line,distance/2,spacing,angleWindowSize,maxAngle,labelLength,isLineContinued,true,tileExtent)}return anchors}},{"../symbol/anchor":669,"../util/interpolate":715,"./check_max_angle":670}],676:[function(require,module,exports){"use strict";var ShelfPack=require("shelf-pack");var util=require("../util/util");var SIZE_GROWTH_RATE=4;var DEFAULT_SIZE=128;var MAX_SIZE=2048;var GlyphAtlas=function GlyphAtlas(){this.width=DEFAULT_SIZE;this.height=DEFAULT_SIZE;this.bin=new ShelfPack(this.width,this.height);this.index={};this.ids={};this.data=new Uint8Array(this.width*this.height)};GlyphAtlas.prototype.getGlyphs=function getGlyphs(){var glyphs={};var split,name,id;for(var key in this.ids){split=key.split("#");name=split[0];id=split[1];if(!glyphs[name])glyphs[name]=[];glyphs[name].push(id)}return glyphs};GlyphAtlas.prototype.getRects=function getRects(){var this$1=this;var rects={};var split,name,id;for(var key in this.ids){split=key.split("#");name=split[0];id=split[1];if(!rects[name])rects[name]={};rects[name][id]=this$1.index[key]}return rects};GlyphAtlas.prototype.addGlyph=function addGlyph(id,name,glyph,buffer){var this$1=this;if(!glyph)return null;var key=name+"#"+glyph.id;if(this.index[key]){if(this.ids[key].indexOf(id)<0){this.ids[key].push(id)}return this.index[key]}if(!glyph.bitmap){return null}var bufferedWidth=glyph.width+buffer*2;var bufferedHeight=glyph.height+buffer*2;var padding=1;var packWidth=bufferedWidth+2*padding;var packHeight=bufferedHeight+2*padding;packWidth+=4-packWidth%4;packHeight+=4-packHeight%4;var rect=this.bin.packOne(packWidth,packHeight);if(!rect){this.resize();rect=this.bin.packOne(packWidth,packHeight)}if(!rect){util.warnOnce("glyph bitmap overflow");return null}this.index[key]=rect;this.ids[key]=[id];var target=this.data;var source=glyph.bitmap;for(var y=0;y<bufferedHeight;y++){var y1=this$1.width*(rect.y+y+padding)+rect.x+padding;var y2=bufferedWidth*y;for(var x=0;x<bufferedWidth;x++){target[y1+x]=source[y2+x]}}this.dirty=true;return rect};GlyphAtlas.prototype.resize=function resize(){var this$1=this;var prevWidth=this.width;var prevHeight=this.height;if(prevWidth>=MAX_SIZE||prevHeight>=MAX_SIZE)return;if(this.texture){if(this.gl){this.gl.deleteTexture(this.texture)}this.texture=null}this.width*=SIZE_GROWTH_RATE;this.height*=SIZE_GROWTH_RATE;this.bin.resize(this.width,this.height);var buf=new ArrayBuffer(this.width*this.height);for(var i=0;i<prevHeight;i++){var src=new Uint8Array(this$1.data.buffer,prevHeight*i,prevWidth);var dst=new Uint8Array(buf,prevHeight*i*SIZE_GROWTH_RATE,prevWidth);dst.set(src)}this.data=new Uint8Array(buf)};GlyphAtlas.prototype.bind=function bind(gl){this.gl=gl;if(!this.texture){this.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texImage2D(gl.TEXTURE_2D,0,gl.ALPHA,this.width,this.height,0,gl.ALPHA,gl.UNSIGNED_BYTE,null)}else{gl.bindTexture(gl.TEXTURE_2D,this.texture)}};GlyphAtlas.prototype.updateTexture=function updateTexture(gl){this.bind(gl);if(this.dirty){gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,this.width,this.height,gl.ALPHA,gl.UNSIGNED_BYTE,this.data);this.dirty=false}};module.exports=GlyphAtlas},{"../util/util":723,"shelf-pack":968}],677:[function(require,module,exports){"use strict";var normalizeURL=require("../util/mapbox").normalizeGlyphsURL;var ajax=require("../util/ajax");var verticalizePunctuation=require("../util/verticalize_punctuation");var Glyphs=require("../util/glyphs");var GlyphAtlas=require("../symbol/glyph_atlas");var Protobuf=require("pbf");var SimpleGlyph=function SimpleGlyph(glyph,rect,buffer){var padding=1;this.advance=glyph.advance;this.left=glyph.left-buffer-padding;this.top=glyph.top+buffer+padding;this.rect=rect};var GlyphSource=function GlyphSource(url){this.url=url&&normalizeURL(url);this.atlases={};this.stacks={};this.loading={}};GlyphSource.prototype.getSimpleGlyphs=function getSimpleGlyphs(fontstack,glyphIDs,uid,callback){var this$1=this;if(this.stacks[fontstack]===undefined){this.stacks[fontstack]={}}if(this.atlases[fontstack]===undefined){this.atlases[fontstack]=new GlyphAtlas}var glyphs={};var stack=this.stacks[fontstack];var atlas=this.atlases[fontstack];var buffer=3;var missing={};var remaining=0;var getGlyph=function(glyphID){var range=Math.floor(glyphID/256);if(stack[range]){var glyph=stack[range].glyphs[glyphID];var rect=atlas.addGlyph(uid,fontstack,glyph,buffer);if(glyph)glyphs[glyphID]=new SimpleGlyph(glyph,rect,buffer)}else{if(missing[range]===undefined){missing[range]=[];remaining++}missing[range].push(glyphID)}};for(var i=0;i<glyphIDs.length;i++){var glyphID=glyphIDs[i];var string=String.fromCharCode(glyphID);getGlyph(glyphID);if(verticalizePunctuation.lookup[string]){getGlyph(verticalizePunctuation.lookup[string].charCodeAt(0))}}if(!remaining)callback(undefined,glyphs,fontstack);var onRangeLoaded=function(err,range,data){if(!err){var stack=this$1.stacks[fontstack][range]=data.stacks[0];for(var i=0;i<missing[range].length;i++){var glyphID=missing[range][i];var glyph=stack.glyphs[glyphID];var rect=atlas.addGlyph(uid,fontstack,glyph,buffer);if(glyph)glyphs[glyphID]=new SimpleGlyph(glyph,rect,buffer)}}remaining--;if(!remaining)callback(undefined,glyphs,fontstack)};for(var r in missing){this$1.loadRange(fontstack,r,onRangeLoaded)}};GlyphSource.prototype.loadRange=function loadRange(fontstack,range,callback){if(range*256>65535)return callback("glyphs > 65535 not supported");if(this.loading[fontstack]===undefined){this.loading[fontstack]={}}var loading=this.loading[fontstack];if(loading[range]){loading[range].push(callback)}else{loading[range]=[callback];var rangeName=range*256+"-"+(range*256+255);var url=glyphUrl(fontstack,rangeName,this.url);ajax.getArrayBuffer(url,function(err,data){var glyphs=!err&&new Glyphs(new Protobuf(data));for(var i=0;i<loading[range].length;i++){loading[range][i](err,range,glyphs)}delete loading[range]})}};GlyphSource.prototype.getGlyphAtlas=function getGlyphAtlas(fontstack){return this.atlases[fontstack]};function glyphUrl(fontstack,range,url,subdomains){subdomains=subdomains||"abc";return url.replace("{s}",subdomains[fontstack.length%subdomains.length]).replace("{fontstack}",fontstack).replace("{range}",range)}module.exports=GlyphSource},{"../symbol/glyph_atlas":676,"../util/ajax":703,"../util/glyphs":714,"../util/mapbox":719,"../util/verticalize_punctuation":725,pbf:747}],678:[function(require,module,exports){"use strict";module.exports=function(features){var leftIndex={};var rightIndex={};var mergedFeatures=[];var mergedIndex=0;function add(k){mergedFeatures.push(features[k]);mergedIndex++}function mergeFromRight(leftKey,rightKey,geom){var i=rightIndex[leftKey];delete rightIndex[leftKey];rightIndex[rightKey]=i;mergedFeatures[i].geometry[0].pop();mergedFeatures[i].geometry[0]=mergedFeatures[i].geometry[0].concat(geom[0]);return i}function mergeFromLeft(leftKey,rightKey,geom){var i=leftIndex[rightKey];delete leftIndex[rightKey];leftIndex[leftKey]=i;mergedFeatures[i].geometry[0].shift();mergedFeatures[i].geometry[0]=geom[0].concat(mergedFeatures[i].geometry[0]);return i}function getKey(text,geom,onRight){var point=onRight?geom[0][geom[0].length-1]:geom[0][0];return text+":"+point.x+":"+point.y}for(var k=0;k<features.length;k++){var feature=features[k];var geom=feature.geometry;var text=feature.text;if(!text){add(k);continue}var leftKey=getKey(text,geom),rightKey=getKey(text,geom,true);if(leftKey in rightIndex&&rightKey in leftIndex&&rightIndex[leftKey]!==leftIndex[rightKey]){var j=mergeFromLeft(leftKey,rightKey,geom);var i=mergeFromRight(leftKey,rightKey,mergedFeatures[j].geometry);delete leftIndex[leftKey];delete rightIndex[rightKey];rightIndex[getKey(text,mergedFeatures[i].geometry,true)]=i;mergedFeatures[j].geometry=null}else if(leftKey in rightIndex){mergeFromRight(leftKey,rightKey,geom)}else if(rightKey in leftIndex){mergeFromLeft(leftKey,rightKey,geom)}else{add(k);leftIndex[leftKey]=mergedIndex-1;rightIndex[rightKey]=mergedIndex-1}}return mergedFeatures.filter(function(f){return f.geometry})}},{}],679:[function(require,module,exports){"use strict";var Point=require("point-geometry");module.exports={getIconQuads:getIconQuads,getGlyphQuads:getGlyphQuads,SymbolQuad:SymbolQuad};var minScale=.5;function SymbolQuad(anchorPoint,tl,tr,bl,br,tex,anchorAngle,glyphAngle,minScale,maxScale,writingMode){this.anchorPoint=anchorPoint;this.tl=tl;this.tr=tr;this.bl=bl;this.br=br;this.tex=tex;this.anchorAngle=anchorAngle;this.glyphAngle=glyphAngle;this.minScale=minScale;this.maxScale=maxScale;this.writingMode=writingMode}function getIconQuads(anchor,shapedIcon,boxScale,line,layer,alongLine,shapedText,globalProperties,featureProperties){var rect=shapedIcon.image.rect;var layout=layer.layout;var border=1;var left=shapedIcon.left-border;var right=left+rect.w/shapedIcon.image.pixelRatio;var top=shapedIcon.top-border;var bottom=top+rect.h/shapedIcon.image.pixelRatio;var tl,tr,br,bl;if(layout["icon-text-fit"]!=="none"&&shapedText){var iconWidth=right-left,iconHeight=bottom-top,size=layout["text-size"]/24,textLeft=shapedText.left*size,textRight=shapedText.right*size,textTop=shapedText.top*size,textBottom=shapedText.bottom*size,textWidth=textRight-textLeft,textHeight=textBottom-textTop,padT=layout["icon-text-fit-padding"][0],padR=layout["icon-text-fit-padding"][1],padB=layout["icon-text-fit-padding"][2],padL=layout["icon-text-fit-padding"][3],offsetY=layout["icon-text-fit"]==="width"?(textHeight-iconHeight)*.5:0,offsetX=layout["icon-text-fit"]==="height"?(textWidth-iconWidth)*.5:0,width=layout["icon-text-fit"]==="width"||layout["icon-text-fit"]==="both"?textWidth:iconWidth,height=layout["icon-text-fit"]==="height"||layout["icon-text-fit"]==="both"?textHeight:iconHeight;tl=new Point(textLeft+offsetX-padL,textTop+offsetY-padT);tr=new Point(textLeft+offsetX+padR+width,textTop+offsetY-padT);br=new Point(textLeft+offsetX+padR+width,textTop+offsetY+padB+height);bl=new Point(textLeft+offsetX-padL,textTop+offsetY+padB+height)}else{tl=new Point(left,top);
tr=new Point(right,top);br=new Point(right,bottom);bl=new Point(left,bottom)}var angle=layer.getLayoutValue("icon-rotate",globalProperties,featureProperties)*Math.PI/180;if(alongLine){var prev=line[anchor.segment];if(anchor.y===prev.y&&anchor.x===prev.x&&anchor.segment+1<line.length){var next=line[anchor.segment+1];angle+=Math.atan2(anchor.y-next.y,anchor.x-next.x)+Math.PI}else{angle+=Math.atan2(anchor.y-prev.y,anchor.x-prev.x)}}if(angle){var sin=Math.sin(angle),cos=Math.cos(angle),matrix=[cos,-sin,sin,cos];tl=tl.matMult(matrix);tr=tr.matMult(matrix);bl=bl.matMult(matrix);br=br.matMult(matrix)}return[new SymbolQuad(new Point(anchor.x,anchor.y),tl,tr,bl,br,shapedIcon.image.rect,0,0,minScale,Infinity)]}function getGlyphQuads(anchor,shaping,boxScale,line,layer,alongLine){var textRotate=layer.layout["text-rotate"]*Math.PI/180;var keepUpright=layer.layout["text-keep-upright"];var positionedGlyphs=shaping.positionedGlyphs;var quads=[];for(var k=0;k<positionedGlyphs.length;k++){var positionedGlyph=positionedGlyphs[k];var glyph=positionedGlyph.glyph;if(!glyph)continue;var rect=glyph.rect;if(!rect)continue;var centerX=(positionedGlyph.x+glyph.advance/2)*boxScale;var glyphInstances;var labelMinScale=minScale;if(alongLine){glyphInstances=[];labelMinScale=getSegmentGlyphs(glyphInstances,anchor,centerX,line,anchor.segment,true);if(keepUpright){labelMinScale=Math.min(labelMinScale,getSegmentGlyphs(glyphInstances,anchor,centerX,line,anchor.segment,false))}}else{glyphInstances=[{anchorPoint:new Point(anchor.x,anchor.y),offset:0,angle:0,maxScale:Infinity,minScale:minScale}]}var x1=positionedGlyph.x+glyph.left;var y1=positionedGlyph.y-glyph.top;var x2=x1+rect.w;var y2=y1+rect.h;var center=new Point(positionedGlyph.x,glyph.advance/2);var otl=new Point(x1,y1);var otr=new Point(x2,y1);var obl=new Point(x1,y2);var obr=new Point(x2,y2);if(positionedGlyph.angle!==0){otl._sub(center)._rotate(positionedGlyph.angle)._add(center);otr._sub(center)._rotate(positionedGlyph.angle)._add(center);obl._sub(center)._rotate(positionedGlyph.angle)._add(center);obr._sub(center)._rotate(positionedGlyph.angle)._add(center)}for(var i=0;i<glyphInstances.length;i++){var instance=glyphInstances[i];var tl=otl,tr=otr,bl=obl,br=obr;if(textRotate){var sin=Math.sin(textRotate),cos=Math.cos(textRotate),matrix=[cos,-sin,sin,cos];tl=tl.matMult(matrix);tr=tr.matMult(matrix);bl=bl.matMult(matrix);br=br.matMult(matrix)}var glyphMinScale=Math.max(instance.minScale,labelMinScale);var anchorAngle=(anchor.angle+instance.offset+2*Math.PI)%(2*Math.PI);var glyphAngle=(instance.angle+instance.offset+2*Math.PI)%(2*Math.PI);quads.push(new SymbolQuad(instance.anchorPoint,tl,tr,bl,br,rect,anchorAngle,glyphAngle,glyphMinScale,instance.maxScale,shaping.writingMode))}}return quads}function getSegmentGlyphs(glyphs,anchor,offset,line,segment,forward){var upsideDown=!forward;if(offset<0)forward=!forward;if(forward)segment++;var newAnchorPoint=new Point(anchor.x,anchor.y);var end=line[segment];var prevScale=Infinity;offset=Math.abs(offset);var placementScale=minScale;while(true){var distance=newAnchorPoint.dist(end);var scale=offset/distance;var angle=Math.atan2(end.y-newAnchorPoint.y,end.x-newAnchorPoint.x);if(!forward)angle+=Math.PI;glyphs.push({anchorPoint:newAnchorPoint,offset:upsideDown?Math.PI:0,minScale:scale,maxScale:prevScale,angle:(angle+2*Math.PI)%(2*Math.PI)});if(scale<=placementScale)break;newAnchorPoint=end;while(newAnchorPoint.equals(end)){segment+=forward?1:-1;end=line[segment];if(!end){return scale}}var unit=end.sub(newAnchorPoint)._unit();newAnchorPoint=newAnchorPoint.sub(unit._mult(distance));prevScale=scale}return placementScale}},{"point-geometry":769}],680:[function(require,module,exports){"use strict";var resolveTokens=require("../util/token");module.exports=function resolveText(feature,layout){var text=resolveTokens(feature.properties,layout["text-field"]);if(!text){return}text=text.toString();var transform=layout["text-transform"];if(transform==="uppercase"){text=text.toLocaleUpperCase()}else if(transform==="lowercase"){text=text.toLocaleLowerCase()}return text}},{"../util/token":722}],681:[function(require,module,exports){"use strict";var scriptDetection=require("../util/script_detection");var verticalizePunctuation=require("../util/verticalize_punctuation");var WritingMode={horizontal:1,vertical:2};module.exports={shapeText:shapeText,shapeIcon:shapeIcon,WritingMode:WritingMode};function PositionedGlyph(codePoint,x,y,glyph,angle){this.codePoint=codePoint;this.x=x;this.y=y;this.glyph=glyph||null;this.angle=angle}function Shaping(positionedGlyphs,text,top,bottom,left,right,writingMode){this.positionedGlyphs=positionedGlyphs;this.text=text;this.top=top;this.bottom=bottom;this.left=left;this.right=right;this.writingMode=writingMode}var newLine=10;function breakLines(text,lineBreakPoints){var lines=[];var start=0;for(var i=0,list=lineBreakPoints;i<list.length;i+=1){var lineBreak=list[i];lines.push(text.substring(start,lineBreak));start=lineBreak}if(start<text.length){lines.push(text.substring(start,text.length))}return lines}function shapeText(text,glyphs,maxWidth,lineHeight,horizontalAlign,verticalAlign,justify,spacing,translate,verticalHeight,writingMode){text=text.trim();if(writingMode===WritingMode.vertical)text=verticalizePunctuation(text);var positionedGlyphs=[];var shaping=new Shaping(positionedGlyphs,text,translate[1],translate[1],translate[0],translate[0],writingMode);var lines=writingMode===WritingMode.horizontal&&maxWidth?breakLines(text,determineLineBreaks(text,spacing,maxWidth,glyphs)):[text];shapeLines(shaping,glyphs,lines,lineHeight,horizontalAlign,verticalAlign,justify,translate,writingMode,spacing,verticalHeight);if(!positionedGlyphs.length)return false;return shaping}var whitespace={9:true,10:true,11:true,12:true,13:true,32:true};var breakable={32:true,38:true,40:true,41:true,43:true,45:true,47:true,173:true,183:true,8203:true,8208:true,8211:true,8231:true};breakable[newLine]=true;function determineAverageLineWidth(logicalInput,spacing,maxWidth,glyphs){var totalWidth=0;for(var index in logicalInput){var glyph=glyphs[logicalInput.charCodeAt(index)];if(!glyph)continue;totalWidth+=glyph.advance+spacing}var lineCount=Math.max(1,Math.ceil(totalWidth/maxWidth));return totalWidth/lineCount}function calculateBadness(lineWidth,targetWidth,penalty,isLastBreak){var raggedness=Math.pow(lineWidth-targetWidth,2);if(isLastBreak){if(lineWidth<targetWidth){return raggedness/2}else{return raggedness*2}}return raggedness+Math.abs(penalty)*penalty}function calculatePenalty(codePoint,nextCodePoint){var penalty=0;if(codePoint===10){penalty-=1e4}if(codePoint===40||codePoint===65288){penalty+=50}if(nextCodePoint===41||nextCodePoint===65289){penalty+=50}return penalty}function evaluateBreak(breakIndex,breakX,targetWidth,potentialBreaks,penalty,isLastBreak){var bestPriorBreak=null;var bestBreakBadness=calculateBadness(breakX,targetWidth,penalty,isLastBreak);for(var i=0,list=potentialBreaks;i<list.length;i+=1){var potentialBreak=list[i];var lineWidth=breakX-potentialBreak.x;var breakBadness=calculateBadness(lineWidth,targetWidth,penalty,isLastBreak)+potentialBreak.badness;if(breakBadness<=bestBreakBadness){bestPriorBreak=potentialBreak;bestBreakBadness=breakBadness}}return{index:breakIndex,x:breakX,priorBreak:bestPriorBreak,badness:bestBreakBadness}}function leastBadBreaks(lastLineBreak){if(!lastLineBreak){return[]}return leastBadBreaks(lastLineBreak.priorBreak).concat(lastLineBreak.index)}function determineLineBreaks(logicalInput,spacing,maxWidth,glyphs){if(!maxWidth)return[];if(!logicalInput)return[];var potentialLineBreaks=[];var targetWidth=determineAverageLineWidth(logicalInput,spacing,maxWidth,glyphs);var currentX=0;for(var i=0;i<logicalInput.length;i++){var codePoint=logicalInput.charCodeAt(i);var glyph=glyphs[codePoint];if(glyph&&!whitespace[codePoint])currentX+=glyph.advance+spacing;if(i<logicalInput.length-1&&(breakable[codePoint]||scriptDetection.charAllowsIdeographicBreaking(codePoint))){potentialLineBreaks.push(evaluateBreak(i+1,currentX,targetWidth,potentialLineBreaks,calculatePenalty(codePoint,logicalInput.charCodeAt(i+1)),false))}}return leastBadBreaks(evaluateBreak(logicalInput.length,currentX,targetWidth,potentialLineBreaks,0,true))}function shapeLines(shaping,glyphs,lines,lineHeight,horizontalAlign,verticalAlign,justify,translate,writingMode,spacing,verticalHeight){var yOffset=-17;var x=0;var y=yOffset;var maxLineLength=0;var positionedGlyphs=shaping.positionedGlyphs;for(var i in lines){var line=lines[i].trim();if(!line.length){y+=lineHeight;continue}var lineStartIndex=positionedGlyphs.length;for(var i$1=0;i$1<line.length;i$1++){var codePoint=line.charCodeAt(i$1);var glyph=glyphs[codePoint];if(!glyph)continue;if(!scriptDetection.charHasUprightVerticalOrientation(codePoint)||writingMode===WritingMode.horizontal){positionedGlyphs.push(new PositionedGlyph(codePoint,x,y,glyph,0));x+=glyph.advance+spacing}else{positionedGlyphs.push(new PositionedGlyph(codePoint,x,0,glyph,-Math.PI/2));x+=verticalHeight+spacing}}if(positionedGlyphs.length!==lineStartIndex){var lineLength=x-spacing;maxLineLength=Math.max(lineLength,maxLineLength);justifyLine(positionedGlyphs,glyphs,lineStartIndex,positionedGlyphs.length-1,justify)}x=0;y+=lineHeight}align(positionedGlyphs,justify,horizontalAlign,verticalAlign,maxLineLength,lineHeight,lines.length,translate);var height=lines.length*lineHeight;shaping.top+=-verticalAlign*height;shaping.bottom=shaping.top+height;shaping.left+=-horizontalAlign*maxLineLength;shaping.right=shaping.left+maxLineLength}function justifyLine(positionedGlyphs,glyphs,start,end,justify){if(!justify)return;var lastAdvance=glyphs[positionedGlyphs[end].codePoint].advance;var lineIndent=(positionedGlyphs[end].x+lastAdvance)*justify;for(var j=start;j<=end;j++){positionedGlyphs[j].x-=lineIndent}}function align(positionedGlyphs,justify,horizontalAlign,verticalAlign,maxLineLength,lineHeight,lineCount,translate){var shiftX=(justify-horizontalAlign)*maxLineLength+translate[0];var shiftY=(-verticalAlign*lineCount+.5)*lineHeight+translate[1];for(var j=0;j<positionedGlyphs.length;j++){positionedGlyphs[j].x+=shiftX;positionedGlyphs[j].y+=shiftY}}function shapeIcon(image,iconOffset){if(!image||!image.rect)return null;var dx=iconOffset[0];var dy=iconOffset[1];var x1=dx-image.width/2;var x2=x1+image.width;var y1=dy-image.height/2;var y2=y1+image.height;return new PositionedIcon(image,y1,y2,x1,x2)}function PositionedIcon(image,top,bottom,left,right){this.image=image;this.top=top;this.bottom=bottom;this.left=left;this.right=right}},{"../util/script_detection":720,"../util/verticalize_punctuation":725}],682:[function(require,module,exports){"use strict";var ShelfPack=require("shelf-pack");var browser=require("../util/browser");var util=require("../util/util");var AtlasImage=function AtlasImage(rect,width,height,sdf,pixelRatio){this.rect=rect;this.width=width;this.height=height;this.sdf=sdf;this.pixelRatio=pixelRatio};var SpriteAtlas=function SpriteAtlas(width,height){this.width=width;this.height=height;this.bin=new ShelfPack(width,height);this.images={};this.data=false;this.texture=0;this.filter=0;this.pixelRatio=1;this.dirty=true};SpriteAtlas.prototype.allocateImage=function allocateImage(pixelWidth,pixelHeight){pixelWidth=pixelWidth/this.pixelRatio;pixelHeight=pixelHeight/this.pixelRatio;var padding=2;var packWidth=pixelWidth+padding+(4-(pixelWidth+padding)%4);var packHeight=pixelHeight+padding+(4-(pixelHeight+padding)%4);var rect=this.bin.packOne(packWidth,packHeight);if(!rect){util.warnOnce("SpriteAtlas out of space.");return null}return rect};SpriteAtlas.prototype.getImage=function getImage(name,wrap){if(this.images[name]){return this.images[name]}if(!this.sprite){return null}var pos=this.sprite.getSpritePosition(name);if(!pos.width||!pos.height){return null}var rect=this.allocateImage(pos.width,pos.height);if(!rect){return null}var image=new AtlasImage(rect,pos.width/pos.pixelRatio,pos.height/pos.pixelRatio,pos.sdf,pos.pixelRatio/this.pixelRatio);this.images[name]=image;this.copy(rect,pos,wrap);return image};SpriteAtlas.prototype.getPosition=function getPosition(name,repeating){var image=this.getImage(name,repeating);var rect=image&&image.rect;if(!rect){return null}var width=image.width*image.pixelRatio;var height=image.height*image.pixelRatio;var padding=1;return{size:[image.width,image.height],tl:[(rect.x+padding)/this.width,(rect.y+padding)/this.height],br:[(rect.x+padding+width)/this.width,(rect.y+padding+height)/this.height]}};SpriteAtlas.prototype.allocate=function allocate(){var this$1=this;if(!this.data){var w=Math.floor(this.width*this.pixelRatio);var h=Math.floor(this.height*this.pixelRatio);this.data=new Uint32Array(w*h);for(var i=0;i<this.data.length;i++){this$1.data[i]=0}}};SpriteAtlas.prototype.copy=function copy(dst,src,wrap){if(!this.sprite.imgData)return;var srcImg=new Uint32Array(this.sprite.imgData.buffer);this.allocate();var dstImg=this.data;var padding=1;copyBitmap(srcImg,this.sprite.width,src.x,src.y,dstImg,this.width*this.pixelRatio,(dst.x+padding)*this.pixelRatio,(dst.y+padding)*this.pixelRatio,src.width,src.height,wrap);this.dirty=true};SpriteAtlas.prototype.setSprite=function setSprite(sprite){if(sprite){this.pixelRatio=browser.devicePixelRatio>1?2:1;if(this.canvas){this.canvas.width=this.width*this.pixelRatio;this.canvas.height=this.height*this.pixelRatio}}this.sprite=sprite};SpriteAtlas.prototype.addIcons=function addIcons(icons,callback){var this$1=this;for(var i=0;i<icons.length;i++){this$1.getImage(icons[i])}callback(null,this.images)};SpriteAtlas.prototype.bind=function bind(gl,linear){var first=false;if(!this.texture){this.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);first=true}else{gl.bindTexture(gl.TEXTURE_2D,this.texture)}var filterVal=linear?gl.LINEAR:gl.NEAREST;if(filterVal!==this.filter){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,filterVal);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,filterVal);this.filter=filterVal}if(this.dirty){this.allocate();if(first){gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.width*this.pixelRatio,this.height*this.pixelRatio,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(this.data.buffer))}else{gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,this.width*this.pixelRatio,this.height*this.pixelRatio,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(this.data.buffer))}this.dirty=false}};module.exports=SpriteAtlas;function copyBitmap(src,srcStride,srcX,srcY,dst,dstStride,dstX,dstY,width,height,wrap){var srcI=srcY*srcStride+srcX;var dstI=dstY*dstStride+dstX;var x,y;if(wrap){dstI-=dstStride;for(y=-1;y<=height;y++,srcI=((y+height)%height+srcY)*srcStride+srcX,dstI+=dstStride){for(x=-1;x<=width;x++){dst[dstI+x]=src[srcI+(x+width)%width]}}}else{for(y=0;y<height;y++,srcI+=srcStride,dstI+=dstStride){for(x=0;x<width;x++){dst[dstI+x]=src[srcI+x]}}}}},{"../util/browser":704,"../util/util":723,"shelf-pack":968}],683:[function(require,module,exports){"use strict";var createStructArrayType=require("../util/struct_array");var Point=require("point-geometry");var SymbolInstancesArray=createStructArrayType({members:[{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"glyphQuadStartIndex"},{type:"Uint16",name:"glyphQuadEndIndex"},{type:"Uint16",name:"iconQuadStartIndex"},{type:"Uint16",name:"iconQuadEndIndex"},{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int8",name:"index"},{type:"Uint8",name:"writingModes"}]});Object.defineProperty(SymbolInstancesArray.prototype.StructType.prototype,"anchorPoint",{get:function get(){return new Point(this.anchorPointX,this.anchorPointY)}});module.exports=SymbolInstancesArray},{"../util/struct_array":721,"point-geometry":769}],684:[function(require,module,exports){"use strict";var createStructArrayType=require("../util/struct_array");var Point=require("point-geometry");var SymbolQuad=require("./quads").SymbolQuad;var SymbolQuadsArray=createStructArrayType({members:[{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"tlX"},{type:"Float32",name:"tlY"},{type:"Float32",name:"trX"},{type:"Float32",name:"trY"},{type:"Float32",name:"blX"},{type:"Float32",name:"blY"},{type:"Float32",name:"brX"},{type:"Float32",name:"brY"},{type:"Int16",name:"texH"},{type:"Int16",name:"texW"},{type:"Int16",name:"texX"},{type:"Int16",name:"texY"},{type:"Float32",name:"anchorAngle"},{type:"Float32",name:"glyphAngle"},{type:"Float32",name:"maxScale"},{type:"Float32",name:"minScale"},{type:"Uint8",name:"writingMode"}]});Object.defineProperty(SymbolQuadsArray.prototype.StructType.prototype,"anchorPoint",{get:function get(){return new Point(this.anchorPointX,this.anchorPointY)}});Object.defineProperty(SymbolQuadsArray.prototype.StructType.prototype,"SymbolQuad",{get:function get$1(){return new SymbolQuad(this.anchorPoint,new Point(this.tlX,this.tlY),new Point(this.trX,this.trY),new Point(this.blX,this.blY),new Point(this.brX,this.brY),{x:this.texX,y:this.texY,h:this.texH,w:this.texW,height:this.texH,width:this.texW},this.anchorAngle,this.glyphAngle,this.minScale,this.maxScale,this.writingMode)}});module.exports=SymbolQuadsArray},{"../util/struct_array":721,"./quads":679,"point-geometry":769}],685:[function(require,module,exports){"use strict";var DOM=require("../util/dom");var Point=require("point-geometry");var handlers={scrollZoom:require("./handler/scroll_zoom"),boxZoom:require("./handler/box_zoom"),dragRotate:require("./handler/drag_rotate"),dragPan:require("./handler/drag_pan"),keyboard:require("./handler/keyboard"),doubleClickZoom:require("./handler/dblclick_zoom"),touchZoomRotate:require("./handler/touch_zoom_rotate")};module.exports=function bindHandlers(map,options){var el=map.getCanvasContainer();var contextMenuEvent=null;var mouseDown=false;var startPos=null;var tapped=null;for(var name in handlers){map[name]=new handlers[name](map,options);if(options.interactive&&options[name]){map[name].enable()}}el.addEventListener("mouseout",onMouseOut,false);el.addEventListener("mousedown",onMouseDown,false);el.addEventListener("mouseup",onMouseUp,false);el.addEventListener("mousemove",onMouseMove,false);el.addEventListener("touchstart",onTouchStart,false);el.addEventListener("touchend",onTouchEnd,false);el.addEventListener("touchmove",onTouchMove,false);el.addEventListener("touchcancel",onTouchCancel,false);el.addEventListener("click",onClick,false);el.addEventListener("dblclick",onDblClick,false);el.addEventListener("contextmenu",onContextMenu,false);function onMouseOut(e){fireMouseEvent("mouseout",e)}function onMouseDown(e){map.stop();startPos=DOM.mousePos(el,e);fireMouseEvent("mousedown",e);mouseDown=true}function onMouseUp(e){var rotating=map.dragRotate&&map.dragRotate.isActive();if(contextMenuEvent&&!rotating){fireMouseEvent("contextmenu",contextMenuEvent)}contextMenuEvent=null;mouseDown=false;fireMouseEvent("mouseup",e)}function onMouseMove(e){if(map.dragPan&&map.dragPan.isActive())return;if(map.dragRotate&&map.dragRotate.isActive())return;var target=e.toElement||e.target;while(target&&target!==el)target=target.parentNode;if(target!==el)return;fireMouseEvent("mousemove",e)}function onTouchStart(e){map.stop();fireTouchEvent("touchstart",e);if(!e.touches||e.touches.length>1)return;if(!tapped){tapped=setTimeout(onTouchTimeout,300)}else{clearTimeout(tapped);tapped=null;fireMouseEvent("dblclick",e)}}function onTouchMove(e){fireTouchEvent("touchmove",e)}function onTouchEnd(e){fireTouchEvent("touchend",e)}function onTouchCancel(e){fireTouchEvent("touchcancel",e)}function onTouchTimeout(){tapped=null}function onClick(e){var pos=DOM.mousePos(el,e);if(pos.equals(startPos)){fireMouseEvent("click",e)}}function onDblClick(e){fireMouseEvent("dblclick",e);e.preventDefault()}function onContextMenu(e){var rotating=map.dragRotate&&map.dragRotate.isActive();if(!mouseDown&&!rotating){fireMouseEvent("contextmenu",e)}else if(mouseDown){contextMenuEvent=e}e.preventDefault()}function fireMouseEvent(type,e){var pos=DOM.mousePos(el,e);return map.fire(type,{lngLat:map.unproject(pos),point:pos,originalEvent:e})}function fireTouchEvent(type,e){var touches=DOM.touchPos(el,e);var singular=touches.reduce(function(prev,curr,i,arr){return prev.add(curr.div(arr.length))},new Point(0,0));return map.fire(type,{lngLat:map.unproject(singular),point:singular,lngLats:touches.map(function(t){return map.unproject(t)},this),points:touches,originalEvent:e})}}},{"../util/dom":711,"./handler/box_zoom":691,"./handler/dblclick_zoom":692,"./handler/drag_pan":693,"./handler/drag_rotate":694,"./handler/keyboard":695,"./handler/scroll_zoom":696,"./handler/touch_zoom_rotate":697,"point-geometry":769}],686:[function(require,module,exports){"use strict";var util=require("../util/util");var interpolate=require("../util/interpolate");var browser=require("../util/browser");var LngLat=require("../geo/lng_lat");var LngLatBounds=require("../geo/lng_lat_bounds");var Point=require("point-geometry");var Evented=require("../util/evented");var Camera=function(Evented){function Camera(transform,options){Evented.call(this);this.transform=transform;this._bearingSnap=options.bearingSnap}if(Evented)Camera.__proto__=Evented;Camera.prototype=Object.create(Evented&&Evented.prototype);Camera.prototype.constructor=Camera;Camera.prototype.getCenter=function getCenter(){return this.transform.center};Camera.prototype.setCenter=function setCenter(center,eventData){this.jumpTo({center:center},eventData);return this};Camera.prototype.panBy=function panBy(offset,options,eventData){this.panTo(this.transform.center,util.extend({offset:Point.convert(offset).mult(-1)},options),eventData);return this};Camera.prototype.panTo=function panTo(lnglat,options,eventData){return this.easeTo(util.extend({center:lnglat},options),eventData)};Camera.prototype.getZoom=function getZoom(){return this.transform.zoom};Camera.prototype.setZoom=function setZoom(zoom,eventData){this.jumpTo({zoom:zoom},eventData);return this};Camera.prototype.zoomTo=function zoomTo(zoom,options,eventData){return this.easeTo(util.extend({zoom:zoom},options),eventData)};Camera.prototype.zoomIn=function zoomIn(options,eventData){this.zoomTo(this.getZoom()+1,options,eventData);return this};Camera.prototype.zoomOut=function zoomOut(options,eventData){this.zoomTo(this.getZoom()-1,options,eventData);return this};Camera.prototype.getBearing=function getBearing(){return this.transform.bearing};Camera.prototype.setBearing=function setBearing(bearing,eventData){this.jumpTo({bearing:bearing},eventData);return this};Camera.prototype.rotateTo=function rotateTo(bearing,options,eventData){return this.easeTo(util.extend({bearing:bearing},options),eventData)};Camera.prototype.resetNorth=function resetNorth(options,eventData){this.rotateTo(0,util.extend({duration:1e3},options),eventData);return this};Camera.prototype.snapToNorth=function snapToNorth(options,eventData){if(Math.abs(this.getBearing())<this._bearingSnap){return this.resetNorth(options,eventData)}return this};Camera.prototype.getPitch=function getPitch(){return this.transform.pitch};Camera.prototype.setPitch=function setPitch(pitch,eventData){this.jumpTo({pitch:pitch},eventData);return this};Camera.prototype.fitBounds=function fitBounds(bounds,options,eventData){options=util.extend({padding:0,offset:[0,0],maxZoom:this.getMaxZoom()},options);bounds=LngLatBounds.convert(bounds);var offset=Point.convert(options.offset),tr=this.transform,nw=tr.project(bounds.getNorthWest()),se=tr.project(bounds.getSouthEast()),size=se.sub(nw),scaleX=(tr.width-options.padding*2-Math.abs(offset.x)*2)/size.x,scaleY=(tr.height-options.padding*2-Math.abs(offset.y)*2)/size.y;options.center=tr.unproject(nw.add(se).div(2));options.zoom=Math.min(tr.scaleZoom(tr.scale*Math.min(scaleX,scaleY)),options.maxZoom);options.bearing=0;return options.linear?this.easeTo(options,eventData):this.flyTo(options,eventData)};Camera.prototype.jumpTo=function jumpTo(options,eventData){this.stop();var tr=this.transform;var zoomChanged=false,bearingChanged=false,pitchChanged=false;if("zoom"in options&&tr.zoom!==+options.zoom){zoomChanged=true;tr.zoom=+options.zoom}if("center"in options){tr.center=LngLat.convert(options.center)}if("bearing"in options&&tr.bearing!==+options.bearing){bearingChanged=true;tr.bearing=+options.bearing}if("pitch"in options&&tr.pitch!==+options.pitch){pitchChanged=true;tr.pitch=+options.pitch}this.fire("movestart",eventData).fire("move",eventData);if(zoomChanged){this.fire("zoomstart",eventData).fire("zoom",eventData).fire("zoomend",eventData)}if(bearingChanged){this.fire("rotate",eventData)}if(pitchChanged){this.fire("pitch",eventData)}return this.fire("moveend",eventData)};Camera.prototype.easeTo=function easeTo(options,eventData){var this$1=this;this.stop();options=util.extend({offset:[0,0],duration:500,easing:util.ease},options);var tr=this.transform,offset=Point.convert(options.offset),startZoom=this.getZoom(),startBearing=this.getBearing(),startPitch=this.getPitch(),zoom="zoom"in options?+options.zoom:startZoom,bearing="bearing"in options?this._normalizeBearing(options.bearing,startBearing):startBearing,pitch="pitch"in options?+options.pitch:startPitch;var toLngLat,toPoint;if("center"in options){toLngLat=LngLat.convert(options.center);toPoint=tr.centerPoint.add(offset)}else if("around"in options){toLngLat=LngLat.convert(options.around);toPoint=tr.locationPoint(toLngLat)}else{toPoint=tr.centerPoint.add(offset);toLngLat=tr.pointLocation(toPoint)}var fromPoint=tr.locationPoint(toLngLat);if(options.animate===false)options.duration=0;this.zooming=zoom!==startZoom;this.rotating=startBearing!==bearing;this.pitching=pitch!==startPitch;if(options.smoothEasing&&options.duration!==0){options.easing=this._smoothOutEasing(options.duration)}if(!options.noMoveStart){this.fire("movestart",eventData)}if(this.zooming){this.fire("zoomstart",eventData)}clearTimeout(this._onEaseEnd);this._ease(function(k){if(this.zooming){tr.zoom=interpolate(startZoom,zoom,k)}if(this.rotating){tr.bearing=interpolate(startBearing,bearing,k)}if(this.pitching){tr.pitch=interpolate(startPitch,pitch,k)}tr.setLocationAtPoint(toLngLat,fromPoint.add(toPoint.sub(fromPoint)._mult(k)));this.fire("move",eventData);if(this.zooming){this.fire("zoom",eventData)}if(this.rotating){this.fire("rotate",eventData)}if(this.pitching){this.fire("pitch",eventData)}},function(){if(options.delayEndEvents){this$1._onEaseEnd=setTimeout(this$1._easeToEnd.bind(this$1,eventData),options.delayEndEvents)}else{this$1._easeToEnd(eventData)}},options);return this};Camera.prototype._easeToEnd=function _easeToEnd(eventData){var wasZooming=this.zooming;this.zooming=false;this.rotating=false;this.pitching=false;if(wasZooming){this.fire("zoomend",eventData)}this.fire("moveend",eventData)};Camera.prototype.flyTo=function flyTo(options,eventData){this.stop();options=util.extend({offset:[0,0],speed:1.2,curve:1.42,easing:util.ease},options);var tr=this.transform,offset=Point.convert(options.offset),startZoom=this.getZoom(),startBearing=this.getBearing(),startPitch=this.getPitch();var center="center"in options?LngLat.convert(options.center):this.getCenter();var zoom="zoom"in options?+options.zoom:startZoom;var bearing="bearing"in options?this._normalizeBearing(options.bearing,startBearing):startBearing;var pitch="pitch"in options?+options.pitch:startPitch;if(Math.abs(tr.center.lng)+Math.abs(center.lng)>180){if(tr.center.lng>0&&center.lng<0){center.lng+=360}else if(tr.center.lng<0&&center.lng>0){center.lng-=360}}var scale=tr.zoomScale(zoom-startZoom),from=tr.point,to="center"in options?tr.project(center).sub(offset.div(scale)):from;var rho=options.curve;var w0=Math.max(tr.width,tr.height),w1=w0/scale,u1=to.sub(from).mag();if("minZoom"in options){var minZoom=util.clamp(Math.min(options.minZoom,startZoom,zoom),tr.minZoom,tr.maxZoom);var wMax=w0/tr.zoomScale(minZoom-startZoom);rho=Math.sqrt(wMax/u1*2)}var rho2=rho*rho;function r(i){var b=(w1*w1-w0*w0+(i?-1:1)*rho2*rho2*u1*u1)/(2*(i?w1:w0)*rho2*u1);return Math.log(Math.sqrt(b*b+1)-b)}function sinh(n){return(Math.exp(n)-Math.exp(-n))/2}function cosh(n){return(Math.exp(n)+Math.exp(-n))/2}function tanh(n){return sinh(n)/cosh(n)}var r0=r(0);var w=function(s){return cosh(r0)/cosh(r0+rho*s)},u=function(s){return w0*((cosh(r0)*tanh(r0+rho*s)-sinh(r0))/rho2)/u1},S=(r(1)-r0)/rho;if(Math.abs(u1)<1e-6){if(Math.abs(w0-w1)<1e-6)return this.easeTo(options);var k=w1<w0?-1:1;S=Math.abs(Math.log(w1/w0))/rho;u=function(){return 0};w=function(s){return Math.exp(k*rho*s)}}if("duration"in options){options.duration=+options.duration}else{var V="screenSpeed"in options?+options.screenSpeed/rho:+options.speed;options.duration=1e3*S/V}this.zooming=true;if(startBearing!==bearing)this.rotating=true;if(startPitch!==pitch)this.pitching=true;this.fire("movestart",eventData);this.fire("zoomstart",eventData);this._ease(function(k){var s=k*S,us=u(s);var scale=1/w(s);tr.zoom=startZoom+tr.scaleZoom(scale);tr.center=tr.unproject(from.add(to.sub(from).mult(us)).mult(scale));if(this.rotating){tr.bearing=interpolate(startBearing,bearing,k)}if(this.pitching){tr.pitch=interpolate(startPitch,pitch,k)}this.fire("move",eventData);this.fire("zoom",eventData);if(this.rotating){this.fire("rotate",eventData)}if(this.pitching){this.fire("pitch",eventData)}},function(){this.zooming=false;this.rotating=false;this.pitching=false;this.fire("zoomend",eventData);this.fire("moveend",eventData)},options);return this};Camera.prototype.isEasing=function isEasing(){return!!this._abortFn};Camera.prototype.stop=function stop(){if(this._abortFn){this._abortFn();this._finishEase()}return this};Camera.prototype._ease=function _ease(frame,finish,options){this._finishFn=finish;this._abortFn=browser.timed(function(t){frame.call(this,options.easing(t));if(t===1){this._finishEase()}},options.animate===false?0:options.duration,this)};Camera.prototype._finishEase=function _finishEase(){delete this._abortFn;var finish=this._finishFn;delete this._finishFn;finish.call(this)};Camera.prototype._normalizeBearing=function _normalizeBearing(bearing,currentBearing){bearing=util.wrap(bearing,-180,180);var diff=Math.abs(bearing-currentBearing);if(Math.abs(bearing-360-currentBearing)<diff)bearing-=360;if(Math.abs(bearing+360-currentBearing)<diff)bearing+=360;return bearing};Camera.prototype._smoothOutEasing=function _smoothOutEasing(duration){var easing=util.ease;if(this._prevEase){var ease=this._prevEase,t=(Date.now()-ease.start)/ease.duration,speed=ease.easing(t+.01)-ease.easing(t),x=.27/Math.sqrt(speed*speed+1e-4)*.01,y=Math.sqrt(.27*.27-x*x);easing=util.bezier(x,y,.25,1)}this._prevEase={start:(new Date).getTime(),duration:duration,easing:easing};return easing};return Camera}(Evented);module.exports=Camera},{"../geo/lng_lat":615,"../geo/lng_lat_bounds":616,"../util/browser":704,"../util/evented":712,"../util/interpolate":715,"../util/util":723,"point-geometry":769}],687:[function(require,module,exports){"use strict";var DOM=require("../../util/dom");var util=require("../../util/util");var AttributionControl=function AttributionControl(options){this.options=options;util.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};AttributionControl.prototype.getDefaultPosition=function getDefaultPosition(){return"bottom-right"};AttributionControl.prototype.onAdd=function onAdd(map){var compact=this.options&&this.options.compact;this._map=map;this._container=DOM.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib");if(compact){this._container.classList.add("compact")}this._updateAttributions();this._updateEditLink();this._map.on("data",this._updateData);this._map.on("moveend",this._updateEditLink);if(compact===undefined){this._map.on("resize",this._updateCompact);this._updateCompact()}return this._container};AttributionControl.prototype.onRemove=function onRemove(){this._container.parentNode.removeChild(this._container);
this._map.off("data",this._updateData);this._map.off("moveend",this._updateEditLink);this._map.off("resize",this._updateCompact);this._map=undefined};AttributionControl.prototype._updateEditLink=function _updateEditLink(){if(!this._editLink)this._editLink=this._container.querySelector(".mapbox-improve-map");if(this._editLink){var center=this._map.getCenter();this._editLink.href="https://www.mapbox.com/map-feedback/#/"+center.lng+"/"+center.lat+"/"+Math.round(this._map.getZoom()+1)}};AttributionControl.prototype._updateData=function _updateData(event){if(event.dataType==="source"){this._updateAttributions();this._updateEditLink()}};AttributionControl.prototype._updateAttributions=function _updateAttributions(){if(!this._map.style)return;var attributions=[];var sourceCaches=this._map.style.sourceCaches;for(var id in sourceCaches){var source=sourceCaches[id].getSource();if(source.attribution&&attributions.indexOf(source.attribution)<0){attributions.push(source.attribution)}}attributions.sort(function(a,b){return a.length-b.length});attributions=attributions.filter(function(attrib,i){for(var j=i+1;j<attributions.length;j++){if(attributions[j].indexOf(attrib)>=0){return false}}return true});this._container.innerHTML=attributions.join(" | ");this._editLink=null};AttributionControl.prototype._updateCompact=function _updateCompact(){var compact=this._map.getCanvasContainer().offsetWidth<=640;this._container.classList[compact?"add":"remove"]("compact")};module.exports=AttributionControl},{"../../util/dom":711,"../../util/util":723}],688:[function(require,module,exports){"use strict";var Evented=require("../../util/evented");var DOM=require("../../util/dom");var window=require("../../util/window");var util=require("../../util/util");var defaultGeoPositionOptions={enableHighAccuracy:false,timeout:6e3};var className="mapboxgl-ctrl";var supportsGeolocation;function checkGeolocationSupport(callback){if(supportsGeolocation!==undefined){callback(supportsGeolocation)}else if(window.navigator.permissions!==undefined){window.navigator.permissions.query({name:"geolocation"}).then(function(p){supportsGeolocation=p.state!=="denied";callback(supportsGeolocation)})}else{supportsGeolocation=!!window.navigator.geolocation;callback(supportsGeolocation)}}var GeolocateControl=function(Evented){function GeolocateControl(options){Evented.call(this);this.options=options||{};util.bindAll(["_onSuccess","_onError","_finish","_setupUI"],this)}if(Evented)GeolocateControl.__proto__=Evented;GeolocateControl.prototype=Object.create(Evented&&Evented.prototype);GeolocateControl.prototype.constructor=GeolocateControl;GeolocateControl.prototype.onAdd=function onAdd(map){this._map=map;this._container=DOM.create("div",className+" "+className+"-group");checkGeolocationSupport(this._setupUI);return this._container};GeolocateControl.prototype.onRemove=function onRemove(){this._container.parentNode.removeChild(this._container);this._map=undefined};GeolocateControl.prototype._onSuccess=function _onSuccess(position){this._map.jumpTo({center:[position.coords.longitude,position.coords.latitude],zoom:17,bearing:0,pitch:0});this.fire("geolocate",position);this._finish()};GeolocateControl.prototype._onError=function _onError(error){this.fire("error",error);this._finish()};GeolocateControl.prototype._finish=function _finish(){if(this._timeoutId){clearTimeout(this._timeoutId)}this._timeoutId=undefined};GeolocateControl.prototype._setupUI=function _setupUI(supported){if(supported===false)return;this._container.addEventListener("contextmenu",function(e){return e.preventDefault()});this._geolocateButton=DOM.create("button",className+"-icon "+className+"-geolocate",this._container);this._geolocateButton.type="button";this._geolocateButton.setAttribute("aria-label","Geolocate");if(this.options.watchPosition)this._geolocateButton.setAttribute("aria-pressed",false);this._geolocateButton.addEventListener("click",this._onClickGeolocate.bind(this))};GeolocateControl.prototype._onClickGeolocate=function _onClickGeolocate(){var positionOptions=util.extend(defaultGeoPositionOptions,this.options&&this.options.positionOptions||{});if(this.options.watchPosition){if(this._geolocationWatchID!==undefined){this._geolocateButton.classList.remove("watching");this._geolocateButton.setAttribute("aria-pressed",false);window.navigator.geolocation.clearWatch(this._geolocationWatchID);this._geolocationWatchID=undefined}else{this._geolocateButton.classList.add("watching");this._geolocateButton.setAttribute("aria-pressed",true);this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,positionOptions)}}else{window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,positionOptions);this._timeoutId=setTimeout(this._finish,1e4)}};return GeolocateControl}(Evented);module.exports=GeolocateControl},{"../../util/dom":711,"../../util/evented":712,"../../util/util":723,"../../util/window":706}],689:[function(require,module,exports){"use strict";var DOM=require("../../util/dom");var window=require("../../util/window");var util=require("../../util/util");var className="mapboxgl-ctrl";var NavigationControl=function NavigationControl(){util.bindAll(["_rotateCompassArrow"],this)};NavigationControl.prototype._rotateCompassArrow=function _rotateCompassArrow(){var rotate="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=rotate};NavigationControl.prototype.onAdd=function onAdd(map){this._map=map;this._container=DOM.create("div",className+" "+className+"-group",map.getContainer());this._container.addEventListener("contextmenu",this._onContextMenu.bind(this));this._zoomInButton=this._createButton(className+"-icon "+className+"-zoom-in","Zoom In",map.zoomIn.bind(map));this._zoomOutButton=this._createButton(className+"-icon "+className+"-zoom-out","Zoom Out",map.zoomOut.bind(map));this._compass=this._createButton(className+"-icon "+className+"-compass","Reset North",map.resetNorth.bind(map));this._compassArrow=DOM.create("span","arrow",this._compass);this._compass.addEventListener("mousedown",this._onCompassDown.bind(this));this._onCompassMove=this._onCompassMove.bind(this);this._onCompassUp=this._onCompassUp.bind(this);this._map.on("rotate",this._rotateCompassArrow);this._rotateCompassArrow();return this._container};NavigationControl.prototype.onRemove=function onRemove(){this._container.parentNode.removeChild(this._container);this._map.off("rotate",this._rotateCompassArrow);this._map=undefined};NavigationControl.prototype._onContextMenu=function _onContextMenu(e){e.preventDefault()};NavigationControl.prototype._onCompassDown=function _onCompassDown(e){if(e.button!==0)return;DOM.disableDrag();window.document.addEventListener("mousemove",this._onCompassMove);window.document.addEventListener("mouseup",this._onCompassUp);this._map.getCanvasContainer().dispatchEvent(copyMouseEvent(e));e.stopPropagation()};NavigationControl.prototype._onCompassMove=function _onCompassMove(e){if(e.button!==0)return;this._map.getCanvasContainer().dispatchEvent(copyMouseEvent(e));e.stopPropagation()};NavigationControl.prototype._onCompassUp=function _onCompassUp(e){if(e.button!==0)return;window.document.removeEventListener("mousemove",this._onCompassMove);window.document.removeEventListener("mouseup",this._onCompassUp);DOM.enableDrag();this._map.getCanvasContainer().dispatchEvent(copyMouseEvent(e));e.stopPropagation()};NavigationControl.prototype._createButton=function _createButton(className,ariaLabel,fn){var a=DOM.create("button",className,this._container);a.type="button";a.setAttribute("aria-label",ariaLabel);a.addEventListener("click",function(){fn()});return a};module.exports=NavigationControl;function copyMouseEvent(e){return new window.MouseEvent(e.type,{button:2,buttons:2,bubbles:true,cancelable:true,detail:e.detail,view:e.view,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,movementX:e.movementX,movementY:e.movementY,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey})}},{"../../util/dom":711,"../../util/util":723,"../../util/window":706}],690:[function(require,module,exports){"use strict";var DOM=require("../../util/dom");var util=require("../../util/util");var ScaleControl=function ScaleControl(options){this.options=options;util.bindAll(["_onMove"],this)};ScaleControl.prototype.getDefaultPosition=function getDefaultPosition(){return"bottom-left"};ScaleControl.prototype._onMove=function _onMove(){updateScale(this._map,this._container,this.options)};ScaleControl.prototype.onAdd=function onAdd(map){this._map=map;this._container=DOM.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",map.getContainer());this._map.on("move",this._onMove);this._onMove();return this._container};ScaleControl.prototype.onRemove=function onRemove(){this._container.parentNode.removeChild(this._container);this._map.off("move",this._onMove);this._map=undefined};module.exports=ScaleControl;function updateScale(map,container,options){var maxWidth=options&&options.maxWidth||100;var y=map._container.clientHeight/2;var maxMeters=getDistance(map.unproject([0,y]),map.unproject([maxWidth,y]));if(options&&options.unit==="imperial"){var maxFeet=3.2808*maxMeters;if(maxFeet>5280){var maxMiles=maxFeet/5280;setScale(container,maxWidth,maxMiles,"mi")}else{setScale(container,maxWidth,maxFeet,"ft")}}else{setScale(container,maxWidth,maxMeters,"m")}}function setScale(container,maxWidth,maxDistance,unit){var distance=getRoundNum(maxDistance);var ratio=distance/maxDistance;if(unit==="m"&&distance>=1e3){distance=distance/1e3;unit="km"}container.style.width=maxWidth*ratio+"px";container.innerHTML=distance+unit}function getDistance(latlng1,latlng2){var R=6371e3;var rad=Math.PI/180,lat1=latlng1.lat*rad,lat2=latlng2.lat*rad,a=Math.sin(lat1)*Math.sin(lat2)+Math.cos(lat1)*Math.cos(lat2)*Math.cos((latlng2.lng-latlng1.lng)*rad);var maxMeters=R*Math.acos(Math.min(a,1));return maxMeters}function getRoundNum(num){var pow10=Math.pow(10,(""+Math.floor(num)).length-1);var d=num/pow10;d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:1;return pow10*d}},{"../../util/dom":711,"../../util/util":723}],691:[function(require,module,exports){"use strict";var DOM=require("../../util/dom");var LngLatBounds=require("../../geo/lng_lat_bounds");var util=require("../../util/util");var window=require("../../util/window");var BoxZoomHandler=function BoxZoomHandler(map){this._map=map;this._el=map.getCanvasContainer();this._container=map.getContainer();util.bindAll(["_onMouseDown","_onMouseMove","_onMouseUp","_onKeyDown"],this)};BoxZoomHandler.prototype.isEnabled=function isEnabled(){return!!this._enabled};BoxZoomHandler.prototype.isActive=function isActive(){return!!this._active};BoxZoomHandler.prototype.enable=function enable(){if(this.isEnabled())return;this._el.addEventListener("mousedown",this._onMouseDown,false);this._enabled=true};BoxZoomHandler.prototype.disable=function disable(){if(!this.isEnabled())return;this._el.removeEventListener("mousedown",this._onMouseDown);this._enabled=false};BoxZoomHandler.prototype._onMouseDown=function _onMouseDown(e){if(!(e.shiftKey&&e.button===0))return;window.document.addEventListener("mousemove",this._onMouseMove,false);window.document.addEventListener("keydown",this._onKeyDown,false);window.document.addEventListener("mouseup",this._onMouseUp,false);DOM.disableDrag();this._startPos=DOM.mousePos(this._el,e);this._active=true};BoxZoomHandler.prototype._onMouseMove=function _onMouseMove(e){var p0=this._startPos,p1=DOM.mousePos(this._el,e);if(!this._box){this._box=DOM.create("div","mapboxgl-boxzoom",this._container);this._container.classList.add("mapboxgl-crosshair");this._fireEvent("boxzoomstart",e)}var minX=Math.min(p0.x,p1.x),maxX=Math.max(p0.x,p1.x),minY=Math.min(p0.y,p1.y),maxY=Math.max(p0.y,p1.y);DOM.setTransform(this._box,"translate("+minX+"px,"+minY+"px)");this._box.style.width=maxX-minX+"px";this._box.style.height=maxY-minY+"px"};BoxZoomHandler.prototype._onMouseUp=function _onMouseUp(e){if(e.button!==0)return;var p0=this._startPos,p1=DOM.mousePos(this._el,e),bounds=(new LngLatBounds).extend(this._map.unproject(p0)).extend(this._map.unproject(p1));this._finish();if(p0.x===p1.x&&p0.y===p1.y){this._fireEvent("boxzoomcancel",e)}else{this._map.fitBounds(bounds,{linear:true}).fire("boxzoomend",{originalEvent:e,boxZoomBounds:bounds})}};BoxZoomHandler.prototype._onKeyDown=function _onKeyDown(e){if(e.keyCode===27){this._finish();this._fireEvent("boxzoomcancel",e)}};BoxZoomHandler.prototype._finish=function _finish(){this._active=false;window.document.removeEventListener("mousemove",this._onMouseMove,false);window.document.removeEventListener("keydown",this._onKeyDown,false);window.document.removeEventListener("mouseup",this._onMouseUp,false);this._container.classList.remove("mapboxgl-crosshair");if(this._box){this._box.parentNode.removeChild(this._box);this._box=null}DOM.enableDrag()};BoxZoomHandler.prototype._fireEvent=function _fireEvent(type,e){return this._map.fire(type,{originalEvent:e})};module.exports=BoxZoomHandler},{"../../geo/lng_lat_bounds":616,"../../util/dom":711,"../../util/util":723,"../../util/window":706}],692:[function(require,module,exports){"use strict";var DoubleClickZoomHandler=function DoubleClickZoomHandler(map){this._map=map;this._onDblClick=this._onDblClick.bind(this)};DoubleClickZoomHandler.prototype.isEnabled=function isEnabled(){return!!this._enabled};DoubleClickZoomHandler.prototype.enable=function enable(){if(this.isEnabled())return;this._map.on("dblclick",this._onDblClick);this._enabled=true};DoubleClickZoomHandler.prototype.disable=function disable(){if(!this.isEnabled())return;this._map.off("dblclick",this._onDblClick);this._enabled=false};DoubleClickZoomHandler.prototype._onDblClick=function _onDblClick(e){this._map.zoomTo(this._map.getZoom()+(e.originalEvent.shiftKey?-1:1),{around:e.lngLat},e)};module.exports=DoubleClickZoomHandler},{}],693:[function(require,module,exports){"use strict";var DOM=require("../../util/dom");var util=require("../../util/util");var window=require("../../util/window");var inertiaLinearity=.3,inertiaEasing=util.bezier(0,0,inertiaLinearity,1),inertiaMaxSpeed=1400,inertiaDeceleration=2500;var DragPanHandler=function DragPanHandler(map){this._map=map;this._el=map.getCanvasContainer();util.bindAll(["_onDown","_onMove","_onUp","_onTouchEnd","_onMouseUp"],this)};DragPanHandler.prototype.isEnabled=function isEnabled(){return!!this._enabled};DragPanHandler.prototype.isActive=function isActive(){return!!this._active};DragPanHandler.prototype.enable=function enable(){if(this.isEnabled())return;this._el.addEventListener("mousedown",this._onDown);this._el.addEventListener("touchstart",this._onDown);this._enabled=true};DragPanHandler.prototype.disable=function disable(){if(!this.isEnabled())return;this._el.removeEventListener("mousedown",this._onDown);this._el.removeEventListener("touchstart",this._onDown);this._enabled=false};DragPanHandler.prototype._onDown=function _onDown(e){if(this._ignoreEvent(e))return;if(this.isActive())return;if(e.touches){window.document.addEventListener("touchmove",this._onMove);window.document.addEventListener("touchend",this._onTouchEnd)}else{window.document.addEventListener("mousemove",this._onMove);window.document.addEventListener("mouseup",this._onMouseUp)}this._active=false;this._startPos=this._pos=DOM.mousePos(this._el,e);this._inertia=[[Date.now(),this._pos]]};DragPanHandler.prototype._onMove=function _onMove(e){if(this._ignoreEvent(e))return;if(!this.isActive()){this._active=true;this._fireEvent("dragstart",e);this._fireEvent("movestart",e)}var pos=DOM.mousePos(this._el,e),map=this._map;map.stop();this._drainInertiaBuffer();this._inertia.push([Date.now(),pos]);map.transform.setLocationAtPoint(map.transform.pointLocation(this._pos),pos);this._fireEvent("drag",e);this._fireEvent("move",e);this._pos=pos;e.preventDefault()};DragPanHandler.prototype._onUp=function _onUp(e){var this$1=this;if(!this.isActive())return;this._active=false;this._fireEvent("dragend",e);this._drainInertiaBuffer();var finish=function(){return this$1._fireEvent("moveend",e)};var inertia=this._inertia;if(inertia.length<2){finish();return}var last=inertia[inertia.length-1],first=inertia[0],flingOffset=last[1].sub(first[1]),flingDuration=(last[0]-first[0])/1e3;if(flingDuration===0||last[1].equals(first[1])){finish();return}var velocity=flingOffset.mult(inertiaLinearity/flingDuration);var speed=velocity.mag();if(speed>inertiaMaxSpeed){speed=inertiaMaxSpeed;velocity._unit()._mult(speed)}var duration=speed/(inertiaDeceleration*inertiaLinearity),offset=velocity.mult(-duration/2);this._map.panBy(offset,{duration:duration*1e3,easing:inertiaEasing,noMoveStart:true},{originalEvent:e})};DragPanHandler.prototype._onMouseUp=function _onMouseUp(e){if(this._ignoreEvent(e))return;this._onUp(e);window.document.removeEventListener("mousemove",this._onMove);window.document.removeEventListener("mouseup",this._onMouseUp)};DragPanHandler.prototype._onTouchEnd=function _onTouchEnd(e){if(this._ignoreEvent(e))return;this._onUp(e);window.document.removeEventListener("touchmove",this._onMove);window.document.removeEventListener("touchend",this._onTouchEnd)};DragPanHandler.prototype._fireEvent=function _fireEvent(type,e){return this._map.fire(type,{originalEvent:e})};DragPanHandler.prototype._ignoreEvent=function _ignoreEvent(e){var map=this._map;if(map.boxZoom&&map.boxZoom.isActive())return true;if(map.dragRotate&&map.dragRotate.isActive())return true;if(e.touches){return e.touches.length>1}else{if(e.ctrlKey)return true;var buttons=1,button=0;return e.type==="mousemove"?e.buttons&buttons===0:e.button!==button}};DragPanHandler.prototype._drainInertiaBuffer=function _drainInertiaBuffer(){var inertia=this._inertia,now=Date.now(),cutoff=160;while(inertia.length>0&&now-inertia[0][0]>cutoff)inertia.shift()};module.exports=DragPanHandler},{"../../util/dom":711,"../../util/util":723,"../../util/window":706}],694:[function(require,module,exports){"use strict";var DOM=require("../../util/dom");var util=require("../../util/util");var window=require("../../util/window");var inertiaLinearity=.25,inertiaEasing=util.bezier(0,0,inertiaLinearity,1),inertiaMaxSpeed=180,inertiaDeceleration=720;var DragRotateHandler=function DragRotateHandler(map,options){this._map=map;this._el=map.getCanvasContainer();this._bearingSnap=options.bearingSnap;this._pitchWithRotate=options.pitchWithRotate!==false;util.bindAll(["_onDown","_onMove","_onUp"],this)};DragRotateHandler.prototype.isEnabled=function isEnabled(){return!!this._enabled};DragRotateHandler.prototype.isActive=function isActive(){return!!this._active};DragRotateHandler.prototype.enable=function enable(){if(this.isEnabled())return;this._el.addEventListener("mousedown",this._onDown);this._enabled=true};DragRotateHandler.prototype.disable=function disable(){if(!this.isEnabled())return;this._el.removeEventListener("mousedown",this._onDown);this._enabled=false};DragRotateHandler.prototype._onDown=function _onDown(e){if(this._ignoreEvent(e))return;if(this.isActive())return;window.document.addEventListener("mousemove",this._onMove);window.document.addEventListener("mouseup",this._onUp);this._active=false;this._inertia=[[Date.now(),this._map.getBearing()]];this._startPos=this._pos=DOM.mousePos(this._el,e);this._center=this._map.transform.centerPoint;e.preventDefault()};DragRotateHandler.prototype._onMove=function _onMove(e){if(this._ignoreEvent(e))return;if(!this.isActive()){this._active=true;this._fireEvent("rotatestart",e);this._fireEvent("movestart",e)}var map=this._map;map.stop();var p1=this._pos,p2=DOM.mousePos(this._el,e),bearingDiff=(p1.x-p2.x)*.8,pitchDiff=(p1.y-p2.y)*-.5,bearing=map.getBearing()-bearingDiff,pitch=map.getPitch()-pitchDiff,inertia=this._inertia,last=inertia[inertia.length-1];this._drainInertiaBuffer();inertia.push([Date.now(),map._normalizeBearing(bearing,last[1])]);map.transform.bearing=bearing;if(this._pitchWithRotate)map.transform.pitch=pitch;this._fireEvent("rotate",e);this._fireEvent("move",e);this._pos=p2};DragRotateHandler.prototype._onUp=function _onUp(e){var this$1=this;if(this._ignoreEvent(e))return;window.document.removeEventListener("mousemove",this._onMove);window.document.removeEventListener("mouseup",this._onUp);if(!this.isActive())return;this._active=false;this._fireEvent("rotateend",e);this._drainInertiaBuffer();var map=this._map,mapBearing=map.getBearing(),inertia=this._inertia;var finish=function(){if(Math.abs(mapBearing)<this$1._bearingSnap){map.resetNorth({noMoveStart:true},{originalEvent:e})}else{this$1._fireEvent("moveend",e)}};if(inertia.length<2){finish();return}var first=inertia[0],last=inertia[inertia.length-1],previous=inertia[inertia.length-2];var bearing=map._normalizeBearing(mapBearing,previous[1]);var flingDiff=last[1]-first[1],sign=flingDiff<0?-1:1,flingDuration=(last[0]-first[0])/1e3;if(flingDiff===0||flingDuration===0){finish();return}var speed=Math.abs(flingDiff*(inertiaLinearity/flingDuration));if(speed>inertiaMaxSpeed){speed=inertiaMaxSpeed}var duration=speed/(inertiaDeceleration*inertiaLinearity),offset=sign*speed*(duration/2);bearing+=offset;if(Math.abs(map._normalizeBearing(bearing,0))<this._bearingSnap){bearing=map._normalizeBearing(0,bearing)}map.rotateTo(bearing,{duration:duration*1e3,easing:inertiaEasing,noMoveStart:true},{originalEvent:e})};DragRotateHandler.prototype._fireEvent=function _fireEvent(type,e){return this._map.fire(type,{originalEvent:e})};DragRotateHandler.prototype._ignoreEvent=function _ignoreEvent(e){var map=this._map;if(map.boxZoom&&map.boxZoom.isActive())return true;if(map.dragPan&&map.dragPan.isActive())return true;if(e.touches){return e.touches.length>1}else{var buttons=e.ctrlKey?1:2,button=e.ctrlKey?0:2;var eventButton=e.button;if(typeof InstallTrigger!=="undefined"&&e.button===2&&e.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0){eventButton=0}return e.type==="mousemove"?e.buttons&buttons===0:eventButton!==button}};DragRotateHandler.prototype._drainInertiaBuffer=function _drainInertiaBuffer(){var inertia=this._inertia,now=Date.now(),cutoff=160;while(inertia.length>0&&now-inertia[0][0]>cutoff)inertia.shift()};module.exports=DragRotateHandler},{"../../util/dom":711,"../../util/util":723,"../../util/window":706}],695:[function(require,module,exports){"use strict";var panStep=100,bearingStep=15,pitchStep=10;var KeyboardHandler=function KeyboardHandler(map){this._map=map;this._el=map.getCanvasContainer();this._onKeyDown=this._onKeyDown.bind(this)};KeyboardHandler.prototype.isEnabled=function isEnabled(){return!!this._enabled};KeyboardHandler.prototype.enable=function enable(){if(this.isEnabled())return;this._el.addEventListener("keydown",this._onKeyDown,false);this._enabled=true};KeyboardHandler.prototype.disable=function disable(){if(!this.isEnabled())return;this._el.removeEventListener("keydown",this._onKeyDown);this._enabled=false};KeyboardHandler.prototype._onKeyDown=function _onKeyDown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;var zoomDir=0;var bearingDir=0;var pitchDir=0;var xDir=0;var yDir=0;switch(e.keyCode){case 61:case 107:case 171:case 187:zoomDir=1;break;case 189:case 109:case 173:zoomDir=-1;break;case 37:if(e.shiftKey){bearingDir=-1}else{e.preventDefault();xDir=-1}break;case 39:if(e.shiftKey){bearingDir=1}else{e.preventDefault();xDir=1}break;case 38:if(e.shiftKey){pitchDir=1}else{e.preventDefault();yDir=-1}break;case 40:if(e.shiftKey){pitchDir=-1}else{yDir=1;e.preventDefault()}break}var map=this._map;var zoom=map.getZoom();var easeOptions={duration:300,delayEndEvents:500,easing:easeOut,zoom:zoomDir?Math.round(zoom)+zoomDir*(e.shiftKey?2:1):zoom,bearing:map.getBearing()+bearingDir*bearingStep,pitch:map.getPitch()+pitchDir*pitchStep,offset:[-xDir*panStep,-yDir*panStep],center:map.getCenter()};map.easeTo(easeOptions,{originalEvent:e})};function easeOut(t){return t*(2-t)}module.exports=KeyboardHandler},{}],696:[function(require,module,exports){"use strict";var DOM=require("../../util/dom");var util=require("../../util/util");var browser=require("../../util/browser");var window=require("../../util/window");var ua=window.navigator.userAgent.toLowerCase(),firefox=ua.indexOf("firefox")!==-1,safari=ua.indexOf("safari")!==-1&&ua.indexOf("chrom")===-1;var ScrollZoomHandler=function ScrollZoomHandler(map){this._map=map;this._el=map.getCanvasContainer();util.bindAll(["_onWheel","_onTimeout"],this)};ScrollZoomHandler.prototype.isEnabled=function isEnabled(){return!!this._enabled};ScrollZoomHandler.prototype.enable=function enable(){if(this.isEnabled())return;this._el.addEventListener("wheel",this._onWheel,false);this._el.addEventListener("mousewheel",this._onWheel,false);this._enabled=true};ScrollZoomHandler.prototype.disable=function disable(){if(!this.isEnabled())return;this._el.removeEventListener("wheel",this._onWheel);this._el.removeEventListener("mousewheel",this._onWheel);this._enabled=false};ScrollZoomHandler.prototype._onWheel=function _onWheel(e){var value;if(e.type==="wheel"){value=e.deltaY;if(firefox&&e.deltaMode===window.WheelEvent.DOM_DELTA_PIXEL)value/=browser.devicePixelRatio;if(e.deltaMode===window.WheelEvent.DOM_DELTA_LINE)value*=40}else if(e.type==="mousewheel"){value=-e.wheelDeltaY;if(safari)value=value/3}var now=browser.now(),timeDelta=now-(this._time||0);this._pos=DOM.mousePos(this._el,e);this._time=now;if(value!==0&&value%4.000244140625===0){this._type="wheel"}else if(value!==0&&Math.abs(value)<4){this._type="trackpad"}else if(timeDelta>400){this._type=null;this._lastValue=value;this._timeout=setTimeout(this._onTimeout,40)}else if(!this._type){this._type=Math.abs(timeDelta*value)<200?"trackpad":"wheel";if(this._timeout){clearTimeout(this._timeout);this._timeout=null;value+=this._lastValue}}if(e.shiftKey&&value)value=value/4;if(this._type)this._zoom(-value,e);e.preventDefault()};ScrollZoomHandler.prototype._onTimeout=function _onTimeout(){this._type="wheel";this._zoom(-this._lastValue)};ScrollZoomHandler.prototype._zoom=function _zoom(delta,e){if(delta===0)return;var map=this._map;var scale=2/(1+Math.exp(-Math.abs(delta/100)));if(delta<0&&scale!==0)scale=1/scale;var fromScale=map.ease?map.ease.to:map.transform.scale,targetZoom=map.transform.scaleZoom(fromScale*scale);map.zoomTo(targetZoom,{duration:this._type==="wheel"?200:0,around:map.unproject(this._pos),delayEndEvents:200,smoothEasing:true},{originalEvent:e})};module.exports=ScrollZoomHandler},{"../../util/browser":704,"../../util/dom":711,"../../util/util":723,"../../util/window":706}],697:[function(require,module,exports){"use strict";var DOM=require("../../util/dom");var util=require("../../util/util");var window=require("../../util/window");var inertiaLinearity=.15,inertiaEasing=util.bezier(0,0,inertiaLinearity,1),inertiaDeceleration=12,inertiaMaxSpeed=2.5,significantScaleThreshold=.15,significantRotateThreshold=4;var TouchZoomRotateHandler=function TouchZoomRotateHandler(map){this._map=map;this._el=map.getCanvasContainer();util.bindAll(["_onStart","_onMove","_onEnd"],this)};TouchZoomRotateHandler.prototype.isEnabled=function isEnabled(){return!!this._enabled};TouchZoomRotateHandler.prototype.enable=function enable(){if(this.isEnabled())return;this._el.addEventListener("touchstart",this._onStart,false);this._enabled=true};TouchZoomRotateHandler.prototype.disable=function disable(){if(!this.isEnabled())return;this._el.removeEventListener("touchstart",this._onStart);this._enabled=false};TouchZoomRotateHandler.prototype.disableRotation=function disableRotation(){this._rotationDisabled=true};TouchZoomRotateHandler.prototype.enableRotation=function enableRotation(){this._rotationDisabled=false};TouchZoomRotateHandler.prototype._onStart=function _onStart(e){if(e.touches.length!==2)return;var p0=DOM.mousePos(this._el,e.touches[0]),p1=DOM.mousePos(this._el,e.touches[1]);this._startVec=p0.sub(p1);this._startScale=this._map.transform.scale;this._startBearing=this._map.transform.bearing;this._gestureIntent=undefined;this._inertia=[];window.document.addEventListener("touchmove",this._onMove,false);window.document.addEventListener("touchend",this._onEnd,false)};TouchZoomRotateHandler.prototype._onMove=function _onMove(e){if(e.touches.length!==2)return;var p0=DOM.mousePos(this._el,e.touches[0]),p1=DOM.mousePos(this._el,e.touches[1]),p=p0.add(p1).div(2),vec=p0.sub(p1),scale=vec.mag()/this._startVec.mag(),bearing=this._rotationDisabled?0:vec.angleWith(this._startVec)*180/Math.PI,map=this._map;if(!this._gestureIntent){var scalingSignificantly=Math.abs(1-scale)>significantScaleThreshold,rotatingSignificantly=Math.abs(bearing)>significantRotateThreshold;if(rotatingSignificantly){this._gestureIntent="rotate"}else if(scalingSignificantly){this._gestureIntent="zoom"}if(this._gestureIntent){this._startVec=vec;this._startScale=map.transform.scale;this._startBearing=map.transform.bearing}}else{var param={duration:0,around:map.unproject(p)};if(this._gestureIntent==="rotate"){param.bearing=this._startBearing+bearing}if(this._gestureIntent==="zoom"||this._gestureIntent==="rotate"){param.zoom=map.transform.scaleZoom(this._startScale*scale)}map.stop();this._drainInertiaBuffer();this._inertia.push([Date.now(),scale,p]);map.easeTo(param,{originalEvent:e})}e.preventDefault()};TouchZoomRotateHandler.prototype._onEnd=function _onEnd(e){window.document.removeEventListener("touchmove",this._onMove);window.document.removeEventListener("touchend",this._onEnd);this._drainInertiaBuffer();var inertia=this._inertia,map=this._map;if(inertia.length<2){map.snapToNorth({},{originalEvent:e});return}var last=inertia[inertia.length-1],first=inertia[0],lastScale=map.transform.scaleZoom(this._startScale*last[1]),firstScale=map.transform.scaleZoom(this._startScale*first[1]),scaleOffset=lastScale-firstScale,scaleDuration=(last[0]-first[0])/1e3,p=last[2];if(scaleDuration===0||lastScale===firstScale){map.snapToNorth({},{originalEvent:e});return}var speed=scaleOffset*inertiaLinearity/scaleDuration;if(Math.abs(speed)>inertiaMaxSpeed){if(speed>0){speed=inertiaMaxSpeed}else{speed=-inertiaMaxSpeed}}var duration=Math.abs(speed/(inertiaDeceleration*inertiaLinearity))*1e3;var targetScale=lastScale+speed*duration/2e3;if(targetScale<0){targetScale=0}map.easeTo({zoom:targetScale,duration:duration,easing:inertiaEasing,around:map.unproject(p)},{originalEvent:e})};TouchZoomRotateHandler.prototype._drainInertiaBuffer=function _drainInertiaBuffer(){var inertia=this._inertia,now=Date.now(),cutoff=160;while(inertia.length>2&&now-inertia[0][0]>cutoff)inertia.shift()};module.exports=TouchZoomRotateHandler},{"../../util/dom":711,"../../util/util":723,"../../util/window":706}],698:[function(require,module,exports){"use strict";var util=require("../util/util");var window=require("../util/window");var Hash=function Hash(){util.bindAll(["_onHashChange","_updateHash"],this)};Hash.prototype.addTo=function addTo(map){this._map=map;window.addEventListener("hashchange",this._onHashChange,false);this._map.on("moveend",this._updateHash);return this};Hash.prototype.remove=function remove(){window.removeEventListener("hashchange",this._onHashChange,false);this._map.off("moveend",this._updateHash);delete this._map;return this};Hash.prototype._onHashChange=function _onHashChange(){var loc=window.location.hash.replace("#","").split("/");if(loc.length>=3){this._map.jumpTo({center:[+loc[2],+loc[1]],zoom:+loc[0],bearing:+(loc[3]||0),pitch:+(loc[4]||0)});return true}return false};Hash.prototype._updateHash=function _updateHash(){var center=this._map.getCenter(),zoom=this._map.getZoom(),bearing=this._map.getBearing(),pitch=this._map.getPitch(),precision=Math.max(0,Math.ceil(Math.log(zoom)/Math.LN2));var hash="#"+Math.round(zoom*100)/100+"/"+center.lat.toFixed(precision)+"/"+center.lng.toFixed(precision);if(bearing||pitch)hash+="/"+Math.round(bearing*10)/10;if(pitch)hash+="/"+Math.round(pitch);window.history.replaceState("","",hash)};module.exports=Hash},{"../util/util":723,"../util/window":706}],699:[function(require,module,exports){"use strict";var util=require("../util/util");var browser=require("../util/browser");
var window=require("../util/window");var DOM=require("../util/dom");var Style=require("../style/style");var AnimationLoop=require("../style/animation_loop");var Painter=require("../render/painter");var Transform=require("../geo/transform");var Hash=require("./hash");var bindHandlers=require("./bind_handlers");var Camera=require("./camera");var LngLat=require("../geo/lng_lat");var LngLatBounds=require("../geo/lng_lat_bounds");var Point=require("point-geometry");var AttributionControl=require("./control/attribution_control");var isSupported=require("mapbox-gl-supported");var defaultMinZoom=0;var defaultMaxZoom=20;var defaultOptions={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:defaultMinZoom,maxZoom:defaultMaxZoom,interactive:true,scrollZoom:true,boxZoom:true,dragRotate:true,dragPan:true,keyboard:true,doubleClickZoom:true,touchZoomRotate:true,bearingSnap:7,hash:false,attributionControl:true,failIfMajorPerformanceCaveat:false,preserveDrawingBuffer:false,trackResize:true,renderWorldCopies:true};var Map=function(Camera){function Map(options){var this$1=this;options=util.extend({},defaultOptions,options);var transform=new Transform(options.minZoom,options.maxZoom,options.renderWorldCopies);Camera.call(this,transform,options);this._interactive=options.interactive;this._failIfMajorPerformanceCaveat=options.failIfMajorPerformanceCaveat;this._preserveDrawingBuffer=options.preserveDrawingBuffer;this._trackResize=options.trackResize;this._bearingSnap=options.bearingSnap;if(typeof options.container==="string"){this._container=window.document.getElementById(options.container);if(!this._container)throw new Error("Container '"+options.container+"' not found.")}else{this._container=options.container}this.animationLoop=new AnimationLoop;if(options.maxBounds){this.setMaxBounds(options.maxBounds)}util.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this);this._setupContainer();this._setupPainter();this.on("move",this._update.bind(this,false));this.on("zoom",this._update.bind(this,true));this.on("moveend",function(){this$1.animationLoop.set(300);this$1._rerender()});if(typeof window!=="undefined"){window.addEventListener("online",this._onWindowOnline,false);window.addEventListener("resize",this._onWindowResize,false)}bindHandlers(this,options);this._hash=options.hash&&(new Hash).addTo(this);if(!this._hash||!this._hash._onHashChange()){this.jumpTo({center:options.center,zoom:options.zoom,bearing:options.bearing,pitch:options.pitch})}this._classes=[];this.resize();if(options.classes)this.setClasses(options.classes);if(options.style)this.setStyle(options.style);if(options.attributionControl)this.addControl(new AttributionControl);this.on("style.load",function(){if(this.transform.unmodified){this.jumpTo(this.style.stylesheet)}this.style.update(this._classes,{transition:false})});this.on("data",this._onData);this.on("dataloading",this._onDataLoading)}if(Camera)Map.__proto__=Camera;Map.prototype=Object.create(Camera&&Camera.prototype);Map.prototype.constructor=Map;var prototypeAccessors={showTileBoundaries:{},showCollisionBoxes:{},showOverdrawInspector:{},repaint:{},vertices:{}};Map.prototype.addControl=function addControl(control,position){if(position===undefined&&control.getDefaultPosition){position=control.getDefaultPosition()}if(position===undefined){position="top-right"}var controlElement=control.onAdd(this);var positionContainer=this._controlPositions[position];if(position.indexOf("bottom")!==-1){positionContainer.insertBefore(controlElement,positionContainer.firstChild)}else{positionContainer.appendChild(controlElement)}return this};Map.prototype.removeControl=function removeControl(control){control.onRemove(this);return this};Map.prototype.addClass=function addClass(klass,options){if(this._classes.indexOf(klass)>=0||klass==="")return this;this._classes.push(klass);this._classOptions=options;if(this.style)this.style.updateClasses();return this._update(true)};Map.prototype.removeClass=function removeClass(klass,options){var i=this._classes.indexOf(klass);if(i<0||klass==="")return this;this._classes.splice(i,1);this._classOptions=options;if(this.style)this.style.updateClasses();return this._update(true)};Map.prototype.setClasses=function setClasses(klasses,options){var uniqueClasses={};for(var i=0;i<klasses.length;i++){if(klasses[i]!=="")uniqueClasses[klasses[i]]=true}this._classes=Object.keys(uniqueClasses);this._classOptions=options;if(this.style)this.style.updateClasses();return this._update(true)};Map.prototype.hasClass=function hasClass(klass){return this._classes.indexOf(klass)>=0};Map.prototype.getClasses=function getClasses(){return this._classes};Map.prototype.resize=function resize(){var dimensions=this._containerDimensions();var width=dimensions[0];var height=dimensions[1];this._resizeCanvas(width,height);this.transform.resize(width,height);this.painter.resize(width,height);return this.fire("movestart").fire("move").fire("resize").fire("moveend")};Map.prototype.getBounds=function getBounds(){var bounds=new LngLatBounds(this.transform.pointLocation(new Point(0,this.transform.height)),this.transform.pointLocation(new Point(this.transform.width,0)));if(this.transform.angle||this.transform.pitch){bounds.extend(this.transform.pointLocation(new Point(this.transform.size.x,0)));bounds.extend(this.transform.pointLocation(new Point(0,this.transform.size.y)))}return bounds};Map.prototype.setMaxBounds=function setMaxBounds(lnglatbounds){if(lnglatbounds){var b=LngLatBounds.convert(lnglatbounds);this.transform.lngRange=[b.getWest(),b.getEast()];this.transform.latRange=[b.getSouth(),b.getNorth()];this.transform._constrain();this._update()}else if(lnglatbounds===null||lnglatbounds===undefined){this.transform.lngRange=[];this.transform.latRange=[];this._update()}return this};Map.prototype.setMinZoom=function setMinZoom(minZoom){minZoom=minZoom===null||minZoom===undefined?defaultMinZoom:minZoom;if(minZoom>=defaultMinZoom&&minZoom<=this.transform.maxZoom){this.transform.minZoom=minZoom;this._update();if(this.getZoom()<minZoom)this.setZoom(minZoom);return this}else throw new Error("minZoom must be between "+defaultMinZoom+" and the current maxZoom, inclusive")};Map.prototype.getMinZoom=function getMinZoom(){return this.transform.minZoom};Map.prototype.setMaxZoom=function setMaxZoom(maxZoom){maxZoom=maxZoom===null||maxZoom===undefined?defaultMaxZoom:maxZoom;if(maxZoom>=this.transform.minZoom){this.transform.maxZoom=maxZoom;this._update();if(this.getZoom()>maxZoom)this.setZoom(maxZoom);return this}else throw new Error("maxZoom must be greater than the current minZoom")};Map.prototype.getMaxZoom=function getMaxZoom(){return this.transform.maxZoom};Map.prototype.project=function project(lnglat){return this.transform.locationPoint(LngLat.convert(lnglat))};Map.prototype.unproject=function unproject(point){return this.transform.pointLocation(Point.convert(point))};Map.prototype.queryRenderedFeatures=function queryRenderedFeatures(){var params={};var geometry;if(arguments.length===2){geometry=arguments[0];params=arguments[1]}else if(arguments.length===1&&isPointLike(arguments[0])){geometry=arguments[0]}else if(arguments.length===1){params=arguments[0]}return this.style.queryRenderedFeatures(this._makeQueryGeometry(geometry),params,this.transform.zoom,this.transform.angle);function isPointLike(input){return input instanceof Point||Array.isArray(input)}};Map.prototype._makeQueryGeometry=function _makeQueryGeometry(pointOrBox){var this$1=this;if(pointOrBox===undefined){pointOrBox=[Point.convert([0,0]),Point.convert([this.transform.width,this.transform.height])]}var queryGeometry;var isPoint=pointOrBox instanceof Point||typeof pointOrBox[0]==="number";if(isPoint){var point=Point.convert(pointOrBox);queryGeometry=[point]}else{var box=[Point.convert(pointOrBox[0]),Point.convert(pointOrBox[1])];queryGeometry=[box[0],new Point(box[1].x,box[0].y),box[1],new Point(box[0].x,box[1].y),box[0]]}queryGeometry=queryGeometry.map(function(p){return this$1.transform.pointCoordinate(p)});return queryGeometry};Map.prototype.querySourceFeatures=function querySourceFeatures(sourceID,parameters){return this.style.querySourceFeatures(sourceID,parameters)};Map.prototype.setStyle=function setStyle(style,options){var shouldTryDiff=(!options||options.diff!==false)&&this.style&&style&&!(style instanceof Style)&&typeof style!=="string";if(shouldTryDiff){try{if(this.style.setState(style)){this._update(true)}return this}catch(e){util.warnOnce("Unable to perform style diff: "+(e.message||e.error||e)+".  Rebuilding the style from scratch.")}}if(this.style){this.style.setEventedParent(null);this.style._remove();this.off("rotate",this.style._redoPlacement);this.off("pitch",this.style._redoPlacement)}if(!style){this.style=null;return this}else if(style instanceof Style){this.style=style}else{this.style=new Style(style,this)}this.style.setEventedParent(this,{style:this.style});this.on("rotate",this.style._redoPlacement);this.on("pitch",this.style._redoPlacement);return this};Map.prototype.getStyle=function getStyle(){if(this.style){return this.style.serialize()}};Map.prototype.addSource=function addSource(id,source){this.style.addSource(id,source);this._update(true);return this};Map.prototype.addSourceType=function addSourceType(name,SourceType,callback){return this.style.addSourceType(name,SourceType,callback)};Map.prototype.removeSource=function removeSource(id){this.style.removeSource(id);this._update(true);return this};Map.prototype.getSource=function getSource(id){return this.style.getSource(id)};Map.prototype.addLayer=function addLayer(layer,before){this.style.addLayer(layer,before);this._update(true);return this};Map.prototype.moveLayer=function moveLayer(id,beforeId){this.style.moveLayer(id,beforeId);this._update(true);return this};Map.prototype.removeLayer=function removeLayer(id){this.style.removeLayer(id);this._update(true);return this};Map.prototype.getLayer=function getLayer(id){return this.style.getLayer(id)};Map.prototype.setFilter=function setFilter(layer,filter){this.style.setFilter(layer,filter);this._update(true);return this};Map.prototype.setLayerZoomRange=function setLayerZoomRange(layerId,minzoom,maxzoom){this.style.setLayerZoomRange(layerId,minzoom,maxzoom);this._update(true);return this};Map.prototype.getFilter=function getFilter(layer){return this.style.getFilter(layer)};Map.prototype.setPaintProperty=function setPaintProperty(layer,name,value,klass){this.style.setPaintProperty(layer,name,value,klass);this._update(true);return this};Map.prototype.getPaintProperty=function getPaintProperty(layer,name,klass){return this.style.getPaintProperty(layer,name,klass)};Map.prototype.setLayoutProperty=function setLayoutProperty(layer,name,value){this.style.setLayoutProperty(layer,name,value);this._update(true);return this};Map.prototype.getLayoutProperty=function getLayoutProperty(layer,name){return this.style.getLayoutProperty(layer,name)};Map.prototype.setLight=function setLight(lightOptions){this.style.setLight(lightOptions);this._update(true);return this};Map.prototype.getLight=function getLight(){return this.style.getLight()};Map.prototype.getContainer=function getContainer(){return this._container};Map.prototype.getCanvasContainer=function getCanvasContainer(){return this._canvasContainer};Map.prototype.getCanvas=function getCanvas(){return this._canvas};Map.prototype._containerDimensions=function _containerDimensions(){var width=0;var height=0;if(this._container){width=this._container.offsetWidth||400;height=this._container.offsetHeight||300}return[width,height]};Map.prototype._setupContainer=function _setupContainer(){var container=this._container;container.classList.add("mapboxgl-map");var canvasContainer=this._canvasContainer=DOM.create("div","mapboxgl-canvas-container",container);if(this._interactive){canvasContainer.classList.add("mapboxgl-interactive")}this._canvas=DOM.create("canvas","mapboxgl-canvas",canvasContainer);this._canvas.style.position="absolute";this._canvas.addEventListener("webglcontextlost",this._contextLost,false);this._canvas.addEventListener("webglcontextrestored",this._contextRestored,false);this._canvas.setAttribute("tabindex",0);this._canvas.setAttribute("aria-label","Map");var dimensions=this._containerDimensions();this._resizeCanvas(dimensions[0],dimensions[1]);var controlContainer=this._controlContainer=DOM.create("div","mapboxgl-control-container",container);var positions=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(positionName){positions[positionName]=DOM.create("div","mapboxgl-ctrl-"+positionName,controlContainer)})};Map.prototype._resizeCanvas=function _resizeCanvas(width,height){var pixelRatio=window.devicePixelRatio||1;this._canvas.width=pixelRatio*width;this._canvas.height=pixelRatio*height;this._canvas.style.width=width+"px";this._canvas.style.height=height+"px"};Map.prototype._setupPainter=function _setupPainter(){var attributes=util.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},isSupported.webGLContextAttributes);var gl=this._canvas.getContext("webgl",attributes)||this._canvas.getContext("experimental-webgl",attributes);if(!gl){this.fire("error",{error:new Error("Failed to initialize WebGL")});return}var MAX_RENDERBUFFER_SIZE=gl.getParameter(gl.MAX_RENDERBUFFER_SIZE)/2;if(this._canvas.width>MAX_RENDERBUFFER_SIZE||this._canvas.height>MAX_RENDERBUFFER_SIZE){throw new Error("Map canvas ("+this._canvas.width+"x"+this._canvas.height+") "+"is larger than half of gl.MAX_RENDERBUFFER_SIZE ("+MAX_RENDERBUFFER_SIZE+")")}this.painter=new Painter(gl,this.transform)};Map.prototype._contextLost=function _contextLost(event){event.preventDefault();if(this._frameId){browser.cancelFrame(this._frameId)}this.fire("webglcontextlost",{originalEvent:event})};Map.prototype._contextRestored=function _contextRestored(event){this._setupPainter();this.resize();this._update();this.fire("webglcontextrestored",{originalEvent:event})};Map.prototype.loaded=function loaded(){if(this._styleDirty||this._sourcesDirty)return false;if(!this.style||!this.style.loaded())return false;return true};Map.prototype._update=function _update(updateStyle){if(!this.style)return this;this._styleDirty=this._styleDirty||updateStyle;this._sourcesDirty=true;this._rerender();return this};Map.prototype._render=function _render(){if(this.style&&this._styleDirty){this._styleDirty=false;this.style.update(this._classes,this._classOptions);this._classOptions=null;this.style._recalculate(this.transform.zoom)}if(this.style&&this._sourcesDirty){this._sourcesDirty=false;this.style._updateSources(this.transform)}this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.rotating,zooming:this.zooming});this.fire("render");if(this.loaded()&&!this._loaded){this._loaded=true;this.fire("load")}this._frameId=null;if(!this.animationLoop.stopped()){this._styleDirty=true}if(this._sourcesDirty||this._repaint||this._styleDirty){this._rerender()}return this};Map.prototype.remove=function remove(){if(this._hash)this._hash.remove();browser.cancelFrame(this._frameId);this.setStyle(null);if(typeof window!=="undefined"){window.removeEventListener("resize",this._onWindowResize,false)}var extension=this.painter.gl.getExtension("WEBGL_lose_context");if(extension)extension.loseContext();removeNode(this._canvasContainer);removeNode(this._controlContainer);this._container.classList.remove("mapboxgl-map");this.fire("remove")};Map.prototype._rerender=function _rerender(){if(this.style&&!this._frameId){this._frameId=browser.frame(this._render)}};Map.prototype._onWindowOnline=function _onWindowOnline(){this._update()};Map.prototype._onWindowResize=function _onWindowResize(){if(this._trackResize){this.stop().resize()._update()}};prototypeAccessors.showTileBoundaries.get=function(){return!!this._showTileBoundaries};prototypeAccessors.showTileBoundaries.set=function(value){if(this._showTileBoundaries===value)return;this._showTileBoundaries=value;this._update()};prototypeAccessors.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes};prototypeAccessors.showCollisionBoxes.set=function(value){if(this._showCollisionBoxes===value)return;this._showCollisionBoxes=value;this.style._redoPlacement()};prototypeAccessors.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector};prototypeAccessors.showOverdrawInspector.set=function(value){if(this._showOverdrawInspector===value)return;this._showOverdrawInspector=value;this._update()};prototypeAccessors.repaint.get=function(){return!!this._repaint};prototypeAccessors.repaint.set=function(value){this._repaint=value;this._update()};prototypeAccessors.vertices.get=function(){return!!this._vertices};prototypeAccessors.vertices.set=function(value){this._vertices=value;this._update()};Map.prototype._onData=function _onData(event){this._update(event.dataType==="style");this.fire(event.dataType+"data",event)};Map.prototype._onDataLoading=function _onDataLoading(event){this.fire(event.dataType+"dataloading",event)};Object.defineProperties(Map.prototype,prototypeAccessors);return Map}(Camera);module.exports=Map;function removeNode(node){if(node.parentNode){node.parentNode.removeChild(node)}}},{"../geo/lng_lat":615,"../geo/lng_lat_bounds":616,"../geo/transform":617,"../render/painter":632,"../style/animation_loop":653,"../style/style":657,"../util/browser":704,"../util/dom":711,"../util/util":723,"../util/window":706,"./bind_handlers":685,"./camera":686,"./control/attribution_control":687,"./hash":698,"mapbox-gl-supported":596,"point-geometry":769}],700:[function(require,module,exports){"use strict";var DOM=require("../util/dom");var LngLat=require("../geo/lng_lat");var Point=require("point-geometry");var Marker=function Marker(element,options){this._offset=Point.convert(options&&options.offset||[0,0]);this._update=this._update.bind(this);this._onMapClick=this._onMapClick.bind(this);if(!element)element=DOM.create("div");element.classList.add("mapboxgl-marker");this._element=element;this._popup=null};Marker.prototype.addTo=function addTo(map){this.remove();this._map=map;map.getCanvasContainer().appendChild(this._element);map.on("move",this._update);map.on("moveend",this._update);this._update();this._map.on("click",this._onMapClick);return this};Marker.prototype.remove=function remove(){if(this._map){this._map.off("click",this._onMapClick);this._map.off("move",this._update);this._map.off("moveend",this._update);this._map=null}DOM.remove(this._element);if(this._popup)this._popup.remove();return this};Marker.prototype.getLngLat=function getLngLat(){return this._lngLat};Marker.prototype.setLngLat=function setLngLat(lnglat){this._lngLat=LngLat.convert(lnglat);if(this._popup)this._popup.setLngLat(this._lngLat);this._update();return this};Marker.prototype.getElement=function getElement(){return this._element};Marker.prototype.setPopup=function setPopup(popup){if(this._popup){this._popup.remove();this._popup=null}if(popup){this._popup=popup;this._popup.setLngLat(this._lngLat)}return this};Marker.prototype._onMapClick=function _onMapClick(event){var targetElement=event.originalEvent.target;var element=this._element;if(this._popup&&(targetElement===element||element.contains(targetElement))){this.togglePopup()}};Marker.prototype.getPopup=function getPopup(){return this._popup};Marker.prototype.togglePopup=function togglePopup(){var popup=this._popup;if(!popup)return;else if(popup.isOpen())popup.remove();else popup.addTo(this._map)};Marker.prototype._update=function _update(e){if(!this._map)return;var pos=this._map.project(this._lngLat)._add(this._offset);if(!e||e.type==="moveend")pos=pos.round();DOM.setTransform(this._element,"translate("+pos.x+"px, "+pos.y+"px)")};module.exports=Marker},{"../geo/lng_lat":615,"../util/dom":711,"point-geometry":769}],701:[function(require,module,exports){"use strict";var util=require("../util/util");var Evented=require("../util/evented");var DOM=require("../util/dom");var LngLat=require("../geo/lng_lat");var Point=require("point-geometry");var window=require("../util/window");var defaultOptions={closeButton:true,closeOnClick:true};var Popup=function(Evented){function Popup(options){Evented.call(this);this.options=util.extend(Object.create(defaultOptions),options);util.bindAll(["_update","_onClickClose"],this)}if(Evented)Popup.__proto__=Evented;Popup.prototype=Object.create(Evented&&Evented.prototype);Popup.prototype.constructor=Popup;Popup.prototype.addTo=function addTo(map){this._map=map;this._map.on("move",this._update);if(this.options.closeOnClick){this._map.on("click",this._onClickClose)}this._update();return this};Popup.prototype.isOpen=function isOpen(){return!!this._map};Popup.prototype.remove=function remove(){if(this._content&&this._content.parentNode){this._content.parentNode.removeChild(this._content)}if(this._container){this._container.parentNode.removeChild(this._container);delete this._container}if(this._map){this._map.off("move",this._update);this._map.off("click",this._onClickClose);delete this._map}this.fire("close");return this};Popup.prototype.getLngLat=function getLngLat(){return this._lngLat};Popup.prototype.setLngLat=function setLngLat(lnglat){this._lngLat=LngLat.convert(lnglat);this._update();return this};Popup.prototype.setText=function setText(text){return this.setDOMContent(window.document.createTextNode(text))};Popup.prototype.setHTML=function setHTML(html){var frag=window.document.createDocumentFragment();var temp=window.document.createElement("body");var child;temp.innerHTML=html;while(true){child=temp.firstChild;if(!child)break;frag.appendChild(child)}return this.setDOMContent(frag)};Popup.prototype.setDOMContent=function setDOMContent(htmlNode){this._createContent();this._content.appendChild(htmlNode);this._update();return this};Popup.prototype._createContent=function _createContent(){if(this._content&&this._content.parentNode){this._content.parentNode.removeChild(this._content)}this._content=DOM.create("div","mapboxgl-popup-content",this._container);if(this.options.closeButton){this._closeButton=DOM.create("button","mapboxgl-popup-close-button",this._content);this._closeButton.type="button";this._closeButton.innerHTML="&#215;";this._closeButton.addEventListener("click",this._onClickClose)}};Popup.prototype._update=function _update(){if(!this._map||!this._lngLat||!this._content){return}if(!this._container){this._container=DOM.create("div","mapboxgl-popup",this._map.getContainer());this._tip=DOM.create("div","mapboxgl-popup-tip",this._container);this._container.appendChild(this._content)}var anchor=this.options.anchor;var offset=normalizeOffset(this.options.offset);var pos=this._map.project(this._lngLat).round();if(!anchor){var width=this._container.offsetWidth,height=this._container.offsetHeight;if(pos.y+offset.bottom.y<height){anchor=["top"]}else if(pos.y>this._map.transform.height-height){anchor=["bottom"]}else{anchor=[]}if(pos.x<width/2){anchor.push("left")}else if(pos.x>this._map.transform.width-width/2){anchor.push("right")}if(anchor.length===0){anchor="bottom"}else{anchor=anchor.join("-")}}var offsetedPos=pos.add(offset[anchor]);var anchorTranslate={top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};var classList=this._container.classList;for(var key in anchorTranslate){classList.remove("mapboxgl-popup-anchor-"+key)}classList.add("mapboxgl-popup-anchor-"+anchor);DOM.setTransform(this._container,anchorTranslate[anchor]+" translate("+offsetedPos.x+"px,"+offsetedPos.y+"px)")};Popup.prototype._onClickClose=function _onClickClose(){this.remove()};return Popup}(Evented);function normalizeOffset(offset){if(!offset){return normalizeOffset(new Point(0,0))}else if(typeof offset==="number"){var cornerOffset=Math.round(Math.sqrt(.5*Math.pow(offset,2)));return{top:new Point(0,offset),"top-left":new Point(cornerOffset,cornerOffset),"top-right":new Point(-cornerOffset,cornerOffset),bottom:new Point(0,-offset),"bottom-left":new Point(cornerOffset,-cornerOffset),"bottom-right":new Point(-cornerOffset,-cornerOffset),left:new Point(offset,0),right:new Point(-offset,0)}}else if(isPointLike(offset)){var convertedOffset=Point.convert(offset);return{top:convertedOffset,"top-left":convertedOffset,"top-right":convertedOffset,bottom:convertedOffset,"bottom-left":convertedOffset,"bottom-right":convertedOffset,left:convertedOffset,right:convertedOffset}}else{return{top:Point.convert(offset["top"]||[0,0]),"top-left":Point.convert(offset["top-left"]||[0,0]),"top-right":Point.convert(offset["top-right"]||[0,0]),bottom:Point.convert(offset["bottom"]||[0,0]),"bottom-left":Point.convert(offset["bottom-left"]||[0,0]),"bottom-right":Point.convert(offset["bottom-right"]||[0,0]),left:Point.convert(offset["left"]||[0,0]),right:Point.convert(offset["right"]||[0,0])}}}function isPointLike(input){return input instanceof Point||Array.isArray(input)}module.exports=Popup},{"../geo/lng_lat":615,"../util/dom":711,"../util/evented":712,"../util/util":723,"../util/window":706,"point-geometry":769}],702:[function(require,module,exports){"use strict";var Actor=function Actor(target,parent,mapId){this.target=target;this.parent=parent;this.mapId=mapId;this.callbacks={};this.callbackID=0;this.receive=this.receive.bind(this);this.target.addEventListener("message",this.receive,false)};Actor.prototype.send=function send(type,data,callback,buffers,targetMapId){var id=callback?this.mapId+":"+this.callbackID++:null;if(callback)this.callbacks[id]=callback;this.target.postMessage({targetMapId:targetMapId,sourceMapId:this.mapId,type:type,id:String(id),data:data},buffers)};Actor.prototype.receive=function receive(message){var this$1=this;var data=message.data,id=data.id;var callback;if(data.targetMapId&&this.mapId!==data.targetMapId)return;var done=function(err,data,buffers){this$1.target.postMessage({sourceMapId:this$1.mapId,type:"<response>",id:String(id),error:err?String(err):null,data:data},buffers)};if(data.type==="<response>"){callback=this.callbacks[data.id];delete this.callbacks[data.id];if(callback)callback(data.error||null,data.data)}else if(typeof data.id!=="undefined"&&this.parent[data.type]){this.parent[data.type](data.sourceMapId,data.data,done)}else if(typeof data.id!=="undefined"&&this.parent.getWorkerSource){var keys=data.type.split(".");var workerSource=this.parent.getWorkerSource(data.sourceMapId,keys[0]);workerSource[keys[1]](data.data,done)}else{this.parent[data.type](data.data)}};Actor.prototype.remove=function remove(){this.target.removeEventListener("message",this.receive,false)};module.exports=Actor},{}],703:[function(require,module,exports){"use strict";var window=require("./window");exports.getJSON=function(url,callback){var xhr=new window.XMLHttpRequest;xhr.open("GET",url,true);xhr.setRequestHeader("Accept","application/json");xhr.onerror=function(e){callback(e)};xhr.onload=function(){if(xhr.status>=200&&xhr.status<300&&xhr.response){var data;try{data=JSON.parse(xhr.response)}catch(err){return callback(err)}callback(null,data)}else{callback(new Error(xhr.statusText))}};xhr.send();return xhr};exports.getArrayBuffer=function(url,callback){var xhr=new window.XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onerror=function(e){callback(e)};xhr.onload=function(){if(xhr.response.byteLength===0&&xhr.status===200){return callback(new Error("http status 200 returned without content."))}if(xhr.status>=200&&xhr.status<300&&xhr.response){callback(null,xhr.response)}else{callback(new Error(xhr.statusText))}};xhr.send();return xhr};function sameOrigin(url){var a=window.document.createElement("a");a.href=url;return a.protocol===window.document.location.protocol&&a.host===window.document.location.host}var transparentPngUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";exports.getImage=function(url,callback){return exports.getArrayBuffer(url,function(err,imgData){if(err)return callback(err);var img=new window.Image;var URL=window.URL||window.webkitURL;img.onload=function(){callback(null,img);URL.revokeObjectURL(img.src)};var blob=new window.Blob([new Uint8Array(imgData)],{type:"image/png"});img.src=imgData.byteLength?URL.createObjectURL(blob):transparentPngUrl})};exports.getVideo=function(urls,callback){var video=window.document.createElement("video");video.onloadstart=function(){callback(null,video)};for(var i=0;i<urls.length;i++){var s=window.document.createElement("source");if(!sameOrigin(urls[i])){video.crossOrigin="Anonymous"}s.src=urls[i];video.appendChild(s)}return video}},{"./window":706}],704:[function(require,module,exports){"use strict";var window=require("./window");module.exports.now=function(){if(window.performance&&window.performance.now){return window.performance.now.bind(window.performance)}else{return Date.now.bind(Date)}}();var frame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;exports.frame=function(fn){return frame(fn)};var cancel=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;exports.cancelFrame=function(id){cancel(id)};exports.timed=function(fn,dur,ctx){if(!dur){fn.call(ctx,1);return null}var abort=false;var start=module.exports.now();function tick(now){if(abort)return;now=module.exports.now();if(now>=start+dur){fn.call(ctx,1)}else{fn.call(ctx,(now-start)/dur);exports.frame(tick)}}exports.frame(tick);return function(){abort=true}};exports.getImageData=function(img){var canvas=window.document.createElement("canvas");var context=canvas.getContext("2d");canvas.width=img.width;canvas.height=img.height;context.drawImage(img,0,0);return context.getImageData(0,0,img.width,img.height).data};exports.supported=require("mapbox-gl-supported");exports.hardwareConcurrency=window.navigator.hardwareConcurrency||4;Object.defineProperty(exports,"devicePixelRatio",{get:function(){return window.devicePixelRatio}});exports.supportsWebp=false;var webpImgTest=window.document.createElement("img");webpImgTest.onload=function(){exports.supportsWebp=true};webpImgTest.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="},{"./window":706,"mapbox-gl-supported":596}],705:[function(require,module,exports){"use strict";var WebWorkify=require("webworkify");var window=require("../window");var workerURL=window.URL.createObjectURL(new WebWorkify(require("../../source/worker"),{bare:true}));module.exports=function(){return new window.Worker(workerURL)}},{"../../source/worker":651,"../window":706,webworkify:1007}],706:[function(require,module,exports){"use strict";module.exports=self},{}],707:[function(require,module,exports){"use strict";var quickselect=require("quickselect");var calculateSignedArea=require("./util").calculateSignedArea;module.exports=function classifyRings(rings,maxRings){var len=rings.length;if(len<=1)return[rings];var polygons=[];var polygon,ccw;for(var i=0;i<len;i++){var area=calculateSignedArea(rings[i]);if(area===0)continue;rings[i].area=Math.abs(area);if(ccw===undefined)ccw=area<0;if(ccw===area<0){if(polygon)polygons.push(polygon);polygon=[rings[i]]}else{polygon.push(rings[i])}}if(polygon)polygons.push(polygon);if(maxRings>1){for(var j=0;j<polygons.length;j++){if(polygons[j].length<=maxRings)continue;quickselect(polygons[j],maxRings,1,polygons[j].length-1,compareAreas);polygons[j]=polygons[j].slice(0,maxRings)}}return polygons};function compareAreas(a,b){return b.area-a.area}},{"./util":723,quickselect:772}],708:[function(require,module,exports){"use strict";var config={API_URL:"https://api.mapbox.com",REQUIRE_ACCESS_TOKEN:true,ACCESS_TOKEN:null};module.exports=config;
},{}],709:[function(require,module,exports){"use strict";var DictionaryCoder=function DictionaryCoder(strings){var this$1=this;this._stringToNumber={};this._numberToString=[];for(var i=0;i<strings.length;i++){var string=strings[i];this$1._stringToNumber[string]=i;this$1._numberToString[i]=string}};DictionaryCoder.prototype.encode=function encode(string){return this._stringToNumber[string]};DictionaryCoder.prototype.decode=function decode(n){return this._numberToString[n]};module.exports=DictionaryCoder},{}],710:[function(require,module,exports){"use strict";var util=require("./util");var Actor=require("./actor");var Dispatcher=function Dispatcher(workerPool,parent){var this$1=this;this.workerPool=workerPool;this.actors=[];this.currentActor=0;this.id=util.uniqueId();var workers=this.workerPool.acquire(this.id);for(var i=0;i<workers.length;i++){var worker=workers[i];var actor=new Actor(worker,parent,this$1.id);actor.name="Worker "+i;this$1.actors.push(actor)}};Dispatcher.prototype.broadcast=function broadcast(type,data,cb){cb=cb||function(){};util.asyncAll(this.actors,function(actor,done){actor.send(type,data,done)},cb)};Dispatcher.prototype.send=function send(type,data,callback,targetID,buffers){if(typeof targetID!=="number"||isNaN(targetID)){targetID=this.currentActor=(this.currentActor+1)%this.actors.length}this.actors[targetID].send(type,data,callback,buffers);return targetID};Dispatcher.prototype.remove=function remove(){this.actors.forEach(function(actor){actor.remove()});this.actors=[];this.workerPool.release(this.id)};module.exports=Dispatcher},{"./actor":702,"./util":723}],711:[function(require,module,exports){"use strict";var Point=require("point-geometry");var window=require("./window");exports.create=function(tagName,className,container){var el=window.document.createElement(tagName);if(className)el.className=className;if(container)container.appendChild(el);return el};var docStyle=window.document.documentElement.style;function testProp(props){for(var i=0;i<props.length;i++){if(props[i]in docStyle){return props[i]}}return props[0]}var selectProp=testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);var userSelect;exports.disableDrag=function(){if(selectProp){userSelect=docStyle[selectProp];docStyle[selectProp]="none"}};exports.enableDrag=function(){if(selectProp){docStyle[selectProp]=userSelect}};var transformProp=testProp(["transform","WebkitTransform"]);exports.setTransform=function(el,value){el.style[transformProp]=value};function suppressClick(e){e.preventDefault();e.stopPropagation();window.removeEventListener("click",suppressClick,true)}exports.suppressClick=function(){window.addEventListener("click",suppressClick,true);window.setTimeout(function(){window.removeEventListener("click",suppressClick,true)},0)};exports.mousePos=function(el,e){var rect=el.getBoundingClientRect();e=e.touches?e.touches[0]:e;return new Point(e.clientX-rect.left-el.clientLeft,e.clientY-rect.top-el.clientTop)};exports.touchPos=function(el,e){var rect=el.getBoundingClientRect(),points=[];var touches=e.type==="touchend"?e.changedTouches:e.touches;for(var i=0;i<touches.length;i++){points.push(new Point(touches[i].clientX-rect.left-el.clientLeft,touches[i].clientY-rect.top-el.clientTop))}return points};exports.remove=function(node){if(node.parentNode){node.parentNode.removeChild(node)}}},{"./window":706,"point-geometry":769}],712:[function(require,module,exports){"use strict";var util=require("./util");var Evented=function Evented(){};Evented.prototype.on=function on(type,listener){this._listeners=this._listeners||{};this._listeners[type]=this._listeners[type]||[];this._listeners[type].push(listener);return this};Evented.prototype.off=function off(type,listener){if(this._listeners&&this._listeners[type]){var index=this._listeners[type].indexOf(listener);if(index!==-1){this._listeners[type].splice(index,1)}}return this};Evented.prototype.once=function once(type,listener){var this$1=this;var wrapper=function(data){this$1.off(type,wrapper);listener.call(this$1,data)};this.on(type,wrapper);return this};Evented.prototype.fire=function fire(type,data){var this$1=this;if(this.listens(type)){data=util.extend({},data,{type:type,target:this});var listeners=this._listeners&&this._listeners[type]?this._listeners[type].slice():[];for(var i=0;i<listeners.length;i++){listeners[i].call(this$1,data)}if(this._eventedParent){this._eventedParent.fire(type,util.extend({},data,this._eventedParentData))}}else if(util.endsWith(type,"error")){console.error(data&&data.error||data||"Empty error event")}return this};Evented.prototype.listens=function listens(type){return this._listeners&&this._listeners[type]||this._eventedParent&&this._eventedParent.listens(type)};Evented.prototype.setEventedParent=function setEventedParent(parent,data){this._eventedParent=parent;this._eventedParentData=typeof data==="function"?data():data;return this};module.exports=Evented},{"./util":723}],713:[function(require,module,exports){"use strict";var Queue=require("tinyqueue");var Point=require("point-geometry");var distToSegmentSquared=require("./intersection_tests").distToSegmentSquared;module.exports=function(polygonRings,precision,debug){precision=precision||1;var minX,minY,maxX,maxY;var outerRing=polygonRings[0];for(var i=0;i<outerRing.length;i++){var p=outerRing[i];if(!i||p.x<minX)minX=p.x;if(!i||p.y<minY)minY=p.y;if(!i||p.x>maxX)maxX=p.x;if(!i||p.y>maxY)maxY=p.y}var width=maxX-minX;var height=maxY-minY;var cellSize=Math.min(width,height);var h=cellSize/2;var cellQueue=new Queue(null,compareMax);for(var x=minX;x<maxX;x+=cellSize){for(var y=minY;y<maxY;y+=cellSize){cellQueue.push(new Cell(x+h,y+h,h,polygonRings))}}var bestCell=getCentroidCell(polygonRings);var numProbes=cellQueue.length;while(cellQueue.length){var cell=cellQueue.pop();if(cell.d>bestCell.d){bestCell=cell;if(debug)console.log("found best %d after %d probes",Math.round(1e4*cell.d)/1e4,numProbes)}if(cell.max-bestCell.d<=precision)continue;h=cell.h/2;cellQueue.push(new Cell(cell.p.x-h,cell.p.y-h,h,polygonRings));cellQueue.push(new Cell(cell.p.x+h,cell.p.y-h,h,polygonRings));cellQueue.push(new Cell(cell.p.x-h,cell.p.y+h,h,polygonRings));cellQueue.push(new Cell(cell.p.x+h,cell.p.y+h,h,polygonRings));numProbes+=4}if(debug){console.log("num probes: "+numProbes);console.log("best distance: "+bestCell.d)}return bestCell.p};function compareMax(a,b){return b.max-a.max}function Cell(x,y,h,polygon){this.p=new Point(x,y);this.h=h;this.d=pointToPolygonDist(this.p,polygon);this.max=this.d+this.h*Math.SQRT2}function pointToPolygonDist(p,polygon){var inside=false;var minDistSq=Infinity;for(var k=0;k<polygon.length;k++){var ring=polygon[k];for(var i=0,len=ring.length,j=len-1;i<len;j=i++){var a=ring[i];var b=ring[j];if(a.y>p.y!==b.y>p.y&&p.x<(b.x-a.x)*(p.y-a.y)/(b.y-a.y)+a.x)inside=!inside;minDistSq=Math.min(minDistSq,distToSegmentSquared(p,a,b))}}return(inside?1:-1)*Math.sqrt(minDistSq)}function getCentroidCell(polygon){var area=0;var x=0;var y=0;var points=polygon[0];for(var i=0,len=points.length,j=len-1;i<len;j=i++){var a=points[i];var b=points[j];var f=a.x*b.y-b.x*a.y;x+=(a.x+b.x)*f;y+=(a.y+b.y)*f;area+=f*3}return new Cell(x/area,y/area,0,polygon)}},{"./intersection_tests":716,"point-geometry":769,tinyqueue:989}],714:[function(require,module,exports){"use strict";module.exports=Glyphs;function Glyphs(pbf,end){this.stacks=pbf.readFields(readFontstacks,[],end)}function readFontstacks(tag,stacks,pbf){if(tag===1){var fontstack=pbf.readMessage(readFontstack,{glyphs:{}});stacks.push(fontstack)}}function readFontstack(tag,fontstack,pbf){if(tag===1)fontstack.name=pbf.readString();else if(tag===2)fontstack.range=pbf.readString();else if(tag===3){var glyph=pbf.readMessage(readGlyph,{});fontstack.glyphs[glyph.id]=glyph}}function readGlyph(tag,glyph,pbf){if(tag===1)glyph.id=pbf.readVarint();else if(tag===2)glyph.bitmap=pbf.readBytes();else if(tag===3)glyph.width=pbf.readVarint();else if(tag===4)glyph.height=pbf.readVarint();else if(tag===5)glyph.left=pbf.readSVarint();else if(tag===6)glyph.top=pbf.readSVarint();else if(tag===7)glyph.advance=pbf.readVarint()}},{}],715:[function(require,module,exports){"use strict";module.exports=interpolate;function interpolate(a,b,t){return a*(1-t)+b*t}interpolate.number=interpolate;interpolate.vec2=function(from,to,t){return[interpolate(from[0],to[0],t),interpolate(from[1],to[1],t)]};interpolate.color=function(from,to,t){return[interpolate(from[0],to[0],t),interpolate(from[1],to[1],t),interpolate(from[2],to[2],t),interpolate(from[3],to[3],t)]};interpolate.array=function(from,to,t){return from.map(function(d,i){return interpolate(d,to[i],t)})}},{}],716:[function(require,module,exports){"use strict";var isCounterClockwise=require("./util").isCounterClockwise;module.exports={multiPolygonIntersectsBufferedMultiPoint:multiPolygonIntersectsBufferedMultiPoint,multiPolygonIntersectsMultiPolygon:multiPolygonIntersectsMultiPolygon,multiPolygonIntersectsBufferedMultiLine:multiPolygonIntersectsBufferedMultiLine,polygonIntersectsPolygon:polygonIntersectsPolygon,distToSegmentSquared:distToSegmentSquared};function polygonIntersectsPolygon(polygonA,polygonB){for(var i=0;i<polygonA.length;i++){if(polygonContainsPoint(polygonB,polygonA[i]))return true}for(var i$1=0;i$1<polygonB.length;i$1++){if(polygonContainsPoint(polygonA,polygonB[i$1]))return true}if(lineIntersectsLine(polygonA,polygonB))return true;return false}function multiPolygonIntersectsBufferedMultiPoint(multiPolygon,rings,radius){for(var j=0;j<multiPolygon.length;j++){var polygon=multiPolygon[j];for(var i=0;i<rings.length;i++){var ring=rings[i];for(var k=0;k<ring.length;k++){var point=ring[k];if(polygonContainsPoint(polygon,point))return true;if(pointIntersectsBufferedLine(point,polygon,radius))return true}}}return false}function multiPolygonIntersectsMultiPolygon(multiPolygonA,multiPolygonB){if(multiPolygonA.length===1&&multiPolygonA[0].length===1){return multiPolygonContainsPoint(multiPolygonB,multiPolygonA[0][0])}for(var m=0;m<multiPolygonB.length;m++){var ring=multiPolygonB[m];for(var n=0;n<ring.length;n++){if(multiPolygonContainsPoint(multiPolygonA,ring[n]))return true}}for(var j=0;j<multiPolygonA.length;j++){var polygon=multiPolygonA[j];for(var i=0;i<polygon.length;i++){if(multiPolygonContainsPoint(multiPolygonB,polygon[i]))return true}for(var k=0;k<multiPolygonB.length;k++){if(lineIntersectsLine(polygon,multiPolygonB[k]))return true}}return false}function multiPolygonIntersectsBufferedMultiLine(multiPolygon,multiLine,radius){for(var i=0;i<multiLine.length;i++){var line=multiLine[i];for(var j=0;j<multiPolygon.length;j++){var polygon=multiPolygon[j];if(polygon.length>=3){for(var k=0;k<line.length;k++){if(polygonContainsPoint(polygon,line[k]))return true}}if(lineIntersectsBufferedLine(polygon,line,radius))return true}}return false}function lineIntersectsBufferedLine(lineA,lineB,radius){if(lineA.length>1){if(lineIntersectsLine(lineA,lineB))return true;for(var j=0;j<lineB.length;j++){if(pointIntersectsBufferedLine(lineB[j],lineA,radius))return true}}for(var k=0;k<lineA.length;k++){if(pointIntersectsBufferedLine(lineA[k],lineB,radius))return true}return false}function lineIntersectsLine(lineA,lineB){if(lineA.length===0||lineB.length===0)return false;for(var i=0;i<lineA.length-1;i++){var a0=lineA[i];var a1=lineA[i+1];for(var j=0;j<lineB.length-1;j++){var b0=lineB[j];var b1=lineB[j+1];if(lineSegmentIntersectsLineSegment(a0,a1,b0,b1))return true}}return false}function lineSegmentIntersectsLineSegment(a0,a1,b0,b1){return isCounterClockwise(a0,b0,b1)!==isCounterClockwise(a1,b0,b1)&&isCounterClockwise(a0,a1,b0)!==isCounterClockwise(a0,a1,b1)}function pointIntersectsBufferedLine(p,line,radius){var radiusSquared=radius*radius;if(line.length===1)return p.distSqr(line[0])<radiusSquared;for(var i=1;i<line.length;i++){var v=line[i-1],w=line[i];if(distToSegmentSquared(p,v,w)<radiusSquared)return true}return false}function distToSegmentSquared(p,v,w){var l2=v.distSqr(w);if(l2===0)return p.distSqr(v);var t=((p.x-v.x)*(w.x-v.x)+(p.y-v.y)*(w.y-v.y))/l2;if(t<0)return p.distSqr(v);if(t>1)return p.distSqr(w);return p.distSqr(w.sub(v)._mult(t)._add(v))}function multiPolygonContainsPoint(rings,p){var c=false,ring,p1,p2;for(var k=0;k<rings.length;k++){ring=rings[k];for(var i=0,j=ring.length-1;i<ring.length;j=i++){p1=ring[i];p2=ring[j];if(p1.y>p.y!==p2.y>p.y&&p.x<(p2.x-p1.x)*(p.y-p1.y)/(p2.y-p1.y)+p1.x){c=!c}}}return c}function polygonContainsPoint(ring,p){var c=false;for(var i=0,j=ring.length-1;i<ring.length;j=i++){var p1=ring[i];var p2=ring[j];if(p1.y>p.y!==p2.y>p.y&&p.x<(p2.x-p1.x)*(p.y-p1.y)/(p2.y-p1.y)+p1.x){c=!c}}return c}},{"./util":723}],717:[function(require,module,exports){"use strict";var unicodeBlockLookup={"Latin-1 Supplement":function(char){return char>=128&&char<=255},"Hangul Jamo":function(char){return char>=4352&&char<=4607},"Unified Canadian Aboriginal Syllabics":function(char){return char>=5120&&char<=5759},"Unified Canadian Aboriginal Syllabics Extended":function(char){return char>=6320&&char<=6399},"General Punctuation":function(char){return char>=8192&&char<=8303},"Letterlike Symbols":function(char){return char>=8448&&char<=8527},"Number Forms":function(char){return char>=8528&&char<=8591},"Miscellaneous Technical":function(char){return char>=8960&&char<=9215},"Control Pictures":function(char){return char>=9216&&char<=9279},"Optical Character Recognition":function(char){return char>=9280&&char<=9311},"Enclosed Alphanumerics":function(char){return char>=9312&&char<=9471},"Geometric Shapes":function(char){return char>=9632&&char<=9727},"Miscellaneous Symbols":function(char){return char>=9728&&char<=9983},"Miscellaneous Symbols and Arrows":function(char){return char>=11008&&char<=11263},"CJK Radicals Supplement":function(char){return char>=11904&&char<=12031},"Kangxi Radicals":function(char){return char>=12032&&char<=12255},"Ideographic Description Characters":function(char){return char>=12272&&char<=12287},"CJK Symbols and Punctuation":function(char){return char>=12288&&char<=12351},Hiragana:function(char){return char>=12352&&char<=12447},Katakana:function(char){return char>=12448&&char<=12543},Bopomofo:function(char){return char>=12544&&char<=12591},"Hangul Compatibility Jamo":function(char){return char>=12592&&char<=12687},Kanbun:function(char){return char>=12688&&char<=12703},"Bopomofo Extended":function(char){return char>=12704&&char<=12735},"CJK Strokes":function(char){return char>=12736&&char<=12783},"Katakana Phonetic Extensions":function(char){return char>=12784&&char<=12799},"Enclosed CJK Letters and Months":function(char){return char>=12800&&char<=13055},"CJK Compatibility":function(char){return char>=13056&&char<=13311},"CJK Unified Ideographs Extension A":function(char){return char>=13312&&char<=19903},"Yijing Hexagram Symbols":function(char){return char>=19904&&char<=19967},"CJK Unified Ideographs":function(char){return char>=19968&&char<=40959},"Yi Syllables":function(char){return char>=40960&&char<=42127},"Yi Radicals":function(char){return char>=42128&&char<=42191},"Hangul Jamo Extended-A":function(char){return char>=43360&&char<=43391},"Hangul Syllables":function(char){return char>=44032&&char<=55215},"Hangul Jamo Extended-B":function(char){return char>=55216&&char<=55295},"Private Use Area":function(char){return char>=57344&&char<=63743},"CJK Compatibility Ideographs":function(char){return char>=63744&&char<=64255},"Vertical Forms":function(char){return char>=65040&&char<=65055},"CJK Compatibility Forms":function(char){return char>=65072&&char<=65103},"Small Form Variants":function(char){return char>=65104&&char<=65135},"Halfwidth and Fullwidth Forms":function(char){return char>=65280&&char<=65519}};module.exports=unicodeBlockLookup},{}],718:[function(require,module,exports){"use strict";var LRUCache=function LRUCache(max,onRemove){this.max=max;this.onRemove=onRemove;this.reset()};LRUCache.prototype.reset=function reset(){var this$1=this;for(var key in this.data){this$1.onRemove(this$1.data[key])}this.data={};this.order=[];return this};LRUCache.prototype.add=function add(key,data){if(this.has(key)){this.order.splice(this.order.indexOf(key),1);this.data[key]=data;this.order.push(key)}else{this.data[key]=data;this.order.push(key);if(this.order.length>this.max){var removedData=this.get(this.order[0]);if(removedData)this.onRemove(removedData)}}return this};LRUCache.prototype.has=function has(key){return key in this.data};LRUCache.prototype.keys=function keys(){return this.order};LRUCache.prototype.get=function get(key){if(!this.has(key)){return null}var data=this.data[key];delete this.data[key];this.order.splice(this.order.indexOf(key),1);return data};LRUCache.prototype.setMaxSize=function setMaxSize(max){var this$1=this;this.max=max;while(this.order.length>this.max){var removedData=this$1.get(this$1.order[0]);if(removedData)this$1.onRemove(removedData)}return this};module.exports=LRUCache},{}],719:[function(require,module,exports){"use strict";var config=require("./config");var browser=require("./browser");var help="See https://www.mapbox.com/developers/api/#access-tokens";function makeAPIURL(urlObject,accessToken){var apiUrlObject=parseUrl(config.API_URL);urlObject.protocol=apiUrlObject.protocol;urlObject.authority=apiUrlObject.authority;if(!config.REQUIRE_ACCESS_TOKEN)return formatUrl(urlObject);accessToken=accessToken||config.ACCESS_TOKEN;if(!accessToken)throw new Error("An API access token is required to use Mapbox GL. "+help);if(accessToken[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+help);urlObject.params.push("access_token="+accessToken);return formatUrl(urlObject)}function isMapboxURL(url){return url.indexOf("mapbox:")===0}exports.isMapboxURL=isMapboxURL;exports.normalizeStyleURL=function(url,accessToken){if(!isMapboxURL(url))return url;var urlObject=parseUrl(url);urlObject.path="/styles/v1"+urlObject.path;return makeAPIURL(urlObject,accessToken)};exports.normalizeGlyphsURL=function(url,accessToken){if(!isMapboxURL(url))return url;var urlObject=parseUrl(url);urlObject.path="/fonts/v1"+urlObject.path;return makeAPIURL(urlObject,accessToken)};exports.normalizeSourceURL=function(url,accessToken){if(!isMapboxURL(url))return url;var urlObject=parseUrl(url);urlObject.path="/v4/"+urlObject.authority+".json";urlObject.params.push("secure");return makeAPIURL(urlObject,accessToken)};exports.normalizeSpriteURL=function(url,format,extension,accessToken){var urlObject=parseUrl(url);if(!isMapboxURL(url)){urlObject.path+=""+format+extension;return formatUrl(urlObject)}urlObject.path="/styles/v1"+urlObject.path+"/sprite"+format+extension;return makeAPIURL(urlObject,accessToken)};var imageExtensionRe=/(\.(png|jpg)\d*)(?=$)/;exports.normalizeTileURL=function(tileURL,sourceURL,tileSize){if(!sourceURL||!isMapboxURL(sourceURL))return tileURL;var urlObject=parseUrl(tileURL);var suffix=browser.devicePixelRatio>=2||tileSize===512?"@2x":"";var extension=browser.supportsWebp?".webp":"$1";urlObject.path=urlObject.path.replace(imageExtensionRe,""+suffix+extension);replaceTempAccessToken(urlObject.params);return formatUrl(urlObject)};function replaceTempAccessToken(params){for(var i=0;i<params.length;i++){if(params[i].indexOf("access_token=tk.")===0){params[i]="access_token="+(config.ACCESS_TOKEN||"")}}}var urlRe=/^(\w+):\/\/([^\/?]+)(\/[^?]+)?\??(.+)?/;function parseUrl(url){var parts=url.match(urlRe);if(!parts){throw new Error("Unable to parse URL object")}return{protocol:parts[1],authority:parts[2],path:parts[3]||"/",params:parts[4]?parts[4].split("&"):[]}}function formatUrl(obj){var params=obj.params.length?"?"+obj.params.join("&"):"";return obj.protocol+"://"+obj.authority+obj.path+params}},{"./browser":704,"./config":708}],720:[function(require,module,exports){"use strict";var isChar=require("./is_char_in_unicode_block");module.exports.allowsIdeographicBreaking=function(chars){for(var i=0,list=chars;i<list.length;i+=1){var char=list[i];if(!exports.charAllowsIdeographicBreaking(char.charCodeAt(0)))return false}return true};module.exports.allowsVerticalWritingMode=function(chars){for(var i=0,list=chars;i<list.length;i+=1){var char=list[i];if(exports.charHasUprightVerticalOrientation(char.charCodeAt(0)))return true}return false};module.exports.charAllowsIdeographicBreaking=function(char){if(char<11904)return false;if(isChar["Bopomofo Extended"](char))return true;if(isChar["Bopomofo"](char))return true;if(isChar["CJK Compatibility Forms"](char))return true;if(isChar["CJK Compatibility Ideographs"](char))return true;if(isChar["CJK Compatibility"](char))return true;if(isChar["CJK Radicals Supplement"](char))return true;if(isChar["CJK Strokes"](char))return true;if(isChar["CJK Symbols and Punctuation"](char))return true;if(isChar["CJK Unified Ideographs Extension A"](char))return true;if(isChar["CJK Unified Ideographs"](char))return true;if(isChar["Enclosed CJK Letters and Months"](char))return true;if(isChar["Halfwidth and Fullwidth Forms"](char))return true;if(isChar["Hiragana"](char))return true;if(isChar["Ideographic Description Characters"](char))return true;if(isChar["Kangxi Radicals"](char))return true;if(isChar["Katakana Phonetic Extensions"](char))return true;if(isChar["Katakana"](char))return true;if(isChar["Vertical Forms"](char))return true;if(isChar["Yi Radicals"](char))return true;if(isChar["Yi Syllables"](char))return true;return false};exports.charHasUprightVerticalOrientation=function(char){if(char===746||char===747){return true}if(char<4352)return false;if(isChar["Bopomofo Extended"](char))return true;if(isChar["Bopomofo"](char))return true;if(isChar["CJK Compatibility Forms"](char)){if(!(char>=65097&&char<=65103)){return true}}if(isChar["CJK Compatibility Ideographs"](char))return true;if(isChar["CJK Compatibility"](char))return true;if(isChar["CJK Radicals Supplement"](char))return true;if(isChar["CJK Strokes"](char))return true;if(isChar["CJK Symbols and Punctuation"](char)){if(!(char>=12296&&char<=12305)&&!(char>=12308&&char<=12319)&&char!==12336){return true}}if(isChar["CJK Unified Ideographs Extension A"](char))return true;if(isChar["CJK Unified Ideographs"](char))return true;if(isChar["Enclosed CJK Letters and Months"](char))return true;if(isChar["Hangul Compatibility Jamo"](char))return true;if(isChar["Hangul Jamo Extended-A"](char))return true;if(isChar["Hangul Jamo Extended-B"](char))return true;if(isChar["Hangul Jamo"](char))return true;if(isChar["Hangul Syllables"](char))return true;if(isChar["Hiragana"](char))return true;if(isChar["Ideographic Description Characters"](char))return true;if(isChar["Kanbun"](char))return true;if(isChar["Kangxi Radicals"](char))return true;if(isChar["Katakana Phonetic Extensions"](char))return true;if(isChar["Katakana"](char)){if(char!==12540){return true}}if(isChar["Halfwidth and Fullwidth Forms"](char)){if(char!==65288&&char!==65289&&char!==65293&&!(char>=65306&&char<=65310)&&char!==65339&&char!==65341&&char!==65343&&!(char>=65371&&char<=65503)&&char!==65507&&!(char>=65512&&char<=65519)){return true}}if(isChar["Small Form Variants"](char)){if(!(char>=65112&&char<=65118)&&!(char>=65123&&char<=65126)){return true}}if(isChar["Unified Canadian Aboriginal Syllabics"](char))return true;if(isChar["Unified Canadian Aboriginal Syllabics Extended"](char))return true;if(isChar["Vertical Forms"](char))return true;if(isChar["Yijing Hexagram Symbols"](char))return true;if(isChar["Yi Syllables"](char))return true;if(isChar["Yi Radicals"](char))return true;return false};exports.charHasNeutralVerticalOrientation=function(char){if(isChar["Latin-1 Supplement"](char)){if(char===167||char===169||char===174||char===177||char===188||char===189||char===190||char===215||char===247){return true}}if(isChar["General Punctuation"](char)){if(char===8214||char===8224||char===8225||char===8240||char===8241||char===8251||char===8252||char===8258||char===8263||char===8264||char===8265||char===8273){return true}}if(isChar["Letterlike Symbols"](char))return true;if(isChar["Number Forms"](char))return true;if(isChar["Miscellaneous Technical"](char)){if(char>=8960&&char<=8967||char>=8972&&char<=8991||char>=8996&&char<=9e3||char===9003||char>=9085&&char<=9114||char>=9150&&char<=9165||char===9167||char>=9169&&char<=9179||char>=9186&&char<=9215){return true}}if(isChar["Control Pictures"](char)&&char!==9251)return true;if(isChar["Optical Character Recognition"](char))return true;if(isChar["Enclosed Alphanumerics"](char))return true;if(isChar["Geometric Shapes"](char))return true;if(isChar["Miscellaneous Symbols"](char)){if(!(char>=9754&&char<=9759)){return true}}if(isChar["Miscellaneous Symbols and Arrows"](char)){if(char>=11026&&char<=11055||char>=11088&&char<=11097||char>=11192&&char<=11243){return true}}if(isChar["CJK Symbols and Punctuation"](char))return true;if(isChar["Katakana"](char))return true;if(isChar["Private Use Area"](char))return true;if(isChar["CJK Compatibility Forms"](char))return true;if(isChar["Small Form Variants"](char))return true;if(isChar["Halfwidth and Fullwidth Forms"](char))return true;if(char===8734||char===8756||char===8757||char>=9984&&char<=10087||char>=10102&&char<=10131||char===65532||char===65533){return true}return false};exports.charHasRotatedVerticalOrientation=function(char){return!(exports.charHasUprightVerticalOrientation(char)||exports.charHasNeutralVerticalOrientation(char))}},{"./is_char_in_unicode_block":717}],721:[function(require,module,exports){"use strict";module.exports=createStructArrayType;var viewTypes={Int8:Int8Array,Uint8:Uint8Array,Uint8Clamped:Uint8ClampedArray,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array,Float64:Float64Array};var Struct=function Struct(structArray,index){this._structArray=structArray;this._pos1=index*this.size;this._pos2=this._pos1/2;this._pos4=this._pos1/4;this._pos8=this._pos1/8};var DEFAULT_CAPACITY=128;var RESIZE_MULTIPLIER=5;var StructArray=function StructArray(serialized){this.isTransferred=false;if(serialized!==undefined){this.arrayBuffer=serialized.arrayBuffer;this.length=serialized.length;this.capacity=this.arrayBuffer.byteLength/this.bytesPerElement;this._refreshViews()}else{this.capacity=-1;this.resize(0)}};StructArray.serialize=function serialize(){return{members:this.prototype.members,alignment:this.prototype.StructType.prototype.alignment,bytesPerElement:this.prototype.bytesPerElement}};StructArray.prototype.serialize=function serialize(transferables){this._trim();if(transferables){this.isTransferred=true;transferables.push(this.arrayBuffer)}return{length:this.length,arrayBuffer:this.arrayBuffer}};StructArray.prototype.get=function get(index){return new this.StructType(this,index)};StructArray.prototype._trim=function _trim(){if(this.length!==this.capacity){this.capacity=this.length;this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement);this._refreshViews()}};StructArray.prototype.resize=function resize(n){this.length=n;if(n>this.capacity){this.capacity=Math.max(n,Math.floor(this.capacity*RESIZE_MULTIPLIER),DEFAULT_CAPACITY);this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var oldUint8Array=this.uint8;this._refreshViews();if(oldUint8Array)this.uint8.set(oldUint8Array)}};StructArray.prototype._refreshViews=function _refreshViews(){var this$1=this;for(var i=0,list=this._usedTypes;i<list.length;i+=1){var type=list[i];this$1[getArrayViewName(type)]=new viewTypes[type](this$1.arrayBuffer)}};StructArray.prototype.toArray=function toArray(startIndex,endIndex){var this$1=this;var array=[];for(var i=startIndex;i<endIndex;i++){var struct=this$1.get(i);array.push(struct)}return array};var structArrayTypeCache={};function createStructArrayType(options){var key=JSON.stringify(options);if(structArrayTypeCache[key]){return structArrayTypeCache[key]}var alignment=options.alignment===undefined?1:options.alignment;var offset=0;var maxSize=0;var usedTypes=["Uint8"];var members=options.members.map(function(member){if(usedTypes.indexOf(member.type)<0)usedTypes.push(member.type);var typeSize=sizeOf(member.type);var memberOffset=offset=align(offset,Math.max(alignment,typeSize));var components=member.components||1;maxSize=Math.max(maxSize,typeSize);offset+=typeSize*components;return{name:member.name,type:member.type,components:components,offset:memberOffset}});var size=align(offset,Math.max(maxSize,alignment));var StructType=function(Struct){function StructType(){Struct.apply(this,arguments)}if(Struct)StructType.__proto__=Struct;StructType.prototype=Object.create(Struct&&Struct.prototype);StructType.prototype.constructor=StructType;return StructType}(Struct);StructType.prototype.alignment=alignment;StructType.prototype.size=size;for(var i=0,list=members;i<list.length;i+=1){var member=list[i];for(var c=0;c<member.components;c++){var name=member.name+(member.components===1?"":c);Object.defineProperty(StructType.prototype,name,{get:createGetter(member,c),set:createSetter(member,c)})}}var StructArrayType=function(StructArray){function StructArrayType(){StructArray.apply(this,arguments)}if(StructArray)StructArrayType.__proto__=StructArray;StructArrayType.prototype=Object.create(StructArray&&StructArray.prototype);StructArrayType.prototype.constructor=StructArrayType;return StructArrayType}(StructArray);StructArrayType.prototype.members=members;StructArrayType.prototype.StructType=StructType;StructArrayType.prototype.bytesPerElement=size;StructArrayType.prototype.emplaceBack=createEmplaceBack(members,size);StructArrayType.prototype._usedTypes=usedTypes;structArrayTypeCache[key]=StructArrayType;return StructArrayType}function align(offset,size){return Math.ceil(offset/size)*size}function sizeOf(type){return viewTypes[type].BYTES_PER_ELEMENT}function getArrayViewName(type){return type.toLowerCase()}function createEmplaceBack(members,bytesPerElement){var usedTypeSizes=[];var argNames=[];var body="var i = this.length;\n"+"this.resize(this.length + 1);\n";for(var i=0,list=members;i<list.length;i+=1){var member=list[i];var size=sizeOf(member.type);if(usedTypeSizes.indexOf(size)<0){usedTypeSizes.push(size);body+="var o"+size.toFixed(0)+" = i * "+(bytesPerElement/size).toFixed(0)+";\n"}for(var c=0;c<member.components;c++){var argName="v"+argNames.length;var index="o"+size.toFixed(0)+" + "+(member.offset/size+c).toFixed(0);body+="this."+getArrayViewName(member.type)+"["+index+"] = "+argName+";\n";argNames.push(argName)}}body+="return i;";return new Function(argNames.toString(),body)}function createMemberComponentString(member,component){var elementOffset="this._pos"+sizeOf(member.type).toFixed(0);var componentOffset=(member.offset/sizeOf(member.type)+component).toFixed(0);var index=elementOffset+" + "+componentOffset;return"this._structArray."+getArrayViewName(member.type)+"["+index+"]"}function createGetter(member,c){return new Function("return "+createMemberComponentString(member,c)+";")}function createSetter(member,c){return new Function("x",createMemberComponentString(member,c)+" = x;")}},{}],722:[function(require,module,exports){"use strict";module.exports=resolveTokens;function resolveTokens(properties,text){return text.replace(/{([^{}]+)}/g,function(match,key){return key in properties?properties[key]:""})}},{}],723:[function(require,module,exports){"use strict";var UnitBezier=require("unitbezier");var Coordinate=require("../geo/coordinate");var Point=require("point-geometry");exports.easeCubicInOut=function(t){if(t<=0)return 0;if(t>=1)return 1;var t2=t*t,t3=t2*t;return 4*(t<.5?t3:3*(t-t2)+t3-.75)};exports.bezier=function(p1x,p1y,p2x,p2y){var bezier=new UnitBezier(p1x,p1y,p2x,p2y);return function(t){return bezier.solve(t)}};exports.ease=exports.bezier(.25,.1,.25,1);exports.clamp=function(n,min,max){return Math.min(max,Math.max(min,n))};exports.wrap=function(n,min,max){var d=max-min;var w=((n-min)%d+d)%d+min;return w===min?max:w};exports.asyncAll=function(array,fn,callback){if(!array.length){return callback(null,[])}var remaining=array.length;var results=new Array(array.length);var error=null;
array.forEach(function(item,i){fn(item,function(err,result){if(err)error=err;results[i]=result;if(--remaining===0)callback(error,results)})})};exports.values=function(obj){var result=[];for(var k in obj){result.push(obj[k])}return result};exports.keysDifference=function(obj,other){var difference=[];for(var i in obj){if(!(i in other)){difference.push(i)}}return difference};exports.extend=function(dest,source0,source1,source2){var arguments$1=arguments;for(var i=1;i<arguments.length;i++){var src=arguments$1[i];for(var k in src){dest[k]=src[k]}}return dest};exports.pick=function(src,properties){var result={};for(var i=0;i<properties.length;i++){var k=properties[i];if(k in src){result[k]=src[k]}}return result};var id=1;exports.uniqueId=function(){return id++};exports.bindAll=function(fns,context){fns.forEach(function(fn){if(!context[fn]){return}context[fn]=context[fn].bind(context)})};exports.getCoordinatesCenter=function(coords){var minX=Infinity;var minY=Infinity;var maxX=-Infinity;var maxY=-Infinity;for(var i=0;i<coords.length;i++){minX=Math.min(minX,coords[i].column);minY=Math.min(minY,coords[i].row);maxX=Math.max(maxX,coords[i].column);maxY=Math.max(maxY,coords[i].row)}var dx=maxX-minX;var dy=maxY-minY;var dMax=Math.max(dx,dy);return new Coordinate((minX+maxX)/2,(minY+maxY)/2,0).zoomTo(Math.floor(-Math.log(dMax)/Math.LN2))};exports.endsWith=function(string,suffix){return string.indexOf(suffix,string.length-suffix.length)!==-1};exports.mapObject=function(input,iterator,context){var this$1=this;var output={};for(var key in input){output[key]=iterator.call(context||this$1,input[key],key,input)}return output};exports.filterObject=function(input,iterator,context){var this$1=this;var output={};for(var key in input){if(iterator.call(context||this$1,input[key],key,input)){output[key]=input[key]}}return output};exports.deepEqual=function(a,b){if(Array.isArray(a)){if(!Array.isArray(b)||a.length!==b.length)return false;for(var i=0;i<a.length;i++){if(!exports.deepEqual(a[i],b[i]))return false}return true}if(typeof a==="object"&&a!==null&&b!==null){if(!(typeof b==="object"))return false;var keys=Object.keys(a);if(keys.length!==Object.keys(b).length)return false;for(var key in a){if(!exports.deepEqual(a[key],b[key]))return false}return true}return a===b};exports.clone=function(input){if(Array.isArray(input)){return input.map(exports.clone)}else if(typeof input==="object"&&input){return exports.mapObject(input,exports.clone)}else{return input}};exports.arraysIntersect=function(a,b){for(var l=0;l<a.length;l++){if(b.indexOf(a[l])>=0)return true}return false};var warnOnceHistory={};exports.warnOnce=function(message){if(!warnOnceHistory[message]){if(typeof console!=="undefined")console.warn(message);warnOnceHistory[message]=true}};exports.isCounterClockwise=function(a,b,c){return(c.y-a.y)*(b.x-a.x)>(b.y-a.y)*(c.x-a.x)};exports.calculateSignedArea=function(ring){var sum=0;for(var i=0,len=ring.length,j=len-1,p1,p2;i<len;j=i++){p1=ring[i];p2=ring[j];sum+=(p2.x-p1.x)*(p1.y+p2.y)}return sum};exports.isClosedPolygon=function(points){if(points.length<4)return false;var p1=points[0];var p2=points[points.length-1];if(Math.abs(p1.x-p2.x)>0||Math.abs(p1.y-p2.y)>0){return false}return Math.abs(exports.calculateSignedArea(points))>.01};exports.sphericalToCartesian=function(spherical){var r=spherical[0];var azimuthal=spherical[1],polar=spherical[2];azimuthal+=90;azimuthal*=Math.PI/180;polar*=Math.PI/180;return[r*Math.cos(azimuthal)*Math.sin(polar),r*Math.sin(azimuthal)*Math.sin(polar),r*Math.cos(polar)]}},{"../geo/coordinate":614,"point-geometry":769,unitbezier:992}],724:[function(require,module,exports){"use strict";var Feature=function Feature(vectorTileFeature,z,x,y){this.type="Feature";this._vectorTileFeature=vectorTileFeature;vectorTileFeature._z=z;vectorTileFeature._x=x;vectorTileFeature._y=y;this.properties=vectorTileFeature.properties;if(vectorTileFeature.id!=null){this.id=vectorTileFeature.id}};var prototypeAccessors={geometry:{}};prototypeAccessors.geometry.get=function(){if(this._geometry===undefined){this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry}return this._geometry};prototypeAccessors.geometry.set=function(g){this._geometry=g};Feature.prototype.toJSON=function toJSON(){var this$1=this;var json={geometry:this.geometry};for(var i in this){if(i==="_geometry"||i==="_vectorTileFeature")continue;json[i]=this$1[i]}return json};Object.defineProperties(Feature.prototype,prototypeAccessors);module.exports=Feature},{}],725:[function(require,module,exports){"use strict";var scriptDetection=require("./script_detection");module.exports=function verticalizePunctuation(input){var output="";for(var i=0;i<input.length;i++){var nextCharCode=input.charCodeAt(i+1)||null;var prevCharCode=input.charCodeAt(i-1)||null;var canReplacePunctuation=(!nextCharCode||!scriptDetection.charHasRotatedVerticalOrientation(nextCharCode)||module.exports.lookup[input[i+1]])&&(!prevCharCode||!scriptDetection.charHasRotatedVerticalOrientation(prevCharCode)||module.exports.lookup[input[i-1]]);if(canReplacePunctuation&&module.exports.lookup[input[i]]){output+=module.exports.lookup[input[i]]}else{output+=input[i]}}return output};module.exports.lookup={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""}},{"./script_detection":720}],726:[function(require,module,exports){"use strict";var WebWorker=require("./web_worker");var WorkerPool=function WorkerPool(){this.active={}};WorkerPool.prototype.acquire=function acquire(mapId){var this$1=this;if(!this.workers){var workerCount=require("../mapbox-gl").workerCount;this.workers=[];while(this.workers.length<workerCount){this$1.workers.push(new WebWorker)}}this.active[mapId]=true;return this.workers.slice()};WorkerPool.prototype.release=function release(mapId){delete this.active[mapId];if(Object.keys(this.active).length===0){this.workers.forEach(function(w){w.terminate()});this.workers=null}};module.exports=WorkerPool},{"../mapbox-gl":620,"./web_worker":705}],727:[function(require,module,exports){module.exports={version:"0.31.0"}},{}],728:[function(require,module,exports){"use strict";var compile=require("cwise-compiler");var EmptyProc={body:"",args:[],thisVars:[],localVars:[]};function fixup(x){if(!x){return EmptyProc}for(var i=0;i<x.args.length;++i){var a=x.args[i];if(i===0){x.args[i]={name:a,lvalue:true,rvalue:!!x.rvalue,count:x.count||1}}else{x.args[i]={name:a,lvalue:false,rvalue:true,count:1}}}if(!x.thisVars){x.thisVars=[]}if(!x.localVars){x.localVars=[]}return x}function pcompile(user_args){return compile({args:user_args.args,pre:fixup(user_args.pre),body:fixup(user_args.body),post:fixup(user_args.proc),funcName:user_args.funcName})}function makeOp(user_args){var args=[];for(var i=0;i<user_args.args.length;++i){args.push("a"+i)}var wrapper=new Function("P",["return function ",user_args.funcName,"_ndarrayops(",args.join(","),") {P(",args.join(","),");return a0}"].join(""));return wrapper(pcompile(user_args))}var assign_ops={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};(function(){for(var id in assign_ops){var op=assign_ops[id];exports[id]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+op+"c"},funcName:id});exports[id+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a"+op+"=b"},rvalue:true,funcName:id+"eq"});exports[id+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+op+"s"},funcName:id+"s"});exports[id+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a"+op+"=s"},rvalue:true,funcName:id+"seq"})}})();var unary_ops={not:"!",bnot:"~",neg:"-",recip:"1.0/"};(function(){for(var id in unary_ops){var op=unary_ops[id];exports[id]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a="+op+"b"},funcName:id});exports[id+"eq"]=makeOp({args:["array"],body:{args:["a"],body:"a="+op+"a"},rvalue:true,count:2,funcName:id+"eq"})}})();var binary_ops={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};(function(){for(var id in binary_ops){var op=binary_ops[id];exports[id]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+op+"c"},funcName:id});exports[id+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+op+"s"},funcName:id+"s"});exports[id+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=a"+op+"b"},rvalue:true,count:2,funcName:id+"eq"});exports[id+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+op+"s"},rvalue:true,count:2,funcName:id+"seq"})}})();var math_unary=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];(function(){for(var i=0;i<math_unary.length;++i){var f=math_unary[i];exports[f]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:f});exports[f+"eq"]=makeOp({args:["array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:true,count:2,funcName:f+"eq"})}})();var math_comm=["max","min","atan2","pow"];(function(){for(var i=0;i<math_comm.length;++i){var f=math_comm[i];exports[f]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:f});exports[f+"s"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:f+"s"});exports[f+"eq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:true,count:2,funcName:f+"eq"});exports[f+"seq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:true,count:2,funcName:f+"seq"})}})();var math_noncomm=["atan2","pow"];(function(){for(var i=0;i<math_noncomm.length;++i){var f=math_noncomm[i];exports[f+"op"]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:f+"op"});exports[f+"ops"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:f+"ops"});exports[f+"opeq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:true,count:2,funcName:f+"opeq"});exports[f+"opseq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:true,count:2,funcName:f+"opseq"})}})();exports.any=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"a",lvalue:false,rvalue:true,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"});exports.all=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:false,rvalue:true,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"});exports.sum=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"});exports.prod=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"});exports.norm2squared=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"});exports.norm2=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"});exports.norminf=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"});exports.norm1=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"});exports.sup=compile({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:false,rvalue:true,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}});exports.inf=compile({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:false,rvalue:true,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}});exports.argmin=compile({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:false,rvalue:false,count:0},{name:"_inline_0_arg1_",lvalue:false,rvalue:false,count:0},{name:"_inline_0_arg2_",lvalue:false,rvalue:true,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:false,rvalue:true,count:2},{name:"_inline_1_arg1_",lvalue:false,rvalue:true,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}});exports.argmax=compile({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:false,rvalue:false,count:0},{name:"_inline_0_arg1_",lvalue:false,rvalue:false,count:0},{name:"_inline_0_arg2_",lvalue:false,rvalue:true,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:false,rvalue:true,count:2},{name:"_inline_1_arg1_",lvalue:false,rvalue:true,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}});exports.random=makeOp({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"});exports.assign=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"});exports.assigns=makeOp({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"});exports.equals=compile({args:["array","array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:false,rvalue:true,count:1},{name:"y",lvalue:false,rvalue:true,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},{"cwise-compiler":320}],729:[function(require,module,exports){"use strict";var ndarray=require("ndarray");var do_convert=require("./doConvert.js");module.exports=function convert(arr,result){var shape=[],c=arr,sz=1;while(Array.isArray(c)){shape.push(c.length);sz*=c.length;c=c[0]}if(shape.length===0){return ndarray()}if(!result){result=ndarray(new Float64Array(sz),shape)}do_convert(result,arr);return result}},{"./doConvert.js":730,ndarray:731}],730:[function(require,module,exports){module.exports=require("cwise-compiler")({args:["array","scalar","index"],pre:{body:"{}",args:[],thisVars:[],localVars:[]},body:{body:"{\nvar _inline_1_v=_inline_1_arg1_,_inline_1_i\nfor(_inline_1_i=0;_inline_1_i<_inline_1_arg2_.length-1;++_inline_1_i) {\n_inline_1_v=_inline_1_v[_inline_1_arg2_[_inline_1_i]]\n}\n_inline_1_arg0_=_inline_1_v[_inline_1_arg2_[_inline_1_arg2_.length-1]]\n}",args:[{name:"_inline_1_arg0_",lvalue:true,rvalue:false,count:1},{name:"_inline_1_arg1_",lvalue:false,rvalue:true,count:1},{name:"_inline_1_arg2_",lvalue:false,rvalue:true,count:4}],thisVars:[],localVars:["_inline_1_i","_inline_1_v"]},post:{body:"{}",args:[],thisVars:[],localVars:[]},funcName:"convert",blockSize:64})},{"cwise-compiler":320}],731:[function(require,module,exports){var iota=require("iota-array");var isBuffer=require("is-buffer");var hasTypedArrays=typeof Float64Array!=="undefined";function compare1st(a,b){return a[0]-b[0]}function order(){var stride=this.stride;var terms=new Array(stride.length);var i;for(i=0;i<terms.length;++i){terms[i]=[Math.abs(stride[i]),i]}terms.sort(compare1st);var result=new Array(terms.length);for(i=0;i<result.length;++i){result[i]=terms[i][1]}return result}function compileConstructor(dtype,dimension){var className=["View",dimension,"d",dtype].join("");if(dimension<0){className="View_Nil"+dtype}var useGetters=dtype==="generic";if(dimension===-1){var code="function "+className+"(a){this.data=a;};var proto="+className+".prototype;proto.dtype='"+dtype+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+className+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+className+"(a){return new "+className+"(a);}";var procedure=new Function(code);return procedure()}else if(dimension===0){var code="function "+className+"(a,d) {this.data = a;this.offset = d};var proto="+className+".prototype;proto.dtype='"+dtype+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+className+"_copy() {return new "+className+"(this.data,this.offset)};proto.pick=function "+className+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+className+"_get(){return "+(useGetters?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+className+"_set(v){return "+(useGetters?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+className+"(a,b,c,d){return new "+className+"(a,d)}";var procedure=new Function("TrivialArray",code);return procedure(CACHED_CONSTRUCTORS[dtype][0])}var code=["'use strict'"];var indices=iota(dimension);var args=indices.map(function(i){return"i"+i});var index_str="this.offset+"+indices.map(function(i){return"this.stride["+i+"]*i"+i}).join("+");var shapeArg=indices.map(function(i){return"b"+i}).join(",");var strideArg=indices.map(function(i){return"c"+i}).join(",");code.push("function "+className+"(a,"+shapeArg+","+strideArg+",d){this.data=a","this.shape=["+shapeArg+"]","this.stride=["+strideArg+"]","this.offset=d|0}","var proto="+className+".prototype","proto.dtype='"+dtype+"'","proto.dimension="+dimension);code.push("Object.defineProperty(proto,'size',{get:function "+className+"_size(){return "+indices.map(function(i){return"this.shape["+i+"]"}).join("*"),"}})");if(dimension===1){code.push("proto.order=[0]")}else{code.push("Object.defineProperty(proto,'order',{get:");if(dimension<4){code.push("function "+className+"_order(){");if(dimension===2){code.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})")}else if(dimension===3){code.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")}}else{code.push("ORDER})")}}code.push("proto.set=function "+className+"_set("+args.join(",")+",v){");if(useGetters){code.push("return this.data.set("+index_str+",v)}")}else{code.push("return this.data["+index_str+"]=v}")}code.push("proto.get=function "+className+"_get("+args.join(",")+"){");if(useGetters){code.push("return this.data.get("+index_str+")}")}else{code.push("return this.data["+index_str+"]}")}code.push("proto.index=function "+className+"_index(",args.join(),"){return "+index_str+"}");code.push("proto.hi=function "+className+"_hi("+args.join(",")+"){return new "+className+"(this.data,"+indices.map(function(i){return["(typeof i",i,"!=='number'||i",i,"<0)?this.shape[",i,"]:i",i,"|0"].join("")}).join(",")+","+indices.map(function(i){return"this.stride["+i+"]"}).join(",")+",this.offset)}");var a_vars=indices.map(function(i){return"a"+i+"=this.shape["+i+"]"});var c_vars=indices.map(function(i){return"c"+i+"=this.stride["+i+"]"});code.push("proto.lo=function "+className+"_lo("+args.join(",")+"){var b=this.offset,d=0,"+a_vars.join(",")+","+c_vars.join(","));for(var i=0;i<dimension;++i){code.push("if(typeof i"+i+"==='number'&&i"+i+">=0){d=i"+i+"|0;b+=c"+i+"*d;a"+i+"-=d}")}code.push("return new "+className+"(this.data,"+indices.map(function(i){return"a"+i}).join(",")+","+indices.map(function(i){return"c"+i}).join(",")+",b)}");code.push("proto.step=function "+className+"_step("+args.join(",")+"){var "+indices.map(function(i){return"a"+i+"=this.shape["+i+"]"}).join(",")+","+indices.map(function(i){return"b"+i+"=this.stride["+i+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var i=0;i<dimension;++i){code.push("if(typeof i"+i+"==='number'){d=i"+i+"|0;if(d<0){c+=b"+i+"*(a"+i+"-1);a"+i+"=ceil(-a"+i+"/d)}else{a"+i+"=ceil(a"+i+"/d)}b"+i+"*=d}")}code.push("return new "+className+"(this.data,"+indices.map(function(i){return"a"+i}).join(",")+","+indices.map(function(i){return"b"+i}).join(",")+",c)}");var tShape=new Array(dimension);var tStride=new Array(dimension);for(var i=0;i<dimension;++i){tShape[i]="a[i"+i+"]";tStride[i]="b[i"+i+"]"}code.push("proto.transpose=function "+className+"_transpose("+args+"){"+args.map(function(n,idx){return n+"=("+n+"===undefined?"+idx+":"+n+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+className+"(this.data,"+tShape.join(",")+","+tStride.join(",")+",this.offset)}");code.push("proto.pick=function "+className+"_pick("+args+"){var a=[],b=[],c=this.offset");for(var i=0;i<dimension;++i){code.push("if(typeof i"+i+"==='number'&&i"+i+">=0){c=(c+this.stride["+i+"]*i"+i+")|0}else{a.push(this.shape["+i+"]);b.push(this.stride["+i+"])}")}code.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}");code.push("return function construct_"+className+"(data,shape,stride,offset){return new "+className+"(data,"+indices.map(function(i){return"shape["+i+"]"}).join(",")+","+indices.map(function(i){return"stride["+i+"]"}).join(",")+",offset)}");var procedure=new Function("CTOR_LIST","ORDER",code.join("\n"));return procedure(CACHED_CONSTRUCTORS[dtype],order)}function arrayDType(data){if(isBuffer(data)){return"buffer"}if(hasTypedArrays){switch(Object.prototype.toString.call(data)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}}if(Array.isArray(data)){return"array"}return"generic"}var CACHED_CONSTRUCTORS={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};(function(){for(var id in CACHED_CONSTRUCTORS){CACHED_CONSTRUCTORS[id].push(compileConstructor(id,-1))}});function wrappedNDArrayCtor(data,shape,stride,offset){if(data===undefined){var ctor=CACHED_CONSTRUCTORS.array[0];return ctor([])}else if(typeof data==="number"){data=[data]}if(shape===undefined){shape=[data.length]}var d=shape.length;if(stride===undefined){stride=new Array(d);for(var i=d-1,sz=1;i>=0;--i){stride[i]=sz;sz*=shape[i]}}if(offset===undefined){offset=0;for(var i=0;i<d;++i){if(stride[i]<0){offset-=(shape[i]-1)*stride[i]}}}var dtype=arrayDType(data);var ctor_list=CACHED_CONSTRUCTORS[dtype];while(ctor_list.length<=d+1){ctor_list.push(compileConstructor(dtype,ctor_list.length-1))}var ctor=ctor_list[d+1];return ctor(data,shape,stride,offset)}module.exports=wrappedNDArrayCtor},{"iota-array":456,"is-buffer":457}],732:[function(require,module,exports){"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols;var hasOwnProperty=Object.prototype.hasOwnProperty;var propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(val===null||val===undefined){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(val)}function shouldUseNative(){try{if(!Object.assign){return false}var test1=new String("abc");test1[5]="de";if(Object.getOwnPropertyNames(test1)[0]==="5"){return false}var test2={};for(var i=0;i<10;i++){test2["_"+String.fromCharCode(i)]=i}var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n]});if(order2.join("")!=="0123456789"){return false}var test3={};"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter});if(Object.keys(Object.assign({},test3)).join("")!=="abcdefghijklmnopqrst"){return false}return true}catch(err){return false}}module.exports=shouldUseNative()?Object.assign:function(target,source){var from;var to=toObject(target);var symbols;for(var s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from){if(hasOwnProperty.call(from,key)){to[key]=from[key]}}if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++){if(propIsEnumerable.call(from,symbols[i])){to[symbols[i]]=from[symbols[i]]}}}}return to}},{}],733:[function(require,module,exports){function GifWriter(buf,width,height,gopts){var p=0;var gopts=gopts===undefined?{}:gopts;var loop_count=gopts.loop===undefined?null:gopts.loop;var global_palette=gopts.palette===undefined?null:gopts.palette;if(width<=0||height<=0||width>65535||height>65535)throw"Width/Height invalid.";function check_palette_and_num_colors(palette){var num_colors=palette.length;if(num_colors<2||num_colors>256||num_colors&num_colors-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return num_colors}buf[p++]=71;buf[p++]=73;buf[p++]=70;buf[p++]=56;buf[p++]=57;buf[p++]=97;var gp_num_colors_pow2=0;var background=0;if(global_palette!==null){var gp_num_colors=check_palette_and_num_colors(global_palette);while(gp_num_colors>>=1)++gp_num_colors_pow2;gp_num_colors=1<<gp_num_colors_pow2;--gp_num_colors_pow2;if(gopts.background!==undefined){background=gopts.background;if(background>=gp_num_colors)throw"Background index out of range.";if(background===0)throw"Background index explicitly passed as 0."}}buf[p++]=width&255;buf[p++]=width>>8&255;buf[p++]=height&255;buf[p++]=height>>8&255;buf[p++]=(global_palette!==null?128:0)|gp_num_colors_pow2;buf[p++]=background;buf[p++]=0;if(global_palette!==null){for(var i=0,il=global_palette.length;i<il;++i){var rgb=global_palette[i];buf[p++]=rgb>>16&255;buf[p++]=rgb>>8&255;buf[p++]=rgb&255}}if(loop_count!==null){if(loop_count<0||loop_count>65535)throw"Loop count invalid.";buf[p++]=33;buf[p++]=255;buf[p++]=11;buf[p++]=78;buf[p++]=69;buf[p++]=84;buf[p++]=83;buf[p++]=67;buf[p++]=65;buf[p++]=80;buf[p++]=69;buf[p++]=50;buf[p++]=46;buf[p++]=48;buf[p++]=3;buf[p++]=1;buf[p++]=loop_count&255;buf[p++]=loop_count>>8&255;buf[p++]=0}var ended=false;this.addFrame=function(x,y,w,h,indexed_pixels,opts){if(ended===true){--p;ended=false}opts=opts===undefined?{}:opts;if(x<0||y<0||x>65535||y>65535)throw"x/y invalid.";if(w<=0||h<=0||w>65535||h>65535)throw"Width/Height invalid.";if(indexed_pixels.length<w*h)throw"Not enough pixels for the frame size.";var using_local_palette=true;var palette=opts.palette;if(palette===undefined||palette===null){using_local_palette=false;palette=global_palette}if(palette===undefined||palette===null)throw"Must supply either a local or global palette.";var num_colors=check_palette_and_num_colors(palette);var min_code_size=0;while(num_colors>>=1)++min_code_size;num_colors=1<<min_code_size;var delay=opts.delay===undefined?0:opts.delay;var disposal=opts.disposal===undefined?0:opts.disposal;if(disposal<0||disposal>3)throw"Disposal out of range.";var use_transparency=false;var transparent_index=0;if(opts.transparent!==undefined&&opts.transparent!==null){use_transparency=true;transparent_index=opts.transparent;if(transparent_index<0||transparent_index>=num_colors)throw"Transparent color index."}if(disposal!==0||use_transparency||delay!==0){buf[p++]=33;buf[p++]=249;buf[p++]=4;buf[p++]=disposal<<2|(use_transparency===true?1:0);buf[p++]=delay&255;buf[p++]=delay>>8&255;buf[p++]=transparent_index;buf[p++]=0}buf[p++]=44;buf[p++]=x&255;buf[p++]=x>>8&255;buf[p++]=y&255;buf[p++]=y>>8&255;buf[p++]=w&255;buf[p++]=w>>8&255;buf[p++]=h&255;buf[p++]=h>>8&255;buf[p++]=using_local_palette===true?128|min_code_size-1:0;if(using_local_palette===true){for(var i=0,il=palette.length;i<il;++i){var rgb=palette[i];buf[p++]=rgb>>16&255;buf[p++]=rgb>>8&255;buf[p++]=rgb&255}}p=GifWriterOutputLZWCodeStream(buf,p,min_code_size<2?2:min_code_size,indexed_pixels)};this.end=function(){if(ended===false){buf[p++]=59;ended=true}return p}}function GifWriterOutputLZWCodeStream(buf,p,min_code_size,index_stream){buf[p++]=min_code_size;var cur_subblock=p++;var clear_code=1<<min_code_size;var code_mask=clear_code-1;var eoi_code=clear_code+1;var next_code=eoi_code+1;var cur_code_size=min_code_size+1;var cur_shift=0;var cur=0;function emit_bytes_to_buffer(bit_block_size){while(cur_shift>=bit_block_size){buf[p++]=cur&255;cur>>=8;cur_shift-=8;if(p===cur_subblock+256){buf[cur_subblock]=255;cur_subblock=p++}}}function emit_code(c){cur|=c<<cur_shift;cur_shift+=cur_code_size;emit_bytes_to_buffer(8)}var ib_code=index_stream[0]&code_mask;var code_table={};emit_code(clear_code);for(var i=1,il=index_stream.length;i<il;++i){var k=index_stream[i]&code_mask;var cur_key=ib_code<<8|k;var cur_code=code_table[cur_key];if(cur_code===undefined){cur|=ib_code<<cur_shift;cur_shift+=cur_code_size;while(cur_shift>=8){buf[p++]=cur&255;cur>>=8;cur_shift-=8;if(p===cur_subblock+256){buf[cur_subblock]=255;cur_subblock=p++}}if(next_code===4096){emit_code(clear_code);next_code=eoi_code+1;cur_code_size=min_code_size+1;
code_table={}}else{if(next_code>=1<<cur_code_size)++cur_code_size;code_table[cur_key]=next_code++}ib_code=k}else{ib_code=cur_code}}emit_code(ib_code);emit_code(eoi_code);emit_bytes_to_buffer(1);if(cur_subblock+1===p){buf[cur_subblock]=0}else{buf[cur_subblock]=p-cur_subblock-1;buf[p++]=0}return p}function GifReader(buf){var p=0;if(buf[p++]!==71||buf[p++]!==73||buf[p++]!==70||buf[p++]!==56||(buf[p++]+1&253)!==56||buf[p++]!==97){throw"Invalid GIF 87a/89a header."}var width=buf[p++]|buf[p++]<<8;var height=buf[p++]|buf[p++]<<8;var pf0=buf[p++];var global_palette_flag=pf0>>7;var num_global_colors_pow2=pf0&7;var num_global_colors=1<<num_global_colors_pow2+1;var background=buf[p++];buf[p++];var global_palette_offset=null;if(global_palette_flag){global_palette_offset=p;p+=num_global_colors*3}var no_eof=true;var frames=[];var delay=0;var transparent_index=null;var disposal=0;var loop_count=null;this.width=width;this.height=height;while(no_eof&&p<buf.length){switch(buf[p++]){case 33:switch(buf[p++]){case 255:if(buf[p]!==11||buf[p+1]==78&&buf[p+2]==69&&buf[p+3]==84&&buf[p+4]==83&&buf[p+5]==67&&buf[p+6]==65&&buf[p+7]==80&&buf[p+8]==69&&buf[p+9]==50&&buf[p+10]==46&&buf[p+11]==48&&buf[p+12]==3&&buf[p+13]==1&&buf[p+16]==0){p+=14;loop_count=buf[p++]|buf[p++]<<8;p++}else{p+=12;while(true){var block_size=buf[p++];if(block_size===0)break;p+=block_size}}break;case 249:if(buf[p++]!==4||buf[p+4]!==0)throw"Invalid graphics extension block.";var pf1=buf[p++];delay=buf[p++]|buf[p++]<<8;transparent_index=buf[p++];if((pf1&1)===0)transparent_index=null;disposal=pf1>>2&7;p++;break;case 254:while(true){var block_size=buf[p++];if(block_size===0)break;p+=block_size}break;default:throw"Unknown graphic control label: 0x"+buf[p-1].toString(16)}break;case 44:var x=buf[p++]|buf[p++]<<8;var y=buf[p++]|buf[p++]<<8;var w=buf[p++]|buf[p++]<<8;var h=buf[p++]|buf[p++]<<8;var pf2=buf[p++];var local_palette_flag=pf2>>7;var interlace_flag=pf2>>6&1;var num_local_colors_pow2=pf2&7;var num_local_colors=1<<num_local_colors_pow2+1;var palette_offset=global_palette_offset;var has_local_palette=false;if(local_palette_flag){var has_local_palette=true;palette_offset=p;p+=num_local_colors*3}var data_offset=p;p++;while(true){var block_size=buf[p++];if(block_size===0)break;p+=block_size}frames.push({x:x,y:y,width:w,height:h,has_local_palette:has_local_palette,palette_offset:palette_offset,data_offset:data_offset,data_length:p-data_offset,transparent_index:transparent_index,interlaced:!!interlace_flag,delay:delay,disposal:disposal});break;case 59:no_eof=false;break;default:throw"Unknown gif block: 0x"+buf[p-1].toString(16);break}}this.numFrames=function(){return frames.length};this.loopCount=function(){return loop_count};this.frameInfo=function(frame_num){if(frame_num<0||frame_num>=frames.length)throw"Frame index out of range.";return frames[frame_num]};this.decodeAndBlitFrameBGRA=function(frame_num,pixels){var frame=this.frameInfo(frame_num);var num_pixels=frame.width*frame.height;var index_stream=new Uint8Array(num_pixels);GifReaderLZWOutputIndexStream(buf,frame.data_offset,index_stream,num_pixels);var palette_offset=frame.palette_offset;var trans=frame.transparent_index;if(trans===null)trans=256;var framewidth=frame.width;var framestride=width-framewidth;var xleft=framewidth;var opbeg=(frame.y*width+frame.x)*4;var opend=((frame.y+frame.height)*width+frame.x)*4;var op=opbeg;var scanstride=framestride*4;if(frame.interlaced===true){scanstride+=width*4*7}var interlaceskip=8;for(var i=0,il=index_stream.length;i<il;++i){var index=index_stream[i];if(xleft===0){op+=scanstride;xleft=framewidth;if(op>=opend){scanstride=framestride*4+width*4*(interlaceskip-1);op=opbeg+(framewidth+framestride)*(interlaceskip<<1);interlaceskip>>=1}}if(index===trans){op+=4}else{var r=buf[palette_offset+index*3];var g=buf[palette_offset+index*3+1];var b=buf[palette_offset+index*3+2];pixels[op++]=b;pixels[op++]=g;pixels[op++]=r;pixels[op++]=255}--xleft}};this.decodeAndBlitFrameRGBA=function(frame_num,pixels){var frame=this.frameInfo(frame_num);var num_pixels=frame.width*frame.height;var index_stream=new Uint8Array(num_pixels);GifReaderLZWOutputIndexStream(buf,frame.data_offset,index_stream,num_pixels);var palette_offset=frame.palette_offset;var trans=frame.transparent_index;if(trans===null)trans=256;var framewidth=frame.width;var framestride=width-framewidth;var xleft=framewidth;var opbeg=(frame.y*width+frame.x)*4;var opend=((frame.y+frame.height)*width+frame.x)*4;var op=opbeg;var scanstride=framestride*4;if(frame.interlaced===true){scanstride+=width*4*7}var interlaceskip=8;for(var i=0,il=index_stream.length;i<il;++i){var index=index_stream[i];if(xleft===0){op+=scanstride;xleft=framewidth;if(op>=opend){scanstride=framestride*4+width*4*(interlaceskip-1);op=opbeg+(framewidth+framestride)*(interlaceskip<<1);interlaceskip>>=1}}if(index===trans){op+=4}else{var r=buf[palette_offset+index*3];var g=buf[palette_offset+index*3+1];var b=buf[palette_offset+index*3+2];pixels[op++]=r;pixels[op++]=g;pixels[op++]=b;pixels[op++]=255}--xleft}}}function GifReaderLZWOutputIndexStream(code_stream,p,output,output_length){var min_code_size=code_stream[p++];var clear_code=1<<min_code_size;var eoi_code=clear_code+1;var next_code=eoi_code+1;var cur_code_size=min_code_size+1;var code_mask=(1<<cur_code_size)-1;var cur_shift=0;var cur=0;var op=0;var subblock_size=code_stream[p++];var code_table=new Int32Array(4096);var prev_code=null;while(true){while(cur_shift<16){if(subblock_size===0)break;cur|=code_stream[p++]<<cur_shift;cur_shift+=8;if(subblock_size===1){subblock_size=code_stream[p++]}else{--subblock_size}}if(cur_shift<cur_code_size)break;var code=cur&code_mask;cur>>=cur_code_size;cur_shift-=cur_code_size;if(code===clear_code){next_code=eoi_code+1;cur_code_size=min_code_size+1;code_mask=(1<<cur_code_size)-1;prev_code=null;continue}else if(code===eoi_code){break}var chase_code=code<next_code?code:prev_code;var chase_length=0;var chase=chase_code;while(chase>clear_code){chase=code_table[chase]>>8;++chase_length}var k=chase;var op_end=op+chase_length+(chase_code!==code?1:0);if(op_end>output_length){console.log("Warning, gif stream longer than expected.");return}output[op++]=k;op+=chase_length;var b=op;if(chase_code!==code)output[op++]=k;chase=chase_code;while(chase_length--){chase=code_table[chase];output[--b]=chase&255;chase>>=8}if(prev_code!==null&&next_code<4096){code_table[next_code++]=prev_code<<8|k;if(next_code>=code_mask+1&&cur_code_size<12){++cur_code_size;code_mask=code_mask<<1|1}}prev_code=code}if(op!==output_length){console.log("Warning, gif stream shorter than expected.")}return output}try{exports.GifWriter=GifWriter;exports.GifReader=GifReader}catch(e){}},{}],734:[function(require,module,exports){"use strict";var TYPED_OK=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Int32Array!=="undefined";exports.assign=function(obj){var sources=Array.prototype.slice.call(arguments,1);while(sources.length){var source=sources.shift();if(!source){continue}if(typeof source!=="object"){throw new TypeError(source+"must be non-object")}for(var p in source){if(source.hasOwnProperty(p)){obj[p]=source[p]}}}return obj};exports.shrinkBuf=function(buf,size){if(buf.length===size){return buf}if(buf.subarray){return buf.subarray(0,size)}buf.length=size;return buf};var fnTyped={arraySet:function(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray){dest.set(src.subarray(src_offs,src_offs+len),dest_offs);return}for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){var i,l,len,pos,chunk,result;len=0;for(i=0,l=chunks.length;i<l;i++){len+=chunks[i].length}result=new Uint8Array(len);pos=0;for(i=0,l=chunks.length;i<l;i++){chunk=chunks[i];result.set(chunk,pos);pos+=chunk.length}return result}};var fnUntyped={arraySet:function(dest,src,src_offs,len,dest_offs){for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports.setTyped=function(on){if(on){exports.Buf8=Uint8Array;exports.Buf16=Uint16Array;exports.Buf32=Int32Array;exports.assign(exports,fnTyped)}else{exports.Buf8=Array;exports.Buf16=Array;exports.Buf32=Array;exports.assign(exports,fnUntyped)}};exports.setTyped(TYPED_OK)},{}],735:[function(require,module,exports){"use strict";function adler32(adler,buf,len,pos){var s1=adler&65535|0,s2=adler>>>16&65535|0,n=0;while(len!==0){n=len>2e3?2e3:len;len-=n;do{s1=s1+buf[pos++]|0;s2=s2+s1|0}while(--n);s1%=65521;s2%=65521}return s1|s2<<16|0}module.exports=adler32},{}],736:[function(require,module,exports){"use strict";module.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],737:[function(require,module,exports){"use strict";function makeTable(){var c,table=[];for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=c&1?3988292384^c>>>1:c>>>1}table[n]=c}return table}var crcTable=makeTable();function crc32(crc,buf,len,pos){var t=crcTable,end=pos+len;crc^=-1;for(var i=pos;i<end;i++){crc=crc>>>8^t[(crc^buf[i])&255]}return crc^-1}module.exports=crc32},{}],738:[function(require,module,exports){"use strict";var utils=require("../utils/common");var trees=require("./trees");var adler32=require("./adler32");var crc32=require("./crc32");var msg=require("./messages");var Z_NO_FLUSH=0;var Z_PARTIAL_FLUSH=1;var Z_FULL_FLUSH=3;var Z_FINISH=4;var Z_BLOCK=5;var Z_OK=0;var Z_STREAM_END=1;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_BUF_ERROR=-5;var Z_DEFAULT_COMPRESSION=-1;var Z_FILTERED=1;var Z_HUFFMAN_ONLY=2;var Z_RLE=3;var Z_FIXED=4;var Z_DEFAULT_STRATEGY=0;var Z_UNKNOWN=2;var Z_DEFLATED=8;var MAX_MEM_LEVEL=9;var MAX_WBITS=15;var DEF_MEM_LEVEL=8;var LENGTH_CODES=29;var LITERALS=256;var L_CODES=LITERALS+1+LENGTH_CODES;var D_CODES=30;var BL_CODES=19;var HEAP_SIZE=2*L_CODES+1;var MAX_BITS=15;var MIN_MATCH=3;var MAX_MATCH=258;var MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1;var PRESET_DICT=32;var INIT_STATE=42;var EXTRA_STATE=69;var NAME_STATE=73;var COMMENT_STATE=91;var HCRC_STATE=103;var BUSY_STATE=113;var FINISH_STATE=666;var BS_NEED_MORE=1;var BS_BLOCK_DONE=2;var BS_FINISH_STARTED=3;var BS_FINISH_DONE=4;var OS_CODE=3;function err(strm,errorCode){strm.msg=msg[errorCode];return errorCode}function rank(f){return(f<<1)-(f>4?9:0)}function zero(buf){var len=buf.length;while(--len>=0){buf[len]=0}}function flush_pending(strm){var s=strm.state;var len=s.pending;if(len>strm.avail_out){len=strm.avail_out}if(len===0){return}utils.arraySet(strm.output,s.pending_buf,s.pending_out,len,strm.next_out);strm.next_out+=len;s.pending_out+=len;strm.total_out+=len;strm.avail_out-=len;s.pending-=len;if(s.pending===0){s.pending_out=0}}function flush_block_only(s,last){trees._tr_flush_block(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,last);s.block_start=s.strstart;flush_pending(s.strm)}function put_byte(s,b){s.pending_buf[s.pending++]=b}function putShortMSB(s,b){s.pending_buf[s.pending++]=b>>>8&255;s.pending_buf[s.pending++]=b&255}function read_buf(strm,buf,start,size){var len=strm.avail_in;if(len>size){len=size}if(len===0){return 0}strm.avail_in-=len;utils.arraySet(buf,strm.input,strm.next_in,len,start);if(strm.state.wrap===1){strm.adler=adler32(strm.adler,buf,len,start)}else if(strm.state.wrap===2){strm.adler=crc32(strm.adler,buf,len,start)}strm.next_in+=len;strm.total_in+=len;return len}function longest_match(s,cur_match){var chain_length=s.max_chain_length;var scan=s.strstart;var match;var len;var best_len=s.prev_length;var nice_match=s.nice_match;var limit=s.strstart>s.w_size-MIN_LOOKAHEAD?s.strstart-(s.w_size-MIN_LOOKAHEAD):0;var _win=s.window;var wmask=s.w_mask;var prev=s.prev;var strend=s.strstart+MAX_MATCH;var scan_end1=_win[scan+best_len-1];var scan_end=_win[scan+best_len];if(s.prev_length>=s.good_match){chain_length>>=2}if(nice_match>s.lookahead){nice_match=s.lookahead}do{match=cur_match;if(_win[match+best_len]!==scan_end||_win[match+best_len-1]!==scan_end1||_win[match]!==_win[scan]||_win[++match]!==_win[scan+1]){continue}scan+=2;match++;do{}while(_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&scan<strend);len=MAX_MATCH-(strend-scan);scan=strend-MAX_MATCH;if(len>best_len){s.match_start=cur_match;best_len=len;if(len>=nice_match){break}scan_end1=_win[scan+best_len-1];scan_end=_win[scan+best_len]}}while((cur_match=prev[cur_match&wmask])>limit&&--chain_length!==0);if(best_len<=s.lookahead){return best_len}return s.lookahead}function fill_window(s){var _w_size=s.w_size;var p,n,m,more,str;do{more=s.window_size-s.lookahead-s.strstart;if(s.strstart>=_w_size+(_w_size-MIN_LOOKAHEAD)){utils.arraySet(s.window,s.window,_w_size,_w_size,0);s.match_start-=_w_size;s.strstart-=_w_size;s.block_start-=_w_size;n=s.hash_size;p=n;do{m=s.head[--p];s.head[p]=m>=_w_size?m-_w_size:0}while(--n);n=_w_size;p=n;do{m=s.prev[--p];s.prev[p]=m>=_w_size?m-_w_size:0}while(--n);more+=_w_size}if(s.strm.avail_in===0){break}n=read_buf(s.strm,s.window,s.strstart+s.lookahead,more);s.lookahead+=n;if(s.lookahead+s.insert>=MIN_MATCH){str=s.strstart-s.insert;s.ins_h=s.window[str];s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+1])&s.hash_mask;while(s.insert){s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH-1])&s.hash_mask;s.prev[str&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=str;str++;s.insert--;if(s.lookahead+s.insert<MIN_MATCH){break}}}}while(s.lookahead<MIN_LOOKAHEAD&&s.strm.avail_in!==0)}function deflate_stored(s,flush){var max_block_size=65535;if(max_block_size>s.pending_buf_size-5){max_block_size=s.pending_buf_size-5}for(;;){if(s.lookahead<=1){fill_window(s);if(s.lookahead===0&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}s.strstart+=s.lookahead;s.lookahead=0;var max_start=s.block_start+max_block_size;if(s.strstart===0||s.strstart>=max_start){s.lookahead=s.strstart-max_start;s.strstart=max_start;flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}if(s.strstart-s.block_start>=s.w_size-MIN_LOOKAHEAD){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.strstart>s.block_start){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_NEED_MORE}function deflate_fast(s,flush){var hash_head;var bflush;for(;;){if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}hash_head=0;if(s.lookahead>=MIN_MATCH){s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}if(hash_head!==0&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD){s.match_length=longest_match(s,hash_head)}if(s.match_length>=MIN_MATCH){bflush=trees._tr_tally(s,s.strstart-s.match_start,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;if(s.match_length<=s.max_lazy_match&&s.lookahead>=MIN_MATCH){s.match_length--;do{s.strstart++;s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}while(--s.match_length!==0);s.strstart++}else{s.strstart+=s.match_length;s.match_length=0;s.ins_h=s.window[s.strstart];s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+1])&s.hash_mask}}else{bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++}if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_slow(s,flush){var hash_head;var bflush;var max_insert;for(;;){if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}hash_head=0;if(s.lookahead>=MIN_MATCH){s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}s.prev_length=s.match_length;s.prev_match=s.match_start;s.match_length=MIN_MATCH-1;if(hash_head!==0&&s.prev_length<s.max_lazy_match&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD){s.match_length=longest_match(s,hash_head);if(s.match_length<=5&&(s.strategy===Z_FILTERED||s.match_length===MIN_MATCH&&s.strstart-s.match_start>4096)){s.match_length=MIN_MATCH-1}}if(s.prev_length>=MIN_MATCH&&s.match_length<=s.prev_length){max_insert=s.strstart+s.lookahead-MIN_MATCH;bflush=trees._tr_tally(s,s.strstart-1-s.prev_match,s.prev_length-MIN_MATCH);s.lookahead-=s.prev_length-1;s.prev_length-=2;do{if(++s.strstart<=max_insert){s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}}while(--s.prev_length!==0);s.match_available=0;s.match_length=MIN_MATCH-1;s.strstart++;if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}else if(s.match_available){bflush=trees._tr_tally(s,0,s.window[s.strstart-1]);if(bflush){flush_block_only(s,false)}s.strstart++;s.lookahead--;if(s.strm.avail_out===0){return BS_NEED_MORE}}else{s.match_available=1;s.strstart++;s.lookahead--}}if(s.match_available){bflush=trees._tr_tally(s,0,s.window[s.strstart-1]);s.match_available=0}s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_rle(s,flush){var bflush;var prev;var scan,strend;var _win=s.window;for(;;){if(s.lookahead<=MAX_MATCH){fill_window(s);if(s.lookahead<=MAX_MATCH&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}s.match_length=0;if(s.lookahead>=MIN_MATCH&&s.strstart>0){scan=s.strstart-1;prev=_win[scan];if(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]){strend=s.strstart+MAX_MATCH;do{}while(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&scan<strend);s.match_length=MAX_MATCH-(strend-scan);if(s.match_length>s.lookahead){s.match_length=s.lookahead}}}if(s.match_length>=MIN_MATCH){bflush=trees._tr_tally(s,1,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;s.strstart+=s.match_length;s.match_length=0}else{bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++}if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_huff(s,flush){var bflush;for(;;){if(s.lookahead===0){fill_window(s);if(s.lookahead===0){if(flush===Z_NO_FLUSH){return BS_NEED_MORE}break}}s.match_length=0;bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++;if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function Config(good_length,max_lazy,nice_length,max_chain,func){this.good_length=good_length;this.max_lazy=max_lazy;this.nice_length=nice_length;this.max_chain=max_chain;this.func=func}var configuration_table;configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];function lm_init(s){s.window_size=2*s.w_size;zero(s.head);s.max_lazy_match=configuration_table[s.level].max_lazy;s.good_match=configuration_table[s.level].good_length;s.nice_match=configuration_table[s.level].nice_length;s.max_chain_length=configuration_table[s.level].max_chain;s.strstart=0;s.block_start=0;s.lookahead=0;s.insert=0;s.match_length=s.prev_length=MIN_MATCH-1;s.match_available=0;s.ins_h=0}function DeflateState(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=Z_DEFLATED;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new utils.Buf16(HEAP_SIZE*2);this.dyn_dtree=new utils.Buf16((2*D_CODES+1)*2);this.bl_tree=new utils.Buf16((2*BL_CODES+1)*2);zero(this.dyn_ltree);zero(this.dyn_dtree);zero(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new utils.Buf16(MAX_BITS+1);this.heap=new utils.Buf16(2*L_CODES+1);zero(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new utils.Buf16(2*L_CODES+1);zero(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}function deflateResetKeep(strm){var s;if(!strm||!strm.state){return err(strm,Z_STREAM_ERROR)}strm.total_in=strm.total_out=0;strm.data_type=Z_UNKNOWN;s=strm.state;s.pending=0;s.pending_out=0;if(s.wrap<0){s.wrap=-s.wrap}s.status=s.wrap?INIT_STATE:BUSY_STATE;strm.adler=s.wrap===2?0:1;s.last_flush=Z_NO_FLUSH;trees._tr_init(s);return Z_OK}function deflateReset(strm){var ret=deflateResetKeep(strm);if(ret===Z_OK){lm_init(strm.state)}return ret}function deflateSetHeader(strm,head){if(!strm||!strm.state){return Z_STREAM_ERROR}if(strm.state.wrap!==2){return Z_STREAM_ERROR}strm.state.gzhead=head;return Z_OK}function deflateInit2(strm,level,method,windowBits,memLevel,strategy){if(!strm){return Z_STREAM_ERROR}var wrap=1;if(level===Z_DEFAULT_COMPRESSION){level=6}if(windowBits<0){wrap=0;windowBits=-windowBits}else if(windowBits>15){wrap=2;windowBits-=16}if(memLevel<1||memLevel>MAX_MEM_LEVEL||method!==Z_DEFLATED||windowBits<8||windowBits>15||level<0||level>9||strategy<0||strategy>Z_FIXED){return err(strm,Z_STREAM_ERROR)}if(windowBits===8){windowBits=9}var s=new DeflateState;strm.state=s;s.strm=strm;s.wrap=wrap;s.gzhead=null;s.w_bits=windowBits;s.w_size=1<<s.w_bits;s.w_mask=s.w_size-1;s.hash_bits=memLevel+7;s.hash_size=1<<s.hash_bits;s.hash_mask=s.hash_size-1;s.hash_shift=~~((s.hash_bits+MIN_MATCH-1)/MIN_MATCH);s.window=new utils.Buf8(s.w_size*2);s.head=new utils.Buf16(s.hash_size);s.prev=new utils.Buf16(s.w_size);s.lit_bufsize=1<<memLevel+6;s.pending_buf_size=s.lit_bufsize*4;s.pending_buf=new utils.Buf8(s.pending_buf_size);s.d_buf=1*s.lit_bufsize;s.l_buf=(1+2)*s.lit_bufsize;s.level=level;s.strategy=strategy;s.method=method;return deflateReset(strm)}function deflateInit(strm,level){return deflateInit2(strm,level,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY)}function deflate(strm,flush){var old_flush,s;var beg,val;if(!strm||!strm.state||flush>Z_BLOCK||flush<0){return strm?err(strm,Z_STREAM_ERROR):Z_STREAM_ERROR}s=strm.state;if(!strm.output||!strm.input&&strm.avail_in!==0||s.status===FINISH_STATE&&flush!==Z_FINISH){return err(strm,strm.avail_out===0?Z_BUF_ERROR:Z_STREAM_ERROR)}s.strm=strm;old_flush=s.last_flush;s.last_flush=flush;if(s.status===INIT_STATE){if(s.wrap===2){strm.adler=0;put_byte(s,31);put_byte(s,139);put_byte(s,8);if(!s.gzhead){put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0);put_byte(s,OS_CODE);s.status=BUSY_STATE}else{put_byte(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(!s.gzhead.extra?0:4)+(!s.gzhead.name?0:8)+(!s.gzhead.comment?0:16));put_byte(s,s.gzhead.time&255);put_byte(s,s.gzhead.time>>8&255);put_byte(s,s.gzhead.time>>16&255);put_byte(s,s.gzhead.time>>24&255);put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0);put_byte(s,s.gzhead.os&255);if(s.gzhead.extra&&s.gzhead.extra.length){put_byte(s,s.gzhead.extra.length&255);put_byte(s,s.gzhead.extra.length>>8&255)}if(s.gzhead.hcrc){strm.adler=crc32(strm.adler,s.pending_buf,s.pending,0)}s.gzindex=0;s.status=EXTRA_STATE}}else{var header=Z_DEFLATED+(s.w_bits-8<<4)<<8;var level_flags=-1;if(s.strategy>=Z_HUFFMAN_ONLY||s.level<2){level_flags=0}else if(s.level<6){level_flags=1}else if(s.level===6){level_flags=2}else{level_flags=3}header|=level_flags<<6;if(s.strstart!==0){header|=PRESET_DICT}header+=31-header%31;s.status=BUSY_STATE;putShortMSB(s,header);if(s.strstart!==0){putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&65535)}strm.adler=1}}if(s.status===EXTRA_STATE){if(s.gzhead.extra){beg=s.pending;while(s.gzindex<(s.gzhead.extra.length&65535)){if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){break}}put_byte(s,s.gzhead.extra[s.gzindex]&255);s.gzindex++}if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}if(s.gzindex===s.gzhead.extra.length){s.gzindex=0;s.status=NAME_STATE}}else{s.status=NAME_STATE}}if(s.status===NAME_STATE){if(s.gzhead.name){beg=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break}}if(s.gzindex<s.gzhead.name.length){val=s.gzhead.name.charCodeAt(s.gzindex++)&255}else{val=0}put_byte(s,val)}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}if(val===0){s.gzindex=0;s.status=COMMENT_STATE}}else{s.status=COMMENT_STATE}}if(s.status===COMMENT_STATE){if(s.gzhead.comment){beg=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break}}if(s.gzindex<s.gzhead.comment.length){val=s.gzhead.comment.charCodeAt(s.gzindex++)&255}else{val=0}put_byte(s,val)}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}if(val===0){s.status=HCRC_STATE}}else{s.status=HCRC_STATE}}if(s.status===HCRC_STATE){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size){flush_pending(strm)}if(s.pending+2<=s.pending_buf_size){put_byte(s,strm.adler&255);put_byte(s,strm.adler>>8&255);strm.adler=0;s.status=BUSY_STATE}}else{s.status=BUSY_STATE}}if(s.pending!==0){flush_pending(strm);if(strm.avail_out===0){s.last_flush=-1;return Z_OK}}else if(strm.avail_in===0&&rank(flush)<=rank(old_flush)&&flush!==Z_FINISH){return err(strm,Z_BUF_ERROR)}if(s.status===FINISH_STATE&&strm.avail_in!==0){return err(strm,Z_BUF_ERROR)}if(strm.avail_in!==0||s.lookahead!==0||flush!==Z_NO_FLUSH&&s.status!==FINISH_STATE){var bstate=s.strategy===Z_HUFFMAN_ONLY?deflate_huff(s,flush):s.strategy===Z_RLE?deflate_rle(s,flush):configuration_table[s.level].func(s,flush);if(bstate===BS_FINISH_STARTED||bstate===BS_FINISH_DONE){s.status=FINISH_STATE}if(bstate===BS_NEED_MORE||bstate===BS_FINISH_STARTED){if(strm.avail_out===0){s.last_flush=-1}return Z_OK}if(bstate===BS_BLOCK_DONE){if(flush===Z_PARTIAL_FLUSH){trees._tr_align(s)}else if(flush!==Z_BLOCK){trees._tr_stored_block(s,0,0,false);if(flush===Z_FULL_FLUSH){zero(s.head);if(s.lookahead===0){s.strstart=0;s.block_start=0;s.insert=0}}}flush_pending(strm);if(strm.avail_out===0){s.last_flush=-1;return Z_OK}}}if(flush!==Z_FINISH){return Z_OK}if(s.wrap<=0){return Z_STREAM_END}if(s.wrap===2){put_byte(s,strm.adler&255);put_byte(s,strm.adler>>8&255);put_byte(s,strm.adler>>16&255);put_byte(s,strm.adler>>24&255);put_byte(s,strm.total_in&255);put_byte(s,strm.total_in>>8&255);put_byte(s,strm.total_in>>16&255);put_byte(s,strm.total_in>>24&255)}else{putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&65535)}flush_pending(strm);if(s.wrap>0){s.wrap=-s.wrap}return s.pending!==0?Z_OK:Z_STREAM_END}function deflateEnd(strm){var status;if(!strm||!strm.state){return Z_STREAM_ERROR}status=strm.state.status;if(status!==INIT_STATE&&status!==EXTRA_STATE&&status!==NAME_STATE&&status!==COMMENT_STATE&&status!==HCRC_STATE&&status!==BUSY_STATE&&status!==FINISH_STATE){return err(strm,Z_STREAM_ERROR)}strm.state=null;return status===BUSY_STATE?err(strm,Z_DATA_ERROR):Z_OK}function deflateSetDictionary(strm,dictionary){var dictLength=dictionary.length;var s;var str,n;var wrap;var avail;var next;var input;var tmpDict;if(!strm||!strm.state){return Z_STREAM_ERROR}s=strm.state;wrap=s.wrap;if(wrap===2||wrap===1&&s.status!==INIT_STATE||s.lookahead){return Z_STREAM_ERROR}if(wrap===1){strm.adler=adler32(strm.adler,dictionary,dictLength,0)}s.wrap=0;if(dictLength>=s.w_size){if(wrap===0){zero(s.head);s.strstart=0;s.block_start=0;s.insert=0}tmpDict=new utils.Buf8(s.w_size);utils.arraySet(tmpDict,dictionary,dictLength-s.w_size,s.w_size,0);dictionary=tmpDict;dictLength=s.w_size}avail=strm.avail_in;next=strm.next_in;input=strm.input;strm.avail_in=dictLength;strm.next_in=0;strm.input=dictionary;fill_window(s);while(s.lookahead>=MIN_MATCH){str=s.strstart;n=s.lookahead-(MIN_MATCH-1);do{s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH-1])&s.hash_mask;s.prev[str&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=str;str++}while(--n);s.strstart=str;s.lookahead=MIN_MATCH-1;fill_window(s)}s.strstart+=s.lookahead;s.block_start=s.strstart;s.insert=s.lookahead;s.lookahead=0;s.match_length=s.prev_length=MIN_MATCH-1;s.match_available=0;strm.next_in=next;strm.input=input;strm.avail_in=avail;s.wrap=wrap;return Z_OK}exports.deflateInit=deflateInit;exports.deflateInit2=deflateInit2;exports.deflateReset=deflateReset;exports.deflateResetKeep=deflateResetKeep;exports.deflateSetHeader=deflateSetHeader;exports.deflate=deflate;exports.deflateEnd=deflateEnd;exports.deflateSetDictionary=deflateSetDictionary;exports.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":734,"./adler32":735,"./crc32":737,"./messages":742,"./trees":743}],739:[function(require,module,exports){"use strict";var BAD=30;var TYPE=12;module.exports=function inflate_fast(strm,start){var state;var _in;var last;var _out;var beg;var end;var dmax;var wsize;var whave;var wnext;var s_window;var hold;var bits;var lcode;var dcode;var lmask;var dmask;var here;var op;var len;var dist;var from;var from_source;var input,output;state=strm.state;_in=strm.next_in;input=strm.input;last=_in+(strm.avail_in-5);_out=strm.next_out;output=strm.output;beg=_out-(start-strm.avail_out);end=_out+(strm.avail_out-257);dmax=state.dmax;wsize=state.wsize;whave=state.whave;wnext=state.wnext;s_window=state.window;hold=state.hold;bits=state.bits;lcode=state.lencode;dcode=state.distcode;lmask=(1<<state.lenbits)-1;dmask=(1<<state.distbits)-1;top:do{if(bits<15){hold+=input[_in++]<<bits;
bits+=8;hold+=input[_in++]<<bits;bits+=8}here=lcode[hold&lmask];dolen:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op===0){output[_out++]=here&65535}else if(op&16){len=here&65535;op&=15;if(op){if(bits<op){hold+=input[_in++]<<bits;bits+=8}len+=hold&(1<<op)-1;hold>>>=op;bits-=op}if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=dcode[hold&dmask];dodist:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op&16){dist=here&65535;op&=15;if(bits<op){hold+=input[_in++]<<bits;bits+=8;if(bits<op){hold+=input[_in++]<<bits;bits+=8}}dist+=hold&(1<<op)-1;if(dist>dmax){strm.msg="invalid distance too far back";state.mode=BAD;break top}hold>>>=op;bits-=op;op=_out-beg;if(dist>op){op=dist-op;if(op>whave){if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break top}}from=0;from_source=s_window;if(wnext===0){from+=wsize-op;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}else if(wnext<op){from+=wsize+wnext-op;op-=wnext;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=0;if(wnext<len){op=wnext;len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}}else{from+=wnext-op;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}while(len>2){output[_out++]=from_source[from++];output[_out++]=from_source[from++];output[_out++]=from_source[from++];len-=3}if(len){output[_out++]=from_source[from++];if(len>1){output[_out++]=from_source[from++]}}}else{from=_out-dist;do{output[_out++]=output[from++];output[_out++]=output[from++];output[_out++]=output[from++];len-=3}while(len>2);if(len){output[_out++]=output[from++];if(len>1){output[_out++]=output[from++]}}}}else if((op&64)===0){here=dcode[(here&65535)+(hold&(1<<op)-1)];continue dodist}else{strm.msg="invalid distance code";state.mode=BAD;break top}break}}else if((op&64)===0){here=lcode[(here&65535)+(hold&(1<<op)-1)];continue dolen}else if(op&32){state.mode=TYPE;break top}else{strm.msg="invalid literal/length code";state.mode=BAD;break top}break}}while(_in<last&&_out<end);len=bits>>3;_in-=len;bits-=len<<3;hold&=(1<<bits)-1;strm.next_in=_in;strm.next_out=_out;strm.avail_in=_in<last?5+(last-_in):5-(_in-last);strm.avail_out=_out<end?257+(end-_out):257-(_out-end);state.hold=hold;state.bits=bits;return}},{}],740:[function(require,module,exports){"use strict";var utils=require("../utils/common");var adler32=require("./adler32");var crc32=require("./crc32");var inflate_fast=require("./inffast");var inflate_table=require("./inftrees");var CODES=0;var LENS=1;var DISTS=2;var Z_FINISH=4;var Z_BLOCK=5;var Z_TREES=6;var Z_OK=0;var Z_STREAM_END=1;var Z_NEED_DICT=2;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_MEM_ERROR=-4;var Z_BUF_ERROR=-5;var Z_DEFLATED=8;var HEAD=1;var FLAGS=2;var TIME=3;var OS=4;var EXLEN=5;var EXTRA=6;var NAME=7;var COMMENT=8;var HCRC=9;var DICTID=10;var DICT=11;var TYPE=12;var TYPEDO=13;var STORED=14;var COPY_=15;var COPY=16;var TABLE=17;var LENLENS=18;var CODELENS=19;var LEN_=20;var LEN=21;var LENEXT=22;var DIST=23;var DISTEXT=24;var MATCH=25;var LIT=26;var CHECK=27;var LENGTH=28;var DONE=29;var BAD=30;var MEM=31;var SYNC=32;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var MAX_WBITS=15;var DEF_WBITS=MAX_WBITS;function zswap32(q){return(q>>>24&255)+(q>>>8&65280)+((q&65280)<<8)+((q&255)<<24)}function InflateState(){this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new utils.Buf16(320);this.work=new utils.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function inflateResetKeep(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;strm.total_in=strm.total_out=state.total=0;strm.msg="";if(state.wrap){strm.adler=state.wrap&1}state.mode=HEAD;state.last=0;state.havedict=0;state.dmax=32768;state.head=null;state.hold=0;state.bits=0;state.lencode=state.lendyn=new utils.Buf32(ENOUGH_LENS);state.distcode=state.distdyn=new utils.Buf32(ENOUGH_DISTS);state.sane=1;state.back=-1;return Z_OK}function inflateReset(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;state.wsize=0;state.whave=0;state.wnext=0;return inflateResetKeep(strm)}function inflateReset2(strm,windowBits){var wrap;var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if(windowBits<0){wrap=0;windowBits=-windowBits}else{wrap=(windowBits>>4)+1;if(windowBits<48){windowBits&=15}}if(windowBits&&(windowBits<8||windowBits>15)){return Z_STREAM_ERROR}if(state.window!==null&&state.wbits!==windowBits){state.window=null}state.wrap=wrap;state.wbits=windowBits;return inflateReset(strm)}function inflateInit2(strm,windowBits){var ret;var state;if(!strm){return Z_STREAM_ERROR}state=new InflateState;strm.state=state;state.window=null;ret=inflateReset2(strm,windowBits);if(ret!==Z_OK){strm.state=null}return ret}function inflateInit(strm){return inflateInit2(strm,DEF_WBITS)}var virgin=true;var lenfix,distfix;function fixedtables(state){if(virgin){var sym;lenfix=new utils.Buf32(512);distfix=new utils.Buf32(32);sym=0;while(sym<144){state.lens[sym++]=8}while(sym<256){state.lens[sym++]=9}while(sym<280){state.lens[sym++]=7}while(sym<288){state.lens[sym++]=8}inflate_table(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9});sym=0;while(sym<32){state.lens[sym++]=5}inflate_table(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5});virgin=false}state.lencode=lenfix;state.lenbits=9;state.distcode=distfix;state.distbits=5}function updatewindow(strm,src,end,copy){var dist;var state=strm.state;if(state.window===null){state.wsize=1<<state.wbits;state.wnext=0;state.whave=0;state.window=new utils.Buf8(state.wsize)}if(copy>=state.wsize){utils.arraySet(state.window,src,end-state.wsize,state.wsize,0);state.wnext=0;state.whave=state.wsize}else{dist=state.wsize-state.wnext;if(dist>copy){dist=copy}utils.arraySet(state.window,src,end-copy,dist,state.wnext);copy-=dist;if(copy){utils.arraySet(state.window,src,end-copy,copy,0);state.wnext=copy;state.whave=state.wsize}else{state.wnext+=dist;if(state.wnext===state.wsize){state.wnext=0}if(state.whave<state.wsize){state.whave+=dist}}}return 0}function inflate(strm,flush){var state;var input,output;var next;var put;var have,left;var hold;var bits;var _in,_out;var copy;var from;var from_source;var here=0;var here_bits,here_op,here_val;var last_bits,last_op,last_val;var len;var ret;var hbuf=new utils.Buf8(4);var opts;var n;var order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&strm.avail_in!==0){return Z_STREAM_ERROR}state=strm.state;if(state.mode===TYPE){state.mode=TYPEDO}put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;_in=have;_out=left;ret=Z_OK;inf_leave:for(;;){switch(state.mode){case HEAD:if(state.wrap===0){state.mode=TYPEDO;break}while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.wrap&2&&hold===35615){state.check=0;hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0);hold=0;bits=0;state.mode=FLAGS;break}state.flags=0;if(state.head){state.head.done=false}if(!(state.wrap&1)||(((hold&255)<<8)+(hold>>8))%31){strm.msg="incorrect header check";state.mode=BAD;break}if((hold&15)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}hold>>>=4;bits-=4;len=(hold&15)+8;if(state.wbits===0){state.wbits=len}else if(len>state.wbits){strm.msg="invalid window size";state.mode=BAD;break}state.dmax=1<<len;strm.adler=state.check=1;state.mode=hold&512?DICTID:TYPE;hold=0;bits=0;break;case FLAGS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.flags=hold;if((state.flags&255)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}if(state.flags&57344){strm.msg="unknown header flags set";state.mode=BAD;break}if(state.head){state.head.text=hold>>8&1}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=TIME;case TIME:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.time=hold}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;hbuf[2]=hold>>>16&255;hbuf[3]=hold>>>24&255;state.check=crc32(state.check,hbuf,4,0)}hold=0;bits=0;state.mode=OS;case OS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.xflags=hold&255;state.head.os=hold>>8}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=EXLEN;case EXLEN:if(state.flags&1024){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.length=hold;if(state.head){state.head.extra_len=hold}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0}else if(state.head){state.head.extra=null}state.mode=EXTRA;case EXTRA:if(state.flags&1024){copy=state.length;if(copy>have){copy=have}if(copy){if(state.head){len=state.head.extra_len-state.length;if(!state.head.extra){state.head.extra=new Array(state.head.extra_len)}utils.arraySet(state.head.extra,input,next,copy,len)}if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;state.length-=copy}if(state.length){break inf_leave}}state.length=0;state.mode=NAME;case NAME:if(state.flags&2048){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536){state.head.name+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state.head){state.head.name=null}state.length=0;state.mode=COMMENT;case COMMENT:if(state.flags&4096){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536){state.head.comment+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state.head){state.head.comment=null}state.mode=HCRC;case HCRC:if(state.flags&512){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state.check&65535)){strm.msg="header crc mismatch";state.mode=BAD;break}hold=0;bits=0}if(state.head){state.head.hcrc=state.flags>>9&1;state.head.done=true}strm.adler=state.check=0;state.mode=TYPE;break;case DICTID:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}strm.adler=state.check=zswap32(hold);hold=0;bits=0;state.mode=DICT;case DICT:if(state.havedict===0){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;return Z_NEED_DICT}strm.adler=state.check=1;state.mode=TYPE;case TYPE:if(flush===Z_BLOCK||flush===Z_TREES){break inf_leave}case TYPEDO:if(state.last){hold>>>=bits&7;bits-=bits&7;state.mode=CHECK;break}while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.last=hold&1;hold>>>=1;bits-=1;switch(hold&3){case 0:state.mode=STORED;break;case 1:fixedtables(state);state.mode=LEN_;if(flush===Z_TREES){hold>>>=2;bits-=2;break inf_leave}break;case 2:state.mode=TABLE;break;case 3:strm.msg="invalid block type";state.mode=BAD}hold>>>=2;bits-=2;break;case STORED:hold>>>=bits&7;bits-=bits&7;while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((hold&65535)!==(hold>>>16^65535)){strm.msg="invalid stored block lengths";state.mode=BAD;break}state.length=hold&65535;hold=0;bits=0;state.mode=COPY_;if(flush===Z_TREES){break inf_leave}case COPY_:state.mode=COPY;case COPY:copy=state.length;if(copy){if(copy>have){copy=have}if(copy>left){copy=left}if(copy===0){break inf_leave}utils.arraySet(output,input,next,copy,put);have-=copy;next+=copy;left-=copy;put+=copy;state.length-=copy;break}state.mode=TYPE;break;case TABLE:while(bits<14){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.nlen=(hold&31)+257;hold>>>=5;bits-=5;state.ndist=(hold&31)+1;hold>>>=5;bits-=5;state.ncode=(hold&15)+4;hold>>>=4;bits-=4;if(state.nlen>286||state.ndist>30){strm.msg="too many length or distance symbols";state.mode=BAD;break}state.have=0;state.mode=LENLENS;case LENLENS:while(state.have<state.ncode){while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.lens[order[state.have++]]=hold&7;hold>>>=3;bits-=3}while(state.have<19){state.lens[order[state.have++]]=0}state.lencode=state.lendyn;state.lenbits=7;opts={bits:state.lenbits};ret=inflate_table(CODES,state.lens,0,19,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid code lengths set";state.mode=BAD;break}state.have=0;state.mode=CODELENS;case CODELENS:while(state.have<state.nlen+state.ndist){for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_val<16){hold>>>=here_bits;bits-=here_bits;state.lens[state.have++]=here_val}else{if(here_val===16){n=here_bits+2;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;if(state.have===0){strm.msg="invalid bit length repeat";state.mode=BAD;break}len=state.lens[state.have-1];copy=3+(hold&3);hold>>>=2;bits-=2}else if(here_val===17){n=here_bits+3;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=3+(hold&7);hold>>>=3;bits-=3}else{n=here_bits+7;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=11+(hold&127);hold>>>=7;bits-=7}if(state.have+copy>state.nlen+state.ndist){strm.msg="invalid bit length repeat";state.mode=BAD;break}while(copy--){state.lens[state.have++]=len}}}if(state.mode===BAD){break}if(state.lens[256]===0){strm.msg="invalid code -- missing end-of-block";state.mode=BAD;break}state.lenbits=9;opts={bits:state.lenbits};ret=inflate_table(LENS,state.lens,0,state.nlen,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid literal/lengths set";state.mode=BAD;break}state.distbits=6;state.distcode=state.distdyn;opts={bits:state.distbits};ret=inflate_table(DISTS,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts);state.distbits=opts.bits;if(ret){strm.msg="invalid distances set";state.mode=BAD;break}state.mode=LEN_;if(flush===Z_TREES){break inf_leave}case LEN_:state.mode=LEN;case LEN:if(have>=6&&left>=258){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;inflate_fast(strm,_out);put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;if(state.mode===TYPE){state.back=-1}break}state.back=0;for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_op&&(here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.lencode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;state.length=here_val;if(here_op===0){state.mode=LIT;break}if(here_op&32){state.back=-1;state.mode=TYPE;break}if(here_op&64){strm.msg="invalid literal/length code";state.mode=BAD;break}state.extra=here_op&15;state.mode=LENEXT;case LENEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.length+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}state.was=state.length;state.mode=DIST;case DIST:for(;;){here=state.distcode[hold&(1<<state.distbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;if(here_op&64){strm.msg="invalid distance code";state.mode=BAD;break}state.offset=here_val;state.extra=here_op&15;state.mode=DISTEXT;case DISTEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.offset+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}if(state.offset>state.dmax){strm.msg="invalid distance too far back";state.mode=BAD;break}state.mode=MATCH;case MATCH:if(left===0){break inf_leave}copy=_out-left;if(state.offset>copy){copy=state.offset-copy;if(copy>state.whave){if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break}}if(copy>state.wnext){copy-=state.wnext;from=state.wsize-copy}else{from=state.wnext-copy}if(copy>state.length){copy=state.length}from_source=state.window}else{from_source=output;from=put-state.offset;copy=state.length}if(copy>left){copy=left}left-=copy;state.length-=copy;do{output[put++]=from_source[from++]}while(--copy);if(state.length===0){state.mode=LEN}break;case LIT:if(left===0){break inf_leave}output[put++]=state.length;left--;state.mode=LEN;break;case CHECK:if(state.wrap){while(bits<32){if(have===0){break inf_leave}have--;hold|=input[next++]<<bits;bits+=8}_out-=left;strm.total_out+=_out;state.total+=_out;if(_out){strm.adler=state.check=state.flags?crc32(state.check,output,_out,put-_out):adler32(state.check,output,_out,put-_out)}_out=left;if((state.flags?hold:zswap32(hold))!==state.check){strm.msg="incorrect data check";state.mode=BAD;break}hold=0;bits=0}state.mode=LENGTH;case LENGTH:if(state.wrap&&state.flags){while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state.total&4294967295)){strm.msg="incorrect length check";state.mode=BAD;break}hold=0;bits=0}state.mode=DONE;case DONE:ret=Z_STREAM_END;break inf_leave;case BAD:ret=Z_DATA_ERROR;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR}}strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;if(state.wsize||_out!==strm.avail_out&&state.mode<BAD&&(state.mode<CHECK||flush!==Z_FINISH)){if(updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out)){state.mode=MEM;return Z_MEM_ERROR}}_in-=strm.avail_in;_out-=strm.avail_out;strm.total_in+=_in;strm.total_out+=_out;state.total+=_out;if(state.wrap&&_out){strm.adler=state.check=state.flags?crc32(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out)}strm.data_type=state.bits+(state.last?64:0)+(state.mode===TYPE?128:0)+(state.mode===LEN_||state.mode===COPY_?256:0);if((_in===0&&_out===0||flush===Z_FINISH)&&ret===Z_OK){ret=Z_BUF_ERROR}return ret}function inflateEnd(strm){if(!strm||!strm.state){return Z_STREAM_ERROR}var state=strm.state;if(state.window){state.window=null}strm.state=null;return Z_OK}function inflateGetHeader(strm,head){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if((state.wrap&2)===0){return Z_STREAM_ERROR}state.head=head;head.done=false;return Z_OK}function inflateSetDictionary(strm,dictionary){var dictLength=dictionary.length;var state;var dictid;var ret;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if(state.wrap!==0&&state.mode!==DICT){return Z_STREAM_ERROR}if(state.mode===DICT){dictid=1;dictid=adler32(dictid,dictionary,dictLength,0);if(dictid!==state.check){return Z_DATA_ERROR}}ret=updatewindow(strm,dictionary,dictLength,dictLength);if(ret){state.mode=MEM;return Z_MEM_ERROR}state.havedict=1;return Z_OK}exports.inflateReset=inflateReset;exports.inflateReset2=inflateReset2;exports.inflateResetKeep=inflateResetKeep;exports.inflateInit=inflateInit;exports.inflateInit2=inflateInit2;exports.inflate=inflate;exports.inflateEnd=inflateEnd;exports.inflateGetHeader=inflateGetHeader;exports.inflateSetDictionary=inflateSetDictionary;exports.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":734,"./adler32":735,"./crc32":737,"./inffast":739,"./inftrees":741}],741:[function(require,module,exports){"use strict";var utils=require("../utils/common");var MAXBITS=15;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var CODES=0;var LENS=1;var DISTS=2;var lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module.exports=function inflate_table(type,lens,lens_index,codes,table,table_index,work,opts){var bits=opts.bits;var len=0;var sym=0;var min=0,max=0;var root=0;var curr=0;var drop=0;var left=0;var used=0;var huff=0;var incr;var fill;var low;var mask;var next;var base=null;var base_index=0;var end;var count=new utils.Buf16(MAXBITS+1);var offs=new utils.Buf16(MAXBITS+1);var extra=null;var extra_index=0;var here_bits,here_op,here_val;for(len=0;len<=MAXBITS;len++){count[len]=0}for(sym=0;sym<codes;sym++){count[lens[lens_index+sym]]++}root=bits;for(max=MAXBITS;max>=1;max--){if(count[max]!==0){break}}if(root>max){root=max}if(max===0){table[table_index++]=1<<24|64<<16|0;table[table_index++]=1<<24|64<<16|0;opts.bits=1;return 0}for(min=1;min<max;min++){if(count[min]!==0){break}}if(root<min){root=min}left=1;for(len=1;len<=MAXBITS;len++){left<<=1;left-=count[len];if(left<0){return-1}}if(left>0&&(type===CODES||max!==1)){return-1}offs[1]=0;for(len=1;len<MAXBITS;len++){offs[len+1]=offs[len]+count[len]}for(sym=0;sym<codes;sym++){if(lens[lens_index+sym]!==0){work[offs[lens[lens_index+sym]]++]=sym}}if(type===CODES){base=extra=work;end=19}else if(type===LENS){base=lbase;base_index-=257;extra=lext;extra_index-=257;end=256}else{base=dbase;extra=dext;end=-1}huff=0;sym=0;len=min;next=table_index;curr=root;drop=0;low=-1;used=1<<root;mask=used-1;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1}var i=0;for(;;){i++;here_bits=len-drop;if(work[sym]<end){here_op=0;here_val=work[sym]}else if(work[sym]>end){here_op=extra[extra_index+work[sym]];here_val=base[base_index+work[sym]]}else{here_op=32+64;here_val=0}incr=1<<len-drop;fill=1<<curr;min=fill;do{fill-=incr;table[next+(huff>>drop)+fill]=here_bits<<24|here_op<<16|here_val|0}while(fill!==0);incr=1<<len-1;while(huff&incr){incr>>=1}if(incr!==0){huff&=incr-1;huff+=incr}else{huff=0}sym++;if(--count[len]===0){if(len===max){break}len=lens[lens_index+work[sym]]}if(len>root&&(huff&mask)!==low){if(drop===0){drop=root}next+=min;curr=len-drop;left=1<<curr;while(curr+drop<max){left-=count[curr+drop];if(left<=0){break}curr++;left<<=1}used+=1<<curr;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1}low=huff&mask;table[low]=root<<24|curr<<16|next-table_index|0}}if(huff!==0){table[next+huff]=len-drop<<24|64<<16|0}opts.bits=root;return 0}},{"../utils/common":734}],742:[function(require,module,exports){"use strict";module.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],743:[function(require,module,exports){"use strict";var utils=require("../utils/common");var Z_FIXED=4;var Z_BINARY=0;var Z_TEXT=1;var Z_UNKNOWN=2;function zero(buf){var len=buf.length;while(--len>=0){buf[len]=0}}var STORED_BLOCK=0;var STATIC_TREES=1;var DYN_TREES=2;var MIN_MATCH=3;var MAX_MATCH=258;var LENGTH_CODES=29;var LITERALS=256;var L_CODES=LITERALS+1+LENGTH_CODES;var D_CODES=30;var BL_CODES=19;var HEAP_SIZE=2*L_CODES+1;var MAX_BITS=15;var Buf_size=16;var MAX_BL_BITS=7;var END_BLOCK=256;var REP_3_6=16;var REPZ_3_10=17;var REPZ_11_138=18;var extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];var extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];var bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var DIST_CODE_LEN=512;var static_ltree=new Array((L_CODES+2)*2);zero(static_ltree);var static_dtree=new Array(D_CODES*2);zero(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero(_dist_code);var _length_code=new Array(MAX_MATCH-MIN_MATCH+1);zero(_length_code);var base_length=new Array(LENGTH_CODES);zero(base_length);var base_dist=new Array(D_CODES);zero(base_dist);function StaticTreeDesc(static_tree,extra_bits,extra_base,elems,max_length){this.static_tree=static_tree;this.extra_bits=extra_bits;this.extra_base=extra_base;this.elems=elems;this.max_length=max_length;this.has_stree=static_tree&&static_tree.length}var static_l_desc;var static_d_desc;var static_bl_desc;function TreeDesc(dyn_tree,stat_desc){this.dyn_tree=dyn_tree;this.max_code=0;this.stat_desc=stat_desc}function d_code(dist){return dist<256?_dist_code[dist]:_dist_code[256+(dist>>>7)]}function put_short(s,w){s.pending_buf[s.pending++]=w&255;s.pending_buf[s.pending++]=w>>>8&255}function send_bits(s,value,length){if(s.bi_valid>Buf_size-length){s.bi_buf|=value<<s.bi_valid&65535;put_short(s,s.bi_buf);s.bi_buf=value>>Buf_size-s.bi_valid;s.bi_valid+=length-Buf_size}else{s.bi_buf|=value<<s.bi_valid&65535;s.bi_valid+=length}}function send_code(s,c,tree){send_bits(s,tree[c*2],tree[c*2+1])}function bi_reverse(code,len){var res=0;do{res|=code&1;code>>>=1;res<<=1}while(--len>0);return res>>>1}function bi_flush(s){if(s.bi_valid===16){put_short(s,s.bi_buf);s.bi_buf=0;s.bi_valid=0}else if(s.bi_valid>=8){s.pending_buf[s.pending++]=s.bi_buf&255;s.bi_buf>>=8;s.bi_valid-=8}}function gen_bitlen(s,desc){var tree=desc.dyn_tree;var max_code=desc.max_code;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var extra=desc.stat_desc.extra_bits;var base=desc.stat_desc.extra_base;var max_length=desc.stat_desc.max_length;var h;var n,m;var bits;var xbits;var f;var overflow=0;for(bits=0;bits<=MAX_BITS;bits++){s.bl_count[bits]=0}tree[s.heap[s.heap_max]*2+1]=0;for(h=s.heap_max+1;h<HEAP_SIZE;h++){n=s.heap[h];bits=tree[tree[n*2+1]*2+1]+1;if(bits>max_length){bits=max_length;overflow++}tree[n*2+1]=bits;if(n>max_code){continue}s.bl_count[bits]++;xbits=0;if(n>=base){xbits=extra[n-base]}f=tree[n*2];s.opt_len+=f*(bits+xbits);if(has_stree){s.static_len+=f*(stree[n*2+1]+xbits)}}if(overflow===0){return}do{bits=max_length-1;while(s.bl_count[bits]===0){bits--}s.bl_count[bits]--;s.bl_count[bits+1]+=2;s.bl_count[max_length]--;overflow-=2}while(overflow>0);for(bits=max_length;bits!==0;bits--){n=s.bl_count[bits];while(n!==0){m=s.heap[--h];if(m>max_code){continue}if(tree[m*2+1]!==bits){s.opt_len+=(bits-tree[m*2+1])*tree[m*2];tree[m*2+1]=bits}n--}}}function gen_codes(tree,max_code,bl_count){var next_code=new Array(MAX_BITS+1);var code=0;var bits;var n;for(bits=1;bits<=MAX_BITS;bits++){next_code[bits]=code=code+bl_count[bits-1]<<1}for(n=0;n<=max_code;n++){var len=tree[n*2+1];if(len===0){continue}tree[n*2]=bi_reverse(next_code[len]++,len)}}function tr_static_init(){var n;var bits;var length;var code;var dist;var bl_count=new Array(MAX_BITS+1);length=0;for(code=0;code<LENGTH_CODES-1;code++){base_length[code]=length;for(n=0;n<1<<extra_lbits[code];n++){_length_code[length++]=code}}_length_code[length-1]=code;dist=0;for(code=0;code<16;code++){base_dist[code]=dist;for(n=0;n<1<<extra_dbits[code];n++){_dist_code[dist++]=code}}dist>>=7;for(;code<D_CODES;code++){base_dist[code]=dist<<7;for(n=0;n<1<<extra_dbits[code]-7;n++){_dist_code[256+dist++]=code}}for(bits=0;bits<=MAX_BITS;bits++){bl_count[bits]=0}n=0;while(n<=143){static_ltree[n*2+1]=8;n++;bl_count[8]++}while(n<=255){static_ltree[n*2+1]=9;n++;bl_count[9]++}while(n<=279){static_ltree[n*2+1]=7;n++;bl_count[7]++}while(n<=287){static_ltree[n*2+1]=8;n++;bl_count[8]++}gen_codes(static_ltree,L_CODES+1,bl_count);for(n=0;n<D_CODES;n++){static_dtree[n*2+1]=5;static_dtree[n*2]=bi_reverse(n,5)}static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS);static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS);static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS)}function init_block(s){var n;for(n=0;n<L_CODES;n++){s.dyn_ltree[n*2]=0}for(n=0;n<D_CODES;n++){s.dyn_dtree[n*2]=0}for(n=0;n<BL_CODES;n++){s.bl_tree[n*2]=0}s.dyn_ltree[END_BLOCK*2]=1;s.opt_len=s.static_len=0;s.last_lit=s.matches=0}function bi_windup(s){if(s.bi_valid>8){put_short(s,s.bi_buf)}else if(s.bi_valid>0){s.pending_buf[s.pending++]=s.bi_buf}s.bi_buf=0;s.bi_valid=0}function copy_block(s,buf,len,header){bi_windup(s);if(header){put_short(s,len);put_short(s,~len)}utils.arraySet(s.pending_buf,s.window,buf,len,s.pending);s.pending+=len}function smaller(tree,n,m,depth){var _n2=n*2;var _m2=m*2;return tree[_n2]<tree[_m2]||tree[_n2]===tree[_m2]&&depth[n]<=depth[m]}function pqdownheap(s,tree,k){var v=s.heap[k];var j=k<<1;while(j<=s.heap_len){if(j<s.heap_len&&smaller(tree,s.heap[j+1],s.heap[j],s.depth)){j++}if(smaller(tree,v,s.heap[j],s.depth)){break}s.heap[k]=s.heap[j];k=j;j<<=1}s.heap[k]=v}function compress_block(s,ltree,dtree){var dist;var lc;var lx=0;var code;var extra;if(s.last_lit!==0){do{dist=s.pending_buf[s.d_buf+lx*2]<<8|s.pending_buf[s.d_buf+lx*2+1];lc=s.pending_buf[s.l_buf+lx];lx++;if(dist===0){send_code(s,lc,ltree)}else{code=_length_code[lc];send_code(s,code+LITERALS+1,ltree);extra=extra_lbits[code];if(extra!==0){lc-=base_length[code];send_bits(s,lc,extra)}dist--;code=d_code(dist);send_code(s,code,dtree);extra=extra_dbits[code];if(extra!==0){dist-=base_dist[code];send_bits(s,dist,extra)}}}while(lx<s.last_lit)}send_code(s,END_BLOCK,ltree)}function build_tree(s,desc){var tree=desc.dyn_tree;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var elems=desc.stat_desc.elems;var n,m;var max_code=-1;var node;s.heap_len=0;s.heap_max=HEAP_SIZE;for(n=0;n<elems;n++){if(tree[n*2]!==0){s.heap[++s.heap_len]=max_code=n;s.depth[n]=0}else{tree[n*2+1]=0}}while(s.heap_len<2){node=s.heap[++s.heap_len]=max_code<2?++max_code:0;tree[node*2]=1;s.depth[node]=0;s.opt_len--;if(has_stree){s.static_len-=stree[node*2+1]}}desc.max_code=max_code;for(n=s.heap_len>>1;n>=1;n--){pqdownheap(s,tree,n)}node=elems;do{n=s.heap[1];s.heap[1]=s.heap[s.heap_len--];pqdownheap(s,tree,1);m=s.heap[1];s.heap[--s.heap_max]=n;s.heap[--s.heap_max]=m;tree[node*2]=tree[n*2]+tree[m*2];s.depth[node]=(s.depth[n]>=s.depth[m]?s.depth[n]:s.depth[m])+1;tree[n*2+1]=tree[m*2+1]=node;s.heap[1]=node++;pqdownheap(s,tree,1)}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1];gen_bitlen(s,desc);gen_codes(tree,max_code,s.bl_count)}function scan_tree(s,tree,max_code){var n;var prevlen=-1;var curlen;var nextlen=tree[0*2+1];var count=0;var max_count=7;var min_count=4;if(nextlen===0){max_count=138;min_count=3;
}tree[(max_code+1)*2+1]=65535;for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1];if(++count<max_count&&curlen===nextlen){continue}else if(count<min_count){s.bl_tree[curlen*2]+=count}else if(curlen!==0){if(curlen!==prevlen){s.bl_tree[curlen*2]++}s.bl_tree[REP_3_6*2]++}else if(count<=10){s.bl_tree[REPZ_3_10*2]++}else{s.bl_tree[REPZ_11_138*2]++}count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3}else if(curlen===nextlen){max_count=6;min_count=3}else{max_count=7;min_count=4}}}function send_tree(s,tree,max_code){var n;var prevlen=-1;var curlen;var nextlen=tree[0*2+1];var count=0;var max_count=7;var min_count=4;if(nextlen===0){max_count=138;min_count=3}for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1];if(++count<max_count&&curlen===nextlen){continue}else if(count<min_count){do{send_code(s,curlen,s.bl_tree)}while(--count!==0)}else if(curlen!==0){if(curlen!==prevlen){send_code(s,curlen,s.bl_tree);count--}send_code(s,REP_3_6,s.bl_tree);send_bits(s,count-3,2)}else if(count<=10){send_code(s,REPZ_3_10,s.bl_tree);send_bits(s,count-3,3)}else{send_code(s,REPZ_11_138,s.bl_tree);send_bits(s,count-11,7)}count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3}else if(curlen===nextlen){max_count=6;min_count=3}else{max_count=7;min_count=4}}}function build_bl_tree(s){var max_blindex;scan_tree(s,s.dyn_ltree,s.l_desc.max_code);scan_tree(s,s.dyn_dtree,s.d_desc.max_code);build_tree(s,s.bl_desc);for(max_blindex=BL_CODES-1;max_blindex>=3;max_blindex--){if(s.bl_tree[bl_order[max_blindex]*2+1]!==0){break}}s.opt_len+=3*(max_blindex+1)+5+5+4;return max_blindex}function send_all_trees(s,lcodes,dcodes,blcodes){var rank;send_bits(s,lcodes-257,5);send_bits(s,dcodes-1,5);send_bits(s,blcodes-4,4);for(rank=0;rank<blcodes;rank++){send_bits(s,s.bl_tree[bl_order[rank]*2+1],3)}send_tree(s,s.dyn_ltree,lcodes-1);send_tree(s,s.dyn_dtree,dcodes-1)}function detect_data_type(s){var black_mask=4093624447;var n;for(n=0;n<=31;n++,black_mask>>>=1){if(black_mask&1&&s.dyn_ltree[n*2]!==0){return Z_BINARY}}if(s.dyn_ltree[9*2]!==0||s.dyn_ltree[10*2]!==0||s.dyn_ltree[13*2]!==0){return Z_TEXT}for(n=32;n<LITERALS;n++){if(s.dyn_ltree[n*2]!==0){return Z_TEXT}}return Z_BINARY}var static_init_done=false;function _tr_init(s){if(!static_init_done){tr_static_init();static_init_done=true}s.l_desc=new TreeDesc(s.dyn_ltree,static_l_desc);s.d_desc=new TreeDesc(s.dyn_dtree,static_d_desc);s.bl_desc=new TreeDesc(s.bl_tree,static_bl_desc);s.bi_buf=0;s.bi_valid=0;init_block(s)}function _tr_stored_block(s,buf,stored_len,last){send_bits(s,(STORED_BLOCK<<1)+(last?1:0),3);copy_block(s,buf,stored_len,true)}function _tr_align(s){send_bits(s,STATIC_TREES<<1,3);send_code(s,END_BLOCK,static_ltree);bi_flush(s)}function _tr_flush_block(s,buf,stored_len,last){var opt_lenb,static_lenb;var max_blindex=0;if(s.level>0){if(s.strm.data_type===Z_UNKNOWN){s.strm.data_type=detect_data_type(s)}build_tree(s,s.l_desc);build_tree(s,s.d_desc);max_blindex=build_bl_tree(s);opt_lenb=s.opt_len+3+7>>>3;static_lenb=s.static_len+3+7>>>3;if(static_lenb<=opt_lenb){opt_lenb=static_lenb}}else{opt_lenb=static_lenb=stored_len+5}if(stored_len+4<=opt_lenb&&buf!==-1){_tr_stored_block(s,buf,stored_len,last)}else if(s.strategy===Z_FIXED||static_lenb===opt_lenb){send_bits(s,(STATIC_TREES<<1)+(last?1:0),3);compress_block(s,static_ltree,static_dtree)}else{send_bits(s,(DYN_TREES<<1)+(last?1:0),3);send_all_trees(s,s.l_desc.max_code+1,s.d_desc.max_code+1,max_blindex+1);compress_block(s,s.dyn_ltree,s.dyn_dtree)}init_block(s);if(last){bi_windup(s)}}function _tr_tally(s,dist,lc){s.pending_buf[s.d_buf+s.last_lit*2]=dist>>>8&255;s.pending_buf[s.d_buf+s.last_lit*2+1]=dist&255;s.pending_buf[s.l_buf+s.last_lit]=lc&255;s.last_lit++;if(dist===0){s.dyn_ltree[lc*2]++}else{s.matches++;dist--;s.dyn_ltree[(_length_code[lc]+LITERALS+1)*2]++;s.dyn_dtree[d_code(dist)*2]++}return s.last_lit===s.lit_bufsize-1}exports._tr_init=_tr_init;exports._tr_stored_block=_tr_stored_block;exports._tr_flush_block=_tr_flush_block;exports._tr_tally=_tr_tally;exports._tr_align=_tr_align},{"../utils/common":734}],744:[function(require,module,exports){"use strict";function ZStream(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}module.exports=ZStream},{}],745:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:11}],746:[function(require,module,exports){"use strict";module.exports=Buffer;var ieee754=require("ieee754");var BufferMethods;function Buffer(length){var arr;if(length&&length.length){arr=length;length=arr.length}var buf=new Uint8Array(length||0);if(arr)buf.set(arr);buf.readUInt32LE=BufferMethods.readUInt32LE;buf.writeUInt32LE=BufferMethods.writeUInt32LE;buf.readInt32LE=BufferMethods.readInt32LE;buf.writeInt32LE=BufferMethods.writeInt32LE;buf.readFloatLE=BufferMethods.readFloatLE;buf.writeFloatLE=BufferMethods.writeFloatLE;buf.readDoubleLE=BufferMethods.readDoubleLE;buf.writeDoubleLE=BufferMethods.writeDoubleLE;buf.toString=BufferMethods.toString;buf.write=BufferMethods.write;buf.slice=BufferMethods.slice;buf.copy=BufferMethods.copy;buf._isBuffer=true;return buf}var lastStr,lastStrEncoded;BufferMethods={readUInt32LE:function(pos){return(this[pos]|this[pos+1]<<8|this[pos+2]<<16)+this[pos+3]*16777216},writeUInt32LE:function(val,pos){this[pos]=val;this[pos+1]=val>>>8;this[pos+2]=val>>>16;this[pos+3]=val>>>24},readInt32LE:function(pos){return(this[pos]|this[pos+1]<<8|this[pos+2]<<16)+(this[pos+3]<<24)},readFloatLE:function(pos){return ieee754.read(this,pos,true,23,4)},readDoubleLE:function(pos){return ieee754.read(this,pos,true,52,8)},writeFloatLE:function(val,pos){return ieee754.write(this,val,pos,true,23,4)},writeDoubleLE:function(val,pos){return ieee754.write(this,val,pos,true,52,8)},toString:function(encoding,start,end){var str="",tmp="";start=start||0;end=Math.min(this.length,end||this.length);for(var i=start;i<end;i++){var ch=this[i];if(ch<=127){str+=decodeURIComponent(tmp)+String.fromCharCode(ch);tmp=""}else{tmp+="%"+ch.toString(16)}}str+=decodeURIComponent(tmp);return str},write:function(str,pos){var bytes=str===lastStr?lastStrEncoded:encodeString(str);for(var i=0;i<bytes.length;i++){this[pos+i]=bytes[i]}},slice:function(start,end){return this.subarray(start,end)},copy:function(buf,pos){pos=pos||0;for(var i=0;i<this.length;i++){buf[pos+i]=this[i]}}};BufferMethods.writeInt32LE=BufferMethods.writeUInt32LE;Buffer.byteLength=function(str){lastStr=str;lastStrEncoded=encodeString(str);return lastStrEncoded.length};Buffer.isBuffer=function(buf){return!!(buf&&buf._isBuffer)};function encodeString(str){var length=str.length,bytes=[];for(var i=0,c,lead;i<length;i++){c=str.charCodeAt(i);if(c>55295&&c<57344){if(lead){if(c<56320){bytes.push(239,191,189);lead=c;continue}else{c=lead-55296<<10|c-56320|65536;lead=null}}else{if(c>56319||i+1===length)bytes.push(239,191,189);else lead=c;continue}}else if(lead){bytes.push(239,191,189);lead=null}if(c<128)bytes.push(c);else if(c<2048)bytes.push(c>>6|192,c&63|128);else if(c<65536)bytes.push(c>>12|224,c>>6&63|128,c&63|128);else bytes.push(c>>18|240,c>>12&63|128,c>>6&63|128,c&63|128)}return bytes}},{ieee754:452}],747:[function(require,module,exports){(function(global){"use strict";module.exports=Pbf;var Buffer=global.Buffer||require("./buffer");function Pbf(buf){this.buf=!Buffer.isBuffer(buf)?new Buffer(buf||0):buf;this.pos=0;this.length=this.buf.length}Pbf.Varint=0;Pbf.Fixed64=1;Pbf.Bytes=2;Pbf.Fixed32=5;var SHIFT_LEFT_32=(1<<16)*(1<<16),SHIFT_RIGHT_32=1/SHIFT_LEFT_32,POW_2_63=Math.pow(2,63);Pbf.prototype={destroy:function(){this.buf=null},readFields:function(readField,result,end){end=end||this.length;while(this.pos<end){var val=this.readVarint(),tag=val>>3,startPos=this.pos;readField(tag,result,this);if(this.pos===startPos)this.skip(val)}return result},readMessage:function(readField,result){return this.readFields(readField,result,this.readVarint()+this.pos)},readFixed32:function(){var val=this.buf.readUInt32LE(this.pos);this.pos+=4;return val},readSFixed32:function(){var val=this.buf.readInt32LE(this.pos);this.pos+=4;return val},readFixed64:function(){var val=this.buf.readUInt32LE(this.pos)+this.buf.readUInt32LE(this.pos+4)*SHIFT_LEFT_32;this.pos+=8;return val},readSFixed64:function(){var val=this.buf.readUInt32LE(this.pos)+this.buf.readInt32LE(this.pos+4)*SHIFT_LEFT_32;this.pos+=8;return val},readFloat:function(){var val=this.buf.readFloatLE(this.pos);this.pos+=4;return val},readDouble:function(){var val=this.buf.readDoubleLE(this.pos);this.pos+=8;return val},readVarint:function(){var buf=this.buf,val,b;b=buf[this.pos++];val=b&127;if(b<128)return val;b=buf[this.pos++];val|=(b&127)<<7;if(b<128)return val;b=buf[this.pos++];val|=(b&127)<<14;if(b<128)return val;b=buf[this.pos++];val|=(b&127)<<21;if(b<128)return val;return readVarintRemainder(val,this)},readVarint64:function(){var startPos=this.pos,val=this.readVarint();if(val<POW_2_63)return val;var pos=this.pos-2;while(this.buf[pos]===255)pos--;if(pos<startPos)pos=startPos;val=0;for(var i=0;i<pos-startPos+1;i++){var b=~this.buf[startPos+i]&127;val+=i<4?b<<i*7:b*Math.pow(2,i*7)}return-val-1},readSVarint:function(){var num=this.readVarint();return num%2===1?(num+1)/-2:num/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var end=this.readVarint()+this.pos,str=this.buf.toString("utf8",this.pos,end);this.pos=end;return str},readBytes:function(){var end=this.readVarint()+this.pos,buffer=this.buf.slice(this.pos,end);this.pos=end;return buffer},readPackedVarint:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readVarint());return arr},readPackedSVarint:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readSVarint());return arr},readPackedBoolean:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readBoolean());return arr},readPackedFloat:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readFloat());return arr},readPackedDouble:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readDouble());return arr},readPackedFixed32:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readFixed32());return arr},readPackedSFixed32:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readSFixed32());return arr},readPackedFixed64:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readFixed64());return arr},readPackedSFixed64:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readSFixed64());return arr},skip:function(val){var type=val&7;if(type===Pbf.Varint)while(this.buf[this.pos++]>127){}else if(type===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(type===Pbf.Fixed32)this.pos+=4;else if(type===Pbf.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+type)},writeTag:function(tag,type){this.writeVarint(tag<<3|type)},realloc:function(min){var length=this.length||16;while(length<this.pos+min)length*=2;if(length!==this.length){var buf=new Buffer(length);this.buf.copy(buf);this.buf=buf;this.length=length}},finish:function(){this.length=this.pos;this.pos=0;return this.buf.slice(0,this.length)},writeFixed32:function(val){this.realloc(4);this.buf.writeUInt32LE(val,this.pos);this.pos+=4},writeSFixed32:function(val){this.realloc(4);this.buf.writeInt32LE(val,this.pos);this.pos+=4},writeFixed64:function(val){this.realloc(8);this.buf.writeInt32LE(val&-1,this.pos);this.buf.writeUInt32LE(Math.floor(val*SHIFT_RIGHT_32),this.pos+4);this.pos+=8},writeSFixed64:function(val){this.realloc(8);this.buf.writeInt32LE(val&-1,this.pos);this.buf.writeInt32LE(Math.floor(val*SHIFT_RIGHT_32),this.pos+4);this.pos+=8},writeVarint:function(val){val=+val;if(val>268435455){writeBigVarint(val,this);return}this.realloc(4);this.buf[this.pos++]=val&127|(val>127?128:0);if(val<=127)return;this.buf[this.pos++]=(val>>>=7)&127|(val>127?128:0);if(val<=127)return;this.buf[this.pos++]=(val>>>=7)&127|(val>127?128:0);if(val<=127)return;this.buf[this.pos++]=val>>>7&127},writeSVarint:function(val){this.writeVarint(val<0?-val*2-1:val*2)},writeBoolean:function(val){this.writeVarint(Boolean(val))},writeString:function(str){str=String(str);var bytes=Buffer.byteLength(str);this.writeVarint(bytes);this.realloc(bytes);this.buf.write(str,this.pos);this.pos+=bytes},writeFloat:function(val){this.realloc(4);this.buf.writeFloatLE(val,this.pos);this.pos+=4},writeDouble:function(val){this.realloc(8);this.buf.writeDoubleLE(val,this.pos);this.pos+=8},writeBytes:function(buffer){var len=buffer.length;this.writeVarint(len);this.realloc(len);for(var i=0;i<len;i++)this.buf[this.pos++]=buffer[i]},writeRawMessage:function(fn,obj){this.pos++;var startPos=this.pos;fn(obj,this);var len=this.pos-startPos;if(len>=128)reallocForRawMessage(startPos,len,this);this.pos=startPos-1;this.writeVarint(len);this.pos+=len},writeMessage:function(tag,fn,obj){this.writeTag(tag,Pbf.Bytes);this.writeRawMessage(fn,obj)},writePackedVarint:function(tag,arr){this.writeMessage(tag,writePackedVarint,arr)},writePackedSVarint:function(tag,arr){this.writeMessage(tag,writePackedSVarint,arr)},writePackedBoolean:function(tag,arr){this.writeMessage(tag,writePackedBoolean,arr)},writePackedFloat:function(tag,arr){this.writeMessage(tag,writePackedFloat,arr)},writePackedDouble:function(tag,arr){this.writeMessage(tag,writePackedDouble,arr)},writePackedFixed32:function(tag,arr){this.writeMessage(tag,writePackedFixed32,arr)},writePackedSFixed32:function(tag,arr){this.writeMessage(tag,writePackedSFixed32,arr)},writePackedFixed64:function(tag,arr){this.writeMessage(tag,writePackedFixed64,arr)},writePackedSFixed64:function(tag,arr){this.writeMessage(tag,writePackedSFixed64,arr)},writeBytesField:function(tag,buffer){this.writeTag(tag,Pbf.Bytes);this.writeBytes(buffer)},writeFixed32Field:function(tag,val){this.writeTag(tag,Pbf.Fixed32);this.writeFixed32(val)},writeSFixed32Field:function(tag,val){this.writeTag(tag,Pbf.Fixed32);this.writeSFixed32(val)},writeFixed64Field:function(tag,val){this.writeTag(tag,Pbf.Fixed64);this.writeFixed64(val)},writeSFixed64Field:function(tag,val){this.writeTag(tag,Pbf.Fixed64);this.writeSFixed64(val)},writeVarintField:function(tag,val){this.writeTag(tag,Pbf.Varint);this.writeVarint(val)},writeSVarintField:function(tag,val){this.writeTag(tag,Pbf.Varint);this.writeSVarint(val)},writeStringField:function(tag,str){this.writeTag(tag,Pbf.Bytes);this.writeString(str)},writeFloatField:function(tag,val){this.writeTag(tag,Pbf.Fixed32);this.writeFloat(val)},writeDoubleField:function(tag,val){this.writeTag(tag,Pbf.Fixed64);this.writeDouble(val)},writeBooleanField:function(tag,val){this.writeVarintField(tag,Boolean(val))}};function readVarintRemainder(val,pbf){var buf=pbf.buf,b;b=buf[pbf.pos++];val+=(b&127)*268435456;if(b<128)return val;b=buf[pbf.pos++];val+=(b&127)*34359738368;if(b<128)return val;b=buf[pbf.pos++];val+=(b&127)*4398046511104;if(b<128)return val;b=buf[pbf.pos++];val+=(b&127)*562949953421312;if(b<128)return val;b=buf[pbf.pos++];val+=(b&127)*72057594037927940;if(b<128)return val;b=buf[pbf.pos++];val+=(b&127)*0x8000000000000000;if(b<128)return val;throw new Error("Expected varint not more than 10 bytes")}function writeBigVarint(val,pbf){pbf.realloc(10);var maxPos=pbf.pos+10;while(val>=1){if(pbf.pos>=maxPos)throw new Error("Given varint doesn't fit into 10 bytes");var b=val&255;pbf.buf[pbf.pos++]=b|(val>=128?128:0);val/=128}}function reallocForRawMessage(startPos,len,pbf){var extraLen=len<=16383?1:len<=2097151?2:len<=268435455?3:Math.ceil(Math.log(len)/(Math.LN2*7));pbf.realloc(extraLen);for(var i=pbf.pos-1;i>=startPos;i--)pbf.buf[i+extraLen]=pbf.buf[i]}function writePackedVarint(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeVarint(arr[i])}function writePackedSVarint(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSVarint(arr[i])}function writePackedFloat(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFloat(arr[i])}function writePackedDouble(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeDouble(arr[i])}function writePackedBoolean(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeBoolean(arr[i])}function writePackedFixed32(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFixed32(arr[i])}function writePackedSFixed32(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSFixed32(arr[i])}function writePackedFixed64(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFixed64(arr[i])}function writePackedSFixed64(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSFixed64(arr[i])}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./buffer":746}],748:[function(require,module,exports){(function(Buffer){"use strict";var interlaceUtils=require("./interlace");var pixelBppMap={1:{0:0,1:0,2:0,3:255},2:{0:0,1:0,2:0,3:1},3:{0:0,1:1,2:2,3:255},4:{0:0,1:1,2:2,3:3}};function bitRetriever(data,depth){var leftOver=[];var i=0;function split(){if(i===data.length){throw new Error("Ran out of data")}var byte=data[i];i++;var byte8,byte7,byte6,byte5,byte4,byte3,byte2,byte1;switch(depth){default:throw new Error("unrecognised depth");case 16:byte2=data[i];i++;leftOver.push((byte<<8)+byte2);break;case 4:byte2=byte&15;byte1=byte>>4;leftOver.push(byte1,byte2);break;case 2:byte4=byte&3;byte3=byte>>2&3;byte2=byte>>4&3;byte1=byte>>6&3;leftOver.push(byte1,byte2,byte3,byte4);break;case 1:byte8=byte&1;byte7=byte>>1&1;byte6=byte>>2&1;byte5=byte>>3&1;byte4=byte>>4&1;byte3=byte>>5&1;byte2=byte>>6&1;byte1=byte>>7&1;leftOver.push(byte1,byte2,byte3,byte4,byte5,byte6,byte7,byte8);break}}return{get:function(count){while(leftOver.length<count){split()}var returner=leftOver.slice(0,count);leftOver=leftOver.slice(count);return returner},resetAfterLine:function(){leftOver.length=0},end:function(){if(i!==data.length){throw new Error("extra data found")}}}}function mapImage8Bit(image,pxData,getPxPos,bpp,data,rawPos){var imageWidth=image.width;var imageHeight=image.height;var imagePass=image.index;for(var y=0;y<imageHeight;y++){for(var x=0;x<imageWidth;x++){var pxPos=getPxPos(x,y,imagePass);for(var i=0;i<4;i++){var idx=pixelBppMap[bpp][i];if(i===data.length){throw new Error("Ran out of data")}pxData[pxPos+i]=idx!==255?data[idx+rawPos]:255}rawPos+=bpp}}return rawPos}function mapImageCustomBit(image,pxData,getPxPos,bpp,bits,maxBit){var imageWidth=image.width;var imageHeight=image.height;var imagePass=image.index;for(var y=0;y<imageHeight;y++){for(var x=0;x<imageWidth;x++){var pixelData=bits.get(bpp);var pxPos=getPxPos(x,y,imagePass);for(var i=0;i<4;i++){var idx=pixelBppMap[bpp][i];pxData[pxPos+i]=idx!==255?pixelData[idx]:maxBit}}bits.resetAfterLine()}}exports.dataToBitMap=function(data,bitmapInfo){var width=bitmapInfo.width;var height=bitmapInfo.height;var depth=bitmapInfo.depth;var bpp=bitmapInfo.bpp;var interlace=bitmapInfo.interlace;if(depth!==8){var bits=bitRetriever(data,depth)}var pxData;if(depth<=8){pxData=new Buffer(width*height*4)}else{pxData=new Uint16Array(width*height*4)}var maxBit=Math.pow(2,depth)-1;var rawPos=0;var images;var getPxPos;if(interlace){images=interlaceUtils.getImagePasses(width,height);getPxPos=interlaceUtils.getInterlaceIterator(width,height)}else{var nonInterlacedPxPos=0;getPxPos=function(){var returner=nonInterlacedPxPos;nonInterlacedPxPos+=4;return returner};images=[{width:width,height:height}]}for(var imageIndex=0;imageIndex<images.length;imageIndex++){if(depth===8){rawPos=mapImage8Bit(images[imageIndex],pxData,getPxPos,bpp,data,rawPos)}else{mapImageCustomBit(images[imageIndex],pxData,getPxPos,bpp,bits,maxBit)}}if(depth===8){if(rawPos!==data.length){throw new Error("extra data found")}}else{bits.end()}return pxData}}).call(this,require("buffer").Buffer)},{"./interlace":758,buffer:19}],749:[function(require,module,exports){(function(Buffer){"use strict";var constants=require("./constants");module.exports=function(data,width,height,options){var outHasAlpha=options.colorType===constants.COLORTYPE_COLOR_ALPHA;if(options.inputHasAlpha&&outHasAlpha){return data}if(!options.inputHasAlpha&&!outHasAlpha){return data}var outBpp=outHasAlpha?4:3;var outData=new Buffer(width*height*outBpp);var inBpp=options.inputHasAlpha?4:3;var inIndex=0;var outIndex=0;var bgColor=options.bgColor||{};if(bgColor.red===undefined){bgColor.red=255}if(bgColor.green===undefined){bgColor.green=255}if(bgColor.blue===undefined){bgColor.blue=255}for(var y=0;y<height;y++){for(var x=0;x<width;x++){var red=data[inIndex];var green=data[inIndex+1];var blue=data[inIndex+2];var alpha;if(options.inputHasAlpha){alpha=data[inIndex+3];if(!outHasAlpha){alpha/=255;red=Math.min(Math.max(Math.round((1-alpha)*bgColor.red+alpha*red),0),255);green=Math.min(Math.max(Math.round((1-alpha)*bgColor.green+alpha*green),0),255);blue=Math.min(Math.max(Math.round((1-alpha)*bgColor.blue+alpha*blue),0),255)}}else{alpha=255}outData[outIndex]=red;outData[outIndex+1]=green;outData[outIndex+2]=blue;if(outHasAlpha){outData[outIndex+3]=alpha}inIndex+=inBpp;outIndex+=outBpp}}return outData}}).call(this,require("buffer").Buffer)},{"./constants":751,buffer:19}],750:[function(require,module,exports){(function(process,Buffer){"use strict";var util=require("util");var Stream=require("stream");var ChunkStream=module.exports=function(){Stream.call(this);this._buffers=[];this._buffered=0;this._reads=[];this._paused=false;this._encoding="utf8";this.writable=true};util.inherits(ChunkStream,Stream);ChunkStream.prototype.read=function(length,callback){this._reads.push({length:Math.abs(length),allowLess:length<0,func:callback});process.nextTick(function(){this._process();if(this._paused&&this._reads.length>0){this._paused=false;this.emit("drain")}}.bind(this))};ChunkStream.prototype.write=function(data,encoding){if(!this.writable){this.emit("error",new Error("Stream not writable"));return false}var dataBuffer;if(Buffer.isBuffer(data)){dataBuffer=data}else{dataBuffer=new Buffer(data,encoding||this._encoding)}this._buffers.push(dataBuffer);this._buffered+=dataBuffer.length;this._process();if(this._reads&&this._reads.length===0){this._paused=true}return this.writable&&!this._paused};ChunkStream.prototype.end=function(data,encoding){if(data){this.write(data,encoding)}this.writable=false;if(!this._buffers){return}if(this._buffers.length===0){this._end()}else{this._buffers.push(null);this._process()}};ChunkStream.prototype.destroySoon=ChunkStream.prototype.end;ChunkStream.prototype._end=function(){if(this._reads.length>0){this.emit("error",new Error("There are some read requests waitng on finished stream"))}this.destroy()};ChunkStream.prototype.destroy=function(){if(!this._buffers){return}this.writable=false;this._reads=null;this._buffers=null;this.emit("close")};ChunkStream.prototype._processReadAllowingLess=function(read){this._reads.shift();var smallerBuf=this._buffers[0];if(smallerBuf.length>read.length){this._buffered-=read.length;this._buffers[0]=smallerBuf.slice(read.length);read.func.call(this,smallerBuf.slice(0,read.length))}else{this._buffered-=smallerBuf.length;this._buffers.shift();read.func.call(this,smallerBuf)}};ChunkStream.prototype._processRead=function(read){this._reads.shift();var pos=0;var count=0;var data=new Buffer(read.length);while(pos<read.length){var buf=this._buffers[count++];var len=Math.min(buf.length,read.length-pos);buf.copy(data,pos,0,len);pos+=len;if(len!==buf.length){this._buffers[--count]=buf.slice(len)}}if(count>0){this._buffers.splice(0,count)}this._buffered-=read.length;read.func.call(this,data)};ChunkStream.prototype._process=function(){try{while(this._buffered>0&&this._reads&&this._reads.length>0){var read=this._reads[0];if(read.allowLess){this._processReadAllowingLess(read)}else if(this._buffered>=read.length){this._processRead(read)}else{break}}if(this._buffers&&this._buffers.length>0&&this._buffers[0]===null){this._end()}}catch(ex){this.emit("error",ex)}}}).call(this,require("_process"),require("buffer").Buffer)},{_process:11,buffer:19,stream:969,util:996}],751:[function(require,module,exports){"use strict";module.exports={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5}},{}],752:[function(require,module,exports){"use strict";var crcTable=[];(function(){for(var i=0;i<256;i++){var currentCrc=i;for(var j=0;j<8;j++){if(currentCrc&1){currentCrc=3988292384^currentCrc>>>1}else{currentCrc=currentCrc>>>1}}crcTable[i]=currentCrc}})();var CrcCalculator=module.exports=function(){this._crc=-1};CrcCalculator.prototype.write=function(data){for(var i=0;i<data.length;i++){this._crc=crcTable[(this._crc^data[i])&255]^this._crc>>>8}return true};CrcCalculator.prototype.crc32=function(){return this._crc^-1};CrcCalculator.crc32=function(buf){var crc=-1;for(var i=0;i<buf.length;i++){crc=crcTable[(crc^buf[i])&255]^crc>>>8}return crc^-1}},{}],753:[function(require,module,exports){(function(Buffer){"use strict";var paethPredictor=require("./paeth-predictor");function filterNone(pxData,pxPos,byteWidth,rawData,rawPos){pxData.copy(rawData,rawPos,pxPos,pxPos+byteWidth)}function filterSumNone(pxData,pxPos,byteWidth){var sum=0;var length=pxPos+byteWidth;for(var i=pxPos;i<length;i++){sum+=Math.abs(pxData[i])}return sum}function filterSub(pxData,pxPos,byteWidth,rawData,rawPos,bpp){for(var x=0;x<byteWidth;x++){var left=x>=bpp?pxData[pxPos+x-bpp]:0;var val=pxData[pxPos+x]-left;rawData[rawPos+x]=val}}function filterSumSub(pxData,pxPos,byteWidth,bpp){var sum=0;for(var x=0;x<byteWidth;x++){var left=x>=bpp?pxData[pxPos+x-bpp]:0;var val=pxData[pxPos+x]-left;sum+=Math.abs(val)}return sum}function filterUp(pxData,pxPos,byteWidth,rawData,rawPos){for(var x=0;x<byteWidth;x++){var up=pxPos>0?pxData[pxPos+x-byteWidth]:0;var val=pxData[pxPos+x]-up;rawData[rawPos+x]=val}}function filterSumUp(pxData,pxPos,byteWidth){var sum=0;var length=pxPos+byteWidth;for(var x=pxPos;x<length;x++){var up=pxPos>0?pxData[x-byteWidth]:0;var val=pxData[x]-up;sum+=Math.abs(val)}return sum}function filterAvg(pxData,pxPos,byteWidth,rawData,rawPos,bpp){for(var x=0;x<byteWidth;x++){var left=x>=bpp?pxData[pxPos+x-bpp]:0;var up=pxPos>0?pxData[pxPos+x-byteWidth]:0;var val=pxData[pxPos+x]-(left+up>>1);rawData[rawPos+x]=val}}function filterSumAvg(pxData,pxPos,byteWidth,bpp){var sum=0;for(var x=0;x<byteWidth;x++){var left=x>=bpp?pxData[pxPos+x-bpp]:0;var up=pxPos>0?pxData[pxPos+x-byteWidth]:0;var val=pxData[pxPos+x]-(left+up>>1);sum+=Math.abs(val)}return sum}function filterPaeth(pxData,pxPos,byteWidth,rawData,rawPos,bpp){for(var x=0;x<byteWidth;x++){var left=x>=bpp?pxData[pxPos+x-bpp]:0;var up=pxPos>0?pxData[pxPos+x-byteWidth]:0;var upleft=pxPos>0&&x>=bpp?pxData[pxPos+x-(byteWidth+bpp)]:0;var val=pxData[pxPos+x]-paethPredictor(left,up,upleft);rawData[rawPos+x]=val}}function filterSumPaeth(pxData,pxPos,byteWidth,bpp){var sum=0;for(var x=0;x<byteWidth;x++){var left=x>=bpp?pxData[pxPos+x-bpp]:0;var up=pxPos>0?pxData[pxPos+x-byteWidth]:0;var upleft=pxPos>0&&x>=bpp?pxData[pxPos+x-(byteWidth+bpp)]:0;var val=pxData[pxPos+x]-paethPredictor(left,up,upleft);sum+=Math.abs(val)}return sum}var filters={0:filterNone,1:filterSub,2:filterUp,3:filterAvg,4:filterPaeth};var filterSums={0:filterSumNone,1:filterSumSub,2:filterSumUp,3:filterSumAvg,4:filterSumPaeth};module.exports=function(pxData,width,height,options,bpp){var filterTypes;if(!("filterType"in options)||options.filterType===-1){filterTypes=[0,1,2,3,4]}else if(typeof options.filterType==="number"){filterTypes=[options.filterType]}else{throw new Error("unrecognised filter types")}var byteWidth=width*bpp;var rawPos=0;var pxPos=0;var rawData=new Buffer((byteWidth+1)*height);var sel=filterTypes[0];for(var y=0;y<height;y++){if(filterTypes.length>1){var min=Infinity;for(var i=0;i<filterTypes.length;i++){var sum=filterSums[filterTypes[i]](pxData,pxPos,byteWidth,bpp);if(sum<min){sel=filterTypes[i];min=sum}}}rawData[rawPos]=sel;rawPos++;filters[sel](pxData,pxPos,byteWidth,rawData,rawPos,bpp);rawPos+=byteWidth;pxPos+=byteWidth}return rawData}}).call(this,require("buffer").Buffer)},{"./paeth-predictor":762,buffer:19}],754:[function(require,module,exports){(function(Buffer){"use strict";var util=require("util");var ChunkStream=require("./chunkstream");var Filter=require("./filter-parse");var FilterAsync=module.exports=function(bitmapInfo){ChunkStream.call(this);var buffers=[];var that=this;this._filter=new Filter(bitmapInfo,{read:this.read.bind(this),write:function(buffer){buffers.push(buffer)},complete:function(){that.emit("complete",Buffer.concat(buffers))}});this._filter.start()};util.inherits(FilterAsync,ChunkStream)}).call(this,require("buffer").Buffer)},{"./chunkstream":750,"./filter-parse":756,
buffer:19,util:996}],755:[function(require,module,exports){(function(Buffer){"use strict";var SyncReader=require("./sync-reader");var Filter=require("./filter-parse");exports.process=function(inBuffer,bitmapInfo){var outBuffers=[];var reader=new SyncReader(inBuffer);var filter=new Filter(bitmapInfo,{read:reader.read.bind(reader),write:function(bufferPart){outBuffers.push(bufferPart)},complete:function(){}});filter.start();reader.process();return Buffer.concat(outBuffers)}}).call(this,require("buffer").Buffer)},{"./filter-parse":756,"./sync-reader":768,buffer:19}],756:[function(require,module,exports){(function(Buffer){"use strict";var interlaceUtils=require("./interlace");var paethPredictor=require("./paeth-predictor");function getByteWidth(width,bpp,depth){var byteWidth=width*bpp;if(depth!==8){byteWidth=Math.ceil(byteWidth/(8/depth))}return byteWidth}var Filter=module.exports=function(bitmapInfo,dependencies){var width=bitmapInfo.width;var height=bitmapInfo.height;var interlace=bitmapInfo.interlace;var bpp=bitmapInfo.bpp;var depth=bitmapInfo.depth;this.read=dependencies.read;this.write=dependencies.write;this.complete=dependencies.complete;this._imageIndex=0;this._images=[];if(interlace){var passes=interlaceUtils.getImagePasses(width,height);for(var i=0;i<passes.length;i++){this._images.push({byteWidth:getByteWidth(passes[i].width,bpp,depth),height:passes[i].height,lineIndex:0})}}else{this._images.push({byteWidth:getByteWidth(width,bpp,depth),height:height,lineIndex:0})}if(depth===8){this._xComparison=bpp}else if(depth===16){this._xComparison=bpp*2}else{this._xComparison=1}};Filter.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))};Filter.prototype._unFilterType1=function(rawData,unfilteredLine,byteWidth){var xComparison=this._xComparison;var xBiggerThan=xComparison-1;for(var x=0;x<byteWidth;x++){var rawByte=rawData[1+x];var f1Left=x>xBiggerThan?unfilteredLine[x-xComparison]:0;unfilteredLine[x]=rawByte+f1Left}};Filter.prototype._unFilterType2=function(rawData,unfilteredLine,byteWidth){var lastLine=this._lastLine;for(var x=0;x<byteWidth;x++){var rawByte=rawData[1+x];var f2Up=lastLine?lastLine[x]:0;unfilteredLine[x]=rawByte+f2Up}};Filter.prototype._unFilterType3=function(rawData,unfilteredLine,byteWidth){var xComparison=this._xComparison;var xBiggerThan=xComparison-1;var lastLine=this._lastLine;for(var x=0;x<byteWidth;x++){var rawByte=rawData[1+x];var f3Up=lastLine?lastLine[x]:0;var f3Left=x>xBiggerThan?unfilteredLine[x-xComparison]:0;var f3Add=Math.floor((f3Left+f3Up)/2);unfilteredLine[x]=rawByte+f3Add}};Filter.prototype._unFilterType4=function(rawData,unfilteredLine,byteWidth){var xComparison=this._xComparison;var xBiggerThan=xComparison-1;var lastLine=this._lastLine;for(var x=0;x<byteWidth;x++){var rawByte=rawData[1+x];var f4Up=lastLine?lastLine[x]:0;var f4Left=x>xBiggerThan?unfilteredLine[x-xComparison]:0;var f4UpLeft=x>xBiggerThan&&lastLine?lastLine[x-xComparison]:0;var f4Add=paethPredictor(f4Left,f4Up,f4UpLeft);unfilteredLine[x]=rawByte+f4Add}};Filter.prototype._reverseFilterLine=function(rawData){var filter=rawData[0];var unfilteredLine;var currentImage=this._images[this._imageIndex];var byteWidth=currentImage.byteWidth;if(filter===0){unfilteredLine=rawData.slice(1,byteWidth+1)}else{unfilteredLine=new Buffer(byteWidth);switch(filter){case 1:this._unFilterType1(rawData,unfilteredLine,byteWidth);break;case 2:this._unFilterType2(rawData,unfilteredLine,byteWidth);break;case 3:this._unFilterType3(rawData,unfilteredLine,byteWidth);break;case 4:this._unFilterType4(rawData,unfilteredLine,byteWidth);break;default:throw new Error("Unrecognised filter type - "+filter)}}this.write(unfilteredLine);currentImage.lineIndex++;if(currentImage.lineIndex>=currentImage.height){this._lastLine=null;this._imageIndex++;currentImage=this._images[this._imageIndex]}else{this._lastLine=unfilteredLine}if(currentImage){this.read(currentImage.byteWidth+1,this._reverseFilterLine.bind(this))}else{this._lastLine=null;this.complete()}}}).call(this,require("buffer").Buffer)},{"./interlace":758,"./paeth-predictor":762,buffer:19}],757:[function(require,module,exports){(function(Buffer){"use strict";function dePalette(indata,outdata,width,height,palette){var pxPos=0;for(var y=0;y<height;y++){for(var x=0;x<width;x++){var color=palette[indata[pxPos]];if(!color){throw new Error("index "+indata[pxPos]+" not in palette")}for(var i=0;i<4;i++){outdata[pxPos+i]=color[i]}pxPos+=4}}}function replaceTransparentColor(indata,outdata,width,height,transColor){var pxPos=0;for(var y=0;y<height;y++){for(var x=0;x<width;x++){var makeTrans=false;if(transColor.length===1){if(transColor[0]===indata[pxPos]){makeTrans=true}}else if(transColor[0]===indata[pxPos]&&transColor[1]===indata[pxPos+1]&&transColor[2]===indata[pxPos+2]){makeTrans=true}if(makeTrans){for(var i=0;i<4;i++){outdata[pxPos+i]=0}}pxPos+=4}}}function scaleDepth(indata,outdata,width,height,depth){var maxOutSample=255;var maxInSample=Math.pow(2,depth)-1;var pxPos=0;for(var y=0;y<height;y++){for(var x=0;x<width;x++){for(var i=0;i<4;i++){outdata[pxPos+i]=Math.floor(indata[pxPos+i]*maxOutSample/maxInSample+.5)}pxPos+=4}}}module.exports=function(indata,imageData){var depth=imageData.depth;var width=imageData.width;var height=imageData.height;var colorType=imageData.colorType;var transColor=imageData.transColor;var palette=imageData.palette;var outdata=indata;if(colorType===3){dePalette(indata,outdata,width,height,palette)}else{if(transColor){replaceTransparentColor(indata,outdata,width,height,transColor)}if(depth!==8){if(depth===16){outdata=new Buffer(width*height*4)}scaleDepth(indata,outdata,width,height,depth)}}return outdata}}).call(this,require("buffer").Buffer)},{buffer:19}],758:[function(require,module,exports){"use strict";var imagePasses=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];exports.getImagePasses=function(width,height){var images=[];var xLeftOver=width%8;var yLeftOver=height%8;var xRepeats=(width-xLeftOver)/8;var yRepeats=(height-yLeftOver)/8;for(var i=0;i<imagePasses.length;i++){var pass=imagePasses[i];var passWidth=xRepeats*pass.x.length;var passHeight=yRepeats*pass.y.length;for(var j=0;j<pass.x.length;j++){if(pass.x[j]<xLeftOver){passWidth++}else{break}}for(j=0;j<pass.y.length;j++){if(pass.y[j]<yLeftOver){passHeight++}else{break}}if(passWidth>0&&passHeight>0){images.push({width:passWidth,height:passHeight,index:i})}}return images};exports.getInterlaceIterator=function(width){return function(x,y,pass){var outerXLeftOver=x%imagePasses[pass].x.length;var outerX=(x-outerXLeftOver)/imagePasses[pass].x.length*8+imagePasses[pass].x[outerXLeftOver];var outerYLeftOver=y%imagePasses[pass].y.length;var outerY=(y-outerYLeftOver)/imagePasses[pass].y.length*8+imagePasses[pass].y[outerYLeftOver];return outerX*4+outerY*width*4}}},{}],759:[function(require,module,exports){(function(Buffer){"use strict";var util=require("util");var Stream=require("stream");var constants=require("./constants");var Packer=require("./packer");var PackerAsync=module.exports=function(opt){Stream.call(this);var options=opt||{};this._packer=new Packer(options);this._deflate=this._packer.createDeflate();this.readable=true};util.inherits(PackerAsync,Stream);PackerAsync.prototype.pack=function(data,width,height,gamma){this.emit("data",new Buffer(constants.PNG_SIGNATURE));this.emit("data",this._packer.packIHDR(width,height));if(gamma){this.emit("data",this._packer.packGAMA(gamma))}var filteredData=this._packer.filterData(data,width,height);this._deflate.on("error",this.emit.bind(this,"error"));this._deflate.on("data",function(compressedData){this.emit("data",this._packer.packIDAT(compressedData))}.bind(this));this._deflate.on("end",function(){this.emit("data",this._packer.packIEND());this.emit("end")}.bind(this));this._deflate.end(filteredData)}}).call(this,require("buffer").Buffer)},{"./constants":751,"./packer":761,buffer:19,stream:969,util:996}],760:[function(require,module,exports){(function(Buffer){"use strict";var hasSyncZlib=true;var zlib=require("zlib");if(!zlib.deflateSync){hasSyncZlib=false}var constants=require("./constants");var Packer=require("./packer");module.exports=function(metaData,opt){if(!hasSyncZlib){throw new Error("To use the sync capability of this library in old node versions, please also add a dependency on node-zlb-backport")}var options=opt||{};var packer=new Packer(options);var chunks=[];chunks.push(new Buffer(constants.PNG_SIGNATURE));chunks.push(packer.packIHDR(metaData.width,metaData.height));if(metaData.gamma){chunks.push(packer.packGAMA(metaData.gamma))}var filteredData=packer.filterData(metaData.data,metaData.width,metaData.height);var compressedData=zlib.deflateSync(filteredData,packer.getDeflateOptions());filteredData=null;if(!compressedData||!compressedData.length){throw new Error("bad png - invalid compressed data response")}chunks.push(packer.packIDAT(compressedData));chunks.push(packer.packIEND());return Buffer.concat(chunks)}}).call(this,require("buffer").Buffer)},{"./constants":751,"./packer":761,buffer:19,zlib:8}],761:[function(require,module,exports){(function(Buffer){"use strict";var constants=require("./constants");var CrcStream=require("./crc");var bitPacker=require("./bitpacker");var filter=require("./filter-pack");var zlib=require("zlib");var Packer=module.exports=function(options){this._options=options;options.deflateChunkSize=options.deflateChunkSize||32*1024;options.deflateLevel=options.deflateLevel!=null?options.deflateLevel:9;options.deflateStrategy=options.deflateStrategy!=null?options.deflateStrategy:3;options.inputHasAlpha=options.inputHasAlpha!=null?options.inputHasAlpha:true;options.deflateFactory=options.deflateFactory||zlib.createDeflate;options.bitDepth=options.bitDepth||8;options.colorType=typeof options.colorType==="number"?options.colorType:constants.COLORTYPE_COLOR_ALPHA;if(options.colorType!==constants.COLORTYPE_COLOR&&options.colorType!==constants.COLORTYPE_COLOR_ALPHA){throw new Error("option color type:"+options.colorType+" is not supported at present")}if(options.bitDepth!==8){throw new Error("option bit depth:"+options.bitDepth+" is not supported at present")}};Packer.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}};Packer.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())};Packer.prototype.filterData=function(data,width,height){var packedData=bitPacker(data,width,height,this._options);var bpp=constants.COLORTYPE_TO_BPP_MAP[this._options.colorType];var filteredData=filter(packedData,width,height,this._options,bpp);return filteredData};Packer.prototype._packChunk=function(type,data){var len=data?data.length:0;var buf=new Buffer(len+12);buf.writeUInt32BE(len,0);buf.writeUInt32BE(type,4);if(data){data.copy(buf,8)}buf.writeInt32BE(CrcStream.crc32(buf.slice(4,buf.length-4)),buf.length-4);return buf};Packer.prototype.packGAMA=function(gamma){var buf=new Buffer(4);buf.writeUInt32BE(Math.floor(gamma*constants.GAMMA_DIVISION),0);return this._packChunk(constants.TYPE_gAMA,buf)};Packer.prototype.packIHDR=function(width,height){var buf=new Buffer(13);buf.writeUInt32BE(width,0);buf.writeUInt32BE(height,4);buf[8]=this._options.bitDepth;buf[9]=this._options.colorType;buf[10]=0;buf[11]=0;buf[12]=0;return this._packChunk(constants.TYPE_IHDR,buf)};Packer.prototype.packIDAT=function(data){return this._packChunk(constants.TYPE_IDAT,data)};Packer.prototype.packIEND=function(){return this._packChunk(constants.TYPE_IEND,null)}}).call(this,require("buffer").Buffer)},{"./bitpacker":749,"./constants":751,"./crc":752,"./filter-pack":753,buffer:19,zlib:8}],762:[function(require,module,exports){"use strict";module.exports=function paethPredictor(left,above,upLeft){var paeth=left+above-upLeft;var pLeft=Math.abs(paeth-left);var pAbove=Math.abs(paeth-above);var pUpLeft=Math.abs(paeth-upLeft);if(pLeft<=pAbove&&pLeft<=pUpLeft){return left}if(pAbove<=pUpLeft){return above}return upLeft}},{}],763:[function(require,module,exports){"use strict";var util=require("util");var zlib=require("zlib");var ChunkStream=require("./chunkstream");var FilterAsync=require("./filter-parse-async");var Parser=require("./parser");var bitmapper=require("./bitmapper");var formatNormaliser=require("./format-normaliser");var ParserAsync=module.exports=function(options){ChunkStream.call(this);this._parser=new Parser(options,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this)});this._options=options;this.writable=true;this._parser.start()};util.inherits(ParserAsync,ChunkStream);ParserAsync.prototype._handleError=function(err){this.emit("error",err);this.writable=false;this.destroy();if(this._inflate&&this._inflate.destroy){this._inflate.destroy()}this.errord=true};ParserAsync.prototype._inflateData=function(data){if(!this._inflate){this._inflate=zlib.createInflate();this._inflate.on("error",this.emit.bind(this,"error"));this._filter.on("complete",this._complete.bind(this));this._inflate.pipe(this._filter)}this._inflate.write(data)};ParserAsync.prototype._handleMetaData=function(metaData){this.emit("metadata",metaData);this._bitmapInfo=Object.create(metaData);this._filter=new FilterAsync(this._bitmapInfo)};ParserAsync.prototype._handleTransColor=function(transColor){this._bitmapInfo.transColor=transColor};ParserAsync.prototype._handlePalette=function(palette){this._bitmapInfo.palette=palette};ParserAsync.prototype._finished=function(){if(this.errord){return}if(!this._inflate){this.emit("error","No Inflate block")}else{this._inflate.end()}this.destroySoon()};ParserAsync.prototype._complete=function(filteredData){if(this.errord){return}try{var bitmapData=bitmapper.dataToBitMap(filteredData,this._bitmapInfo);var normalisedBitmapData=formatNormaliser(bitmapData,this._bitmapInfo);bitmapData=null}catch(ex){this._handleError(ex);return}this.emit("parsed",normalisedBitmapData)}},{"./bitmapper":748,"./chunkstream":750,"./filter-parse-async":754,"./format-normaliser":757,"./parser":765,util:996,zlib:8}],764:[function(require,module,exports){(function(Buffer){"use strict";var hasSyncZlib=true;var zlib=require("zlib");if(!zlib.deflateSync){hasSyncZlib=false}var SyncReader=require("./sync-reader");var FilterSync=require("./filter-parse-sync");var Parser=require("./parser");var bitmapper=require("./bitmapper");var formatNormaliser=require("./format-normaliser");module.exports=function(buffer,options){if(!hasSyncZlib){throw new Error("To use the sync capability of this library in old node versions, please also add a dependency on node-zlb-backport")}var err;function handleError(_err_){err=_err_}var metaData;function handleMetaData(_metaData_){metaData=_metaData_}function handleTransColor(transColor){metaData.transColor=transColor}function handlePalette(palette){metaData.palette=palette}var gamma;function handleGamma(_gamma_){gamma=_gamma_}var inflateDataList=[];function handleInflateData(inflatedData){inflateDataList.push(inflatedData)}var reader=new SyncReader(buffer);var parser=new Parser(options,{read:reader.read.bind(reader),error:handleError,metadata:handleMetaData,gamma:handleGamma,palette:handlePalette,transColor:handleTransColor,inflateData:handleInflateData});parser.start();reader.process();if(err){throw err}var inflateData=Buffer.concat(inflateDataList);inflateDataList.length=0;var inflatedData=zlib.inflateSync(inflateData);inflateData=null;if(!inflatedData||!inflatedData.length){throw new Error("bad png - invalid inflate data response")}var unfilteredData=FilterSync.process(inflatedData,metaData);inflateData=null;var bitmapData=bitmapper.dataToBitMap(unfilteredData,metaData);unfilteredData=null;var normalisedBitmapData=formatNormaliser(bitmapData,metaData);metaData.data=normalisedBitmapData;metaData.gamma=gamma||0;return metaData}}).call(this,require("buffer").Buffer)},{"./bitmapper":748,"./filter-parse-sync":755,"./format-normaliser":757,"./parser":765,"./sync-reader":768,buffer:19,zlib:8}],765:[function(require,module,exports){(function(Buffer){"use strict";var constants=require("./constants");var CrcCalculator=require("./crc");var Parser=module.exports=function(options,dependencies){this._options=options;options.checkCRC=options.checkCRC!==false;this._hasIHDR=false;this._hasIEND=false;this._palette=[];this._colorType=0;this._chunks={};this._chunks[constants.TYPE_IHDR]=this._handleIHDR.bind(this);this._chunks[constants.TYPE_IEND]=this._handleIEND.bind(this);this._chunks[constants.TYPE_IDAT]=this._handleIDAT.bind(this);this._chunks[constants.TYPE_PLTE]=this._handlePLTE.bind(this);this._chunks[constants.TYPE_tRNS]=this._handleTRNS.bind(this);this._chunks[constants.TYPE_gAMA]=this._handleGAMA.bind(this);this.read=dependencies.read;this.error=dependencies.error;this.metadata=dependencies.metadata;this.gamma=dependencies.gamma;this.transColor=dependencies.transColor;this.palette=dependencies.palette;this.parsed=dependencies.parsed;this.inflateData=dependencies.inflateData;this.inflateData=dependencies.inflateData;this.finished=dependencies.finished};Parser.prototype.start=function(){this.read(constants.PNG_SIGNATURE.length,this._parseSignature.bind(this))};Parser.prototype._parseSignature=function(data){var signature=constants.PNG_SIGNATURE;for(var i=0;i<signature.length;i++){if(data[i]!==signature[i]){this.error(new Error("Invalid file signature"));return}}this.read(8,this._parseChunkBegin.bind(this))};Parser.prototype._parseChunkBegin=function(data){var length=data.readUInt32BE(0);var type=data.readUInt32BE(4);var name="";for(var i=4;i<8;i++){name+=String.fromCharCode(data[i])}var ancillary=Boolean(data[4]&32);if(!this._hasIHDR&&type!==constants.TYPE_IHDR){this.error(new Error("Expected IHDR on beggining"));return}this._crc=new CrcCalculator;this._crc.write(new Buffer(name));if(this._chunks[type]){return this._chunks[type](length)}if(!ancillary){this.error(new Error("Unsupported critical chunk type "+name));return}this.read(length+4,this._skipChunk.bind(this))};Parser.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))};Parser.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))};Parser.prototype._parseChunkEnd=function(data){var fileCrc=data.readInt32BE(0);var calcCrc=this._crc.crc32();if(this._options.checkCRC&&calcCrc!==fileCrc){this.error(new Error("Crc error - "+fileCrc+" - "+calcCrc));return}if(!this._hasIEND){this.read(8,this._parseChunkBegin.bind(this))}};Parser.prototype._handleIHDR=function(length){this.read(length,this._parseIHDR.bind(this))};Parser.prototype._parseIHDR=function(data){this._crc.write(data);var width=data.readUInt32BE(0);var height=data.readUInt32BE(4);var depth=data[8];var colorType=data[9];var compr=data[10];var filter=data[11];var interlace=data[12];if(depth!==8&&depth!==4&&depth!==2&&depth!==1&&depth!==16){this.error(new Error("Unsupported bit depth "+depth));return}if(!(colorType in constants.COLORTYPE_TO_BPP_MAP)){this.error(new Error("Unsupported color type"));return}if(compr!==0){this.error(new Error("Unsupported compression method"));return}if(filter!==0){this.error(new Error("Unsupported filter method"));return}if(interlace!==0&&interlace!==1){this.error(new Error("Unsupported interlace method"));return}this._colorType=colorType;var bpp=constants.COLORTYPE_TO_BPP_MAP[this._colorType];this._hasIHDR=true;this.metadata({width:width,height:height,depth:depth,interlace:Boolean(interlace),palette:Boolean(colorType&constants.COLORTYPE_PALETTE),color:Boolean(colorType&constants.COLORTYPE_COLOR),alpha:Boolean(colorType&constants.COLORTYPE_ALPHA),bpp:bpp,colorType:colorType});this._handleChunkEnd()};Parser.prototype._handlePLTE=function(length){this.read(length,this._parsePLTE.bind(this))};Parser.prototype._parsePLTE=function(data){this._crc.write(data);var entries=Math.floor(data.length/3);for(var i=0;i<entries;i++){this._palette.push([data[i*3],data[i*3+1],data[i*3+2],255])}this.palette(this._palette);this._handleChunkEnd()};Parser.prototype._handleTRNS=function(length){this.read(length,this._parseTRNS.bind(this))};Parser.prototype._parseTRNS=function(data){this._crc.write(data);if(this._colorType===constants.COLORTYPE_PALETTE_COLOR){if(this._palette.length===0){this.error(new Error("Transparency chunk must be after palette"));return}if(data.length>this._palette.length){this.error(new Error("More transparent colors than palette size"));return}for(var i=0;i<data.length;i++){this._palette[i][3]=data[i]}this.palette(this._palette)}if(this._colorType===constants.COLORTYPE_GRAYSCALE){this.transColor([data.readUInt16BE(0)])}if(this._colorType===constants.COLORTYPE_COLOR){this.transColor([data.readUInt16BE(0),data.readUInt16BE(2),data.readUInt16BE(4)])}this._handleChunkEnd()};Parser.prototype._handleGAMA=function(length){this.read(length,this._parseGAMA.bind(this))};Parser.prototype._parseGAMA=function(data){this._crc.write(data);this.gamma(data.readUInt32BE(0)/constants.GAMMA_DIVISION);this._handleChunkEnd()};Parser.prototype._handleIDAT=function(length){this.read(-length,this._parseIDAT.bind(this,length))};Parser.prototype._parseIDAT=function(length,data){this._crc.write(data);if(this._colorType===constants.COLORTYPE_PALETTE_COLOR&&this._palette.length===0){throw new Error("Expected palette not found")}this.inflateData(data);var leftOverLength=length-data.length;if(leftOverLength>0){this._handleIDAT(leftOverLength)}else{this._handleChunkEnd()}};Parser.prototype._handleIEND=function(length){this.read(length,this._parseIEND.bind(this))};Parser.prototype._parseIEND=function(data){this._crc.write(data);this._hasIEND=true;this._handleChunkEnd();if(this.finished){this.finished()}}}).call(this,require("buffer").Buffer)},{"./constants":751,"./crc":752,buffer:19}],766:[function(require,module,exports){"use strict";var parse=require("./parser-sync");var pack=require("./packer-sync");exports.read=function(buffer,options){return parse(buffer,options||{})};exports.write=function(png){return pack(png)}},{"./packer-sync":760,"./parser-sync":764}],767:[function(require,module,exports){(function(process,Buffer){"use strict";var util=require("util");var Stream=require("stream");var Parser=require("./parser-async");var Packer=require("./packer-async");var PNGSync=require("./png-sync");var PNG=exports.PNG=function(options){Stream.call(this);options=options||{};this.width=options.width||0;this.height=options.height||0;this.data=this.width>0&&this.height>0?new Buffer(4*this.width*this.height):null;if(options.fill&&this.data){this.data.fill(0)}this.gamma=0;this.readable=this.writable=true;this._parser=new Parser(options);this._parser.on("error",this.emit.bind(this,"error"));this._parser.on("close",this._handleClose.bind(this));this._parser.on("metadata",this._metadata.bind(this));this._parser.on("gamma",this._gamma.bind(this));this._parser.on("parsed",function(data){this.data=data;this.emit("parsed",data)}.bind(this));this._packer=new Packer(options);this._packer.on("data",this.emit.bind(this,"data"));this._packer.on("end",this.emit.bind(this,"end"));this._parser.on("close",this._handleClose.bind(this));this._packer.on("error",this.emit.bind(this,"error"))};util.inherits(PNG,Stream);PNG.sync=PNGSync;PNG.prototype.pack=function(){if(!this.data||!this.data.length){this.emit("error","No data provided");return this}process.nextTick(function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}.bind(this));return this};PNG.prototype.parse=function(data,callback){if(callback){var onParsed,onError;onParsed=function(parsedData){this.removeListener("error",onError);this.data=parsedData;callback(null,this)}.bind(this);onError=function(err){this.removeListener("parsed",onParsed);callback(err,null)}.bind(this);this.once("parsed",onParsed);this.once("error",onError)}this.end(data);return this};PNG.prototype.write=function(data){this._parser.write(data);return true};PNG.prototype.end=function(data){this._parser.end(data)};PNG.prototype._metadata=function(metadata){this.width=metadata.width;this.height=metadata.height;this.emit("metadata",metadata)};PNG.prototype._gamma=function(gamma){this.gamma=gamma};PNG.prototype._handleClose=function(){if(!this._parser.writable&&!this._packer.readable){this.emit("close")}};PNG.bitblt=function(src,dst,srcX,srcY,width,height,deltaX,deltaY){if(srcX>src.width||srcY>src.height||srcX+width>src.width||srcY+height>src.height){throw new Error("bitblt reading outside image")}if(deltaX>dst.width||deltaY>dst.height||deltaX+width>dst.width||deltaY+height>dst.height){throw new Error("bitblt writing outside image")}for(var y=0;y<height;y++){src.data.copy(dst.data,(deltaY+y)*dst.width+deltaX<<2,(srcY+y)*src.width+srcX<<2,(srcY+y)*src.width+srcX+width<<2)}};PNG.prototype.bitblt=function(dst,srcX,srcY,width,height,deltaX,deltaY){PNG.bitblt(this,dst,srcX,srcY,width,height,deltaX,deltaY);return this};PNG.adjustGamma=function(src){if(src.gamma){for(var y=0;y<src.height;y++){for(var x=0;x<src.width;x++){var idx=src.width*y+x<<2;for(var i=0;i<3;i++){var sample=src.data[idx+i]/255;sample=Math.pow(sample,1/2.2/src.gamma);src.data[idx+i]=Math.round(sample*255)}}}src.gamma=0}};PNG.prototype.adjustGamma=function(){PNG.adjustGamma(this)}}).call(this,require("_process"),require("buffer").Buffer)},{"./packer-async":759,"./parser-async":763,"./png-sync":766,_process:11,buffer:19,stream:969,util:996}],768:[function(require,module,exports){"use strict";var SyncReader=module.exports=function(buffer){this._buffer=buffer;this._reads=[]};SyncReader.prototype.read=function(length,callback){this._reads.push({length:Math.abs(length),allowLess:length<0,func:callback})};SyncReader.prototype.process=function(){while(this._reads.length>0&&this._buffer.length){var read=this._reads[0];if(this._buffer.length&&(this._buffer.length>=read.length||read.allowLess)){this._reads.shift();var buf=this._buffer;this._buffer=buf.slice(read.length);read.func.call(this,buf.slice(0,read.length))}else{break}}if(this._reads.length>0){return new Error("There are some read requests waitng on finished stream")}if(this._buffer.length>0){return new Error("unrecognised content at end of stream")}}},{}],769:[function(require,module,exports){"use strict";module.exports=Point;function Point(x,y){this.x=x;this.y=y}Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(p){return this.clone()._add(p)},sub:function(p){return this.clone()._sub(p)},mult:function(k){return this.clone()._mult(k)},div:function(k){return this.clone()._div(k)},rotate:function(a){return this.clone()._rotate(a)},matMult:function(m){return this.clone()._matMult(m)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(p){return this.x===p.x&&this.y===p.y},dist:function(p){return Math.sqrt(this.distSqr(p))},distSqr:function(p){var dx=p.x-this.x,dy=p.y-this.y;return dx*dx+dy*dy},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith:function(b){return this.angleWithSep(b.x,b.y)},angleWithSep:function(x,y){return Math.atan2(this.x*y-this.y*x,this.x*x+this.y*y)},_matMult:function(m){var x=m[0]*this.x+m[1]*this.y,y=m[2]*this.x+m[3]*this.y;this.x=x;this.y=y;return this},_add:function(p){this.x+=p.x;this.y+=p.y;return this},_sub:function(p){this.x-=p.x;this.y-=p.y;return this},_mult:function(k){this.x*=k;this.y*=k;return this},_div:function(k){this.x/=k;this.y/=k;return this},_unit:function(){this._div(this.mag());return this},_perp:function(){var y=this.y;this.y=this.x;this.x=-y;return this},_rotate:function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),x=cos*this.x-sin*this.y,y=sin*this.x+cos*this.y;this.x=x;this.y=y;return this},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this}};Point.convert=function(a){if(a instanceof Point){return a}if(Array.isArray(a)){return new Point(a[0],a[1])}return a}},{}],770:[function(require,module,exports){(function(process){"use strict";if(!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0){module.exports=nextTick}else{module.exports=process.nextTick}function nextTick(fn,arg1,arg2,arg3){if(typeof fn!=="function"){throw new TypeError('"callback" argument must be a function')}var len=arguments.length;var args,i;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function afterTickOne(){fn.call(null,arg1)});case 3:return process.nextTick(function afterTickTwo(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function afterTickThree(){fn.call(null,arg1,arg2,arg3)});default:args=new Array(len-1);i=0;while(i<args.length){args[i++]=arguments[i]}return process.nextTick(function afterTick(){fn.apply(null,args)})}}}).call(this,require("_process"))},{_process:11}],771:[function(require,module,exports){"use strict";var warning=require("fbjs/lib/warning");var shallowEqual=require("fbjs/lib/shallowEqual");function shouldComponentUpdate(nextProps,nextState){return!shallowEqual(this.props,nextProps)||!shallowEqual(this.state,nextState)}function getComponentName(component){var constructor=component.prototype&&component.prototype.constructor;return component.displayName||constructor&&constructor.displayName||component.name||constructor&&constructor.name||"a component"}function pureRenderDecorator(component){if(component.prototype.shouldComponentUpdate!==undefined){warning(false,"Cannot decorate `%s` with @pureRenderDecorator, "+"because it already implements `shouldComponentUpdate().",getComponentName(component))}component.prototype.shouldComponentUpdate=shouldComponentUpdate;return component}module.exports=pureRenderDecorator},{"fbjs/lib/shallowEqual":412,"fbjs/lib/warning":413}],772:[function(require,module,exports){"use strict";module.exports=partialSort;function partialSort(arr,k,left,right,compare){left=left||0;right=right||arr.length-1;compare=compare||defaultCompare;while(right>left){if(right-left>600){var n=right-left+1;var m=k-left+1;var z=Math.log(n);var s=.5*Math.exp(2*z/3);var sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);var newLeft=Math.max(left,Math.floor(k-m*s/n+sd));var newRight=Math.min(right,Math.floor(k+(n-m)*s/n+sd));partialSort(arr,k,newLeft,newRight,compare)}var t=arr[k];var i=left;var j=right;swap(arr,left,k);if(compare(arr[right],t)>0)swap(arr,left,right);while(i<j){swap(arr,i,j);i++;j--;while(compare(arr[i],t)<0)i++;while(compare(arr[j],t)>0)j--}if(compare(arr[left],t)===0)swap(arr,left,j);else{j++;swap(arr,j,right)}if(j<=k)left=j+1;if(k<=j)right=j-1}}function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j];arr[j]=tmp}function defaultCompare(a,b){return a<b?-1:a>b?1:0}},{}],773:[function(require,module,exports){"use strict";module.exports=require("./lib/ReactDOM")},{"./lib/ReactDOM":803}],774:[function(require,module,exports){"use strict";var ARIADOMPropertyConfig={Properties:{"aria-current":0,"aria-details":0,"aria-disabled":0,"aria-hidden":0,"aria-invalid":0,"aria-keyshortcuts":0,"aria-label":0,"aria-roledescription":0,"aria-autocomplete":0,"aria-checked":0,"aria-expanded":0,"aria-haspopup":0,"aria-level":0,"aria-modal":0,"aria-multiline":0,"aria-multiselectable":0,"aria-orientation":0,"aria-placeholder":0,"aria-pressed":0,"aria-readonly":0,"aria-required":0,"aria-selected":0,"aria-sort":0,"aria-valuemax":0,"aria-valuemin":0,"aria-valuenow":0,"aria-valuetext":0,"aria-atomic":0,"aria-busy":0,"aria-live":0,"aria-relevant":0,"aria-dropeffect":0,"aria-grabbed":0,"aria-activedescendant":0,"aria-colcount":0,"aria-colindex":0,"aria-colspan":0,
"aria-controls":0,"aria-describedby":0,"aria-errormessage":0,"aria-flowto":0,"aria-labelledby":0,"aria-owns":0,"aria-posinset":0,"aria-rowcount":0,"aria-rowindex":0,"aria-rowspan":0,"aria-setsize":0},DOMAttributeNames:{},DOMPropertyNames:{}};module.exports=ARIADOMPropertyConfig},{}],775:[function(require,module,exports){"use strict";var ReactDOMComponentTree=require("./ReactDOMComponentTree");var focusNode=require("fbjs/lib/focusNode");var AutoFocusUtils={focusDOMComponent:function(){focusNode(ReactDOMComponentTree.getNodeFromInstance(this))}};module.exports=AutoFocusUtils},{"./ReactDOMComponentTree":806,"fbjs/lib/focusNode":400}],776:[function(require,module,exports){"use strict";var EventPropagators=require("./EventPropagators");var ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment");var FallbackCompositionState=require("./FallbackCompositionState");var SyntheticCompositionEvent=require("./SyntheticCompositionEvent");var SyntheticInputEvent=require("./SyntheticInputEvent");var END_KEYCODES=[9,13,27,32];var START_KEYCODE=229;var canUseCompositionEvent=ExecutionEnvironment.canUseDOM&&"CompositionEvent"in window;var documentMode=null;if(ExecutionEnvironment.canUseDOM&&"documentMode"in document){documentMode=document.documentMode}var canUseTextInputEvent=ExecutionEnvironment.canUseDOM&&"TextEvent"in window&&!documentMode&&!isPresto();var useFallbackCompositionData=ExecutionEnvironment.canUseDOM&&(!canUseCompositionEvent||documentMode&&documentMode>8&&documentMode<=11);function isPresto(){var opera=window.opera;return typeof opera==="object"&&typeof opera.version==="function"&&parseInt(opera.version(),10)<=12}var SPACEBAR_CODE=32;var SPACEBAR_CHAR=String.fromCharCode(SPACEBAR_CODE);var eventTypes={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["topCompositionEnd","topKeyPress","topTextInput","topPaste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:["topBlur","topCompositionEnd","topKeyDown","topKeyPress","topKeyUp","topMouseDown"]},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:["topBlur","topCompositionStart","topKeyDown","topKeyPress","topKeyUp","topMouseDown"]},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:["topBlur","topCompositionUpdate","topKeyDown","topKeyPress","topKeyUp","topMouseDown"]}};var hasSpaceKeypress=false;function isKeypressCommand(nativeEvent){return(nativeEvent.ctrlKey||nativeEvent.altKey||nativeEvent.metaKey)&&!(nativeEvent.ctrlKey&&nativeEvent.altKey)}function getCompositionEventType(topLevelType){switch(topLevelType){case"topCompositionStart":return eventTypes.compositionStart;case"topCompositionEnd":return eventTypes.compositionEnd;case"topCompositionUpdate":return eventTypes.compositionUpdate}}function isFallbackCompositionStart(topLevelType,nativeEvent){return topLevelType==="topKeyDown"&&nativeEvent.keyCode===START_KEYCODE}function isFallbackCompositionEnd(topLevelType,nativeEvent){switch(topLevelType){case"topKeyUp":return END_KEYCODES.indexOf(nativeEvent.keyCode)!==-1;case"topKeyDown":return nativeEvent.keyCode!==START_KEYCODE;case"topKeyPress":case"topMouseDown":case"topBlur":return true;default:return false}}function getDataFromCustomEvent(nativeEvent){var detail=nativeEvent.detail;if(typeof detail==="object"&&"data"in detail){return detail.data}return null}var currentComposition=null;function extractCompositionEvent(topLevelType,targetInst,nativeEvent,nativeEventTarget){var eventType;var fallbackData;if(canUseCompositionEvent){eventType=getCompositionEventType(topLevelType)}else if(!currentComposition){if(isFallbackCompositionStart(topLevelType,nativeEvent)){eventType=eventTypes.compositionStart}}else if(isFallbackCompositionEnd(topLevelType,nativeEvent)){eventType=eventTypes.compositionEnd}if(!eventType){return null}if(useFallbackCompositionData){if(!currentComposition&&eventType===eventTypes.compositionStart){currentComposition=FallbackCompositionState.getPooled(nativeEventTarget)}else if(eventType===eventTypes.compositionEnd){if(currentComposition){fallbackData=currentComposition.getData()}}}var event=SyntheticCompositionEvent.getPooled(eventType,targetInst,nativeEvent,nativeEventTarget);if(fallbackData){event.data=fallbackData}else{var customData=getDataFromCustomEvent(nativeEvent);if(customData!==null){event.data=customData}}EventPropagators.accumulateTwoPhaseDispatches(event);return event}function getNativeBeforeInputChars(topLevelType,nativeEvent){switch(topLevelType){case"topCompositionEnd":return getDataFromCustomEvent(nativeEvent);case"topKeyPress":var which=nativeEvent.which;if(which!==SPACEBAR_CODE){return null}hasSpaceKeypress=true;return SPACEBAR_CHAR;case"topTextInput":var chars=nativeEvent.data;if(chars===SPACEBAR_CHAR&&hasSpaceKeypress){return null}return chars;default:return null}}function getFallbackBeforeInputChars(topLevelType,nativeEvent){if(currentComposition){if(topLevelType==="topCompositionEnd"||!canUseCompositionEvent&&isFallbackCompositionEnd(topLevelType,nativeEvent)){var chars=currentComposition.getData();FallbackCompositionState.release(currentComposition);currentComposition=null;return chars}return null}switch(topLevelType){case"topPaste":return null;case"topKeyPress":if(nativeEvent.which&&!isKeypressCommand(nativeEvent)){return String.fromCharCode(nativeEvent.which)}return null;case"topCompositionEnd":return useFallbackCompositionData?null:nativeEvent.data;default:return null}}function extractBeforeInputEvent(topLevelType,targetInst,nativeEvent,nativeEventTarget){var chars;if(canUseTextInputEvent){chars=getNativeBeforeInputChars(topLevelType,nativeEvent)}else{chars=getFallbackBeforeInputChars(topLevelType,nativeEvent)}if(!chars){return null}var event=SyntheticInputEvent.getPooled(eventTypes.beforeInput,targetInst,nativeEvent,nativeEventTarget);event.data=chars;EventPropagators.accumulateTwoPhaseDispatches(event);return event}var BeforeInputEventPlugin={eventTypes:eventTypes,extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget){return[extractCompositionEvent(topLevelType,targetInst,nativeEvent,nativeEventTarget),extractBeforeInputEvent(topLevelType,targetInst,nativeEvent,nativeEventTarget)]}};module.exports=BeforeInputEventPlugin},{"./EventPropagators":792,"./FallbackCompositionState":793,"./SyntheticCompositionEvent":857,"./SyntheticInputEvent":861,"fbjs/lib/ExecutionEnvironment":392}],777:[function(require,module,exports){"use strict";var isUnitlessNumber={animationIterationCount:true,borderImageOutset:true,borderImageSlice:true,borderImageWidth:true,boxFlex:true,boxFlexGroup:true,boxOrdinalGroup:true,columnCount:true,flex:true,flexGrow:true,flexPositive:true,flexShrink:true,flexNegative:true,flexOrder:true,gridRow:true,gridColumn:true,fontWeight:true,lineClamp:true,lineHeight:true,opacity:true,order:true,orphans:true,tabSize:true,widows:true,zIndex:true,zoom:true,fillOpacity:true,floodOpacity:true,stopOpacity:true,strokeDasharray:true,strokeDashoffset:true,strokeMiterlimit:true,strokeOpacity:true,strokeWidth:true};function prefixKey(prefix,key){return prefix+key.charAt(0).toUpperCase()+key.substring(1)}var prefixes=["Webkit","ms","Moz","O"];Object.keys(isUnitlessNumber).forEach(function(prop){prefixes.forEach(function(prefix){isUnitlessNumber[prefixKey(prefix,prop)]=isUnitlessNumber[prop]})});var shorthandPropertyExpansions={background:{backgroundAttachment:true,backgroundColor:true,backgroundImage:true,backgroundPositionX:true,backgroundPositionY:true,backgroundRepeat:true},backgroundPosition:{backgroundPositionX:true,backgroundPositionY:true},border:{borderWidth:true,borderStyle:true,borderColor:true},borderBottom:{borderBottomWidth:true,borderBottomStyle:true,borderBottomColor:true},borderLeft:{borderLeftWidth:true,borderLeftStyle:true,borderLeftColor:true},borderRight:{borderRightWidth:true,borderRightStyle:true,borderRightColor:true},borderTop:{borderTopWidth:true,borderTopStyle:true,borderTopColor:true},font:{fontStyle:true,fontVariant:true,fontWeight:true,fontSize:true,lineHeight:true,fontFamily:true},outline:{outlineWidth:true,outlineStyle:true,outlineColor:true}};var CSSProperty={isUnitlessNumber:isUnitlessNumber,shorthandPropertyExpansions:shorthandPropertyExpansions};module.exports=CSSProperty},{}],778:[function(require,module,exports){"use strict";var CSSProperty=require("./CSSProperty");var ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment");var ReactInstrumentation=require("./ReactInstrumentation");var camelizeStyleName=require("fbjs/lib/camelizeStyleName");var dangerousStyleValue=require("./dangerousStyleValue");var hyphenateStyleName=require("fbjs/lib/hyphenateStyleName");var memoizeStringOnly=require("fbjs/lib/memoizeStringOnly");var warning=require("fbjs/lib/warning");var processStyleName=memoizeStringOnly(function(styleName){return hyphenateStyleName(styleName)});var hasShorthandPropertyBug=false;var styleFloatAccessor="cssFloat";if(ExecutionEnvironment.canUseDOM){var tempStyle=document.createElement("div").style;try{tempStyle.font=""}catch(e){hasShorthandPropertyBug=true}if(document.documentElement.style.cssFloat===undefined){styleFloatAccessor="styleFloat"}}if("production"!=="production"){var badVendoredStyleNamePattern=/^(?:webkit|moz|o)[A-Z]/;var badStyleValueWithSemicolonPattern=/;\s*$/;var warnedStyleNames={};var warnedStyleValues={};var warnedForNaNValue=false;var warnHyphenatedStyleName=function(name,owner){if(warnedStyleNames.hasOwnProperty(name)&&warnedStyleNames[name]){return}warnedStyleNames[name]=true;"production"!=="production"?warning(false,"Unsupported style property %s. Did you mean %s?%s",name,camelizeStyleName(name),checkRenderMessage(owner)):void 0};var warnBadVendoredStyleName=function(name,owner){if(warnedStyleNames.hasOwnProperty(name)&&warnedStyleNames[name]){return}warnedStyleNames[name]=true;"production"!=="production"?warning(false,"Unsupported vendor-prefixed style property %s. Did you mean %s?%s",name,name.charAt(0).toUpperCase()+name.slice(1),checkRenderMessage(owner)):void 0};var warnStyleValueWithSemicolon=function(name,value,owner){if(warnedStyleValues.hasOwnProperty(value)&&warnedStyleValues[value]){return}warnedStyleValues[value]=true;"production"!=="production"?warning(false,"Style property values shouldn't contain a semicolon.%s "+'Try "%s: %s" instead.',checkRenderMessage(owner),name,value.replace(badStyleValueWithSemicolonPattern,"")):void 0};var warnStyleValueIsNaN=function(name,value,owner){if(warnedForNaNValue){return}warnedForNaNValue=true;"production"!=="production"?warning(false,"`NaN` is an invalid value for the `%s` css style property.%s",name,checkRenderMessage(owner)):void 0};var checkRenderMessage=function(owner){if(owner){var name=owner.getName();if(name){return" Check the render method of `"+name+"`."}}return""};var warnValidStyle=function(name,value,component){var owner;if(component){owner=component._currentElement._owner}if(name.indexOf("-")>-1){warnHyphenatedStyleName(name,owner)}else if(badVendoredStyleNamePattern.test(name)){warnBadVendoredStyleName(name,owner)}else if(badStyleValueWithSemicolonPattern.test(value)){warnStyleValueWithSemicolon(name,value,owner)}if(typeof value==="number"&&isNaN(value)){warnStyleValueIsNaN(name,value,owner)}}}var CSSPropertyOperations={createMarkupForStyles:function(styles,component){var serialized="";for(var styleName in styles){if(!styles.hasOwnProperty(styleName)){continue}var styleValue=styles[styleName];if("production"!=="production"){warnValidStyle(styleName,styleValue,component)}if(styleValue!=null){serialized+=processStyleName(styleName)+":";serialized+=dangerousStyleValue(styleName,styleValue,component)+";"}}return serialized||null},setValueForStyles:function(node,styles,component){if("production"!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:component._debugID,type:"update styles",payload:styles})}var style=node.style;for(var styleName in styles){if(!styles.hasOwnProperty(styleName)){continue}if("production"!=="production"){warnValidStyle(styleName,styles[styleName],component)}var styleValue=dangerousStyleValue(styleName,styles[styleName],component);if(styleName==="float"||styleName==="cssFloat"){styleName=styleFloatAccessor}if(styleValue){style[styleName]=styleValue}else{var expansion=hasShorthandPropertyBug&&CSSProperty.shorthandPropertyExpansions[styleName];if(expansion){for(var individualStyleName in expansion){style[individualStyleName]=""}}else{style[styleName]=""}}}}};module.exports=CSSPropertyOperations},{"./CSSProperty":777,"./ReactInstrumentation":835,"./dangerousStyleValue":874,"fbjs/lib/ExecutionEnvironment":392,"fbjs/lib/camelizeStyleName":394,"fbjs/lib/hyphenateStyleName":405,"fbjs/lib/memoizeStringOnly":409,"fbjs/lib/warning":413}],779:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var PooledClass=require("./PooledClass");var invariant=require("fbjs/lib/invariant");var CallbackQueue=function(){function CallbackQueue(arg){_classCallCheck(this,CallbackQueue);this._callbacks=null;this._contexts=null;this._arg=arg}CallbackQueue.prototype.enqueue=function enqueue(callback,context){this._callbacks=this._callbacks||[];this._callbacks.push(callback);this._contexts=this._contexts||[];this._contexts.push(context)};CallbackQueue.prototype.notifyAll=function notifyAll(){var callbacks=this._callbacks;var contexts=this._contexts;var arg=this._arg;if(callbacks&&contexts){!(callbacks.length===contexts.length)?"production"!=="production"?invariant(false,"Mismatched list of contexts in callback queue"):_prodInvariant("24"):void 0;this._callbacks=null;this._contexts=null;for(var i=0;i<callbacks.length;i++){callbacks[i].call(contexts[i],arg)}callbacks.length=0;contexts.length=0}};CallbackQueue.prototype.checkpoint=function checkpoint(){return this._callbacks?this._callbacks.length:0};CallbackQueue.prototype.rollback=function rollback(len){if(this._callbacks&&this._contexts){this._callbacks.length=len;this._contexts.length=len}};CallbackQueue.prototype.reset=function reset(){this._callbacks=null;this._contexts=null};CallbackQueue.prototype.destructor=function destructor(){this.reset()};return CallbackQueue}();module.exports=PooledClass.addPoolingTo(CallbackQueue)},{"./PooledClass":797,"./reactProdInvariant":893,"fbjs/lib/invariant":406}],780:[function(require,module,exports){"use strict";var EventPluginHub=require("./EventPluginHub");var EventPropagators=require("./EventPropagators");var ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var ReactUpdates=require("./ReactUpdates");var SyntheticEvent=require("./SyntheticEvent");var getEventTarget=require("./getEventTarget");var isEventSupported=require("./isEventSupported");var isTextInputElement=require("./isTextInputElement");var eventTypes={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:["topBlur","topChange","topClick","topFocus","topInput","topKeyDown","topKeyUp","topSelectionChange"]}};var activeElement=null;var activeElementInst=null;var activeElementValue=null;var activeElementValueProp=null;function shouldUseChangeEvent(elem){var nodeName=elem.nodeName&&elem.nodeName.toLowerCase();return nodeName==="select"||nodeName==="input"&&elem.type==="file"}var doesChangeEventBubble=false;if(ExecutionEnvironment.canUseDOM){doesChangeEventBubble=isEventSupported("change")&&(!document.documentMode||document.documentMode>8)}function manualDispatchChangeEvent(nativeEvent){var event=SyntheticEvent.getPooled(eventTypes.change,activeElementInst,nativeEvent,getEventTarget(nativeEvent));EventPropagators.accumulateTwoPhaseDispatches(event);ReactUpdates.batchedUpdates(runEventInBatch,event)}function runEventInBatch(event){EventPluginHub.enqueueEvents(event);EventPluginHub.processEventQueue(false)}function startWatchingForChangeEventIE8(target,targetInst){activeElement=target;activeElementInst=targetInst;activeElement.attachEvent("onchange",manualDispatchChangeEvent)}function stopWatchingForChangeEventIE8(){if(!activeElement){return}activeElement.detachEvent("onchange",manualDispatchChangeEvent);activeElement=null;activeElementInst=null}function getTargetInstForChangeEvent(topLevelType,targetInst){if(topLevelType==="topChange"){return targetInst}}function handleEventsForChangeEventIE8(topLevelType,target,targetInst){if(topLevelType==="topFocus"){stopWatchingForChangeEventIE8();startWatchingForChangeEventIE8(target,targetInst)}else if(topLevelType==="topBlur"){stopWatchingForChangeEventIE8()}}var isInputEventSupported=false;if(ExecutionEnvironment.canUseDOM){isInputEventSupported=isEventSupported("input")&&(!document.documentMode||document.documentMode>11)}var newValueProp={get:function(){return activeElementValueProp.get.call(this)},set:function(val){activeElementValue=""+val;activeElementValueProp.set.call(this,val)}};function startWatchingForValueChange(target,targetInst){activeElement=target;activeElementInst=targetInst;activeElementValue=target.value;activeElementValueProp=Object.getOwnPropertyDescriptor(target.constructor.prototype,"value");Object.defineProperty(activeElement,"value",newValueProp);if(activeElement.attachEvent){activeElement.attachEvent("onpropertychange",handlePropertyChange)}else{activeElement.addEventListener("propertychange",handlePropertyChange,false)}}function stopWatchingForValueChange(){if(!activeElement){return}delete activeElement.value;if(activeElement.detachEvent){activeElement.detachEvent("onpropertychange",handlePropertyChange)}else{activeElement.removeEventListener("propertychange",handlePropertyChange,false)}activeElement=null;activeElementInst=null;activeElementValue=null;activeElementValueProp=null}function handlePropertyChange(nativeEvent){if(nativeEvent.propertyName!=="value"){return}var value=nativeEvent.srcElement.value;if(value===activeElementValue){return}activeElementValue=value;manualDispatchChangeEvent(nativeEvent)}function getTargetInstForInputEvent(topLevelType,targetInst){if(topLevelType==="topInput"){return targetInst}}function handleEventsForInputEventIE(topLevelType,target,targetInst){if(topLevelType==="topFocus"){stopWatchingForValueChange();startWatchingForValueChange(target,targetInst)}else if(topLevelType==="topBlur"){stopWatchingForValueChange()}}function getTargetInstForInputEventIE(topLevelType,targetInst){if(topLevelType==="topSelectionChange"||topLevelType==="topKeyUp"||topLevelType==="topKeyDown"){if(activeElement&&activeElement.value!==activeElementValue){activeElementValue=activeElement.value;return activeElementInst}}}function shouldUseClickEvent(elem){return elem.nodeName&&elem.nodeName.toLowerCase()==="input"&&(elem.type==="checkbox"||elem.type==="radio")}function getTargetInstForClickEvent(topLevelType,targetInst){if(topLevelType==="topClick"){return targetInst}}var ChangeEventPlugin={eventTypes:eventTypes,extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget){var targetNode=targetInst?ReactDOMComponentTree.getNodeFromInstance(targetInst):window;var getTargetInstFunc,handleEventFunc;if(shouldUseChangeEvent(targetNode)){if(doesChangeEventBubble){getTargetInstFunc=getTargetInstForChangeEvent}else{handleEventFunc=handleEventsForChangeEventIE8}}else if(isTextInputElement(targetNode)){if(isInputEventSupported){getTargetInstFunc=getTargetInstForInputEvent}else{getTargetInstFunc=getTargetInstForInputEventIE;handleEventFunc=handleEventsForInputEventIE}}else if(shouldUseClickEvent(targetNode)){getTargetInstFunc=getTargetInstForClickEvent}if(getTargetInstFunc){var inst=getTargetInstFunc(topLevelType,targetInst);if(inst){var event=SyntheticEvent.getPooled(eventTypes.change,inst,nativeEvent,nativeEventTarget);event.type="change";EventPropagators.accumulateTwoPhaseDispatches(event);return event}}if(handleEventFunc){handleEventFunc(topLevelType,targetNode,targetInst)}}};module.exports=ChangeEventPlugin},{"./EventPluginHub":789,"./EventPropagators":792,"./ReactDOMComponentTree":806,"./ReactUpdates":850,"./SyntheticEvent":859,"./getEventTarget":882,"./isEventSupported":890,"./isTextInputElement":891,"fbjs/lib/ExecutionEnvironment":392}],781:[function(require,module,exports){"use strict";var DOMLazyTree=require("./DOMLazyTree");var Danger=require("./Danger");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var ReactInstrumentation=require("./ReactInstrumentation");var createMicrosoftUnsafeLocalFunction=require("./createMicrosoftUnsafeLocalFunction");var setInnerHTML=require("./setInnerHTML");var setTextContent=require("./setTextContent");function getNodeAfter(parentNode,node){if(Array.isArray(node)){node=node[1]}return node?node.nextSibling:parentNode.firstChild}var insertChildAt=createMicrosoftUnsafeLocalFunction(function(parentNode,childNode,referenceNode){parentNode.insertBefore(childNode,referenceNode)});function insertLazyTreeChildAt(parentNode,childTree,referenceNode){DOMLazyTree.insertTreeBefore(parentNode,childTree,referenceNode)}function moveChild(parentNode,childNode,referenceNode){if(Array.isArray(childNode)){moveDelimitedText(parentNode,childNode[0],childNode[1],referenceNode)}else{insertChildAt(parentNode,childNode,referenceNode)}}function removeChild(parentNode,childNode){if(Array.isArray(childNode)){var closingComment=childNode[1];childNode=childNode[0];removeDelimitedText(parentNode,childNode,closingComment);parentNode.removeChild(closingComment)}parentNode.removeChild(childNode)}function moveDelimitedText(parentNode,openingComment,closingComment,referenceNode){var node=openingComment;while(true){var nextNode=node.nextSibling;insertChildAt(parentNode,node,referenceNode);if(node===closingComment){break}node=nextNode}}function removeDelimitedText(parentNode,startNode,closingComment){while(true){var node=startNode.nextSibling;if(node===closingComment){break}else{parentNode.removeChild(node)}}}function replaceDelimitedText(openingComment,closingComment,stringText){var parentNode=openingComment.parentNode;var nodeAfterComment=openingComment.nextSibling;if(nodeAfterComment===closingComment){if(stringText){insertChildAt(parentNode,document.createTextNode(stringText),nodeAfterComment)}}else{if(stringText){setTextContent(nodeAfterComment,stringText);removeDelimitedText(parentNode,nodeAfterComment,closingComment)}else{removeDelimitedText(parentNode,openingComment,closingComment)}}if("production"!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:ReactDOMComponentTree.getInstanceFromNode(openingComment)._debugID,type:"replace text",payload:stringText})}}var dangerouslyReplaceNodeWithMarkup=Danger.dangerouslyReplaceNodeWithMarkup;if("production"!=="production"){dangerouslyReplaceNodeWithMarkup=function(oldChild,markup,prevInstance){Danger.dangerouslyReplaceNodeWithMarkup(oldChild,markup);if(prevInstance._debugID!==0){ReactInstrumentation.debugTool.onHostOperation({instanceID:prevInstance._debugID,type:"replace with",payload:markup.toString()})}else{var nextInstance=ReactDOMComponentTree.getInstanceFromNode(markup.node);if(nextInstance._debugID!==0){ReactInstrumentation.debugTool.onHostOperation({instanceID:nextInstance._debugID,type:"mount",payload:markup.toString()})}}}}var DOMChildrenOperations={dangerouslyReplaceNodeWithMarkup:dangerouslyReplaceNodeWithMarkup,replaceDelimitedText:replaceDelimitedText,processUpdates:function(parentNode,updates){if("production"!=="production"){var parentNodeDebugID=ReactDOMComponentTree.getInstanceFromNode(parentNode)._debugID}for(var k=0;k<updates.length;k++){var update=updates[k];switch(update.type){case"INSERT_MARKUP":insertLazyTreeChildAt(parentNode,update.content,getNodeAfter(parentNode,update.afterNode));if("production"!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:parentNodeDebugID,type:"insert child",payload:{toIndex:update.toIndex,content:update.content.toString()}})}break;case"MOVE_EXISTING":moveChild(parentNode,update.fromNode,getNodeAfter(parentNode,update.afterNode));if("production"!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:parentNodeDebugID,type:"move child",payload:{fromIndex:update.fromIndex,toIndex:update.toIndex}})}break;case"SET_MARKUP":setInnerHTML(parentNode,update.content);if("production"!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:parentNodeDebugID,type:"replace children",payload:update.content.toString()})}break;case"TEXT_CONTENT":setTextContent(parentNode,update.content);if("production"!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:parentNodeDebugID,type:"replace text",payload:update.content.toString()})}break;case"REMOVE_NODE":removeChild(parentNode,update.fromNode);if("production"!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:parentNodeDebugID,type:"remove child",payload:{fromIndex:update.fromIndex}})}break}}}};module.exports=DOMChildrenOperations},{"./DOMLazyTree":782,"./Danger":786,"./ReactDOMComponentTree":806,"./ReactInstrumentation":835,"./createMicrosoftUnsafeLocalFunction":873,"./setInnerHTML":895,"./setTextContent":896}],782:[function(require,module,exports){"use strict";var DOMNamespaces=require("./DOMNamespaces");var setInnerHTML=require("./setInnerHTML");var createMicrosoftUnsafeLocalFunction=require("./createMicrosoftUnsafeLocalFunction");var setTextContent=require("./setTextContent");var ELEMENT_NODE_TYPE=1;var DOCUMENT_FRAGMENT_NODE_TYPE=11;var enableLazy=typeof document!=="undefined"&&typeof document.documentMode==="number"||typeof navigator!=="undefined"&&typeof navigator.userAgent==="string"&&/\bEdge\/\d/.test(navigator.userAgent);function insertTreeChildren(tree){if(!enableLazy){return}var node=tree.node;var children=tree.children;if(children.length){for(var i=0;i<children.length;i++){insertTreeBefore(node,children[i],null)}}else if(tree.html!=null){setInnerHTML(node,tree.html)}else if(tree.text!=null){setTextContent(node,tree.text)}}var insertTreeBefore=createMicrosoftUnsafeLocalFunction(function(parentNode,tree,referenceNode){if(tree.node.nodeType===DOCUMENT_FRAGMENT_NODE_TYPE||tree.node.nodeType===ELEMENT_NODE_TYPE&&tree.node.nodeName.toLowerCase()==="object"&&(tree.node.namespaceURI==null||tree.node.namespaceURI===DOMNamespaces.html)){insertTreeChildren(tree);parentNode.insertBefore(tree.node,referenceNode)}else{parentNode.insertBefore(tree.node,referenceNode);insertTreeChildren(tree)}});function replaceChildWithTree(oldNode,newTree){oldNode.parentNode.replaceChild(newTree.node,oldNode);insertTreeChildren(newTree)}function queueChild(parentTree,childTree){if(enableLazy){parentTree.children.push(childTree)}else{parentTree.node.appendChild(childTree.node)}}function queueHTML(tree,html){if(enableLazy){tree.html=html}else{setInnerHTML(tree.node,html)}}function queueText(tree,text){if(enableLazy){tree.text=text}else{setTextContent(tree.node,text)}}function toString(){return this.node.nodeName}function DOMLazyTree(node){return{node:node,children:[],html:null,text:null,toString:toString}}DOMLazyTree.insertTreeBefore=insertTreeBefore;DOMLazyTree.replaceChildWithTree=replaceChildWithTree;DOMLazyTree.queueChild=queueChild;DOMLazyTree.queueHTML=queueHTML;DOMLazyTree.queueText=queueText;module.exports=DOMLazyTree},{"./DOMNamespaces":783,"./createMicrosoftUnsafeLocalFunction":873,"./setInnerHTML":895,"./setTextContent":896}],783:[function(require,module,exports){"use strict";var DOMNamespaces={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};module.exports=DOMNamespaces},{}],784:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var invariant=require("fbjs/lib/invariant");function checkMask(value,bitmask){return(value&bitmask)===bitmask}var DOMPropertyInjection={MUST_USE_PROPERTY:1,HAS_BOOLEAN_VALUE:4,HAS_NUMERIC_VALUE:8,HAS_POSITIVE_NUMERIC_VALUE:16|8,HAS_OVERLOADED_BOOLEAN_VALUE:32,injectDOMPropertyConfig:function(domPropertyConfig){var Injection=DOMPropertyInjection;var Properties=domPropertyConfig.Properties||{};var DOMAttributeNamespaces=domPropertyConfig.DOMAttributeNamespaces||{};var DOMAttributeNames=domPropertyConfig.DOMAttributeNames||{};var DOMPropertyNames=domPropertyConfig.DOMPropertyNames||{};var DOMMutationMethods=domPropertyConfig.DOMMutationMethods||{};if(domPropertyConfig.isCustomAttribute){DOMProperty._isCustomAttributeFunctions.push(domPropertyConfig.isCustomAttribute)}for(var propName in Properties){!!DOMProperty.properties.hasOwnProperty(propName)?"production"!=="production"?invariant(false,"injectDOMPropertyConfig(...): You're trying to inject DOM property '%s' which has already been injected. You may be accidentally injecting the same DOM property config twice, or you may be injecting two configs that have conflicting property names.",propName):_prodInvariant("48",propName):void 0;var lowerCased=propName.toLowerCase();var propConfig=Properties[propName];var propertyInfo={attributeName:lowerCased,attributeNamespace:null,propertyName:propName,mutationMethod:null,mustUseProperty:checkMask(propConfig,Injection.MUST_USE_PROPERTY),hasBooleanValue:checkMask(propConfig,Injection.HAS_BOOLEAN_VALUE),hasNumericValue:checkMask(propConfig,Injection.HAS_NUMERIC_VALUE),hasPositiveNumericValue:checkMask(propConfig,Injection.HAS_POSITIVE_NUMERIC_VALUE),hasOverloadedBooleanValue:checkMask(propConfig,Injection.HAS_OVERLOADED_BOOLEAN_VALUE)};!(propertyInfo.hasBooleanValue+propertyInfo.hasNumericValue+propertyInfo.hasOverloadedBooleanValue<=1)?"production"!=="production"?invariant(false,"DOMProperty: Value can be one of boolean, overloaded boolean, or numeric value, but not a combination: %s",propName):_prodInvariant("50",propName):void 0;if("production"!=="production"){DOMProperty.getPossibleStandardName[lowerCased]=propName}if(DOMAttributeNames.hasOwnProperty(propName)){var attributeName=DOMAttributeNames[propName];propertyInfo.attributeName=attributeName;if("production"!=="production"){DOMProperty.getPossibleStandardName[attributeName]=propName}}if(DOMAttributeNamespaces.hasOwnProperty(propName)){propertyInfo.attributeNamespace=DOMAttributeNamespaces[propName]}if(DOMPropertyNames.hasOwnProperty(propName)){propertyInfo.propertyName=DOMPropertyNames[propName]}if(DOMMutationMethods.hasOwnProperty(propName)){propertyInfo.mutationMethod=DOMMutationMethods[propName]}DOMProperty.properties[propName]=propertyInfo}}};var ATTRIBUTE_NAME_START_CHAR=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD";var DOMProperty={ID_ATTRIBUTE_NAME:"data-reactid",ROOT_ATTRIBUTE_NAME:"data-reactroot",ATTRIBUTE_NAME_START_CHAR:ATTRIBUTE_NAME_START_CHAR,ATTRIBUTE_NAME_CHAR:ATTRIBUTE_NAME_START_CHAR+"\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",properties:{},getPossibleStandardName:"production"!=="production"?{autofocus:"autoFocus"}:null,_isCustomAttributeFunctions:[],isCustomAttribute:function(attributeName){for(var i=0;i<DOMProperty._isCustomAttributeFunctions.length;i++){var isCustomAttributeFn=DOMProperty._isCustomAttributeFunctions[i];if(isCustomAttributeFn(attributeName)){return true}}return false},injection:DOMPropertyInjection};module.exports=DOMProperty},{"./reactProdInvariant":893,"fbjs/lib/invariant":406}],785:[function(require,module,exports){"use strict";var DOMProperty=require("./DOMProperty");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var ReactInstrumentation=require("./ReactInstrumentation");var quoteAttributeValueForBrowser=require("./quoteAttributeValueForBrowser");var warning=require("fbjs/lib/warning");var VALID_ATTRIBUTE_NAME_REGEX=new RegExp("^["+DOMProperty.ATTRIBUTE_NAME_START_CHAR+"]["+DOMProperty.ATTRIBUTE_NAME_CHAR+"]*$");
var illegalAttributeNameCache={};var validatedAttributeNameCache={};function isAttributeNameSafe(attributeName){if(validatedAttributeNameCache.hasOwnProperty(attributeName)){return true}if(illegalAttributeNameCache.hasOwnProperty(attributeName)){return false}if(VALID_ATTRIBUTE_NAME_REGEX.test(attributeName)){validatedAttributeNameCache[attributeName]=true;return true}illegalAttributeNameCache[attributeName]=true;"production"!=="production"?warning(false,"Invalid attribute name: `%s`",attributeName):void 0;return false}function shouldIgnoreValue(propertyInfo,value){return value==null||propertyInfo.hasBooleanValue&&!value||propertyInfo.hasNumericValue&&isNaN(value)||propertyInfo.hasPositiveNumericValue&&value<1||propertyInfo.hasOverloadedBooleanValue&&value===false}var DOMPropertyOperations={createMarkupForID:function(id){return DOMProperty.ID_ATTRIBUTE_NAME+"="+quoteAttributeValueForBrowser(id)},setAttributeForID:function(node,id){node.setAttribute(DOMProperty.ID_ATTRIBUTE_NAME,id)},createMarkupForRoot:function(){return DOMProperty.ROOT_ATTRIBUTE_NAME+'=""'},setAttributeForRoot:function(node){node.setAttribute(DOMProperty.ROOT_ATTRIBUTE_NAME,"")},createMarkupForProperty:function(name,value){var propertyInfo=DOMProperty.properties.hasOwnProperty(name)?DOMProperty.properties[name]:null;if(propertyInfo){if(shouldIgnoreValue(propertyInfo,value)){return""}var attributeName=propertyInfo.attributeName;if(propertyInfo.hasBooleanValue||propertyInfo.hasOverloadedBooleanValue&&value===true){return attributeName+'=""'}return attributeName+"="+quoteAttributeValueForBrowser(value)}else if(DOMProperty.isCustomAttribute(name)){if(value==null){return""}return name+"="+quoteAttributeValueForBrowser(value)}return null},createMarkupForCustomAttribute:function(name,value){if(!isAttributeNameSafe(name)||value==null){return""}return name+"="+quoteAttributeValueForBrowser(value)},setValueForProperty:function(node,name,value){var propertyInfo=DOMProperty.properties.hasOwnProperty(name)?DOMProperty.properties[name]:null;if(propertyInfo){var mutationMethod=propertyInfo.mutationMethod;if(mutationMethod){mutationMethod(node,value)}else if(shouldIgnoreValue(propertyInfo,value)){this.deleteValueForProperty(node,name);return}else if(propertyInfo.mustUseProperty){node[propertyInfo.propertyName]=value}else{var attributeName=propertyInfo.attributeName;var namespace=propertyInfo.attributeNamespace;if(namespace){node.setAttributeNS(namespace,attributeName,""+value)}else if(propertyInfo.hasBooleanValue||propertyInfo.hasOverloadedBooleanValue&&value===true){node.setAttribute(attributeName,"")}else{node.setAttribute(attributeName,""+value)}}}else if(DOMProperty.isCustomAttribute(name)){DOMPropertyOperations.setValueForAttribute(node,name,value);return}if("production"!=="production"){var payload={};payload[name]=value;ReactInstrumentation.debugTool.onHostOperation({instanceID:ReactDOMComponentTree.getInstanceFromNode(node)._debugID,type:"update attribute",payload:payload})}},setValueForAttribute:function(node,name,value){if(!isAttributeNameSafe(name)){return}if(value==null){node.removeAttribute(name)}else{node.setAttribute(name,""+value)}if("production"!=="production"){var payload={};payload[name]=value;ReactInstrumentation.debugTool.onHostOperation({instanceID:ReactDOMComponentTree.getInstanceFromNode(node)._debugID,type:"update attribute",payload:payload})}},deleteValueForAttribute:function(node,name){node.removeAttribute(name);if("production"!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:ReactDOMComponentTree.getInstanceFromNode(node)._debugID,type:"remove attribute",payload:name})}},deleteValueForProperty:function(node,name){var propertyInfo=DOMProperty.properties.hasOwnProperty(name)?DOMProperty.properties[name]:null;if(propertyInfo){var mutationMethod=propertyInfo.mutationMethod;if(mutationMethod){mutationMethod(node,undefined)}else if(propertyInfo.mustUseProperty){var propName=propertyInfo.propertyName;if(propertyInfo.hasBooleanValue){node[propName]=false}else{node[propName]=""}}else{node.removeAttribute(propertyInfo.attributeName)}}else if(DOMProperty.isCustomAttribute(name)){node.removeAttribute(name)}if("production"!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:ReactDOMComponentTree.getInstanceFromNode(node)._debugID,type:"remove attribute",payload:name})}}};module.exports=DOMPropertyOperations},{"./DOMProperty":784,"./ReactDOMComponentTree":806,"./ReactInstrumentation":835,"./quoteAttributeValueForBrowser":892,"fbjs/lib/warning":413}],786:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var DOMLazyTree=require("./DOMLazyTree");var ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment");var createNodesFromMarkup=require("fbjs/lib/createNodesFromMarkup");var emptyFunction=require("fbjs/lib/emptyFunction");var invariant=require("fbjs/lib/invariant");var Danger={dangerouslyReplaceNodeWithMarkup:function(oldChild,markup){!ExecutionEnvironment.canUseDOM?"production"!=="production"?invariant(false,"dangerouslyReplaceNodeWithMarkup(...): Cannot render markup in a worker thread. Make sure `window` and `document` are available globally before requiring React when unit testing or use ReactDOMServer.renderToString() for server rendering."):_prodInvariant("56"):void 0;!markup?"production"!=="production"?invariant(false,"dangerouslyReplaceNodeWithMarkup(...): Missing markup."):_prodInvariant("57"):void 0;!(oldChild.nodeName!=="HTML")?"production"!=="production"?invariant(false,"dangerouslyReplaceNodeWithMarkup(...): Cannot replace markup of the <html> node. This is because browser quirks make this unreliable and/or slow. If you want to render to the root you must use server rendering. See ReactDOMServer.renderToString()."):_prodInvariant("58"):void 0;if(typeof markup==="string"){var newChild=createNodesFromMarkup(markup,emptyFunction)[0];oldChild.parentNode.replaceChild(newChild,oldChild)}else{DOMLazyTree.replaceChildWithTree(oldChild,markup)}}};module.exports=Danger},{"./DOMLazyTree":782,"./reactProdInvariant":893,"fbjs/lib/ExecutionEnvironment":392,"fbjs/lib/createNodesFromMarkup":397,"fbjs/lib/emptyFunction":398,"fbjs/lib/invariant":406}],787:[function(require,module,exports){"use strict";var DefaultEventPluginOrder=["ResponderEventPlugin","SimpleEventPlugin","TapEventPlugin","EnterLeaveEventPlugin","ChangeEventPlugin","SelectEventPlugin","BeforeInputEventPlugin"];module.exports=DefaultEventPluginOrder},{}],788:[function(require,module,exports){"use strict";var EventPropagators=require("./EventPropagators");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var SyntheticMouseEvent=require("./SyntheticMouseEvent");var eventTypes={mouseEnter:{registrationName:"onMouseEnter",dependencies:["topMouseOut","topMouseOver"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["topMouseOut","topMouseOver"]}};var EnterLeaveEventPlugin={eventTypes:eventTypes,extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget){if(topLevelType==="topMouseOver"&&(nativeEvent.relatedTarget||nativeEvent.fromElement)){return null}if(topLevelType!=="topMouseOut"&&topLevelType!=="topMouseOver"){return null}var win;if(nativeEventTarget.window===nativeEventTarget){win=nativeEventTarget}else{var doc=nativeEventTarget.ownerDocument;if(doc){win=doc.defaultView||doc.parentWindow}else{win=window}}var from;var to;if(topLevelType==="topMouseOut"){from=targetInst;var related=nativeEvent.relatedTarget||nativeEvent.toElement;to=related?ReactDOMComponentTree.getClosestInstanceFromNode(related):null}else{from=null;to=targetInst}if(from===to){return null}var fromNode=from==null?win:ReactDOMComponentTree.getNodeFromInstance(from);var toNode=to==null?win:ReactDOMComponentTree.getNodeFromInstance(to);var leave=SyntheticMouseEvent.getPooled(eventTypes.mouseLeave,from,nativeEvent,nativeEventTarget);leave.type="mouseleave";leave.target=fromNode;leave.relatedTarget=toNode;var enter=SyntheticMouseEvent.getPooled(eventTypes.mouseEnter,to,nativeEvent,nativeEventTarget);enter.type="mouseenter";enter.target=toNode;enter.relatedTarget=fromNode;EventPropagators.accumulateEnterLeaveDispatches(leave,enter,from,to);return[leave,enter]}};module.exports=EnterLeaveEventPlugin},{"./EventPropagators":792,"./ReactDOMComponentTree":806,"./SyntheticMouseEvent":863}],789:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var EventPluginRegistry=require("./EventPluginRegistry");var EventPluginUtils=require("./EventPluginUtils");var ReactErrorUtils=require("./ReactErrorUtils");var accumulateInto=require("./accumulateInto");var forEachAccumulated=require("./forEachAccumulated");var invariant=require("fbjs/lib/invariant");var listenerBank={};var eventQueue=null;var executeDispatchesAndRelease=function(event,simulated){if(event){EventPluginUtils.executeDispatchesInOrder(event,simulated);if(!event.isPersistent()){event.constructor.release(event)}}};var executeDispatchesAndReleaseSimulated=function(e){return executeDispatchesAndRelease(e,true)};var executeDispatchesAndReleaseTopLevel=function(e){return executeDispatchesAndRelease(e,false)};var getDictionaryKey=function(inst){return"."+inst._rootNodeID};function isInteractive(tag){return tag==="button"||tag==="input"||tag==="select"||tag==="textarea"}function shouldPreventMouseEvent(name,type,props){switch(name){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":return!!(props.disabled&&isInteractive(type));default:return false}}var EventPluginHub={injection:{injectEventPluginOrder:EventPluginRegistry.injectEventPluginOrder,injectEventPluginsByName:EventPluginRegistry.injectEventPluginsByName},putListener:function(inst,registrationName,listener){!(typeof listener==="function")?"production"!=="production"?invariant(false,"Expected %s listener to be a function, instead got type %s",registrationName,typeof listener):_prodInvariant("94",registrationName,typeof listener):void 0;var key=getDictionaryKey(inst);var bankForRegistrationName=listenerBank[registrationName]||(listenerBank[registrationName]={});bankForRegistrationName[key]=listener;var PluginModule=EventPluginRegistry.registrationNameModules[registrationName];if(PluginModule&&PluginModule.didPutListener){PluginModule.didPutListener(inst,registrationName,listener)}},getListener:function(inst,registrationName){var bankForRegistrationName=listenerBank[registrationName];if(shouldPreventMouseEvent(registrationName,inst._currentElement.type,inst._currentElement.props)){return null}var key=getDictionaryKey(inst);return bankForRegistrationName&&bankForRegistrationName[key]},deleteListener:function(inst,registrationName){var PluginModule=EventPluginRegistry.registrationNameModules[registrationName];if(PluginModule&&PluginModule.willDeleteListener){PluginModule.willDeleteListener(inst,registrationName)}var bankForRegistrationName=listenerBank[registrationName];if(bankForRegistrationName){var key=getDictionaryKey(inst);delete bankForRegistrationName[key]}},deleteAllListeners:function(inst){var key=getDictionaryKey(inst);for(var registrationName in listenerBank){if(!listenerBank.hasOwnProperty(registrationName)){continue}if(!listenerBank[registrationName][key]){continue}var PluginModule=EventPluginRegistry.registrationNameModules[registrationName];if(PluginModule&&PluginModule.willDeleteListener){PluginModule.willDeleteListener(inst,registrationName)}delete listenerBank[registrationName][key]}},extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget){var events;var plugins=EventPluginRegistry.plugins;for(var i=0;i<plugins.length;i++){var possiblePlugin=plugins[i];if(possiblePlugin){var extractedEvents=possiblePlugin.extractEvents(topLevelType,targetInst,nativeEvent,nativeEventTarget);if(extractedEvents){events=accumulateInto(events,extractedEvents)}}}return events},enqueueEvents:function(events){if(events){eventQueue=accumulateInto(eventQueue,events)}},processEventQueue:function(simulated){var processingEventQueue=eventQueue;eventQueue=null;if(simulated){forEachAccumulated(processingEventQueue,executeDispatchesAndReleaseSimulated)}else{forEachAccumulated(processingEventQueue,executeDispatchesAndReleaseTopLevel)}!!eventQueue?"production"!=="production"?invariant(false,"processEventQueue(): Additional events were enqueued while processing an event queue. Support for this has not yet been implemented."):_prodInvariant("95"):void 0;ReactErrorUtils.rethrowCaughtError()},__purge:function(){listenerBank={}},__getListenerBank:function(){return listenerBank}};module.exports=EventPluginHub},{"./EventPluginRegistry":790,"./EventPluginUtils":791,"./ReactErrorUtils":826,"./accumulateInto":870,"./forEachAccumulated":878,"./reactProdInvariant":893,"fbjs/lib/invariant":406}],790:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var invariant=require("fbjs/lib/invariant");var eventPluginOrder=null;var namesToPlugins={};function recomputePluginOrdering(){if(!eventPluginOrder){return}for(var pluginName in namesToPlugins){var pluginModule=namesToPlugins[pluginName];var pluginIndex=eventPluginOrder.indexOf(pluginName);!(pluginIndex>-1)?"production"!=="production"?invariant(false,"EventPluginRegistry: Cannot inject event plugins that do not exist in the plugin ordering, `%s`.",pluginName):_prodInvariant("96",pluginName):void 0;if(EventPluginRegistry.plugins[pluginIndex]){continue}!pluginModule.extractEvents?"production"!=="production"?invariant(false,"EventPluginRegistry: Event plugins must implement an `extractEvents` method, but `%s` does not.",pluginName):_prodInvariant("97",pluginName):void 0;EventPluginRegistry.plugins[pluginIndex]=pluginModule;var publishedEvents=pluginModule.eventTypes;for(var eventName in publishedEvents){!publishEventForPlugin(publishedEvents[eventName],pluginModule,eventName)?"production"!=="production"?invariant(false,"EventPluginRegistry: Failed to publish event `%s` for plugin `%s`.",eventName,pluginName):_prodInvariant("98",eventName,pluginName):void 0}}}function publishEventForPlugin(dispatchConfig,pluginModule,eventName){!!EventPluginRegistry.eventNameDispatchConfigs.hasOwnProperty(eventName)?"production"!=="production"?invariant(false,"EventPluginHub: More than one plugin attempted to publish the same event name, `%s`.",eventName):_prodInvariant("99",eventName):void 0;EventPluginRegistry.eventNameDispatchConfigs[eventName]=dispatchConfig;var phasedRegistrationNames=dispatchConfig.phasedRegistrationNames;if(phasedRegistrationNames){for(var phaseName in phasedRegistrationNames){if(phasedRegistrationNames.hasOwnProperty(phaseName)){var phasedRegistrationName=phasedRegistrationNames[phaseName];publishRegistrationName(phasedRegistrationName,pluginModule,eventName)}}return true}else if(dispatchConfig.registrationName){publishRegistrationName(dispatchConfig.registrationName,pluginModule,eventName);return true}return false}function publishRegistrationName(registrationName,pluginModule,eventName){!!EventPluginRegistry.registrationNameModules[registrationName]?"production"!=="production"?invariant(false,"EventPluginHub: More than one plugin attempted to publish the same registration name, `%s`.",registrationName):_prodInvariant("100",registrationName):void 0;EventPluginRegistry.registrationNameModules[registrationName]=pluginModule;EventPluginRegistry.registrationNameDependencies[registrationName]=pluginModule.eventTypes[eventName].dependencies;if("production"!=="production"){var lowerCasedName=registrationName.toLowerCase();EventPluginRegistry.possibleRegistrationNames[lowerCasedName]=registrationName;if(registrationName==="onDoubleClick"){EventPluginRegistry.possibleRegistrationNames.ondblclick=registrationName}}}var EventPluginRegistry={plugins:[],eventNameDispatchConfigs:{},registrationNameModules:{},registrationNameDependencies:{},possibleRegistrationNames:"production"!=="production"?{}:null,injectEventPluginOrder:function(injectedEventPluginOrder){!!eventPluginOrder?"production"!=="production"?invariant(false,"EventPluginRegistry: Cannot inject event plugin ordering more than once. You are likely trying to load more than one copy of React."):_prodInvariant("101"):void 0;eventPluginOrder=Array.prototype.slice.call(injectedEventPluginOrder);recomputePluginOrdering()},injectEventPluginsByName:function(injectedNamesToPlugins){var isOrderingDirty=false;for(var pluginName in injectedNamesToPlugins){if(!injectedNamesToPlugins.hasOwnProperty(pluginName)){continue}var pluginModule=injectedNamesToPlugins[pluginName];if(!namesToPlugins.hasOwnProperty(pluginName)||namesToPlugins[pluginName]!==pluginModule){!!namesToPlugins[pluginName]?"production"!=="production"?invariant(false,"EventPluginRegistry: Cannot inject two different event plugins using the same name, `%s`.",pluginName):_prodInvariant("102",pluginName):void 0;namesToPlugins[pluginName]=pluginModule;isOrderingDirty=true}}if(isOrderingDirty){recomputePluginOrdering()}},getPluginModuleForEvent:function(event){var dispatchConfig=event.dispatchConfig;if(dispatchConfig.registrationName){return EventPluginRegistry.registrationNameModules[dispatchConfig.registrationName]||null}if(dispatchConfig.phasedRegistrationNames!==undefined){var phasedRegistrationNames=dispatchConfig.phasedRegistrationNames;for(var phase in phasedRegistrationNames){if(!phasedRegistrationNames.hasOwnProperty(phase)){continue}var pluginModule=EventPluginRegistry.registrationNameModules[phasedRegistrationNames[phase]];if(pluginModule){return pluginModule}}}return null},_resetEventPlugins:function(){eventPluginOrder=null;for(var pluginName in namesToPlugins){if(namesToPlugins.hasOwnProperty(pluginName)){delete namesToPlugins[pluginName]}}EventPluginRegistry.plugins.length=0;var eventNameDispatchConfigs=EventPluginRegistry.eventNameDispatchConfigs;for(var eventName in eventNameDispatchConfigs){if(eventNameDispatchConfigs.hasOwnProperty(eventName)){delete eventNameDispatchConfigs[eventName]}}var registrationNameModules=EventPluginRegistry.registrationNameModules;for(var registrationName in registrationNameModules){if(registrationNameModules.hasOwnProperty(registrationName)){delete registrationNameModules[registrationName]}}if("production"!=="production"){var possibleRegistrationNames=EventPluginRegistry.possibleRegistrationNames;for(var lowerCasedName in possibleRegistrationNames){if(possibleRegistrationNames.hasOwnProperty(lowerCasedName)){delete possibleRegistrationNames[lowerCasedName]}}}}};module.exports=EventPluginRegistry},{"./reactProdInvariant":893,"fbjs/lib/invariant":406}],791:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var ReactErrorUtils=require("./ReactErrorUtils");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");var ComponentTree;var TreeTraversal;var injection={injectComponentTree:function(Injected){ComponentTree=Injected;if("production"!=="production"){"production"!=="production"?warning(Injected&&Injected.getNodeFromInstance&&Injected.getInstanceFromNode,"EventPluginUtils.injection.injectComponentTree(...): Injected "+"module is missing getNodeFromInstance or getInstanceFromNode."):void 0}},injectTreeTraversal:function(Injected){TreeTraversal=Injected;if("production"!=="production"){"production"!=="production"?warning(Injected&&Injected.isAncestor&&Injected.getLowestCommonAncestor,"EventPluginUtils.injection.injectTreeTraversal(...): Injected "+"module is missing isAncestor or getLowestCommonAncestor."):void 0}}};function isEndish(topLevelType){return topLevelType==="topMouseUp"||topLevelType==="topTouchEnd"||topLevelType==="topTouchCancel"}function isMoveish(topLevelType){return topLevelType==="topMouseMove"||topLevelType==="topTouchMove"}function isStartish(topLevelType){return topLevelType==="topMouseDown"||topLevelType==="topTouchStart"}var validateEventDispatches;if("production"!=="production"){validateEventDispatches=function(event){var dispatchListeners=event._dispatchListeners;var dispatchInstances=event._dispatchInstances;var listenersIsArr=Array.isArray(dispatchListeners);var listenersLen=listenersIsArr?dispatchListeners.length:dispatchListeners?1:0;var instancesIsArr=Array.isArray(dispatchInstances);var instancesLen=instancesIsArr?dispatchInstances.length:dispatchInstances?1:0;"production"!=="production"?warning(instancesIsArr===listenersIsArr&&instancesLen===listenersLen,"EventPluginUtils: Invalid `event`."):void 0}}function executeDispatch(event,simulated,listener,inst){var type=event.type||"unknown-event";event.currentTarget=EventPluginUtils.getNodeFromInstance(inst);if(simulated){ReactErrorUtils.invokeGuardedCallbackWithCatch(type,listener,event)}else{ReactErrorUtils.invokeGuardedCallback(type,listener,event)}event.currentTarget=null}function executeDispatchesInOrder(event,simulated){var dispatchListeners=event._dispatchListeners;var dispatchInstances=event._dispatchInstances;if("production"!=="production"){validateEventDispatches(event)}if(Array.isArray(dispatchListeners)){for(var i=0;i<dispatchListeners.length;i++){if(event.isPropagationStopped()){break}executeDispatch(event,simulated,dispatchListeners[i],dispatchInstances[i])}}else if(dispatchListeners){executeDispatch(event,simulated,dispatchListeners,dispatchInstances)}event._dispatchListeners=null;event._dispatchInstances=null}function executeDispatchesInOrderStopAtTrueImpl(event){var dispatchListeners=event._dispatchListeners;var dispatchInstances=event._dispatchInstances;if("production"!=="production"){validateEventDispatches(event)}if(Array.isArray(dispatchListeners)){for(var i=0;i<dispatchListeners.length;i++){if(event.isPropagationStopped()){break}if(dispatchListeners[i](event,dispatchInstances[i])){return dispatchInstances[i]}}}else if(dispatchListeners){if(dispatchListeners(event,dispatchInstances)){return dispatchInstances}}return null}function executeDispatchesInOrderStopAtTrue(event){var ret=executeDispatchesInOrderStopAtTrueImpl(event);event._dispatchInstances=null;event._dispatchListeners=null;return ret}function executeDirectDispatch(event){if("production"!=="production"){validateEventDispatches(event)}var dispatchListener=event._dispatchListeners;var dispatchInstance=event._dispatchInstances;!!Array.isArray(dispatchListener)?"production"!=="production"?invariant(false,"executeDirectDispatch(...): Invalid `event`."):_prodInvariant("103"):void 0;event.currentTarget=dispatchListener?EventPluginUtils.getNodeFromInstance(dispatchInstance):null;var res=dispatchListener?dispatchListener(event):null;event.currentTarget=null;event._dispatchListeners=null;event._dispatchInstances=null;return res}function hasDispatches(event){return!!event._dispatchListeners}var EventPluginUtils={isEndish:isEndish,isMoveish:isMoveish,isStartish:isStartish,executeDirectDispatch:executeDirectDispatch,executeDispatchesInOrder:executeDispatchesInOrder,executeDispatchesInOrderStopAtTrue:executeDispatchesInOrderStopAtTrue,hasDispatches:hasDispatches,getInstanceFromNode:function(node){return ComponentTree.getInstanceFromNode(node)},getNodeFromInstance:function(node){return ComponentTree.getNodeFromInstance(node)},isAncestor:function(a,b){return TreeTraversal.isAncestor(a,b)},getLowestCommonAncestor:function(a,b){return TreeTraversal.getLowestCommonAncestor(a,b)},getParentInstance:function(inst){return TreeTraversal.getParentInstance(inst)},traverseTwoPhase:function(target,fn,arg){return TreeTraversal.traverseTwoPhase(target,fn,arg)},traverseEnterLeave:function(from,to,fn,argFrom,argTo){return TreeTraversal.traverseEnterLeave(from,to,fn,argFrom,argTo)},injection:injection};module.exports=EventPluginUtils},{"./ReactErrorUtils":826,"./reactProdInvariant":893,"fbjs/lib/invariant":406,"fbjs/lib/warning":413}],792:[function(require,module,exports){"use strict";var EventPluginHub=require("./EventPluginHub");var EventPluginUtils=require("./EventPluginUtils");var accumulateInto=require("./accumulateInto");var forEachAccumulated=require("./forEachAccumulated");var warning=require("fbjs/lib/warning");var getListener=EventPluginHub.getListener;function listenerAtPhase(inst,event,propagationPhase){var registrationName=event.dispatchConfig.phasedRegistrationNames[propagationPhase];return getListener(inst,registrationName)}function accumulateDirectionalDispatches(inst,phase,event){if("production"!=="production"){"production"!=="production"?warning(inst,"Dispatching inst must not be null"):void 0}var listener=listenerAtPhase(inst,event,phase);if(listener){event._dispatchListeners=accumulateInto(event._dispatchListeners,listener);event._dispatchInstances=accumulateInto(event._dispatchInstances,inst)}}function accumulateTwoPhaseDispatchesSingle(event){if(event&&event.dispatchConfig.phasedRegistrationNames){EventPluginUtils.traverseTwoPhase(event._targetInst,accumulateDirectionalDispatches,event)}}function accumulateTwoPhaseDispatchesSingleSkipTarget(event){if(event&&event.dispatchConfig.phasedRegistrationNames){var targetInst=event._targetInst;var parentInst=targetInst?EventPluginUtils.getParentInstance(targetInst):null;EventPluginUtils.traverseTwoPhase(parentInst,accumulateDirectionalDispatches,event)}}function accumulateDispatches(inst,ignoredDirection,event){if(event&&event.dispatchConfig.registrationName){var registrationName=event.dispatchConfig.registrationName;var listener=getListener(inst,registrationName);if(listener){event._dispatchListeners=accumulateInto(event._dispatchListeners,listener);event._dispatchInstances=accumulateInto(event._dispatchInstances,inst)}}}function accumulateDirectDispatchesSingle(event){if(event&&event.dispatchConfig.registrationName){accumulateDispatches(event._targetInst,null,event)}}function accumulateTwoPhaseDispatches(events){forEachAccumulated(events,accumulateTwoPhaseDispatchesSingle)}function accumulateTwoPhaseDispatchesSkipTarget(events){forEachAccumulated(events,accumulateTwoPhaseDispatchesSingleSkipTarget)}function accumulateEnterLeaveDispatches(leave,enter,from,to){EventPluginUtils.traverseEnterLeave(from,to,accumulateDispatches,leave,enter)}function accumulateDirectDispatches(events){forEachAccumulated(events,accumulateDirectDispatchesSingle)}var EventPropagators={accumulateTwoPhaseDispatches:accumulateTwoPhaseDispatches,accumulateTwoPhaseDispatchesSkipTarget:accumulateTwoPhaseDispatchesSkipTarget,accumulateDirectDispatches:accumulateDirectDispatches,accumulateEnterLeaveDispatches:accumulateEnterLeaveDispatches};module.exports=EventPropagators},{"./EventPluginHub":789,"./EventPluginUtils":791,"./accumulateInto":870,"./forEachAccumulated":878,"fbjs/lib/warning":413}],793:[function(require,module,exports){"use strict";var _assign=require("object-assign");var PooledClass=require("./PooledClass");var getTextContentAccessor=require("./getTextContentAccessor");function FallbackCompositionState(root){this._root=root;this._startText=this.getText();this._fallbackText=null}_assign(FallbackCompositionState.prototype,{destructor:function(){this._root=null;this._startText=null;this._fallbackText=null},getText:function(){if("value"in this._root){return this._root.value}return this._root[getTextContentAccessor()]},getData:function(){if(this._fallbackText){return this._fallbackText}var start;var startValue=this._startText;var startLength=startValue.length;var end;var endValue=this.getText();var endLength=endValue.length;for(start=0;start<startLength;start++){if(startValue[start]!==endValue[start]){break}}var minEnd=startLength-start;for(end=1;end<=minEnd;end++){if(startValue[startLength-end]!==endValue[endLength-end]){break}}var sliceTail=end>1?1-end:undefined;this._fallbackText=endValue.slice(start,sliceTail);return this._fallbackText}});PooledClass.addPoolingTo(FallbackCompositionState);module.exports=FallbackCompositionState},{"./PooledClass":797,"./getTextContentAccessor":887,"object-assign":732}],794:[function(require,module,exports){"use strict";var DOMProperty=require("./DOMProperty");var MUST_USE_PROPERTY=DOMProperty.injection.MUST_USE_PROPERTY;var HAS_BOOLEAN_VALUE=DOMProperty.injection.HAS_BOOLEAN_VALUE;var HAS_NUMERIC_VALUE=DOMProperty.injection.HAS_NUMERIC_VALUE;var HAS_POSITIVE_NUMERIC_VALUE=DOMProperty.injection.HAS_POSITIVE_NUMERIC_VALUE;var HAS_OVERLOADED_BOOLEAN_VALUE=DOMProperty.injection.HAS_OVERLOADED_BOOLEAN_VALUE;var HTMLDOMPropertyConfig={isCustomAttribute:RegExp.prototype.test.bind(new RegExp("^(data|aria)-["+DOMProperty.ATTRIBUTE_NAME_CHAR+"]*$")),Properties:{accept:0,acceptCharset:0,accessKey:0,action:0,allowFullScreen:HAS_BOOLEAN_VALUE,allowTransparency:0,alt:0,as:0,async:HAS_BOOLEAN_VALUE,autoComplete:0,autoPlay:HAS_BOOLEAN_VALUE,capture:HAS_BOOLEAN_VALUE,cellPadding:0,cellSpacing:0,charSet:0,challenge:0,checked:MUST_USE_PROPERTY|HAS_BOOLEAN_VALUE,cite:0,classID:0,className:0,cols:HAS_POSITIVE_NUMERIC_VALUE,colSpan:0,content:0,contentEditable:0,contextMenu:0,controls:HAS_BOOLEAN_VALUE,coords:0,crossOrigin:0,data:0,dateTime:0,default:HAS_BOOLEAN_VALUE,defer:HAS_BOOLEAN_VALUE,dir:0,disabled:HAS_BOOLEAN_VALUE,download:HAS_OVERLOADED_BOOLEAN_VALUE,draggable:0,encType:0,form:0,formAction:0,formEncType:0,formMethod:0,formNoValidate:HAS_BOOLEAN_VALUE,formTarget:0,frameBorder:0,headers:0,height:0,hidden:HAS_BOOLEAN_VALUE,high:0,href:0,hrefLang:0,htmlFor:0,httpEquiv:0,icon:0,id:0,inputMode:0,integrity:0,is:0,keyParams:0,keyType:0,kind:0,label:0,lang:0,list:0,loop:HAS_BOOLEAN_VALUE,low:0,manifest:0,marginHeight:0,marginWidth:0,max:0,maxLength:0,media:0,mediaGroup:0,method:0,min:0,minLength:0,multiple:MUST_USE_PROPERTY|HAS_BOOLEAN_VALUE,muted:MUST_USE_PROPERTY|HAS_BOOLEAN_VALUE,name:0,nonce:0,noValidate:HAS_BOOLEAN_VALUE,open:HAS_BOOLEAN_VALUE,optimum:0,pattern:0,placeholder:0,playsInline:HAS_BOOLEAN_VALUE,poster:0,preload:0,profile:0,radioGroup:0,readOnly:HAS_BOOLEAN_VALUE,referrerPolicy:0,rel:0,required:HAS_BOOLEAN_VALUE,reversed:HAS_BOOLEAN_VALUE,role:0,rows:HAS_POSITIVE_NUMERIC_VALUE,rowSpan:HAS_NUMERIC_VALUE,sandbox:0,scope:0,scoped:HAS_BOOLEAN_VALUE,scrolling:0,seamless:HAS_BOOLEAN_VALUE,selected:MUST_USE_PROPERTY|HAS_BOOLEAN_VALUE,shape:0,size:HAS_POSITIVE_NUMERIC_VALUE,sizes:0,span:HAS_POSITIVE_NUMERIC_VALUE,spellCheck:0,src:0,srcDoc:0,srcLang:0,srcSet:0,start:HAS_NUMERIC_VALUE,step:0,style:0,summary:0,tabIndex:0,target:0,title:0,type:0,useMap:0,value:0,width:0,wmode:0,wrap:0,about:0,datatype:0,inlist:0,prefix:0,property:0,resource:0,typeof:0,vocab:0,autoCapitalize:0,autoCorrect:0,autoSave:0,color:0,itemProp:0,itemScope:HAS_BOOLEAN_VALUE,itemType:0,itemID:0,itemRef:0,results:0,security:0,unselectable:0},DOMAttributeNames:{acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv"},DOMPropertyNames:{}};module.exports=HTMLDOMPropertyConfig},{"./DOMProperty":784}],795:[function(require,module,exports){"use strict";function escape(key){var escapeRegex=/[=:]/g;var escaperLookup={"=":"=0",":":"=2"};var escapedString=(""+key).replace(escapeRegex,function(match){return escaperLookup[match]});return"$"+escapedString}function unescape(key){var unescapeRegex=/(=0|=2)/g;var unescaperLookup={"=0":"=","=2":":"};var keySubstring=key[0]==="."&&key[1]==="$"?key.substring(2):key.substring(1);return(""+keySubstring).replace(unescapeRegex,function(match){return unescaperLookup[match]})}var KeyEscapeUtils={escape:escape,unescape:unescape};module.exports=KeyEscapeUtils},{}],796:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var React=require("react/lib/React");var ReactPropTypesSecret=require("./ReactPropTypesSecret");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");var hasReadOnlyValue={button:true,checkbox:true,image:true,hidden:true,radio:true,reset:true,submit:true};function _assertSingleLink(inputProps){!(inputProps.checkedLink==null||inputProps.valueLink==null)?"production"!=="production"?invariant(false,"Cannot provide a checkedLink and a valueLink. If you want to use checkedLink, you probably don't want to use valueLink and vice versa."):_prodInvariant("87"):void 0;
}function _assertValueLink(inputProps){_assertSingleLink(inputProps);!(inputProps.value==null&&inputProps.onChange==null)?"production"!=="production"?invariant(false,"Cannot provide a valueLink and a value or onChange event. If you want to use value or onChange, you probably don't want to use valueLink."):_prodInvariant("88"):void 0}function _assertCheckedLink(inputProps){_assertSingleLink(inputProps);!(inputProps.checked==null&&inputProps.onChange==null)?"production"!=="production"?invariant(false,"Cannot provide a checkedLink and a checked property or onChange event. If you want to use checked or onChange, you probably don't want to use checkedLink"):_prodInvariant("89"):void 0}var propTypes={value:function(props,propName,componentName){if(!props[propName]||hasReadOnlyValue[props.type]||props.onChange||props.readOnly||props.disabled){return null}return new Error("You provided a `value` prop to a form field without an "+"`onChange` handler. This will render a read-only field. If "+"the field should be mutable use `defaultValue`. Otherwise, "+"set either `onChange` or `readOnly`.")},checked:function(props,propName,componentName){if(!props[propName]||props.onChange||props.readOnly||props.disabled){return null}return new Error("You provided a `checked` prop to a form field without an "+"`onChange` handler. This will render a read-only field. If "+"the field should be mutable use `defaultChecked`. Otherwise, "+"set either `onChange` or `readOnly`.")},onChange:React.PropTypes.func};var loggedTypeFailures={};function getDeclarationErrorAddendum(owner){if(owner){var name=owner.getName();if(name){return" Check the render method of `"+name+"`."}}return""}var LinkedValueUtils={checkPropTypes:function(tagName,props,owner){for(var propName in propTypes){if(propTypes.hasOwnProperty(propName)){var error=propTypes[propName](props,propName,tagName,"prop",null,ReactPropTypesSecret)}if(error instanceof Error&&!(error.message in loggedTypeFailures)){loggedTypeFailures[error.message]=true;var addendum=getDeclarationErrorAddendum(owner);"production"!=="production"?warning(false,"Failed form propType: %s%s",error.message,addendum):void 0}}},getValue:function(inputProps){if(inputProps.valueLink){_assertValueLink(inputProps);return inputProps.valueLink.value}return inputProps.value},getChecked:function(inputProps){if(inputProps.checkedLink){_assertCheckedLink(inputProps);return inputProps.checkedLink.value}return inputProps.checked},executeOnChange:function(inputProps,event){if(inputProps.valueLink){_assertValueLink(inputProps);return inputProps.valueLink.requestChange(event.target.value)}else if(inputProps.checkedLink){_assertCheckedLink(inputProps);return inputProps.checkedLink.requestChange(event.target.checked)}else if(inputProps.onChange){return inputProps.onChange.call(undefined,event)}}};module.exports=LinkedValueUtils},{"./ReactPropTypesSecret":843,"./reactProdInvariant":893,"fbjs/lib/invariant":406,"fbjs/lib/warning":413,"react/lib/React":926}],797:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var invariant=require("fbjs/lib/invariant");var oneArgumentPooler=function(copyFieldsFrom){var Klass=this;if(Klass.instancePool.length){var instance=Klass.instancePool.pop();Klass.call(instance,copyFieldsFrom);return instance}else{return new Klass(copyFieldsFrom)}};var twoArgumentPooler=function(a1,a2){var Klass=this;if(Klass.instancePool.length){var instance=Klass.instancePool.pop();Klass.call(instance,a1,a2);return instance}else{return new Klass(a1,a2)}};var threeArgumentPooler=function(a1,a2,a3){var Klass=this;if(Klass.instancePool.length){var instance=Klass.instancePool.pop();Klass.call(instance,a1,a2,a3);return instance}else{return new Klass(a1,a2,a3)}};var fourArgumentPooler=function(a1,a2,a3,a4){var Klass=this;if(Klass.instancePool.length){var instance=Klass.instancePool.pop();Klass.call(instance,a1,a2,a3,a4);return instance}else{return new Klass(a1,a2,a3,a4)}};var standardReleaser=function(instance){var Klass=this;!(instance instanceof Klass)?"production"!=="production"?invariant(false,"Trying to release an instance into a pool of a different type."):_prodInvariant("25"):void 0;instance.destructor();if(Klass.instancePool.length<Klass.poolSize){Klass.instancePool.push(instance)}};var DEFAULT_POOL_SIZE=10;var DEFAULT_POOLER=oneArgumentPooler;var addPoolingTo=function(CopyConstructor,pooler){var NewKlass=CopyConstructor;NewKlass.instancePool=[];NewKlass.getPooled=pooler||DEFAULT_POOLER;if(!NewKlass.poolSize){NewKlass.poolSize=DEFAULT_POOL_SIZE}NewKlass.release=standardReleaser;return NewKlass};var PooledClass={addPoolingTo:addPoolingTo,oneArgumentPooler:oneArgumentPooler,twoArgumentPooler:twoArgumentPooler,threeArgumentPooler:threeArgumentPooler,fourArgumentPooler:fourArgumentPooler};module.exports=PooledClass},{"./reactProdInvariant":893,"fbjs/lib/invariant":406}],798:[function(require,module,exports){"use strict";var _assign=require("object-assign");var EventPluginRegistry=require("./EventPluginRegistry");var ReactEventEmitterMixin=require("./ReactEventEmitterMixin");var ViewportMetrics=require("./ViewportMetrics");var getVendorPrefixedEventName=require("./getVendorPrefixedEventName");var isEventSupported=require("./isEventSupported");var hasEventPageXY;var alreadyListeningTo={};var isMonitoringScrollValue=false;var reactTopListenersCounter=0;var topEventMapping={topAbort:"abort",topAnimationEnd:getVendorPrefixedEventName("animationend")||"animationend",topAnimationIteration:getVendorPrefixedEventName("animationiteration")||"animationiteration",topAnimationStart:getVendorPrefixedEventName("animationstart")||"animationstart",topBlur:"blur",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topChange:"change",topClick:"click",topCompositionEnd:"compositionend",topCompositionStart:"compositionstart",topCompositionUpdate:"compositionupdate",topContextMenu:"contextmenu",topCopy:"copy",topCut:"cut",topDoubleClick:"dblclick",topDrag:"drag",topDragEnd:"dragend",topDragEnter:"dragenter",topDragExit:"dragexit",topDragLeave:"dragleave",topDragOver:"dragover",topDragStart:"dragstart",topDrop:"drop",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topFocus:"focus",topInput:"input",topKeyDown:"keydown",topKeyPress:"keypress",topKeyUp:"keyup",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topMouseDown:"mousedown",topMouseMove:"mousemove",topMouseOut:"mouseout",topMouseOver:"mouseover",topMouseUp:"mouseup",topPaste:"paste",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topScroll:"scroll",topSeeked:"seeked",topSeeking:"seeking",topSelectionChange:"selectionchange",topStalled:"stalled",topSuspend:"suspend",topTextInput:"textInput",topTimeUpdate:"timeupdate",topTouchCancel:"touchcancel",topTouchEnd:"touchend",topTouchMove:"touchmove",topTouchStart:"touchstart",topTransitionEnd:getVendorPrefixedEventName("transitionend")||"transitionend",topVolumeChange:"volumechange",topWaiting:"waiting",topWheel:"wheel"};var topListenersIDKey="_reactListenersID"+String(Math.random()).slice(2);function getListeningForDocument(mountAt){if(!Object.prototype.hasOwnProperty.call(mountAt,topListenersIDKey)){mountAt[topListenersIDKey]=reactTopListenersCounter++;alreadyListeningTo[mountAt[topListenersIDKey]]={}}return alreadyListeningTo[mountAt[topListenersIDKey]]}var ReactBrowserEventEmitter=_assign({},ReactEventEmitterMixin,{ReactEventListener:null,injection:{injectReactEventListener:function(ReactEventListener){ReactEventListener.setHandleTopLevel(ReactBrowserEventEmitter.handleTopLevel);ReactBrowserEventEmitter.ReactEventListener=ReactEventListener}},setEnabled:function(enabled){if(ReactBrowserEventEmitter.ReactEventListener){ReactBrowserEventEmitter.ReactEventListener.setEnabled(enabled)}},isEnabled:function(){return!!(ReactBrowserEventEmitter.ReactEventListener&&ReactBrowserEventEmitter.ReactEventListener.isEnabled())},listenTo:function(registrationName,contentDocumentHandle){var mountAt=contentDocumentHandle;var isListening=getListeningForDocument(mountAt);var dependencies=EventPluginRegistry.registrationNameDependencies[registrationName];for(var i=0;i<dependencies.length;i++){var dependency=dependencies[i];if(!(isListening.hasOwnProperty(dependency)&&isListening[dependency])){if(dependency==="topWheel"){if(isEventSupported("wheel")){ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent("topWheel","wheel",mountAt)}else if(isEventSupported("mousewheel")){ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent("topWheel","mousewheel",mountAt)}else{ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent("topWheel","DOMMouseScroll",mountAt)}}else if(dependency==="topScroll"){if(isEventSupported("scroll",true)){ReactBrowserEventEmitter.ReactEventListener.trapCapturedEvent("topScroll","scroll",mountAt)}else{ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent("topScroll","scroll",ReactBrowserEventEmitter.ReactEventListener.WINDOW_HANDLE)}}else if(dependency==="topFocus"||dependency==="topBlur"){if(isEventSupported("focus",true)){ReactBrowserEventEmitter.ReactEventListener.trapCapturedEvent("topFocus","focus",mountAt);ReactBrowserEventEmitter.ReactEventListener.trapCapturedEvent("topBlur","blur",mountAt)}else if(isEventSupported("focusin")){ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent("topFocus","focusin",mountAt);ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent("topBlur","focusout",mountAt)}isListening.topBlur=true;isListening.topFocus=true}else if(topEventMapping.hasOwnProperty(dependency)){ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent(dependency,topEventMapping[dependency],mountAt)}isListening[dependency]=true}}},trapBubbledEvent:function(topLevelType,handlerBaseName,handle){return ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent(topLevelType,handlerBaseName,handle)},trapCapturedEvent:function(topLevelType,handlerBaseName,handle){return ReactBrowserEventEmitter.ReactEventListener.trapCapturedEvent(topLevelType,handlerBaseName,handle)},supportsEventPageXY:function(){if(!document.createEvent){return false}var ev=document.createEvent("MouseEvent");return ev!=null&&"pageX"in ev},ensureScrollValueMonitoring:function(){if(hasEventPageXY===undefined){hasEventPageXY=ReactBrowserEventEmitter.supportsEventPageXY()}if(!hasEventPageXY&&!isMonitoringScrollValue){var refresh=ViewportMetrics.refreshScrollValues;ReactBrowserEventEmitter.ReactEventListener.monitorScrollValue(refresh);isMonitoringScrollValue=true}}});module.exports=ReactBrowserEventEmitter},{"./EventPluginRegistry":790,"./ReactEventEmitterMixin":827,"./ViewportMetrics":869,"./getVendorPrefixedEventName":888,"./isEventSupported":890,"object-assign":732}],799:[function(require,module,exports){(function(process){"use strict";var ReactReconciler=require("./ReactReconciler");var instantiateReactComponent=require("./instantiateReactComponent");var KeyEscapeUtils=require("./KeyEscapeUtils");var shouldUpdateReactComponent=require("./shouldUpdateReactComponent");var traverseAllChildren=require("./traverseAllChildren");var warning=require("fbjs/lib/warning");var ReactComponentTreeHook;if(typeof process!=="undefined"&&process.env&&"production"==="test"){ReactComponentTreeHook=require("react/lib/ReactComponentTreeHook")}function instantiateChild(childInstances,child,name,selfDebugID){var keyUnique=childInstances[name]===undefined;if("production"!=="production"){if(!ReactComponentTreeHook){ReactComponentTreeHook=require("react/lib/ReactComponentTreeHook")}if(!keyUnique){"production"!=="production"?warning(false,"flattenChildren(...): Encountered two children with the same key, "+"`%s`. Child keys must be unique; when two children share a key, only "+"the first child will be used.%s",KeyEscapeUtils.unescape(name),ReactComponentTreeHook.getStackAddendumByID(selfDebugID)):void 0}}if(child!=null&&keyUnique){childInstances[name]=instantiateReactComponent(child,true)}}var ReactChildReconciler={instantiateChildren:function(nestedChildNodes,transaction,context,selfDebugID){if(nestedChildNodes==null){return null}var childInstances={};if("production"!=="production"){traverseAllChildren(nestedChildNodes,function(childInsts,child,name){return instantiateChild(childInsts,child,name,selfDebugID)},childInstances)}else{traverseAllChildren(nestedChildNodes,instantiateChild,childInstances)}return childInstances},updateChildren:function(prevChildren,nextChildren,mountImages,removedNodes,transaction,hostParent,hostContainerInfo,context,selfDebugID){if(!nextChildren&&!prevChildren){return}var name;var prevChild;for(name in nextChildren){if(!nextChildren.hasOwnProperty(name)){continue}prevChild=prevChildren&&prevChildren[name];var prevElement=prevChild&&prevChild._currentElement;var nextElement=nextChildren[name];if(prevChild!=null&&shouldUpdateReactComponent(prevElement,nextElement)){ReactReconciler.receiveComponent(prevChild,nextElement,transaction,context);nextChildren[name]=prevChild}else{if(prevChild){removedNodes[name]=ReactReconciler.getHostNode(prevChild);ReactReconciler.unmountComponent(prevChild,false)}var nextChildInstance=instantiateReactComponent(nextElement,true);nextChildren[name]=nextChildInstance;var nextChildMountImage=ReactReconciler.mountComponent(nextChildInstance,transaction,hostParent,hostContainerInfo,context,selfDebugID);mountImages.push(nextChildMountImage)}}for(name in prevChildren){if(prevChildren.hasOwnProperty(name)&&!(nextChildren&&nextChildren.hasOwnProperty(name))){prevChild=prevChildren[name];removedNodes[name]=ReactReconciler.getHostNode(prevChild);ReactReconciler.unmountComponent(prevChild,false)}}},unmountChildren:function(renderedChildren,safely){for(var name in renderedChildren){if(renderedChildren.hasOwnProperty(name)){var renderedChild=renderedChildren[name];ReactReconciler.unmountComponent(renderedChild,safely)}}}};module.exports=ReactChildReconciler}).call(this,require("_process"))},{"./KeyEscapeUtils":795,"./ReactReconciler":845,"./instantiateReactComponent":889,"./shouldUpdateReactComponent":897,"./traverseAllChildren":898,_process:11,"fbjs/lib/warning":413,"react/lib/ReactComponentTreeHook":930}],800:[function(require,module,exports){"use strict";var DOMChildrenOperations=require("./DOMChildrenOperations");var ReactDOMIDOperations=require("./ReactDOMIDOperations");var ReactComponentBrowserEnvironment={processChildrenUpdates:ReactDOMIDOperations.dangerouslyProcessChildrenUpdates,replaceNodeWithMarkup:DOMChildrenOperations.dangerouslyReplaceNodeWithMarkup};module.exports=ReactComponentBrowserEnvironment},{"./DOMChildrenOperations":781,"./ReactDOMIDOperations":810}],801:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var invariant=require("fbjs/lib/invariant");var injected=false;var ReactComponentEnvironment={replaceNodeWithMarkup:null,processChildrenUpdates:null,injection:{injectEnvironment:function(environment){!!injected?"production"!=="production"?invariant(false,"ReactCompositeComponent: injectEnvironment() can only be called once."):_prodInvariant("104"):void 0;ReactComponentEnvironment.replaceNodeWithMarkup=environment.replaceNodeWithMarkup;ReactComponentEnvironment.processChildrenUpdates=environment.processChildrenUpdates;injected=true}}};module.exports=ReactComponentEnvironment},{"./reactProdInvariant":893,"fbjs/lib/invariant":406}],802:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant"),_assign=require("object-assign");var React=require("react/lib/React");var ReactComponentEnvironment=require("./ReactComponentEnvironment");var ReactCurrentOwner=require("react/lib/ReactCurrentOwner");var ReactErrorUtils=require("./ReactErrorUtils");var ReactInstanceMap=require("./ReactInstanceMap");var ReactInstrumentation=require("./ReactInstrumentation");var ReactNodeTypes=require("./ReactNodeTypes");var ReactReconciler=require("./ReactReconciler");if("production"!=="production"){var checkReactTypeSpec=require("./checkReactTypeSpec")}var emptyObject=require("fbjs/lib/emptyObject");var invariant=require("fbjs/lib/invariant");var shallowEqual=require("fbjs/lib/shallowEqual");var shouldUpdateReactComponent=require("./shouldUpdateReactComponent");var warning=require("fbjs/lib/warning");var CompositeTypes={ImpureClass:0,PureClass:1,StatelessFunctional:2};function StatelessComponent(Component){}StatelessComponent.prototype.render=function(){var Component=ReactInstanceMap.get(this)._currentElement.type;var element=Component(this.props,this.context,this.updater);warnIfInvalidElement(Component,element);return element};function warnIfInvalidElement(Component,element){if("production"!=="production"){"production"!=="production"?warning(element===null||element===false||React.isValidElement(element),"%s(...): A valid React element (or null) must be returned. You may have "+"returned undefined, an array or some other invalid object.",Component.displayName||Component.name||"Component"):void 0;"production"!=="production"?warning(!Component.childContextTypes,"%s(...): childContextTypes cannot be defined on a functional component.",Component.displayName||Component.name||"Component"):void 0}}function shouldConstruct(Component){return!!(Component.prototype&&Component.prototype.isReactComponent)}function isPureComponent(Component){return!!(Component.prototype&&Component.prototype.isPureReactComponent)}function measureLifeCyclePerf(fn,debugID,timerType){if(debugID===0){return fn()}ReactInstrumentation.debugTool.onBeginLifeCycleTimer(debugID,timerType);try{return fn()}finally{ReactInstrumentation.debugTool.onEndLifeCycleTimer(debugID,timerType)}}var nextMountID=1;var ReactCompositeComponent={construct:function(element){this._currentElement=element;this._rootNodeID=0;this._compositeType=null;this._instance=null;this._hostParent=null;this._hostContainerInfo=null;this._updateBatchNumber=null;this._pendingElement=null;this._pendingStateQueue=null;this._pendingReplaceState=false;this._pendingForceUpdate=false;this._renderedNodeType=null;this._renderedComponent=null;this._context=null;this._mountOrder=0;this._topLevelWrapper=null;this._pendingCallbacks=null;this._calledComponentWillUnmount=false;if("production"!=="production"){this._warnedAboutRefsInRender=false}},mountComponent:function(transaction,hostParent,hostContainerInfo,context){var _this=this;this._context=context;this._mountOrder=nextMountID++;this._hostParent=hostParent;this._hostContainerInfo=hostContainerInfo;var publicProps=this._currentElement.props;var publicContext=this._processContext(context);var Component=this._currentElement.type;var updateQueue=transaction.getUpdateQueue();var doConstruct=shouldConstruct(Component);var inst=this._constructComponent(doConstruct,publicProps,publicContext,updateQueue);var renderedElement;if(!doConstruct&&(inst==null||inst.render==null)){renderedElement=inst;warnIfInvalidElement(Component,renderedElement);!(inst===null||inst===false||React.isValidElement(inst))?"production"!=="production"?invariant(false,"%s(...): A valid React element (or null) must be returned. You may have returned undefined, an array or some other invalid object.",Component.displayName||Component.name||"Component"):_prodInvariant("105",Component.displayName||Component.name||"Component"):void 0;inst=new StatelessComponent(Component);this._compositeType=CompositeTypes.StatelessFunctional}else{if(isPureComponent(Component)){this._compositeType=CompositeTypes.PureClass}else{this._compositeType=CompositeTypes.ImpureClass}}if("production"!=="production"){if(inst.render==null){"production"!=="production"?warning(false,"%s(...): No `render` method found on the returned component "+"instance: you may have forgotten to define `render`.",Component.displayName||Component.name||"Component"):void 0}var propsMutated=inst.props!==publicProps;var componentName=Component.displayName||Component.name||"Component";"production"!=="production"?warning(inst.props===undefined||!propsMutated,"%s(...): When calling super() in `%s`, make sure to pass "+"up the same props that your component's constructor was passed.",componentName,componentName):void 0}inst.props=publicProps;inst.context=publicContext;inst.refs=emptyObject;inst.updater=updateQueue;this._instance=inst;ReactInstanceMap.set(inst,this);if("production"!=="production"){"production"!=="production"?warning(!inst.getInitialState||inst.getInitialState.isReactClassApproved||inst.state,"getInitialState was defined on %s, a plain JavaScript class. "+"This is only supported for classes created using React.createClass. "+"Did you mean to define a state property instead?",this.getName()||"a component"):void 0;"production"!=="production"?warning(!inst.getDefaultProps||inst.getDefaultProps.isReactClassApproved,"getDefaultProps was defined on %s, a plain JavaScript class. "+"This is only supported for classes created using React.createClass. "+"Use a static property to define defaultProps instead.",this.getName()||"a component"):void 0;"production"!=="production"?warning(!inst.propTypes,"propTypes was defined as an instance property on %s. Use a static "+"property to define propTypes instead.",this.getName()||"a component"):void 0;"production"!=="production"?warning(!inst.contextTypes,"contextTypes was defined as an instance property on %s. Use a "+"static property to define contextTypes instead.",this.getName()||"a component"):void 0;"production"!=="production"?warning(typeof inst.componentShouldUpdate!=="function","%s has a method called "+"componentShouldUpdate(). Did you mean shouldComponentUpdate()? "+"The name is phrased as a question because the function is "+"expected to return a value.",this.getName()||"A component"):void 0;"production"!=="production"?warning(typeof inst.componentDidUnmount!=="function","%s has a method called "+"componentDidUnmount(). But there is no such lifecycle method. "+"Did you mean componentWillUnmount()?",this.getName()||"A component"):void 0;"production"!=="production"?warning(typeof inst.componentWillRecieveProps!=="function","%s has a method called "+"componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",this.getName()||"A component"):void 0}var initialState=inst.state;if(initialState===undefined){inst.state=initialState=null}!(typeof initialState==="object"&&!Array.isArray(initialState))?"production"!=="production"?invariant(false,"%s.state: must be set to an object or null",this.getName()||"ReactCompositeComponent"):_prodInvariant("106",this.getName()||"ReactCompositeComponent"):void 0;this._pendingStateQueue=null;this._pendingReplaceState=false;this._pendingForceUpdate=false;var markup;if(inst.unstable_handleError){markup=this.performInitialMountWithErrorHandling(renderedElement,hostParent,hostContainerInfo,transaction,context)}else{markup=this.performInitialMount(renderedElement,hostParent,hostContainerInfo,transaction,context)}if(inst.componentDidMount){if("production"!=="production"){transaction.getReactMountReady().enqueue(function(){measureLifeCyclePerf(function(){return inst.componentDidMount()},_this._debugID,"componentDidMount")})}else{transaction.getReactMountReady().enqueue(inst.componentDidMount,inst)}}return markup},_constructComponent:function(doConstruct,publicProps,publicContext,updateQueue){if("production"!=="production"){ReactCurrentOwner.current=this;try{return this._constructComponentWithoutOwner(doConstruct,publicProps,publicContext,updateQueue)}finally{ReactCurrentOwner.current=null}}else{return this._constructComponentWithoutOwner(doConstruct,publicProps,publicContext,updateQueue)}},_constructComponentWithoutOwner:function(doConstruct,publicProps,publicContext,updateQueue){var Component=this._currentElement.type;if(doConstruct){if("production"!=="production"){return measureLifeCyclePerf(function(){return new Component(publicProps,publicContext,updateQueue)},this._debugID,"ctor")}else{return new Component(publicProps,publicContext,updateQueue)}}if("production"!=="production"){return measureLifeCyclePerf(function(){return Component(publicProps,publicContext,updateQueue)},this._debugID,"render")}else{return Component(publicProps,publicContext,updateQueue)}},performInitialMountWithErrorHandling:function(renderedElement,hostParent,hostContainerInfo,transaction,context){var markup;var checkpoint=transaction.checkpoint();try{markup=this.performInitialMount(renderedElement,hostParent,hostContainerInfo,transaction,context)}catch(e){transaction.rollback(checkpoint);this._instance.unstable_handleError(e);if(this._pendingStateQueue){this._instance.state=this._processPendingState(this._instance.props,this._instance.context)}checkpoint=transaction.checkpoint();this._renderedComponent.unmountComponent(true);transaction.rollback(checkpoint);markup=this.performInitialMount(renderedElement,hostParent,hostContainerInfo,transaction,context)}return markup},performInitialMount:function(renderedElement,hostParent,hostContainerInfo,transaction,context){var inst=this._instance;var debugID=0;if("production"!=="production"){debugID=this._debugID}if(inst.componentWillMount){if("production"!=="production"){measureLifeCyclePerf(function(){return inst.componentWillMount()},debugID,"componentWillMount")}else{inst.componentWillMount()}if(this._pendingStateQueue){inst.state=this._processPendingState(inst.props,inst.context)}}if(renderedElement===undefined){renderedElement=this._renderValidatedComponent()}var nodeType=ReactNodeTypes.getType(renderedElement);this._renderedNodeType=nodeType;var child=this._instantiateReactComponent(renderedElement,nodeType!==ReactNodeTypes.EMPTY);this._renderedComponent=child;var markup=ReactReconciler.mountComponent(child,transaction,hostParent,hostContainerInfo,this._processChildContext(context),debugID);if("production"!=="production"){if(debugID!==0){var childDebugIDs=child._debugID!==0?[child._debugID]:[];ReactInstrumentation.debugTool.onSetChildren(debugID,childDebugIDs)}}return markup},getHostNode:function(){return ReactReconciler.getHostNode(this._renderedComponent)},unmountComponent:function(safely){if(!this._renderedComponent){return}var inst=this._instance;if(inst.componentWillUnmount&&!inst._calledComponentWillUnmount){inst._calledComponentWillUnmount=true;if(safely){var name=this.getName()+".componentWillUnmount()";ReactErrorUtils.invokeGuardedCallback(name,inst.componentWillUnmount.bind(inst))}else{if("production"!=="production"){measureLifeCyclePerf(function(){return inst.componentWillUnmount()},this._debugID,"componentWillUnmount")}else{inst.componentWillUnmount()}}}if(this._renderedComponent){ReactReconciler.unmountComponent(this._renderedComponent,safely);this._renderedNodeType=null;this._renderedComponent=null;this._instance=null}this._pendingStateQueue=null;this._pendingReplaceState=false;this._pendingForceUpdate=false;this._pendingCallbacks=null;this._pendingElement=null;this._context=null;this._rootNodeID=0;this._topLevelWrapper=null;ReactInstanceMap.remove(inst)},_maskContext:function(context){var Component=this._currentElement.type;var contextTypes=Component.contextTypes;if(!contextTypes){return emptyObject}var maskedContext={};for(var contextName in contextTypes){maskedContext[contextName]=context[contextName]}return maskedContext},_processContext:function(context){var maskedContext=this._maskContext(context);if("production"!=="production"){var Component=this._currentElement.type;if(Component.contextTypes){this._checkContextTypes(Component.contextTypes,maskedContext,"context")}}return maskedContext},_processChildContext:function(currentContext){var Component=this._currentElement.type;var inst=this._instance;var childContext;if(inst.getChildContext){if("production"!=="production"){ReactInstrumentation.debugTool.onBeginProcessingChildContext();try{childContext=inst.getChildContext()}finally{ReactInstrumentation.debugTool.onEndProcessingChildContext()}}else{childContext=inst.getChildContext()}}if(childContext){!(typeof Component.childContextTypes==="object")?"production"!=="production"?invariant(false,"%s.getChildContext(): childContextTypes must be defined in order to use getChildContext().",this.getName()||"ReactCompositeComponent"):_prodInvariant("107",this.getName()||"ReactCompositeComponent"):void 0;if("production"!=="production"){this._checkContextTypes(Component.childContextTypes,childContext,"childContext")}for(var name in childContext){!(name in Component.childContextTypes)?"production"!=="production"?invariant(false,'%s.getChildContext(): key "%s" is not defined in childContextTypes.',this.getName()||"ReactCompositeComponent",name):_prodInvariant("108",this.getName()||"ReactCompositeComponent",name):void 0}return _assign({},currentContext,childContext)}return currentContext},_checkContextTypes:function(typeSpecs,values,location){if("production"!=="production"){checkReactTypeSpec(typeSpecs,values,location,this.getName(),null,this._debugID)}},receiveComponent:function(nextElement,transaction,nextContext){var prevElement=this._currentElement;var prevContext=this._context;this._pendingElement=null;this.updateComponent(transaction,prevElement,nextElement,prevContext,nextContext)},performUpdateIfNecessary:function(transaction){if(this._pendingElement!=null){ReactReconciler.receiveComponent(this,this._pendingElement,transaction,this._context)}else if(this._pendingStateQueue!==null||this._pendingForceUpdate){this.updateComponent(transaction,this._currentElement,this._currentElement,this._context,this._context)}else{this._updateBatchNumber=null}},updateComponent:function(transaction,prevParentElement,nextParentElement,prevUnmaskedContext,nextUnmaskedContext){var inst=this._instance;!(inst!=null)?"production"!=="production"?invariant(false,"Attempted to update component `%s` that has already been unmounted (or failed to mount).",this.getName()||"ReactCompositeComponent"):_prodInvariant("136",this.getName()||"ReactCompositeComponent"):void 0;var willReceive=false;var nextContext;if(this._context===nextUnmaskedContext){nextContext=inst.context}else{nextContext=this._processContext(nextUnmaskedContext);willReceive=true}var prevProps=prevParentElement.props;var nextProps=nextParentElement.props;if(prevParentElement!==nextParentElement){willReceive=true}if(willReceive&&inst.componentWillReceiveProps){if("production"!=="production"){measureLifeCyclePerf(function(){return inst.componentWillReceiveProps(nextProps,nextContext)},this._debugID,"componentWillReceiveProps")}else{inst.componentWillReceiveProps(nextProps,nextContext)}}var nextState=this._processPendingState(nextProps,nextContext);var shouldUpdate=true;if(!this._pendingForceUpdate){if(inst.shouldComponentUpdate){if("production"!=="production"){shouldUpdate=measureLifeCyclePerf(function(){return inst.shouldComponentUpdate(nextProps,nextState,nextContext)},this._debugID,"shouldComponentUpdate")}else{shouldUpdate=inst.shouldComponentUpdate(nextProps,nextState,nextContext)}}else{if(this._compositeType===CompositeTypes.PureClass){shouldUpdate=!shallowEqual(prevProps,nextProps)||!shallowEqual(inst.state,nextState)}}}if("production"!=="production"){"production"!=="production"?warning(shouldUpdate!==undefined,"%s.shouldComponentUpdate(): Returned undefined instead of a "+"boolean value. Make sure to return true or false.",this.getName()||"ReactCompositeComponent"):void 0}this._updateBatchNumber=null;if(shouldUpdate){this._pendingForceUpdate=false;this._performComponentUpdate(nextParentElement,nextProps,nextState,nextContext,transaction,nextUnmaskedContext)}else{this._currentElement=nextParentElement;this._context=nextUnmaskedContext;inst.props=nextProps;inst.state=nextState;inst.context=nextContext}},_processPendingState:function(props,context){var inst=this._instance;var queue=this._pendingStateQueue;var replace=this._pendingReplaceState;this._pendingReplaceState=false;this._pendingStateQueue=null;if(!queue){return inst.state}if(replace&&queue.length===1){return queue[0]}var nextState=_assign({},replace?queue[0]:inst.state);
for(var i=replace?1:0;i<queue.length;i++){var partial=queue[i];_assign(nextState,typeof partial==="function"?partial.call(inst,nextState,props,context):partial)}return nextState},_performComponentUpdate:function(nextElement,nextProps,nextState,nextContext,transaction,unmaskedContext){var _this2=this;var inst=this._instance;var hasComponentDidUpdate=Boolean(inst.componentDidUpdate);var prevProps;var prevState;var prevContext;if(hasComponentDidUpdate){prevProps=inst.props;prevState=inst.state;prevContext=inst.context}if(inst.componentWillUpdate){if("production"!=="production"){measureLifeCyclePerf(function(){return inst.componentWillUpdate(nextProps,nextState,nextContext)},this._debugID,"componentWillUpdate")}else{inst.componentWillUpdate(nextProps,nextState,nextContext)}}this._currentElement=nextElement;this._context=unmaskedContext;inst.props=nextProps;inst.state=nextState;inst.context=nextContext;this._updateRenderedComponent(transaction,unmaskedContext);if(hasComponentDidUpdate){if("production"!=="production"){transaction.getReactMountReady().enqueue(function(){measureLifeCyclePerf(inst.componentDidUpdate.bind(inst,prevProps,prevState,prevContext),_this2._debugID,"componentDidUpdate")})}else{transaction.getReactMountReady().enqueue(inst.componentDidUpdate.bind(inst,prevProps,prevState,prevContext),inst)}}},_updateRenderedComponent:function(transaction,context){var prevComponentInstance=this._renderedComponent;var prevRenderedElement=prevComponentInstance._currentElement;var nextRenderedElement=this._renderValidatedComponent();var debugID=0;if("production"!=="production"){debugID=this._debugID}if(shouldUpdateReactComponent(prevRenderedElement,nextRenderedElement)){ReactReconciler.receiveComponent(prevComponentInstance,nextRenderedElement,transaction,this._processChildContext(context))}else{var oldHostNode=ReactReconciler.getHostNode(prevComponentInstance);ReactReconciler.unmountComponent(prevComponentInstance,false);var nodeType=ReactNodeTypes.getType(nextRenderedElement);this._renderedNodeType=nodeType;var child=this._instantiateReactComponent(nextRenderedElement,nodeType!==ReactNodeTypes.EMPTY);this._renderedComponent=child;var nextMarkup=ReactReconciler.mountComponent(child,transaction,this._hostParent,this._hostContainerInfo,this._processChildContext(context),debugID);if("production"!=="production"){if(debugID!==0){var childDebugIDs=child._debugID!==0?[child._debugID]:[];ReactInstrumentation.debugTool.onSetChildren(debugID,childDebugIDs)}}this._replaceNodeWithMarkup(oldHostNode,nextMarkup,prevComponentInstance)}},_replaceNodeWithMarkup:function(oldHostNode,nextMarkup,prevInstance){ReactComponentEnvironment.replaceNodeWithMarkup(oldHostNode,nextMarkup,prevInstance)},_renderValidatedComponentWithoutOwnerOrContext:function(){var inst=this._instance;var renderedElement;if("production"!=="production"){renderedElement=measureLifeCyclePerf(function(){return inst.render()},this._debugID,"render")}else{renderedElement=inst.render()}if("production"!=="production"){if(renderedElement===undefined&&inst.render._isMockFunction){renderedElement=null}}return renderedElement},_renderValidatedComponent:function(){var renderedElement;if("production"!=="production"||this._compositeType!==CompositeTypes.StatelessFunctional){ReactCurrentOwner.current=this;try{renderedElement=this._renderValidatedComponentWithoutOwnerOrContext()}finally{ReactCurrentOwner.current=null}}else{renderedElement=this._renderValidatedComponentWithoutOwnerOrContext()}!(renderedElement===null||renderedElement===false||React.isValidElement(renderedElement))?"production"!=="production"?invariant(false,"%s.render(): A valid React element (or null) must be returned. You may have returned undefined, an array or some other invalid object.",this.getName()||"ReactCompositeComponent"):_prodInvariant("109",this.getName()||"ReactCompositeComponent"):void 0;return renderedElement},attachRef:function(ref,component){var inst=this.getPublicInstance();!(inst!=null)?"production"!=="production"?invariant(false,"Stateless function components cannot have refs."):_prodInvariant("110"):void 0;var publicComponentInstance=component.getPublicInstance();if("production"!=="production"){var componentName=component&&component.getName?component.getName():"a component";"production"!=="production"?warning(publicComponentInstance!=null||component._compositeType!==CompositeTypes.StatelessFunctional,"Stateless function components cannot be given refs "+'(See ref "%s" in %s created by %s). '+"Attempts to access this ref will fail.",ref,componentName,this.getName()):void 0}var refs=inst.refs===emptyObject?inst.refs={}:inst.refs;refs[ref]=publicComponentInstance},detachRef:function(ref){var refs=this.getPublicInstance().refs;delete refs[ref]},getName:function(){var type=this._currentElement.type;var constructor=this._instance&&this._instance.constructor;return type.displayName||constructor&&constructor.displayName||type.name||constructor&&constructor.name||null},getPublicInstance:function(){var inst=this._instance;if(this._compositeType===CompositeTypes.StatelessFunctional){return null}return inst},_instantiateReactComponent:null};module.exports=ReactCompositeComponent},{"./ReactComponentEnvironment":801,"./ReactErrorUtils":826,"./ReactInstanceMap":834,"./ReactInstrumentation":835,"./ReactNodeTypes":840,"./ReactReconciler":845,"./checkReactTypeSpec":872,"./reactProdInvariant":893,"./shouldUpdateReactComponent":897,"fbjs/lib/emptyObject":399,"fbjs/lib/invariant":406,"fbjs/lib/shallowEqual":412,"fbjs/lib/warning":413,"object-assign":732,"react/lib/React":926,"react/lib/ReactCurrentOwner":931}],803:[function(require,module,exports){"use strict";var ReactDOMComponentTree=require("./ReactDOMComponentTree");var ReactDefaultInjection=require("./ReactDefaultInjection");var ReactMount=require("./ReactMount");var ReactReconciler=require("./ReactReconciler");var ReactUpdates=require("./ReactUpdates");var ReactVersion=require("./ReactVersion");var findDOMNode=require("./findDOMNode");var getHostComponentFromComposite=require("./getHostComponentFromComposite");var renderSubtreeIntoContainer=require("./renderSubtreeIntoContainer");var warning=require("fbjs/lib/warning");ReactDefaultInjection.inject();var ReactDOM={findDOMNode:findDOMNode,render:ReactMount.render,unmountComponentAtNode:ReactMount.unmountComponentAtNode,version:ReactVersion,unstable_batchedUpdates:ReactUpdates.batchedUpdates,unstable_renderSubtreeIntoContainer:renderSubtreeIntoContainer};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!=="undefined"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.inject==="function"){__REACT_DEVTOOLS_GLOBAL_HOOK__.inject({ComponentTree:{getClosestInstanceFromNode:ReactDOMComponentTree.getClosestInstanceFromNode,getNodeFromInstance:function(inst){if(inst._renderedComponent){inst=getHostComponentFromComposite(inst)}if(inst){return ReactDOMComponentTree.getNodeFromInstance(inst)}else{return null}}},Mount:ReactMount,Reconciler:ReactReconciler})}if("production"!=="production"){var ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment");if(ExecutionEnvironment.canUseDOM&&window.top===window.self){if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__==="undefined"){if(navigator.userAgent.indexOf("Chrome")>-1&&navigator.userAgent.indexOf("Edge")===-1||navigator.userAgent.indexOf("Firefox")>-1){var showFileUrlMessage=window.location.protocol.indexOf("http")===-1&&navigator.userAgent.indexOf("Firefox")===-1;console.debug("Download the React DevTools "+(showFileUrlMessage?"and use an HTTP server (instead of a file: URL) ":"")+"for a better development experience: "+"https://fb.me/react-devtools")}}var testFunc=function testFn(){};"production"!=="production"?warning((testFunc.name||testFunc.toString()).indexOf("testFn")!==-1,"It looks like you're using a minified copy of the development build "+"of React. When deploying React apps to production, make sure to use "+"the production build which skips development warnings and is faster. "+"See https://fb.me/react-minification for more details."):void 0;var ieCompatibilityMode=document.documentMode&&document.documentMode<8;"production"!=="production"?warning(!ieCompatibilityMode,"Internet Explorer is running in compatibility mode; please add the "+"following tag to your HTML to prevent this from happening: "+'<meta http-equiv="X-UA-Compatible" content="IE=edge" />'):void 0;var expectedFeatures=[Array.isArray,Array.prototype.every,Array.prototype.forEach,Array.prototype.indexOf,Array.prototype.map,Date.now,Function.prototype.bind,Object.keys,String.prototype.trim];for(var i=0;i<expectedFeatures.length;i++){if(!expectedFeatures[i]){"production"!=="production"?warning(false,"One or more ES5 shims expected by React are not available: "+"https://fb.me/react-warning-polyfills"):void 0;break}}}}if("production"!=="production"){var ReactInstrumentation=require("./ReactInstrumentation");var ReactDOMUnknownPropertyHook=require("./ReactDOMUnknownPropertyHook");var ReactDOMNullInputValuePropHook=require("./ReactDOMNullInputValuePropHook");var ReactDOMInvalidARIAHook=require("./ReactDOMInvalidARIAHook");ReactInstrumentation.debugTool.addHook(ReactDOMUnknownPropertyHook);ReactInstrumentation.debugTool.addHook(ReactDOMNullInputValuePropHook);ReactInstrumentation.debugTool.addHook(ReactDOMInvalidARIAHook)}module.exports=ReactDOM},{"./ReactDOMComponentTree":806,"./ReactDOMInvalidARIAHook":812,"./ReactDOMNullInputValuePropHook":813,"./ReactDOMUnknownPropertyHook":820,"./ReactDefaultInjection":823,"./ReactInstrumentation":835,"./ReactMount":838,"./ReactReconciler":845,"./ReactUpdates":850,"./ReactVersion":851,"./findDOMNode":876,"./getHostComponentFromComposite":883,"./renderSubtreeIntoContainer":894,"fbjs/lib/ExecutionEnvironment":392,"fbjs/lib/warning":413}],804:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant"),_assign=require("object-assign");var AutoFocusUtils=require("./AutoFocusUtils");var CSSPropertyOperations=require("./CSSPropertyOperations");var DOMLazyTree=require("./DOMLazyTree");var DOMNamespaces=require("./DOMNamespaces");var DOMProperty=require("./DOMProperty");var DOMPropertyOperations=require("./DOMPropertyOperations");var EventPluginHub=require("./EventPluginHub");var EventPluginRegistry=require("./EventPluginRegistry");var ReactBrowserEventEmitter=require("./ReactBrowserEventEmitter");var ReactDOMComponentFlags=require("./ReactDOMComponentFlags");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var ReactDOMInput=require("./ReactDOMInput");var ReactDOMOption=require("./ReactDOMOption");var ReactDOMSelect=require("./ReactDOMSelect");var ReactDOMTextarea=require("./ReactDOMTextarea");var ReactInstrumentation=require("./ReactInstrumentation");var ReactMultiChild=require("./ReactMultiChild");var ReactServerRenderingTransaction=require("./ReactServerRenderingTransaction");var emptyFunction=require("fbjs/lib/emptyFunction");var escapeTextContentForBrowser=require("./escapeTextContentForBrowser");var invariant=require("fbjs/lib/invariant");var isEventSupported=require("./isEventSupported");var shallowEqual=require("fbjs/lib/shallowEqual");var validateDOMNesting=require("./validateDOMNesting");var warning=require("fbjs/lib/warning");var Flags=ReactDOMComponentFlags;var deleteListener=EventPluginHub.deleteListener;var getNode=ReactDOMComponentTree.getNodeFromInstance;var listenTo=ReactBrowserEventEmitter.listenTo;var registrationNameModules=EventPluginRegistry.registrationNameModules;var CONTENT_TYPES={string:true,number:true};var STYLE="style";var HTML="__html";var RESERVED_PROPS={children:null,dangerouslySetInnerHTML:null,suppressContentEditableWarning:null};var DOC_FRAGMENT_TYPE=11;function getDeclarationErrorAddendum(internalInstance){if(internalInstance){var owner=internalInstance._currentElement._owner||null;if(owner){var name=owner.getName();if(name){return" This DOM node was rendered by `"+name+"`."}}}return""}function friendlyStringify(obj){if(typeof obj==="object"){if(Array.isArray(obj)){return"["+obj.map(friendlyStringify).join(", ")+"]"}else{var pairs=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var keyEscaped=/^[a-z$_][\w$_]*$/i.test(key)?key:JSON.stringify(key);pairs.push(keyEscaped+": "+friendlyStringify(obj[key]))}}return"{"+pairs.join(", ")+"}"}}else if(typeof obj==="string"){return JSON.stringify(obj)}else if(typeof obj==="function"){return"[function object]"}return String(obj)}var styleMutationWarning={};function checkAndWarnForMutatedStyle(style1,style2,component){if(style1==null||style2==null){return}if(shallowEqual(style1,style2)){return}var componentName=component._tag;var owner=component._currentElement._owner;var ownerName;if(owner){ownerName=owner.getName()}var hash=ownerName+"|"+componentName;if(styleMutationWarning.hasOwnProperty(hash)){return}styleMutationWarning[hash]=true;"production"!=="production"?warning(false,"`%s` was passed a style object that has previously been mutated. "+"Mutating `style` is deprecated. Consider cloning it beforehand. Check "+"the `render` %s. Previous style: %s. Mutated style: %s.",componentName,owner?"of `"+ownerName+"`":"using <"+componentName+">",friendlyStringify(style1),friendlyStringify(style2)):void 0}function assertValidProps(component,props){if(!props){return}if(voidElementTags[component._tag]){!(props.children==null&&props.dangerouslySetInnerHTML==null)?"production"!=="production"?invariant(false,"%s is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.%s",component._tag,component._currentElement._owner?" Check the render method of "+component._currentElement._owner.getName()+".":""):_prodInvariant("137",component._tag,component._currentElement._owner?" Check the render method of "+component._currentElement._owner.getName()+".":""):void 0}if(props.dangerouslySetInnerHTML!=null){!(props.children==null)?"production"!=="production"?invariant(false,"Can only set one of `children` or `props.dangerouslySetInnerHTML`."):_prodInvariant("60"):void 0;!(typeof props.dangerouslySetInnerHTML==="object"&&HTML in props.dangerouslySetInnerHTML)?"production"!=="production"?invariant(false,"`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://fb.me/react-invariant-dangerously-set-inner-html for more information."):_prodInvariant("61"):void 0}if("production"!=="production"){"production"!=="production"?warning(props.innerHTML==null,"Directly setting property `innerHTML` is not permitted. "+"For more information, lookup documentation on `dangerouslySetInnerHTML`."):void 0;"production"!=="production"?warning(props.suppressContentEditableWarning||!props.contentEditable||props.children==null,"A component is `contentEditable` and contains `children` managed by "+"React. It is now your responsibility to guarantee that none of "+"those nodes are unexpectedly modified or duplicated. This is "+"probably not intentional."):void 0;"production"!=="production"?warning(props.onFocusIn==null&&props.onFocusOut==null,"React uses onFocus and onBlur instead of onFocusIn and onFocusOut. "+"All React events are normalized to bubble, so onFocusIn and onFocusOut "+"are not needed/supported by React."):void 0}!(props.style==null||typeof props.style==="object")?"production"!=="production"?invariant(false,"The `style` prop expects a mapping from style properties to values, not a string. For example, style={{marginRight: spacing + 'em'}} when using JSX.%s",getDeclarationErrorAddendum(component)):_prodInvariant("62",getDeclarationErrorAddendum(component)):void 0}function enqueuePutListener(inst,registrationName,listener,transaction){if(transaction instanceof ReactServerRenderingTransaction){return}if("production"!=="production"){"production"!=="production"?warning(registrationName!=="onScroll"||isEventSupported("scroll",true),"This browser doesn't support the `onScroll` event"):void 0}var containerInfo=inst._hostContainerInfo;var isDocumentFragment=containerInfo._node&&containerInfo._node.nodeType===DOC_FRAGMENT_TYPE;var doc=isDocumentFragment?containerInfo._node:containerInfo._ownerDocument;listenTo(registrationName,doc);transaction.getReactMountReady().enqueue(putListener,{inst:inst,registrationName:registrationName,listener:listener})}function putListener(){var listenerToPut=this;EventPluginHub.putListener(listenerToPut.inst,listenerToPut.registrationName,listenerToPut.listener)}function inputPostMount(){var inst=this;ReactDOMInput.postMountWrapper(inst)}function textareaPostMount(){var inst=this;ReactDOMTextarea.postMountWrapper(inst)}function optionPostMount(){var inst=this;ReactDOMOption.postMountWrapper(inst)}var setAndValidateContentChildDev=emptyFunction;if("production"!=="production"){setAndValidateContentChildDev=function(content){var hasExistingContent=this._contentDebugID!=null;var debugID=this._debugID;var contentDebugID=-debugID;if(content==null){if(hasExistingContent){ReactInstrumentation.debugTool.onUnmountComponent(this._contentDebugID)}this._contentDebugID=null;return}validateDOMNesting(null,String(content),this,this._ancestorInfo);this._contentDebugID=contentDebugID;if(hasExistingContent){ReactInstrumentation.debugTool.onBeforeUpdateComponent(contentDebugID,content);ReactInstrumentation.debugTool.onUpdateComponent(contentDebugID)}else{ReactInstrumentation.debugTool.onBeforeMountComponent(contentDebugID,content,debugID);ReactInstrumentation.debugTool.onMountComponent(contentDebugID);ReactInstrumentation.debugTool.onSetChildren(debugID,[contentDebugID])}}}var mediaEvents={topAbort:"abort",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topSeeked:"seeked",topSeeking:"seeking",topStalled:"stalled",topSuspend:"suspend",topTimeUpdate:"timeupdate",topVolumeChange:"volumechange",topWaiting:"waiting"};function trapBubbledEventsLocal(){var inst=this;!inst._rootNodeID?"production"!=="production"?invariant(false,"Must be mounted to trap events"):_prodInvariant("63"):void 0;var node=getNode(inst);!node?"production"!=="production"?invariant(false,"trapBubbledEvent(...): Requires node to be rendered."):_prodInvariant("64"):void 0;switch(inst._tag){case"iframe":case"object":inst._wrapperState.listeners=[ReactBrowserEventEmitter.trapBubbledEvent("topLoad","load",node)];break;case"video":case"audio":inst._wrapperState.listeners=[];for(var event in mediaEvents){if(mediaEvents.hasOwnProperty(event)){inst._wrapperState.listeners.push(ReactBrowserEventEmitter.trapBubbledEvent(event,mediaEvents[event],node))}}break;case"source":inst._wrapperState.listeners=[ReactBrowserEventEmitter.trapBubbledEvent("topError","error",node)];break;case"img":inst._wrapperState.listeners=[ReactBrowserEventEmitter.trapBubbledEvent("topError","error",node),ReactBrowserEventEmitter.trapBubbledEvent("topLoad","load",node)];break;case"form":inst._wrapperState.listeners=[ReactBrowserEventEmitter.trapBubbledEvent("topReset","reset",node),ReactBrowserEventEmitter.trapBubbledEvent("topSubmit","submit",node)];break;case"input":case"select":case"textarea":inst._wrapperState.listeners=[ReactBrowserEventEmitter.trapBubbledEvent("topInvalid","invalid",node)];break}}function postUpdateSelectWrapper(){ReactDOMSelect.postUpdateWrapper(this)}var omittedCloseTags={area:true,base:true,br:true,col:true,embed:true,hr:true,img:true,input:true,keygen:true,link:true,meta:true,param:true,source:true,track:true,wbr:true};var newlineEatingTags={listing:true,pre:true,textarea:true};var voidElementTags=_assign({menuitem:true},omittedCloseTags);var VALID_TAG_REGEX=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/;var validatedTagCache={};var hasOwnProperty={}.hasOwnProperty;function validateDangerousTag(tag){if(!hasOwnProperty.call(validatedTagCache,tag)){!VALID_TAG_REGEX.test(tag)?"production"!=="production"?invariant(false,"Invalid tag: %s",tag):_prodInvariant("65",tag):void 0;validatedTagCache[tag]=true}}function isCustomComponent(tagName,props){return tagName.indexOf("-")>=0||props.is!=null}var globalIdCounter=1;function ReactDOMComponent(element){var tag=element.type;validateDangerousTag(tag);this._currentElement=element;this._tag=tag.toLowerCase();this._namespaceURI=null;this._renderedChildren=null;this._previousStyle=null;this._previousStyleCopy=null;this._hostNode=null;this._hostParent=null;this._rootNodeID=0;this._domID=0;this._hostContainerInfo=null;this._wrapperState=null;this._topLevelWrapper=null;this._flags=0;if("production"!=="production"){this._ancestorInfo=null;setAndValidateContentChildDev.call(this,null)}}ReactDOMComponent.displayName="ReactDOMComponent";ReactDOMComponent.Mixin={mountComponent:function(transaction,hostParent,hostContainerInfo,context){this._rootNodeID=globalIdCounter++;this._domID=hostContainerInfo._idCounter++;this._hostParent=hostParent;this._hostContainerInfo=hostContainerInfo;var props=this._currentElement.props;switch(this._tag){case"audio":case"form":case"iframe":case"img":case"link":case"object":case"source":case"video":this._wrapperState={listeners:null};transaction.getReactMountReady().enqueue(trapBubbledEventsLocal,this);break;case"input":ReactDOMInput.mountWrapper(this,props,hostParent);props=ReactDOMInput.getHostProps(this,props);transaction.getReactMountReady().enqueue(trapBubbledEventsLocal,this);break;case"option":ReactDOMOption.mountWrapper(this,props,hostParent);props=ReactDOMOption.getHostProps(this,props);break;case"select":ReactDOMSelect.mountWrapper(this,props,hostParent);props=ReactDOMSelect.getHostProps(this,props);transaction.getReactMountReady().enqueue(trapBubbledEventsLocal,this);break;case"textarea":ReactDOMTextarea.mountWrapper(this,props,hostParent);props=ReactDOMTextarea.getHostProps(this,props);transaction.getReactMountReady().enqueue(trapBubbledEventsLocal,this);break}assertValidProps(this,props);var namespaceURI;var parentTag;if(hostParent!=null){namespaceURI=hostParent._namespaceURI;parentTag=hostParent._tag}else if(hostContainerInfo._tag){namespaceURI=hostContainerInfo._namespaceURI;parentTag=hostContainerInfo._tag}if(namespaceURI==null||namespaceURI===DOMNamespaces.svg&&parentTag==="foreignobject"){namespaceURI=DOMNamespaces.html}if(namespaceURI===DOMNamespaces.html){if(this._tag==="svg"){namespaceURI=DOMNamespaces.svg}else if(this._tag==="math"){namespaceURI=DOMNamespaces.mathml}}this._namespaceURI=namespaceURI;if("production"!=="production"){var parentInfo;if(hostParent!=null){parentInfo=hostParent._ancestorInfo}else if(hostContainerInfo._tag){parentInfo=hostContainerInfo._ancestorInfo}if(parentInfo){validateDOMNesting(this._tag,null,this,parentInfo)}this._ancestorInfo=validateDOMNesting.updatedAncestorInfo(parentInfo,this._tag,this)}var mountImage;if(transaction.useCreateElement){var ownerDocument=hostContainerInfo._ownerDocument;var el;if(namespaceURI===DOMNamespaces.html){if(this._tag==="script"){var div=ownerDocument.createElement("div");var type=this._currentElement.type;div.innerHTML="<"+type+"></"+type+">";el=div.removeChild(div.firstChild)}else if(props.is){el=ownerDocument.createElement(this._currentElement.type,props.is)}else{el=ownerDocument.createElement(this._currentElement.type)}}else{el=ownerDocument.createElementNS(namespaceURI,this._currentElement.type)}ReactDOMComponentTree.precacheNode(this,el);this._flags|=Flags.hasCachedChildNodes;if(!this._hostParent){DOMPropertyOperations.setAttributeForRoot(el)}this._updateDOMProperties(null,props,transaction);var lazyTree=DOMLazyTree(el);this._createInitialChildren(transaction,props,context,lazyTree);mountImage=lazyTree}else{var tagOpen=this._createOpenTagMarkupAndPutListeners(transaction,props);var tagContent=this._createContentMarkup(transaction,props,context);if(!tagContent&&omittedCloseTags[this._tag]){mountImage=tagOpen+"/>"}else{mountImage=tagOpen+">"+tagContent+"</"+this._currentElement.type+">"}}switch(this._tag){case"input":transaction.getReactMountReady().enqueue(inputPostMount,this);if(props.autoFocus){transaction.getReactMountReady().enqueue(AutoFocusUtils.focusDOMComponent,this)}break;case"textarea":transaction.getReactMountReady().enqueue(textareaPostMount,this);if(props.autoFocus){transaction.getReactMountReady().enqueue(AutoFocusUtils.focusDOMComponent,this)}break;case"select":if(props.autoFocus){transaction.getReactMountReady().enqueue(AutoFocusUtils.focusDOMComponent,this)}break;case"button":if(props.autoFocus){transaction.getReactMountReady().enqueue(AutoFocusUtils.focusDOMComponent,this)}break;case"option":transaction.getReactMountReady().enqueue(optionPostMount,this);break}return mountImage},_createOpenTagMarkupAndPutListeners:function(transaction,props){var ret="<"+this._currentElement.type;for(var propKey in props){if(!props.hasOwnProperty(propKey)){continue}var propValue=props[propKey];if(propValue==null){continue}if(registrationNameModules.hasOwnProperty(propKey)){if(propValue){enqueuePutListener(this,propKey,propValue,transaction)}}else{if(propKey===STYLE){if(propValue){if("production"!=="production"){this._previousStyle=propValue}propValue=this._previousStyleCopy=_assign({},props.style)}propValue=CSSPropertyOperations.createMarkupForStyles(propValue,this)}var markup=null;if(this._tag!=null&&isCustomComponent(this._tag,props)){if(!RESERVED_PROPS.hasOwnProperty(propKey)){markup=DOMPropertyOperations.createMarkupForCustomAttribute(propKey,propValue)}}else{markup=DOMPropertyOperations.createMarkupForProperty(propKey,propValue)}if(markup){ret+=" "+markup}}}if(transaction.renderToStaticMarkup){return ret}if(!this._hostParent){ret+=" "+DOMPropertyOperations.createMarkupForRoot()}ret+=" "+DOMPropertyOperations.createMarkupForID(this._domID);return ret},_createContentMarkup:function(transaction,props,context){var ret="";var innerHTML=props.dangerouslySetInnerHTML;if(innerHTML!=null){if(innerHTML.__html!=null){ret=innerHTML.__html}}else{var contentToUse=CONTENT_TYPES[typeof props.children]?props.children:null;var childrenToUse=contentToUse!=null?null:props.children;if(contentToUse!=null){ret=escapeTextContentForBrowser(contentToUse);if("production"!=="production"){setAndValidateContentChildDev.call(this,contentToUse)}}else if(childrenToUse!=null){var mountImages=this.mountChildren(childrenToUse,transaction,context);ret=mountImages.join("")}}if(newlineEatingTags[this._tag]&&ret.charAt(0)==="\n"){return"\n"+ret}else{return ret}},_createInitialChildren:function(transaction,props,context,lazyTree){var innerHTML=props.dangerouslySetInnerHTML;if(innerHTML!=null){if(innerHTML.__html!=null){DOMLazyTree.queueHTML(lazyTree,innerHTML.__html)}}else{var contentToUse=CONTENT_TYPES[typeof props.children]?props.children:null;var childrenToUse=contentToUse!=null?null:props.children;if(contentToUse!=null){if(contentToUse!==""){if("production"!=="production"){setAndValidateContentChildDev.call(this,contentToUse)}DOMLazyTree.queueText(lazyTree,contentToUse)}}else if(childrenToUse!=null){var mountImages=this.mountChildren(childrenToUse,transaction,context);for(var i=0;i<mountImages.length;i++){DOMLazyTree.queueChild(lazyTree,mountImages[i])}}}},receiveComponent:function(nextElement,transaction,context){var prevElement=this._currentElement;this._currentElement=nextElement;this.updateComponent(transaction,prevElement,nextElement,context)},updateComponent:function(transaction,prevElement,nextElement,context){var lastProps=prevElement.props;var nextProps=this._currentElement.props;switch(this._tag){case"input":lastProps=ReactDOMInput.getHostProps(this,lastProps);nextProps=ReactDOMInput.getHostProps(this,nextProps);break;case"option":lastProps=ReactDOMOption.getHostProps(this,lastProps);nextProps=ReactDOMOption.getHostProps(this,nextProps);break;case"select":lastProps=ReactDOMSelect.getHostProps(this,lastProps);nextProps=ReactDOMSelect.getHostProps(this,nextProps);break;case"textarea":lastProps=ReactDOMTextarea.getHostProps(this,lastProps);nextProps=ReactDOMTextarea.getHostProps(this,nextProps);break}assertValidProps(this,nextProps);this._updateDOMProperties(lastProps,nextProps,transaction);this._updateDOMChildren(lastProps,nextProps,transaction,context);switch(this._tag){case"input":ReactDOMInput.updateWrapper(this);break;case"textarea":ReactDOMTextarea.updateWrapper(this);break;case"select":transaction.getReactMountReady().enqueue(postUpdateSelectWrapper,this);break}},_updateDOMProperties:function(lastProps,nextProps,transaction){var propKey;var styleName;var styleUpdates;for(propKey in lastProps){if(nextProps.hasOwnProperty(propKey)||!lastProps.hasOwnProperty(propKey)||lastProps[propKey]==null){continue}if(propKey===STYLE){var lastStyle=this._previousStyleCopy;for(styleName in lastStyle){if(lastStyle.hasOwnProperty(styleName)){styleUpdates=styleUpdates||{};styleUpdates[styleName]=""}}this._previousStyleCopy=null}else if(registrationNameModules.hasOwnProperty(propKey)){if(lastProps[propKey]){deleteListener(this,propKey)}}else if(isCustomComponent(this._tag,lastProps)){if(!RESERVED_PROPS.hasOwnProperty(propKey)){DOMPropertyOperations.deleteValueForAttribute(getNode(this),propKey)}}else if(DOMProperty.properties[propKey]||DOMProperty.isCustomAttribute(propKey)){DOMPropertyOperations.deleteValueForProperty(getNode(this),propKey)}}for(propKey in nextProps){var nextProp=nextProps[propKey];var lastProp=propKey===STYLE?this._previousStyleCopy:lastProps!=null?lastProps[propKey]:undefined;if(!nextProps.hasOwnProperty(propKey)||nextProp===lastProp||nextProp==null&&lastProp==null){continue}if(propKey===STYLE){if(nextProp){if("production"!=="production"){checkAndWarnForMutatedStyle(this._previousStyleCopy,this._previousStyle,this);this._previousStyle=nextProp}nextProp=this._previousStyleCopy=_assign({},nextProp)}else{this._previousStyleCopy=null}if(lastProp){for(styleName in lastProp){if(lastProp.hasOwnProperty(styleName)&&(!nextProp||!nextProp.hasOwnProperty(styleName))){styleUpdates=styleUpdates||{};styleUpdates[styleName]=""}}for(styleName in nextProp){if(nextProp.hasOwnProperty(styleName)&&lastProp[styleName]!==nextProp[styleName]){styleUpdates=styleUpdates||{};styleUpdates[styleName]=nextProp[styleName]}}}else{styleUpdates=nextProp}}else if(registrationNameModules.hasOwnProperty(propKey)){if(nextProp){enqueuePutListener(this,propKey,nextProp,transaction)}else if(lastProp){deleteListener(this,propKey)}}else if(isCustomComponent(this._tag,nextProps)){if(!RESERVED_PROPS.hasOwnProperty(propKey)){DOMPropertyOperations.setValueForAttribute(getNode(this),propKey,nextProp)}}else if(DOMProperty.properties[propKey]||DOMProperty.isCustomAttribute(propKey)){var node=getNode(this);if(nextProp!=null){DOMPropertyOperations.setValueForProperty(node,propKey,nextProp)}else{DOMPropertyOperations.deleteValueForProperty(node,propKey)}}}if(styleUpdates){CSSPropertyOperations.setValueForStyles(getNode(this),styleUpdates,this)}},_updateDOMChildren:function(lastProps,nextProps,transaction,context){var lastContent=CONTENT_TYPES[typeof lastProps.children]?lastProps.children:null;var nextContent=CONTENT_TYPES[typeof nextProps.children]?nextProps.children:null;var lastHtml=lastProps.dangerouslySetInnerHTML&&lastProps.dangerouslySetInnerHTML.__html;var nextHtml=nextProps.dangerouslySetInnerHTML&&nextProps.dangerouslySetInnerHTML.__html;var lastChildren=lastContent!=null?null:lastProps.children;var nextChildren=nextContent!=null?null:nextProps.children;var lastHasContentOrHtml=lastContent!=null||lastHtml!=null;var nextHasContentOrHtml=nextContent!=null||nextHtml!=null;if(lastChildren!=null&&nextChildren==null){this.updateChildren(null,transaction,context)}else if(lastHasContentOrHtml&&!nextHasContentOrHtml){this.updateTextContent("");if("production"!=="production"){ReactInstrumentation.debugTool.onSetChildren(this._debugID,[])}}if(nextContent!=null){if(lastContent!==nextContent){this.updateTextContent(""+nextContent);if("production"!=="production"){setAndValidateContentChildDev.call(this,nextContent);
}}}else if(nextHtml!=null){if(lastHtml!==nextHtml){this.updateMarkup(""+nextHtml)}if("production"!=="production"){ReactInstrumentation.debugTool.onSetChildren(this._debugID,[])}}else if(nextChildren!=null){if("production"!=="production"){setAndValidateContentChildDev.call(this,null)}this.updateChildren(nextChildren,transaction,context)}},getHostNode:function(){return getNode(this)},unmountComponent:function(safely){switch(this._tag){case"audio":case"form":case"iframe":case"img":case"link":case"object":case"source":case"video":var listeners=this._wrapperState.listeners;if(listeners){for(var i=0;i<listeners.length;i++){listeners[i].remove()}}break;case"html":case"head":case"body":!false?"production"!=="production"?invariant(false,"<%s> tried to unmount. Because of cross-browser quirks it is impossible to unmount some top-level components (eg <html>, <head>, and <body>) reliably and efficiently. To fix this, have a single top-level component that never unmounts render these elements.",this._tag):_prodInvariant("66",this._tag):void 0;break}this.unmountChildren(safely);ReactDOMComponentTree.uncacheNode(this);EventPluginHub.deleteAllListeners(this);this._rootNodeID=0;this._domID=0;this._wrapperState=null;if("production"!=="production"){setAndValidateContentChildDev.call(this,null)}},getPublicInstance:function(){return getNode(this)}};_assign(ReactDOMComponent.prototype,ReactDOMComponent.Mixin,ReactMultiChild.Mixin);module.exports=ReactDOMComponent},{"./AutoFocusUtils":775,"./CSSPropertyOperations":778,"./DOMLazyTree":782,"./DOMNamespaces":783,"./DOMProperty":784,"./DOMPropertyOperations":785,"./EventPluginHub":789,"./EventPluginRegistry":790,"./ReactBrowserEventEmitter":798,"./ReactDOMComponentFlags":805,"./ReactDOMComponentTree":806,"./ReactDOMInput":811,"./ReactDOMOption":814,"./ReactDOMSelect":815,"./ReactDOMTextarea":818,"./ReactInstrumentation":835,"./ReactMultiChild":839,"./ReactServerRenderingTransaction":847,"./escapeTextContentForBrowser":875,"./isEventSupported":890,"./reactProdInvariant":893,"./validateDOMNesting":899,"fbjs/lib/emptyFunction":398,"fbjs/lib/invariant":406,"fbjs/lib/shallowEqual":412,"fbjs/lib/warning":413,"object-assign":732}],805:[function(require,module,exports){"use strict";var ReactDOMComponentFlags={hasCachedChildNodes:1<<0};module.exports=ReactDOMComponentFlags},{}],806:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var DOMProperty=require("./DOMProperty");var ReactDOMComponentFlags=require("./ReactDOMComponentFlags");var invariant=require("fbjs/lib/invariant");var ATTR_NAME=DOMProperty.ID_ATTRIBUTE_NAME;var Flags=ReactDOMComponentFlags;var internalInstanceKey="__reactInternalInstance$"+Math.random().toString(36).slice(2);function shouldPrecacheNode(node,nodeID){return node.nodeType===1&&node.getAttribute(ATTR_NAME)===String(nodeID)||node.nodeType===8&&node.nodeValue===" react-text: "+nodeID+" "||node.nodeType===8&&node.nodeValue===" react-empty: "+nodeID+" "}function getRenderedHostOrTextFromComponent(component){var rendered;while(rendered=component._renderedComponent){component=rendered}return component}function precacheNode(inst,node){var hostInst=getRenderedHostOrTextFromComponent(inst);hostInst._hostNode=node;node[internalInstanceKey]=hostInst}function uncacheNode(inst){var node=inst._hostNode;if(node){delete node[internalInstanceKey];inst._hostNode=null}}function precacheChildNodes(inst,node){if(inst._flags&Flags.hasCachedChildNodes){return}var children=inst._renderedChildren;var childNode=node.firstChild;outer:for(var name in children){if(!children.hasOwnProperty(name)){continue}var childInst=children[name];var childID=getRenderedHostOrTextFromComponent(childInst)._domID;if(childID===0){continue}for(;childNode!==null;childNode=childNode.nextSibling){if(shouldPrecacheNode(childNode,childID)){precacheNode(childInst,childNode);continue outer}}!false?"production"!=="production"?invariant(false,"Unable to find element with ID %s.",childID):_prodInvariant("32",childID):void 0}inst._flags|=Flags.hasCachedChildNodes}function getClosestInstanceFromNode(node){if(node[internalInstanceKey]){return node[internalInstanceKey]}var parents=[];while(!node[internalInstanceKey]){parents.push(node);if(node.parentNode){node=node.parentNode}else{return null}}var closest;var inst;for(;node&&(inst=node[internalInstanceKey]);node=parents.pop()){closest=inst;if(parents.length){precacheChildNodes(inst,node)}}return closest}function getInstanceFromNode(node){var inst=getClosestInstanceFromNode(node);if(inst!=null&&inst._hostNode===node){return inst}else{return null}}function getNodeFromInstance(inst){!(inst._hostNode!==undefined)?"production"!=="production"?invariant(false,"getNodeFromInstance: Invalid argument."):_prodInvariant("33"):void 0;if(inst._hostNode){return inst._hostNode}var parents=[];while(!inst._hostNode){parents.push(inst);!inst._hostParent?"production"!=="production"?invariant(false,"React DOM tree root should always have a node reference."):_prodInvariant("34"):void 0;inst=inst._hostParent}for(;parents.length;inst=parents.pop()){precacheChildNodes(inst,inst._hostNode)}return inst._hostNode}var ReactDOMComponentTree={getClosestInstanceFromNode:getClosestInstanceFromNode,getInstanceFromNode:getInstanceFromNode,getNodeFromInstance:getNodeFromInstance,precacheChildNodes:precacheChildNodes,precacheNode:precacheNode,uncacheNode:uncacheNode};module.exports=ReactDOMComponentTree},{"./DOMProperty":784,"./ReactDOMComponentFlags":805,"./reactProdInvariant":893,"fbjs/lib/invariant":406}],807:[function(require,module,exports){"use strict";var validateDOMNesting=require("./validateDOMNesting");var DOC_NODE_TYPE=9;function ReactDOMContainerInfo(topLevelWrapper,node){var info={_topLevelWrapper:topLevelWrapper,_idCounter:1,_ownerDocument:node?node.nodeType===DOC_NODE_TYPE?node:node.ownerDocument:null,_node:node,_tag:node?node.nodeName.toLowerCase():null,_namespaceURI:node?node.namespaceURI:null};if("production"!=="production"){info._ancestorInfo=node?validateDOMNesting.updatedAncestorInfo(null,info._tag,null):null}return info}module.exports=ReactDOMContainerInfo},{"./validateDOMNesting":899}],808:[function(require,module,exports){"use strict";var _assign=require("object-assign");var DOMLazyTree=require("./DOMLazyTree");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var ReactDOMEmptyComponent=function(instantiate){this._currentElement=null;this._hostNode=null;this._hostParent=null;this._hostContainerInfo=null;this._domID=0};_assign(ReactDOMEmptyComponent.prototype,{mountComponent:function(transaction,hostParent,hostContainerInfo,context){var domID=hostContainerInfo._idCounter++;this._domID=domID;this._hostParent=hostParent;this._hostContainerInfo=hostContainerInfo;var nodeValue=" react-empty: "+this._domID+" ";if(transaction.useCreateElement){var ownerDocument=hostContainerInfo._ownerDocument;var node=ownerDocument.createComment(nodeValue);ReactDOMComponentTree.precacheNode(this,node);return DOMLazyTree(node)}else{if(transaction.renderToStaticMarkup){return""}return"<!--"+nodeValue+"-->"}},receiveComponent:function(){},getHostNode:function(){return ReactDOMComponentTree.getNodeFromInstance(this)},unmountComponent:function(){ReactDOMComponentTree.uncacheNode(this)}});module.exports=ReactDOMEmptyComponent},{"./DOMLazyTree":782,"./ReactDOMComponentTree":806,"object-assign":732}],809:[function(require,module,exports){"use strict";var ReactDOMFeatureFlags={useCreateElement:true,useFiber:false};module.exports=ReactDOMFeatureFlags},{}],810:[function(require,module,exports){"use strict";var DOMChildrenOperations=require("./DOMChildrenOperations");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var ReactDOMIDOperations={dangerouslyProcessChildrenUpdates:function(parentInst,updates){var node=ReactDOMComponentTree.getNodeFromInstance(parentInst);DOMChildrenOperations.processUpdates(node,updates)}};module.exports=ReactDOMIDOperations},{"./DOMChildrenOperations":781,"./ReactDOMComponentTree":806}],811:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant"),_assign=require("object-assign");var DOMPropertyOperations=require("./DOMPropertyOperations");var LinkedValueUtils=require("./LinkedValueUtils");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var ReactUpdates=require("./ReactUpdates");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");var didWarnValueLink=false;var didWarnCheckedLink=false;var didWarnValueDefaultValue=false;var didWarnCheckedDefaultChecked=false;var didWarnControlledToUncontrolled=false;var didWarnUncontrolledToControlled=false;function forceUpdateIfMounted(){if(this._rootNodeID){ReactDOMInput.updateWrapper(this)}}function isControlled(props){var usesChecked=props.type==="checkbox"||props.type==="radio";return usesChecked?props.checked!=null:props.value!=null}var ReactDOMInput={getHostProps:function(inst,props){var value=LinkedValueUtils.getValue(props);var checked=LinkedValueUtils.getChecked(props);var hostProps=_assign({type:undefined,step:undefined,min:undefined,max:undefined},props,{defaultChecked:undefined,defaultValue:undefined,value:value!=null?value:inst._wrapperState.initialValue,checked:checked!=null?checked:inst._wrapperState.initialChecked,onChange:inst._wrapperState.onChange});return hostProps},mountWrapper:function(inst,props){if("production"!=="production"){LinkedValueUtils.checkPropTypes("input",props,inst._currentElement._owner);var owner=inst._currentElement._owner;if(props.valueLink!==undefined&&!didWarnValueLink){"production"!=="production"?warning(false,"`valueLink` prop on `input` is deprecated; set `value` and `onChange` instead."):void 0;didWarnValueLink=true}if(props.checkedLink!==undefined&&!didWarnCheckedLink){"production"!=="production"?warning(false,"`checkedLink` prop on `input` is deprecated; set `value` and `onChange` instead."):void 0;didWarnCheckedLink=true}if(props.checked!==undefined&&props.defaultChecked!==undefined&&!didWarnCheckedDefaultChecked){"production"!=="production"?warning(false,"%s contains an input of type %s with both checked and defaultChecked props. "+"Input elements must be either controlled or uncontrolled "+"(specify either the checked prop, or the defaultChecked prop, but not "+"both). Decide between using a controlled or uncontrolled input "+"element and remove one of these props. More info: "+"https://fb.me/react-controlled-components",owner&&owner.getName()||"A component",props.type):void 0;didWarnCheckedDefaultChecked=true}if(props.value!==undefined&&props.defaultValue!==undefined&&!didWarnValueDefaultValue){"production"!=="production"?warning(false,"%s contains an input of type %s with both value and defaultValue props. "+"Input elements must be either controlled or uncontrolled "+"(specify either the value prop, or the defaultValue prop, but not "+"both). Decide between using a controlled or uncontrolled input "+"element and remove one of these props. More info: "+"https://fb.me/react-controlled-components",owner&&owner.getName()||"A component",props.type):void 0;didWarnValueDefaultValue=true}}var defaultValue=props.defaultValue;inst._wrapperState={initialChecked:props.checked!=null?props.checked:props.defaultChecked,initialValue:props.value!=null?props.value:defaultValue,listeners:null,onChange:_handleChange.bind(inst)};if("production"!=="production"){inst._wrapperState.controlled=isControlled(props)}},updateWrapper:function(inst){var props=inst._currentElement.props;if("production"!=="production"){var controlled=isControlled(props);var owner=inst._currentElement._owner;if(!inst._wrapperState.controlled&&controlled&&!didWarnUncontrolledToControlled){"production"!=="production"?warning(false,"%s is changing an uncontrolled input of type %s to be controlled. "+"Input elements should not switch from uncontrolled to controlled (or vice versa). "+"Decide between using a controlled or uncontrolled input "+"element for the lifetime of the component. More info: https://fb.me/react-controlled-components",owner&&owner.getName()||"A component",props.type):void 0;didWarnUncontrolledToControlled=true}if(inst._wrapperState.controlled&&!controlled&&!didWarnControlledToUncontrolled){"production"!=="production"?warning(false,"%s is changing a controlled input of type %s to be uncontrolled. "+"Input elements should not switch from controlled to uncontrolled (or vice versa). "+"Decide between using a controlled or uncontrolled input "+"element for the lifetime of the component. More info: https://fb.me/react-controlled-components",owner&&owner.getName()||"A component",props.type):void 0;didWarnControlledToUncontrolled=true}}var checked=props.checked;if(checked!=null){DOMPropertyOperations.setValueForProperty(ReactDOMComponentTree.getNodeFromInstance(inst),"checked",checked||false)}var node=ReactDOMComponentTree.getNodeFromInstance(inst);var value=LinkedValueUtils.getValue(props);if(value!=null){var newValue=""+value;if(newValue!==node.value){node.value=newValue}}else{if(props.value==null&&props.defaultValue!=null){if(node.defaultValue!==""+props.defaultValue){node.defaultValue=""+props.defaultValue}}if(props.checked==null&&props.defaultChecked!=null){node.defaultChecked=!!props.defaultChecked}}},postMountWrapper:function(inst){var props=inst._currentElement.props;var node=ReactDOMComponentTree.getNodeFromInstance(inst);switch(props.type){case"submit":case"reset":break;case"color":case"date":case"datetime":case"datetime-local":case"month":case"time":case"week":node.value="";node.value=node.defaultValue;break;default:node.value=node.value;break}var name=node.name;if(name!==""){node.name=""}node.defaultChecked=!node.defaultChecked;node.defaultChecked=!node.defaultChecked;if(name!==""){node.name=name}}};function _handleChange(event){var props=this._currentElement.props;var returnValue=LinkedValueUtils.executeOnChange(props,event);ReactUpdates.asap(forceUpdateIfMounted,this);var name=props.name;if(props.type==="radio"&&name!=null){var rootNode=ReactDOMComponentTree.getNodeFromInstance(this);var queryRoot=rootNode;while(queryRoot.parentNode){queryRoot=queryRoot.parentNode}var group=queryRoot.querySelectorAll("input[name="+JSON.stringify(""+name)+'][type="radio"]');for(var i=0;i<group.length;i++){var otherNode=group[i];if(otherNode===rootNode||otherNode.form!==rootNode.form){continue}var otherInstance=ReactDOMComponentTree.getInstanceFromNode(otherNode);!otherInstance?"production"!=="production"?invariant(false,"ReactDOMInput: Mixing React and non-React radio inputs with the same `name` is not supported."):_prodInvariant("90"):void 0;ReactUpdates.asap(forceUpdateIfMounted,otherInstance)}}return returnValue}module.exports=ReactDOMInput},{"./DOMPropertyOperations":785,"./LinkedValueUtils":796,"./ReactDOMComponentTree":806,"./ReactUpdates":850,"./reactProdInvariant":893,"fbjs/lib/invariant":406,"fbjs/lib/warning":413,"object-assign":732}],812:[function(require,module,exports){"use strict";var DOMProperty=require("./DOMProperty");var ReactComponentTreeHook=require("react/lib/ReactComponentTreeHook");var warning=require("fbjs/lib/warning");var warnedProperties={};var rARIA=new RegExp("^(aria)-["+DOMProperty.ATTRIBUTE_NAME_CHAR+"]*$");function validateProperty(tagName,name,debugID){if(warnedProperties.hasOwnProperty(name)&&warnedProperties[name]){return true}if(rARIA.test(name)){var lowerCasedName=name.toLowerCase();var standardName=DOMProperty.getPossibleStandardName.hasOwnProperty(lowerCasedName)?DOMProperty.getPossibleStandardName[lowerCasedName]:null;if(standardName==null){warnedProperties[name]=true;return false}if(name!==standardName){"production"!=="production"?warning(false,"Unknown ARIA attribute %s. Did you mean %s?%s",name,standardName,ReactComponentTreeHook.getStackAddendumByID(debugID)):void 0;warnedProperties[name]=true;return true}}return true}function warnInvalidARIAProps(debugID,element){var invalidProps=[];for(var key in element.props){var isValid=validateProperty(element.type,key,debugID);if(!isValid){invalidProps.push(key)}}var unknownPropString=invalidProps.map(function(prop){return"`"+prop+"`"}).join(", ");if(invalidProps.length===1){"production"!=="production"?warning(false,"Invalid aria prop %s on <%s> tag. "+"For details, see https://fb.me/invalid-aria-prop%s",unknownPropString,element.type,ReactComponentTreeHook.getStackAddendumByID(debugID)):void 0}else if(invalidProps.length>1){"production"!=="production"?warning(false,"Invalid aria props %s on <%s> tag. "+"For details, see https://fb.me/invalid-aria-prop%s",unknownPropString,element.type,ReactComponentTreeHook.getStackAddendumByID(debugID)):void 0}}function handleElement(debugID,element){if(element==null||typeof element.type!=="string"){return}if(element.type.indexOf("-")>=0||element.props.is){return}warnInvalidARIAProps(debugID,element)}var ReactDOMInvalidARIAHook={onBeforeMountComponent:function(debugID,element){if("production"!=="production"){handleElement(debugID,element)}},onBeforeUpdateComponent:function(debugID,element){if("production"!=="production"){handleElement(debugID,element)}}};module.exports=ReactDOMInvalidARIAHook},{"./DOMProperty":784,"fbjs/lib/warning":413,"react/lib/ReactComponentTreeHook":930}],813:[function(require,module,exports){"use strict";var ReactComponentTreeHook=require("react/lib/ReactComponentTreeHook");var warning=require("fbjs/lib/warning");var didWarnValueNull=false;function handleElement(debugID,element){if(element==null){return}if(element.type!=="input"&&element.type!=="textarea"&&element.type!=="select"){return}if(element.props!=null&&element.props.value===null&&!didWarnValueNull){"production"!=="production"?warning(false,"`value` prop on `%s` should not be null. "+"Consider using the empty string to clear the component or `undefined` "+"for uncontrolled components.%s",element.type,ReactComponentTreeHook.getStackAddendumByID(debugID)):void 0;didWarnValueNull=true}}var ReactDOMNullInputValuePropHook={onBeforeMountComponent:function(debugID,element){handleElement(debugID,element)},onBeforeUpdateComponent:function(debugID,element){handleElement(debugID,element)}};module.exports=ReactDOMNullInputValuePropHook},{"fbjs/lib/warning":413,"react/lib/ReactComponentTreeHook":930}],814:[function(require,module,exports){"use strict";var _assign=require("object-assign");var React=require("react/lib/React");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var ReactDOMSelect=require("./ReactDOMSelect");var warning=require("fbjs/lib/warning");var didWarnInvalidOptionChildren=false;function flattenChildren(children){var content="";React.Children.forEach(children,function(child){if(child==null){return}if(typeof child==="string"||typeof child==="number"){content+=child}else if(!didWarnInvalidOptionChildren){didWarnInvalidOptionChildren=true;"production"!=="production"?warning(false,"Only strings and numbers are supported as <option> children."):void 0}});return content}var ReactDOMOption={mountWrapper:function(inst,props,hostParent){if("production"!=="production"){"production"!=="production"?warning(props.selected==null,"Use the `defaultValue` or `value` props on <select> instead of "+"setting `selected` on <option>."):void 0}var selectValue=null;if(hostParent!=null){var selectParent=hostParent;if(selectParent._tag==="optgroup"){selectParent=selectParent._hostParent}if(selectParent!=null&&selectParent._tag==="select"){selectValue=ReactDOMSelect.getSelectValueContext(selectParent)}}var selected=null;if(selectValue!=null){var value;if(props.value!=null){value=props.value+""}else{value=flattenChildren(props.children)}selected=false;if(Array.isArray(selectValue)){for(var i=0;i<selectValue.length;i++){if(""+selectValue[i]===value){selected=true;break}}}else{selected=""+selectValue===value}}inst._wrapperState={selected:selected}},postMountWrapper:function(inst){var props=inst._currentElement.props;if(props.value!=null){var node=ReactDOMComponentTree.getNodeFromInstance(inst);node.setAttribute("value",props.value)}},getHostProps:function(inst,props){var hostProps=_assign({selected:undefined,children:undefined},props);if(inst._wrapperState.selected!=null){hostProps.selected=inst._wrapperState.selected}var content=flattenChildren(props.children);if(content){hostProps.children=content}return hostProps}};module.exports=ReactDOMOption},{"./ReactDOMComponentTree":806,"./ReactDOMSelect":815,"fbjs/lib/warning":413,"object-assign":732,"react/lib/React":926}],815:[function(require,module,exports){"use strict";var _assign=require("object-assign");var LinkedValueUtils=require("./LinkedValueUtils");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var ReactUpdates=require("./ReactUpdates");var warning=require("fbjs/lib/warning");var didWarnValueLink=false;var didWarnValueDefaultValue=false;function updateOptionsIfPendingUpdateAndMounted(){if(this._rootNodeID&&this._wrapperState.pendingUpdate){this._wrapperState.pendingUpdate=false;var props=this._currentElement.props;var value=LinkedValueUtils.getValue(props);if(value!=null){updateOptions(this,Boolean(props.multiple),value)}}}function getDeclarationErrorAddendum(owner){if(owner){var name=owner.getName();if(name){return" Check the render method of `"+name+"`."}}return""}var valuePropNames=["value","defaultValue"];function checkSelectPropTypes(inst,props){var owner=inst._currentElement._owner;LinkedValueUtils.checkPropTypes("select",props,owner);if(props.valueLink!==undefined&&!didWarnValueLink){"production"!=="production"?warning(false,"`valueLink` prop on `select` is deprecated; set `value` and `onChange` instead."):void 0;didWarnValueLink=true}for(var i=0;i<valuePropNames.length;i++){var propName=valuePropNames[i];if(props[propName]==null){continue}var isArray=Array.isArray(props[propName]);if(props.multiple&&!isArray){"production"!=="production"?warning(false,"The `%s` prop supplied to <select> must be an array if "+"`multiple` is true.%s",propName,getDeclarationErrorAddendum(owner)):void 0}else if(!props.multiple&&isArray){"production"!=="production"?warning(false,"The `%s` prop supplied to <select> must be a scalar "+"value if `multiple` is false.%s",propName,getDeclarationErrorAddendum(owner)):void 0}}}function updateOptions(inst,multiple,propValue){var selectedValue,i;var options=ReactDOMComponentTree.getNodeFromInstance(inst).options;if(multiple){selectedValue={};for(i=0;i<propValue.length;i++){selectedValue[""+propValue[i]]=true}for(i=0;i<options.length;i++){var selected=selectedValue.hasOwnProperty(options[i].value);if(options[i].selected!==selected){options[i].selected=selected}}}else{selectedValue=""+propValue;for(i=0;i<options.length;i++){if(options[i].value===selectedValue){options[i].selected=true;return}}if(options.length){options[0].selected=true}}}var ReactDOMSelect={getHostProps:function(inst,props){return _assign({},props,{onChange:inst._wrapperState.onChange,value:undefined})},mountWrapper:function(inst,props){if("production"!=="production"){checkSelectPropTypes(inst,props)}var value=LinkedValueUtils.getValue(props);inst._wrapperState={pendingUpdate:false,initialValue:value!=null?value:props.defaultValue,listeners:null,onChange:_handleChange.bind(inst),wasMultiple:Boolean(props.multiple)};if(props.value!==undefined&&props.defaultValue!==undefined&&!didWarnValueDefaultValue){"production"!=="production"?warning(false,"Select elements must be either controlled or uncontrolled "+"(specify either the value prop, or the defaultValue prop, but not "+"both). Decide between using a controlled or uncontrolled select "+"element and remove one of these props. More info: "+"https://fb.me/react-controlled-components"):void 0;didWarnValueDefaultValue=true}},getSelectValueContext:function(inst){return inst._wrapperState.initialValue},postUpdateWrapper:function(inst){var props=inst._currentElement.props;inst._wrapperState.initialValue=undefined;var wasMultiple=inst._wrapperState.wasMultiple;inst._wrapperState.wasMultiple=Boolean(props.multiple);var value=LinkedValueUtils.getValue(props);if(value!=null){inst._wrapperState.pendingUpdate=false;updateOptions(inst,Boolean(props.multiple),value)}else if(wasMultiple!==Boolean(props.multiple)){if(props.defaultValue!=null){updateOptions(inst,Boolean(props.multiple),props.defaultValue)}else{updateOptions(inst,Boolean(props.multiple),props.multiple?[]:"")}}}};function _handleChange(event){var props=this._currentElement.props;var returnValue=LinkedValueUtils.executeOnChange(props,event);if(this._rootNodeID){this._wrapperState.pendingUpdate=true}ReactUpdates.asap(updateOptionsIfPendingUpdateAndMounted,this);return returnValue}module.exports=ReactDOMSelect},{"./LinkedValueUtils":796,"./ReactDOMComponentTree":806,"./ReactUpdates":850,"fbjs/lib/warning":413,"object-assign":732}],816:[function(require,module,exports){"use strict";var ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment");var getNodeForCharacterOffset=require("./getNodeForCharacterOffset");var getTextContentAccessor=require("./getTextContentAccessor");function isCollapsed(anchorNode,anchorOffset,focusNode,focusOffset){return anchorNode===focusNode&&anchorOffset===focusOffset}function getIEOffsets(node){var selection=document.selection;var selectedRange=selection.createRange();var selectedLength=selectedRange.text.length;var fromStart=selectedRange.duplicate();fromStart.moveToElementText(node);fromStart.setEndPoint("EndToStart",selectedRange);var startOffset=fromStart.text.length;var endOffset=startOffset+selectedLength;return{start:startOffset,end:endOffset}}function getModernOffsets(node){var selection=window.getSelection&&window.getSelection();if(!selection||selection.rangeCount===0){return null}var anchorNode=selection.anchorNode;var anchorOffset=selection.anchorOffset;var focusNode=selection.focusNode;var focusOffset=selection.focusOffset;var currentRange=selection.getRangeAt(0);try{currentRange.startContainer.nodeType;currentRange.endContainer.nodeType}catch(e){return null}var isSelectionCollapsed=isCollapsed(selection.anchorNode,selection.anchorOffset,selection.focusNode,selection.focusOffset);var rangeLength=isSelectionCollapsed?0:currentRange.toString().length;var tempRange=currentRange.cloneRange();tempRange.selectNodeContents(node);tempRange.setEnd(currentRange.startContainer,currentRange.startOffset);var isTempRangeCollapsed=isCollapsed(tempRange.startContainer,tempRange.startOffset,tempRange.endContainer,tempRange.endOffset);var start=isTempRangeCollapsed?0:tempRange.toString().length;var end=start+rangeLength;var detectionRange=document.createRange();detectionRange.setStart(anchorNode,anchorOffset);detectionRange.setEnd(focusNode,focusOffset);var isBackward=detectionRange.collapsed;return{start:isBackward?end:start,end:isBackward?start:end}}function setIEOffsets(node,offsets){var range=document.selection.createRange().duplicate();var start,end;if(offsets.end===undefined){start=offsets.start;end=start}else if(offsets.start>offsets.end){start=offsets.end;end=offsets.start}else{start=offsets.start;end=offsets.end}range.moveToElementText(node);range.moveStart("character",start);range.setEndPoint("EndToStart",range);range.moveEnd("character",end-start);range.select()}function setModernOffsets(node,offsets){if(!window.getSelection){return}var selection=window.getSelection();var length=node[getTextContentAccessor()].length;var start=Math.min(offsets.start,length);var end=offsets.end===undefined?start:Math.min(offsets.end,length);if(!selection.extend&&start>end){var temp=end;end=start;start=temp}var startMarker=getNodeForCharacterOffset(node,start);var endMarker=getNodeForCharacterOffset(node,end);if(startMarker&&endMarker){var range=document.createRange();range.setStart(startMarker.node,startMarker.offset);selection.removeAllRanges();if(start>end){selection.addRange(range);selection.extend(endMarker.node,endMarker.offset)}else{range.setEnd(endMarker.node,endMarker.offset);selection.addRange(range)}}}var useIEOffsets=ExecutionEnvironment.canUseDOM&&"selection"in document&&!("getSelection"in window);var ReactDOMSelection={getOffsets:useIEOffsets?getIEOffsets:getModernOffsets,setOffsets:useIEOffsets?setIEOffsets:setModernOffsets};module.exports=ReactDOMSelection},{"./getNodeForCharacterOffset":886,"./getTextContentAccessor":887,"fbjs/lib/ExecutionEnvironment":392}],817:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant"),_assign=require("object-assign");var DOMChildrenOperations=require("./DOMChildrenOperations");var DOMLazyTree=require("./DOMLazyTree");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var escapeTextContentForBrowser=require("./escapeTextContentForBrowser");var invariant=require("fbjs/lib/invariant");var validateDOMNesting=require("./validateDOMNesting");var ReactDOMTextComponent=function(text){this._currentElement=text;this._stringText=""+text;this._hostNode=null;this._hostParent=null;this._domID=0;this._mountIndex=0;this._closingComment=null;this._commentNodes=null};_assign(ReactDOMTextComponent.prototype,{mountComponent:function(transaction,hostParent,hostContainerInfo,context){if("production"!=="production"){var parentInfo;if(hostParent!=null){parentInfo=hostParent._ancestorInfo}else if(hostContainerInfo!=null){parentInfo=hostContainerInfo._ancestorInfo}if(parentInfo){validateDOMNesting(null,this._stringText,this,parentInfo)}}var domID=hostContainerInfo._idCounter++;var openingValue=" react-text: "+domID+" ";var closingValue=" /react-text ";this._domID=domID;this._hostParent=hostParent;if(transaction.useCreateElement){var ownerDocument=hostContainerInfo._ownerDocument;var openingComment=ownerDocument.createComment(openingValue);var closingComment=ownerDocument.createComment(closingValue);var lazyTree=DOMLazyTree(ownerDocument.createDocumentFragment());DOMLazyTree.queueChild(lazyTree,DOMLazyTree(openingComment));if(this._stringText){DOMLazyTree.queueChild(lazyTree,DOMLazyTree(ownerDocument.createTextNode(this._stringText)))}DOMLazyTree.queueChild(lazyTree,DOMLazyTree(closingComment));ReactDOMComponentTree.precacheNode(this,openingComment);this._closingComment=closingComment;return lazyTree}else{var escapedText=escapeTextContentForBrowser(this._stringText);if(transaction.renderToStaticMarkup){return escapedText}return"<!--"+openingValue+"-->"+escapedText+"<!--"+closingValue+"-->"}},receiveComponent:function(nextText,transaction){if(nextText!==this._currentElement){this._currentElement=nextText;var nextStringText=""+nextText;if(nextStringText!==this._stringText){this._stringText=nextStringText;var commentNodes=this.getHostNode();DOMChildrenOperations.replaceDelimitedText(commentNodes[0],commentNodes[1],nextStringText)}}},getHostNode:function(){var hostNode=this._commentNodes;if(hostNode){return hostNode}if(!this._closingComment){var openingComment=ReactDOMComponentTree.getNodeFromInstance(this);var node=openingComment.nextSibling;while(true){!(node!=null)?"production"!=="production"?invariant(false,"Missing closing comment for text component %s",this._domID):_prodInvariant("67",this._domID):void 0;if(node.nodeType===8&&node.nodeValue===" /react-text "){this._closingComment=node;break}node=node.nextSibling}}hostNode=[this._hostNode,this._closingComment];this._commentNodes=hostNode;return hostNode},unmountComponent:function(){this._closingComment=null;this._commentNodes=null;ReactDOMComponentTree.uncacheNode(this)}});module.exports=ReactDOMTextComponent},{"./DOMChildrenOperations":781,"./DOMLazyTree":782,"./ReactDOMComponentTree":806,"./escapeTextContentForBrowser":875,"./reactProdInvariant":893,"./validateDOMNesting":899,"fbjs/lib/invariant":406,"object-assign":732}],818:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant"),_assign=require("object-assign");var LinkedValueUtils=require("./LinkedValueUtils");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var ReactUpdates=require("./ReactUpdates");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");var didWarnValueLink=false;
var didWarnValDefaultVal=false;function forceUpdateIfMounted(){if(this._rootNodeID){ReactDOMTextarea.updateWrapper(this)}}var ReactDOMTextarea={getHostProps:function(inst,props){!(props.dangerouslySetInnerHTML==null)?"production"!=="production"?invariant(false,"`dangerouslySetInnerHTML` does not make sense on <textarea>."):_prodInvariant("91"):void 0;var hostProps=_assign({},props,{value:undefined,defaultValue:undefined,children:""+inst._wrapperState.initialValue,onChange:inst._wrapperState.onChange});return hostProps},mountWrapper:function(inst,props){if("production"!=="production"){LinkedValueUtils.checkPropTypes("textarea",props,inst._currentElement._owner);if(props.valueLink!==undefined&&!didWarnValueLink){"production"!=="production"?warning(false,"`valueLink` prop on `textarea` is deprecated; set `value` and `onChange` instead."):void 0;didWarnValueLink=true}if(props.value!==undefined&&props.defaultValue!==undefined&&!didWarnValDefaultVal){"production"!=="production"?warning(false,"Textarea elements must be either controlled or uncontrolled "+"(specify either the value prop, or the defaultValue prop, but not "+"both). Decide between using a controlled or uncontrolled textarea "+"and remove one of these props. More info: "+"https://fb.me/react-controlled-components"):void 0;didWarnValDefaultVal=true}}var value=LinkedValueUtils.getValue(props);var initialValue=value;if(value==null){var defaultValue=props.defaultValue;var children=props.children;if(children!=null){if("production"!=="production"){"production"!=="production"?warning(false,"Use the `defaultValue` or `value` props instead of setting "+"children on <textarea>."):void 0}!(defaultValue==null)?"production"!=="production"?invariant(false,"If you supply `defaultValue` on a <textarea>, do not pass children."):_prodInvariant("92"):void 0;if(Array.isArray(children)){!(children.length<=1)?"production"!=="production"?invariant(false,"<textarea> can only have at most one child."):_prodInvariant("93"):void 0;children=children[0]}defaultValue=""+children}if(defaultValue==null){defaultValue=""}initialValue=defaultValue}inst._wrapperState={initialValue:""+initialValue,listeners:null,onChange:_handleChange.bind(inst)}},updateWrapper:function(inst){var props=inst._currentElement.props;var node=ReactDOMComponentTree.getNodeFromInstance(inst);var value=LinkedValueUtils.getValue(props);if(value!=null){var newValue=""+value;if(newValue!==node.value){node.value=newValue}if(props.defaultValue==null){node.defaultValue=newValue}}if(props.defaultValue!=null){node.defaultValue=props.defaultValue}},postMountWrapper:function(inst){var node=ReactDOMComponentTree.getNodeFromInstance(inst);var textContent=node.textContent;if(textContent===inst._wrapperState.initialValue){node.value=textContent}}};function _handleChange(event){var props=this._currentElement.props;var returnValue=LinkedValueUtils.executeOnChange(props,event);ReactUpdates.asap(forceUpdateIfMounted,this);return returnValue}module.exports=ReactDOMTextarea},{"./LinkedValueUtils":796,"./ReactDOMComponentTree":806,"./ReactUpdates":850,"./reactProdInvariant":893,"fbjs/lib/invariant":406,"fbjs/lib/warning":413,"object-assign":732}],819:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var invariant=require("fbjs/lib/invariant");function getLowestCommonAncestor(instA,instB){!("_hostNode"in instA)?"production"!=="production"?invariant(false,"getNodeFromInstance: Invalid argument."):_prodInvariant("33"):void 0;!("_hostNode"in instB)?"production"!=="production"?invariant(false,"getNodeFromInstance: Invalid argument."):_prodInvariant("33"):void 0;var depthA=0;for(var tempA=instA;tempA;tempA=tempA._hostParent){depthA++}var depthB=0;for(var tempB=instB;tempB;tempB=tempB._hostParent){depthB++}while(depthA-depthB>0){instA=instA._hostParent;depthA--}while(depthB-depthA>0){instB=instB._hostParent;depthB--}var depth=depthA;while(depth--){if(instA===instB){return instA}instA=instA._hostParent;instB=instB._hostParent}return null}function isAncestor(instA,instB){!("_hostNode"in instA)?"production"!=="production"?invariant(false,"isAncestor: Invalid argument."):_prodInvariant("35"):void 0;!("_hostNode"in instB)?"production"!=="production"?invariant(false,"isAncestor: Invalid argument."):_prodInvariant("35"):void 0;while(instB){if(instB===instA){return true}instB=instB._hostParent}return false}function getParentInstance(inst){!("_hostNode"in inst)?"production"!=="production"?invariant(false,"getParentInstance: Invalid argument."):_prodInvariant("36"):void 0;return inst._hostParent}function traverseTwoPhase(inst,fn,arg){var path=[];while(inst){path.push(inst);inst=inst._hostParent}var i;for(i=path.length;i-- >0;){fn(path[i],"captured",arg)}for(i=0;i<path.length;i++){fn(path[i],"bubbled",arg)}}function traverseEnterLeave(from,to,fn,argFrom,argTo){var common=from&&to?getLowestCommonAncestor(from,to):null;var pathFrom=[];while(from&&from!==common){pathFrom.push(from);from=from._hostParent}var pathTo=[];while(to&&to!==common){pathTo.push(to);to=to._hostParent}var i;for(i=0;i<pathFrom.length;i++){fn(pathFrom[i],"bubbled",argFrom)}for(i=pathTo.length;i-- >0;){fn(pathTo[i],"captured",argTo)}}module.exports={isAncestor:isAncestor,getLowestCommonAncestor:getLowestCommonAncestor,getParentInstance:getParentInstance,traverseTwoPhase:traverseTwoPhase,traverseEnterLeave:traverseEnterLeave}},{"./reactProdInvariant":893,"fbjs/lib/invariant":406}],820:[function(require,module,exports){"use strict";var DOMProperty=require("./DOMProperty");var EventPluginRegistry=require("./EventPluginRegistry");var ReactComponentTreeHook=require("react/lib/ReactComponentTreeHook");var warning=require("fbjs/lib/warning");if("production"!=="production"){var reactProps={children:true,dangerouslySetInnerHTML:true,key:true,ref:true,autoFocus:true,defaultValue:true,valueLink:true,defaultChecked:true,checkedLink:true,innerHTML:true,suppressContentEditableWarning:true,onFocusIn:true,onFocusOut:true};var warnedProperties={};var validateProperty=function(tagName,name,debugID){if(DOMProperty.properties.hasOwnProperty(name)||DOMProperty.isCustomAttribute(name)){return true}if(reactProps.hasOwnProperty(name)&&reactProps[name]||warnedProperties.hasOwnProperty(name)&&warnedProperties[name]){return true}if(EventPluginRegistry.registrationNameModules.hasOwnProperty(name)){return true}warnedProperties[name]=true;var lowerCasedName=name.toLowerCase();var standardName=DOMProperty.isCustomAttribute(lowerCasedName)?lowerCasedName:DOMProperty.getPossibleStandardName.hasOwnProperty(lowerCasedName)?DOMProperty.getPossibleStandardName[lowerCasedName]:null;var registrationName=EventPluginRegistry.possibleRegistrationNames.hasOwnProperty(lowerCasedName)?EventPluginRegistry.possibleRegistrationNames[lowerCasedName]:null;if(standardName!=null){"production"!=="production"?warning(false,"Unknown DOM property %s. Did you mean %s?%s",name,standardName,ReactComponentTreeHook.getStackAddendumByID(debugID)):void 0;return true}else if(registrationName!=null){"production"!=="production"?warning(false,"Unknown event handler property %s. Did you mean `%s`?%s",name,registrationName,ReactComponentTreeHook.getStackAddendumByID(debugID)):void 0;return true}else{return false}}}var warnUnknownProperties=function(debugID,element){var unknownProps=[];for(var key in element.props){var isValid=validateProperty(element.type,key,debugID);if(!isValid){unknownProps.push(key)}}var unknownPropString=unknownProps.map(function(prop){return"`"+prop+"`"}).join(", ");if(unknownProps.length===1){"production"!=="production"?warning(false,"Unknown prop %s on <%s> tag. Remove this prop from the element. "+"For details, see https://fb.me/react-unknown-prop%s",unknownPropString,element.type,ReactComponentTreeHook.getStackAddendumByID(debugID)):void 0}else if(unknownProps.length>1){"production"!=="production"?warning(false,"Unknown props %s on <%s> tag. Remove these props from the element. "+"For details, see https://fb.me/react-unknown-prop%s",unknownPropString,element.type,ReactComponentTreeHook.getStackAddendumByID(debugID)):void 0}};function handleElement(debugID,element){if(element==null||typeof element.type!=="string"){return}if(element.type.indexOf("-")>=0||element.props.is){return}warnUnknownProperties(debugID,element)}var ReactDOMUnknownPropertyHook={onBeforeMountComponent:function(debugID,element){handleElement(debugID,element)},onBeforeUpdateComponent:function(debugID,element){handleElement(debugID,element)}};module.exports=ReactDOMUnknownPropertyHook},{"./DOMProperty":784,"./EventPluginRegistry":790,"fbjs/lib/warning":413,"react/lib/ReactComponentTreeHook":930}],821:[function(require,module,exports){"use strict";var ReactInvalidSetStateWarningHook=require("./ReactInvalidSetStateWarningHook");var ReactHostOperationHistoryHook=require("./ReactHostOperationHistoryHook");var ReactComponentTreeHook=require("react/lib/ReactComponentTreeHook");var ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment");var performanceNow=require("fbjs/lib/performanceNow");var warning=require("fbjs/lib/warning");var hooks=[];var didHookThrowForEvent={};function callHook(event,fn,context,arg1,arg2,arg3,arg4,arg5){try{fn.call(context,arg1,arg2,arg3,arg4,arg5)}catch(e){"production"!=="production"?warning(didHookThrowForEvent[event],"Exception thrown by hook while handling %s: %s",event,e+"\n"+e.stack):void 0;didHookThrowForEvent[event]=true}}function emitEvent(event,arg1,arg2,arg3,arg4,arg5){for(var i=0;i<hooks.length;i++){var hook=hooks[i];var fn=hook[event];if(fn){callHook(event,fn,hook,arg1,arg2,arg3,arg4,arg5)}}}var isProfiling=false;var flushHistory=[];var lifeCycleTimerStack=[];var currentFlushNesting=0;var currentFlushMeasurements=[];var currentFlushStartTime=0;var currentTimerDebugID=null;var currentTimerStartTime=0;var currentTimerNestedFlushDuration=0;var currentTimerType=null;var lifeCycleTimerHasWarned=false;function clearHistory(){ReactComponentTreeHook.purgeUnmountedComponents();ReactHostOperationHistoryHook.clearHistory()}function getTreeSnapshot(registeredIDs){return registeredIDs.reduce(function(tree,id){var ownerID=ReactComponentTreeHook.getOwnerID(id);var parentID=ReactComponentTreeHook.getParentID(id);tree[id]={displayName:ReactComponentTreeHook.getDisplayName(id),text:ReactComponentTreeHook.getText(id),updateCount:ReactComponentTreeHook.getUpdateCount(id),childIDs:ReactComponentTreeHook.getChildIDs(id),ownerID:ownerID||parentID&&ReactComponentTreeHook.getOwnerID(parentID)||0,parentID:parentID};return tree},{})}function resetMeasurements(){var previousStartTime=currentFlushStartTime;var previousMeasurements=currentFlushMeasurements;var previousOperations=ReactHostOperationHistoryHook.getHistory();if(currentFlushNesting===0){currentFlushStartTime=0;currentFlushMeasurements=[];clearHistory();return}if(previousMeasurements.length||previousOperations.length){var registeredIDs=ReactComponentTreeHook.getRegisteredIDs();flushHistory.push({duration:performanceNow()-previousStartTime,measurements:previousMeasurements||[],operations:previousOperations||[],treeSnapshot:getTreeSnapshot(registeredIDs)})}clearHistory();currentFlushStartTime=performanceNow();currentFlushMeasurements=[]}function checkDebugID(debugID){var allowRoot=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(allowRoot&&debugID===0){return}if(!debugID){"production"!=="production"?warning(false,"ReactDebugTool: debugID may not be empty."):void 0}}function beginLifeCycleTimer(debugID,timerType){if(currentFlushNesting===0){return}if(currentTimerType&&!lifeCycleTimerHasWarned){"production"!=="production"?warning(false,"There is an internal error in the React performance measurement code. "+"Did not expect %s timer to start while %s timer is still in "+"progress for %s instance.",timerType,currentTimerType||"no",debugID===currentTimerDebugID?"the same":"another"):void 0;lifeCycleTimerHasWarned=true}currentTimerStartTime=performanceNow();currentTimerNestedFlushDuration=0;currentTimerDebugID=debugID;currentTimerType=timerType}function endLifeCycleTimer(debugID,timerType){if(currentFlushNesting===0){return}if(currentTimerType!==timerType&&!lifeCycleTimerHasWarned){"production"!=="production"?warning(false,"There is an internal error in the React performance measurement code. "+"We did not expect %s timer to stop while %s timer is still in "+"progress for %s instance. Please report this as a bug in React.",timerType,currentTimerType||"no",debugID===currentTimerDebugID?"the same":"another"):void 0;lifeCycleTimerHasWarned=true}if(isProfiling){currentFlushMeasurements.push({timerType:timerType,instanceID:debugID,duration:performanceNow()-currentTimerStartTime-currentTimerNestedFlushDuration})}currentTimerStartTime=0;currentTimerNestedFlushDuration=0;currentTimerDebugID=null;currentTimerType=null}function pauseCurrentLifeCycleTimer(){var currentTimer={startTime:currentTimerStartTime,nestedFlushStartTime:performanceNow(),debugID:currentTimerDebugID,timerType:currentTimerType};lifeCycleTimerStack.push(currentTimer);currentTimerStartTime=0;currentTimerNestedFlushDuration=0;currentTimerDebugID=null;currentTimerType=null}function resumeCurrentLifeCycleTimer(){var _lifeCycleTimerStack$=lifeCycleTimerStack.pop(),startTime=_lifeCycleTimerStack$.startTime,nestedFlushStartTime=_lifeCycleTimerStack$.nestedFlushStartTime,debugID=_lifeCycleTimerStack$.debugID,timerType=_lifeCycleTimerStack$.timerType;var nestedFlushDuration=performanceNow()-nestedFlushStartTime;currentTimerStartTime=startTime;currentTimerNestedFlushDuration+=nestedFlushDuration;currentTimerDebugID=debugID;currentTimerType=timerType}var lastMarkTimeStamp=0;var canUsePerformanceMeasure=typeof performance!=="undefined"&&typeof performance.mark==="function"&&typeof performance.clearMarks==="function"&&typeof performance.measure==="function"&&typeof performance.clearMeasures==="function";function shouldMark(debugID){if(!isProfiling||!canUsePerformanceMeasure){return false}var element=ReactComponentTreeHook.getElement(debugID);if(element==null||typeof element!=="object"){return false}var isHostElement=typeof element.type==="string";if(isHostElement){return false}return true}function markBegin(debugID,markType){if(!shouldMark(debugID)){return}var markName=debugID+"::"+markType;lastMarkTimeStamp=performanceNow();performance.mark(markName)}function markEnd(debugID,markType){if(!shouldMark(debugID)){return}var markName=debugID+"::"+markType;var displayName=ReactComponentTreeHook.getDisplayName(debugID)||"Unknown";var timeStamp=performanceNow();if(timeStamp-lastMarkTimeStamp>.1){var measurementName=displayName+" ["+markType+"]";performance.measure(measurementName,markName)}performance.clearMarks(markName);performance.clearMeasures(measurementName)}var ReactDebugTool={addHook:function(hook){hooks.push(hook)},removeHook:function(hook){for(var i=0;i<hooks.length;i++){if(hooks[i]===hook){hooks.splice(i,1);i--}}},isProfiling:function(){return isProfiling},beginProfiling:function(){if(isProfiling){return}isProfiling=true;flushHistory.length=0;resetMeasurements();ReactDebugTool.addHook(ReactHostOperationHistoryHook)},endProfiling:function(){if(!isProfiling){return}isProfiling=false;resetMeasurements();ReactDebugTool.removeHook(ReactHostOperationHistoryHook)},getFlushHistory:function(){return flushHistory},onBeginFlush:function(){currentFlushNesting++;resetMeasurements();pauseCurrentLifeCycleTimer();emitEvent("onBeginFlush")},onEndFlush:function(){resetMeasurements();currentFlushNesting--;resumeCurrentLifeCycleTimer();emitEvent("onEndFlush")},onBeginLifeCycleTimer:function(debugID,timerType){checkDebugID(debugID);emitEvent("onBeginLifeCycleTimer",debugID,timerType);markBegin(debugID,timerType);beginLifeCycleTimer(debugID,timerType)},onEndLifeCycleTimer:function(debugID,timerType){checkDebugID(debugID);endLifeCycleTimer(debugID,timerType);markEnd(debugID,timerType);emitEvent("onEndLifeCycleTimer",debugID,timerType)},onBeginProcessingChildContext:function(){emitEvent("onBeginProcessingChildContext")},onEndProcessingChildContext:function(){emitEvent("onEndProcessingChildContext")},onHostOperation:function(operation){checkDebugID(operation.instanceID);emitEvent("onHostOperation",operation)},onSetState:function(){emitEvent("onSetState")},onSetChildren:function(debugID,childDebugIDs){checkDebugID(debugID);childDebugIDs.forEach(checkDebugID);emitEvent("onSetChildren",debugID,childDebugIDs)},onBeforeMountComponent:function(debugID,element,parentDebugID){checkDebugID(debugID);checkDebugID(parentDebugID,true);emitEvent("onBeforeMountComponent",debugID,element,parentDebugID);markBegin(debugID,"mount")},onMountComponent:function(debugID){checkDebugID(debugID);markEnd(debugID,"mount");emitEvent("onMountComponent",debugID)},onBeforeUpdateComponent:function(debugID,element){checkDebugID(debugID);emitEvent("onBeforeUpdateComponent",debugID,element);markBegin(debugID,"update")},onUpdateComponent:function(debugID){checkDebugID(debugID);markEnd(debugID,"update");emitEvent("onUpdateComponent",debugID)},onBeforeUnmountComponent:function(debugID){checkDebugID(debugID);emitEvent("onBeforeUnmountComponent",debugID);markBegin(debugID,"unmount")},onUnmountComponent:function(debugID){checkDebugID(debugID);markEnd(debugID,"unmount");emitEvent("onUnmountComponent",debugID)},onTestEvent:function(){emitEvent("onTestEvent")}};ReactDebugTool.addDevtool=ReactDebugTool.addHook;ReactDebugTool.removeDevtool=ReactDebugTool.removeHook;ReactDebugTool.addHook(ReactInvalidSetStateWarningHook);ReactDebugTool.addHook(ReactComponentTreeHook);var url=ExecutionEnvironment.canUseDOM&&window.location.href||"";if(/[?&]react_perf\b/.test(url)){ReactDebugTool.beginProfiling()}module.exports=ReactDebugTool},{"./ReactHostOperationHistoryHook":831,"./ReactInvalidSetStateWarningHook":836,"fbjs/lib/ExecutionEnvironment":392,"fbjs/lib/performanceNow":411,"fbjs/lib/warning":413,"react/lib/ReactComponentTreeHook":930}],822:[function(require,module,exports){"use strict";var _assign=require("object-assign");var ReactUpdates=require("./ReactUpdates");var Transaction=require("./Transaction");var emptyFunction=require("fbjs/lib/emptyFunction");var RESET_BATCHED_UPDATES={initialize:emptyFunction,close:function(){ReactDefaultBatchingStrategy.isBatchingUpdates=false}};var FLUSH_BATCHED_UPDATES={initialize:emptyFunction,close:ReactUpdates.flushBatchedUpdates.bind(ReactUpdates)};var TRANSACTION_WRAPPERS=[FLUSH_BATCHED_UPDATES,RESET_BATCHED_UPDATES];function ReactDefaultBatchingStrategyTransaction(){this.reinitializeTransaction()}_assign(ReactDefaultBatchingStrategyTransaction.prototype,Transaction,{getTransactionWrappers:function(){return TRANSACTION_WRAPPERS}});var transaction=new ReactDefaultBatchingStrategyTransaction;var ReactDefaultBatchingStrategy={isBatchingUpdates:false,batchedUpdates:function(callback,a,b,c,d,e){var alreadyBatchingUpdates=ReactDefaultBatchingStrategy.isBatchingUpdates;ReactDefaultBatchingStrategy.isBatchingUpdates=true;if(alreadyBatchingUpdates){return callback(a,b,c,d,e)}else{return transaction.perform(callback,null,a,b,c,d,e)}}};module.exports=ReactDefaultBatchingStrategy},{"./ReactUpdates":850,"./Transaction":868,"fbjs/lib/emptyFunction":398,"object-assign":732}],823:[function(require,module,exports){"use strict";var ARIADOMPropertyConfig=require("./ARIADOMPropertyConfig");var BeforeInputEventPlugin=require("./BeforeInputEventPlugin");var ChangeEventPlugin=require("./ChangeEventPlugin");var DefaultEventPluginOrder=require("./DefaultEventPluginOrder");var EnterLeaveEventPlugin=require("./EnterLeaveEventPlugin");var HTMLDOMPropertyConfig=require("./HTMLDOMPropertyConfig");var ReactComponentBrowserEnvironment=require("./ReactComponentBrowserEnvironment");var ReactDOMComponent=require("./ReactDOMComponent");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var ReactDOMEmptyComponent=require("./ReactDOMEmptyComponent");var ReactDOMTreeTraversal=require("./ReactDOMTreeTraversal");var ReactDOMTextComponent=require("./ReactDOMTextComponent");var ReactDefaultBatchingStrategy=require("./ReactDefaultBatchingStrategy");var ReactEventListener=require("./ReactEventListener");var ReactInjection=require("./ReactInjection");var ReactReconcileTransaction=require("./ReactReconcileTransaction");var SVGDOMPropertyConfig=require("./SVGDOMPropertyConfig");var SelectEventPlugin=require("./SelectEventPlugin");var SimpleEventPlugin=require("./SimpleEventPlugin");var alreadyInjected=false;function inject(){if(alreadyInjected){return}alreadyInjected=true;ReactInjection.EventEmitter.injectReactEventListener(ReactEventListener);ReactInjection.EventPluginHub.injectEventPluginOrder(DefaultEventPluginOrder);ReactInjection.EventPluginUtils.injectComponentTree(ReactDOMComponentTree);ReactInjection.EventPluginUtils.injectTreeTraversal(ReactDOMTreeTraversal);ReactInjection.EventPluginHub.injectEventPluginsByName({SimpleEventPlugin:SimpleEventPlugin,EnterLeaveEventPlugin:EnterLeaveEventPlugin,ChangeEventPlugin:ChangeEventPlugin,SelectEventPlugin:SelectEventPlugin,BeforeInputEventPlugin:BeforeInputEventPlugin});ReactInjection.HostComponent.injectGenericComponentClass(ReactDOMComponent);ReactInjection.HostComponent.injectTextComponentClass(ReactDOMTextComponent);ReactInjection.DOMProperty.injectDOMPropertyConfig(ARIADOMPropertyConfig);ReactInjection.DOMProperty.injectDOMPropertyConfig(HTMLDOMPropertyConfig);ReactInjection.DOMProperty.injectDOMPropertyConfig(SVGDOMPropertyConfig);ReactInjection.EmptyComponent.injectEmptyComponentFactory(function(instantiate){return new ReactDOMEmptyComponent(instantiate)});ReactInjection.Updates.injectReconcileTransaction(ReactReconcileTransaction);ReactInjection.Updates.injectBatchingStrategy(ReactDefaultBatchingStrategy);ReactInjection.Component.injectEnvironment(ReactComponentBrowserEnvironment)}module.exports={inject:inject}},{"./ARIADOMPropertyConfig":774,"./BeforeInputEventPlugin":776,"./ChangeEventPlugin":780,"./DefaultEventPluginOrder":787,"./EnterLeaveEventPlugin":788,"./HTMLDOMPropertyConfig":794,"./ReactComponentBrowserEnvironment":800,"./ReactDOMComponent":804,"./ReactDOMComponentTree":806,"./ReactDOMEmptyComponent":808,"./ReactDOMTextComponent":817,"./ReactDOMTreeTraversal":819,"./ReactDefaultBatchingStrategy":822,"./ReactEventListener":828,"./ReactInjection":832,"./ReactReconcileTransaction":844,"./SVGDOMPropertyConfig":852,"./SelectEventPlugin":853,"./SimpleEventPlugin":854}],824:[function(require,module,exports){"use strict";var REACT_ELEMENT_TYPE=typeof Symbol==="function"&&Symbol["for"]&&Symbol["for"]("react.element")||60103;module.exports=REACT_ELEMENT_TYPE},{}],825:[function(require,module,exports){"use strict";var emptyComponentFactory;var ReactEmptyComponentInjection={injectEmptyComponentFactory:function(factory){emptyComponentFactory=factory}};var ReactEmptyComponent={create:function(instantiate){return emptyComponentFactory(instantiate)}};ReactEmptyComponent.injection=ReactEmptyComponentInjection;module.exports=ReactEmptyComponent},{}],826:[function(require,module,exports){"use strict";var caughtError=null;function invokeGuardedCallback(name,func,a){try{func(a)}catch(x){if(caughtError===null){caughtError=x}}}var ReactErrorUtils={invokeGuardedCallback:invokeGuardedCallback,invokeGuardedCallbackWithCatch:invokeGuardedCallback,rethrowCaughtError:function(){if(caughtError){var error=caughtError;caughtError=null;throw error}}};if("production"!=="production"){if(typeof window!=="undefined"&&typeof window.dispatchEvent==="function"&&typeof document!=="undefined"&&typeof document.createEvent==="function"){var fakeNode=document.createElement("react");ReactErrorUtils.invokeGuardedCallback=function(name,func,a){var boundFunc=func.bind(null,a);var evtType="react-"+name;fakeNode.addEventListener(evtType,boundFunc,false);var evt=document.createEvent("Event");evt.initEvent(evtType,false,false);fakeNode.dispatchEvent(evt);fakeNode.removeEventListener(evtType,boundFunc,false)}}}module.exports=ReactErrorUtils},{}],827:[function(require,module,exports){"use strict";var EventPluginHub=require("./EventPluginHub");function runEventQueueInBatch(events){EventPluginHub.enqueueEvents(events);EventPluginHub.processEventQueue(false)}var ReactEventEmitterMixin={handleTopLevel:function(topLevelType,targetInst,nativeEvent,nativeEventTarget){var events=EventPluginHub.extractEvents(topLevelType,targetInst,nativeEvent,nativeEventTarget);runEventQueueInBatch(events)}};module.exports=ReactEventEmitterMixin},{"./EventPluginHub":789}],828:[function(require,module,exports){"use strict";var _assign=require("object-assign");var EventListener=require("fbjs/lib/EventListener");var ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment");var PooledClass=require("./PooledClass");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var ReactUpdates=require("./ReactUpdates");var getEventTarget=require("./getEventTarget");var getUnboundedScrollPosition=require("fbjs/lib/getUnboundedScrollPosition");function findParent(inst){while(inst._hostParent){inst=inst._hostParent}var rootNode=ReactDOMComponentTree.getNodeFromInstance(inst);var container=rootNode.parentNode;return ReactDOMComponentTree.getClosestInstanceFromNode(container)}function TopLevelCallbackBookKeeping(topLevelType,nativeEvent){this.topLevelType=topLevelType;this.nativeEvent=nativeEvent;this.ancestors=[]}_assign(TopLevelCallbackBookKeeping.prototype,{destructor:function(){this.topLevelType=null;this.nativeEvent=null;this.ancestors.length=0}});PooledClass.addPoolingTo(TopLevelCallbackBookKeeping,PooledClass.twoArgumentPooler);function handleTopLevelImpl(bookKeeping){var nativeEventTarget=getEventTarget(bookKeeping.nativeEvent);var targetInst=ReactDOMComponentTree.getClosestInstanceFromNode(nativeEventTarget);var ancestor=targetInst;do{bookKeeping.ancestors.push(ancestor);ancestor=ancestor&&findParent(ancestor)}while(ancestor);for(var i=0;i<bookKeeping.ancestors.length;i++){targetInst=bookKeeping.ancestors[i];ReactEventListener._handleTopLevel(bookKeeping.topLevelType,targetInst,bookKeeping.nativeEvent,getEventTarget(bookKeeping.nativeEvent))}}function scrollValueMonitor(cb){var scrollPosition=getUnboundedScrollPosition(window);cb(scrollPosition)}var ReactEventListener={_enabled:true,_handleTopLevel:null,WINDOW_HANDLE:ExecutionEnvironment.canUseDOM?window:null,setHandleTopLevel:function(handleTopLevel){ReactEventListener._handleTopLevel=handleTopLevel},setEnabled:function(enabled){ReactEventListener._enabled=!!enabled},isEnabled:function(){return ReactEventListener._enabled},trapBubbledEvent:function(topLevelType,handlerBaseName,element){if(!element){return null}return EventListener.listen(element,handlerBaseName,ReactEventListener.dispatchEvent.bind(null,topLevelType))},trapCapturedEvent:function(topLevelType,handlerBaseName,element){if(!element){return null}return EventListener.capture(element,handlerBaseName,ReactEventListener.dispatchEvent.bind(null,topLevelType))},monitorScrollValue:function(refresh){var callback=scrollValueMonitor.bind(null,refresh);EventListener.listen(window,"scroll",callback)},dispatchEvent:function(topLevelType,nativeEvent){if(!ReactEventListener._enabled){return}var bookKeeping=TopLevelCallbackBookKeeping.getPooled(topLevelType,nativeEvent);try{ReactUpdates.batchedUpdates(handleTopLevelImpl,bookKeeping)}finally{TopLevelCallbackBookKeeping.release(bookKeeping)}}};module.exports=ReactEventListener},{"./PooledClass":797,"./ReactDOMComponentTree":806,"./ReactUpdates":850,"./getEventTarget":882,"fbjs/lib/EventListener":391,"fbjs/lib/ExecutionEnvironment":392,"fbjs/lib/getUnboundedScrollPosition":403,"object-assign":732}],829:[function(require,module,exports){"use strict";var ReactFeatureFlags={logTopLevelRenders:false};module.exports=ReactFeatureFlags},{}],830:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var invariant=require("fbjs/lib/invariant");var genericComponentClass=null;var textComponentClass=null;var ReactHostComponentInjection={injectGenericComponentClass:function(componentClass){genericComponentClass=componentClass},injectTextComponentClass:function(componentClass){textComponentClass=componentClass}};function createInternalComponent(element){!genericComponentClass?"production"!=="production"?invariant(false,"There is no registered component for the tag %s",element.type):_prodInvariant("111",element.type):void 0;return new genericComponentClass(element)}function createInstanceForText(text){return new textComponentClass(text)}function isTextComponent(component){return component instanceof textComponentClass}var ReactHostComponent={createInternalComponent:createInternalComponent,createInstanceForText:createInstanceForText,isTextComponent:isTextComponent,injection:ReactHostComponentInjection};module.exports=ReactHostComponent},{"./reactProdInvariant":893,"fbjs/lib/invariant":406}],831:[function(require,module,exports){"use strict";var history=[];var ReactHostOperationHistoryHook={onHostOperation:function(operation){history.push(operation)},clearHistory:function(){if(ReactHostOperationHistoryHook._preventClearing){return}history=[]},getHistory:function(){return history}};module.exports=ReactHostOperationHistoryHook},{}],832:[function(require,module,exports){"use strict";var DOMProperty=require("./DOMProperty");var EventPluginHub=require("./EventPluginHub");var EventPluginUtils=require("./EventPluginUtils");var ReactComponentEnvironment=require("./ReactComponentEnvironment");var ReactEmptyComponent=require("./ReactEmptyComponent");var ReactBrowserEventEmitter=require("./ReactBrowserEventEmitter");var ReactHostComponent=require("./ReactHostComponent");var ReactUpdates=require("./ReactUpdates");var ReactInjection={Component:ReactComponentEnvironment.injection,DOMProperty:DOMProperty.injection,EmptyComponent:ReactEmptyComponent.injection,EventPluginHub:EventPluginHub.injection,EventPluginUtils:EventPluginUtils.injection,EventEmitter:ReactBrowserEventEmitter.injection,HostComponent:ReactHostComponent.injection,Updates:ReactUpdates.injection};module.exports=ReactInjection},{"./DOMProperty":784,"./EventPluginHub":789,"./EventPluginUtils":791,"./ReactBrowserEventEmitter":798,"./ReactComponentEnvironment":801,"./ReactEmptyComponent":825,"./ReactHostComponent":830,"./ReactUpdates":850}],833:[function(require,module,exports){"use strict";var ReactDOMSelection=require("./ReactDOMSelection");var containsNode=require("fbjs/lib/containsNode");var focusNode=require("fbjs/lib/focusNode");var getActiveElement=require("fbjs/lib/getActiveElement");function isInDocument(node){return containsNode(document.documentElement,node)}var ReactInputSelection={hasSelectionCapabilities:function(elem){var nodeName=elem&&elem.nodeName&&elem.nodeName.toLowerCase();return nodeName&&(nodeName==="input"&&elem.type==="text"||nodeName==="textarea"||elem.contentEditable==="true")},getSelectionInformation:function(){var focusedElem=getActiveElement();return{focusedElem:focusedElem,selectionRange:ReactInputSelection.hasSelectionCapabilities(focusedElem)?ReactInputSelection.getSelection(focusedElem):null}},restoreSelection:function(priorSelectionInformation){var curFocusedElem=getActiveElement();var priorFocusedElem=priorSelectionInformation.focusedElem;var priorSelectionRange=priorSelectionInformation.selectionRange;if(curFocusedElem!==priorFocusedElem&&isInDocument(priorFocusedElem)){if(ReactInputSelection.hasSelectionCapabilities(priorFocusedElem)){ReactInputSelection.setSelection(priorFocusedElem,priorSelectionRange)}focusNode(priorFocusedElem)}},getSelection:function(input){var selection;if("selectionStart"in input){selection={start:input.selectionStart,end:input.selectionEnd}}else if(document.selection&&input.nodeName&&input.nodeName.toLowerCase()==="input"){var range=document.selection.createRange();if(range.parentElement()===input){selection={start:-range.moveStart("character",-input.value.length),end:-range.moveEnd("character",-input.value.length)}}}else{selection=ReactDOMSelection.getOffsets(input);
}return selection||{start:0,end:0}},setSelection:function(input,offsets){var start=offsets.start;var end=offsets.end;if(end===undefined){end=start}if("selectionStart"in input){input.selectionStart=start;input.selectionEnd=Math.min(end,input.value.length)}else if(document.selection&&input.nodeName&&input.nodeName.toLowerCase()==="input"){var range=input.createTextRange();range.collapse(true);range.moveStart("character",start);range.moveEnd("character",end-start);range.select()}else{ReactDOMSelection.setOffsets(input,offsets)}}};module.exports=ReactInputSelection},{"./ReactDOMSelection":816,"fbjs/lib/containsNode":395,"fbjs/lib/focusNode":400,"fbjs/lib/getActiveElement":401}],834:[function(require,module,exports){"use strict";var ReactInstanceMap={remove:function(key){key._reactInternalInstance=undefined},get:function(key){return key._reactInternalInstance},has:function(key){return key._reactInternalInstance!==undefined},set:function(key,value){key._reactInternalInstance=value}};module.exports=ReactInstanceMap},{}],835:[function(require,module,exports){"use strict";var debugTool=null;if("production"!=="production"){var ReactDebugTool=require("./ReactDebugTool");debugTool=ReactDebugTool}module.exports={debugTool:debugTool}},{"./ReactDebugTool":821}],836:[function(require,module,exports){"use strict";var warning=require("fbjs/lib/warning");if("production"!=="production"){var processingChildContext=false;var warnInvalidSetState=function(){"production"!=="production"?warning(!processingChildContext,"setState(...): Cannot call setState() inside getChildContext()"):void 0}}var ReactInvalidSetStateWarningHook={onBeginProcessingChildContext:function(){processingChildContext=true},onEndProcessingChildContext:function(){processingChildContext=false},onSetState:function(){warnInvalidSetState()}};module.exports=ReactInvalidSetStateWarningHook},{"fbjs/lib/warning":413}],837:[function(require,module,exports){"use strict";var adler32=require("./adler32");var TAG_END=/\/?>/;var COMMENT_START=/^<\!\-\-/;var ReactMarkupChecksum={CHECKSUM_ATTR_NAME:"data-react-checksum",addChecksumToMarkup:function(markup){var checksum=adler32(markup);if(COMMENT_START.test(markup)){return markup}else{return markup.replace(TAG_END," "+ReactMarkupChecksum.CHECKSUM_ATTR_NAME+'="'+checksum+'"$&')}},canReuseMarkup:function(markup,element){var existingChecksum=element.getAttribute(ReactMarkupChecksum.CHECKSUM_ATTR_NAME);existingChecksum=existingChecksum&&parseInt(existingChecksum,10);var markupChecksum=adler32(markup);return markupChecksum===existingChecksum}};module.exports=ReactMarkupChecksum},{"./adler32":871}],838:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var DOMLazyTree=require("./DOMLazyTree");var DOMProperty=require("./DOMProperty");var React=require("react/lib/React");var ReactBrowserEventEmitter=require("./ReactBrowserEventEmitter");var ReactCurrentOwner=require("react/lib/ReactCurrentOwner");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var ReactDOMContainerInfo=require("./ReactDOMContainerInfo");var ReactDOMFeatureFlags=require("./ReactDOMFeatureFlags");var ReactFeatureFlags=require("./ReactFeatureFlags");var ReactInstanceMap=require("./ReactInstanceMap");var ReactInstrumentation=require("./ReactInstrumentation");var ReactMarkupChecksum=require("./ReactMarkupChecksum");var ReactReconciler=require("./ReactReconciler");var ReactUpdateQueue=require("./ReactUpdateQueue");var ReactUpdates=require("./ReactUpdates");var emptyObject=require("fbjs/lib/emptyObject");var instantiateReactComponent=require("./instantiateReactComponent");var invariant=require("fbjs/lib/invariant");var setInnerHTML=require("./setInnerHTML");var shouldUpdateReactComponent=require("./shouldUpdateReactComponent");var warning=require("fbjs/lib/warning");var ATTR_NAME=DOMProperty.ID_ATTRIBUTE_NAME;var ROOT_ATTR_NAME=DOMProperty.ROOT_ATTRIBUTE_NAME;var ELEMENT_NODE_TYPE=1;var DOC_NODE_TYPE=9;var DOCUMENT_FRAGMENT_NODE_TYPE=11;var instancesByReactRootID={};function firstDifferenceIndex(string1,string2){var minLen=Math.min(string1.length,string2.length);for(var i=0;i<minLen;i++){if(string1.charAt(i)!==string2.charAt(i)){return i}}return string1.length===string2.length?-1:minLen}function getReactRootElementInContainer(container){if(!container){return null}if(container.nodeType===DOC_NODE_TYPE){return container.documentElement}else{return container.firstChild}}function internalGetID(node){return node.getAttribute&&node.getAttribute(ATTR_NAME)||""}function mountComponentIntoNode(wrapperInstance,container,transaction,shouldReuseMarkup,context){var markerName;if(ReactFeatureFlags.logTopLevelRenders){var wrappedElement=wrapperInstance._currentElement.props.child;var type=wrappedElement.type;markerName="React mount: "+(typeof type==="string"?type:type.displayName||type.name);console.time(markerName)}var markup=ReactReconciler.mountComponent(wrapperInstance,transaction,null,ReactDOMContainerInfo(wrapperInstance,container),context,0);if(markerName){console.timeEnd(markerName)}wrapperInstance._renderedComponent._topLevelWrapper=wrapperInstance;ReactMount._mountImageIntoNode(markup,container,wrapperInstance,shouldReuseMarkup,transaction)}function batchedMountComponentIntoNode(componentInstance,container,shouldReuseMarkup,context){var transaction=ReactUpdates.ReactReconcileTransaction.getPooled(!shouldReuseMarkup&&ReactDOMFeatureFlags.useCreateElement);transaction.perform(mountComponentIntoNode,null,componentInstance,container,transaction,shouldReuseMarkup,context);ReactUpdates.ReactReconcileTransaction.release(transaction)}function unmountComponentFromNode(instance,container,safely){if("production"!=="production"){ReactInstrumentation.debugTool.onBeginFlush()}ReactReconciler.unmountComponent(instance,safely);if("production"!=="production"){ReactInstrumentation.debugTool.onEndFlush()}if(container.nodeType===DOC_NODE_TYPE){container=container.documentElement}while(container.lastChild){container.removeChild(container.lastChild)}}function hasNonRootReactChild(container){var rootEl=getReactRootElementInContainer(container);if(rootEl){var inst=ReactDOMComponentTree.getInstanceFromNode(rootEl);return!!(inst&&inst._hostParent)}}function nodeIsRenderedByOtherInstance(container){var rootEl=getReactRootElementInContainer(container);return!!(rootEl&&isReactNode(rootEl)&&!ReactDOMComponentTree.getInstanceFromNode(rootEl))}function isValidContainer(node){return!!(node&&(node.nodeType===ELEMENT_NODE_TYPE||node.nodeType===DOC_NODE_TYPE||node.nodeType===DOCUMENT_FRAGMENT_NODE_TYPE))}function isReactNode(node){return isValidContainer(node)&&(node.hasAttribute(ROOT_ATTR_NAME)||node.hasAttribute(ATTR_NAME))}function getHostRootInstanceInContainer(container){var rootEl=getReactRootElementInContainer(container);var prevHostInstance=rootEl&&ReactDOMComponentTree.getInstanceFromNode(rootEl);return prevHostInstance&&!prevHostInstance._hostParent?prevHostInstance:null}function getTopLevelWrapperInContainer(container){var root=getHostRootInstanceInContainer(container);return root?root._hostContainerInfo._topLevelWrapper:null}var topLevelRootCounter=1;var TopLevelWrapper=function(){this.rootID=topLevelRootCounter++};TopLevelWrapper.prototype.isReactComponent={};if("production"!=="production"){TopLevelWrapper.displayName="TopLevelWrapper"}TopLevelWrapper.prototype.render=function(){return this.props.child};TopLevelWrapper.isReactTopLevelWrapper=true;var ReactMount={TopLevelWrapper:TopLevelWrapper,_instancesByReactRootID:instancesByReactRootID,scrollMonitor:function(container,renderCallback){renderCallback()},_updateRootComponent:function(prevComponent,nextElement,nextContext,container,callback){ReactMount.scrollMonitor(container,function(){ReactUpdateQueue.enqueueElementInternal(prevComponent,nextElement,nextContext);if(callback){ReactUpdateQueue.enqueueCallbackInternal(prevComponent,callback)}});return prevComponent},_renderNewRootComponent:function(nextElement,container,shouldReuseMarkup,context){"production"!=="production"?warning(ReactCurrentOwner.current==null,"_renderNewRootComponent(): Render methods should be a pure function "+"of props and state; triggering nested component updates from "+"render is not allowed. If necessary, trigger nested updates in "+"componentDidUpdate. Check the render method of %s.",ReactCurrentOwner.current&&ReactCurrentOwner.current.getName()||"ReactCompositeComponent"):void 0;!isValidContainer(container)?"production"!=="production"?invariant(false,"_registerComponent(...): Target container is not a DOM element."):_prodInvariant("37"):void 0;ReactBrowserEventEmitter.ensureScrollValueMonitoring();var componentInstance=instantiateReactComponent(nextElement,false);ReactUpdates.batchedUpdates(batchedMountComponentIntoNode,componentInstance,container,shouldReuseMarkup,context);var wrapperID=componentInstance._instance.rootID;instancesByReactRootID[wrapperID]=componentInstance;return componentInstance},renderSubtreeIntoContainer:function(parentComponent,nextElement,container,callback){!(parentComponent!=null&&ReactInstanceMap.has(parentComponent))?"production"!=="production"?invariant(false,"parentComponent must be a valid React Component"):_prodInvariant("38"):void 0;return ReactMount._renderSubtreeIntoContainer(parentComponent,nextElement,container,callback)},_renderSubtreeIntoContainer:function(parentComponent,nextElement,container,callback){ReactUpdateQueue.validateCallback(callback,"ReactDOM.render");!React.isValidElement(nextElement)?"production"!=="production"?invariant(false,"ReactDOM.render(): Invalid component element.%s",typeof nextElement==="string"?" Instead of passing a string like 'div', pass "+"React.createElement('div') or <div />.":typeof nextElement==="function"?" Instead of passing a class like Foo, pass "+"React.createElement(Foo) or <Foo />.":nextElement!=null&&nextElement.props!==undefined?" This may be caused by unintentionally loading two independent "+"copies of React.":""):_prodInvariant("39",typeof nextElement==="string"?" Instead of passing a string like 'div', pass "+"React.createElement('div') or <div />.":typeof nextElement==="function"?" Instead of passing a class like Foo, pass "+"React.createElement(Foo) or <Foo />.":nextElement!=null&&nextElement.props!==undefined?" This may be caused by unintentionally loading two independent "+"copies of React.":""):void 0;"production"!=="production"?warning(!container||!container.tagName||container.tagName.toUpperCase()!=="BODY","render(): Rendering components directly into document.body is "+"discouraged, since its children are often manipulated by third-party "+"scripts and browser extensions. This may lead to subtle "+"reconciliation issues. Try rendering into a container element created "+"for your app."):void 0;var nextWrappedElement=React.createElement(TopLevelWrapper,{child:nextElement});var nextContext;if(parentComponent){var parentInst=ReactInstanceMap.get(parentComponent);nextContext=parentInst._processChildContext(parentInst._context)}else{nextContext=emptyObject}var prevComponent=getTopLevelWrapperInContainer(container);if(prevComponent){var prevWrappedElement=prevComponent._currentElement;var prevElement=prevWrappedElement.props.child;if(shouldUpdateReactComponent(prevElement,nextElement)){var publicInst=prevComponent._renderedComponent.getPublicInstance();var updatedCallback=callback&&function(){callback.call(publicInst)};ReactMount._updateRootComponent(prevComponent,nextWrappedElement,nextContext,container,updatedCallback);return publicInst}else{ReactMount.unmountComponentAtNode(container)}}var reactRootElement=getReactRootElementInContainer(container);var containerHasReactMarkup=reactRootElement&&!!internalGetID(reactRootElement);var containerHasNonRootReactChild=hasNonRootReactChild(container);if("production"!=="production"){"production"!=="production"?warning(!containerHasNonRootReactChild,"render(...): Replacing React-rendered children with a new root "+"component. If you intended to update the children of this node, "+"you should instead have the existing children update their state "+"and render the new components instead of calling ReactDOM.render."):void 0;if(!containerHasReactMarkup||reactRootElement.nextSibling){var rootElementSibling=reactRootElement;while(rootElementSibling){if(internalGetID(rootElementSibling)){"production"!=="production"?warning(false,"render(): Target node has markup rendered by React, but there "+"are unrelated nodes as well. This is most commonly caused by "+"white-space inserted around server-rendered markup."):void 0;break}rootElementSibling=rootElementSibling.nextSibling}}}var shouldReuseMarkup=containerHasReactMarkup&&!prevComponent&&!containerHasNonRootReactChild;var component=ReactMount._renderNewRootComponent(nextWrappedElement,container,shouldReuseMarkup,nextContext)._renderedComponent.getPublicInstance();if(callback){callback.call(component)}return component},render:function(nextElement,container,callback){return ReactMount._renderSubtreeIntoContainer(null,nextElement,container,callback)},unmountComponentAtNode:function(container){"production"!=="production"?warning(ReactCurrentOwner.current==null,"unmountComponentAtNode(): Render methods should be a pure function "+"of props and state; triggering nested component updates from render "+"is not allowed. If necessary, trigger nested updates in "+"componentDidUpdate. Check the render method of %s.",ReactCurrentOwner.current&&ReactCurrentOwner.current.getName()||"ReactCompositeComponent"):void 0;!isValidContainer(container)?"production"!=="production"?invariant(false,"unmountComponentAtNode(...): Target container is not a DOM element."):_prodInvariant("40"):void 0;if("production"!=="production"){"production"!=="production"?warning(!nodeIsRenderedByOtherInstance(container),"unmountComponentAtNode(): The node you're attempting to unmount "+"was rendered by another copy of React."):void 0}var prevComponent=getTopLevelWrapperInContainer(container);if(!prevComponent){var containerHasNonRootReactChild=hasNonRootReactChild(container);var isContainerReactRoot=container.nodeType===1&&container.hasAttribute(ROOT_ATTR_NAME);if("production"!=="production"){"production"!=="production"?warning(!containerHasNonRootReactChild,"unmountComponentAtNode(): The node you're attempting to unmount "+"was rendered by React and is not a top-level container. %s",isContainerReactRoot?"You may have accidentally passed in a React root node instead "+"of its container.":"Instead, have the parent component update its state and "+"rerender in order to remove this component."):void 0}return false}delete instancesByReactRootID[prevComponent._instance.rootID];ReactUpdates.batchedUpdates(unmountComponentFromNode,prevComponent,container,false);return true},_mountImageIntoNode:function(markup,container,instance,shouldReuseMarkup,transaction){!isValidContainer(container)?"production"!=="production"?invariant(false,"mountComponentIntoNode(...): Target container is not valid."):_prodInvariant("41"):void 0;if(shouldReuseMarkup){var rootElement=getReactRootElementInContainer(container);if(ReactMarkupChecksum.canReuseMarkup(markup,rootElement)){ReactDOMComponentTree.precacheNode(instance,rootElement);return}else{var checksum=rootElement.getAttribute(ReactMarkupChecksum.CHECKSUM_ATTR_NAME);rootElement.removeAttribute(ReactMarkupChecksum.CHECKSUM_ATTR_NAME);var rootMarkup=rootElement.outerHTML;rootElement.setAttribute(ReactMarkupChecksum.CHECKSUM_ATTR_NAME,checksum);var normalizedMarkup=markup;if("production"!=="production"){var normalizer;if(container.nodeType===ELEMENT_NODE_TYPE){normalizer=document.createElement("div");normalizer.innerHTML=markup;normalizedMarkup=normalizer.innerHTML}else{normalizer=document.createElement("iframe");document.body.appendChild(normalizer);normalizer.contentDocument.write(markup);normalizedMarkup=normalizer.contentDocument.documentElement.outerHTML;document.body.removeChild(normalizer)}}var diffIndex=firstDifferenceIndex(normalizedMarkup,rootMarkup);var difference=" (client) "+normalizedMarkup.substring(diffIndex-20,diffIndex+20)+"\n (server) "+rootMarkup.substring(diffIndex-20,diffIndex+20);!(container.nodeType!==DOC_NODE_TYPE)?"production"!=="production"?invariant(false,"You're trying to render a component to the document using server rendering but the checksum was invalid. This usually means you rendered a different component type or props on the client from the one on the server, or your render() methods are impure. React cannot handle this case due to cross-browser quirks by rendering at the document root. You should look for environment dependent code in your components and ensure the props are the same client and server side:\n%s",difference):_prodInvariant("42",difference):void 0;if("production"!=="production"){"production"!=="production"?warning(false,"React attempted to reuse markup in a container but the "+"checksum was invalid. This generally means that you are "+"using server rendering and the markup generated on the "+"server was not what the client was expecting. React injected "+"new markup to compensate which works but you have lost many "+"of the benefits of server rendering. Instead, figure out "+"why the markup being generated is different on the client "+"or server:\n%s",difference):void 0}}}!(container.nodeType!==DOC_NODE_TYPE)?"production"!=="production"?invariant(false,"You're trying to render a component to the document but you didn't use server rendering. We can't do this without using server rendering due to cross-browser quirks. See ReactDOMServer.renderToString() for server rendering."):_prodInvariant("43"):void 0;if(transaction.useCreateElement){while(container.lastChild){container.removeChild(container.lastChild)}DOMLazyTree.insertTreeBefore(container,markup,null)}else{setInnerHTML(container,markup);ReactDOMComponentTree.precacheNode(instance,container.firstChild)}if("production"!=="production"){var hostNode=ReactDOMComponentTree.getInstanceFromNode(container.firstChild);if(hostNode._debugID!==0){ReactInstrumentation.debugTool.onHostOperation({instanceID:hostNode._debugID,type:"mount",payload:markup.toString()})}}}};module.exports=ReactMount},{"./DOMLazyTree":782,"./DOMProperty":784,"./ReactBrowserEventEmitter":798,"./ReactDOMComponentTree":806,"./ReactDOMContainerInfo":807,"./ReactDOMFeatureFlags":809,"./ReactFeatureFlags":829,"./ReactInstanceMap":834,"./ReactInstrumentation":835,"./ReactMarkupChecksum":837,"./ReactReconciler":845,"./ReactUpdateQueue":849,"./ReactUpdates":850,"./instantiateReactComponent":889,"./reactProdInvariant":893,"./setInnerHTML":895,"./shouldUpdateReactComponent":897,"fbjs/lib/emptyObject":399,"fbjs/lib/invariant":406,"fbjs/lib/warning":413,"react/lib/React":926,"react/lib/ReactCurrentOwner":931}],839:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var ReactComponentEnvironment=require("./ReactComponentEnvironment");var ReactInstanceMap=require("./ReactInstanceMap");var ReactInstrumentation=require("./ReactInstrumentation");var ReactCurrentOwner=require("react/lib/ReactCurrentOwner");var ReactReconciler=require("./ReactReconciler");var ReactChildReconciler=require("./ReactChildReconciler");var emptyFunction=require("fbjs/lib/emptyFunction");var flattenChildren=require("./flattenChildren");var invariant=require("fbjs/lib/invariant");function makeInsertMarkup(markup,afterNode,toIndex){return{type:"INSERT_MARKUP",content:markup,fromIndex:null,fromNode:null,toIndex:toIndex,afterNode:afterNode}}function makeMove(child,afterNode,toIndex){return{type:"MOVE_EXISTING",content:null,fromIndex:child._mountIndex,fromNode:ReactReconciler.getHostNode(child),toIndex:toIndex,afterNode:afterNode}}function makeRemove(child,node){return{type:"REMOVE_NODE",content:null,fromIndex:child._mountIndex,fromNode:node,toIndex:null,afterNode:null}}function makeSetMarkup(markup){return{type:"SET_MARKUP",content:markup,fromIndex:null,fromNode:null,toIndex:null,afterNode:null}}function makeTextContent(textContent){return{type:"TEXT_CONTENT",content:textContent,fromIndex:null,fromNode:null,toIndex:null,afterNode:null}}function enqueue(queue,update){if(update){queue=queue||[];queue.push(update)}return queue}function processQueue(inst,updateQueue){ReactComponentEnvironment.processChildrenUpdates(inst,updateQueue)}var setChildrenForInstrumentation=emptyFunction;if("production"!=="production"){var getDebugID=function(inst){if(!inst._debugID){var internal;if(internal=ReactInstanceMap.get(inst)){inst=internal}}return inst._debugID};setChildrenForInstrumentation=function(children){var debugID=getDebugID(this);if(debugID!==0){ReactInstrumentation.debugTool.onSetChildren(debugID,children?Object.keys(children).map(function(key){return children[key]._debugID}):[])}}}var ReactMultiChild={Mixin:{_reconcilerInstantiateChildren:function(nestedChildren,transaction,context){if("production"!=="production"){var selfDebugID=getDebugID(this);if(this._currentElement){try{ReactCurrentOwner.current=this._currentElement._owner;return ReactChildReconciler.instantiateChildren(nestedChildren,transaction,context,selfDebugID)}finally{ReactCurrentOwner.current=null}}}return ReactChildReconciler.instantiateChildren(nestedChildren,transaction,context)},_reconcilerUpdateChildren:function(prevChildren,nextNestedChildrenElements,mountImages,removedNodes,transaction,context){var nextChildren;var selfDebugID=0;if("production"!=="production"){selfDebugID=getDebugID(this);if(this._currentElement){try{ReactCurrentOwner.current=this._currentElement._owner;nextChildren=flattenChildren(nextNestedChildrenElements,selfDebugID)}finally{ReactCurrentOwner.current=null}ReactChildReconciler.updateChildren(prevChildren,nextChildren,mountImages,removedNodes,transaction,this,this._hostContainerInfo,context,selfDebugID);return nextChildren}}nextChildren=flattenChildren(nextNestedChildrenElements,selfDebugID);ReactChildReconciler.updateChildren(prevChildren,nextChildren,mountImages,removedNodes,transaction,this,this._hostContainerInfo,context,selfDebugID);return nextChildren},mountChildren:function(nestedChildren,transaction,context){var children=this._reconcilerInstantiateChildren(nestedChildren,transaction,context);this._renderedChildren=children;var mountImages=[];var index=0;for(var name in children){if(children.hasOwnProperty(name)){var child=children[name];var selfDebugID=0;if("production"!=="production"){selfDebugID=getDebugID(this)}var mountImage=ReactReconciler.mountComponent(child,transaction,this,this._hostContainerInfo,context,selfDebugID);child._mountIndex=index++;mountImages.push(mountImage)}}if("production"!=="production"){setChildrenForInstrumentation.call(this,children)}return mountImages},updateTextContent:function(nextContent){var prevChildren=this._renderedChildren;ReactChildReconciler.unmountChildren(prevChildren,false);for(var name in prevChildren){if(prevChildren.hasOwnProperty(name)){!false?"production"!=="production"?invariant(false,"updateTextContent called on non-empty component."):_prodInvariant("118"):void 0}}var updates=[makeTextContent(nextContent)];processQueue(this,updates)},updateMarkup:function(nextMarkup){var prevChildren=this._renderedChildren;ReactChildReconciler.unmountChildren(prevChildren,false);for(var name in prevChildren){if(prevChildren.hasOwnProperty(name)){!false?"production"!=="production"?invariant(false,"updateTextContent called on non-empty component."):_prodInvariant("118"):void 0}}var updates=[makeSetMarkup(nextMarkup)];processQueue(this,updates)},updateChildren:function(nextNestedChildrenElements,transaction,context){this._updateChildren(nextNestedChildrenElements,transaction,context)},_updateChildren:function(nextNestedChildrenElements,transaction,context){var prevChildren=this._renderedChildren;var removedNodes={};var mountImages=[];var nextChildren=this._reconcilerUpdateChildren(prevChildren,nextNestedChildrenElements,mountImages,removedNodes,transaction,context);if(!nextChildren&&!prevChildren){return}var updates=null;var name;var nextIndex=0;var lastIndex=0;var nextMountIndex=0;var lastPlacedNode=null;for(name in nextChildren){if(!nextChildren.hasOwnProperty(name)){continue}var prevChild=prevChildren&&prevChildren[name];var nextChild=nextChildren[name];if(prevChild===nextChild){updates=enqueue(updates,this.moveChild(prevChild,lastPlacedNode,nextIndex,lastIndex));lastIndex=Math.max(prevChild._mountIndex,lastIndex);prevChild._mountIndex=nextIndex}else{if(prevChild){lastIndex=Math.max(prevChild._mountIndex,lastIndex)}updates=enqueue(updates,this._mountChildAtIndex(nextChild,mountImages[nextMountIndex],lastPlacedNode,nextIndex,transaction,context));nextMountIndex++}nextIndex++;lastPlacedNode=ReactReconciler.getHostNode(nextChild)}for(name in removedNodes){if(removedNodes.hasOwnProperty(name)){updates=enqueue(updates,this._unmountChild(prevChildren[name],removedNodes[name]))}}if(updates){processQueue(this,updates)}this._renderedChildren=nextChildren;if("production"!=="production"){setChildrenForInstrumentation.call(this,nextChildren)}},unmountChildren:function(safely){var renderedChildren=this._renderedChildren;ReactChildReconciler.unmountChildren(renderedChildren,safely);this._renderedChildren=null},moveChild:function(child,afterNode,toIndex,lastIndex){if(child._mountIndex<lastIndex){return makeMove(child,afterNode,toIndex)}},createChild:function(child,afterNode,mountImage){return makeInsertMarkup(mountImage,afterNode,child._mountIndex)},removeChild:function(child,node){return makeRemove(child,node)},_mountChildAtIndex:function(child,mountImage,afterNode,index,transaction,context){child._mountIndex=index;return this.createChild(child,afterNode,mountImage)},_unmountChild:function(child,node){var update=this.removeChild(child,node);child._mountIndex=null;return update}}};module.exports=ReactMultiChild},{"./ReactChildReconciler":799,"./ReactComponentEnvironment":801,"./ReactInstanceMap":834,"./ReactInstrumentation":835,"./ReactReconciler":845,"./flattenChildren":877,"./reactProdInvariant":893,"fbjs/lib/emptyFunction":398,"fbjs/lib/invariant":406,"react/lib/ReactCurrentOwner":931}],840:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var React=require("react/lib/React");var invariant=require("fbjs/lib/invariant");var ReactNodeTypes={HOST:0,COMPOSITE:1,EMPTY:2,getType:function(node){if(node===null||node===false){return ReactNodeTypes.EMPTY}else if(React.isValidElement(node)){if(typeof node.type==="function"){return ReactNodeTypes.COMPOSITE}else{return ReactNodeTypes.HOST}}!false?"production"!=="production"?invariant(false,"Unexpected node: %s",node):_prodInvariant("26",node):void 0}};module.exports=ReactNodeTypes},{"./reactProdInvariant":893,"fbjs/lib/invariant":406,"react/lib/React":926}],841:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var invariant=require("fbjs/lib/invariant");function isValidOwner(object){return!!(object&&typeof object.attachRef==="function"&&typeof object.detachRef==="function")}var ReactOwner={addComponentAsRefTo:function(component,ref,owner){!isValidOwner(owner)?"production"!=="production"?invariant(false,"addComponentAsRefTo(...): Only a ReactOwner can have refs. You might be adding a ref to a component that was not created inside a component's `render` method, or you have multiple copies of React loaded (details: https://fb.me/react-refs-must-have-owner)."):_prodInvariant("119"):void 0;owner.attachRef(ref,component)},removeComponentAsRefFrom:function(component,ref,owner){!isValidOwner(owner)?"production"!=="production"?invariant(false,"removeComponentAsRefFrom(...): Only a ReactOwner can have refs. You might be removing a ref to a component that was not created inside a component's `render` method, or you have multiple copies of React loaded (details: https://fb.me/react-refs-must-have-owner)."):_prodInvariant("120"):void 0;var ownerPublicInstance=owner.getPublicInstance();if(ownerPublicInstance&&ownerPublicInstance.refs[ref]===component.getPublicInstance()){owner.detachRef(ref)}}};module.exports=ReactOwner},{"./reactProdInvariant":893,"fbjs/lib/invariant":406}],842:[function(require,module,exports){"use strict";var ReactPropTypeLocationNames={};if("production"!=="production"){ReactPropTypeLocationNames={prop:"prop",context:"context",childContext:"child context"}}module.exports=ReactPropTypeLocationNames},{}],843:[function(require,module,exports){"use strict";var ReactPropTypesSecret="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";module.exports=ReactPropTypesSecret},{}],844:[function(require,module,exports){"use strict";var _assign=require("object-assign");var CallbackQueue=require("./CallbackQueue");var PooledClass=require("./PooledClass");var ReactBrowserEventEmitter=require("./ReactBrowserEventEmitter");var ReactInputSelection=require("./ReactInputSelection");var ReactInstrumentation=require("./ReactInstrumentation");var Transaction=require("./Transaction");var ReactUpdateQueue=require("./ReactUpdateQueue");var SELECTION_RESTORATION={initialize:ReactInputSelection.getSelectionInformation,close:ReactInputSelection.restoreSelection};var EVENT_SUPPRESSION={initialize:function(){var currentlyEnabled=ReactBrowserEventEmitter.isEnabled();ReactBrowserEventEmitter.setEnabled(false);return currentlyEnabled},close:function(previouslyEnabled){ReactBrowserEventEmitter.setEnabled(previouslyEnabled)}};var ON_DOM_READY_QUEUEING={initialize:function(){this.reactMountReady.reset()},close:function(){this.reactMountReady.notifyAll()}};var TRANSACTION_WRAPPERS=[SELECTION_RESTORATION,EVENT_SUPPRESSION,ON_DOM_READY_QUEUEING];if("production"!=="production"){TRANSACTION_WRAPPERS.push({initialize:ReactInstrumentation.debugTool.onBeginFlush,close:ReactInstrumentation.debugTool.onEndFlush})}function ReactReconcileTransaction(useCreateElement){this.reinitializeTransaction();this.renderToStaticMarkup=false;this.reactMountReady=CallbackQueue.getPooled(null);this.useCreateElement=useCreateElement}var Mixin={getTransactionWrappers:function(){return TRANSACTION_WRAPPERS},getReactMountReady:function(){return this.reactMountReady},getUpdateQueue:function(){return ReactUpdateQueue},checkpoint:function(){return this.reactMountReady.checkpoint()},rollback:function(checkpoint){this.reactMountReady.rollback(checkpoint)},destructor:function(){CallbackQueue.release(this.reactMountReady);this.reactMountReady=null}};_assign(ReactReconcileTransaction.prototype,Transaction,Mixin);PooledClass.addPoolingTo(ReactReconcileTransaction);module.exports=ReactReconcileTransaction},{"./CallbackQueue":779,"./PooledClass":797,"./ReactBrowserEventEmitter":798,"./ReactInputSelection":833,"./ReactInstrumentation":835,"./ReactUpdateQueue":849,"./Transaction":868,"object-assign":732}],845:[function(require,module,exports){"use strict";var ReactRef=require("./ReactRef");var ReactInstrumentation=require("./ReactInstrumentation");var warning=require("fbjs/lib/warning");function attachRefs(){ReactRef.attachRefs(this,this._currentElement)}var ReactReconciler={mountComponent:function(internalInstance,transaction,hostParent,hostContainerInfo,context,parentDebugID){if("production"!=="production"){if(internalInstance._debugID!==0){ReactInstrumentation.debugTool.onBeforeMountComponent(internalInstance._debugID,internalInstance._currentElement,parentDebugID)}}var markup=internalInstance.mountComponent(transaction,hostParent,hostContainerInfo,context,parentDebugID);if(internalInstance._currentElement&&internalInstance._currentElement.ref!=null){transaction.getReactMountReady().enqueue(attachRefs,internalInstance)}if("production"!=="production"){if(internalInstance._debugID!==0){ReactInstrumentation.debugTool.onMountComponent(internalInstance._debugID)}}return markup},getHostNode:function(internalInstance){return internalInstance.getHostNode()},unmountComponent:function(internalInstance,safely){if("production"!=="production"){if(internalInstance._debugID!==0){ReactInstrumentation.debugTool.onBeforeUnmountComponent(internalInstance._debugID);
}}ReactRef.detachRefs(internalInstance,internalInstance._currentElement);internalInstance.unmountComponent(safely);if("production"!=="production"){if(internalInstance._debugID!==0){ReactInstrumentation.debugTool.onUnmountComponent(internalInstance._debugID)}}},receiveComponent:function(internalInstance,nextElement,transaction,context){var prevElement=internalInstance._currentElement;if(nextElement===prevElement&&context===internalInstance._context){return}if("production"!=="production"){if(internalInstance._debugID!==0){ReactInstrumentation.debugTool.onBeforeUpdateComponent(internalInstance._debugID,nextElement)}}var refsChanged=ReactRef.shouldUpdateRefs(prevElement,nextElement);if(refsChanged){ReactRef.detachRefs(internalInstance,prevElement)}internalInstance.receiveComponent(nextElement,transaction,context);if(refsChanged&&internalInstance._currentElement&&internalInstance._currentElement.ref!=null){transaction.getReactMountReady().enqueue(attachRefs,internalInstance)}if("production"!=="production"){if(internalInstance._debugID!==0){ReactInstrumentation.debugTool.onUpdateComponent(internalInstance._debugID)}}},performUpdateIfNecessary:function(internalInstance,transaction,updateBatchNumber){if(internalInstance._updateBatchNumber!==updateBatchNumber){"production"!=="production"?warning(internalInstance._updateBatchNumber==null||internalInstance._updateBatchNumber===updateBatchNumber+1,"performUpdateIfNecessary: Unexpected batch number (current %s, "+"pending %s)",updateBatchNumber,internalInstance._updateBatchNumber):void 0;return}if("production"!=="production"){if(internalInstance._debugID!==0){ReactInstrumentation.debugTool.onBeforeUpdateComponent(internalInstance._debugID,internalInstance._currentElement)}}internalInstance.performUpdateIfNecessary(transaction);if("production"!=="production"){if(internalInstance._debugID!==0){ReactInstrumentation.debugTool.onUpdateComponent(internalInstance._debugID)}}}};module.exports=ReactReconciler},{"./ReactInstrumentation":835,"./ReactRef":846,"fbjs/lib/warning":413}],846:[function(require,module,exports){"use strict";var ReactOwner=require("./ReactOwner");var ReactRef={};function attachRef(ref,component,owner){if(typeof ref==="function"){ref(component.getPublicInstance())}else{ReactOwner.addComponentAsRefTo(component,ref,owner)}}function detachRef(ref,component,owner){if(typeof ref==="function"){ref(null)}else{ReactOwner.removeComponentAsRefFrom(component,ref,owner)}}ReactRef.attachRefs=function(instance,element){if(element===null||typeof element!=="object"){return}var ref=element.ref;if(ref!=null){attachRef(ref,instance,element._owner)}};ReactRef.shouldUpdateRefs=function(prevElement,nextElement){var prevRef=null;var prevOwner=null;if(prevElement!==null&&typeof prevElement==="object"){prevRef=prevElement.ref;prevOwner=prevElement._owner}var nextRef=null;var nextOwner=null;if(nextElement!==null&&typeof nextElement==="object"){nextRef=nextElement.ref;nextOwner=nextElement._owner}return prevRef!==nextRef||typeof nextRef==="string"&&nextOwner!==prevOwner};ReactRef.detachRefs=function(instance,element){if(element===null||typeof element!=="object"){return}var ref=element.ref;if(ref!=null){detachRef(ref,instance,element._owner)}};module.exports=ReactRef},{"./ReactOwner":841}],847:[function(require,module,exports){"use strict";var _assign=require("object-assign");var PooledClass=require("./PooledClass");var Transaction=require("./Transaction");var ReactInstrumentation=require("./ReactInstrumentation");var ReactServerUpdateQueue=require("./ReactServerUpdateQueue");var TRANSACTION_WRAPPERS=[];if("production"!=="production"){TRANSACTION_WRAPPERS.push({initialize:ReactInstrumentation.debugTool.onBeginFlush,close:ReactInstrumentation.debugTool.onEndFlush})}var noopCallbackQueue={enqueue:function(){}};function ReactServerRenderingTransaction(renderToStaticMarkup){this.reinitializeTransaction();this.renderToStaticMarkup=renderToStaticMarkup;this.useCreateElement=false;this.updateQueue=new ReactServerUpdateQueue(this)}var Mixin={getTransactionWrappers:function(){return TRANSACTION_WRAPPERS},getReactMountReady:function(){return noopCallbackQueue},getUpdateQueue:function(){return this.updateQueue},destructor:function(){},checkpoint:function(){},rollback:function(){}};_assign(ReactServerRenderingTransaction.prototype,Transaction,Mixin);PooledClass.addPoolingTo(ReactServerRenderingTransaction);module.exports=ReactServerRenderingTransaction},{"./PooledClass":797,"./ReactInstrumentation":835,"./ReactServerUpdateQueue":848,"./Transaction":868,"object-assign":732}],848:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ReactUpdateQueue=require("./ReactUpdateQueue");var warning=require("fbjs/lib/warning");function warnNoop(publicInstance,callerName){if("production"!=="production"){var constructor=publicInstance.constructor;"production"!=="production"?warning(false,"%s(...): Can only update a mounting component. "+"This usually means you called %s() outside componentWillMount() on the server. "+"This is a no-op. Please check the code for the %s component.",callerName,callerName,constructor&&(constructor.displayName||constructor.name)||"ReactClass"):void 0}}var ReactServerUpdateQueue=function(){function ReactServerUpdateQueue(transaction){_classCallCheck(this,ReactServerUpdateQueue);this.transaction=transaction}ReactServerUpdateQueue.prototype.isMounted=function isMounted(publicInstance){return false};ReactServerUpdateQueue.prototype.enqueueCallback=function enqueueCallback(publicInstance,callback,callerName){if(this.transaction.isInTransaction()){ReactUpdateQueue.enqueueCallback(publicInstance,callback,callerName)}};ReactServerUpdateQueue.prototype.enqueueForceUpdate=function enqueueForceUpdate(publicInstance){if(this.transaction.isInTransaction()){ReactUpdateQueue.enqueueForceUpdate(publicInstance)}else{warnNoop(publicInstance,"forceUpdate")}};ReactServerUpdateQueue.prototype.enqueueReplaceState=function enqueueReplaceState(publicInstance,completeState){if(this.transaction.isInTransaction()){ReactUpdateQueue.enqueueReplaceState(publicInstance,completeState)}else{warnNoop(publicInstance,"replaceState")}};ReactServerUpdateQueue.prototype.enqueueSetState=function enqueueSetState(publicInstance,partialState){if(this.transaction.isInTransaction()){ReactUpdateQueue.enqueueSetState(publicInstance,partialState)}else{warnNoop(publicInstance,"setState")}};return ReactServerUpdateQueue}();module.exports=ReactServerUpdateQueue},{"./ReactUpdateQueue":849,"fbjs/lib/warning":413}],849:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var ReactCurrentOwner=require("react/lib/ReactCurrentOwner");var ReactInstanceMap=require("./ReactInstanceMap");var ReactInstrumentation=require("./ReactInstrumentation");var ReactUpdates=require("./ReactUpdates");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");function enqueueUpdate(internalInstance){ReactUpdates.enqueueUpdate(internalInstance)}function formatUnexpectedArgument(arg){var type=typeof arg;if(type!=="object"){return type}var displayName=arg.constructor&&arg.constructor.name||type;var keys=Object.keys(arg);if(keys.length>0&&keys.length<20){return displayName+" (keys: "+keys.join(", ")+")"}return displayName}function getInternalInstanceReadyForUpdate(publicInstance,callerName){var internalInstance=ReactInstanceMap.get(publicInstance);if(!internalInstance){if("production"!=="production"){var ctor=publicInstance.constructor;"production"!=="production"?warning(!callerName,"%s(...): Can only update a mounted or mounting component. "+"This usually means you called %s() on an unmounted component. "+"This is a no-op. Please check the code for the %s component.",callerName,callerName,ctor&&(ctor.displayName||ctor.name)||"ReactClass"):void 0}return null}if("production"!=="production"){"production"!=="production"?warning(ReactCurrentOwner.current==null,"%s(...): Cannot update during an existing state transition (such as "+"within `render` or another component's constructor). Render methods "+"should be a pure function of props and state; constructor "+"side-effects are an anti-pattern, but can be moved to "+"`componentWillMount`.",callerName):void 0}return internalInstance}var ReactUpdateQueue={isMounted:function(publicInstance){if("production"!=="production"){var owner=ReactCurrentOwner.current;if(owner!==null){"production"!=="production"?warning(owner._warnedAboutRefsInRender,"%s is accessing isMounted inside its render() function. "+"render() should be a pure function of props and state. It should "+"never access something that requires stale data from the previous "+"render, such as refs. Move this logic to componentDidMount and "+"componentDidUpdate instead.",owner.getName()||"A component"):void 0;owner._warnedAboutRefsInRender=true}}var internalInstance=ReactInstanceMap.get(publicInstance);if(internalInstance){return!!internalInstance._renderedComponent}else{return false}},enqueueCallback:function(publicInstance,callback,callerName){ReactUpdateQueue.validateCallback(callback,callerName);var internalInstance=getInternalInstanceReadyForUpdate(publicInstance);if(!internalInstance){return null}if(internalInstance._pendingCallbacks){internalInstance._pendingCallbacks.push(callback)}else{internalInstance._pendingCallbacks=[callback]}enqueueUpdate(internalInstance)},enqueueCallbackInternal:function(internalInstance,callback){if(internalInstance._pendingCallbacks){internalInstance._pendingCallbacks.push(callback)}else{internalInstance._pendingCallbacks=[callback]}enqueueUpdate(internalInstance)},enqueueForceUpdate:function(publicInstance){var internalInstance=getInternalInstanceReadyForUpdate(publicInstance,"forceUpdate");if(!internalInstance){return}internalInstance._pendingForceUpdate=true;enqueueUpdate(internalInstance)},enqueueReplaceState:function(publicInstance,completeState){var internalInstance=getInternalInstanceReadyForUpdate(publicInstance,"replaceState");if(!internalInstance){return}internalInstance._pendingStateQueue=[completeState];internalInstance._pendingReplaceState=true;enqueueUpdate(internalInstance)},enqueueSetState:function(publicInstance,partialState){if("production"!=="production"){ReactInstrumentation.debugTool.onSetState();"production"!=="production"?warning(partialState!=null,"setState(...): You passed an undefined or null state object; "+"instead, use forceUpdate()."):void 0}var internalInstance=getInternalInstanceReadyForUpdate(publicInstance,"setState");if(!internalInstance){return}var queue=internalInstance._pendingStateQueue||(internalInstance._pendingStateQueue=[]);queue.push(partialState);enqueueUpdate(internalInstance)},enqueueElementInternal:function(internalInstance,nextElement,nextContext){internalInstance._pendingElement=nextElement;internalInstance._context=nextContext;enqueueUpdate(internalInstance)},validateCallback:function(callback,callerName){!(!callback||typeof callback==="function")?"production"!=="production"?invariant(false,"%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",callerName,formatUnexpectedArgument(callback)):_prodInvariant("122",callerName,formatUnexpectedArgument(callback)):void 0}};module.exports=ReactUpdateQueue},{"./ReactInstanceMap":834,"./ReactInstrumentation":835,"./ReactUpdates":850,"./reactProdInvariant":893,"fbjs/lib/invariant":406,"fbjs/lib/warning":413,"react/lib/ReactCurrentOwner":931}],850:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant"),_assign=require("object-assign");var CallbackQueue=require("./CallbackQueue");var PooledClass=require("./PooledClass");var ReactFeatureFlags=require("./ReactFeatureFlags");var ReactReconciler=require("./ReactReconciler");var Transaction=require("./Transaction");var invariant=require("fbjs/lib/invariant");var dirtyComponents=[];var updateBatchNumber=0;var asapCallbackQueue=CallbackQueue.getPooled();var asapEnqueued=false;var batchingStrategy=null;function ensureInjected(){!(ReactUpdates.ReactReconcileTransaction&&batchingStrategy)?"production"!=="production"?invariant(false,"ReactUpdates: must inject a reconcile transaction class and batching strategy"):_prodInvariant("123"):void 0}var NESTED_UPDATES={initialize:function(){this.dirtyComponentsLength=dirtyComponents.length},close:function(){if(this.dirtyComponentsLength!==dirtyComponents.length){dirtyComponents.splice(0,this.dirtyComponentsLength);flushBatchedUpdates()}else{dirtyComponents.length=0}}};var UPDATE_QUEUEING={initialize:function(){this.callbackQueue.reset()},close:function(){this.callbackQueue.notifyAll()}};var TRANSACTION_WRAPPERS=[NESTED_UPDATES,UPDATE_QUEUEING];function ReactUpdatesFlushTransaction(){this.reinitializeTransaction();this.dirtyComponentsLength=null;this.callbackQueue=CallbackQueue.getPooled();this.reconcileTransaction=ReactUpdates.ReactReconcileTransaction.getPooled(true)}_assign(ReactUpdatesFlushTransaction.prototype,Transaction,{getTransactionWrappers:function(){return TRANSACTION_WRAPPERS},destructor:function(){this.dirtyComponentsLength=null;CallbackQueue.release(this.callbackQueue);this.callbackQueue=null;ReactUpdates.ReactReconcileTransaction.release(this.reconcileTransaction);this.reconcileTransaction=null},perform:function(method,scope,a){return Transaction.perform.call(this,this.reconcileTransaction.perform,this.reconcileTransaction,method,scope,a)}});PooledClass.addPoolingTo(ReactUpdatesFlushTransaction);function batchedUpdates(callback,a,b,c,d,e){ensureInjected();return batchingStrategy.batchedUpdates(callback,a,b,c,d,e)}function mountOrderComparator(c1,c2){return c1._mountOrder-c2._mountOrder}function runBatchedUpdates(transaction){var len=transaction.dirtyComponentsLength;!(len===dirtyComponents.length)?"production"!=="production"?invariant(false,"Expected flush transaction's stored dirty-components length (%s) to match dirty-components array length (%s).",len,dirtyComponents.length):_prodInvariant("124",len,dirtyComponents.length):void 0;dirtyComponents.sort(mountOrderComparator);updateBatchNumber++;for(var i=0;i<len;i++){var component=dirtyComponents[i];var callbacks=component._pendingCallbacks;component._pendingCallbacks=null;var markerName;if(ReactFeatureFlags.logTopLevelRenders){var namedComponent=component;if(component._currentElement.type.isReactTopLevelWrapper){namedComponent=component._renderedComponent}markerName="React update: "+namedComponent.getName();console.time(markerName)}ReactReconciler.performUpdateIfNecessary(component,transaction.reconcileTransaction,updateBatchNumber);if(markerName){console.timeEnd(markerName)}if(callbacks){for(var j=0;j<callbacks.length;j++){transaction.callbackQueue.enqueue(callbacks[j],component.getPublicInstance())}}}}var flushBatchedUpdates=function(){while(dirtyComponents.length||asapEnqueued){if(dirtyComponents.length){var transaction=ReactUpdatesFlushTransaction.getPooled();transaction.perform(runBatchedUpdates,null,transaction);ReactUpdatesFlushTransaction.release(transaction)}if(asapEnqueued){asapEnqueued=false;var queue=asapCallbackQueue;asapCallbackQueue=CallbackQueue.getPooled();queue.notifyAll();CallbackQueue.release(queue)}}};function enqueueUpdate(component){ensureInjected();if(!batchingStrategy.isBatchingUpdates){batchingStrategy.batchedUpdates(enqueueUpdate,component);return}dirtyComponents.push(component);if(component._updateBatchNumber==null){component._updateBatchNumber=updateBatchNumber+1}}function asap(callback,context){!batchingStrategy.isBatchingUpdates?"production"!=="production"?invariant(false,"ReactUpdates.asap: Can't enqueue an asap callback in a context whereupdates are not being batched."):_prodInvariant("125"):void 0;asapCallbackQueue.enqueue(callback,context);asapEnqueued=true}var ReactUpdatesInjection={injectReconcileTransaction:function(ReconcileTransaction){!ReconcileTransaction?"production"!=="production"?invariant(false,"ReactUpdates: must provide a reconcile transaction class"):_prodInvariant("126"):void 0;ReactUpdates.ReactReconcileTransaction=ReconcileTransaction},injectBatchingStrategy:function(_batchingStrategy){!_batchingStrategy?"production"!=="production"?invariant(false,"ReactUpdates: must provide a batching strategy"):_prodInvariant("127"):void 0;!(typeof _batchingStrategy.batchedUpdates==="function")?"production"!=="production"?invariant(false,"ReactUpdates: must provide a batchedUpdates() function"):_prodInvariant("128"):void 0;!(typeof _batchingStrategy.isBatchingUpdates==="boolean")?"production"!=="production"?invariant(false,"ReactUpdates: must provide an isBatchingUpdates boolean attribute"):_prodInvariant("129"):void 0;batchingStrategy=_batchingStrategy}};var ReactUpdates={ReactReconcileTransaction:null,batchedUpdates:batchedUpdates,enqueueUpdate:enqueueUpdate,flushBatchedUpdates:flushBatchedUpdates,injection:ReactUpdatesInjection,asap:asap};module.exports=ReactUpdates},{"./CallbackQueue":779,"./PooledClass":797,"./ReactFeatureFlags":829,"./ReactReconciler":845,"./Transaction":868,"./reactProdInvariant":893,"fbjs/lib/invariant":406,"object-assign":732}],851:[function(require,module,exports){"use strict";module.exports="15.4.2"},{}],852:[function(require,module,exports){"use strict";var NS={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};var ATTRS={accentHeight:"accent-height",accumulate:0,additive:0,alignmentBaseline:"alignment-baseline",allowReorder:"allowReorder",alphabetic:0,amplitude:0,arabicForm:"arabic-form",ascent:0,attributeName:"attributeName",attributeType:"attributeType",autoReverse:"autoReverse",azimuth:0,baseFrequency:"baseFrequency",baseProfile:"baseProfile",baselineShift:"baseline-shift",bbox:0,begin:0,bias:0,by:0,calcMode:"calcMode",capHeight:"cap-height",clip:0,clipPath:"clip-path",clipRule:"clip-rule",clipPathUnits:"clipPathUnits",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",contentScriptType:"contentScriptType",contentStyleType:"contentStyleType",cursor:0,cx:0,cy:0,d:0,decelerate:0,descent:0,diffuseConstant:"diffuseConstant",direction:0,display:0,divisor:0,dominantBaseline:"dominant-baseline",dur:0,dx:0,dy:0,edgeMode:"edgeMode",elevation:0,enableBackground:"enable-background",end:0,exponent:0,externalResourcesRequired:"externalResourcesRequired",fill:0,fillOpacity:"fill-opacity",fillRule:"fill-rule",filter:0,filterRes:"filterRes",filterUnits:"filterUnits",floodColor:"flood-color",floodOpacity:"flood-opacity",focusable:0,fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",format:0,from:0,fx:0,fy:0,g1:0,g2:0,glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",glyphRef:"glyphRef",gradientTransform:"gradientTransform",gradientUnits:"gradientUnits",hanging:0,horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",ideographic:0,imageRendering:"image-rendering",in:0,in2:0,intercept:0,k:0,k1:0,k2:0,k3:0,k4:0,kernelMatrix:"kernelMatrix",kernelUnitLength:"kernelUnitLength",kerning:0,keyPoints:"keyPoints",keySplines:"keySplines",keyTimes:"keyTimes",lengthAdjust:"lengthAdjust",letterSpacing:"letter-spacing",lightingColor:"lighting-color",limitingConeAngle:"limitingConeAngle",local:0,markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",markerHeight:"markerHeight",markerUnits:"markerUnits",markerWidth:"markerWidth",mask:0,maskContentUnits:"maskContentUnits",maskUnits:"maskUnits",mathematical:0,mode:0,numOctaves:"numOctaves",offset:0,opacity:0,operator:0,order:0,orient:0,orientation:0,origin:0,overflow:0,overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pathLength:"pathLength",patternContentUnits:"patternContentUnits",patternTransform:"patternTransform",patternUnits:"patternUnits",pointerEvents:"pointer-events",points:0,pointsAtX:"pointsAtX",pointsAtY:"pointsAtY",pointsAtZ:"pointsAtZ",preserveAlpha:"preserveAlpha",preserveAspectRatio:"preserveAspectRatio",primitiveUnits:"primitiveUnits",r:0,radius:0,refX:"refX",refY:"refY",renderingIntent:"rendering-intent",repeatCount:"repeatCount",repeatDur:"repeatDur",requiredExtensions:"requiredExtensions",requiredFeatures:"requiredFeatures",restart:0,result:0,rotate:0,rx:0,ry:0,scale:0,seed:0,shapeRendering:"shape-rendering",slope:0,spacing:0,specularConstant:"specularConstant",specularExponent:"specularExponent",speed:0,spreadMethod:"spreadMethod",startOffset:"startOffset",stdDeviation:"stdDeviation",stemh:0,stemv:0,stitchTiles:"stitchTiles",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",string:0,stroke:0,strokeDasharray:"stroke-dasharray",strokeDashoffset:"stroke-dashoffset",strokeLinecap:"stroke-linecap",strokeLinejoin:"stroke-linejoin",strokeMiterlimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",surfaceScale:"surfaceScale",systemLanguage:"systemLanguage",tableValues:"tableValues",targetX:"targetX",targetY:"targetY",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",textLength:"textLength",to:0,transform:0,u1:0,u2:0,underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicode:0,unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",values:0,vectorEffect:"vector-effect",version:0,vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",viewBox:"viewBox",viewTarget:"viewTarget",visibility:0,widths:0,wordSpacing:"word-spacing",writingMode:"writing-mode",x:0,xHeight:"x-height",x1:0,x2:0,xChannelSelector:"xChannelSelector",xlinkActuate:"xlink:actuate",xlinkArcrole:"xlink:arcrole",xlinkHref:"xlink:href",xlinkRole:"xlink:role",xlinkShow:"xlink:show",xlinkTitle:"xlink:title",xlinkType:"xlink:type",xmlBase:"xml:base",xmlns:0,xmlnsXlink:"xmlns:xlink",xmlLang:"xml:lang",xmlSpace:"xml:space",y:0,y1:0,y2:0,yChannelSelector:"yChannelSelector",z:0,zoomAndPan:"zoomAndPan"};var SVGDOMPropertyConfig={Properties:{},DOMAttributeNamespaces:{xlinkActuate:NS.xlink,xlinkArcrole:NS.xlink,xlinkHref:NS.xlink,xlinkRole:NS.xlink,xlinkShow:NS.xlink,xlinkTitle:NS.xlink,xlinkType:NS.xlink,xmlBase:NS.xml,xmlLang:NS.xml,xmlSpace:NS.xml},DOMAttributeNames:{}};Object.keys(ATTRS).forEach(function(key){SVGDOMPropertyConfig.Properties[key]=0;if(ATTRS[key]){SVGDOMPropertyConfig.DOMAttributeNames[key]=ATTRS[key]}});module.exports=SVGDOMPropertyConfig},{}],853:[function(require,module,exports){"use strict";var EventPropagators=require("./EventPropagators");var ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var ReactInputSelection=require("./ReactInputSelection");var SyntheticEvent=require("./SyntheticEvent");var getActiveElement=require("fbjs/lib/getActiveElement");var isTextInputElement=require("./isTextInputElement");var shallowEqual=require("fbjs/lib/shallowEqual");var skipSelectionChangeEvent=ExecutionEnvironment.canUseDOM&&"documentMode"in document&&document.documentMode<=11;var eventTypes={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:["topBlur","topContextMenu","topFocus","topKeyDown","topKeyUp","topMouseDown","topMouseUp","topSelectionChange"]}};var activeElement=null;var activeElementInst=null;var lastSelection=null;var mouseDown=false;var hasListener=false;function getSelection(node){if("selectionStart"in node&&ReactInputSelection.hasSelectionCapabilities(node)){return{start:node.selectionStart,end:node.selectionEnd}}else if(window.getSelection){var selection=window.getSelection();return{anchorNode:selection.anchorNode,anchorOffset:selection.anchorOffset,focusNode:selection.focusNode,focusOffset:selection.focusOffset}}else if(document.selection){var range=document.selection.createRange();return{parentElement:range.parentElement(),text:range.text,top:range.boundingTop,left:range.boundingLeft}}}function constructSelectEvent(nativeEvent,nativeEventTarget){if(mouseDown||activeElement==null||activeElement!==getActiveElement()){return null}var currentSelection=getSelection(activeElement);if(!lastSelection||!shallowEqual(lastSelection,currentSelection)){lastSelection=currentSelection;var syntheticEvent=SyntheticEvent.getPooled(eventTypes.select,activeElementInst,nativeEvent,nativeEventTarget);syntheticEvent.type="select";syntheticEvent.target=activeElement;EventPropagators.accumulateTwoPhaseDispatches(syntheticEvent);return syntheticEvent}return null}var SelectEventPlugin={eventTypes:eventTypes,extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget){if(!hasListener){return null}var targetNode=targetInst?ReactDOMComponentTree.getNodeFromInstance(targetInst):window;switch(topLevelType){case"topFocus":if(isTextInputElement(targetNode)||targetNode.contentEditable==="true"){activeElement=targetNode;activeElementInst=targetInst;lastSelection=null}break;case"topBlur":activeElement=null;activeElementInst=null;lastSelection=null;break;case"topMouseDown":mouseDown=true;break;case"topContextMenu":case"topMouseUp":mouseDown=false;return constructSelectEvent(nativeEvent,nativeEventTarget);case"topSelectionChange":if(skipSelectionChangeEvent){break}case"topKeyDown":case"topKeyUp":return constructSelectEvent(nativeEvent,nativeEventTarget)}return null},didPutListener:function(inst,registrationName,listener){if(registrationName==="onSelect"){hasListener=true}}};module.exports=SelectEventPlugin},{"./EventPropagators":792,"./ReactDOMComponentTree":806,"./ReactInputSelection":833,"./SyntheticEvent":859,"./isTextInputElement":891,"fbjs/lib/ExecutionEnvironment":392,"fbjs/lib/getActiveElement":401,"fbjs/lib/shallowEqual":412}],854:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var EventListener=require("fbjs/lib/EventListener");var EventPropagators=require("./EventPropagators");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var SyntheticAnimationEvent=require("./SyntheticAnimationEvent");var SyntheticClipboardEvent=require("./SyntheticClipboardEvent");var SyntheticEvent=require("./SyntheticEvent");var SyntheticFocusEvent=require("./SyntheticFocusEvent");var SyntheticKeyboardEvent=require("./SyntheticKeyboardEvent");var SyntheticMouseEvent=require("./SyntheticMouseEvent");var SyntheticDragEvent=require("./SyntheticDragEvent");var SyntheticTouchEvent=require("./SyntheticTouchEvent");var SyntheticTransitionEvent=require("./SyntheticTransitionEvent");var SyntheticUIEvent=require("./SyntheticUIEvent");var SyntheticWheelEvent=require("./SyntheticWheelEvent");var emptyFunction=require("fbjs/lib/emptyFunction");var getEventCharCode=require("./getEventCharCode");var invariant=require("fbjs/lib/invariant");var eventTypes={};var topLevelEventsToDispatchConfig={};["abort","animationEnd","animationIteration","animationStart","blur","canPlay","canPlayThrough","click","contextMenu","copy","cut","doubleClick","drag","dragEnd","dragEnter","dragExit","dragLeave","dragOver","dragStart","drop","durationChange","emptied","encrypted","ended","error","focus","input","invalid","keyDown","keyPress","keyUp","load","loadedData","loadedMetadata","loadStart","mouseDown","mouseMove","mouseOut","mouseOver","mouseUp","paste","pause","play","playing","progress","rateChange","reset","scroll","seeked","seeking","stalled","submit","suspend","timeUpdate","touchCancel","touchEnd","touchMove","touchStart","transitionEnd","volumeChange","waiting","wheel"].forEach(function(event){var capitalizedEvent=event[0].toUpperCase()+event.slice(1);var onEvent="on"+capitalizedEvent;var topEvent="top"+capitalizedEvent;var type={phasedRegistrationNames:{bubbled:onEvent,captured:onEvent+"Capture"},dependencies:[topEvent]};eventTypes[event]=type;topLevelEventsToDispatchConfig[topEvent]=type});var onClickListeners={};function getDictionaryKey(inst){return"."+inst._rootNodeID}function isInteractive(tag){return tag==="button"||tag==="input"||tag==="select"||tag==="textarea"}var SimpleEventPlugin={eventTypes:eventTypes,extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget){var dispatchConfig=topLevelEventsToDispatchConfig[topLevelType];if(!dispatchConfig){return null}var EventConstructor;switch(topLevelType){case"topAbort":case"topCanPlay":case"topCanPlayThrough":case"topDurationChange":case"topEmptied":case"topEncrypted":case"topEnded":case"topError":case"topInput":case"topInvalid":case"topLoad":case"topLoadedData":case"topLoadedMetadata":case"topLoadStart":case"topPause":case"topPlay":case"topPlaying":case"topProgress":case"topRateChange":case"topReset":case"topSeeked":case"topSeeking":case"topStalled":case"topSubmit":case"topSuspend":case"topTimeUpdate":case"topVolumeChange":case"topWaiting":EventConstructor=SyntheticEvent;break;case"topKeyPress":if(getEventCharCode(nativeEvent)===0){return null}case"topKeyDown":case"topKeyUp":EventConstructor=SyntheticKeyboardEvent;break;case"topBlur":case"topFocus":EventConstructor=SyntheticFocusEvent;break;case"topClick":if(nativeEvent.button===2){return null}case"topDoubleClick":case"topMouseDown":case"topMouseMove":case"topMouseUp":case"topMouseOut":case"topMouseOver":case"topContextMenu":EventConstructor=SyntheticMouseEvent;break;case"topDrag":case"topDragEnd":case"topDragEnter":case"topDragExit":case"topDragLeave":case"topDragOver":case"topDragStart":case"topDrop":EventConstructor=SyntheticDragEvent;break;case"topTouchCancel":case"topTouchEnd":case"topTouchMove":case"topTouchStart":EventConstructor=SyntheticTouchEvent;break;case"topAnimationEnd":case"topAnimationIteration":case"topAnimationStart":EventConstructor=SyntheticAnimationEvent;break;case"topTransitionEnd":EventConstructor=SyntheticTransitionEvent;break;case"topScroll":EventConstructor=SyntheticUIEvent;break;case"topWheel":EventConstructor=SyntheticWheelEvent;break;case"topCopy":case"topCut":case"topPaste":EventConstructor=SyntheticClipboardEvent;break}!EventConstructor?"production"!=="production"?invariant(false,"SimpleEventPlugin: Unhandled event type, `%s`.",topLevelType):_prodInvariant("86",topLevelType):void 0;var event=EventConstructor.getPooled(dispatchConfig,targetInst,nativeEvent,nativeEventTarget);EventPropagators.accumulateTwoPhaseDispatches(event);return event},didPutListener:function(inst,registrationName,listener){if(registrationName==="onClick"&&!isInteractive(inst._tag)){var key=getDictionaryKey(inst);var node=ReactDOMComponentTree.getNodeFromInstance(inst);if(!onClickListeners[key]){onClickListeners[key]=EventListener.listen(node,"click",emptyFunction)}}},willDeleteListener:function(inst,registrationName){if(registrationName==="onClick"&&!isInteractive(inst._tag)){var key=getDictionaryKey(inst);onClickListeners[key].remove();delete onClickListeners[key]}}};module.exports=SimpleEventPlugin},{"./EventPropagators":792,"./ReactDOMComponentTree":806,"./SyntheticAnimationEvent":855,"./SyntheticClipboardEvent":856,"./SyntheticDragEvent":858,"./SyntheticEvent":859,"./SyntheticFocusEvent":860,"./SyntheticKeyboardEvent":862,"./SyntheticMouseEvent":863,"./SyntheticTouchEvent":864,"./SyntheticTransitionEvent":865,"./SyntheticUIEvent":866,"./SyntheticWheelEvent":867,"./getEventCharCode":879,"./reactProdInvariant":893,"fbjs/lib/EventListener":391,"fbjs/lib/emptyFunction":398,"fbjs/lib/invariant":406}],855:[function(require,module,exports){"use strict";var SyntheticEvent=require("./SyntheticEvent");var AnimationEventInterface={animationName:null,elapsedTime:null,pseudoElement:null};function SyntheticAnimationEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){
return SyntheticEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticEvent.augmentClass(SyntheticAnimationEvent,AnimationEventInterface);module.exports=SyntheticAnimationEvent},{"./SyntheticEvent":859}],856:[function(require,module,exports){"use strict";var SyntheticEvent=require("./SyntheticEvent");var ClipboardEventInterface={clipboardData:function(event){return"clipboardData"in event?event.clipboardData:window.clipboardData}};function SyntheticClipboardEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticEvent.augmentClass(SyntheticClipboardEvent,ClipboardEventInterface);module.exports=SyntheticClipboardEvent},{"./SyntheticEvent":859}],857:[function(require,module,exports){"use strict";var SyntheticEvent=require("./SyntheticEvent");var CompositionEventInterface={data:null};function SyntheticCompositionEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticEvent.augmentClass(SyntheticCompositionEvent,CompositionEventInterface);module.exports=SyntheticCompositionEvent},{"./SyntheticEvent":859}],858:[function(require,module,exports){"use strict";var SyntheticMouseEvent=require("./SyntheticMouseEvent");var DragEventInterface={dataTransfer:null};function SyntheticDragEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticMouseEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticMouseEvent.augmentClass(SyntheticDragEvent,DragEventInterface);module.exports=SyntheticDragEvent},{"./SyntheticMouseEvent":863}],859:[function(require,module,exports){"use strict";var _assign=require("object-assign");var PooledClass=require("./PooledClass");var emptyFunction=require("fbjs/lib/emptyFunction");var warning=require("fbjs/lib/warning");var didWarnForAddedNewProperty=false;var isProxySupported=typeof Proxy==="function";var shouldBeReleasedProperties=["dispatchConfig","_targetInst","nativeEvent","isDefaultPrevented","isPropagationStopped","_dispatchListeners","_dispatchInstances"];var EventInterface={type:null,target:null,currentTarget:emptyFunction.thatReturnsNull,eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(event){return event.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null};function SyntheticEvent(dispatchConfig,targetInst,nativeEvent,nativeEventTarget){if("production"!=="production"){delete this.nativeEvent;delete this.preventDefault;delete this.stopPropagation}this.dispatchConfig=dispatchConfig;this._targetInst=targetInst;this.nativeEvent=nativeEvent;var Interface=this.constructor.Interface;for(var propName in Interface){if(!Interface.hasOwnProperty(propName)){continue}if("production"!=="production"){delete this[propName]}var normalize=Interface[propName];if(normalize){this[propName]=normalize(nativeEvent)}else{if(propName==="target"){this.target=nativeEventTarget}else{this[propName]=nativeEvent[propName]}}}var defaultPrevented=nativeEvent.defaultPrevented!=null?nativeEvent.defaultPrevented:nativeEvent.returnValue===false;if(defaultPrevented){this.isDefaultPrevented=emptyFunction.thatReturnsTrue}else{this.isDefaultPrevented=emptyFunction.thatReturnsFalse}this.isPropagationStopped=emptyFunction.thatReturnsFalse;return this}_assign(SyntheticEvent.prototype,{preventDefault:function(){this.defaultPrevented=true;var event=this.nativeEvent;if(!event){return}if(event.preventDefault){event.preventDefault()}else if(typeof event.returnValue!=="unknown"){event.returnValue=false}this.isDefaultPrevented=emptyFunction.thatReturnsTrue},stopPropagation:function(){var event=this.nativeEvent;if(!event){return}if(event.stopPropagation){event.stopPropagation()}else if(typeof event.cancelBubble!=="unknown"){event.cancelBubble=true}this.isPropagationStopped=emptyFunction.thatReturnsTrue},persist:function(){this.isPersistent=emptyFunction.thatReturnsTrue},isPersistent:emptyFunction.thatReturnsFalse,destructor:function(){var Interface=this.constructor.Interface;for(var propName in Interface){if("production"!=="production"){Object.defineProperty(this,propName,getPooledWarningPropertyDefinition(propName,Interface[propName]))}else{this[propName]=null}}for(var i=0;i<shouldBeReleasedProperties.length;i++){this[shouldBeReleasedProperties[i]]=null}if("production"!=="production"){Object.defineProperty(this,"nativeEvent",getPooledWarningPropertyDefinition("nativeEvent",null));Object.defineProperty(this,"preventDefault",getPooledWarningPropertyDefinition("preventDefault",emptyFunction));Object.defineProperty(this,"stopPropagation",getPooledWarningPropertyDefinition("stopPropagation",emptyFunction))}}});SyntheticEvent.Interface=EventInterface;if("production"!=="production"){if(isProxySupported){SyntheticEvent=new Proxy(SyntheticEvent,{construct:function(target,args){return this.apply(target,Object.create(target.prototype),args)},apply:function(constructor,that,args){return new Proxy(constructor.apply(that,args),{set:function(target,prop,value){if(prop!=="isPersistent"&&!target.constructor.Interface.hasOwnProperty(prop)&&shouldBeReleasedProperties.indexOf(prop)===-1){"production"!=="production"?warning(didWarnForAddedNewProperty||target.isPersistent(),"This synthetic event is reused for performance reasons. If you're "+"seeing this, you're adding a new property in the synthetic event object. "+"The property is never released. See "+"https://fb.me/react-event-pooling for more information."):void 0;didWarnForAddedNewProperty=true}target[prop]=value;return true}})}})}}SyntheticEvent.augmentClass=function(Class,Interface){var Super=this;var E=function(){};E.prototype=Super.prototype;var prototype=new E;_assign(prototype,Class.prototype);Class.prototype=prototype;Class.prototype.constructor=Class;Class.Interface=_assign({},Super.Interface,Interface);Class.augmentClass=Super.augmentClass;PooledClass.addPoolingTo(Class,PooledClass.fourArgumentPooler)};PooledClass.addPoolingTo(SyntheticEvent,PooledClass.fourArgumentPooler);module.exports=SyntheticEvent;function getPooledWarningPropertyDefinition(propName,getVal){var isFunction=typeof getVal==="function";return{configurable:true,set:set,get:get};function set(val){var action=isFunction?"setting the method":"setting the property";warn(action,"This is effectively a no-op");return val}function get(){var action=isFunction?"accessing the method":"accessing the property";var result=isFunction?"This is a no-op function":"This is set to null";warn(action,result);return getVal}function warn(action,result){var warningCondition=false;"production"!=="production"?warning(warningCondition,"This synthetic event is reused for performance reasons. If you're seeing this, "+"you're %s `%s` on a released/nullified synthetic event. %s. "+"If you must keep the original synthetic event around, use event.persist(). "+"See https://fb.me/react-event-pooling for more information.",action,propName,result):void 0}}},{"./PooledClass":797,"fbjs/lib/emptyFunction":398,"fbjs/lib/warning":413,"object-assign":732}],860:[function(require,module,exports){"use strict";var SyntheticUIEvent=require("./SyntheticUIEvent");var FocusEventInterface={relatedTarget:null};function SyntheticFocusEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticUIEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticUIEvent.augmentClass(SyntheticFocusEvent,FocusEventInterface);module.exports=SyntheticFocusEvent},{"./SyntheticUIEvent":866}],861:[function(require,module,exports){"use strict";var SyntheticEvent=require("./SyntheticEvent");var InputEventInterface={data:null};function SyntheticInputEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticEvent.augmentClass(SyntheticInputEvent,InputEventInterface);module.exports=SyntheticInputEvent},{"./SyntheticEvent":859}],862:[function(require,module,exports){"use strict";var SyntheticUIEvent=require("./SyntheticUIEvent");var getEventCharCode=require("./getEventCharCode");var getEventKey=require("./getEventKey");var getEventModifierState=require("./getEventModifierState");var KeyboardEventInterface={key:getEventKey,location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:getEventModifierState,charCode:function(event){if(event.type==="keypress"){return getEventCharCode(event)}return 0},keyCode:function(event){if(event.type==="keydown"||event.type==="keyup"){return event.keyCode}return 0},which:function(event){if(event.type==="keypress"){return getEventCharCode(event)}if(event.type==="keydown"||event.type==="keyup"){return event.keyCode}return 0}};function SyntheticKeyboardEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticUIEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticUIEvent.augmentClass(SyntheticKeyboardEvent,KeyboardEventInterface);module.exports=SyntheticKeyboardEvent},{"./SyntheticUIEvent":866,"./getEventCharCode":879,"./getEventKey":880,"./getEventModifierState":881}],863:[function(require,module,exports){"use strict";var SyntheticUIEvent=require("./SyntheticUIEvent");var ViewportMetrics=require("./ViewportMetrics");var getEventModifierState=require("./getEventModifierState");var MouseEventInterface={screenX:null,screenY:null,clientX:null,clientY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:getEventModifierState,button:function(event){var button=event.button;if("which"in event){return button}return button===2?2:button===4?1:0},buttons:null,relatedTarget:function(event){return event.relatedTarget||(event.fromElement===event.srcElement?event.toElement:event.fromElement)},pageX:function(event){return"pageX"in event?event.pageX:event.clientX+ViewportMetrics.currentScrollLeft},pageY:function(event){return"pageY"in event?event.pageY:event.clientY+ViewportMetrics.currentScrollTop}};function SyntheticMouseEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticUIEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticUIEvent.augmentClass(SyntheticMouseEvent,MouseEventInterface);module.exports=SyntheticMouseEvent},{"./SyntheticUIEvent":866,"./ViewportMetrics":869,"./getEventModifierState":881}],864:[function(require,module,exports){"use strict";var SyntheticUIEvent=require("./SyntheticUIEvent");var getEventModifierState=require("./getEventModifierState");var TouchEventInterface={touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:getEventModifierState};function SyntheticTouchEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticUIEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticUIEvent.augmentClass(SyntheticTouchEvent,TouchEventInterface);module.exports=SyntheticTouchEvent},{"./SyntheticUIEvent":866,"./getEventModifierState":881}],865:[function(require,module,exports){"use strict";var SyntheticEvent=require("./SyntheticEvent");var TransitionEventInterface={propertyName:null,elapsedTime:null,pseudoElement:null};function SyntheticTransitionEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticEvent.augmentClass(SyntheticTransitionEvent,TransitionEventInterface);module.exports=SyntheticTransitionEvent},{"./SyntheticEvent":859}],866:[function(require,module,exports){"use strict";var SyntheticEvent=require("./SyntheticEvent");var getEventTarget=require("./getEventTarget");var UIEventInterface={view:function(event){if(event.view){return event.view}var target=getEventTarget(event);if(target.window===target){return target}var doc=target.ownerDocument;if(doc){return doc.defaultView||doc.parentWindow}else{return window}},detail:function(event){return event.detail||0}};function SyntheticUIEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticEvent.augmentClass(SyntheticUIEvent,UIEventInterface);module.exports=SyntheticUIEvent},{"./SyntheticEvent":859,"./getEventTarget":882}],867:[function(require,module,exports){"use strict";var SyntheticMouseEvent=require("./SyntheticMouseEvent");var WheelEventInterface={deltaX:function(event){return"deltaX"in event?event.deltaX:"wheelDeltaX"in event?-event.wheelDeltaX:0},deltaY:function(event){return"deltaY"in event?event.deltaY:"wheelDeltaY"in event?-event.wheelDeltaY:"wheelDelta"in event?-event.wheelDelta:0},deltaZ:null,deltaMode:null};function SyntheticWheelEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticMouseEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticMouseEvent.augmentClass(SyntheticWheelEvent,WheelEventInterface);module.exports=SyntheticWheelEvent},{"./SyntheticMouseEvent":863}],868:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var invariant=require("fbjs/lib/invariant");var OBSERVED_ERROR={};var TransactionImpl={reinitializeTransaction:function(){this.transactionWrappers=this.getTransactionWrappers();if(this.wrapperInitData){this.wrapperInitData.length=0}else{this.wrapperInitData=[]}this._isInTransaction=false},_isInTransaction:false,getTransactionWrappers:null,isInTransaction:function(){return!!this._isInTransaction},perform:function(method,scope,a,b,c,d,e,f){!!this.isInTransaction()?"production"!=="production"?invariant(false,"Transaction.perform(...): Cannot initialize a transaction when there is already an outstanding transaction."):_prodInvariant("27"):void 0;var errorThrown;var ret;try{this._isInTransaction=true;errorThrown=true;this.initializeAll(0);ret=method.call(scope,a,b,c,d,e,f);errorThrown=false}finally{try{if(errorThrown){try{this.closeAll(0)}catch(err){}}else{this.closeAll(0)}}finally{this._isInTransaction=false}}return ret},initializeAll:function(startIndex){var transactionWrappers=this.transactionWrappers;for(var i=startIndex;i<transactionWrappers.length;i++){var wrapper=transactionWrappers[i];try{this.wrapperInitData[i]=OBSERVED_ERROR;this.wrapperInitData[i]=wrapper.initialize?wrapper.initialize.call(this):null}finally{if(this.wrapperInitData[i]===OBSERVED_ERROR){try{this.initializeAll(i+1)}catch(err){}}}}},closeAll:function(startIndex){!this.isInTransaction()?"production"!=="production"?invariant(false,"Transaction.closeAll(): Cannot close transaction when none are open."):_prodInvariant("28"):void 0;var transactionWrappers=this.transactionWrappers;for(var i=startIndex;i<transactionWrappers.length;i++){var wrapper=transactionWrappers[i];var initData=this.wrapperInitData[i];var errorThrown;try{errorThrown=true;if(initData!==OBSERVED_ERROR&&wrapper.close){wrapper.close.call(this,initData)}errorThrown=false}finally{if(errorThrown){try{this.closeAll(i+1)}catch(e){}}}}this.wrapperInitData.length=0}};module.exports=TransactionImpl},{"./reactProdInvariant":893,"fbjs/lib/invariant":406}],869:[function(require,module,exports){"use strict";var ViewportMetrics={currentScrollLeft:0,currentScrollTop:0,refreshScrollValues:function(scrollPosition){ViewportMetrics.currentScrollLeft=scrollPosition.x;ViewportMetrics.currentScrollTop=scrollPosition.y}};module.exports=ViewportMetrics},{}],870:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var invariant=require("fbjs/lib/invariant");function accumulateInto(current,next){!(next!=null)?"production"!=="production"?invariant(false,"accumulateInto(...): Accumulated items must not be null or undefined."):_prodInvariant("30"):void 0;if(current==null){return next}if(Array.isArray(current)){if(Array.isArray(next)){current.push.apply(current,next);return current}current.push(next);return current}if(Array.isArray(next)){return[current].concat(next)}return[current,next]}module.exports=accumulateInto},{"./reactProdInvariant":893,"fbjs/lib/invariant":406}],871:[function(require,module,exports){"use strict";var MOD=65521;function adler32(data){var a=1;var b=0;var i=0;var l=data.length;var m=l&~3;while(i<m){var n=Math.min(i+4096,m);for(;i<n;i+=4){b+=(a+=data.charCodeAt(i))+(a+=data.charCodeAt(i+1))+(a+=data.charCodeAt(i+2))+(a+=data.charCodeAt(i+3))}a%=MOD;b%=MOD}for(;i<l;i++){b+=a+=data.charCodeAt(i)}a%=MOD;b%=MOD;return a|b<<16}module.exports=adler32},{}],872:[function(require,module,exports){(function(process){"use strict";var _prodInvariant=require("./reactProdInvariant");var ReactPropTypeLocationNames=require("./ReactPropTypeLocationNames");var ReactPropTypesSecret=require("./ReactPropTypesSecret");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");var ReactComponentTreeHook;if(typeof process!=="undefined"&&process.env&&"production"==="test"){ReactComponentTreeHook=require("react/lib/ReactComponentTreeHook")}var loggedTypeFailures={};function checkReactTypeSpec(typeSpecs,values,location,componentName,element,debugID){for(var typeSpecName in typeSpecs){if(typeSpecs.hasOwnProperty(typeSpecName)){var error;try{!(typeof typeSpecs[typeSpecName]==="function")?"production"!=="production"?invariant(false,"%s: %s type `%s` is invalid; it must be a function, usually from React.PropTypes.",componentName||"React class",ReactPropTypeLocationNames[location],typeSpecName):_prodInvariant("84",componentName||"React class",ReactPropTypeLocationNames[location],typeSpecName):void 0;error=typeSpecs[typeSpecName](values,typeSpecName,componentName,location,null,ReactPropTypesSecret)}catch(ex){error=ex}"production"!=="production"?warning(!error||error instanceof Error,"%s: type specification of %s `%s` is invalid; the type checker "+"function must return `null` or an `Error` but returned a %s. "+"You may have forgotten to pass an argument to the type checker "+"creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and "+"shape all require an argument).",componentName||"React class",ReactPropTypeLocationNames[location],typeSpecName,typeof error):void 0;if(error instanceof Error&&!(error.message in loggedTypeFailures)){loggedTypeFailures[error.message]=true;var componentStackInfo="";if("production"!=="production"){if(!ReactComponentTreeHook){ReactComponentTreeHook=require("react/lib/ReactComponentTreeHook")}if(debugID!==null){componentStackInfo=ReactComponentTreeHook.getStackAddendumByID(debugID)}else if(element!==null){componentStackInfo=ReactComponentTreeHook.getCurrentStackAddendum(element)}}"production"!=="production"?warning(false,"Failed %s type: %s%s",location,error.message,componentStackInfo):void 0}}}}module.exports=checkReactTypeSpec}).call(this,require("_process"))},{"./ReactPropTypeLocationNames":842,"./ReactPropTypesSecret":843,"./reactProdInvariant":893,_process:11,"fbjs/lib/invariant":406,"fbjs/lib/warning":413,"react/lib/ReactComponentTreeHook":930}],873:[function(require,module,exports){"use strict";var createMicrosoftUnsafeLocalFunction=function(func){if(typeof MSApp!=="undefined"&&MSApp.execUnsafeLocalFunction){return function(arg0,arg1,arg2,arg3){MSApp.execUnsafeLocalFunction(function(){return func(arg0,arg1,arg2,arg3)})}}else{return func}};module.exports=createMicrosoftUnsafeLocalFunction},{}],874:[function(require,module,exports){"use strict";var CSSProperty=require("./CSSProperty");var warning=require("fbjs/lib/warning");var isUnitlessNumber=CSSProperty.isUnitlessNumber;var styleWarnings={};function dangerousStyleValue(name,value,component){var isEmpty=value==null||typeof value==="boolean"||value==="";if(isEmpty){return""}var isNonNumeric=isNaN(value);if(isNonNumeric||value===0||isUnitlessNumber.hasOwnProperty(name)&&isUnitlessNumber[name]){return""+value}if(typeof value==="string"){if("production"!=="production"){if(component&&value!=="0"){var owner=component._currentElement._owner;var ownerName=owner?owner.getName():null;if(ownerName&&!styleWarnings[ownerName]){styleWarnings[ownerName]={}}var warned=false;if(ownerName){var warnings=styleWarnings[ownerName];warned=warnings[name];if(!warned){warnings[name]=true}}if(!warned){"production"!=="production"?warning(false,"a `%s` tag (owner: `%s`) was passed a numeric string value "+"for CSS property `%s` (value: `%s`) which will be treated "+"as a unitless number in a future version of React.",component._currentElement.type,ownerName||"unknown",name,value):void 0}}}value=value.trim()}return value+"px"}module.exports=dangerousStyleValue},{"./CSSProperty":777,"fbjs/lib/warning":413}],875:[function(require,module,exports){"use strict";var matchHtmlRegExp=/["'&<>]/;function escapeHtml(string){var str=""+string;var match=matchHtmlRegExp.exec(str);if(!match){return str}var escape;var html="";var index=0;var lastIndex=0;for(index=match.index;index<str.length;index++){switch(str.charCodeAt(index)){case 34:escape="&quot;";break;case 38:escape="&amp;";break;case 39:escape="&#x27;";break;case 60:escape="&lt;";break;case 62:escape="&gt;";break;default:continue}if(lastIndex!==index){html+=str.substring(lastIndex,index)}lastIndex=index+1;html+=escape}return lastIndex!==index?html+str.substring(lastIndex,index):html}function escapeTextContentForBrowser(text){if(typeof text==="boolean"||typeof text==="number"){return""+text}return escapeHtml(text)}module.exports=escapeTextContentForBrowser},{}],876:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var ReactCurrentOwner=require("react/lib/ReactCurrentOwner");var ReactDOMComponentTree=require("./ReactDOMComponentTree");var ReactInstanceMap=require("./ReactInstanceMap");var getHostComponentFromComposite=require("./getHostComponentFromComposite");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");function findDOMNode(componentOrElement){if("production"!=="production"){var owner=ReactCurrentOwner.current;if(owner!==null){"production"!=="production"?warning(owner._warnedAboutRefsInRender,"%s is accessing findDOMNode inside its render(). "+"render() should be a pure function of props and state. It should "+"never access something that requires stale data from the previous "+"render, such as refs. Move this logic to componentDidMount and "+"componentDidUpdate instead.",owner.getName()||"A component"):void 0;owner._warnedAboutRefsInRender=true}}if(componentOrElement==null){return null}if(componentOrElement.nodeType===1){return componentOrElement}var inst=ReactInstanceMap.get(componentOrElement);if(inst){inst=getHostComponentFromComposite(inst);return inst?ReactDOMComponentTree.getNodeFromInstance(inst):null}if(typeof componentOrElement.render==="function"){!false?"production"!=="production"?invariant(false,"findDOMNode was called on an unmounted component."):_prodInvariant("44"):void 0}else{!false?"production"!=="production"?invariant(false,"Element appears to be neither ReactComponent nor DOMNode (keys: %s)",Object.keys(componentOrElement)):_prodInvariant("45",Object.keys(componentOrElement)):void 0}}module.exports=findDOMNode},{"./ReactDOMComponentTree":806,"./ReactInstanceMap":834,"./getHostComponentFromComposite":883,"./reactProdInvariant":893,"fbjs/lib/invariant":406,"fbjs/lib/warning":413,"react/lib/ReactCurrentOwner":931}],877:[function(require,module,exports){(function(process){"use strict";var KeyEscapeUtils=require("./KeyEscapeUtils");var traverseAllChildren=require("./traverseAllChildren");var warning=require("fbjs/lib/warning");var ReactComponentTreeHook;if(typeof process!=="undefined"&&process.env&&"production"==="test"){ReactComponentTreeHook=require("react/lib/ReactComponentTreeHook")}function flattenSingleChildIntoContext(traverseContext,child,name,selfDebugID){if(traverseContext&&typeof traverseContext==="object"){var result=traverseContext;var keyUnique=result[name]===undefined;if("production"!=="production"){if(!ReactComponentTreeHook){ReactComponentTreeHook=require("react/lib/ReactComponentTreeHook")}if(!keyUnique){"production"!=="production"?warning(false,"flattenChildren(...): Encountered two children with the same key, "+"`%s`. Child keys must be unique; when two children share a key, only "+"the first child will be used.%s",KeyEscapeUtils.unescape(name),ReactComponentTreeHook.getStackAddendumByID(selfDebugID)):void 0}}if(keyUnique&&child!=null){result[name]=child}}}function flattenChildren(children,selfDebugID){if(children==null){return children}var result={};if("production"!=="production"){traverseAllChildren(children,function(traverseContext,child,name){return flattenSingleChildIntoContext(traverseContext,child,name,selfDebugID)},result)}else{traverseAllChildren(children,flattenSingleChildIntoContext,result)}return result}module.exports=flattenChildren}).call(this,require("_process"))},{"./KeyEscapeUtils":795,"./traverseAllChildren":898,_process:11,"fbjs/lib/warning":413,"react/lib/ReactComponentTreeHook":930}],878:[function(require,module,exports){"use strict";function forEachAccumulated(arr,cb,scope){if(Array.isArray(arr)){arr.forEach(cb,scope)}else if(arr){cb.call(scope,arr)}}module.exports=forEachAccumulated},{}],879:[function(require,module,exports){"use strict";function getEventCharCode(nativeEvent){var charCode;var keyCode=nativeEvent.keyCode;if("charCode"in nativeEvent){charCode=nativeEvent.charCode;if(charCode===0&&keyCode===13){charCode=13}}else{charCode=keyCode}if(charCode>=32||charCode===13){return charCode}return 0}module.exports=getEventCharCode},{}],880:[function(require,module,exports){"use strict";var getEventCharCode=require("./getEventCharCode");var normalizeKey={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"};var translateToKey={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};function getEventKey(nativeEvent){if(nativeEvent.key){var key=normalizeKey[nativeEvent.key]||nativeEvent.key;if(key!=="Unidentified"){return key}}if(nativeEvent.type==="keypress"){var charCode=getEventCharCode(nativeEvent);return charCode===13?"Enter":String.fromCharCode(charCode)}if(nativeEvent.type==="keydown"||nativeEvent.type==="keyup"){return translateToKey[nativeEvent.keyCode]||"Unidentified"}return""}module.exports=getEventKey},{"./getEventCharCode":879}],881:[function(require,module,exports){"use strict";var modifierKeyToProp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function modifierStateGetter(keyArg){var syntheticEvent=this;var nativeEvent=syntheticEvent.nativeEvent;if(nativeEvent.getModifierState){return nativeEvent.getModifierState(keyArg)}var keyProp=modifierKeyToProp[keyArg];return keyProp?!!nativeEvent[keyProp]:false}function getEventModifierState(nativeEvent){return modifierStateGetter}module.exports=getEventModifierState},{}],882:[function(require,module,exports){"use strict";function getEventTarget(nativeEvent){var target=nativeEvent.target||nativeEvent.srcElement||window;if(target.correspondingUseElement){target=target.correspondingUseElement}return target.nodeType===3?target.parentNode:target}module.exports=getEventTarget},{}],883:[function(require,module,exports){"use strict";var ReactNodeTypes=require("./ReactNodeTypes");function getHostComponentFromComposite(inst){var type;while((type=inst._renderedNodeType)===ReactNodeTypes.COMPOSITE){inst=inst._renderedComponent}if(type===ReactNodeTypes.HOST){return inst._renderedComponent}else if(type===ReactNodeTypes.EMPTY){return null}}module.exports=getHostComponentFromComposite},{"./ReactNodeTypes":840}],884:[function(require,module,exports){"use strict";var ITERATOR_SYMBOL=typeof Symbol==="function"&&Symbol.iterator;var FAUX_ITERATOR_SYMBOL="@@iterator";function getIteratorFn(maybeIterable){var iteratorFn=maybeIterable&&(ITERATOR_SYMBOL&&maybeIterable[ITERATOR_SYMBOL]||maybeIterable[FAUX_ITERATOR_SYMBOL]);if(typeof iteratorFn==="function"){return iteratorFn}}module.exports=getIteratorFn},{}],885:[function(require,module,exports){"use strict";var nextDebugID=1;function getNextDebugID(){return nextDebugID++}module.exports=getNextDebugID},{}],886:[function(require,module,exports){"use strict";function getLeafNode(node){while(node&&node.firstChild){node=node.firstChild}return node}function getSiblingNode(node){while(node){if(node.nextSibling){return node.nextSibling}node=node.parentNode}}function getNodeForCharacterOffset(root,offset){var node=getLeafNode(root);var nodeStart=0;var nodeEnd=0;while(node){if(node.nodeType===3){nodeEnd=nodeStart+node.textContent.length;if(nodeStart<=offset&&nodeEnd>=offset){return{node:node,offset:offset-nodeStart}}nodeStart=nodeEnd}node=getLeafNode(getSiblingNode(node))}}module.exports=getNodeForCharacterOffset},{}],887:[function(require,module,exports){"use strict";var ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment");var contentKey=null;function getTextContentAccessor(){if(!contentKey&&ExecutionEnvironment.canUseDOM){contentKey="textContent"in document.documentElement?"textContent":"innerText"}return contentKey}module.exports=getTextContentAccessor},{"fbjs/lib/ExecutionEnvironment":392}],888:[function(require,module,exports){"use strict";var ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment");function makePrefixMap(styleProp,eventName){var prefixes={};prefixes[styleProp.toLowerCase()]=eventName.toLowerCase();prefixes["Webkit"+styleProp]="webkit"+eventName;prefixes["Moz"+styleProp]="moz"+eventName;prefixes["ms"+styleProp]="MS"+eventName;prefixes["O"+styleProp]="o"+eventName.toLowerCase();return prefixes}var vendorPrefixes={animationend:makePrefixMap("Animation","AnimationEnd"),animationiteration:makePrefixMap("Animation","AnimationIteration"),animationstart:makePrefixMap("Animation","AnimationStart"),transitionend:makePrefixMap("Transition","TransitionEnd")};var prefixedEventNames={};var style={};if(ExecutionEnvironment.canUseDOM){style=document.createElement("div").style;if(!("AnimationEvent"in window)){delete vendorPrefixes.animationend.animation;delete vendorPrefixes.animationiteration.animation;delete vendorPrefixes.animationstart.animation}if(!("TransitionEvent"in window)){delete vendorPrefixes.transitionend.transition}}function getVendorPrefixedEventName(eventName){if(prefixedEventNames[eventName]){return prefixedEventNames[eventName]}else if(!vendorPrefixes[eventName]){return eventName}var prefixMap=vendorPrefixes[eventName];for(var styleProp in prefixMap){if(prefixMap.hasOwnProperty(styleProp)&&styleProp in style){return prefixedEventNames[eventName]=prefixMap[styleProp]}}return""}module.exports=getVendorPrefixedEventName},{"fbjs/lib/ExecutionEnvironment":392}],889:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant"),_assign=require("object-assign");var ReactCompositeComponent=require("./ReactCompositeComponent");var ReactEmptyComponent=require("./ReactEmptyComponent");var ReactHostComponent=require("./ReactHostComponent");var getNextDebugID=require("./getNextDebugID");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");var ReactCompositeComponentWrapper=function(element){this.construct(element)};_assign(ReactCompositeComponentWrapper.prototype,ReactCompositeComponent,{_instantiateReactComponent:instantiateReactComponent});function getDeclarationErrorAddendum(owner){if(owner){var name=owner.getName();if(name){return" Check the render method of `"+name+"`."}}return"";
}function isInternalComponentType(type){return typeof type==="function"&&typeof type.prototype!=="undefined"&&typeof type.prototype.mountComponent==="function"&&typeof type.prototype.receiveComponent==="function"}function instantiateReactComponent(node,shouldHaveDebugID){var instance;if(node===null||node===false){instance=ReactEmptyComponent.create(instantiateReactComponent)}else if(typeof node==="object"){var element=node;var type=element.type;if(typeof type!=="function"&&typeof type!=="string"){var info="";if("production"!=="production"){if(type===undefined||typeof type==="object"&&type!==null&&Object.keys(type).length===0){info+=" You likely forgot to export your component from the file "+"it's defined in."}}info+=getDeclarationErrorAddendum(element._owner);!false?"production"!=="production"?invariant(false,"Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",type==null?type:typeof type,info):_prodInvariant("130",type==null?type:typeof type,info):void 0}if(typeof element.type==="string"){instance=ReactHostComponent.createInternalComponent(element)}else if(isInternalComponentType(element.type)){instance=new element.type(element);if(!instance.getHostNode){instance.getHostNode=instance.getNativeNode}}else{instance=new ReactCompositeComponentWrapper(element)}}else if(typeof node==="string"||typeof node==="number"){instance=ReactHostComponent.createInstanceForText(node)}else{!false?"production"!=="production"?invariant(false,"Encountered invalid React node of type %s",typeof node):_prodInvariant("131",typeof node):void 0}if("production"!=="production"){"production"!=="production"?warning(typeof instance.mountComponent==="function"&&typeof instance.receiveComponent==="function"&&typeof instance.getHostNode==="function"&&typeof instance.unmountComponent==="function","Only React Components can be mounted."):void 0}instance._mountIndex=0;instance._mountImage=null;if("production"!=="production"){instance._debugID=shouldHaveDebugID?getNextDebugID():0}if("production"!=="production"){if(Object.preventExtensions){Object.preventExtensions(instance)}}return instance}module.exports=instantiateReactComponent},{"./ReactCompositeComponent":802,"./ReactEmptyComponent":825,"./ReactHostComponent":830,"./getNextDebugID":885,"./reactProdInvariant":893,"fbjs/lib/invariant":406,"fbjs/lib/warning":413,"object-assign":732}],890:[function(require,module,exports){"use strict";var ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment");var useHasFeature;if(ExecutionEnvironment.canUseDOM){useHasFeature=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==true}function isEventSupported(eventNameSuffix,capture){if(!ExecutionEnvironment.canUseDOM||capture&&!("addEventListener"in document)){return false}var eventName="on"+eventNameSuffix;var isSupported=eventName in document;if(!isSupported){var element=document.createElement("div");element.setAttribute(eventName,"return;");isSupported=typeof element[eventName]==="function"}if(!isSupported&&useHasFeature&&eventNameSuffix==="wheel"){isSupported=document.implementation.hasFeature("Events.wheel","3.0")}return isSupported}module.exports=isEventSupported},{"fbjs/lib/ExecutionEnvironment":392}],891:[function(require,module,exports){"use strict";var supportedInputTypes={color:true,date:true,datetime:true,"datetime-local":true,email:true,month:true,number:true,password:true,range:true,search:true,tel:true,text:true,time:true,url:true,week:true};function isTextInputElement(elem){var nodeName=elem&&elem.nodeName&&elem.nodeName.toLowerCase();if(nodeName==="input"){return!!supportedInputTypes[elem.type]}if(nodeName==="textarea"){return true}return false}module.exports=isTextInputElement},{}],892:[function(require,module,exports){"use strict";var escapeTextContentForBrowser=require("./escapeTextContentForBrowser");function quoteAttributeValueForBrowser(value){return'"'+escapeTextContentForBrowser(value)+'"'}module.exports=quoteAttributeValueForBrowser},{"./escapeTextContentForBrowser":875}],893:[function(require,module,exports){"use strict";function reactProdInvariant(code){var argCount=arguments.length-1;var message="Minified React error #"+code+"; visit "+"http://facebook.github.io/react/docs/error-decoder.html?invariant="+code;for(var argIdx=0;argIdx<argCount;argIdx++){message+="&args[]="+encodeURIComponent(arguments[argIdx+1])}message+=" for the full message or use the non-minified dev environment"+" for full errors and additional helpful warnings.";var error=new Error(message);error.name="Invariant Violation";error.framesToPop=1;throw error}module.exports=reactProdInvariant},{}],894:[function(require,module,exports){"use strict";var ReactMount=require("./ReactMount");module.exports=ReactMount.renderSubtreeIntoContainer},{"./ReactMount":838}],895:[function(require,module,exports){"use strict";var ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment");var DOMNamespaces=require("./DOMNamespaces");var WHITESPACE_TEST=/^[ \r\n\t\f]/;var NONVISIBLE_TEST=/<(!--|link|noscript|meta|script|style)[ \r\n\t\f\/>]/;var createMicrosoftUnsafeLocalFunction=require("./createMicrosoftUnsafeLocalFunction");var reusableSVGContainer;var setInnerHTML=createMicrosoftUnsafeLocalFunction(function(node,html){if(node.namespaceURI===DOMNamespaces.svg&&!("innerHTML"in node)){reusableSVGContainer=reusableSVGContainer||document.createElement("div");reusableSVGContainer.innerHTML="<svg>"+html+"</svg>";var svgNode=reusableSVGContainer.firstChild;while(svgNode.firstChild){node.appendChild(svgNode.firstChild)}}else{node.innerHTML=html}});if(ExecutionEnvironment.canUseDOM){var testElement=document.createElement("div");testElement.innerHTML=" ";if(testElement.innerHTML===""){setInnerHTML=function(node,html){if(node.parentNode){node.parentNode.replaceChild(node,node)}if(WHITESPACE_TEST.test(html)||html[0]==="<"&&NONVISIBLE_TEST.test(html)){node.innerHTML=String.fromCharCode(65279)+html;var textNode=node.firstChild;if(textNode.data.length===1){node.removeChild(textNode)}else{textNode.deleteData(0,1)}}else{node.innerHTML=html}}}testElement=null}module.exports=setInnerHTML},{"./DOMNamespaces":783,"./createMicrosoftUnsafeLocalFunction":873,"fbjs/lib/ExecutionEnvironment":392}],896:[function(require,module,exports){"use strict";var ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment");var escapeTextContentForBrowser=require("./escapeTextContentForBrowser");var setInnerHTML=require("./setInnerHTML");var setTextContent=function(node,text){if(text){var firstChild=node.firstChild;if(firstChild&&firstChild===node.lastChild&&firstChild.nodeType===3){firstChild.nodeValue=text;return}}node.textContent=text};if(ExecutionEnvironment.canUseDOM){if(!("textContent"in document.documentElement)){setTextContent=function(node,text){if(node.nodeType===3){node.nodeValue=text;return}setInnerHTML(node,escapeTextContentForBrowser(text))}}}module.exports=setTextContent},{"./escapeTextContentForBrowser":875,"./setInnerHTML":895,"fbjs/lib/ExecutionEnvironment":392}],897:[function(require,module,exports){"use strict";function shouldUpdateReactComponent(prevElement,nextElement){var prevEmpty=prevElement===null||prevElement===false;var nextEmpty=nextElement===null||nextElement===false;if(prevEmpty||nextEmpty){return prevEmpty===nextEmpty}var prevType=typeof prevElement;var nextType=typeof nextElement;if(prevType==="string"||prevType==="number"){return nextType==="string"||nextType==="number"}else{return nextType==="object"&&prevElement.type===nextElement.type&&prevElement.key===nextElement.key}}module.exports=shouldUpdateReactComponent},{}],898:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var ReactCurrentOwner=require("react/lib/ReactCurrentOwner");var REACT_ELEMENT_TYPE=require("./ReactElementSymbol");var getIteratorFn=require("./getIteratorFn");var invariant=require("fbjs/lib/invariant");var KeyEscapeUtils=require("./KeyEscapeUtils");var warning=require("fbjs/lib/warning");var SEPARATOR=".";var SUBSEPARATOR=":";var didWarnAboutMaps=false;function getComponentKey(component,index){if(component&&typeof component==="object"&&component.key!=null){return KeyEscapeUtils.escape(component.key)}return index.toString(36)}function traverseAllChildrenImpl(children,nameSoFar,callback,traverseContext){var type=typeof children;if(type==="undefined"||type==="boolean"){children=null}if(children===null||type==="string"||type==="number"||type==="object"&&children.$$typeof===REACT_ELEMENT_TYPE){callback(traverseContext,children,nameSoFar===""?SEPARATOR+getComponentKey(children,0):nameSoFar);return 1}var child;var nextName;var subtreeCount=0;var nextNamePrefix=nameSoFar===""?SEPARATOR:nameSoFar+SUBSEPARATOR;if(Array.isArray(children)){for(var i=0;i<children.length;i++){child=children[i];nextName=nextNamePrefix+getComponentKey(child,i);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext)}}else{var iteratorFn=getIteratorFn(children);if(iteratorFn){var iterator=iteratorFn.call(children);var step;if(iteratorFn!==children.entries){var ii=0;while(!(step=iterator.next()).done){child=step.value;nextName=nextNamePrefix+getComponentKey(child,ii++);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext)}}else{if("production"!=="production"){var mapsAsChildrenAddendum="";if(ReactCurrentOwner.current){var mapsAsChildrenOwnerName=ReactCurrentOwner.current.getName();if(mapsAsChildrenOwnerName){mapsAsChildrenAddendum=" Check the render method of `"+mapsAsChildrenOwnerName+"`."}}"production"!=="production"?warning(didWarnAboutMaps,"Using Maps as children is not yet fully supported. It is an "+"experimental feature that might be removed. Convert it to a "+"sequence / iterable of keyed ReactElements instead.%s",mapsAsChildrenAddendum):void 0;didWarnAboutMaps=true}while(!(step=iterator.next()).done){var entry=step.value;if(entry){child=entry[1];nextName=nextNamePrefix+KeyEscapeUtils.escape(entry[0])+SUBSEPARATOR+getComponentKey(child,0);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext)}}}}else if(type==="object"){var addendum="";if("production"!=="production"){addendum=" If you meant to render a collection of children, use an array "+"instead or wrap the object using createFragment(object) from the "+"React add-ons.";if(children._isReactElement){addendum=" It looks like you're using an element created by a different "+"version of React. Make sure to use only one copy of React."}if(ReactCurrentOwner.current){var name=ReactCurrentOwner.current.getName();if(name){addendum+=" Check the render method of `"+name+"`."}}}var childrenString=String(children);!false?"production"!=="production"?invariant(false,"Objects are not valid as a React child (found: %s).%s",childrenString==="[object Object]"?"object with keys {"+Object.keys(children).join(", ")+"}":childrenString,addendum):_prodInvariant("31",childrenString==="[object Object]"?"object with keys {"+Object.keys(children).join(", ")+"}":childrenString,addendum):void 0}}return subtreeCount}function traverseAllChildren(children,callback,traverseContext){if(children==null){return 0}return traverseAllChildrenImpl(children,"",callback,traverseContext)}module.exports=traverseAllChildren},{"./KeyEscapeUtils":795,"./ReactElementSymbol":824,"./getIteratorFn":884,"./reactProdInvariant":893,"fbjs/lib/invariant":406,"fbjs/lib/warning":413,"react/lib/ReactCurrentOwner":931}],899:[function(require,module,exports){"use strict";var _assign=require("object-assign");var emptyFunction=require("fbjs/lib/emptyFunction");var warning=require("fbjs/lib/warning");var validateDOMNesting=emptyFunction;if("production"!=="production"){var specialTags=["address","applet","area","article","aside","base","basefont","bgsound","blockquote","body","br","button","caption","center","col","colgroup","dd","details","dir","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","img","input","isindex","li","link","listing","main","marquee","menu","menuitem","meta","nav","noembed","noframes","noscript","object","ol","p","param","plaintext","pre","script","section","select","source","style","summary","table","tbody","td","template","textarea","tfoot","th","thead","title","tr","track","ul","wbr","xmp"];var inScopeTags=["applet","caption","html","table","td","th","marquee","object","template","foreignObject","desc","title"];var buttonScopeTags=inScopeTags.concat(["button"]);var impliedEndTags=["dd","dt","li","option","optgroup","p","rp","rt"];var emptyAncestorInfo={current:null,formTag:null,aTagInScope:null,buttonTagInScope:null,nobrTagInScope:null,pTagInButtonScope:null,listItemTagAutoclosing:null,dlItemTagAutoclosing:null};var updatedAncestorInfo=function(oldInfo,tag,instance){var ancestorInfo=_assign({},oldInfo||emptyAncestorInfo);var info={tag:tag,instance:instance};if(inScopeTags.indexOf(tag)!==-1){ancestorInfo.aTagInScope=null;ancestorInfo.buttonTagInScope=null;ancestorInfo.nobrTagInScope=null}if(buttonScopeTags.indexOf(tag)!==-1){ancestorInfo.pTagInButtonScope=null}if(specialTags.indexOf(tag)!==-1&&tag!=="address"&&tag!=="div"&&tag!=="p"){ancestorInfo.listItemTagAutoclosing=null;ancestorInfo.dlItemTagAutoclosing=null}ancestorInfo.current=info;if(tag==="form"){ancestorInfo.formTag=info}if(tag==="a"){ancestorInfo.aTagInScope=info}if(tag==="button"){ancestorInfo.buttonTagInScope=info}if(tag==="nobr"){ancestorInfo.nobrTagInScope=info}if(tag==="p"){ancestorInfo.pTagInButtonScope=info}if(tag==="li"){ancestorInfo.listItemTagAutoclosing=info}if(tag==="dd"||tag==="dt"){ancestorInfo.dlItemTagAutoclosing=info}return ancestorInfo};var isTagValidWithParent=function(tag,parentTag){switch(parentTag){case"select":return tag==="option"||tag==="optgroup"||tag==="#text";case"optgroup":return tag==="option"||tag==="#text";case"option":return tag==="#text";case"tr":return tag==="th"||tag==="td"||tag==="style"||tag==="script"||tag==="template";case"tbody":case"thead":case"tfoot":return tag==="tr"||tag==="style"||tag==="script"||tag==="template";case"colgroup":return tag==="col"||tag==="template";case"table":return tag==="caption"||tag==="colgroup"||tag==="tbody"||tag==="tfoot"||tag==="thead"||tag==="style"||tag==="script"||tag==="template";case"head":return tag==="base"||tag==="basefont"||tag==="bgsound"||tag==="link"||tag==="meta"||tag==="title"||tag==="noscript"||tag==="noframes"||tag==="style"||tag==="script"||tag==="template";case"html":return tag==="head"||tag==="body";case"#document":return tag==="html"}switch(tag){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return parentTag!=="h1"&&parentTag!=="h2"&&parentTag!=="h3"&&parentTag!=="h4"&&parentTag!=="h5"&&parentTag!=="h6";case"rp":case"rt":return impliedEndTags.indexOf(parentTag)===-1;case"body":case"caption":case"col":case"colgroup":case"frame":case"head":case"html":case"tbody":case"td":case"tfoot":case"th":case"thead":case"tr":return parentTag==null}return true};var findInvalidAncestorForTag=function(tag,ancestorInfo){switch(tag){case"address":case"article":case"aside":case"blockquote":case"center":case"details":case"dialog":case"dir":case"div":case"dl":case"fieldset":case"figcaption":case"figure":case"footer":case"header":case"hgroup":case"main":case"menu":case"nav":case"ol":case"p":case"section":case"summary":case"ul":case"pre":case"listing":case"table":case"hr":case"xmp":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return ancestorInfo.pTagInButtonScope;case"form":return ancestorInfo.formTag||ancestorInfo.pTagInButtonScope;case"li":return ancestorInfo.listItemTagAutoclosing;case"dd":case"dt":return ancestorInfo.dlItemTagAutoclosing;case"button":return ancestorInfo.buttonTagInScope;case"a":return ancestorInfo.aTagInScope;case"nobr":return ancestorInfo.nobrTagInScope}return null};var findOwnerStack=function(instance){if(!instance){return[]}var stack=[];do{stack.push(instance)}while(instance=instance._currentElement._owner);stack.reverse();return stack};var didWarn={};validateDOMNesting=function(childTag,childText,childInstance,ancestorInfo){ancestorInfo=ancestorInfo||emptyAncestorInfo;var parentInfo=ancestorInfo.current;var parentTag=parentInfo&&parentInfo.tag;if(childText!=null){"production"!=="production"?warning(childTag==null,"validateDOMNesting: when childText is passed, childTag should be null"):void 0;childTag="#text"}var invalidParent=isTagValidWithParent(childTag,parentTag)?null:parentInfo;var invalidAncestor=invalidParent?null:findInvalidAncestorForTag(childTag,ancestorInfo);var problematic=invalidParent||invalidAncestor;if(problematic){var ancestorTag=problematic.tag;var ancestorInstance=problematic.instance;var childOwner=childInstance&&childInstance._currentElement._owner;var ancestorOwner=ancestorInstance&&ancestorInstance._currentElement._owner;var childOwners=findOwnerStack(childOwner);var ancestorOwners=findOwnerStack(ancestorOwner);var minStackLen=Math.min(childOwners.length,ancestorOwners.length);var i;var deepestCommon=-1;for(i=0;i<minStackLen;i++){if(childOwners[i]===ancestorOwners[i]){deepestCommon=i}else{break}}var UNKNOWN="(unknown)";var childOwnerNames=childOwners.slice(deepestCommon+1).map(function(inst){return inst.getName()||UNKNOWN});var ancestorOwnerNames=ancestorOwners.slice(deepestCommon+1).map(function(inst){return inst.getName()||UNKNOWN});var ownerInfo=[].concat(deepestCommon!==-1?childOwners[deepestCommon].getName()||UNKNOWN:[],ancestorOwnerNames,ancestorTag,invalidAncestor?["..."]:[],childOwnerNames,childTag).join(" > ");var warnKey=!!invalidParent+"|"+childTag+"|"+ancestorTag+"|"+ownerInfo;if(didWarn[warnKey]){return}didWarn[warnKey]=true;var tagDisplayName=childTag;var whitespaceInfo="";if(childTag==="#text"){if(/\S/.test(childText)){tagDisplayName="Text nodes"}else{tagDisplayName="Whitespace text nodes";whitespaceInfo=" Make sure you don't have any extra whitespace between tags on "+"each line of your source code."}}else{tagDisplayName="<"+childTag+">"}if(invalidParent){var info="";if(ancestorTag==="table"&&childTag==="tr"){info+=" Add a <tbody> to your code to match the DOM tree generated by "+"the browser."}"production"!=="production"?warning(false,"validateDOMNesting(...): %s cannot appear as a child of <%s>.%s "+"See %s.%s",tagDisplayName,ancestorTag,whitespaceInfo,ownerInfo,info):void 0}else{"production"!=="production"?warning(false,"validateDOMNesting(...): %s cannot appear as a descendant of "+"<%s>. See %s.",tagDisplayName,ancestorTag,ownerInfo):void 0}}};validateDOMNesting.updatedAncestorInfo=updatedAncestorInfo;validateDOMNesting.isTagValidInContext=function(tag,ancestorInfo){ancestorInfo=ancestorInfo||emptyAncestorInfo;var parentInfo=ancestorInfo.current;var parentTag=parentInfo&&parentInfo.tag;return isTagValidWithParent(tag,parentTag)&&!findInvalidAncestorForTag(tag,ancestorInfo)}}module.exports=validateDOMNesting},{"fbjs/lib/emptyFunction":398,"fbjs/lib/warning":413,"object-assign":732}],900:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _bowser=require("bowser");var _bowser2=_interopRequireDefault(_bowser);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PREFIX=_bowser2.default.webkit||_bowser2.default.blink?"-webkit-":_bowser2.default.gecko?"-moz-":"";exports.default={DEFAULTS:{},MAPBOX_API_ACCESS_TOKEN:null,CURSOR:{GRABBING:PREFIX+"grabbing",GRAB:PREFIX+"grab",POINTER:"pointer"}}},{bowser:5}],901:[function(require,module,exports){"use strict";var _map=require("./map.react");var _map2=_interopRequireDefault(_map);var _overlays=require("./overlays");var overlays=_interopRequireWildcard(_overlays);var _fitBounds=require("./utils/fit-bounds");var _fitBounds2=_interopRequireDefault(_fitBounds);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports=_map2.default;module.exports.fitBounds=_fitBounds2.default;Object.assign(module.exports,overlays)},{"./map.react":903,"./overlays":908,"./utils/fit-bounds":912}],902:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class,_class2,_temp;var _react=require("react");var _react2=_interopRequireDefault(_react);var _autobindDecorator=require("autobind-decorator");var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);var _document=require("global/document");var _document2=_interopRequireDefault(_document);var _window=require("global/window");var _window2=_interopRequireDefault(_window);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}function noop(){}var ua=typeof _window2.default.navigator!=="undefined"?_window2.default.navigator.userAgent.toLowerCase():"";var firefox=ua.indexOf("firefox")!==-1;function getMousePosition(el,event){var rect=el.getBoundingClientRect();event=event.touches?event.touches[0]:event;return[event.clientX-rect.left-el.clientLeft,event.clientY-rect.top-el.clientTop]}function getTouchPositions(el,event){var points=[];var rect=el.getBoundingClientRect();var touches=getTouches(event);for(var i=0;i<touches.length;i++){points.push([touches[i].clientX-rect.left-el.clientLeft,touches[i].clientY-rect.top-el.clientTop])}return points}function getTouches(event){var type=event.type;if(type==="touchend"||type==="touchcancel"){return event.changedTouches}return event.touches}function centroid(positions){var sum=positions.reduce(function(acc,elt){return[acc[0]+elt[0],acc[1]+elt[1]]},[0,0]);return[sum[0]/positions.length,sum[1]/positions.length]}var Interactions=(_class=(_temp=_class2=function(_Component){_inherits(Interactions,_Component);function Interactions(props){_classCallCheck(this,Interactions);var _this=_possibleConstructorReturn(this,(Interactions.__proto__||Object.getPrototypeOf(Interactions)).call(this,props));_this.state={didDrag:false,isFunctionKeyPressed:false,startPos:null,pos:null,mouseWheelPos:null};return _this}_createClass(Interactions,[{key:"_getMousePos",value:function _getMousePos(event){var el=this.refs.container;return getMousePosition(el,event)}},{key:"_getTouchPos",value:function _getTouchPos(event){var el=this.refs.container;var positions=getTouchPositions(el,event);return centroid(positions)}},{key:"_isFunctionKeyPressed",value:function _isFunctionKeyPressed(event){return Boolean(event.metaKey||event.altKey||event.ctrlKey||event.shiftKey)}},{key:"_onMouseDown",value:function _onMouseDown(event){var pos=this._getMousePos(event);this.setState({didDrag:false,startPos:pos,pos:pos,isFunctionKeyPressed:this._isFunctionKeyPressed(event)});this.props.onMouseDown({pos:pos});_document2.default.addEventListener("mousemove",this._onMouseDrag,false);_document2.default.addEventListener("mouseup",this._onMouseUp,false)}},{key:"_onTouchStart",value:function _onTouchStart(event){var pos=this._getTouchPos(event);this.setState({didDrag:false,startPos:pos,pos:pos,isFunctionKeyPressed:this._isFunctionKeyPressed(event)});this.props.onTouchStart({pos:pos});_document2.default.addEventListener("touchmove",this._onTouchDrag,false);_document2.default.addEventListener("touchend",this._onTouchEnd,false)}},{key:"_onMouseDrag",value:function _onMouseDrag(event){var pos=this._getMousePos(event);this.setState({pos:pos,didDrag:true});if(this.state.isFunctionKeyPressed){var startPos=this.state.startPos;this.props.onMouseRotate({pos:pos,startPos:startPos})}else{this.props.onMouseDrag({pos:pos})}}},{key:"_onTouchDrag",value:function _onTouchDrag(event){var pos=this._getTouchPos(event);this.setState({pos:pos,didDrag:true});if(this.state.isFunctionKeyPressed){var startPos=this.state.startPos;this.props.onTouchRotate({pos:pos,startPos:startPos})}else{this.props.onTouchDrag({pos:pos})}event.preventDefault()}},{key:"_onMouseUp",value:function _onMouseUp(event){_document2.default.removeEventListener("mousemove",this._onMouseDrag,false);_document2.default.removeEventListener("mouseup",this._onMouseUp,false);var pos=this._getMousePos(event);this.setState({pos:pos});this.props.onMouseUp({pos:pos});if(!this.state.didDrag){this.props.onMouseClick({pos:pos})}}},{key:"_onTouchEnd",value:function _onTouchEnd(event){_document2.default.removeEventListener("touchmove",this._onTouchDrag,false);_document2.default.removeEventListener("touchend",this._onTouchEnd,false);var pos=this._getTouchPos(event);this.setState({pos:pos});this.props.onTouchEnd({pos:pos});if(!this.state.didDrag){this.props.onTouchTap({pos:pos})}}},{key:"_onMouseMove",value:function _onMouseMove(event){var pos=this._getMousePos(event);this.props.onMouseMove({pos:pos})}},{key:"_onWheel",value:function _onWheel(event){event.preventDefault();var value=event.deltaY;if(firefox&&event.deltaMode===_window2.default.WheelEvent.DOM_DELTA_PIXEL){value/=_window2.default.devicePixelRatio}if(event.deltaMode===_window2.default.WheelEvent.DOM_DELTA_LINE){value*=40}var type=this.state.mouseWheelType;var timeout=this.state.mouseWheelTimeout;var lastValue=this.state.mouseWheelLastValue;var time=this.state.mouseWheelTime;var now=(_window2.default.performance||Date).now();var timeDelta=now-(time||0);var pos=this._getMousePos(event);time=now;if(value!==0&&value%4.000244140625===0){type="wheel";value=Math.floor(value/4)}else if(value!==0&&Math.abs(value)<4){type="trackpad"}else if(timeDelta>400){type=null;lastValue=value;timeout=_window2.default.setTimeout(function setTimeout(){var _type="wheel";this._zoom(-this.state.mouseWheelLastValue,this.state.mouseWheelPos);this.setState({mouseWheelType:_type})}.bind(this),40)}else if(!this._type){type=Math.abs(timeDelta*value)<200?"trackpad":"wheel";if(timeout){_window2.default.clearTimeout(timeout);timeout=null;value+=lastValue}}if(event.shiftKey&&value){value=value/4}if(type){this._zoom(-value,pos)}this.setState({mouseWheelTime:time,mouseWheelPos:pos,mouseWheelType:type,mouseWheelTimeout:timeout,mouseWheelLastValue:lastValue})}},{key:"_zoom",value:function _zoom(delta,pos){var scale=2/(1+Math.exp(-Math.abs(delta/100)));if(delta<0&&scale!==0){scale=1/scale}this.props.onZoom({pos:pos,scale:scale});_window2.default.clearTimeout(this._zoomEndTimeout);this._zoomEndTimeout=_window2.default.setTimeout(function _setTimeout(){this.props.onZoomEnd()}.bind(this),200)}},{key:"render",value:function render(){return _react2.default.createElement("div",{ref:"container",onMouseMove:this._onMouseMove,onMouseDown:this._onMouseDown,onTouchStart:this._onTouchStart,onContextMenu:this._onMouseDown,onWheel:this._onWheel,style:{width:this.props.width,height:this.props.height,position:"relative"}},this.props.children)}}]);return Interactions}(_react.Component),_class2.displayName="Interactions",_class2.propTypes={width:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,onMouseDown:_react.PropTypes.func,onMouseDrag:_react.PropTypes.func,onMouseRotate:_react.PropTypes.func,onMouseUp:_react.PropTypes.func,onMouseMove:_react.PropTypes.func,onMouseClick:_react.PropTypes.func,onTouchStart:_react.PropTypes.func,onTouchDrag:_react.PropTypes.func,onTouchRotate:_react.PropTypes.func,onTouchEnd:_react.PropTypes.func,onTouchTap:_react.PropTypes.func,onZoom:_react.PropTypes.func,onZoomEnd:_react.PropTypes.func},_class2.defaultProps={onMouseDown:noop,onMouseDrag:noop,onMouseRotate:noop,onMouseUp:noop,onMouseMove:noop,onMouseClick:noop,onTouchStart:noop,onTouchDrag:noop,onTouchRotate:noop,onTouchEnd:noop,onTouchTap:noop,onZoom:noop,onZoomEnd:noop},_temp),_applyDecoratedDescriptor(_class.prototype,"_onMouseDown",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_onMouseDown"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_onTouchStart",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_onTouchStart"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_onMouseDrag",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_onMouseDrag"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_onTouchDrag",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_onTouchDrag"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_onMouseUp",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_onMouseUp"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_onTouchEnd",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_onTouchEnd"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_onMouseMove",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_onMouseMove"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_onWheel",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_onWheel"),_class.prototype),_class);exports.default=Interactions},{"autobind-decorator":3,"global/document":448,"global/window":449,react:948}],903:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){
var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _class,_desc,_value,_class2,_class3,_temp;var _react=require("react");var _react2=_interopRequireDefault(_react);var _autobindDecorator=require("autobind-decorator");var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);var _pureRenderDecorator=require("pure-render-decorator");var _pureRenderDecorator2=_interopRequireDefault(_pureRenderDecorator);var _mapboxGl=require("mapbox-gl");var _mapboxGl2=_interopRequireDefault(_mapboxGl);var _d3Selection=require("d3-selection");var _immutable=require("immutable");var _immutable2=_interopRequireDefault(_immutable);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);var _mapInteractions=require("./map-interactions.react");var _mapInteractions2=_interopRequireDefault(_mapInteractions);var _config=require("./config");var _config2=_interopRequireDefault(_config);var _styleUtils=require("./utils/style-utils");var _diffStyles2=require("./utils/diff-styles");var _diffStyles3=_interopRequireDefault(_diffStyles2);var _transform=require("./utils/transform");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}function noop(){}var MAX_PITCH=60;var PITCH_MOUSE_THRESHOLD=20;var PITCH_ACCEL=1.2;var PROP_TYPES={latitude:_react.PropTypes.number.isRequired,longitude:_react.PropTypes.number.isRequired,zoom:_react.PropTypes.number.isRequired,maxZoom:_react.PropTypes.number,mapStyle:_react.PropTypes.oneOfType([_react.PropTypes.string,_react.PropTypes.instanceOf(_immutable2.default.Map)]),mapboxApiAccessToken:_react.PropTypes.string,onChangeViewport:_react.PropTypes.func,width:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,isDragging:_react.PropTypes.bool,startDragLngLat:_react.PropTypes.array,onHoverFeatures:_react.PropTypes.func,ignoreEmptyFeatures:_react.PropTypes.bool,attributionControl:_react.PropTypes.bool,onClick:_react.PropTypes.func,onClickFeatures:_react.PropTypes.func,clickRadius:_react.PropTypes.number,preserveDrawingBuffer:_react.PropTypes.bool,preventStyleDiffing:_react.PropTypes.bool,perspectiveEnabled:_react.PropTypes.bool,bearing:_react.PropTypes.number,pitch:_react.PropTypes.number,altitude:_react.PropTypes.number,onLoad:_react.PropTypes.func};var DEFAULT_PROPS={mapStyle:"mapbox://styles/mapbox/light-v9",onChangeViewport:null,mapboxApiAccessToken:_config2.default.DEFAULTS.MAPBOX_API_ACCESS_TOKEN,preserveDrawingBuffer:false,attributionControl:true,ignoreEmptyFeatures:true,bearing:0,pitch:0,altitude:1.5,clickRadius:15,maxZoom:20};var MapGL=(0,_pureRenderDecorator2.default)(_class=(_class2=(_temp=_class3=function(_Component){_inherits(MapGL,_Component);_createClass(MapGL,null,[{key:"supported",value:function supported(){return _mapboxGl2.default.supported()}}]);function MapGL(props){_classCallCheck(this,MapGL);var _this=_possibleConstructorReturn(this,(MapGL.__proto__||Object.getPrototypeOf(MapGL)).call(this,props));_this.state={isSupported:_mapboxGl2.default.supported(),isDragging:false,isHovering:false,startDragLngLat:null,startBearing:null,startPitch:null};_this._queryParams={};_mapboxGl2.default.accessToken=props.mapboxApiAccessToken;if(!_this.state.isSupported){_this.componentDidMount=noop;_this.componentWillReceiveProps=noop;_this.componentDidUpdate=noop}return _this}_createClass(MapGL,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;var mapStyle=_immutable2.default.Map.isMap(this.props.mapStyle)?this.props.mapStyle.toJS():this.props.mapStyle;var map=new _mapboxGl2.default.Map({container:this.refs.mapboxMap,center:[this.props.longitude,this.props.latitude],zoom:this.props.zoom,maxZoom:this.props.maxZoom,pitch:this.props.pitch,bearing:this.props.bearing,style:mapStyle,interactive:false,preserveDrawingBuffer:this.props.preserveDrawingBuffer});if(this.props.onLoad){map.once("load",function(){return _this2.props.onLoad()})}(0,_d3Selection.select)(map.getCanvas()).style("outline","none");this._map=map;this._updateMapViewport({},this.props);this._callOnChangeViewport(map.transform);this._updateQueryParams(mapStyle)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(newProps){this._updateStateFromProps(this.props,newProps);this._updateMapViewport(this.props,newProps);this._updateMapStyle(this.props,newProps);this.setState({width:this.props.width,height:this.props.height})}},{key:"componentDidUpdate",value:function componentDidUpdate(){this._updateMapSize(this.state,this.props)}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(this._map){this._map.remove()}}},{key:"_getMap",value:function _getMap(){return this._map}},{key:"_getCursor",value:function _getCursor(){var isInteractive=this.props.onChangeViewport||this.props.onClickFeature||this.props.onHoverFeatures;if(isInteractive){return this.props.isDragging?_config2.default.CURSOR.GRABBING:this.state.isHovering?_config2.default.CURSOR.POINTER:_config2.default.CURSOR.GRAB}return"inherit"}},{key:"_updateStateFromProps",value:function _updateStateFromProps(oldProps,newProps){_mapboxGl2.default.accessToken=newProps.mapboxApiAccessToken;this.setState({startDragLngLat:newProps.startDragLngLat})}},{key:"_updateQueryParams",value:function _updateQueryParams(mapStyle){var interactiveLayerIds=(0,_styleUtils.getInteractiveLayerIds)(mapStyle);this._queryParams=interactiveLayerIds.length===0?{}:{layers:interactiveLayerIds}}},{key:"_updateSource",value:function _updateSource(map,update){var newSource=update.source.toJS();if(newSource.type==="geojson"){var oldSource=map.getSource(update.id);if(oldSource.type==="geojson"){var oldOpts=oldSource.workerOptions;if((newSource.maxzoom===undefined||newSource.maxzoom===oldOpts.geojsonVtOptions.maxZoom)&&(newSource.buffer===undefined||newSource.buffer===oldOpts.geojsonVtOptions.buffer)&&(newSource.tolerance===undefined||newSource.tolerance===oldOpts.geojsonVtOptions.tolerance)&&(newSource.cluster===undefined||newSource.cluster===oldOpts.cluster)&&(newSource.clusterRadius===undefined||newSource.clusterRadius===oldOpts.superclusterOptions.radius)&&(newSource.clusterMaxZoom===undefined||newSource.clusterMaxZoom===oldOpts.superclusterOptions.maxZoom)){oldSource.setData(newSource.data);return}}}map.removeSource(update.id);map.addSource(update.id,newSource)}},{key:"_setDiffStyle",value:function _setDiffStyle(prevStyle,nextStyle){var prevKeysMap=prevStyle&&styleKeysMap(prevStyle)||{};var nextKeysMap=styleKeysMap(nextStyle);function styleKeysMap(style){return style.map(function(){return true}).delete("layers").delete("sources").toJS()}function propsOtherThanLayersOrSourcesDiffer(){var prevKeysList=Object.keys(prevKeysMap);var nextKeysList=Object.keys(nextKeysMap);if(prevKeysList.length!==nextKeysList.length){return true}if(nextKeysList.some(function(key){return prevStyle.get(key)!==nextStyle.get(key)})){return true}return false}var map=this._map;if(!prevStyle||propsOtherThanLayersOrSourcesDiffer()){map.setStyle(nextStyle.toJS());return}var _diffStyles=(0,_diffStyles3.default)(prevStyle,nextStyle),sourcesDiff=_diffStyles.sourcesDiff,layersDiff=_diffStyles.layersDiff;if(layersDiff.updates.some(function(node){return node.layer.get("ref")})){map.setStyle(nextStyle.toJS());return}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=sourcesDiff.enter[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var enter=_step.value;map.addSource(enter.id,enter.source.toJS())}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=sourcesDiff.update[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var update=_step2.value;this._updateSource(map,update)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=sourcesDiff.exit[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var exit=_step3.value;map.removeSource(exit.id)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=layersDiff.exiting[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var _exit=_step4.value;if(map.style.getLayer(_exit.id)){map.removeLayer(_exit.id)}}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=layersDiff.updates[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var _update=_step5.value;if(!_update.enter){map.removeLayer(_update.id)}map.addLayer(_update.layer.toJS(),_update.before)}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally{if(_didIteratorError5){throw _iteratorError5}}}}},{key:"_updateMapStyle",value:function _updateMapStyle(oldProps,newProps){var mapStyle=newProps.mapStyle;var oldMapStyle=oldProps.mapStyle;if(mapStyle!==oldMapStyle){if(_immutable2.default.Map.isMap(mapStyle)){if(this.props.preventStyleDiffing){this._map.setStyle(mapStyle.toJS())}else{this._setDiffStyle(oldMapStyle,mapStyle)}}else{this._map.setStyle(mapStyle)}this._updateQueryParams(mapStyle)}}},{key:"_updateMapViewport",value:function _updateMapViewport(oldProps,newProps){var viewportChanged=newProps.latitude!==oldProps.latitude||newProps.longitude!==oldProps.longitude||newProps.zoom!==oldProps.zoom||newProps.pitch!==oldProps.pitch||newProps.zoom!==oldProps.bearing||newProps.altitude!==oldProps.altitude;if(viewportChanged){this._map.jumpTo({center:[newProps.longitude,newProps.latitude],zoom:newProps.zoom,bearing:newProps.bearing,pitch:newProps.pitch});if(newProps.altitude!==oldProps.altitude){this._map.transform.altitude=newProps.altitude}}}},{key:"_updateMapSize",value:function _updateMapSize(oldProps,newProps){var sizeChanged=oldProps.width!==newProps.width||oldProps.height!==newProps.height;if(sizeChanged){this._map.resize();this._callOnChangeViewport(this._map.transform)}}},{key:"_calculateNewPitchAndBearing",value:function _calculateNewPitchAndBearing(_ref){var pos=_ref.pos,startPos=_ref.startPos,startBearing=_ref.startBearing,startPitch=_ref.startPitch;var xDelta=pos[0]-startPos[0];var bearing=startBearing+180*xDelta/this.props.width;var pitch=startPitch;var yDelta=pos[1]-startPos[1];if(yDelta>0){if(Math.abs(this.props.height-startPos[1])>PITCH_MOUSE_THRESHOLD){var scale=yDelta/(this.props.height-startPos[1]);pitch=(1-scale)*PITCH_ACCEL*startPitch}}else if(yDelta<0){if(startPos.y>PITCH_MOUSE_THRESHOLD){var yScale=1-pos[1]/startPos[1];pitch=startPitch+yScale*(MAX_PITCH-startPitch)}}return{pitch:Math.max(Math.min(pitch,MAX_PITCH),0),bearing:bearing}}},{key:"_callOnChangeViewport",value:function _callOnChangeViewport(transform){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(this.props.onChangeViewport){this.props.onChangeViewport(_extends({latitude:transform.center.lat,longitude:(0,_transform.mod)(transform.center.lng+180,360)-180,zoom:transform.zoom,pitch:transform.pitch,bearing:(0,_transform.mod)(transform.bearing+180,360)-180,isDragging:this.props.isDragging,startDragLngLat:this.props.startDragLngLat,startBearing:this.props.startBearing,startPitch:this.props.startPitch},opts))}}},{key:"_onTouchStart",value:function _onTouchStart(opts){this._onMouseDown(opts)}},{key:"_onTouchDrag",value:function _onTouchDrag(opts){this._onMouseDrag(opts)}},{key:"_onTouchRotate",value:function _onTouchRotate(opts){this._onMouseRotate(opts)}},{key:"_onTouchEnd",value:function _onTouchEnd(opts){this._onMouseUp(opts)}},{key:"_onTouchTap",value:function _onTouchTap(opts){this._onMouseClick(opts)}},{key:"_onMouseDown",value:function _onMouseDown(_ref2){var pos=_ref2.pos;var transform=this._map.transform;var _unprojectFromTransfo=(0,_transform.unprojectFromTransform)(transform,new(Function.prototype.bind.apply(_mapboxGl.Point,[null].concat(_toConsumableArray(pos))))),lng=_unprojectFromTransfo.lng,lat=_unprojectFromTransfo.lat;this._callOnChangeViewport(transform,{isDragging:true,startDragLngLat:[lng,lat],startBearing:transform.bearing,startPitch:transform.pitch})}},{key:"_onMouseDrag",value:function _onMouseDrag(_ref3){var pos=_ref3.pos;if(!this.props.onChangeViewport){return}(0,_assert2.default)(this.props.startDragLngLat,"`startDragLngLat` prop is required "+"for mouse drag behavior to calculate where to position the map.");var transform=(0,_transform.cloneTransform)(this._map.transform);var _props$startDragLngLa=_slicedToArray(this.props.startDragLngLat,2),lng=_props$startDragLngLa[0],lat=_props$startDragLngLa[1];transform.setLocationAtPoint({lng:lng,lat:lat},new(Function.prototype.bind.apply(_mapboxGl.Point,[null].concat(_toConsumableArray(pos)))));this._callOnChangeViewport(transform,{isDragging:true})}},{key:"_onMouseRotate",value:function _onMouseRotate(_ref4){var pos=_ref4.pos,startPos=_ref4.startPos;if(!this.props.onChangeViewport||!this.props.perspectiveEnabled){return}var _props=this.props,startBearing=_props.startBearing,startPitch=_props.startPitch;(0,_assert2.default)(typeof startBearing==="number","`startBearing` prop is required for mouse rotate behavior");(0,_assert2.default)(typeof startPitch==="number","`startPitch` prop is required for mouse rotate behavior");var _calculateNewPitchAnd=this._calculateNewPitchAndBearing({pos:pos,startPos:startPos,startBearing:startBearing,startPitch:startPitch}),pitch=_calculateNewPitchAnd.pitch,bearing=_calculateNewPitchAnd.bearing;var transform=(0,_transform.cloneTransform)(this._map.transform);transform.bearing=bearing;transform.pitch=pitch;this._callOnChangeViewport(transform,{isDragging:true})}},{key:"_onMouseMove",value:function _onMouseMove(_ref5){var pos=_ref5.pos;if(!this.props.onHoverFeatures){return}var features=this._map.queryRenderedFeatures(new(Function.prototype.bind.apply(_mapboxGl.Point,[null].concat(_toConsumableArray(pos)))),this._queryParams);if(!features.length&&this.props.ignoreEmptyFeatures){return}this.setState({isHovering:features.length>0});this.props.onHoverFeatures(features)}},{key:"_onMouseUp",value:function _onMouseUp(opt){this._callOnChangeViewport(this._map.transform,{isDragging:false,startDragLngLat:null,startBearing:null,startPitch:null})}},{key:"_onMouseClick",value:function _onMouseClick(_ref6){var pos=_ref6.pos;if(!this.props.onClickFeatures&&!this.props.onClick){return}if(this.props.onClick){var point=new(Function.prototype.bind.apply(_mapboxGl.Point,[null].concat(_toConsumableArray(pos))));var latLong=this._map.unproject(point);this.props.onClick(latLong,point)}if(this.props.onClickFeatures){var size=this.props.clickRadius;var bbox=[[pos[0]-size,pos[1]-size],[pos[0]+size,pos[1]+size]];var features=this._map.queryRenderedFeatures(bbox,this._queryParams);if(!features.length&&this.props.ignoreEmptyFeatures){return}this.props.onClickFeatures(features)}}},{key:"_onZoom",value:function _onZoom(_ref7){var pos=_ref7.pos,scale=_ref7.scale;var point=new(Function.prototype.bind.apply(_mapboxGl.Point,[null].concat(_toConsumableArray(pos))));var transform=(0,_transform.cloneTransform)(this._map.transform);var around=(0,_transform.unprojectFromTransform)(transform,point);transform.zoom=transform.scaleZoom(this._map.transform.scale*scale);transform.setLocationAtPoint(around,point);this._callOnChangeViewport(transform,{isDragging:true})}},{key:"_onZoomEnd",value:function _onZoomEnd(){this._callOnChangeViewport(this._map.transform,{isDragging:false})}},{key:"render",value:function render(){var _props2=this.props,className=_props2.className,width=_props2.width,height=_props2.height,style=_props2.style;var mapStyle=_extends({},style,{width:width,height:height,cursor:this._getCursor()});var content=[_react2.default.createElement("div",{key:"map",ref:"mapboxMap",style:mapStyle,className:className}),_react2.default.createElement("div",{key:"overlays",className:"overlays",style:{position:"absolute",left:0,top:0}},this.props.children)];if(this.state.isSupported&&this.props.onChangeViewport){content=_react2.default.createElement(_mapInteractions2.default,{onMouseDown:this._onMouseDown,onMouseDrag:this._onMouseDrag,onMouseRotate:this._onMouseRotate,onMouseUp:this._onMouseUp,onMouseMove:this._onMouseMove,onMouseClick:this._onMouseClick,onTouchStart:this._onTouchStart,onTouchDrag:this._onTouchDrag,onTouchRotate:this._onTouchRotate,onTouchEnd:this._onTouchEnd,onTouchTap:this._onTouchTap,onZoom:this._onZoom,onZoomEnd:this._onZoomEnd,width:this.props.width,height:this.props.height},content)}return _react2.default.createElement("div",{style:_extends({},this.props.style,{width:this.props.width,height:this.props.height,position:"relative"})},content)}}]);return MapGL}(_react.Component),_class3.propTypes=PROP_TYPES,_class3.defaultProps=DEFAULT_PROPS,_temp),_applyDecoratedDescriptor(_class2.prototype,"_onTouchStart",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class2.prototype,"_onTouchStart"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"_onTouchDrag",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class2.prototype,"_onTouchDrag"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"_onTouchRotate",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class2.prototype,"_onTouchRotate"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"_onTouchEnd",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class2.prototype,"_onTouchEnd"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"_onTouchTap",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class2.prototype,"_onTouchTap"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"_onMouseDown",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class2.prototype,"_onMouseDown"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"_onMouseDrag",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class2.prototype,"_onMouseDrag"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"_onMouseRotate",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class2.prototype,"_onMouseRotate"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"_onMouseMove",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class2.prototype,"_onMouseMove"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"_onMouseUp",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class2.prototype,"_onMouseUp"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"_onMouseClick",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class2.prototype,"_onMouseClick"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"_onZoom",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class2.prototype,"_onZoom"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"_onZoomEnd",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class2.prototype,"_onZoomEnd"),_class2.prototype),_class2))||_class;exports.default=MapGL},{"./config":900,"./map-interactions.react":902,"./utils/diff-styles":911,"./utils/style-utils":913,"./utils/transform":914,assert:2,"autobind-decorator":3,"d3-selection":330,immutable:453,"mapbox-gl":620,"pure-render-decorator":771,react:948}],904:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _class,_temp;var _react=require("react");var _react2=_interopRequireDefault(_react);var _viewportMercatorProject=require("viewport-mercator-project");var _viewportMercatorProject2=_interopRequireDefault(_viewportMercatorProject);var _window=require("global/window");var _window2=_interopRequireDefault(_window);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CanvasOverlay=(_temp=_class=function(_Component){_inherits(CanvasOverlay,_Component);function CanvasOverlay(){_classCallCheck(this,CanvasOverlay);return _possibleConstructorReturn(this,(CanvasOverlay.__proto__||Object.getPrototypeOf(CanvasOverlay)).apply(this,arguments))}_createClass(CanvasOverlay,[{key:"componentDidMount",value:function componentDidMount(){this._redraw()}},{key:"componentDidUpdate",value:function componentDidUpdate(){this._redraw()}},{key:"_redraw",value:function _redraw(){var pixelRatio=_window2.default.devicePixelRatio||1;var canvas=this.refs.overlay;var ctx=canvas.getContext("2d");ctx.save();ctx.scale(pixelRatio,pixelRatio);var mercator=(0,_viewportMercatorProject2.default)(this.props);this.props.redraw({width:this.props.width,height:this.props.height,ctx:ctx,project:mercator.project,unproject:mercator.unproject,isDragging:this.props.isDragging});ctx.restore()}},{key:"render",value:function render(){var pixelRatio=_window2.default.devicePixelRatio||1;return _react2.default.createElement("canvas",{ref:"overlay",width:this.props.width*pixelRatio,height:this.props.height*pixelRatio,style:{width:this.props.width+"px",height:this.props.height+"px",position:"absolute",pointerEvents:"none",left:0,top:0}})}}]);return CanvasOverlay}(_react.Component),_class.propTypes={width:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,latitude:_react.PropTypes.number.isRequired,longitude:_react.PropTypes.number.isRequired,zoom:_react.PropTypes.number.isRequired,redraw:_react.PropTypes.func.isRequired,isDragging:_react.PropTypes.bool.isRequired},_temp);exports.default=CanvasOverlay},{"global/window":449,react:948,"viewport-mercator-project":916}],905:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _class,_temp;var _react=require("react");var _react2=_interopRequireDefault(_react);var _viewportMercatorProject=require("viewport-mercator-project");var _viewportMercatorProject2=_interopRequireDefault(_viewportMercatorProject);var _window=require("global/window");var _window2=_interopRequireDefault(_window);var _d3Array=require("d3-array");var _d3Scale=require("d3-scale");var _d3Geo=require("d3-geo");var _immutable=require("immutable");var _immutable2=_interopRequireDefault(_immutable);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ChoroplethOverlay=(_temp=_class=function(_Component){_inherits(ChoroplethOverlay,_Component);function ChoroplethOverlay(){_classCallCheck(this,ChoroplethOverlay);return _possibleConstructorReturn(this,(ChoroplethOverlay.__proto__||Object.getPrototypeOf(ChoroplethOverlay)).apply(this,arguments))}_createClass(ChoroplethOverlay,[{key:"componentDidMount",value:function componentDidMount(){this._redraw()}},{key:"componentDidUpdate",value:function componentDidUpdate(){this._redraw()}},{key:"_redraw",value:function _redraw(){var pixelRatio=_window2.default.devicePixelRatio;var canvas=this.refs.overlay;var ctx=canvas.getContext("2d");var mercator=(0,_viewportMercatorProject2.default)(this.props);ctx.save();ctx.scale(pixelRatio,pixelRatio);ctx.clearRect(0,0,this.props.width,this.props.height);function projectPoint(lon,lat){var point=mercator.project([lon,lat]);this.stream.point(point[0],point[1])}if(this.props.renderWhileDragging||!this.props.isDragging){var transform=(0,_d3Geo.geoTransform)({point:projectPoint});var path=(0,_d3Geo.geoPath)().projection(transform).context(ctx);this._drawFeatures(ctx,path)}ctx.restore()}},{key:"_drawFeatures",value:function _drawFeatures(ctx,path){var features=this.props.features;if(!features){return}var colorDomain=this.props.colorDomain||(0,_d3Array.extent)(features.toArray(),this.props.valueAccessor);var colorScale=(0,_d3Scale.scaleLinear)().domain(colorDomain).range(this.props.colorRange).clamp(true);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=features[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var feature=_step.value;ctx.beginPath();ctx.strokeStyle="rgba(255, 255, 255, 0.5)";ctx.lineWidth="1";ctx.fillStyle=colorScale(this.props.valueAccessor(feature));var geometry=feature.get("geometry");path({type:geometry.get("type"),coordinates:geometry.get("coordinates").toJS()});ctx.fill();ctx.stroke()}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"render",value:function render(){var pixelRatio=_window2.default.devicePixelRatio||1;return _react2.default.createElement("canvas",{ref:"overlay",width:this.props.width*pixelRatio,height:this.props.height*pixelRatio,style:{width:this.props.width+"px",height:this.props.height+"px",position:"absolute",pointerEvents:"none",opacity:this.props.globalOpacity,left:0,top:0}})}}]);return ChoroplethOverlay}(_react.Component),_class.propTypes={width:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,latitude:_react.PropTypes.number.isRequired,longitude:_react.PropTypes.number.isRequired,zoom:_react.PropTypes.number.isRequired,isDragging:_react.PropTypes.bool.isRequired,renderWhileDragging:_react.PropTypes.bool.isRequired,globalOpacity:_react.PropTypes.number.isRequired,features:_react.PropTypes.instanceOf(_immutable2.default.List),colorDomain:_react.PropTypes.array,colorRange:_react.PropTypes.array.isRequired,valueAccessor:_react.PropTypes.func.isRequired},_class.defaultProps={renderWhileDragging:true,globalOpacity:1,colorDomain:null,colorRange:["#FFFFFF","#1FBAD6"],valueAccessor:function valueAccessor(feature){return feature.get("properties").get("value")}},_temp);exports.default=ChoroplethOverlay},{"d3-array":323,"d3-geo":327,"d3-scale":329,"global/window":449,immutable:453,react:948,"viewport-mercator-project":916}],906:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){
target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class,_class2,_temp;var _react=require("react");var _react2=_interopRequireDefault(_react);var _autobindDecorator=require("autobind-decorator");var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);var _immutable=require("immutable");var _immutable2=_interopRequireDefault(_immutable);var _svgTransform=require("svg-transform");var _svgTransform2=_interopRequireDefault(_svgTransform);var _document=require("global/document");var _document2=_interopRequireDefault(_document);var _config=require("../config");var _config2=_interopRequireDefault(_config);var _viewportMercatorProject=require("viewport-mercator-project");var _viewportMercatorProject2=_interopRequireDefault(_viewportMercatorProject);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}function noop(){}function mouse(container,event){var rect=container.getBoundingClientRect();var x=event.clientX-rect.left-container.clientLeft;var y=event.clientY-rect.top-container.clientTop;return[x,y]}var DraggablePointsOverlay=(_class=(_temp=_class2=function(_Component){_inherits(DraggablePointsOverlay,_Component);function DraggablePointsOverlay(props){_classCallCheck(this,DraggablePointsOverlay);var _this=_possibleConstructorReturn(this,(DraggablePointsOverlay.__proto__||Object.getPrototypeOf(DraggablePointsOverlay)).call(this,props));_this.state={draggedPointKey:null};return _this}_createClass(DraggablePointsOverlay,[{key:"_onDragStart",value:function _onDragStart(point,event){event.stopPropagation();_document2.default.addEventListener("mousemove",this._onDrag,false);_document2.default.addEventListener("mouseup",this._onDragEnd,false);this.setState({draggedPointKey:this.props.keyAccessor(point)})}},{key:"_onDrag",value:function _onDrag(event){event.stopPropagation();var pixel=mouse(this.refs.container,event);var mercator=(0,_viewportMercatorProject2.default)(this.props);var lngLat=mercator.unproject(pixel);var key=this.state.draggedPointKey;this.props.onUpdatePoint({key:key,location:lngLat})}},{key:"_onDragEnd",value:function _onDragEnd(event){event.stopPropagation();_document2.default.removeEventListener("mousemove",this._onDrag,false);_document2.default.removeEventListener("mouseup",this._onDragEnd,false);this.setState({draggedPointKey:null})}},{key:"_addPoint",value:function _addPoint(event){event.stopPropagation();event.preventDefault();var pixel=mouse(this.refs.container,event);var mercator=(0,_viewportMercatorProject2.default)(this.props);this.props.onAddPoint(mercator.unproject(pixel))}},{key:"render",value:function render(){var _this2=this;var _props=this.props,points=_props.points,width=_props.width,height=_props.height,isDragging=_props.isDragging,style=_props.style;var mercator=(0,_viewportMercatorProject2.default)(this.props);return _react2.default.createElement("svg",{ref:"container",width:width,height:height,style:_extends({pointerEvents:"all",position:"absolute",left:0,top:0,cursor:isDragging?_config2.default.CURSOR.GRABBING:_config2.default.CURSOR.GRAB},style),onContextMenu:this._addPoint},_react2.default.createElement("g",{style:{cursor:"pointer"}},points.map(function(point,index){var pixel=mercator.project(_this2.props.lngLatAccessor(point));return _react2.default.createElement("g",{key:index,style:{pointerEvents:"all"},transform:(0,_svgTransform2.default)([{translate:pixel}]),onMouseDown:_this2._onDragStart.bind(_this2,point)},_this2.props.renderPoint.call(_this2,point,pixel))})))}}]);return DraggablePointsOverlay}(_react.Component),_class2.propTypes={width:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,latitude:_react.PropTypes.number.isRequired,longitude:_react.PropTypes.number.isRequired,zoom:_react.PropTypes.number.isRequired,points:_react.PropTypes.instanceOf(_immutable2.default.List).isRequired,isDragging:_react.PropTypes.bool.isRequired,keyAccessor:_react.PropTypes.func.isRequired,lngLatAccessor:_react.PropTypes.func.isRequired,onAddPoint:_react.PropTypes.func.isRequired,onUpdatePoint:_react.PropTypes.func.isRequired,renderPoint:_react.PropTypes.func.isRequired},_class2.defaultProps={keyAccessor:function keyAccessor(point){return point.get("id")},lngLatAccessor:function lngLatAccessor(point){return point.get("location").toArray()},onAddPoint:noop,onUpdatePoint:noop,renderPoint:noop,isDragging:false},_temp),_applyDecoratedDescriptor(_class.prototype,"_onDragStart",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_onDragStart"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_onDrag",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_onDrag"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_onDragEnd",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_onDragEnd"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_addPoint",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_addPoint"),_class.prototype),_class);exports.default=DraggablePointsOverlay},{"../config":900,"autobind-decorator":3,"global/document":448,immutable:453,react:948,"svg-transform":984,"viewport-mercator-project":916}],907:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _class,_temp;var _react=require("react");var _react2=_interopRequireDefault(_react);var _viewportMercatorProject=require("viewport-mercator-project");var _viewportMercatorProject2=_interopRequireDefault(_viewportMercatorProject);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HTMLOverlay=(_temp=_class=function(_Component){_inherits(HTMLOverlay,_Component);function HTMLOverlay(){_classCallCheck(this,HTMLOverlay);return _possibleConstructorReturn(this,(HTMLOverlay.__proto__||Object.getPrototypeOf(HTMLOverlay)).apply(this,arguments))}_createClass(HTMLOverlay,[{key:"render",value:function render(){var _props=this.props,width=_props.width,height=_props.height,isDragging=_props.isDragging;var style=_extends({position:"absolute",pointerEvents:"none",left:0,top:0,width:width,height:height},this.props.style);var mercator=(0,_viewportMercatorProject2.default)(this.props);var project=mercator.project,unproject=mercator.unproject;return _react2.default.createElement("div",{ref:"overlay",style:style},this.props.redraw({width:width,height:height,project:project,unproject:unproject,isDragging:isDragging}))}}]);return HTMLOverlay}(_react.Component),_class.propTypes={width:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,redraw:_react.PropTypes.func.isRequired,isDragging:_react.PropTypes.bool.isRequired},_temp);exports.default=HTMLOverlay},{react:948,"viewport-mercator-project":916}],908:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _canvas=require("./canvas.react");Object.defineProperty(exports,"CanvasOverlay",{enumerable:true,get:function get(){return _interopRequireDefault(_canvas).default}});var _choropleth=require("./choropleth.react");Object.defineProperty(exports,"ChoroplethOverlay",{enumerable:true,get:function get(){return _interopRequireDefault(_choropleth).default}});var _draggablePoints=require("./draggable-points.react");Object.defineProperty(exports,"DraggablePointsOverlay",{enumerable:true,get:function get(){return _interopRequireDefault(_draggablePoints).default}});var _html=require("./html.react");Object.defineProperty(exports,"HTMLOverlay",{enumerable:true,get:function get(){return _interopRequireDefault(_html).default}});var _scatterplot=require("./scatterplot.react");Object.defineProperty(exports,"ScatterplotOverlay",{enumerable:true,get:function get(){return _interopRequireDefault(_scatterplot).default}});var _svg=require("./svg.react");Object.defineProperty(exports,"SVGOverlay",{enumerable:true,get:function get(){return _interopRequireDefault(_svg).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./canvas.react":904,"./choropleth.react":905,"./draggable-points.react":906,"./html.react":907,"./scatterplot.react":909,"./svg.react":910}],909:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _class,_temp;var _react=require("react");var _react2=_interopRequireDefault(_react);var _window=require("global/window");var _window2=_interopRequireDefault(_window);var _immutable=require("immutable");var _immutable2=_interopRequireDefault(_immutable);var _canvasCompositeTypes=require("canvas-composite-types");var _canvasCompositeTypes2=_interopRequireDefault(_canvasCompositeTypes);var _viewportMercatorProject=require("viewport-mercator-project");var _viewportMercatorProject2=_interopRequireDefault(_viewportMercatorProject);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function round(x,n){var tenN=Math.pow(10,n);return Math.round(x*tenN)/tenN}var ScatterplotOverlay=(_temp=_class=function(_Component){_inherits(ScatterplotOverlay,_Component);function ScatterplotOverlay(){_classCallCheck(this,ScatterplotOverlay);return _possibleConstructorReturn(this,(ScatterplotOverlay.__proto__||Object.getPrototypeOf(ScatterplotOverlay)).apply(this,arguments))}_createClass(ScatterplotOverlay,[{key:"componentDidMount",value:function componentDidMount(){this._redraw()}},{key:"componentDidUpdate",value:function componentDidUpdate(){this._redraw()}},{key:"_redraw",value:function _redraw(){var _props=this.props,width=_props.width,height=_props.height,dotRadius=_props.dotRadius,dotFill=_props.dotFill,compositeOperation=_props.compositeOperation,renderWhileDragging=_props.renderWhileDragging,isDragging=_props.isDragging,locations=_props.locations,lngLatAccessor=_props.lngLatAccessor;var mercator=(0,_viewportMercatorProject2.default)(this.props);var pixelRatio=_window2.default.devicePixelRatio||1;var canvas=this.refs.overlay;var ctx=canvas.getContext("2d");ctx.save();ctx.scale(pixelRatio,pixelRatio);ctx.clearRect(0,0,width,height);ctx.globalCompositeOperation=compositeOperation;if((renderWhileDragging||!isDragging)&&locations){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=locations[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var location=_step.value;var pixel=mercator.project(lngLatAccessor(location));var pixelRounded=[round(pixel[0],1),round(pixel[1],1)];if(pixelRounded[0]+dotRadius>=0&&pixelRounded[0]-dotRadius<width&&pixelRounded[1]+dotRadius>=0&&pixelRounded[1]-dotRadius<height){ctx.fillStyle=dotFill;ctx.beginPath();ctx.arc(pixelRounded[0],pixelRounded[1],dotRadius,0,Math.PI*2);ctx.fill()}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}ctx.restore()}},{key:"render",value:function render(){var _props2=this.props,width=_props2.width,height=_props2.height,globalOpacity=_props2.globalOpacity;var pixelRatio=_window2.default.devicePixelRatio||1;return _react2.default.createElement("canvas",{ref:"overlay",width:width*pixelRatio,height:height*pixelRatio,style:{width:width+"px",height:height+"px",position:"absolute",pointerEvents:"none",opacity:globalOpacity,left:0,top:0}})}}]);return ScatterplotOverlay}(_react.Component),_class.propTypes={width:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,latitude:_react.PropTypes.number.isRequired,longitude:_react.PropTypes.number.isRequired,zoom:_react.PropTypes.number.isRequired,isDragging:_react.PropTypes.bool.isRequired,locations:_react.PropTypes.instanceOf(_immutable2.default.List).isRequired,lngLatAccessor:_react.PropTypes.func.isRequired,renderWhileDragging:_react.PropTypes.bool,globalOpacity:_react.PropTypes.number.isRequired,dotRadius:_react.PropTypes.number.isRequired,dotFill:_react.PropTypes.string.isRequired,compositeOperation:_react.PropTypes.oneOf(_canvasCompositeTypes2.default).isRequired},_class.defaultProps={lngLatAccessor:function lngLatAccessor(location){return[location.get(0),location.get(1)]},renderWhileDragging:true,dotRadius:4,dotFill:"#1FBAD6",globalOpacity:1,compositeOperation:"source-over"},_temp);exports.default=ScatterplotOverlay},{"canvas-composite-types":22,"global/window":449,immutable:453,react:948,"viewport-mercator-project":916}],910:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _class,_temp;var _react=require("react");var _react2=_interopRequireDefault(_react);var _viewportMercatorProject=require("viewport-mercator-project");var _viewportMercatorProject2=_interopRequireDefault(_viewportMercatorProject);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SVGOverlay=(_temp=_class=function(_Component){_inherits(SVGOverlay,_Component);function SVGOverlay(){_classCallCheck(this,SVGOverlay);return _possibleConstructorReturn(this,(SVGOverlay.__proto__||Object.getPrototypeOf(SVGOverlay)).apply(this,arguments))}_createClass(SVGOverlay,[{key:"render",value:function render(){var _props=this.props,width=_props.width,height=_props.height,isDragging=_props.isDragging;var style=_extends({pointerEvents:"none",position:"absolute",left:0,top:0},this.props.style);var mercator=(0,_viewportMercatorProject2.default)(this.props);var project=mercator.project,unproject=mercator.unproject;return _react2.default.createElement("svg",{ref:"overlay",width:width,height:height,style:style},this.props.redraw({width:width,height:height,project:project,unproject:unproject,isDragging:isDragging}))}}]);return SVGOverlay}(_react.Component),_class.propTypes={width:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,latitude:_react.PropTypes.number.isRequired,longitude:_react.PropTypes.number.isRequired,zoom:_react.PropTypes.number.isRequired,redraw:_react.PropTypes.func.isRequired,isDragging:_react.PropTypes.bool.isRequired},_temp);exports.default=SVGOverlay},{react:948,"viewport-mercator-project":916}],911:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.diffSources=diffSources;exports.diffLayers=diffLayers;exports.default=diffStyle;function diffSources(prevStyle,nextStyle){var prevSources=prevStyle.get("sources");var nextSources=nextStyle.get("sources");var enter=[];var update=[];var exit=[];var prevIds=prevSources.keySeq().toArray();var nextIds=nextSources.keySeq().toArray();var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=prevIds[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var id=_step.value;var nextSource=nextSources.get(id);if(nextSource){if(!nextSource.equals(prevSources.get(id))){update.push({id:id,source:nextSources.get(id)})}}else{exit.push({id:id,source:prevSources.get(id)})}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=nextIds[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _id=_step2.value;var prevSource=prevSources.get(_id);if(!prevSource){enter.push({id:_id,source:nextSources.get(_id)})}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return{enter:enter,update:update,exit:exit}}function diffLayers(prevStyle,nextStyle){var prevLayers=prevStyle.get("layers");var nextLayers=nextStyle.get("layers");var updates=[];var exiting=[];var prevMap={};var nextMap={};nextLayers.forEach(function(layer,index){var id=layer.get("id");var layerImBehind=nextLayers.get(index+1);nextMap[id]={layer:layer,id:id,before:layerImBehind?layerImBehind.get("id"):null,enter:true}});prevLayers.forEach(function(layer,index){var id=layer.get("id");var layerImBehind=prevLayers.get(index+1);prevMap[id]={layer:layer,id:id,before:layerImBehind?layerImBehind.get("id"):null};if(nextMap[id]){nextMap[id].enter=false}else{exiting.push(prevMap[id])}});var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=nextLayers.reverse()[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var layer=_step3.value;var id=layer.get("id");if(!prevMap[id]||!prevMap[id].layer.equals(nextMap[id].layer)||prevMap[id].before!==nextMap[id].before){updates.push(nextMap[id])}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}return{updates:updates,exiting:exiting}}function diffStyle(prevStyle,nextStyle){return{sourcesDiff:diffSources(prevStyle,nextStyle),layersDiff:diffLayers(prevStyle,nextStyle)}}},{}],912:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=fitBounds;var _transform=require("./transform");var _transform2=_interopRequireDefault(_transform);var _mapboxGl=require("mapbox-gl");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function fitBounds(width,height,bounds){var _ref=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{},_ref$padding=_ref.padding,padding=_ref$padding===undefined?0:_ref$padding;var _bounds=new _mapboxGl.LngLatBounds([bounds[0].reverse(),bounds[1].reverse()]);var offset=_mapboxGl.Point.convert([0,0]);var tr=new _transform2.default;tr.width=width;tr.height=height;var nw=tr.project(_bounds.getNorthWest());var se=tr.project(_bounds.getSouthEast());var size=se.sub(nw);var scaleX=(tr.width-padding*2-Math.abs(offset.x)*2)/size.x;var scaleY=(tr.height-padding*2-Math.abs(offset.y)*2)/size.y;var center=tr.unproject(nw.add(se).div(2));var zoom=tr.scaleZoom(tr.scale*Math.abs(Math.min(scaleX,scaleY)));return{latitude:center.lat,longitude:center.lng,zoom:zoom}}},{"./transform":914,"mapbox-gl":620}],913:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getInteractiveLayerIds=getInteractiveLayerIds;var _immutable=require("immutable");function getInteractiveLayerIds(mapStyle){var interactiveLayerIds=[];if(_immutable.Map.isMap(mapStyle)&&mapStyle.has("layers")){interactiveLayerIds=mapStyle.get("layers").filter(function(l){return l.get("interactive")}).map(function(l){return l.get("id")}).toJS()}else if(Array.isArray(mapStyle.layers)){interactiveLayerIds=mapStyle.layers.filter(function(l){return l.interactive}).map(function(l){return l.id})}return interactiveLayerIds}},{immutable:453}],914:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;exports.mod=mod;exports.unprojectFromTransform=unprojectFromTransform;exports.cloneTransform=cloneTransform;var _transform=require("mapbox-gl/js/geo/transform");var _transform2=_interopRequireDefault(_transform);var _mapboxGl=require("mapbox-gl");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_transform2.default;function mod(value,divisor){var modulus=value%divisor;return modulus<0?divisor+modulus:modulus}function unprojectFromTransform(transform,point){return transform.pointLocation(_mapboxGl.Point.convert(point))}function cloneTransform(original){var transform=new _transform2.default(original._minZoom,original._maxZoom);transform.latRange=original.latRange;transform.width=original.width;transform.height=original.height;transform.zoom=original.zoom;transform.center=original.center;transform.angle=original.angle;transform.altitude=original.altitude;transform.pitch=original.pitch;transform.bearing=original.bearing;transform.altitude=original.altitude;return transform}},{"mapbox-gl":620,"mapbox-gl/js/geo/transform":617}],915:[function(require,module,exports){module.exports=require("./dist")},{"./dist":901}],916:[function(require,module,exports){"use strict";var PI=Math.PI;var pow=Math.pow;var tan=Math.tan;var log=Math.log;var atan=Math.atan;var exp=Math.exp;var DEGREES_TO_RADIANS=PI/180;var RADIANS_TO_DEGREES=180/PI;function radians(value){return value*DEGREES_TO_RADIANS}function degrees(value){return value*RADIANS_TO_DEGREES}function ViewportMercator(opts){var scale=(opts.tileSize||512)*.5/PI*pow(2,opts.zoom);var lamda=radians(opts.longitude);var phi=radians(opts.latitude);var x=scale*(lamda+PI);var y=scale*(PI-log(tan(PI*.25+phi*.5)));var offsetX=opts.width*.5-x;var offsetY=opts.height*.5-y;function project(lnglat2){var lamda2=lnglat2[0]*DEGREES_TO_RADIANS;var phi2=lnglat2[1]*DEGREES_TO_RADIANS;var x2=scale*(lamda2+PI);var y2=scale*(PI-log(tan(PI*.25+phi2*.5)));return[x2+offsetX,y2+offsetY]}function unproject(xy){var x2=xy[0]-offsetX;var y2=xy[1]-offsetY;var lamda2=x2/scale-PI;var phi2=2*(atan(exp(PI-y2/scale))-PI*.25);return[degrees(lamda2),degrees(phi2)]}function contains(lnglat2){var xy=project(lnglat2);var x=xy[0];var y=xy[1];return x>=0&&x<=opts.width&&y>=0&&y<=opts.height}return{project:project,unproject:unproject,contains:contains}}module.exports=ViewportMercator},{}],917:[function(require,module,exports){"use strict";exports.__esModule=true;exports["default"]=undefined;var _react=require("react");var _storeShape=require("../utils/storeShape");var _storeShape2=_interopRequireDefault(_storeShape);var _warning=require("../utils/warning");var _warning2=_interopRequireDefault(_warning);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var didWarnAboutReceivingStore=false;function warnAboutReceivingStore(){if(didWarnAboutReceivingStore){return}didWarnAboutReceivingStore=true;(0,_warning2["default"])("<Provider> does not support changing `store` on the fly. "+"It is most likely that you see this error because you updated to "+"Redux 2.x and React Redux 2.x which no longer hot reload reducers "+"automatically. See https://github.com/reactjs/react-redux/releases/"+"tag/v2.0.0 for the migration instructions.")}var Provider=function(_Component){_inherits(Provider,_Component);Provider.prototype.getChildContext=function getChildContext(){return{store:this.store}};function Provider(props,context){_classCallCheck(this,Provider);var _this=_possibleConstructorReturn(this,_Component.call(this,props,context));_this.store=props.store;return _this}Provider.prototype.render=function render(){return _react.Children.only(this.props.children)};return Provider}(_react.Component);exports["default"]=Provider;if("production"!=="production"){Provider.prototype.componentWillReceiveProps=function(nextProps){var store=this.store;var nextStore=nextProps.store;if(store!==nextStore){warnAboutReceivingStore()}}}Provider.propTypes={store:_storeShape2["default"].isRequired,children:_react.PropTypes.element.isRequired};Provider.childContextTypes={store:_storeShape2["default"].isRequired}},{"../utils/storeShape":921,"../utils/warning":922,react:948}],918:[function(require,module,exports){"use strict";exports.__esModule=true;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports["default"]=connect;var _react=require("react");var _storeShape=require("../utils/storeShape");var _storeShape2=_interopRequireDefault(_storeShape);var _shallowEqual=require("../utils/shallowEqual");var _shallowEqual2=_interopRequireDefault(_shallowEqual);var _wrapActionCreators=require("../utils/wrapActionCreators");var _wrapActionCreators2=_interopRequireDefault(_wrapActionCreators);var _warning=require("../utils/warning");var _warning2=_interopRequireDefault(_warning);var _isPlainObject=require("lodash/isPlainObject");var _isPlainObject2=_interopRequireDefault(_isPlainObject);var _hoistNonReactStatics=require("hoist-non-react-statics");var _hoistNonReactStatics2=_interopRequireDefault(_hoistNonReactStatics);var _invariant=require("invariant");var _invariant2=_interopRequireDefault(_invariant);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");
}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var defaultMapStateToProps=function defaultMapStateToProps(state){return{}};var defaultMapDispatchToProps=function defaultMapDispatchToProps(dispatch){return{dispatch:dispatch}};var defaultMergeProps=function defaultMergeProps(stateProps,dispatchProps,parentProps){return _extends({},parentProps,stateProps,dispatchProps)};function getDisplayName(WrappedComponent){return WrappedComponent.displayName||WrappedComponent.name||"Component"}var errorObject={value:null};function tryCatch(fn,ctx){try{return fn.apply(ctx)}catch(e){errorObject.value=e;return errorObject}}var nextVersion=0;function connect(mapStateToProps,mapDispatchToProps,mergeProps){var options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var shouldSubscribe=Boolean(mapStateToProps);var mapState=mapStateToProps||defaultMapStateToProps;var mapDispatch=void 0;if(typeof mapDispatchToProps==="function"){mapDispatch=mapDispatchToProps}else if(!mapDispatchToProps){mapDispatch=defaultMapDispatchToProps}else{mapDispatch=(0,_wrapActionCreators2["default"])(mapDispatchToProps)}var finalMergeProps=mergeProps||defaultMergeProps;var _options$pure=options.pure,pure=_options$pure===undefined?true:_options$pure,_options$withRef=options.withRef,withRef=_options$withRef===undefined?false:_options$withRef;var checkMergedEquals=pure&&finalMergeProps!==defaultMergeProps;var version=nextVersion++;return function wrapWithConnect(WrappedComponent){var connectDisplayName="Connect("+getDisplayName(WrappedComponent)+")";function checkStateShape(props,methodName){if(!(0,_isPlainObject2["default"])(props)){(0,_warning2["default"])(methodName+"() in "+connectDisplayName+" must return a plain object. "+("Instead received "+props+"."))}}function computeMergedProps(stateProps,dispatchProps,parentProps){var mergedProps=finalMergeProps(stateProps,dispatchProps,parentProps);if("production"!=="production"){checkStateShape(mergedProps,"mergeProps")}return mergedProps}var Connect=function(_Component){_inherits(Connect,_Component);Connect.prototype.shouldComponentUpdate=function shouldComponentUpdate(){return!pure||this.haveOwnPropsChanged||this.hasStoreStateChanged};function Connect(props,context){_classCallCheck(this,Connect);var _this=_possibleConstructorReturn(this,_Component.call(this,props,context));_this.version=version;_this.store=props.store||context.store;(0,_invariant2["default"])(_this.store,'Could not find "store" in either the context or '+('props of "'+connectDisplayName+'". ')+"Either wrap the root component in a <Provider>, "+('or explicitly pass "store" as a prop to "'+connectDisplayName+'".'));var storeState=_this.store.getState();_this.state={storeState:storeState};_this.clearCache();return _this}Connect.prototype.computeStateProps=function computeStateProps(store,props){if(!this.finalMapStateToProps){return this.configureFinalMapState(store,props)}var state=store.getState();var stateProps=this.doStatePropsDependOnOwnProps?this.finalMapStateToProps(state,props):this.finalMapStateToProps(state);if("production"!=="production"){checkStateShape(stateProps,"mapStateToProps")}return stateProps};Connect.prototype.configureFinalMapState=function configureFinalMapState(store,props){var mappedState=mapState(store.getState(),props);var isFactory=typeof mappedState==="function";this.finalMapStateToProps=isFactory?mappedState:mapState;this.doStatePropsDependOnOwnProps=this.finalMapStateToProps.length!==1;if(isFactory){return this.computeStateProps(store,props)}if("production"!=="production"){checkStateShape(mappedState,"mapStateToProps")}return mappedState};Connect.prototype.computeDispatchProps=function computeDispatchProps(store,props){if(!this.finalMapDispatchToProps){return this.configureFinalMapDispatch(store,props)}var dispatch=store.dispatch;var dispatchProps=this.doDispatchPropsDependOnOwnProps?this.finalMapDispatchToProps(dispatch,props):this.finalMapDispatchToProps(dispatch);if("production"!=="production"){checkStateShape(dispatchProps,"mapDispatchToProps")}return dispatchProps};Connect.prototype.configureFinalMapDispatch=function configureFinalMapDispatch(store,props){var mappedDispatch=mapDispatch(store.dispatch,props);var isFactory=typeof mappedDispatch==="function";this.finalMapDispatchToProps=isFactory?mappedDispatch:mapDispatch;this.doDispatchPropsDependOnOwnProps=this.finalMapDispatchToProps.length!==1;if(isFactory){return this.computeDispatchProps(store,props)}if("production"!=="production"){checkStateShape(mappedDispatch,"mapDispatchToProps")}return mappedDispatch};Connect.prototype.updateStatePropsIfNeeded=function updateStatePropsIfNeeded(){var nextStateProps=this.computeStateProps(this.store,this.props);if(this.stateProps&&(0,_shallowEqual2["default"])(nextStateProps,this.stateProps)){return false}this.stateProps=nextStateProps;return true};Connect.prototype.updateDispatchPropsIfNeeded=function updateDispatchPropsIfNeeded(){var nextDispatchProps=this.computeDispatchProps(this.store,this.props);if(this.dispatchProps&&(0,_shallowEqual2["default"])(nextDispatchProps,this.dispatchProps)){return false}this.dispatchProps=nextDispatchProps;return true};Connect.prototype.updateMergedPropsIfNeeded=function updateMergedPropsIfNeeded(){var nextMergedProps=computeMergedProps(this.stateProps,this.dispatchProps,this.props);if(this.mergedProps&&checkMergedEquals&&(0,_shallowEqual2["default"])(nextMergedProps,this.mergedProps)){return false}this.mergedProps=nextMergedProps;return true};Connect.prototype.isSubscribed=function isSubscribed(){return typeof this.unsubscribe==="function"};Connect.prototype.trySubscribe=function trySubscribe(){if(shouldSubscribe&&!this.unsubscribe){this.unsubscribe=this.store.subscribe(this.handleChange.bind(this));this.handleChange()}};Connect.prototype.tryUnsubscribe=function tryUnsubscribe(){if(this.unsubscribe){this.unsubscribe();this.unsubscribe=null}};Connect.prototype.componentDidMount=function componentDidMount(){this.trySubscribe()};Connect.prototype.componentWillReceiveProps=function componentWillReceiveProps(nextProps){if(!pure||!(0,_shallowEqual2["default"])(nextProps,this.props)){this.haveOwnPropsChanged=true}};Connect.prototype.componentWillUnmount=function componentWillUnmount(){this.tryUnsubscribe();this.clearCache()};Connect.prototype.clearCache=function clearCache(){this.dispatchProps=null;this.stateProps=null;this.mergedProps=null;this.haveOwnPropsChanged=true;this.hasStoreStateChanged=true;this.haveStatePropsBeenPrecalculated=false;this.statePropsPrecalculationError=null;this.renderedElement=null;this.finalMapDispatchToProps=null;this.finalMapStateToProps=null};Connect.prototype.handleChange=function handleChange(){if(!this.unsubscribe){return}var storeState=this.store.getState();var prevStoreState=this.state.storeState;if(pure&&prevStoreState===storeState){return}if(pure&&!this.doStatePropsDependOnOwnProps){var haveStatePropsChanged=tryCatch(this.updateStatePropsIfNeeded,this);if(!haveStatePropsChanged){return}if(haveStatePropsChanged===errorObject){this.statePropsPrecalculationError=errorObject.value}this.haveStatePropsBeenPrecalculated=true}this.hasStoreStateChanged=true;this.setState({storeState:storeState})};Connect.prototype.getWrappedInstance=function getWrappedInstance(){(0,_invariant2["default"])(withRef,"To access the wrapped instance, you need to specify "+"{ withRef: true } as the fourth argument of the connect() call.");return this.refs.wrappedInstance};Connect.prototype.render=function render(){var haveOwnPropsChanged=this.haveOwnPropsChanged,hasStoreStateChanged=this.hasStoreStateChanged,haveStatePropsBeenPrecalculated=this.haveStatePropsBeenPrecalculated,statePropsPrecalculationError=this.statePropsPrecalculationError,renderedElement=this.renderedElement;this.haveOwnPropsChanged=false;this.hasStoreStateChanged=false;this.haveStatePropsBeenPrecalculated=false;this.statePropsPrecalculationError=null;if(statePropsPrecalculationError){throw statePropsPrecalculationError}var shouldUpdateStateProps=true;var shouldUpdateDispatchProps=true;if(pure&&renderedElement){shouldUpdateStateProps=hasStoreStateChanged||haveOwnPropsChanged&&this.doStatePropsDependOnOwnProps;shouldUpdateDispatchProps=haveOwnPropsChanged&&this.doDispatchPropsDependOnOwnProps}var haveStatePropsChanged=false;var haveDispatchPropsChanged=false;if(haveStatePropsBeenPrecalculated){haveStatePropsChanged=true}else if(shouldUpdateStateProps){haveStatePropsChanged=this.updateStatePropsIfNeeded()}if(shouldUpdateDispatchProps){haveDispatchPropsChanged=this.updateDispatchPropsIfNeeded()}var haveMergedPropsChanged=true;if(haveStatePropsChanged||haveDispatchPropsChanged||haveOwnPropsChanged){haveMergedPropsChanged=this.updateMergedPropsIfNeeded()}else{haveMergedPropsChanged=false}if(!haveMergedPropsChanged&&renderedElement){return renderedElement}if(withRef){this.renderedElement=(0,_react.createElement)(WrappedComponent,_extends({},this.mergedProps,{ref:"wrappedInstance"}))}else{this.renderedElement=(0,_react.createElement)(WrappedComponent,this.mergedProps)}return this.renderedElement};return Connect}(_react.Component);Connect.displayName=connectDisplayName;Connect.WrappedComponent=WrappedComponent;Connect.contextTypes={store:_storeShape2["default"]};Connect.propTypes={store:_storeShape2["default"]};if("production"!=="production"){Connect.prototype.componentWillUpdate=function componentWillUpdate(){if(this.version===version){return}this.version=version;this.trySubscribe();this.clearCache()}}return(0,_hoistNonReactStatics2["default"])(Connect,WrappedComponent)}}},{"../utils/shallowEqual":920,"../utils/storeShape":921,"../utils/warning":922,"../utils/wrapActionCreators":923,"hoist-non-react-statics":451,invariant:455,"lodash/isPlainObject":481,react:948}],919:[function(require,module,exports){"use strict";exports.__esModule=true;exports.connect=exports.Provider=undefined;var _Provider=require("./components/Provider");var _Provider2=_interopRequireDefault(_Provider);var _connect=require("./components/connect");var _connect2=_interopRequireDefault(_connect);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.Provider=_Provider2["default"];exports.connect=_connect2["default"]},{"./components/Provider":917,"./components/connect":918}],920:[function(require,module,exports){"use strict";exports.__esModule=true;exports["default"]=shallowEqual;function shallowEqual(objA,objB){if(objA===objB){return true}var keysA=Object.keys(objA);var keysB=Object.keys(objB);if(keysA.length!==keysB.length){return false}var hasOwn=Object.prototype.hasOwnProperty;for(var i=0;i<keysA.length;i++){if(!hasOwn.call(objB,keysA[i])||objA[keysA[i]]!==objB[keysA[i]]){return false}}return true}},{}],921:[function(require,module,exports){"use strict";exports.__esModule=true;var _react=require("react");exports["default"]=_react.PropTypes.shape({subscribe:_react.PropTypes.func.isRequired,dispatch:_react.PropTypes.func.isRequired,getState:_react.PropTypes.func.isRequired})},{react:948}],922:[function(require,module,exports){"use strict";exports.__esModule=true;exports["default"]=warning;function warning(message){if(typeof console!=="undefined"&&typeof console.error==="function"){console.error(message)}try{throw new Error(message)}catch(e){}}},{}],923:[function(require,module,exports){"use strict";exports.__esModule=true;exports["default"]=wrapActionCreators;var _redux=require("redux");function wrapActionCreators(actionCreators){return function(dispatch){return(0,_redux.bindActionCreators)(actionCreators,dispatch)}}},{redux:961}],924:[function(require,module,exports){arguments[4][795][0].apply(exports,arguments)},{dup:795}],925:[function(require,module,exports){arguments[4][797][0].apply(exports,arguments)},{"./reactProdInvariant":946,dup:797,"fbjs/lib/invariant":406}],926:[function(require,module,exports){"use strict";var _assign=require("object-assign");var ReactChildren=require("./ReactChildren");var ReactComponent=require("./ReactComponent");var ReactPureComponent=require("./ReactPureComponent");var ReactClass=require("./ReactClass");var ReactDOMFactories=require("./ReactDOMFactories");var ReactElement=require("./ReactElement");var ReactPropTypes=require("./ReactPropTypes");var ReactVersion=require("./ReactVersion");var onlyChild=require("./onlyChild");var warning=require("fbjs/lib/warning");var createElement=ReactElement.createElement;var createFactory=ReactElement.createFactory;var cloneElement=ReactElement.cloneElement;if("production"!=="production"){var ReactElementValidator=require("./ReactElementValidator");createElement=ReactElementValidator.createElement;createFactory=ReactElementValidator.createFactory;cloneElement=ReactElementValidator.cloneElement}var __spread=_assign;if("production"!=="production"){var warned=false;__spread=function(){"production"!=="production"?warning(warned,"React.__spread is deprecated and should not be used. Use "+"Object.assign directly or another helper function with similar "+"semantics. You may be seeing this warning due to your compiler. "+"See https://fb.me/react-spread-deprecation for more details."):void 0;warned=true;return _assign.apply(null,arguments)}}var React={Children:{map:ReactChildren.map,forEach:ReactChildren.forEach,count:ReactChildren.count,toArray:ReactChildren.toArray,only:onlyChild},Component:ReactComponent,PureComponent:ReactPureComponent,createElement:createElement,cloneElement:cloneElement,isValidElement:ReactElement.isValidElement,PropTypes:ReactPropTypes,createClass:ReactClass.createClass,createFactory:createFactory,createMixin:function(mixin){return mixin},DOM:ReactDOMFactories,version:ReactVersion,__spread:__spread};module.exports=React},{"./ReactChildren":927,"./ReactClass":928,"./ReactComponent":929,"./ReactDOMFactories":932,"./ReactElement":933,"./ReactElementValidator":935,"./ReactPropTypes":938,"./ReactPureComponent":940,"./ReactVersion":941,"./onlyChild":945,"fbjs/lib/warning":413,"object-assign":732}],927:[function(require,module,exports){"use strict";var PooledClass=require("./PooledClass");var ReactElement=require("./ReactElement");var emptyFunction=require("fbjs/lib/emptyFunction");var traverseAllChildren=require("./traverseAllChildren");var twoArgumentPooler=PooledClass.twoArgumentPooler;var fourArgumentPooler=PooledClass.fourArgumentPooler;var userProvidedKeyEscapeRegex=/\/+/g;function escapeUserProvidedKey(text){return(""+text).replace(userProvidedKeyEscapeRegex,"$&/")}function ForEachBookKeeping(forEachFunction,forEachContext){this.func=forEachFunction;this.context=forEachContext;this.count=0}ForEachBookKeeping.prototype.destructor=function(){this.func=null;this.context=null;this.count=0};PooledClass.addPoolingTo(ForEachBookKeeping,twoArgumentPooler);function forEachSingleChild(bookKeeping,child,name){var func=bookKeeping.func,context=bookKeeping.context;func.call(context,child,bookKeeping.count++)}function forEachChildren(children,forEachFunc,forEachContext){if(children==null){return children}var traverseContext=ForEachBookKeeping.getPooled(forEachFunc,forEachContext);traverseAllChildren(children,forEachSingleChild,traverseContext);ForEachBookKeeping.release(traverseContext)}function MapBookKeeping(mapResult,keyPrefix,mapFunction,mapContext){this.result=mapResult;this.keyPrefix=keyPrefix;this.func=mapFunction;this.context=mapContext;this.count=0}MapBookKeeping.prototype.destructor=function(){this.result=null;this.keyPrefix=null;this.func=null;this.context=null;this.count=0};PooledClass.addPoolingTo(MapBookKeeping,fourArgumentPooler);function mapSingleChildIntoContext(bookKeeping,child,childKey){var result=bookKeeping.result,keyPrefix=bookKeeping.keyPrefix,func=bookKeeping.func,context=bookKeeping.context;var mappedChild=func.call(context,child,bookKeeping.count++);if(Array.isArray(mappedChild)){mapIntoWithKeyPrefixInternal(mappedChild,result,childKey,emptyFunction.thatReturnsArgument)}else if(mappedChild!=null){if(ReactElement.isValidElement(mappedChild)){mappedChild=ReactElement.cloneAndReplaceKey(mappedChild,keyPrefix+(mappedChild.key&&(!child||child.key!==mappedChild.key)?escapeUserProvidedKey(mappedChild.key)+"/":"")+childKey)}result.push(mappedChild)}}function mapIntoWithKeyPrefixInternal(children,array,prefix,func,context){var escapedPrefix="";if(prefix!=null){escapedPrefix=escapeUserProvidedKey(prefix)+"/"}var traverseContext=MapBookKeeping.getPooled(array,escapedPrefix,func,context);traverseAllChildren(children,mapSingleChildIntoContext,traverseContext);MapBookKeeping.release(traverseContext)}function mapChildren(children,func,context){if(children==null){return children}var result=[];mapIntoWithKeyPrefixInternal(children,result,null,func,context);return result}function forEachSingleChildDummy(traverseContext,child,name){return null}function countChildren(children,context){return traverseAllChildren(children,forEachSingleChildDummy,null)}function toArray(children){var result=[];mapIntoWithKeyPrefixInternal(children,result,null,emptyFunction.thatReturnsArgument);return result}var ReactChildren={forEach:forEachChildren,map:mapChildren,mapIntoWithKeyPrefixInternal:mapIntoWithKeyPrefixInternal,count:countChildren,toArray:toArray};module.exports=ReactChildren},{"./PooledClass":925,"./ReactElement":933,"./traverseAllChildren":947,"fbjs/lib/emptyFunction":398}],928:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant"),_assign=require("object-assign");var ReactComponent=require("./ReactComponent");var ReactElement=require("./ReactElement");var ReactPropTypeLocationNames=require("./ReactPropTypeLocationNames");var ReactNoopUpdateQueue=require("./ReactNoopUpdateQueue");var emptyObject=require("fbjs/lib/emptyObject");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");var MIXINS_KEY="mixins";function identity(fn){return fn}var injectedMixins=[];var ReactClassInterface={mixins:"DEFINE_MANY",statics:"DEFINE_MANY",propTypes:"DEFINE_MANY",contextTypes:"DEFINE_MANY",childContextTypes:"DEFINE_MANY",getDefaultProps:"DEFINE_MANY_MERGED",getInitialState:"DEFINE_MANY_MERGED",getChildContext:"DEFINE_MANY_MERGED",render:"DEFINE_ONCE",componentWillMount:"DEFINE_MANY",componentDidMount:"DEFINE_MANY",componentWillReceiveProps:"DEFINE_MANY",shouldComponentUpdate:"DEFINE_ONCE",componentWillUpdate:"DEFINE_MANY",componentDidUpdate:"DEFINE_MANY",componentWillUnmount:"DEFINE_MANY",updateComponent:"OVERRIDE_BASE"};var RESERVED_SPEC_KEYS={displayName:function(Constructor,displayName){Constructor.displayName=displayName},mixins:function(Constructor,mixins){if(mixins){for(var i=0;i<mixins.length;i++){mixSpecIntoComponent(Constructor,mixins[i])}}},childContextTypes:function(Constructor,childContextTypes){if("production"!=="production"){validateTypeDef(Constructor,childContextTypes,"childContext")}Constructor.childContextTypes=_assign({},Constructor.childContextTypes,childContextTypes)},contextTypes:function(Constructor,contextTypes){if("production"!=="production"){validateTypeDef(Constructor,contextTypes,"context")}Constructor.contextTypes=_assign({},Constructor.contextTypes,contextTypes)},getDefaultProps:function(Constructor,getDefaultProps){if(Constructor.getDefaultProps){Constructor.getDefaultProps=createMergedResultFunction(Constructor.getDefaultProps,getDefaultProps)}else{Constructor.getDefaultProps=getDefaultProps}},propTypes:function(Constructor,propTypes){if("production"!=="production"){validateTypeDef(Constructor,propTypes,"prop")}Constructor.propTypes=_assign({},Constructor.propTypes,propTypes)},statics:function(Constructor,statics){mixStaticSpecIntoComponent(Constructor,statics)},autobind:function(){}};function validateTypeDef(Constructor,typeDef,location){for(var propName in typeDef){if(typeDef.hasOwnProperty(propName)){"production"!=="production"?warning(typeof typeDef[propName]==="function","%s: %s type `%s` is invalid; it must be a function, usually from "+"React.PropTypes.",Constructor.displayName||"ReactClass",ReactPropTypeLocationNames[location],propName):void 0}}}function validateMethodOverride(isAlreadyDefined,name){var specPolicy=ReactClassInterface.hasOwnProperty(name)?ReactClassInterface[name]:null;if(ReactClassMixin.hasOwnProperty(name)){!(specPolicy==="OVERRIDE_BASE")?"production"!=="production"?invariant(false,"ReactClassInterface: You are attempting to override `%s` from your class specification. Ensure that your method names do not overlap with React methods.",name):_prodInvariant("73",name):void 0}if(isAlreadyDefined){!(specPolicy==="DEFINE_MANY"||specPolicy==="DEFINE_MANY_MERGED")?"production"!=="production"?invariant(false,"ReactClassInterface: You are attempting to define `%s` on your component more than once. This conflict may be due to a mixin.",name):_prodInvariant("74",name):void 0}}function mixSpecIntoComponent(Constructor,spec){if(!spec){if("production"!=="production"){var typeofSpec=typeof spec;var isMixinValid=typeofSpec==="object"&&spec!==null;"production"!=="production"?warning(isMixinValid,"%s: You're attempting to include a mixin that is either null "+"or not an object. Check the mixins included by the component, "+"as well as any mixins they include themselves. "+"Expected object but got %s.",Constructor.displayName||"ReactClass",spec===null?null:typeofSpec):void 0}return}!(typeof spec!=="function")?"production"!=="production"?invariant(false,"ReactClass: You're attempting to use a component class or function as a mixin. Instead, just use a regular object."):_prodInvariant("75"):void 0;!!ReactElement.isValidElement(spec)?"production"!=="production"?invariant(false,"ReactClass: You're attempting to use a component as a mixin. Instead, just use a regular object."):_prodInvariant("76"):void 0;var proto=Constructor.prototype;var autoBindPairs=proto.__reactAutoBindPairs;if(spec.hasOwnProperty(MIXINS_KEY)){RESERVED_SPEC_KEYS.mixins(Constructor,spec.mixins)}for(var name in spec){if(!spec.hasOwnProperty(name)){continue}if(name===MIXINS_KEY){continue}var property=spec[name];var isAlreadyDefined=proto.hasOwnProperty(name);validateMethodOverride(isAlreadyDefined,name);if(RESERVED_SPEC_KEYS.hasOwnProperty(name)){RESERVED_SPEC_KEYS[name](Constructor,property)}else{var isReactClassMethod=ReactClassInterface.hasOwnProperty(name);var isFunction=typeof property==="function";var shouldAutoBind=isFunction&&!isReactClassMethod&&!isAlreadyDefined&&spec.autobind!==false;if(shouldAutoBind){autoBindPairs.push(name,property);proto[name]=property}else{if(isAlreadyDefined){var specPolicy=ReactClassInterface[name];!(isReactClassMethod&&(specPolicy==="DEFINE_MANY_MERGED"||specPolicy==="DEFINE_MANY"))?"production"!=="production"?invariant(false,"ReactClass: Unexpected spec policy %s for key %s when mixing in component specs.",specPolicy,name):_prodInvariant("77",specPolicy,name):void 0;if(specPolicy==="DEFINE_MANY_MERGED"){proto[name]=createMergedResultFunction(proto[name],property)}else if(specPolicy==="DEFINE_MANY"){proto[name]=createChainedFunction(proto[name],property)}}else{proto[name]=property;if("production"!=="production"){if(typeof property==="function"&&spec.displayName){proto[name].displayName=spec.displayName+"_"+name}}}}}}}function mixStaticSpecIntoComponent(Constructor,statics){if(!statics){return}for(var name in statics){var property=statics[name];if(!statics.hasOwnProperty(name)){continue}var isReserved=name in RESERVED_SPEC_KEYS;!!isReserved?"production"!=="production"?invariant(false,'ReactClass: You are attempting to define a reserved property, `%s`, that shouldn\'t be on the "statics" key. Define it as an instance property instead; it will still be accessible on the constructor.',name):_prodInvariant("78",name):void 0;var isInherited=name in Constructor;!!isInherited?"production"!=="production"?invariant(false,"ReactClass: You are attempting to define `%s` on your component more than once. This conflict may be due to a mixin.",name):_prodInvariant("79",name):void 0;Constructor[name]=property}}function mergeIntoWithNoDuplicateKeys(one,two){!(one&&two&&typeof one==="object"&&typeof two==="object")?"production"!=="production"?invariant(false,"mergeIntoWithNoDuplicateKeys(): Cannot merge non-objects."):_prodInvariant("80"):void 0;for(var key in two){if(two.hasOwnProperty(key)){!(one[key]===undefined)?"production"!=="production"?invariant(false,"mergeIntoWithNoDuplicateKeys(): Tried to merge two objects with the same key: `%s`. This conflict may be due to a mixin; in particular, this may be caused by two getInitialState() or getDefaultProps() methods returning objects with clashing keys.",key):_prodInvariant("81",key):void 0;one[key]=two[key]}}return one}function createMergedResultFunction(one,two){return function mergedResult(){var a=one.apply(this,arguments);var b=two.apply(this,arguments);if(a==null){return b}else if(b==null){return a}var c={};mergeIntoWithNoDuplicateKeys(c,a);mergeIntoWithNoDuplicateKeys(c,b);return c}}function createChainedFunction(one,two){return function chainedFunction(){one.apply(this,arguments);two.apply(this,arguments)}}function bindAutoBindMethod(component,method){var boundMethod=method.bind(component);if("production"!=="production"){boundMethod.__reactBoundContext=component;boundMethod.__reactBoundMethod=method;boundMethod.__reactBoundArguments=null;var componentName=component.constructor.displayName;var _bind=boundMethod.bind;boundMethod.bind=function(newThis){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}if(newThis!==component&&newThis!==null){"production"!=="production"?warning(false,"bind(): React component methods may only be bound to the "+"component instance. See %s",componentName):void 0}else if(!args.length){"production"!=="production"?warning(false,"bind(): You are binding a component method to the component. "+"React does this for you automatically in a high-performance "+"way, so you can safely remove this call. See %s",componentName):void 0;return boundMethod}var reboundMethod=_bind.apply(boundMethod,arguments);reboundMethod.__reactBoundContext=component;reboundMethod.__reactBoundMethod=method;reboundMethod.__reactBoundArguments=args;return reboundMethod}}return boundMethod}function bindAutoBindMethods(component){var pairs=component.__reactAutoBindPairs;for(var i=0;i<pairs.length;i+=2){var autoBindKey=pairs[i];var method=pairs[i+1];component[autoBindKey]=bindAutoBindMethod(component,method)}}var ReactClassMixin={replaceState:function(newState,callback){this.updater.enqueueReplaceState(this,newState);if(callback){this.updater.enqueueCallback(this,callback,"replaceState")}},isMounted:function(){return this.updater.isMounted(this)}};var ReactClassComponent=function(){};_assign(ReactClassComponent.prototype,ReactComponent.prototype,ReactClassMixin);var ReactClass={createClass:function(spec){var Constructor=identity(function(props,context,updater){if("production"!=="production"){"production"!=="production"?warning(this instanceof Constructor,"Something is calling a React component directly. Use a factory or "+"JSX instead. See: https://fb.me/react-legacyfactory"):void 0}if(this.__reactAutoBindPairs.length){bindAutoBindMethods(this)}this.props=props;this.context=context;this.refs=emptyObject;this.updater=updater||ReactNoopUpdateQueue;this.state=null;var initialState=this.getInitialState?this.getInitialState():null;if("production"!=="production"){if(initialState===undefined&&this.getInitialState._isMockFunction){initialState=null}}!(typeof initialState==="object"&&!Array.isArray(initialState))?"production"!=="production"?invariant(false,"%s.getInitialState(): must return an object or null",Constructor.displayName||"ReactCompositeComponent"):_prodInvariant("82",Constructor.displayName||"ReactCompositeComponent"):void 0;this.state=initialState});Constructor.prototype=new ReactClassComponent;Constructor.prototype.constructor=Constructor;Constructor.prototype.__reactAutoBindPairs=[];injectedMixins.forEach(mixSpecIntoComponent.bind(null,Constructor));mixSpecIntoComponent(Constructor,spec);if(Constructor.getDefaultProps){Constructor.defaultProps=Constructor.getDefaultProps()}if("production"!=="production"){if(Constructor.getDefaultProps){Constructor.getDefaultProps.isReactClassApproved={}}if(Constructor.prototype.getInitialState){Constructor.prototype.getInitialState.isReactClassApproved={}}}!Constructor.prototype.render?"production"!=="production"?invariant(false,"createClass(...): Class specification must implement a `render` method."):_prodInvariant("83"):void 0;if("production"!=="production"){"production"!=="production"?warning(!Constructor.prototype.componentShouldUpdate,"%s has a method called "+"componentShouldUpdate(). Did you mean shouldComponentUpdate()? "+"The name is phrased as a question because the function is "+"expected to return a value.",spec.displayName||"A component"):void 0;"production"!=="production"?warning(!Constructor.prototype.componentWillRecieveProps,"%s has a method called "+"componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",spec.displayName||"A component"):void 0}for(var methodName in ReactClassInterface){if(!Constructor.prototype[methodName]){Constructor.prototype[methodName]=null}}return Constructor},injection:{injectMixin:function(mixin){injectedMixins.push(mixin)}}};module.exports=ReactClass},{"./ReactComponent":929,"./ReactElement":933,"./ReactNoopUpdateQueue":936,"./ReactPropTypeLocationNames":937,"./reactProdInvariant":946,"fbjs/lib/emptyObject":399,"fbjs/lib/invariant":406,"fbjs/lib/warning":413,"object-assign":732}],929:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var ReactNoopUpdateQueue=require("./ReactNoopUpdateQueue");var canDefineProperty=require("./canDefineProperty");var emptyObject=require("fbjs/lib/emptyObject");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");function ReactComponent(props,context,updater){this.props=props;this.context=context;this.refs=emptyObject;this.updater=updater||ReactNoopUpdateQueue}ReactComponent.prototype.isReactComponent={};ReactComponent.prototype.setState=function(partialState,callback){!(typeof partialState==="object"||typeof partialState==="function"||partialState==null)?"production"!=="production"?invariant(false,"setState(...): takes an object of state variables to update or a function which returns an object of state variables."):_prodInvariant("85"):void 0;this.updater.enqueueSetState(this,partialState);if(callback){this.updater.enqueueCallback(this,callback,"setState")}};ReactComponent.prototype.forceUpdate=function(callback){this.updater.enqueueForceUpdate(this);if(callback){this.updater.enqueueCallback(this,callback,"forceUpdate")}};if("production"!=="production"){var deprecatedAPIs={isMounted:["isMounted","Instead, make sure to clean up subscriptions and pending requests in "+"componentWillUnmount to prevent memory leaks."],replaceState:["replaceState","Refactor your code to use setState instead (see "+"https://github.com/facebook/react/issues/3236)."]};var defineDeprecationWarning=function(methodName,info){if(canDefineProperty){Object.defineProperty(ReactComponent.prototype,methodName,{get:function(){"production"!=="production"?warning(false,"%s(...) is deprecated in plain JavaScript React classes. %s",info[0],info[1]):void 0;return undefined}})}};for(var fnName in deprecatedAPIs){if(deprecatedAPIs.hasOwnProperty(fnName)){defineDeprecationWarning(fnName,deprecatedAPIs[fnName]);
}}}module.exports=ReactComponent},{"./ReactNoopUpdateQueue":936,"./canDefineProperty":942,"./reactProdInvariant":946,"fbjs/lib/emptyObject":399,"fbjs/lib/invariant":406,"fbjs/lib/warning":413}],930:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var ReactCurrentOwner=require("./ReactCurrentOwner");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");function isNative(fn){var funcToString=Function.prototype.toString;var hasOwnProperty=Object.prototype.hasOwnProperty;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");try{var source=funcToString.call(fn);return reIsNative.test(source)}catch(err){return false}}var canUseCollections=typeof Array.from==="function"&&typeof Map==="function"&&isNative(Map)&&Map.prototype!=null&&typeof Map.prototype.keys==="function"&&isNative(Map.prototype.keys)&&typeof Set==="function"&&isNative(Set)&&Set.prototype!=null&&typeof Set.prototype.keys==="function"&&isNative(Set.prototype.keys);var setItem;var getItem;var removeItem;var getItemIDs;var addRoot;var removeRoot;var getRootIDs;if(canUseCollections){var itemMap=new Map;var rootIDSet=new Set;setItem=function(id,item){itemMap.set(id,item)};getItem=function(id){return itemMap.get(id)};removeItem=function(id){itemMap["delete"](id)};getItemIDs=function(){return Array.from(itemMap.keys())};addRoot=function(id){rootIDSet.add(id)};removeRoot=function(id){rootIDSet["delete"](id)};getRootIDs=function(){return Array.from(rootIDSet.keys())}}else{var itemByKey={};var rootByKey={};var getKeyFromID=function(id){return"."+id};var getIDFromKey=function(key){return parseInt(key.substr(1),10)};setItem=function(id,item){var key=getKeyFromID(id);itemByKey[key]=item};getItem=function(id){var key=getKeyFromID(id);return itemByKey[key]};removeItem=function(id){var key=getKeyFromID(id);delete itemByKey[key]};getItemIDs=function(){return Object.keys(itemByKey).map(getIDFromKey)};addRoot=function(id){var key=getKeyFromID(id);rootByKey[key]=true};removeRoot=function(id){var key=getKeyFromID(id);delete rootByKey[key]};getRootIDs=function(){return Object.keys(rootByKey).map(getIDFromKey)}}var unmountedIDs=[];function purgeDeep(id){var item=getItem(id);if(item){var childIDs=item.childIDs;removeItem(id);childIDs.forEach(purgeDeep)}}function describeComponentFrame(name,source,ownerName){return"\n    in "+(name||"Unknown")+(source?" (at "+source.fileName.replace(/^.*[\\\/]/,"")+":"+source.lineNumber+")":ownerName?" (created by "+ownerName+")":"")}function getDisplayName(element){if(element==null){return"#empty"}else if(typeof element==="string"||typeof element==="number"){return"#text"}else if(typeof element.type==="string"){return element.type}else{return element.type.displayName||element.type.name||"Unknown"}}function describeID(id){var name=ReactComponentTreeHook.getDisplayName(id);var element=ReactComponentTreeHook.getElement(id);var ownerID=ReactComponentTreeHook.getOwnerID(id);var ownerName;if(ownerID){ownerName=ReactComponentTreeHook.getDisplayName(ownerID)}"production"!=="production"?warning(element,"ReactComponentTreeHook: Missing React element for debugID %s when "+"building stack",id):void 0;return describeComponentFrame(name,element&&element._source,ownerName)}var ReactComponentTreeHook={onSetChildren:function(id,nextChildIDs){var item=getItem(id);!item?"production"!=="production"?invariant(false,"Item must have been set"):_prodInvariant("144"):void 0;item.childIDs=nextChildIDs;for(var i=0;i<nextChildIDs.length;i++){var nextChildID=nextChildIDs[i];var nextChild=getItem(nextChildID);!nextChild?"production"!=="production"?invariant(false,"Expected hook events to fire for the child before its parent includes it in onSetChildren()."):_prodInvariant("140"):void 0;!(nextChild.childIDs!=null||typeof nextChild.element!=="object"||nextChild.element==null)?"production"!=="production"?invariant(false,"Expected onSetChildren() to fire for a container child before its parent includes it in onSetChildren()."):_prodInvariant("141"):void 0;!nextChild.isMounted?"production"!=="production"?invariant(false,"Expected onMountComponent() to fire for the child before its parent includes it in onSetChildren()."):_prodInvariant("71"):void 0;if(nextChild.parentID==null){nextChild.parentID=id}!(nextChild.parentID===id)?"production"!=="production"?invariant(false,"Expected onBeforeMountComponent() parent and onSetChildren() to be consistent (%s has parents %s and %s).",nextChildID,nextChild.parentID,id):_prodInvariant("142",nextChildID,nextChild.parentID,id):void 0}},onBeforeMountComponent:function(id,element,parentID){var item={element:element,parentID:parentID,text:null,childIDs:[],isMounted:false,updateCount:0};setItem(id,item)},onBeforeUpdateComponent:function(id,element){var item=getItem(id);if(!item||!item.isMounted){return}item.element=element},onMountComponent:function(id){var item=getItem(id);!item?"production"!=="production"?invariant(false,"Item must have been set"):_prodInvariant("144"):void 0;item.isMounted=true;var isRoot=item.parentID===0;if(isRoot){addRoot(id)}},onUpdateComponent:function(id){var item=getItem(id);if(!item||!item.isMounted){return}item.updateCount++},onUnmountComponent:function(id){var item=getItem(id);if(item){item.isMounted=false;var isRoot=item.parentID===0;if(isRoot){removeRoot(id)}}unmountedIDs.push(id)},purgeUnmountedComponents:function(){if(ReactComponentTreeHook._preventPurging){return}for(var i=0;i<unmountedIDs.length;i++){var id=unmountedIDs[i];purgeDeep(id)}unmountedIDs.length=0},isMounted:function(id){var item=getItem(id);return item?item.isMounted:false},getCurrentStackAddendum:function(topElement){var info="";if(topElement){var name=getDisplayName(topElement);var owner=topElement._owner;info+=describeComponentFrame(name,topElement._source,owner&&owner.getName())}var currentOwner=ReactCurrentOwner.current;var id=currentOwner&&currentOwner._debugID;info+=ReactComponentTreeHook.getStackAddendumByID(id);return info},getStackAddendumByID:function(id){var info="";while(id){info+=describeID(id);id=ReactComponentTreeHook.getParentID(id)}return info},getChildIDs:function(id){var item=getItem(id);return item?item.childIDs:[]},getDisplayName:function(id){var element=ReactComponentTreeHook.getElement(id);if(!element){return null}return getDisplayName(element)},getElement:function(id){var item=getItem(id);return item?item.element:null},getOwnerID:function(id){var element=ReactComponentTreeHook.getElement(id);if(!element||!element._owner){return null}return element._owner._debugID},getParentID:function(id){var item=getItem(id);return item?item.parentID:null},getSource:function(id){var item=getItem(id);var element=item?item.element:null;var source=element!=null?element._source:null;return source},getText:function(id){var element=ReactComponentTreeHook.getElement(id);if(typeof element==="string"){return element}else if(typeof element==="number"){return""+element}else{return null}},getUpdateCount:function(id){var item=getItem(id);return item?item.updateCount:0},getRootIDs:getRootIDs,getRegisteredIDs:getItemIDs};module.exports=ReactComponentTreeHook},{"./ReactCurrentOwner":931,"./reactProdInvariant":946,"fbjs/lib/invariant":406,"fbjs/lib/warning":413}],931:[function(require,module,exports){"use strict";var ReactCurrentOwner={current:null};module.exports=ReactCurrentOwner},{}],932:[function(require,module,exports){"use strict";var ReactElement=require("./ReactElement");var createDOMFactory=ReactElement.createFactory;if("production"!=="production"){var ReactElementValidator=require("./ReactElementValidator");createDOMFactory=ReactElementValidator.createFactory}var ReactDOMFactories={a:createDOMFactory("a"),abbr:createDOMFactory("abbr"),address:createDOMFactory("address"),area:createDOMFactory("area"),article:createDOMFactory("article"),aside:createDOMFactory("aside"),audio:createDOMFactory("audio"),b:createDOMFactory("b"),base:createDOMFactory("base"),bdi:createDOMFactory("bdi"),bdo:createDOMFactory("bdo"),big:createDOMFactory("big"),blockquote:createDOMFactory("blockquote"),body:createDOMFactory("body"),br:createDOMFactory("br"),button:createDOMFactory("button"),canvas:createDOMFactory("canvas"),caption:createDOMFactory("caption"),cite:createDOMFactory("cite"),code:createDOMFactory("code"),col:createDOMFactory("col"),colgroup:createDOMFactory("colgroup"),data:createDOMFactory("data"),datalist:createDOMFactory("datalist"),dd:createDOMFactory("dd"),del:createDOMFactory("del"),details:createDOMFactory("details"),dfn:createDOMFactory("dfn"),dialog:createDOMFactory("dialog"),div:createDOMFactory("div"),dl:createDOMFactory("dl"),dt:createDOMFactory("dt"),em:createDOMFactory("em"),embed:createDOMFactory("embed"),fieldset:createDOMFactory("fieldset"),figcaption:createDOMFactory("figcaption"),figure:createDOMFactory("figure"),footer:createDOMFactory("footer"),form:createDOMFactory("form"),h1:createDOMFactory("h1"),h2:createDOMFactory("h2"),h3:createDOMFactory("h3"),h4:createDOMFactory("h4"),h5:createDOMFactory("h5"),h6:createDOMFactory("h6"),head:createDOMFactory("head"),header:createDOMFactory("header"),hgroup:createDOMFactory("hgroup"),hr:createDOMFactory("hr"),html:createDOMFactory("html"),i:createDOMFactory("i"),iframe:createDOMFactory("iframe"),img:createDOMFactory("img"),input:createDOMFactory("input"),ins:createDOMFactory("ins"),kbd:createDOMFactory("kbd"),keygen:createDOMFactory("keygen"),label:createDOMFactory("label"),legend:createDOMFactory("legend"),li:createDOMFactory("li"),link:createDOMFactory("link"),main:createDOMFactory("main"),map:createDOMFactory("map"),mark:createDOMFactory("mark"),menu:createDOMFactory("menu"),menuitem:createDOMFactory("menuitem"),meta:createDOMFactory("meta"),meter:createDOMFactory("meter"),nav:createDOMFactory("nav"),noscript:createDOMFactory("noscript"),object:createDOMFactory("object"),ol:createDOMFactory("ol"),optgroup:createDOMFactory("optgroup"),option:createDOMFactory("option"),output:createDOMFactory("output"),p:createDOMFactory("p"),param:createDOMFactory("param"),picture:createDOMFactory("picture"),pre:createDOMFactory("pre"),progress:createDOMFactory("progress"),q:createDOMFactory("q"),rp:createDOMFactory("rp"),rt:createDOMFactory("rt"),ruby:createDOMFactory("ruby"),s:createDOMFactory("s"),samp:createDOMFactory("samp"),script:createDOMFactory("script"),section:createDOMFactory("section"),select:createDOMFactory("select"),small:createDOMFactory("small"),source:createDOMFactory("source"),span:createDOMFactory("span"),strong:createDOMFactory("strong"),style:createDOMFactory("style"),sub:createDOMFactory("sub"),summary:createDOMFactory("summary"),sup:createDOMFactory("sup"),table:createDOMFactory("table"),tbody:createDOMFactory("tbody"),td:createDOMFactory("td"),textarea:createDOMFactory("textarea"),tfoot:createDOMFactory("tfoot"),th:createDOMFactory("th"),thead:createDOMFactory("thead"),time:createDOMFactory("time"),title:createDOMFactory("title"),tr:createDOMFactory("tr"),track:createDOMFactory("track"),u:createDOMFactory("u"),ul:createDOMFactory("ul"),var:createDOMFactory("var"),video:createDOMFactory("video"),wbr:createDOMFactory("wbr"),circle:createDOMFactory("circle"),clipPath:createDOMFactory("clipPath"),defs:createDOMFactory("defs"),ellipse:createDOMFactory("ellipse"),g:createDOMFactory("g"),image:createDOMFactory("image"),line:createDOMFactory("line"),linearGradient:createDOMFactory("linearGradient"),mask:createDOMFactory("mask"),path:createDOMFactory("path"),pattern:createDOMFactory("pattern"),polygon:createDOMFactory("polygon"),polyline:createDOMFactory("polyline"),radialGradient:createDOMFactory("radialGradient"),rect:createDOMFactory("rect"),stop:createDOMFactory("stop"),svg:createDOMFactory("svg"),text:createDOMFactory("text"),tspan:createDOMFactory("tspan")};module.exports=ReactDOMFactories},{"./ReactElement":933,"./ReactElementValidator":935}],933:[function(require,module,exports){"use strict";var _assign=require("object-assign");var ReactCurrentOwner=require("./ReactCurrentOwner");var warning=require("fbjs/lib/warning");var canDefineProperty=require("./canDefineProperty");var hasOwnProperty=Object.prototype.hasOwnProperty;var REACT_ELEMENT_TYPE=require("./ReactElementSymbol");var RESERVED_PROPS={key:true,ref:true,__self:true,__source:true};var specialPropKeyWarningShown,specialPropRefWarningShown;function hasValidRef(config){if("production"!=="production"){if(hasOwnProperty.call(config,"ref")){var getter=Object.getOwnPropertyDescriptor(config,"ref").get;if(getter&&getter.isReactWarning){return false}}}return config.ref!==undefined}function hasValidKey(config){if("production"!=="production"){if(hasOwnProperty.call(config,"key")){var getter=Object.getOwnPropertyDescriptor(config,"key").get;if(getter&&getter.isReactWarning){return false}}}return config.key!==undefined}function defineKeyPropWarningGetter(props,displayName){var warnAboutAccessingKey=function(){if(!specialPropKeyWarningShown){specialPropKeyWarningShown=true;"production"!=="production"?warning(false,"%s: `key` is not a prop. Trying to access it will result "+"in `undefined` being returned. If you need to access the same "+"value within the child component, you should pass it as a different "+"prop. (https://fb.me/react-special-props)",displayName):void 0}};warnAboutAccessingKey.isReactWarning=true;Object.defineProperty(props,"key",{get:warnAboutAccessingKey,configurable:true})}function defineRefPropWarningGetter(props,displayName){var warnAboutAccessingRef=function(){if(!specialPropRefWarningShown){specialPropRefWarningShown=true;"production"!=="production"?warning(false,"%s: `ref` is not a prop. Trying to access it will result "+"in `undefined` being returned. If you need to access the same "+"value within the child component, you should pass it as a different "+"prop. (https://fb.me/react-special-props)",displayName):void 0}};warnAboutAccessingRef.isReactWarning=true;Object.defineProperty(props,"ref",{get:warnAboutAccessingRef,configurable:true})}var ReactElement=function(type,key,ref,self,source,owner,props){var element={$$typeof:REACT_ELEMENT_TYPE,type:type,key:key,ref:ref,props:props,_owner:owner};if("production"!=="production"){element._store={};if(canDefineProperty){Object.defineProperty(element._store,"validated",{configurable:false,enumerable:false,writable:true,value:false});Object.defineProperty(element,"_self",{configurable:false,enumerable:false,writable:false,value:self});Object.defineProperty(element,"_source",{configurable:false,enumerable:false,writable:false,value:source})}else{element._store.validated=false;element._self=self;element._source=source}if(Object.freeze){Object.freeze(element.props);Object.freeze(element)}}return element};ReactElement.createElement=function(type,config,children){var propName;var props={};var key=null;var ref=null;var self=null;var source=null;if(config!=null){if(hasValidRef(config)){ref=config.ref}if(hasValidKey(config)){key=""+config.key}self=config.__self===undefined?null:config.__self;source=config.__source===undefined?null:config.__source;for(propName in config){if(hasOwnProperty.call(config,propName)&&!RESERVED_PROPS.hasOwnProperty(propName)){props[propName]=config[propName]}}}var childrenLength=arguments.length-2;if(childrenLength===1){props.children=children}else if(childrenLength>1){var childArray=Array(childrenLength);for(var i=0;i<childrenLength;i++){childArray[i]=arguments[i+2]}if("production"!=="production"){if(Object.freeze){Object.freeze(childArray)}}props.children=childArray}if(type&&type.defaultProps){var defaultProps=type.defaultProps;for(propName in defaultProps){if(props[propName]===undefined){props[propName]=defaultProps[propName]}}}if("production"!=="production"){if(key||ref){if(typeof props.$$typeof==="undefined"||props.$$typeof!==REACT_ELEMENT_TYPE){var displayName=typeof type==="function"?type.displayName||type.name||"Unknown":type;if(key){defineKeyPropWarningGetter(props,displayName)}if(ref){defineRefPropWarningGetter(props,displayName)}}}}return ReactElement(type,key,ref,self,source,ReactCurrentOwner.current,props)};ReactElement.createFactory=function(type){var factory=ReactElement.createElement.bind(null,type);factory.type=type;return factory};ReactElement.cloneAndReplaceKey=function(oldElement,newKey){var newElement=ReactElement(oldElement.type,newKey,oldElement.ref,oldElement._self,oldElement._source,oldElement._owner,oldElement.props);return newElement};ReactElement.cloneElement=function(element,config,children){var propName;var props=_assign({},element.props);var key=element.key;var ref=element.ref;var self=element._self;var source=element._source;var owner=element._owner;if(config!=null){if(hasValidRef(config)){ref=config.ref;owner=ReactCurrentOwner.current}if(hasValidKey(config)){key=""+config.key}var defaultProps;if(element.type&&element.type.defaultProps){defaultProps=element.type.defaultProps}for(propName in config){if(hasOwnProperty.call(config,propName)&&!RESERVED_PROPS.hasOwnProperty(propName)){if(config[propName]===undefined&&defaultProps!==undefined){props[propName]=defaultProps[propName]}else{props[propName]=config[propName]}}}}var childrenLength=arguments.length-2;if(childrenLength===1){props.children=children}else if(childrenLength>1){var childArray=Array(childrenLength);for(var i=0;i<childrenLength;i++){childArray[i]=arguments[i+2]}props.children=childArray}return ReactElement(element.type,key,ref,self,source,owner,props)};ReactElement.isValidElement=function(object){return typeof object==="object"&&object!==null&&object.$$typeof===REACT_ELEMENT_TYPE};module.exports=ReactElement},{"./ReactCurrentOwner":931,"./ReactElementSymbol":934,"./canDefineProperty":942,"fbjs/lib/warning":413,"object-assign":732}],934:[function(require,module,exports){arguments[4][824][0].apply(exports,arguments)},{dup:824}],935:[function(require,module,exports){"use strict";var ReactCurrentOwner=require("./ReactCurrentOwner");var ReactComponentTreeHook=require("./ReactComponentTreeHook");var ReactElement=require("./ReactElement");var checkReactTypeSpec=require("./checkReactTypeSpec");var canDefineProperty=require("./canDefineProperty");var getIteratorFn=require("./getIteratorFn");var warning=require("fbjs/lib/warning");function getDeclarationErrorAddendum(){if(ReactCurrentOwner.current){var name=ReactCurrentOwner.current.getName();if(name){return" Check the render method of `"+name+"`."}}return""}var ownerHasKeyUseWarning={};function getCurrentComponentErrorInfo(parentType){var info=getDeclarationErrorAddendum();if(!info){var parentName=typeof parentType==="string"?parentType:parentType.displayName||parentType.name;if(parentName){info=" Check the top-level render call using <"+parentName+">."}}return info}function validateExplicitKey(element,parentType){if(!element._store||element._store.validated||element.key!=null){return}element._store.validated=true;var memoizer=ownerHasKeyUseWarning.uniqueKey||(ownerHasKeyUseWarning.uniqueKey={});var currentComponentErrorInfo=getCurrentComponentErrorInfo(parentType);if(memoizer[currentComponentErrorInfo]){return}memoizer[currentComponentErrorInfo]=true;var childOwner="";if(element&&element._owner&&element._owner!==ReactCurrentOwner.current){childOwner=" It was passed a child from "+element._owner.getName()+"."}"production"!=="production"?warning(false,'Each child in an array or iterator should have a unique "key" prop.'+"%s%s See https://fb.me/react-warning-keys for more information.%s",currentComponentErrorInfo,childOwner,ReactComponentTreeHook.getCurrentStackAddendum(element)):void 0}function validateChildKeys(node,parentType){if(typeof node!=="object"){return}if(Array.isArray(node)){for(var i=0;i<node.length;i++){var child=node[i];if(ReactElement.isValidElement(child)){validateExplicitKey(child,parentType)}}}else if(ReactElement.isValidElement(node)){if(node._store){node._store.validated=true}}else if(node){var iteratorFn=getIteratorFn(node);if(iteratorFn){if(iteratorFn!==node.entries){var iterator=iteratorFn.call(node);var step;while(!(step=iterator.next()).done){if(ReactElement.isValidElement(step.value)){validateExplicitKey(step.value,parentType)}}}}}}function validatePropTypes(element){var componentClass=element.type;if(typeof componentClass!=="function"){return}var name=componentClass.displayName||componentClass.name;if(componentClass.propTypes){checkReactTypeSpec(componentClass.propTypes,element.props,"prop",name,element,null)}if(typeof componentClass.getDefaultProps==="function"){"production"!=="production"?warning(componentClass.getDefaultProps.isReactClassApproved,"getDefaultProps is only used on classic React.createClass "+"definitions. Use a static property named `defaultProps` instead."):void 0}}var ReactElementValidator={createElement:function(type,props,children){var validType=typeof type==="string"||typeof type==="function";if(!validType){if(typeof type!=="function"&&typeof type!=="string"){var info="";if(type===undefined||typeof type==="object"&&type!==null&&Object.keys(type).length===0){info+=" You likely forgot to export your component from the file "+"it's defined in."}info+=getDeclarationErrorAddendum();"production"!=="production"?warning(false,"React.createElement: type is invalid -- expected a string (for "+"built-in components) or a class/function (for composite "+"components) but got: %s.%s",type==null?type:typeof type,info):void 0}}var element=ReactElement.createElement.apply(this,arguments);if(element==null){return element}if(validType){for(var i=2;i<arguments.length;i++){validateChildKeys(arguments[i],type)}}validatePropTypes(element);return element},createFactory:function(type){var validatedFactory=ReactElementValidator.createElement.bind(null,type);validatedFactory.type=type;if("production"!=="production"){if(canDefineProperty){Object.defineProperty(validatedFactory,"type",{enumerable:false,get:function(){"production"!=="production"?warning(false,"Factory.type is deprecated. Access the class directly "+"before passing it to createFactory."):void 0;Object.defineProperty(this,"type",{value:type});return type}})}}return validatedFactory},cloneElement:function(element,props,children){var newElement=ReactElement.cloneElement.apply(this,arguments);for(var i=2;i<arguments.length;i++){validateChildKeys(arguments[i],newElement.type)}validatePropTypes(newElement);return newElement}};module.exports=ReactElementValidator},{"./ReactComponentTreeHook":930,"./ReactCurrentOwner":931,"./ReactElement":933,"./canDefineProperty":942,"./checkReactTypeSpec":943,"./getIteratorFn":944,"fbjs/lib/warning":413}],936:[function(require,module,exports){"use strict";var warning=require("fbjs/lib/warning");function warnNoop(publicInstance,callerName){if("production"!=="production"){var constructor=publicInstance.constructor;"production"!=="production"?warning(false,"%s(...): Can only update a mounted or mounting component. "+"This usually means you called %s() on an unmounted component. "+"This is a no-op. Please check the code for the %s component.",callerName,callerName,constructor&&(constructor.displayName||constructor.name)||"ReactClass"):void 0}}var ReactNoopUpdateQueue={isMounted:function(publicInstance){return false},enqueueCallback:function(publicInstance,callback){},enqueueForceUpdate:function(publicInstance){warnNoop(publicInstance,"forceUpdate")},enqueueReplaceState:function(publicInstance,completeState){warnNoop(publicInstance,"replaceState")},enqueueSetState:function(publicInstance,partialState){warnNoop(publicInstance,"setState")}};module.exports=ReactNoopUpdateQueue},{"fbjs/lib/warning":413}],937:[function(require,module,exports){arguments[4][842][0].apply(exports,arguments)},{dup:842}],938:[function(require,module,exports){"use strict";var ReactElement=require("./ReactElement");var ReactPropTypeLocationNames=require("./ReactPropTypeLocationNames");var ReactPropTypesSecret=require("./ReactPropTypesSecret");var emptyFunction=require("fbjs/lib/emptyFunction");var getIteratorFn=require("./getIteratorFn");var warning=require("fbjs/lib/warning");var ANONYMOUS="<<anonymous>>";var ReactPropTypes={array:createPrimitiveTypeChecker("array"),bool:createPrimitiveTypeChecker("boolean"),func:createPrimitiveTypeChecker("function"),number:createPrimitiveTypeChecker("number"),object:createPrimitiveTypeChecker("object"),string:createPrimitiveTypeChecker("string"),symbol:createPrimitiveTypeChecker("symbol"),any:createAnyTypeChecker(),arrayOf:createArrayOfTypeChecker,element:createElementTypeChecker(),instanceOf:createInstanceTypeChecker,node:createNodeChecker(),objectOf:createObjectOfTypeChecker,oneOf:createEnumTypeChecker,oneOfType:createUnionTypeChecker,shape:createShapeTypeChecker};function is(x,y){if(x===y){return x!==0||1/x===1/y}else{return x!==x&&y!==y}}function PropTypeError(message){this.message=message;this.stack=""}PropTypeError.prototype=Error.prototype;function createChainableTypeChecker(validate){if("production"!=="production"){var manualPropTypeCallCache={}}function checkType(isRequired,props,propName,componentName,location,propFullName,secret){componentName=componentName||ANONYMOUS;propFullName=propFullName||propName;if("production"!=="production"){if(secret!==ReactPropTypesSecret&&typeof console!=="undefined"){var cacheKey=componentName+":"+propName;if(!manualPropTypeCallCache[cacheKey]){"production"!=="production"?warning(false,"You are manually calling a React.PropTypes validation "+"function for the `%s` prop on `%s`. This is deprecated "+"and will not work in production with the next major version. "+"You may be seeing this warning due to a third-party PropTypes "+"library. See https://fb.me/react-warning-dont-call-proptypes "+"for details.",propFullName,componentName):void 0;manualPropTypeCallCache[cacheKey]=true}}}if(props[propName]==null){var locationName=ReactPropTypeLocationNames[location];if(isRequired){if(props[propName]===null){return new PropTypeError("The "+locationName+" `"+propFullName+"` is marked as required "+("in `"+componentName+"`, but its value is `null`."))}return new PropTypeError("The "+locationName+" `"+propFullName+"` is marked as required in "+("`"+componentName+"`, but its value is `undefined`."))}return null}else{return validate(props,propName,componentName,location,propFullName)}}var chainedCheckType=checkType.bind(null,false);chainedCheckType.isRequired=checkType.bind(null,true);return chainedCheckType}function createPrimitiveTypeChecker(expectedType){function validate(props,propName,componentName,location,propFullName,secret){var propValue=props[propName];var propType=getPropType(propValue);if(propType!==expectedType){var locationName=ReactPropTypeLocationNames[location];var preciseType=getPreciseType(propValue);return new PropTypeError("Invalid "+locationName+" `"+propFullName+"` of type "+("`"+preciseType+"` supplied to `"+componentName+"`, expected ")+("`"+expectedType+"`."))}return null}return createChainableTypeChecker(validate)}function createAnyTypeChecker(){return createChainableTypeChecker(emptyFunction.thatReturns(null))}function createArrayOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if(typeof typeChecker!=="function"){return new PropTypeError("Property `"+propFullName+"` of component `"+componentName+"` has invalid PropType notation inside arrayOf.")}var propValue=props[propName];if(!Array.isArray(propValue)){var locationName=ReactPropTypeLocationNames[location];var propType=getPropType(propValue);return new PropTypeError("Invalid "+locationName+" `"+propFullName+"` of type "+("`"+propType+"` supplied to `"+componentName+"`, expected an array."))}for(var i=0;i<propValue.length;i++){var error=typeChecker(propValue,i,componentName,location,propFullName+"["+i+"]",ReactPropTypesSecret);if(error instanceof Error){return error}}return null}return createChainableTypeChecker(validate)}function createElementTypeChecker(){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];if(!ReactElement.isValidElement(propValue)){var locationName=ReactPropTypeLocationNames[location];var propType=getPropType(propValue);return new PropTypeError("Invalid "+locationName+" `"+propFullName+"` of type "+("`"+propType+"` supplied to `"+componentName+"`, expected a single ReactElement."))}return null}return createChainableTypeChecker(validate)}function createInstanceTypeChecker(expectedClass){function validate(props,propName,componentName,location,propFullName){if(!(props[propName]instanceof expectedClass)){var locationName=ReactPropTypeLocationNames[location];var expectedClassName=expectedClass.name||ANONYMOUS;var actualClassName=getClassName(props[propName]);return new PropTypeError("Invalid "+locationName+" `"+propFullName+"` of type "+("`"+actualClassName+"` supplied to `"+componentName+"`, expected ")+("instance of `"+expectedClassName+"`."))}return null}return createChainableTypeChecker(validate)}function createEnumTypeChecker(expectedValues){if(!Array.isArray(expectedValues)){"production"!=="production"?warning(false,"Invalid argument supplied to oneOf, expected an instance of array."):void 0;return emptyFunction.thatReturnsNull}function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];for(var i=0;i<expectedValues.length;i++){if(is(propValue,expectedValues[i])){return null}}var locationName=ReactPropTypeLocationNames[location];var valuesString=JSON.stringify(expectedValues);return new PropTypeError("Invalid "+locationName+" `"+propFullName+"` of value `"+propValue+"` "+("supplied to `"+componentName+"`, expected one of "+valuesString+"."))}return createChainableTypeChecker(validate)}function createObjectOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if(typeof typeChecker!=="function"){return new PropTypeError("Property `"+propFullName+"` of component `"+componentName+"` has invalid PropType notation inside objectOf.")}var propValue=props[propName];var propType=getPropType(propValue);if(propType!=="object"){var locationName=ReactPropTypeLocationNames[location];return new PropTypeError("Invalid "+locationName+" `"+propFullName+"` of type "+("`"+propType+"` supplied to `"+componentName+"`, expected an object."))}for(var key in propValue){if(propValue.hasOwnProperty(key)){var error=typeChecker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret);if(error instanceof Error){return error}}}return null}return createChainableTypeChecker(validate)}function createUnionTypeChecker(arrayOfTypeCheckers){if(!Array.isArray(arrayOfTypeCheckers)){"production"!=="production"?warning(false,"Invalid argument supplied to oneOfType, expected an instance of array."):void 0;return emptyFunction.thatReturnsNull}function validate(props,propName,componentName,location,propFullName){for(var i=0;i<arrayOfTypeCheckers.length;i++){var checker=arrayOfTypeCheckers[i];if(checker(props,propName,componentName,location,propFullName,ReactPropTypesSecret)==null){return null}}var locationName=ReactPropTypeLocationNames[location];return new PropTypeError("Invalid "+locationName+" `"+propFullName+"` supplied to "+("`"+componentName+"`."))}return createChainableTypeChecker(validate)}function createNodeChecker(){function validate(props,propName,componentName,location,propFullName){if(!isNode(props[propName])){var locationName=ReactPropTypeLocationNames[location];return new PropTypeError("Invalid "+locationName+" `"+propFullName+"` supplied to "+("`"+componentName+"`, expected a ReactNode."))}return null}return createChainableTypeChecker(validate)}function createShapeTypeChecker(shapeTypes){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];var propType=getPropType(propValue);if(propType!=="object"){var locationName=ReactPropTypeLocationNames[location];return new PropTypeError("Invalid "+locationName+" `"+propFullName+"` of type `"+propType+"` "+("supplied to `"+componentName+"`, expected `object`."));
}for(var key in shapeTypes){var checker=shapeTypes[key];if(!checker){continue}var error=checker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret);if(error){return error}}return null}return createChainableTypeChecker(validate)}function isNode(propValue){switch(typeof propValue){case"number":case"string":case"undefined":return true;case"boolean":return!propValue;case"object":if(Array.isArray(propValue)){return propValue.every(isNode)}if(propValue===null||ReactElement.isValidElement(propValue)){return true}var iteratorFn=getIteratorFn(propValue);if(iteratorFn){var iterator=iteratorFn.call(propValue);var step;if(iteratorFn!==propValue.entries){while(!(step=iterator.next()).done){if(!isNode(step.value)){return false}}}else{while(!(step=iterator.next()).done){var entry=step.value;if(entry){if(!isNode(entry[1])){return false}}}}}else{return false}return true;default:return false}}function isSymbol(propType,propValue){if(propType==="symbol"){return true}if(propValue["@@toStringTag"]==="Symbol"){return true}if(typeof Symbol==="function"&&propValue instanceof Symbol){return true}return false}function getPropType(propValue){var propType=typeof propValue;if(Array.isArray(propValue)){return"array"}if(propValue instanceof RegExp){return"object"}if(isSymbol(propType,propValue)){return"symbol"}return propType}function getPreciseType(propValue){var propType=getPropType(propValue);if(propType==="object"){if(propValue instanceof Date){return"date"}else if(propValue instanceof RegExp){return"regexp"}}return propType}function getClassName(propValue){if(!propValue.constructor||!propValue.constructor.name){return ANONYMOUS}return propValue.constructor.name}module.exports=ReactPropTypes},{"./ReactElement":933,"./ReactPropTypeLocationNames":937,"./ReactPropTypesSecret":939,"./getIteratorFn":944,"fbjs/lib/emptyFunction":398,"fbjs/lib/warning":413}],939:[function(require,module,exports){arguments[4][843][0].apply(exports,arguments)},{dup:843}],940:[function(require,module,exports){"use strict";var _assign=require("object-assign");var ReactComponent=require("./ReactComponent");var ReactNoopUpdateQueue=require("./ReactNoopUpdateQueue");var emptyObject=require("fbjs/lib/emptyObject");function ReactPureComponent(props,context,updater){this.props=props;this.context=context;this.refs=emptyObject;this.updater=updater||ReactNoopUpdateQueue}function ComponentDummy(){}ComponentDummy.prototype=ReactComponent.prototype;ReactPureComponent.prototype=new ComponentDummy;ReactPureComponent.prototype.constructor=ReactPureComponent;_assign(ReactPureComponent.prototype,ReactComponent.prototype);ReactPureComponent.prototype.isPureReactComponent=true;module.exports=ReactPureComponent},{"./ReactComponent":929,"./ReactNoopUpdateQueue":936,"fbjs/lib/emptyObject":399,"object-assign":732}],941:[function(require,module,exports){arguments[4][851][0].apply(exports,arguments)},{dup:851}],942:[function(require,module,exports){"use strict";var canDefineProperty=false;if("production"!=="production"){try{Object.defineProperty({},"x",{get:function(){}});canDefineProperty=true}catch(x){}}module.exports=canDefineProperty},{}],943:[function(require,module,exports){(function(process){"use strict";var _prodInvariant=require("./reactProdInvariant");var ReactPropTypeLocationNames=require("./ReactPropTypeLocationNames");var ReactPropTypesSecret=require("./ReactPropTypesSecret");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");var ReactComponentTreeHook;if(typeof process!=="undefined"&&process.env&&"production"==="test"){ReactComponentTreeHook=require("./ReactComponentTreeHook")}var loggedTypeFailures={};function checkReactTypeSpec(typeSpecs,values,location,componentName,element,debugID){for(var typeSpecName in typeSpecs){if(typeSpecs.hasOwnProperty(typeSpecName)){var error;try{!(typeof typeSpecs[typeSpecName]==="function")?"production"!=="production"?invariant(false,"%s: %s type `%s` is invalid; it must be a function, usually from React.PropTypes.",componentName||"React class",ReactPropTypeLocationNames[location],typeSpecName):_prodInvariant("84",componentName||"React class",ReactPropTypeLocationNames[location],typeSpecName):void 0;error=typeSpecs[typeSpecName](values,typeSpecName,componentName,location,null,ReactPropTypesSecret)}catch(ex){error=ex}"production"!=="production"?warning(!error||error instanceof Error,"%s: type specification of %s `%s` is invalid; the type checker "+"function must return `null` or an `Error` but returned a %s. "+"You may have forgotten to pass an argument to the type checker "+"creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and "+"shape all require an argument).",componentName||"React class",ReactPropTypeLocationNames[location],typeSpecName,typeof error):void 0;if(error instanceof Error&&!(error.message in loggedTypeFailures)){loggedTypeFailures[error.message]=true;var componentStackInfo="";if("production"!=="production"){if(!ReactComponentTreeHook){ReactComponentTreeHook=require("./ReactComponentTreeHook")}if(debugID!==null){componentStackInfo=ReactComponentTreeHook.getStackAddendumByID(debugID)}else if(element!==null){componentStackInfo=ReactComponentTreeHook.getCurrentStackAddendum(element)}}"production"!=="production"?warning(false,"Failed %s type: %s%s",location,error.message,componentStackInfo):void 0}}}}module.exports=checkReactTypeSpec}).call(this,require("_process"))},{"./ReactComponentTreeHook":930,"./ReactPropTypeLocationNames":937,"./ReactPropTypesSecret":939,"./reactProdInvariant":946,_process:11,"fbjs/lib/invariant":406,"fbjs/lib/warning":413}],944:[function(require,module,exports){arguments[4][884][0].apply(exports,arguments)},{dup:884}],945:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var ReactElement=require("./ReactElement");var invariant=require("fbjs/lib/invariant");function onlyChild(children){!ReactElement.isValidElement(children)?"production"!=="production"?invariant(false,"React.Children.only expected to receive a single React element child."):_prodInvariant("143"):void 0;return children}module.exports=onlyChild},{"./ReactElement":933,"./reactProdInvariant":946,"fbjs/lib/invariant":406}],946:[function(require,module,exports){arguments[4][893][0].apply(exports,arguments)},{dup:893}],947:[function(require,module,exports){"use strict";var _prodInvariant=require("./reactProdInvariant");var ReactCurrentOwner=require("./ReactCurrentOwner");var REACT_ELEMENT_TYPE=require("./ReactElementSymbol");var getIteratorFn=require("./getIteratorFn");var invariant=require("fbjs/lib/invariant");var KeyEscapeUtils=require("./KeyEscapeUtils");var warning=require("fbjs/lib/warning");var SEPARATOR=".";var SUBSEPARATOR=":";var didWarnAboutMaps=false;function getComponentKey(component,index){if(component&&typeof component==="object"&&component.key!=null){return KeyEscapeUtils.escape(component.key)}return index.toString(36)}function traverseAllChildrenImpl(children,nameSoFar,callback,traverseContext){var type=typeof children;if(type==="undefined"||type==="boolean"){children=null}if(children===null||type==="string"||type==="number"||type==="object"&&children.$$typeof===REACT_ELEMENT_TYPE){callback(traverseContext,children,nameSoFar===""?SEPARATOR+getComponentKey(children,0):nameSoFar);return 1}var child;var nextName;var subtreeCount=0;var nextNamePrefix=nameSoFar===""?SEPARATOR:nameSoFar+SUBSEPARATOR;if(Array.isArray(children)){for(var i=0;i<children.length;i++){child=children[i];nextName=nextNamePrefix+getComponentKey(child,i);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext)}}else{var iteratorFn=getIteratorFn(children);if(iteratorFn){var iterator=iteratorFn.call(children);var step;if(iteratorFn!==children.entries){var ii=0;while(!(step=iterator.next()).done){child=step.value;nextName=nextNamePrefix+getComponentKey(child,ii++);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext)}}else{if("production"!=="production"){var mapsAsChildrenAddendum="";if(ReactCurrentOwner.current){var mapsAsChildrenOwnerName=ReactCurrentOwner.current.getName();if(mapsAsChildrenOwnerName){mapsAsChildrenAddendum=" Check the render method of `"+mapsAsChildrenOwnerName+"`."}}"production"!=="production"?warning(didWarnAboutMaps,"Using Maps as children is not yet fully supported. It is an "+"experimental feature that might be removed. Convert it to a "+"sequence / iterable of keyed ReactElements instead.%s",mapsAsChildrenAddendum):void 0;didWarnAboutMaps=true}while(!(step=iterator.next()).done){var entry=step.value;if(entry){child=entry[1];nextName=nextNamePrefix+KeyEscapeUtils.escape(entry[0])+SUBSEPARATOR+getComponentKey(child,0);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext)}}}}else if(type==="object"){var addendum="";if("production"!=="production"){addendum=" If you meant to render a collection of children, use an array "+"instead or wrap the object using createFragment(object) from the "+"React add-ons.";if(children._isReactElement){addendum=" It looks like you're using an element created by a different "+"version of React. Make sure to use only one copy of React."}if(ReactCurrentOwner.current){var name=ReactCurrentOwner.current.getName();if(name){addendum+=" Check the render method of `"+name+"`."}}}var childrenString=String(children);!false?"production"!=="production"?invariant(false,"Objects are not valid as a React child (found: %s).%s",childrenString==="[object Object]"?"object with keys {"+Object.keys(children).join(", ")+"}":childrenString,addendum):_prodInvariant("31",childrenString==="[object Object]"?"object with keys {"+Object.keys(children).join(", ")+"}":childrenString,addendum):void 0}}return subtreeCount}function traverseAllChildren(children,callback,traverseContext){if(children==null){return 0}return traverseAllChildrenImpl(children,"",callback,traverseContext)}module.exports=traverseAllChildren},{"./KeyEscapeUtils":924,"./ReactCurrentOwner":931,"./ReactElementSymbol":934,"./getIteratorFn":944,"./reactProdInvariant":946,"fbjs/lib/invariant":406,"fbjs/lib/warning":413}],948:[function(require,module,exports){"use strict";module.exports=require("./lib/React")},{"./lib/React":926}],949:[function(require,module,exports){arguments[4][431][0].apply(exports,arguments)},{"./_stream_readable":951,"./_stream_writable":953,_process:11,"core-util-is":318,dup:431,inherits:454}],950:[function(require,module,exports){arguments[4][432][0].apply(exports,arguments)},{"./_stream_transform":952,"core-util-is":318,dup:432,inherits:454}],951:[function(require,module,exports){(function(process){module.exports=Readable;var isArray=require("isarray");var Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;if(!EE.listenerCount)EE.listenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require("stream");var util=require("core-util-is");util.inherits=require("inherits");var StringDecoder;util.inherits(Readable,Stream);function ReadableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||hwm===0?hwm:16*1024;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=false;this.ended=false;this.endEmitted=false;this.reading=false;this.calledRead=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.objectMode=!!options.objectMode;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(typeof chunk==="string"&&!state.objectMode){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null||chunk===undefined){state.reading=false;if(!state.ended)onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else{if(state.decoder&&!addToFront&&!encoding)chunk=state.decoder.write(chunk);state.length+=state.objectMode?1:chunk.length;if(addToFront){state.buffer.unshift(chunk)}else{state.reading=false;state.buffer.push(chunk)}if(state.needReadable)emitReadable(stream);maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc};var MAX_HWM=8388608;function roundUpToNextPowerOf2(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;for(var p=1;p<32;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(n===null||isNaN(n)){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=roundUpToNextPowerOf2(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else return state.length}return n}Readable.prototype.read=function(n){var state=this._readableState;state.calledRead=true;var nOrig=n;var ret;if(typeof n!=="number"||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){ret=null;if(state.length>0&&state.decoder){ret=fromList(n,state);state.length-=ret.length}if(state.length===0)endReadable(this);return ret}var doRead=state.needReadable;if(state.length-n<=state.highWaterMark)doRead=true;if(state.ended||state.reading)doRead=false;if(doRead){state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(state.ended&&!state.endEmitted&&state.length===0)endReadable(this);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&"string"!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;if(state.length>0)emitReadable(stream);else endReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(state.emittedReadable)return;state.emittedReadable=true;if(state.sync)process.nextTick(function(){emitReadable_(stream)});else emitReadable_(stream)}function emitReadable_(stream){stream.emit("readable")}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;process.nextTick(function(){maybeReadMore_(stream,state)})}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)process.nextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){if(readable!==src)return;cleanup()}function onend(){dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);function cleanup(){dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);if(!dest._writableState||dest._writableState.needDrain)ondrain()}function onerror(er){unpipe();dest.removeListener("error",onerror);if(EE.listenerCount(dest,"error")===0)dest.emit("error",er)}if(!dest._events||!dest._events.error)dest.on("error",onerror);else if(isArray(dest._events.error))dest._events.error.unshift(onerror);else dest._events.error=[onerror,dest._events.error];function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){this.on("readable",pipeOnReadable);state.flowing=true;process.nextTick(function(){flow(src)})}return dest};function pipeOnDrain(src){return function(){var dest=this;var state=src._readableState;state.awaitDrain--;if(state.awaitDrain===0)flow(src)}}function flow(src){var state=src._readableState;var chunk;state.awaitDrain=0;function write(dest,i,list){var written=dest.write(chunk);if(false===written){state.awaitDrain++}}while(state.pipesCount&&null!==(chunk=src.read())){if(state.pipesCount===1)write(state.pipes,0,null);else forEach(state.pipes,write);src.emit("data",chunk);if(state.awaitDrain>0)return}if(state.pipesCount===0){state.flowing=false;if(EE.listenerCount(src,"data")>0)emitDataEvents(src);return}state.ranOut=true}function pipeOnReadable(){if(this._readableState.ranOut){this._readableState.ranOut=false;flow(this)}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;this.removeListener("readable",pipeOnReadable);state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;this.removeListener("readable",pipeOnReadable);state.flowing=false;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&!this._readableState.flowing)emitDataEvents(this);if(ev==="readable"&&this.readable){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;if(!state.reading){this.read(0)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;Readable.prototype.resume=function(){emitDataEvents(this);this.read(0);this.emit("resume")};Readable.prototype.pause=function(){emitDataEvents(this,true);this.emit("pause")};function emitDataEvents(stream,startPaused){var state=stream._readableState;if(state.flowing){throw new Error("Cannot switch to old mode now.")}var paused=startPaused||false;var readable=false;stream.readable=true;stream.pipe=Stream.prototype.pipe;stream.on=stream.addListener=Stream.prototype.on;stream.on("readable",function(){readable=true;var c;while(!paused&&null!==(c=stream.read()))stream.emit("data",c);if(c===null){readable=false;stream._readableState.needReadable=true}});stream.pause=function(){paused=true;this.emit("pause")};stream.resume=function(){paused=false;if(readable)process.nextTick(function(){stream.emit("readable")});else this.read(0);this.emit("resume")};stream.emit("readable")}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(typeof stream[i]==="function"&&typeof this[i]==="undefined"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");if(!state.endEmitted&&state.calledRead){state.ended=true;process.nextTick(function(){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}})}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{_process:11,buffer:19,"core-util-is":318,events:389,inherits:454,isarray:458,stream:969,"string_decoder/":982}],952:[function(require,module,exports){module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);if(cb)cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);var ts=this._transformState=new TransformState(options,this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;this.once("finish",function(){if("function"===typeof this._flush)this._flush(function(er){done(stream,er)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState;var rs=stream._readableState;var ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":949,"core-util-is":318,inherits:454}],953:[function(require,module,exports){(function(process){module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream);function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb}function WritableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||hwm===0?hwm:16*1024;this.objectMode=!!options.objectMode;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.buffer=[];this.errorEmitted=false}function Writable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))};function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er);process.nextTick(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=true;if(!Buffer.isBuffer(chunk)&&"string"!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er);process.nextTick(function(){cb(er)});valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(Buffer.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=function(){};if(state.ended)writeAfterEnd(this,state,cb);else if(validChunk(this,state,chunk,cb))ret=writeOrBuffer(this,state,chunk,encoding,cb);return ret};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=new Buffer(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing)state.buffer.push(new WriteReq(chunk,encoding,cb));else doWrite(stream,state,len,chunk,encoding,cb);return ret}function doWrite(stream,state,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){if(sync)process.nextTick(function(){cb(er)});else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);if(!finished&&!state.bufferProcessing&&state.buffer.length)clearBuffer(stream,state);if(sync){process.nextTick(function(){afterWrite(stream,state,finished,cb)})}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);cb();if(finished)finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c];var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,len,chunk,encoding,cb);if(state.writing){c++;break}}state.bufferProcessing=false;if(c<state.buffer.length)state.buffer=state.buffer.slice(c);else state.buffer.length=0}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(typeof chunk!=="undefined"&&chunk!==null)this.write(chunk,encoding);if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(stream,state){return state.ending&&state.length===0&&!state.finished&&!state.writing}function finishMaybe(stream,state){var need=needFinish(stream,state);if(need){state.finished=true;stream.emit("finish")}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)process.nextTick(cb);else stream.once("finish",cb)}state.ended=true}}).call(this,require("_process"))},{"./_stream_duplex":949,_process:11,buffer:19,"core-util-is":318,inherits:454,stream:969}],954:[function(require,module,exports){(function(process){var Stream=require("stream");exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=Stream;exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js");if(!process.browser&&process.env.READABLE_STREAM==="disable"){module.exports=require("stream")}}).call(this,require("_process"))},{"./lib/_stream_duplex.js":949,"./lib/_stream_passthrough.js":950,"./lib/_stream_readable.js":951,"./lib/_stream_transform.js":952,"./lib/_stream_writable.js":953,_process:11,stream:969}],955:[function(require,module,exports){"use strict";exports.__esModule=true;function createThunkMiddleware(extraArgument){return function(_ref){var dispatch=_ref.dispatch,getState=_ref.getState;return function(next){return function(action){if(typeof action==="function"){return action(dispatch,getState,extraArgument)}return next(action)}}}}var thunk=createThunkMiddleware();thunk.withExtraArgument=createThunkMiddleware;
exports["default"]=thunk},{}],956:[function(require,module,exports){"use strict";exports.__esModule=true;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports["default"]=applyMiddleware;var _compose=require("./compose");var _compose2=_interopRequireDefault(_compose);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function applyMiddleware(){for(var _len=arguments.length,middlewares=Array(_len),_key=0;_key<_len;_key++){middlewares[_key]=arguments[_key]}return function(createStore){return function(reducer,preloadedState,enhancer){var store=createStore(reducer,preloadedState,enhancer);var _dispatch=store.dispatch;var chain=[];var middlewareAPI={getState:store.getState,dispatch:function dispatch(action){return _dispatch(action)}};chain=middlewares.map(function(middleware){return middleware(middlewareAPI)});_dispatch=_compose2["default"].apply(undefined,chain)(store.dispatch);return _extends({},store,{dispatch:_dispatch})}}}},{"./compose":959}],957:[function(require,module,exports){"use strict";exports.__esModule=true;exports["default"]=bindActionCreators;function bindActionCreator(actionCreator,dispatch){return function(){return dispatch(actionCreator.apply(undefined,arguments))}}function bindActionCreators(actionCreators,dispatch){if(typeof actionCreators==="function"){return bindActionCreator(actionCreators,dispatch)}if(typeof actionCreators!=="object"||actionCreators===null){throw new Error("bindActionCreators expected an object or a function, instead received "+(actionCreators===null?"null":typeof actionCreators)+". "+'Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?')}var keys=Object.keys(actionCreators);var boundActionCreators={};for(var i=0;i<keys.length;i++){var key=keys[i];var actionCreator=actionCreators[key];if(typeof actionCreator==="function"){boundActionCreators[key]=bindActionCreator(actionCreator,dispatch)}}return boundActionCreators}},{}],958:[function(require,module,exports){"use strict";exports.__esModule=true;exports["default"]=combineReducers;var _createStore=require("./createStore");var _isPlainObject=require("lodash/isPlainObject");var _isPlainObject2=_interopRequireDefault(_isPlainObject);var _warning=require("./utils/warning");var _warning2=_interopRequireDefault(_warning);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getUndefinedStateErrorMessage(key,action){var actionType=action&&action.type;var actionName=actionType&&'"'+actionType.toString()+'"'||"an action";return"Given action "+actionName+', reducer "'+key+'" returned undefined. '+"To ignore an action, you must explicitly return the previous state."}function getUnexpectedStateShapeWarningMessage(inputState,reducers,action,unexpectedKeyCache){var reducerKeys=Object.keys(reducers);var argumentName=action&&action.type===_createStore.ActionTypes.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(reducerKeys.length===0){return"Store does not have a valid reducer. Make sure the argument passed "+"to combineReducers is an object whose values are reducers."}if(!(0,_isPlainObject2["default"])(inputState)){return"The "+argumentName+' has unexpected type of "'+{}.toString.call(inputState).match(/\s([a-z|A-Z]+)/)[1]+'". Expected argument to be an object with the following '+('keys: "'+reducerKeys.join('", "')+'"')}var unexpectedKeys=Object.keys(inputState).filter(function(key){return!reducers.hasOwnProperty(key)&&!unexpectedKeyCache[key]});unexpectedKeys.forEach(function(key){unexpectedKeyCache[key]=true});if(unexpectedKeys.length>0){return"Unexpected "+(unexpectedKeys.length>1?"keys":"key")+" "+('"'+unexpectedKeys.join('", "')+'" found in '+argumentName+". ")+"Expected to find one of the known reducer keys instead: "+('"'+reducerKeys.join('", "')+'". Unexpected keys will be ignored.')}}function assertReducerSanity(reducers){Object.keys(reducers).forEach(function(key){var reducer=reducers[key];var initialState=reducer(undefined,{type:_createStore.ActionTypes.INIT});if(typeof initialState==="undefined"){throw new Error('Reducer "'+key+'" returned undefined during initialization. '+"If the state passed to the reducer is undefined, you must "+"explicitly return the initial state. The initial state may "+"not be undefined.")}var type="@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".");if(typeof reducer(undefined,{type:type})==="undefined"){throw new Error('Reducer "'+key+'" returned undefined when probed with a random type. '+("Don't try to handle "+_createStore.ActionTypes.INIT+' or other actions in "redux/*" ')+"namespace. They are considered private. Instead, you must return the "+"current state for any unknown actions, unless it is undefined, "+"in which case you must return the initial state, regardless of the "+"action type. The initial state may not be undefined.")}})}function combineReducers(reducers){var reducerKeys=Object.keys(reducers);var finalReducers={};for(var i=0;i<reducerKeys.length;i++){var key=reducerKeys[i];if("production"!=="production"){if(typeof reducers[key]==="undefined"){(0,_warning2["default"])('No reducer provided for key "'+key+'"')}}if(typeof reducers[key]==="function"){finalReducers[key]=reducers[key]}}var finalReducerKeys=Object.keys(finalReducers);if("production"!=="production"){var unexpectedKeyCache={}}var sanityError;try{assertReducerSanity(finalReducers)}catch(e){sanityError=e}return function combination(){var state=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var action=arguments[1];if(sanityError){throw sanityError}if("production"!=="production"){var warningMessage=getUnexpectedStateShapeWarningMessage(state,finalReducers,action,unexpectedKeyCache);if(warningMessage){(0,_warning2["default"])(warningMessage)}}var hasChanged=false;var nextState={};for(var i=0;i<finalReducerKeys.length;i++){var key=finalReducerKeys[i];var reducer=finalReducers[key];var previousStateForKey=state[key];var nextStateForKey=reducer(previousStateForKey,action);if(typeof nextStateForKey==="undefined"){var errorMessage=getUndefinedStateErrorMessage(key,action);throw new Error(errorMessage)}nextState[key]=nextStateForKey;hasChanged=hasChanged||nextStateForKey!==previousStateForKey}return hasChanged?nextState:state}}},{"./createStore":960,"./utils/warning":962,"lodash/isPlainObject":481}],959:[function(require,module,exports){"use strict";exports.__esModule=true;exports["default"]=compose;function compose(){for(var _len=arguments.length,funcs=Array(_len),_key=0;_key<_len;_key++){funcs[_key]=arguments[_key]}if(funcs.length===0){return function(arg){return arg}}if(funcs.length===1){return funcs[0]}var last=funcs[funcs.length-1];var rest=funcs.slice(0,-1);return function(){return rest.reduceRight(function(composed,f){return f(composed)},last.apply(undefined,arguments))}}},{}],960:[function(require,module,exports){"use strict";exports.__esModule=true;exports.ActionTypes=undefined;exports["default"]=createStore;var _isPlainObject=require("lodash/isPlainObject");var _isPlainObject2=_interopRequireDefault(_isPlainObject);var _symbolObservable=require("symbol-observable");var _symbolObservable2=_interopRequireDefault(_symbolObservable);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ActionTypes=exports.ActionTypes={INIT:"@@redux/INIT"};function createStore(reducer,preloadedState,enhancer){var _ref2;if(typeof preloadedState==="function"&&typeof enhancer==="undefined"){enhancer=preloadedState;preloadedState=undefined}if(typeof enhancer!=="undefined"){if(typeof enhancer!=="function"){throw new Error("Expected the enhancer to be a function.")}return enhancer(createStore)(reducer,preloadedState)}if(typeof reducer!=="function"){throw new Error("Expected the reducer to be a function.")}var currentReducer=reducer;var currentState=preloadedState;var currentListeners=[];var nextListeners=currentListeners;var isDispatching=false;function ensureCanMutateNextListeners(){if(nextListeners===currentListeners){nextListeners=currentListeners.slice()}}function getState(){return currentState}function subscribe(listener){if(typeof listener!=="function"){throw new Error("Expected listener to be a function.")}var isSubscribed=true;ensureCanMutateNextListeners();nextListeners.push(listener);return function unsubscribe(){if(!isSubscribed){return}isSubscribed=false;ensureCanMutateNextListeners();var index=nextListeners.indexOf(listener);nextListeners.splice(index,1)}}function dispatch(action){if(!(0,_isPlainObject2["default"])(action)){throw new Error("Actions must be plain objects. "+"Use custom middleware for async actions.")}if(typeof action.type==="undefined"){throw new Error('Actions may not have an undefined "type" property. '+"Have you misspelled a constant?")}if(isDispatching){throw new Error("Reducers may not dispatch actions.")}try{isDispatching=true;currentState=currentReducer(currentState,action)}finally{isDispatching=false}var listeners=currentListeners=nextListeners;for(var i=0;i<listeners.length;i++){listeners[i]()}return action}function replaceReducer(nextReducer){if(typeof nextReducer!=="function"){throw new Error("Expected the nextReducer to be a function.")}currentReducer=nextReducer;dispatch({type:ActionTypes.INIT})}function observable(){var _ref;var outerSubscribe=subscribe;return _ref={subscribe:function subscribe(observer){if(typeof observer!=="object"){throw new TypeError("Expected the observer to be an object.")}function observeState(){if(observer.next){observer.next(getState())}}observeState();var unsubscribe=outerSubscribe(observeState);return{unsubscribe:unsubscribe}}},_ref[_symbolObservable2["default"]]=function(){return this},_ref}dispatch({type:ActionTypes.INIT});return _ref2={dispatch:dispatch,subscribe:subscribe,getState:getState,replaceReducer:replaceReducer},_ref2[_symbolObservable2["default"]]=observable,_ref2}},{"lodash/isPlainObject":481,"symbol-observable":985}],961:[function(require,module,exports){"use strict";exports.__esModule=true;exports.compose=exports.applyMiddleware=exports.bindActionCreators=exports.combineReducers=exports.createStore=undefined;var _createStore=require("./createStore");var _createStore2=_interopRequireDefault(_createStore);var _combineReducers=require("./combineReducers");var _combineReducers2=_interopRequireDefault(_combineReducers);var _bindActionCreators=require("./bindActionCreators");var _bindActionCreators2=_interopRequireDefault(_bindActionCreators);var _applyMiddleware=require("./applyMiddleware");var _applyMiddleware2=_interopRequireDefault(_applyMiddleware);var _compose=require("./compose");var _compose2=_interopRequireDefault(_compose);var _warning=require("./utils/warning");var _warning2=_interopRequireDefault(_warning);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function isCrushed(){}if("production"!=="production"&&typeof isCrushed.name==="string"&&isCrushed.name!=="isCrushed"){(0,_warning2["default"])("You are currently using minified code outside of NODE_ENV === 'production'. "+"This means that you are running a slower development build of Redux. "+"You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify "+"or DefinePlugin for webpack (http://stackoverflow.com/questions/30030031) "+"to ensure you have the correct code for your production build.")}exports.createStore=_createStore2["default"];exports.combineReducers=_combineReducers2["default"];exports.bindActionCreators=_bindActionCreators2["default"];exports.applyMiddleware=_applyMiddleware2["default"];exports.compose=_compose2["default"]},{"./applyMiddleware":956,"./bindActionCreators":957,"./combineReducers":958,"./compose":959,"./createStore":960,"./utils/warning":962}],962:[function(require,module,exports){"use strict";exports.__esModule=true;exports["default"]=warning;function warning(message){if(typeof console!=="undefined"&&typeof console.error==="function"){console.error(message)}try{throw new Error(message)}catch(e){}}},{}],963:[function(require,module,exports){(function(process,global){!function(global){"use strict";var Op=Object.prototype;var hasOwn=Op.hasOwnProperty;var undefined;var $Symbol=typeof Symbol==="function"?Symbol:{};var iteratorSymbol=$Symbol.iterator||"@@iterator";var toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";var inModule=typeof module==="object";var runtime=global.regeneratorRuntime;if(runtime){if(inModule){module.exports=runtime}return}runtime=global.regeneratorRuntime=inModule?module.exports:{};function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator;var generator=Object.create(protoGenerator.prototype);var context=new Context(tryLocsList||[]);generator._invoke=makeInvokeMethod(innerFn,self,context);return generator}runtime.wrap=wrap;function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}var GenStateSuspendedStart="suspendedStart";var GenStateSuspendedYield="suspendedYield";var GenStateExecuting="executing";var GenStateCompleted="completed";var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};IteratorPrototype[iteratorSymbol]=function(){return this};var getProto=Object.getPrototypeOf;var NativeIteratorPrototype=getProto&&getProto(getProto(values([])));if(NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)){IteratorPrototype=NativeIteratorPrototype}var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype;GeneratorFunctionPrototype.constructor=GeneratorFunction;GeneratorFunctionPrototype[toStringTagSymbol]=GeneratorFunction.displayName="GeneratorFunction";function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){prototype[method]=function(arg){return this._invoke(method,arg)}})}runtime.isGeneratorFunction=function(genFun){var ctor=typeof genFun==="function"&&genFun.constructor;return ctor?ctor===GeneratorFunction||(ctor.displayName||ctor.name)==="GeneratorFunction":false};runtime.mark=function(genFun){if(Object.setPrototypeOf){Object.setPrototypeOf(genFun,GeneratorFunctionPrototype)}else{genFun.__proto__=GeneratorFunctionPrototype;if(!(toStringTagSymbol in genFun)){genFun[toStringTagSymbol]="GeneratorFunction"}}genFun.prototype=Object.create(Gp);return genFun};runtime.awrap=function(arg){return{__await:arg}};function AsyncIterator(generator){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if(record.type==="throw"){reject(record.arg)}else{var result=record.arg;var value=result.value;if(value&&typeof value==="object"&&hasOwn.call(value,"__await")){return Promise.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject)},function(err){invoke("throw",err,resolve,reject)})}return Promise.resolve(value).then(function(unwrapped){result.value=unwrapped;resolve(result)},reject)}}if(typeof process==="object"&&process.domain){invoke=process.domain.bind(invoke)}var previousPromise;function enqueue(method,arg){function callInvokeWithMethodAndArg(){return new Promise(function(resolve,reject){invoke(method,arg,resolve,reject)})}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}this._invoke=enqueue}defineIteratorMethods(AsyncIterator.prototype);runtime.AsyncIterator=AsyncIterator;runtime.async=function(innerFn,outerFn,self,tryLocsList){var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList));return runtime.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next()})};function makeInvokeMethod(innerFn,self,context){var state=GenStateSuspendedStart;return function invoke(method,arg){if(state===GenStateExecuting){throw new Error("Generator is already running")}if(state===GenStateCompleted){if(method==="throw"){throw arg}return doneResult()}while(true){var delegate=context.delegate;if(delegate){if(method==="return"||method==="throw"&&delegate.iterator[method]===undefined){context.delegate=null;var returnMethod=delegate.iterator["return"];if(returnMethod){var record=tryCatch(returnMethod,delegate.iterator,arg);if(record.type==="throw"){method="throw";arg=record.arg;continue}}if(method==="return"){continue}}var record=tryCatch(delegate.iterator[method],delegate.iterator,arg);if(record.type==="throw"){context.delegate=null;method="throw";arg=record.arg;continue}method="next";arg=undefined;var info=record.arg;if(info.done){context[delegate.resultName]=info.value;context.next=delegate.nextLoc}else{state=GenStateSuspendedYield;return info}context.delegate=null}if(method==="next"){context.sent=context._sent=arg}else if(method==="throw"){if(state===GenStateSuspendedStart){state=GenStateCompleted;throw arg}if(context.dispatchException(arg)){method="next";arg=undefined}}else if(method==="return"){context.abrupt("return",arg)}state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if(record.type==="normal"){state=context.done?GenStateCompleted:GenStateSuspendedYield;var info={value:record.arg,done:context.done};if(record.arg===ContinueSentinel){if(context.delegate&&method==="next"){arg=undefined}}else{return info}}else if(record.type==="throw"){state=GenStateCompleted;method="throw";arg=record.arg}}}}defineIteratorMethods(Gp);Gp[toStringTagSymbol]="Generator";Gp.toString=function(){return"[object Generator]"};function pushTryEntry(locs){var entry={tryLoc:locs[0]};if(1 in locs){entry.catchLoc=locs[1]}if(2 in locs){entry.finallyLoc=locs[2];entry.afterLoc=locs[3]}this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal";delete record.arg;entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}];tryLocsList.forEach(pushTryEntry,this);this.reset(true)}runtime.keys=function(object){var keys=[];for(var key in object){keys.push(key)}keys.reverse();return function next(){while(keys.length){var key=keys.pop();if(key in object){next.value=key;next.done=false;return next}}next.done=true;return next}};function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod){return iteratorMethod.call(iterable)}if(typeof iterable.next==="function"){return iterable}if(!isNaN(iterable.length)){var i=-1,next=function next(){while(++i<iterable.length){if(hasOwn.call(iterable,i)){next.value=iterable[i];next.done=false;return next}}next.value=undefined;next.done=true;return next};return next.next=next}}return{next:doneResult}}runtime.values=values;function doneResult(){return{value:undefined,done:true}}Context.prototype={constructor:Context,reset:function(skipTempReset){this.prev=0;this.next=0;this.sent=this._sent=undefined;this.done=false;this.delegate=null;this.tryEntries.forEach(resetTryEntry);if(!skipTempReset){for(var name in this){if(name.charAt(0)==="t"&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))){this[name]=undefined}}}},stop:function(){this.done=true;var rootEntry=this.tryEntries[0];var rootRecord=rootEntry.completion;if(rootRecord.type==="throw"){throw rootRecord.arg}return this.rval},dispatchException:function(exception){if(this.done){throw exception}var context=this;function handle(loc,caught){record.type="throw";record.arg=exception;context.next=loc;return!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];var record=entry.completion;if(entry.tryLoc==="root"){return handle("end")}if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc");var hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}else if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else if(hasCatch){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}}else if(hasFinally){if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}if(finallyEntry&&(type==="break"||type==="continue")&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc){finallyEntry=null}var record=finallyEntry?finallyEntry.completion:{};record.type=type;record.arg=arg;if(finallyEntry){this.next=finallyEntry.finallyLoc}else{this.complete(record)}return ContinueSentinel},complete:function(record,afterLoc){if(record.type==="throw"){throw record.arg}if(record.type==="break"||record.type==="continue"){this.next=record.arg}else if(record.type==="return"){this.rval=record.arg;this.next="end"}else if(record.type==="normal"&&afterLoc){this.next=afterLoc}},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc){this.complete(entry.completion,entry.afterLoc);resetTryEntry(entry);return ContinueSentinel}}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if(record.type==="throw"){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc};return ContinueSentinel}}}(typeof global==="object"?global:typeof window==="object"?window:typeof self==="object"?self:this)}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:11}],964:[function(require,module,exports){var encode=require("./lib/encoder"),decode=require("./lib/decoder");module.exports={encode:encode,decode:decode}},{"./lib/decoder":965,"./lib/encoder":966}],965:[function(require,module,exports){(function(Buffer){var JpegImage=function jpegImage(){"use strict";var dctZigZag=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);var dctCos1=4017;var dctSin1=799;var dctCos3=3406;var dctSin3=2276;var dctCos6=1567;var dctSin6=3784;var dctSqrt2=5793;var dctSqrt1d2=2896;function constructor(){}function buildHuffmanTable(codeLengths,values){var k=0,code=[],i,j,length=16;while(length>0&&!codeLengths[length-1])length--;code.push({children:[],index:0});var p=code[0],q;for(i=0;i<length;i++){for(j=0;j<codeLengths[i];j++){p=code.pop();p.children[p.index]=values[k];while(p.index>0){p=code.pop()}p.index++;code.push(p);while(code.length<=i){code.push(q={children:[],index:0});p.children[p.index]=q.children;p=q}k++}if(i+1<length){code.push(q={children:[],index:0});p.children[p.index]=q.children;p=q}}return code[0].children}function decodeScan(data,offset,frame,components,resetInterval,spectralStart,spectralEnd,successivePrev,successive){var precision=frame.precision;var samplesPerLine=frame.samplesPerLine;var scanLines=frame.scanLines;var mcusPerLine=frame.mcusPerLine;var progressive=frame.progressive;var maxH=frame.maxH,maxV=frame.maxV;var startOffset=offset,bitsData=0,bitsCount=0;function readBit(){if(bitsCount>0){bitsCount--;return bitsData>>bitsCount&1}bitsData=data[offset++];if(bitsData==255){var nextByte=data[offset++];if(nextByte){throw"unexpected marker: "+(bitsData<<8|nextByte).toString(16)}}bitsCount=7;return bitsData>>>7}function decodeHuffman(tree){var node=tree,bit;while((bit=readBit())!==null){node=node[bit];if(typeof node==="number")return node;if(typeof node!=="object")throw"invalid huffman sequence"}return null}function receive(length){var n=0;while(length>0){var bit=readBit();if(bit===null)return;n=n<<1|bit;length--}return n}function receiveAndExtend(length){var n=receive(length);if(n>=1<<length-1)return n;return n+(-1<<length)+1}function decodeBaseline(component,zz){var t=decodeHuffman(component.huffmanTableDC);var diff=t===0?0:receiveAndExtend(t);zz[0]=component.pred+=diff;var k=1;while(k<64){var rs=decodeHuffman(component.huffmanTableAC);var s=rs&15,r=rs>>4;if(s===0){if(r<15)break;k+=16;continue}k+=r;var z=dctZigZag[k];zz[z]=receiveAndExtend(s);k++}}function decodeDCFirst(component,zz){var t=decodeHuffman(component.huffmanTableDC);var diff=t===0?0:receiveAndExtend(t)<<successive;zz[0]=component.pred+=diff}function decodeDCSuccessive(component,zz){zz[0]|=readBit()<<successive}var eobrun=0;function decodeACFirst(component,zz){if(eobrun>0){eobrun--;return}var k=spectralStart,e=spectralEnd;while(k<=e){var rs=decodeHuffman(component.huffmanTableAC);var s=rs&15,r=rs>>4;if(s===0){if(r<15){eobrun=receive(r)+(1<<r)-1;break}k+=16;continue}k+=r;var z=dctZigZag[k];zz[z]=receiveAndExtend(s)*(1<<successive);k++}}var successiveACState=0,successiveACNextValue;function decodeACSuccessive(component,zz){var k=spectralStart,e=spectralEnd,r=0;while(k<=e){var z=dctZigZag[k];switch(successiveACState){case 0:var rs=decodeHuffman(component.huffmanTableAC);var s=rs&15,r=rs>>4;if(s===0){if(r<15){eobrun=receive(r)+(1<<r);successiveACState=4}else{r=16;successiveACState=1}}else{if(s!==1)throw"invalid ACn encoding";successiveACNextValue=receiveAndExtend(s);successiveACState=r?2:3}continue;case 1:case 2:if(zz[z])zz[z]+=readBit()<<successive;else{r--;if(r===0)successiveACState=successiveACState==2?3:0}break;case 3:if(zz[z])zz[z]+=readBit()<<successive;else{zz[z]=successiveACNextValue<<successive;successiveACState=0}break;case 4:if(zz[z])zz[z]+=readBit()<<successive;break}k++}if(successiveACState===4){eobrun--;if(eobrun===0)successiveACState=0}}function decodeMcu(component,decode,mcu,row,col){var mcuRow=mcu/mcusPerLine|0;var mcuCol=mcu%mcusPerLine;var blockRow=mcuRow*component.v+row;var blockCol=mcuCol*component.h+col;decode(component,component.blocks[blockRow][blockCol])}function decodeBlock(component,decode,mcu){var blockRow=mcu/component.blocksPerLine|0;var blockCol=mcu%component.blocksPerLine;decode(component,component.blocks[blockRow][blockCol])}var componentsLength=components.length;var component,i,j,k,n;var decodeFn;if(progressive){if(spectralStart===0)decodeFn=successivePrev===0?decodeDCFirst:decodeDCSuccessive;else decodeFn=successivePrev===0?decodeACFirst:decodeACSuccessive}else{decodeFn=decodeBaseline}var mcu=0,marker;var mcuExpected;if(componentsLength==1){mcuExpected=components[0].blocksPerLine*components[0].blocksPerColumn}else{mcuExpected=mcusPerLine*frame.mcusPerColumn}if(!resetInterval)resetInterval=mcuExpected;var h,v;while(mcu<mcuExpected){for(i=0;i<componentsLength;i++)components[i].pred=0;eobrun=0;if(componentsLength==1){component=components[0];for(n=0;n<resetInterval;n++){decodeBlock(component,decodeFn,mcu);mcu++}}else{for(n=0;n<resetInterval;n++){for(i=0;i<componentsLength;i++){component=components[i];h=component.h;v=component.v;for(j=0;j<v;j++){for(k=0;k<h;k++){decodeMcu(component,decodeFn,mcu,j,k)}}}mcu++;if(mcu===mcuExpected)break}}bitsCount=0;marker=data[offset]<<8|data[offset+1];if(marker<65280){throw"marker was not found"}if(marker>=65488&&marker<=65495){offset+=2}else break}return offset-startOffset}function buildComponentData(frame,component){var lines=[];var blocksPerLine=component.blocksPerLine;var blocksPerColumn=component.blocksPerColumn;var samplesPerLine=blocksPerLine<<3;var R=new Int32Array(64),r=new Uint8Array(64);function quantizeAndInverse(zz,dataOut,dataIn){var qt=component.quantizationTable;var v0,v1,v2,v3,v4,v5,v6,v7,t;var p=dataIn;var i;for(i=0;i<64;i++)p[i]=zz[i]*qt[i];for(i=0;i<8;++i){var row=8*i;if(p[1+row]==0&&p[2+row]==0&&p[3+row]==0&&p[4+row]==0&&p[5+row]==0&&p[6+row]==0&&p[7+row]==0){t=dctSqrt2*p[0+row]+512>>10;p[0+row]=t;p[1+row]=t;p[2+row]=t;p[3+row]=t;p[4+row]=t;p[5+row]=t;p[6+row]=t;p[7+row]=t;continue}v0=dctSqrt2*p[0+row]+128>>8;v1=dctSqrt2*p[4+row]+128>>8;v2=p[2+row];v3=p[6+row];v4=dctSqrt1d2*(p[1+row]-p[7+row])+128>>8;v7=dctSqrt1d2*(p[1+row]+p[7+row])+128>>8;v5=p[3+row]<<4;v6=p[5+row]<<4;t=v0-v1+1>>1;v0=v0+v1+1>>1;v1=t;t=v2*dctSin6+v3*dctCos6+128>>8;v2=v2*dctCos6-v3*dctSin6+128>>8;v3=t;t=v4-v6+1>>1;v4=v4+v6+1>>1;v6=t;t=v7+v5+1>>1;v5=v7-v5+1>>1;v7=t;t=v0-v3+1>>1;v0=v0+v3+1>>1;v3=t;t=v1-v2+1>>1;v1=v1+v2+1>>1;v2=t;t=v4*dctSin3+v7*dctCos3+2048>>12;v4=v4*dctCos3-v7*dctSin3+2048>>12;v7=t;t=v5*dctSin1+v6*dctCos1+2048>>12;v5=v5*dctCos1-v6*dctSin1+2048>>12;v6=t;p[0+row]=v0+v7;p[7+row]=v0-v7;p[1+row]=v1+v6;p[6+row]=v1-v6;p[2+row]=v2+v5;p[5+row]=v2-v5;p[3+row]=v3+v4;p[4+row]=v3-v4}for(i=0;i<8;++i){var col=i;if(p[1*8+col]==0&&p[2*8+col]==0&&p[3*8+col]==0&&p[4*8+col]==0&&p[5*8+col]==0&&p[6*8+col]==0&&p[7*8+col]==0){t=dctSqrt2*dataIn[i+0]+8192>>14;p[0*8+col]=t;p[1*8+col]=t;p[2*8+col]=t;p[3*8+col]=t;p[4*8+col]=t;p[5*8+col]=t;p[6*8+col]=t;p[7*8+col]=t;continue}v0=dctSqrt2*p[0*8+col]+2048>>12;v1=dctSqrt2*p[4*8+col]+2048>>12;v2=p[2*8+col];v3=p[6*8+col];v4=dctSqrt1d2*(p[1*8+col]-p[7*8+col])+2048>>12;v7=dctSqrt1d2*(p[1*8+col]+p[7*8+col])+2048>>12;v5=p[3*8+col];v6=p[5*8+col];t=v0-v1+1>>1;v0=v0+v1+1>>1;v1=t;t=v2*dctSin6+v3*dctCos6+2048>>12;v2=v2*dctCos6-v3*dctSin6+2048>>12;v3=t;t=v4-v6+1>>1;v4=v4+v6+1>>1;v6=t;t=v7+v5+1>>1;v5=v7-v5+1>>1;v7=t;t=v0-v3+1>>1;v0=v0+v3+1>>1;v3=t;t=v1-v2+1>>1;v1=v1+v2+1>>1;v2=t;t=v4*dctSin3+v7*dctCos3+2048>>12;v4=v4*dctCos3-v7*dctSin3+2048>>12;v7=t;t=v5*dctSin1+v6*dctCos1+2048>>12;v5=v5*dctCos1-v6*dctSin1+2048>>12;v6=t;p[0*8+col]=v0+v7;p[7*8+col]=v0-v7;p[1*8+col]=v1+v6;p[6*8+col]=v1-v6;p[2*8+col]=v2+v5;p[5*8+col]=v2-v5;p[3*8+col]=v3+v4;p[4*8+col]=v3-v4}for(i=0;i<64;++i){var sample=128+(p[i]+8>>4);dataOut[i]=sample<0?0:sample>255?255:sample}}var i,j;for(var blockRow=0;blockRow<blocksPerColumn;blockRow++){var scanLine=blockRow<<3;for(i=0;i<8;i++)lines.push(new Uint8Array(samplesPerLine));for(var blockCol=0;blockCol<blocksPerLine;blockCol++){quantizeAndInverse(component.blocks[blockRow][blockCol],r,R);var offset=0,sample=blockCol<<3;for(j=0;j<8;j++){var line=lines[scanLine+j];for(i=0;i<8;i++)line[sample+i]=r[offset++]}}}return lines}function clampTo8bit(a){return a<0?0:a>255?255:a}constructor.prototype={load:function load(path){var xhr=new XMLHttpRequest;xhr.open("GET",path,true);xhr.responseType="arraybuffer";xhr.onload=function(){var data=new Uint8Array(xhr.response||xhr.mozResponseArrayBuffer);this.parse(data);if(this.onload)this.onload()}.bind(this);xhr.send(null)},parse:function parse(data){var offset=0,length=data.length;function readUint16(){var value=data[offset]<<8|data[offset+1];offset+=2;return value}function readDataBlock(){var length=readUint16();var array=data.subarray(offset,offset+length-2);offset+=array.length;return array}function prepareComponents(frame){var maxH=0,maxV=0;var component,componentId;for(componentId in frame.components){if(frame.components.hasOwnProperty(componentId)){component=frame.components[componentId];if(maxH<component.h)maxH=component.h;if(maxV<component.v)maxV=component.v}}var mcusPerLine=Math.ceil(frame.samplesPerLine/8/maxH);var mcusPerColumn=Math.ceil(frame.scanLines/8/maxV);for(componentId in frame.components){if(frame.components.hasOwnProperty(componentId)){component=frame.components[componentId];var blocksPerLine=Math.ceil(Math.ceil(frame.samplesPerLine/8)*component.h/maxH);var blocksPerColumn=Math.ceil(Math.ceil(frame.scanLines/8)*component.v/maxV);var blocksPerLineForMcu=mcusPerLine*component.h;var blocksPerColumnForMcu=mcusPerColumn*component.v;var blocks=[];for(var i=0;i<blocksPerColumnForMcu;i++){var row=[];for(var j=0;j<blocksPerLineForMcu;j++)row.push(new Int32Array(64));blocks.push(row)}component.blocksPerLine=blocksPerLine;
component.blocksPerColumn=blocksPerColumn;component.blocks=blocks}}frame.maxH=maxH;frame.maxV=maxV;frame.mcusPerLine=mcusPerLine;frame.mcusPerColumn=mcusPerColumn}var jfif=null;var adobe=null;var pixels=null;var frame,resetInterval;var quantizationTables=[],frames=[];var huffmanTablesAC=[],huffmanTablesDC=[];var fileMarker=readUint16();if(fileMarker!=65496){throw"SOI not found"}fileMarker=readUint16();while(fileMarker!=65497){var i,j,l;switch(fileMarker){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var appData=readDataBlock();if(fileMarker===65504){if(appData[0]===74&&appData[1]===70&&appData[2]===73&&appData[3]===70&&appData[4]===0){jfif={version:{major:appData[5],minor:appData[6]},densityUnits:appData[7],xDensity:appData[8]<<8|appData[9],yDensity:appData[10]<<8|appData[11],thumbWidth:appData[12],thumbHeight:appData[13],thumbData:appData.subarray(14,14+3*appData[12]*appData[13])}}}if(fileMarker===65518){if(appData[0]===65&&appData[1]===100&&appData[2]===111&&appData[3]===98&&appData[4]===101&&appData[5]===0){adobe={version:appData[6],flags0:appData[7]<<8|appData[8],flags1:appData[9]<<8|appData[10],transformCode:appData[11]}}}break;case 65499:var quantizationTablesLength=readUint16();var quantizationTablesEnd=quantizationTablesLength+offset-2;while(offset<quantizationTablesEnd){var quantizationTableSpec=data[offset++];var tableData=new Int32Array(64);if(quantizationTableSpec>>4===0){for(j=0;j<64;j++){var z=dctZigZag[j];tableData[z]=data[offset++]}}else if(quantizationTableSpec>>4===1){for(j=0;j<64;j++){var z=dctZigZag[j];tableData[z]=readUint16()}}else throw"DQT: invalid table spec";quantizationTables[quantizationTableSpec&15]=tableData}break;case 65472:case 65473:case 65474:readUint16();frame={};frame.extended=fileMarker===65473;frame.progressive=fileMarker===65474;frame.precision=data[offset++];frame.scanLines=readUint16();frame.samplesPerLine=readUint16();frame.components={};frame.componentsOrder=[];var componentsCount=data[offset++],componentId;var maxH=0,maxV=0;for(i=0;i<componentsCount;i++){componentId=data[offset];var h=data[offset+1]>>4;var v=data[offset+1]&15;var qId=data[offset+2];frame.componentsOrder.push(componentId);frame.components[componentId]={h:h,v:v,quantizationTable:quantizationTables[qId]};offset+=3}prepareComponents(frame);frames.push(frame);break;case 65476:var huffmanLength=readUint16();for(i=2;i<huffmanLength;){var huffmanTableSpec=data[offset++];var codeLengths=new Uint8Array(16);var codeLengthSum=0;for(j=0;j<16;j++,offset++)codeLengthSum+=codeLengths[j]=data[offset];var huffmanValues=new Uint8Array(codeLengthSum);for(j=0;j<codeLengthSum;j++,offset++)huffmanValues[j]=data[offset];i+=17+codeLengthSum;(huffmanTableSpec>>4===0?huffmanTablesDC:huffmanTablesAC)[huffmanTableSpec&15]=buildHuffmanTable(codeLengths,huffmanValues)}break;case 65501:readUint16();resetInterval=readUint16();break;case 65498:var scanLength=readUint16();var selectorsCount=data[offset++];var components=[],component;for(i=0;i<selectorsCount;i++){component=frame.components[data[offset++]];var tableSpec=data[offset++];component.huffmanTableDC=huffmanTablesDC[tableSpec>>4];component.huffmanTableAC=huffmanTablesAC[tableSpec&15];components.push(component)}var spectralStart=data[offset++];var spectralEnd=data[offset++];var successiveApproximation=data[offset++];var processed=decodeScan(data,offset,frame,components,resetInterval,spectralStart,spectralEnd,successiveApproximation>>4,successiveApproximation&15);offset+=processed;break;default:if(data[offset-3]==255&&data[offset-2]>=192&&data[offset-2]<=254){offset-=3;break}throw"unknown JPEG marker "+fileMarker.toString(16)}fileMarker=readUint16()}if(frames.length!=1)throw"only single frame JPEGs supported";this.width=frame.samplesPerLine;this.height=frame.scanLines;this.jfif=jfif;this.adobe=adobe;this.components=[];for(var i=0;i<frame.componentsOrder.length;i++){var component=frame.components[frame.componentsOrder[i]];this.components.push({lines:buildComponentData(frame,component),scaleX:component.h/frame.maxH,scaleY:component.v/frame.maxV})}},getData:function getData(width,height){var scaleX=this.width/width,scaleY=this.height/height;var component1,component2,component3,component4;var component1Line,component2Line,component3Line,component4Line;var x,y;var offset=0;var Y,Cb,Cr,K,C,M,Ye,R,G,B;var colorTransform;var dataLength=width*height*this.components.length;var data=new Uint8Array(dataLength);switch(this.components.length){case 1:component1=this.components[0];for(y=0;y<height;y++){component1Line=component1.lines[0|y*component1.scaleY*scaleY];for(x=0;x<width;x++){Y=component1Line[0|x*component1.scaleX*scaleX];data[offset++]=Y}}break;case 2:component1=this.components[0];component2=this.components[1];for(y=0;y<height;y++){component1Line=component1.lines[0|y*component1.scaleY*scaleY];component2Line=component2.lines[0|y*component2.scaleY*scaleY];for(x=0;x<width;x++){Y=component1Line[0|x*component1.scaleX*scaleX];data[offset++]=Y;Y=component2Line[0|x*component2.scaleX*scaleX];data[offset++]=Y}}break;case 3:colorTransform=true;if(this.adobe&&this.adobe.transformCode)colorTransform=true;else if(typeof this.colorTransform!=="undefined")colorTransform=!!this.colorTransform;component1=this.components[0];component2=this.components[1];component3=this.components[2];for(y=0;y<height;y++){component1Line=component1.lines[0|y*component1.scaleY*scaleY];component2Line=component2.lines[0|y*component2.scaleY*scaleY];component3Line=component3.lines[0|y*component3.scaleY*scaleY];for(x=0;x<width;x++){if(!colorTransform){R=component1Line[0|x*component1.scaleX*scaleX];G=component2Line[0|x*component2.scaleX*scaleX];B=component3Line[0|x*component3.scaleX*scaleX]}else{Y=component1Line[0|x*component1.scaleX*scaleX];Cb=component2Line[0|x*component2.scaleX*scaleX];Cr=component3Line[0|x*component3.scaleX*scaleX];R=clampTo8bit(Y+1.402*(Cr-128));G=clampTo8bit(Y-.3441363*(Cb-128)-.71413636*(Cr-128));B=clampTo8bit(Y+1.772*(Cb-128))}data[offset++]=R;data[offset++]=G;data[offset++]=B}}break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";colorTransform=false;if(this.adobe&&this.adobe.transformCode)colorTransform=true;else if(typeof this.colorTransform!=="undefined")colorTransform=!!this.colorTransform;component1=this.components[0];component2=this.components[1];component3=this.components[2];component4=this.components[3];for(y=0;y<height;y++){component1Line=component1.lines[0|y*component1.scaleY*scaleY];component2Line=component2.lines[0|y*component2.scaleY*scaleY];component3Line=component3.lines[0|y*component3.scaleY*scaleY];component4Line=component4.lines[0|y*component4.scaleY*scaleY];for(x=0;x<width;x++){if(!colorTransform){C=component1Line[0|x*component1.scaleX*scaleX];M=component2Line[0|x*component2.scaleX*scaleX];Ye=component3Line[0|x*component3.scaleX*scaleX];K=component4Line[0|x*component4.scaleX*scaleX]}else{Y=component1Line[0|x*component1.scaleX*scaleX];Cb=component2Line[0|x*component2.scaleX*scaleX];Cr=component3Line[0|x*component3.scaleX*scaleX];K=component4Line[0|x*component4.scaleX*scaleX];C=255-clampTo8bit(Y+1.402*(Cr-128));M=255-clampTo8bit(Y-.3441363*(Cb-128)-.71413636*(Cr-128));Ye=255-clampTo8bit(Y+1.772*(Cb-128))}data[offset++]=C;data[offset++]=M;data[offset++]=Ye;data[offset++]=K}}break;default:throw"Unsupported color mode"}return data},copyToImageData:function copyToImageData(imageData){var width=imageData.width,height=imageData.height;var imageDataArray=imageData.data;var data=this.getData(width,height);var i=0,j=0,x,y;var Y,K,C,M,R,G,B;switch(this.components.length){case 1:for(y=0;y<height;y++){for(x=0;x<width;x++){Y=data[i++];imageDataArray[j++]=Y;imageDataArray[j++]=Y;imageDataArray[j++]=Y;imageDataArray[j++]=255}}break;case 3:for(y=0;y<height;y++){for(x=0;x<width;x++){R=data[i++];G=data[i++];B=data[i++];imageDataArray[j++]=R;imageDataArray[j++]=G;imageDataArray[j++]=B;imageDataArray[j++]=255}}break;case 4:for(y=0;y<height;y++){for(x=0;x<width;x++){C=data[i++];M=data[i++];Y=data[i++];K=data[i++];R=255-clampTo8bit(C*(1-K/255)+K);G=255-clampTo8bit(M*(1-K/255)+K);B=255-clampTo8bit(Y*(1-K/255)+K);imageDataArray[j++]=R;imageDataArray[j++]=G;imageDataArray[j++]=B;imageDataArray[j++]=255}}break;default:throw"Unsupported color mode"}}};return constructor}();module.exports=decode;function decode(jpegData){var arr=new Uint8Array(jpegData);var decoder=new JpegImage;decoder.parse(arr);var data=decoder.getData(decoder.width,decoder.height);var buf=new Buffer(decoder.width*decoder.height*4);var n=0;for(var i=0;i<buf.length;i++){buf[i+(i/3|0)]=data[n++];if(i%4==3)buf[i]=255}return{data:buf,width:decoder.width,height:decoder.height}}}).call(this,require("buffer").Buffer)},{buffer:19}],966:[function(require,module,exports){(function(Buffer){var btoa=btoa||function(buf){return new Buffer(buf).toString("base64")};function JPEGEncoder(quality){var self=this;var fround=Math.round;var ffloor=Math.floor;var YTable=new Array(64);var UVTable=new Array(64);var fdtbl_Y=new Array(64);var fdtbl_UV=new Array(64);var YDC_HT;var UVDC_HT;var YAC_HT;var UVAC_HT;var bitcode=new Array(65535);var category=new Array(65535);var outputfDCTQuant=new Array(64);var DU=new Array(64);var byteout=[];var bytenew=0;var bytepos=7;var YDU=new Array(64);var UDU=new Array(64);var VDU=new Array(64);var clt=new Array(256);var RGB_YUV_TABLE=new Array(2048);var currentQuality;var ZigZag=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63];var std_dc_luminance_nrcodes=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];var std_dc_luminance_values=[0,1,2,3,4,5,6,7,8,9,10,11];var std_ac_luminance_nrcodes=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125];var std_ac_luminance_values=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250];var std_dc_chrominance_nrcodes=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];var std_dc_chrominance_values=[0,1,2,3,4,5,6,7,8,9,10,11];var std_ac_chrominance_nrcodes=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119];var std_ac_chrominance_values=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function initQuantTables(sf){var YQT=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(var i=0;i<64;i++){var t=ffloor((YQT[i]*sf+50)/100);if(t<1){t=1}else if(t>255){t=255}YTable[ZigZag[i]]=t}var UVQT=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(var j=0;j<64;j++){var u=ffloor((UVQT[j]*sf+50)/100);if(u<1){u=1}else if(u>255){u=255}UVTable[ZigZag[j]]=u}var aasf=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379];var k=0;for(var row=0;row<8;row++){for(var col=0;col<8;col++){fdtbl_Y[k]=1/(YTable[ZigZag[k]]*aasf[row]*aasf[col]*8);fdtbl_UV[k]=1/(UVTable[ZigZag[k]]*aasf[row]*aasf[col]*8);k++}}}function computeHuffmanTbl(nrcodes,std_table){var codevalue=0;var pos_in_table=0;var HT=new Array;for(var k=1;k<=16;k++){for(var j=1;j<=nrcodes[k];j++){HT[std_table[pos_in_table]]=[];HT[std_table[pos_in_table]][0]=codevalue;HT[std_table[pos_in_table]][1]=k;pos_in_table++;codevalue++}codevalue*=2}return HT}function initHuffmanTbl(){YDC_HT=computeHuffmanTbl(std_dc_luminance_nrcodes,std_dc_luminance_values);UVDC_HT=computeHuffmanTbl(std_dc_chrominance_nrcodes,std_dc_chrominance_values);YAC_HT=computeHuffmanTbl(std_ac_luminance_nrcodes,std_ac_luminance_values);UVAC_HT=computeHuffmanTbl(std_ac_chrominance_nrcodes,std_ac_chrominance_values)}function initCategoryNumber(){var nrlower=1;var nrupper=2;for(var cat=1;cat<=15;cat++){for(var nr=nrlower;nr<nrupper;nr++){category[32767+nr]=cat;bitcode[32767+nr]=[];bitcode[32767+nr][1]=cat;bitcode[32767+nr][0]=nr}for(var nrneg=-(nrupper-1);nrneg<=-nrlower;nrneg++){category[32767+nrneg]=cat;bitcode[32767+nrneg]=[];bitcode[32767+nrneg][1]=cat;bitcode[32767+nrneg][0]=nrupper-1+nrneg}nrlower<<=1;nrupper<<=1}}function initRGBYUVTable(){for(var i=0;i<256;i++){RGB_YUV_TABLE[i]=19595*i;RGB_YUV_TABLE[i+256>>0]=38470*i;RGB_YUV_TABLE[i+512>>0]=7471*i+32768;RGB_YUV_TABLE[i+768>>0]=-11059*i;RGB_YUV_TABLE[i+1024>>0]=-21709*i;RGB_YUV_TABLE[i+1280>>0]=32768*i+8421375;RGB_YUV_TABLE[i+1536>>0]=-27439*i;RGB_YUV_TABLE[i+1792>>0]=-5329*i}}function writeBits(bs){var value=bs[0];var posval=bs[1]-1;while(posval>=0){if(value&1<<posval){bytenew|=1<<bytepos}posval--;bytepos--;if(bytepos<0){if(bytenew==255){writeByte(255);writeByte(0)}else{writeByte(bytenew)}bytepos=7;bytenew=0}}}function writeByte(value){byteout.push(value)}function writeWord(value){writeByte(value>>8&255);writeByte(value&255)}function fDCTQuant(data,fdtbl){var d0,d1,d2,d3,d4,d5,d6,d7;var dataOff=0;var i;const I8=8;const I64=64;for(i=0;i<I8;++i){d0=data[dataOff];d1=data[dataOff+1];d2=data[dataOff+2];d3=data[dataOff+3];d4=data[dataOff+4];d5=data[dataOff+5];d6=data[dataOff+6];d7=data[dataOff+7];var tmp0=d0+d7;var tmp7=d0-d7;var tmp1=d1+d6;var tmp6=d1-d6;var tmp2=d2+d5;var tmp5=d2-d5;var tmp3=d3+d4;var tmp4=d3-d4;var tmp10=tmp0+tmp3;var tmp13=tmp0-tmp3;var tmp11=tmp1+tmp2;var tmp12=tmp1-tmp2;data[dataOff]=tmp10+tmp11;data[dataOff+4]=tmp10-tmp11;var z1=(tmp12+tmp13)*.707106781;data[dataOff+2]=tmp13+z1;data[dataOff+6]=tmp13-z1;tmp10=tmp4+tmp5;tmp11=tmp5+tmp6;tmp12=tmp6+tmp7;var z5=(tmp10-tmp12)*.382683433;var z2=.5411961*tmp10+z5;var z4=1.306562965*tmp12+z5;var z3=tmp11*.707106781;var z11=tmp7+z3;var z13=tmp7-z3;data[dataOff+5]=z13+z2;data[dataOff+3]=z13-z2;data[dataOff+1]=z11+z4;data[dataOff+7]=z11-z4;dataOff+=8}dataOff=0;for(i=0;i<I8;++i){d0=data[dataOff];d1=data[dataOff+8];d2=data[dataOff+16];d3=data[dataOff+24];d4=data[dataOff+32];d5=data[dataOff+40];d6=data[dataOff+48];d7=data[dataOff+56];var tmp0p2=d0+d7;var tmp7p2=d0-d7;var tmp1p2=d1+d6;var tmp6p2=d1-d6;var tmp2p2=d2+d5;var tmp5p2=d2-d5;var tmp3p2=d3+d4;var tmp4p2=d3-d4;var tmp10p2=tmp0p2+tmp3p2;var tmp13p2=tmp0p2-tmp3p2;var tmp11p2=tmp1p2+tmp2p2;var tmp12p2=tmp1p2-tmp2p2;data[dataOff]=tmp10p2+tmp11p2;data[dataOff+32]=tmp10p2-tmp11p2;var z1p2=(tmp12p2+tmp13p2)*.707106781;data[dataOff+16]=tmp13p2+z1p2;data[dataOff+48]=tmp13p2-z1p2;tmp10p2=tmp4p2+tmp5p2;tmp11p2=tmp5p2+tmp6p2;tmp12p2=tmp6p2+tmp7p2;var z5p2=(tmp10p2-tmp12p2)*.382683433;var z2p2=.5411961*tmp10p2+z5p2;var z4p2=1.306562965*tmp12p2+z5p2;var z3p2=tmp11p2*.707106781;var z11p2=tmp7p2+z3p2;var z13p2=tmp7p2-z3p2;data[dataOff+40]=z13p2+z2p2;data[dataOff+24]=z13p2-z2p2;data[dataOff+8]=z11p2+z4p2;data[dataOff+56]=z11p2-z4p2;dataOff++}var fDCTQuant;for(i=0;i<I64;++i){fDCTQuant=data[i]*fdtbl[i];outputfDCTQuant[i]=fDCTQuant>0?fDCTQuant+.5|0:fDCTQuant-.5|0}return outputfDCTQuant}function writeAPP0(){writeWord(65504);writeWord(16);writeByte(74);writeByte(70);writeByte(73);writeByte(70);writeByte(0);writeByte(1);writeByte(1);writeByte(0);writeWord(1);writeWord(1);writeByte(0);writeByte(0)}function writeSOF0(width,height){writeWord(65472);writeWord(17);writeByte(8);writeWord(height);writeWord(width);writeByte(3);writeByte(1);writeByte(17);writeByte(0);writeByte(2);writeByte(17);writeByte(1);writeByte(3);writeByte(17);writeByte(1)}function writeDQT(){writeWord(65499);writeWord(132);writeByte(0);for(var i=0;i<64;i++){writeByte(YTable[i])}writeByte(1);for(var j=0;j<64;j++){writeByte(UVTable[j])}}function writeDHT(){writeWord(65476);writeWord(418);writeByte(0);for(var i=0;i<16;i++){writeByte(std_dc_luminance_nrcodes[i+1])}for(var j=0;j<=11;j++){writeByte(std_dc_luminance_values[j])}writeByte(16);for(var k=0;k<16;k++){writeByte(std_ac_luminance_nrcodes[k+1])}for(var l=0;l<=161;l++){writeByte(std_ac_luminance_values[l])}writeByte(1);for(var m=0;m<16;m++){writeByte(std_dc_chrominance_nrcodes[m+1])}for(var n=0;n<=11;n++){writeByte(std_dc_chrominance_values[n])}writeByte(17);for(var o=0;o<16;o++){writeByte(std_ac_chrominance_nrcodes[o+1])}for(var p=0;p<=161;p++){writeByte(std_ac_chrominance_values[p])}}function writeSOS(){writeWord(65498);writeWord(12);writeByte(3);writeByte(1);writeByte(0);writeByte(2);writeByte(17);writeByte(3);writeByte(17);writeByte(0);writeByte(63);writeByte(0)}function processDU(CDU,fdtbl,DC,HTDC,HTAC){var EOB=HTAC[0];var M16zeroes=HTAC[240];var pos;const I16=16;const I63=63;const I64=64;var DU_DCT=fDCTQuant(CDU,fdtbl);for(var j=0;j<I64;++j){DU[ZigZag[j]]=DU_DCT[j]}var Diff=DU[0]-DC;DC=DU[0];if(Diff==0){writeBits(HTDC[0])}else{pos=32767+Diff;writeBits(HTDC[category[pos]]);writeBits(bitcode[pos])}var end0pos=63;for(;end0pos>0&&DU[end0pos]==0;end0pos--){}if(end0pos==0){writeBits(EOB);return DC}var i=1;var lng;while(i<=end0pos){var startpos=i;for(;DU[i]==0&&i<=end0pos;++i){}var nrzeroes=i-startpos;if(nrzeroes>=I16){lng=nrzeroes>>4;for(var nrmarker=1;nrmarker<=lng;++nrmarker)writeBits(M16zeroes);nrzeroes=nrzeroes&15}pos=32767+DU[i];writeBits(HTAC[(nrzeroes<<4)+category[pos]]);writeBits(bitcode[pos]);i++}if(end0pos!=I63){writeBits(EOB)}return DC}function initCharLookupTable(){var sfcc=String.fromCharCode;for(var i=0;i<256;i++){clt[i]=sfcc(i)}}this.encode=function(image,quality){var time_start=(new Date).getTime();if(quality)setQuality(quality);byteout=new Array;bytenew=0;bytepos=7;writeWord(65496);writeAPP0();writeDQT();writeSOF0(image.width,image.height);writeDHT();writeSOS();var DCY=0;var DCU=0;var DCV=0;bytenew=0;bytepos=7;this.encode.displayName="_encode_";var imageData=image.data;var width=image.width;var height=image.height;var quadWidth=width*4;var tripleWidth=width*3;var x,y=0;var r,g,b;var start,p,col,row,pos;while(y<height){x=0;while(x<quadWidth){start=quadWidth*y+x;p=start;col=-1;row=0;for(pos=0;pos<64;pos++){row=pos>>3;col=(pos&7)*4;p=start+row*quadWidth+col;if(y+row>=height){p-=quadWidth*(y+1+row-height)}if(x+col>=quadWidth){p-=x+col-quadWidth+4}r=imageData[p++];g=imageData[p++];b=imageData[p++];YDU[pos]=(RGB_YUV_TABLE[r]+RGB_YUV_TABLE[g+256>>0]+RGB_YUV_TABLE[b+512>>0]>>16)-128;UDU[pos]=(RGB_YUV_TABLE[r+768>>0]+RGB_YUV_TABLE[g+1024>>0]+RGB_YUV_TABLE[b+1280>>0]>>16)-128;VDU[pos]=(RGB_YUV_TABLE[r+1280>>0]+RGB_YUV_TABLE[g+1536>>0]+RGB_YUV_TABLE[b+1792>>0]>>16)-128}DCY=processDU(YDU,fdtbl_Y,DCY,YDC_HT,YAC_HT);DCU=processDU(UDU,fdtbl_UV,DCU,UVDC_HT,UVAC_HT);DCV=processDU(VDU,fdtbl_UV,DCV,UVDC_HT,UVAC_HT);x+=32}y+=8}if(bytepos>=0){var fillbits=[];fillbits[1]=bytepos+1;fillbits[0]=(1<<bytepos+1)-1;writeBits(fillbits)}writeWord(65497);return new Buffer(byteout);var jpegDataUri="data:image/jpeg;base64,"+btoa(byteout.join(""));byteout=[];var duration=(new Date).getTime()-time_start;return jpegDataUri};function setQuality(quality){if(quality<=0){quality=1}if(quality>100){quality=100}if(currentQuality==quality)return;var sf=0;if(quality<50){sf=Math.floor(5e3/quality)}else{sf=Math.floor(200-quality*2)}initQuantTables(sf);currentQuality=quality}function init(){var time_start=(new Date).getTime();if(!quality)quality=50;initCharLookupTable();initHuffmanTbl();initCategoryNumber();initRGBYUVTable();setQuality(quality);var duration=(new Date).getTime()-time_start}init()}module.exports=encode;function encode(imgData,qu){if(typeof qu==="undefined")qu=50;var encoder=new JPEGEncoder(qu);var data=encoder.encode(imgData,qu);return{data:data,width:imgData.width,height:imgData.height}}function getImageDataFromImage(idOrElement){var theImg=typeof idOrElement=="string"?document.getElementById(idOrElement):idOrElement;var cvs=document.createElement("canvas");cvs.width=theImg.width;cvs.height=theImg.height;var ctx=cvs.getContext("2d");ctx.drawImage(theImg,0,0);return ctx.getImageData(0,0,cvs.width,cvs.height)}}).call(this,require("buffer").Buffer)},{buffer:19}],967:[function(require,module,exports){(function(Buffer){"use strict";var ContentStream=require("contentstream");var GifEncoder=require("gif-encoder");var jpegJs=require("jpeg-js");var PNG=require("pngjs-nozlib").PNG;var ndarray=require("ndarray");var ops=require("ndarray-ops");var through=require("through");function handleData(array,data,frame){var i,j,ptr=0,c;if(array.shape.length===4){return handleData(array.pick(frame),data,0)}else if(array.shape.length===3){if(array.shape[2]===3){ops.assign(ndarray(data,[array.shape[0],array.shape[1],3],[4,4*array.shape[0],1]),array);ops.assigns(ndarray(data,[array.shape[0]*array.shape[1]],[4],3),255)}else if(array.shape[2]===4){ops.assign(ndarray(data,[array.shape[0],array.shape[1],4],[4,array.shape[0]*4,1]),array)}else if(array.shape[2]===1){ops.assign(ndarray(data,[array.shape[0],array.shape[1],3],[4,4*array.shape[0],1]),ndarray(array.data,[array.shape[0],array.shape[1],3],[array.stride[0],array.stride[1],0],array.offset));ops.assigns(ndarray(data,[array.shape[0]*array.shape[1]],[4],3),255)}else{return new Error("Incompatible array shape")}}else if(array.shape.length===2){ops.assign(ndarray(data,[array.shape[0],array.shape[1],3],[4,4*array.shape[0],1]),ndarray(array.data,[array.shape[0],array.shape[1],3],[array.stride[0],array.stride[1],0],array.offset));ops.assigns(ndarray(data,[array.shape[0]*array.shape[1]],[4],3),255)}else{return new Error("Incompatible array shape")}return data}function haderror(err){var result=through();result.emit("error",err);return result}module.exports=function savePixels(array,type,options){options=options||{};switch(type.toUpperCase()){case"JPG":case".JPG":case"JPEG":case".JPEG":case"JPE":case".JPE":var width=array.shape[0];var height=array.shape[1];var data=new Buffer(width*height*4);data=handleData(array,data);var rawImageData={data:data,width:width,height:height};var jpegImageData=jpegJs.encode(rawImageData,options.quality);return new ContentStream(jpegImageData.data);case"GIF":case".GIF":var frames=array.shape.length===4?array.shape[0]:1;var width=array.shape.length===4?array.shape[1]:array.shape[0];var height=array.shape.length===4?array.shape[2]:array.shape[1];var data=new Buffer(width*height*4);var gif=new GifEncoder(width,height);gif.writeHeader();for(var i=0;i<frames;i++){data=handleData(array,data,i);gif.addFrame(data)}gif.finish();return gif;case"PNG":case".PNG":var png=new PNG({width:array.shape[0],height:array.shape[1]});var data=handleData(array,png.data);if(typeof data==="Error")return haderror(data);png.data=data;return png.pack();case"CANVAS":var canvas=document.createElement("canvas");var context=canvas.getContext("2d");canvas.width=array.shape[0];canvas.height=array.shape[1];var imageData=context.getImageData(0,0,canvas.width,canvas.height);var data=imageData.data;data=handleData(array,data);if(typeof data==="Error")return haderror(data);context.putImageData(imageData,0,0);return canvas;default:return haderror(new Error("Unsupported file type: "+type))}}}).call(this,require("buffer").Buffer)},{buffer:19,contentstream:23,"gif-encoder":428,"jpeg-js":964,ndarray:731,"ndarray-ops":728,"pngjs-nozlib":767,through:988}],968:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.ShelfPack=factory()})(this,function(){function ShelfPack(w,h,options){options=options||{};this.w=w||64;this.h=h||64;this.autoResize=!!options.autoResize;this.shelves=[];this.stats={};this.count=function(h){this.stats[h]=(this.stats[h]|0)+1}}ShelfPack.prototype.pack=function(bins,options){bins=[].concat(bins);options=options||{};var results=[],w,h,allocation;for(var i=0;i<bins.length;i++){w=bins[i].w||bins[i].width;h=bins[i].h||bins[i].height;if(w&&h){allocation=this.packOne(w,h);if(!allocation){continue}if(options.inPlace){bins[i].x=allocation.x;bins[i].y=allocation.y}results.push(allocation)}}if(this.shelves.length>0){var w2=0;var h2=0;for(var j=0;j<this.shelves.length;j++){var shelf=this.shelves[j];h2+=shelf.h;w2=Math.max(shelf.w-shelf.free,w2)}this.resize(w2,h2)}return results};ShelfPack.prototype.packOne=function(w,h){var y=0,best={shelf:-1,waste:Infinity},shelf,waste;for(var i=0;i<this.shelves.length;i++){shelf=this.shelves[i];y+=shelf.h;if(h===shelf.h&&w<=shelf.free){this.count(h);return shelf.alloc(w,h)}if(h>shelf.h||w>shelf.free){continue}if(h<shelf.h&&w<=shelf.free){waste=shelf.h-h;if(waste<best.waste){best.waste=waste;best.shelf=i}}}if(best.shelf!==-1){shelf=this.shelves[best.shelf];this.count(h);return shelf.alloc(w,h)}if(h<=this.h-y&&w<=this.w){shelf=new Shelf(y,this.w,h);this.shelves.push(shelf);this.count(h);return shelf.alloc(w,h)}if(this.autoResize){var h1,h2,w1,w2;h1=h2=this.h;w1=w2=this.w;if(w1<=h1||w>w1){w2=Math.max(w,w1)*2}if(h1<w1||h>h1){h2=Math.max(h,h1)*2}this.resize(w2,h2);return this.packOne(w,h)}return null};ShelfPack.prototype.clear=function(){this.shelves=[];this.stats={}};ShelfPack.prototype.resize=function(w,h){this.w=w;this.h=h;for(var i=0;i<this.shelves.length;i++){this.shelves[i].resize(w)}return true};function Shelf(y,w,h){this.x=0;this.y=y;this.w=this.free=w;this.h=h}Shelf.prototype.alloc=function(w,h){if(w>this.free||h>this.h){return null}var x=this.x;this.x+=w;this.free-=w;return{x:x,y:this.y,w:w,h:h,width:w,height:h}};Shelf.prototype.resize=function(w){this.free+=w-this.w;this.w=w;return true};return ShelfPack})},{}],969:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/readable.js");Stream.Writable=require("readable-stream/writable.js");Stream.Duplex=require("readable-stream/duplex.js");Stream.Transform=require("readable-stream/transform.js");Stream.PassThrough=require("readable-stream/passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:389,inherits:454,"readable-stream/duplex.js":971,"readable-stream/passthrough.js":978,"readable-stream/readable.js":979,"readable-stream/transform.js":980,"readable-stream/writable.js":981}],970:[function(require,module,exports){arguments[4][10][0].apply(exports,arguments)},{dup:10}],971:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":972}],972:[function(require,module,exports){arguments[4][12][0].apply(exports,arguments)},{"./_stream_readable":974,"./_stream_writable":976,"core-util-is":318,dup:12,inherits:454,"process-nextick-args":770}],973:[function(require,module,exports){"use strict";module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":975,"core-util-is":318,inherits:454}],974:[function(require,module,exports){arguments[4][13][0].apply(exports,arguments)},{"./_stream_duplex":972,"./internal/streams/BufferList":977,_process:11,buffer:19,"buffer-shims":18,"core-util-is":318,dup:13,events:389,inherits:454,isarray:970,"process-nextick-args":770,"string_decoder/":982,util:6}],975:[function(require,module,exports){arguments[4][14][0].apply(exports,arguments)},{"./_stream_duplex":972,"core-util-is":318,dup:14,inherits:454}],976:[function(require,module,exports){arguments[4][15][0].apply(exports,arguments)},{"./_stream_duplex":972,_process:11,buffer:19,"buffer-shims":18,"core-util-is":318,dup:15,events:389,inherits:454,"process-nextick-args":770,"util-deprecate":993}],977:[function(require,module,exports){arguments[4][16][0].apply(exports,arguments)},{buffer:19,"buffer-shims":18,dup:16}],978:[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":973}],979:[function(require,module,exports){(function(process){var Stream=function(){try{return require("st"+"ream")}catch(_){}}();exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=Stream||exports;exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js");if(!process.browser&&process.env.READABLE_STREAM==="disable"&&Stream){module.exports=Stream}}).call(this,require("_process"))},{"./lib/_stream_duplex.js":972,"./lib/_stream_passthrough.js":973,"./lib/_stream_readable.js":974,"./lib/_stream_transform.js":975,"./lib/_stream_writable.js":976,_process:11}],980:[function(require,module,exports){arguments[4][17][0].apply(exports,arguments)},{"./lib/_stream_transform.js":975,dup:17}],981:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":976}],982:[function(require,module,exports){var Buffer=require("buffer").Buffer;var isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding)){throw new Error("Unknown encoding: "+encoding)}}var StringDecoder=exports.StringDecoder=function(encoding){this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,"");assertEncoding(encoding);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return}this.charBuffer=new Buffer(6);this.charReceived=0;this.charLength=0};StringDecoder.prototype.write=function(buffer){
var charStr="";while(this.charLength){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,0,available);this.charReceived+=available;if(this.charReceived<this.charLength){return""}buffer=buffer.slice(available,buffer.length);charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=55296&&charCode<=56319){this.charLength+=this.surrogateSize;charStr="";continue}this.charReceived=this.charLength=0;if(buffer.length===0){return charStr}break}this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end);end-=this.charReceived}charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);buffer.copy(this.charBuffer,0,0,size);return charStr.substring(0,end)}return charStr};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i=buffer.length>=3?3:buffer.length;for(;i>0;i--){var c=buffer[buffer.length-i];if(i==1&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i};StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length)res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res};function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2;this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3;this.charLength=this.charReceived?3:0}},{buffer:19}],983:[function(require,module,exports){"use strict";var kdbush=require("kdbush");module.exports=supercluster;function supercluster(options){return new SuperCluster(options)}function SuperCluster(options){this.options=extend(Object.create(this.options),options);this.trees=new Array(this.options.maxZoom+1)}SuperCluster.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:false},load:function(points){var log=this.options.log;if(log)console.time("total time");var timerId="prepare "+points.length+" points";if(log)console.time(timerId);this.points=points;var clusters=points.map(createPointCluster);if(log)console.timeEnd(timerId);for(var z=this.options.maxZoom;z>=this.options.minZoom;z--){var now=+Date.now();this.trees[z+1]=kdbush(clusters,getX,getY,this.options.nodeSize,Float32Array);clusters=this._cluster(clusters,z);if(log)console.log("z%d: %d clusters in %dms",z,clusters.length,+Date.now()-now)}this.trees[this.options.minZoom]=kdbush(clusters,getX,getY,this.options.nodeSize,Float32Array);if(log)console.timeEnd("total time");return this},getClusters:function(bbox,zoom){var tree=this.trees[this._limitZoom(zoom)];var ids=tree.range(lngX(bbox[0]),latY(bbox[3]),lngX(bbox[2]),latY(bbox[1]));var clusters=[];for(var i=0;i<ids.length;i++){var c=tree.points[ids[i]];clusters.push(c.id!==-1?this.points[c.id]:getClusterJSON(c))}return clusters},getTile:function(z,x,y){var tree=this.trees[this._limitZoom(z)];var z2=Math.pow(2,z);var extent=this.options.extent;var r=this.options.radius;var p=r/extent;var top=(y-p)/z2;var bottom=(y+1+p)/z2;var tile={features:[]};this._addTileFeatures(tree.range((x-p)/z2,top,(x+1+p)/z2,bottom),tree.points,x,y,z2,tile);if(x===0){this._addTileFeatures(tree.range(1-p/z2,top,1,bottom),tree.points,z2,y,z2,tile)}if(x===z2-1){this._addTileFeatures(tree.range(0,top,p/z2,bottom),tree.points,-1,y,z2,tile)}return tile.features.length?tile:null},_addTileFeatures:function(ids,points,x,y,z2,tile){for(var i=0;i<ids.length;i++){var c=points[ids[i]];tile.features.push({type:1,geometry:[[Math.round(this.options.extent*(c.x*z2-x)),Math.round(this.options.extent*(c.y*z2-y))]],tags:c.id!==-1?this.points[c.id].properties:getClusterProperties(c)})}},_limitZoom:function(z){return Math.max(this.options.minZoom,Math.min(z,this.options.maxZoom+1))},_cluster:function(points,zoom){var clusters=[];var r=this.options.radius/(this.options.extent*Math.pow(2,zoom));for(var i=0;i<points.length;i++){var p=points[i];if(p.zoom<=zoom)continue;p.zoom=zoom;var tree=this.trees[zoom+1];var neighborIds=tree.within(p.x,p.y,r);var foundNeighbors=false;var numPoints=p.numPoints;var wx=p.x*numPoints;var wy=p.y*numPoints;for(var j=0;j<neighborIds.length;j++){var b=tree.points[neighborIds[j]];if(zoom<b.zoom){foundNeighbors=true;b.zoom=zoom;wx+=b.x*b.numPoints;wy+=b.y*b.numPoints;numPoints+=b.numPoints}}clusters.push(foundNeighbors?createCluster(wx/numPoints,wy/numPoints,numPoints,-1):p)}return clusters}};function createCluster(x,y,numPoints,id){return{x:x,y:y,zoom:Infinity,id:id,numPoints:numPoints}}function createPointCluster(p,i){var coords=p.geometry.coordinates;return createCluster(lngX(coords[0]),latY(coords[1]),1,i)}function getClusterJSON(cluster){return{type:"Feature",properties:getClusterProperties(cluster),geometry:{type:"Point",coordinates:[xLng(cluster.x),yLat(cluster.y)]}}}function getClusterProperties(cluster){var count=cluster.numPoints;var abbrev=count>=1e4?Math.round(count/1e3)+"k":count>=1e3?Math.round(count/100)/10+"k":count;return{cluster:true,point_count:count,point_count_abbreviated:abbrev}}function lngX(lng){return lng/360+.5}function latY(lat){var sin=Math.sin(lat*Math.PI/180),y=.5-.25*Math.log((1+sin)/(1-sin))/Math.PI;return y<0?0:y>1?1:y}function xLng(x){return(x-.5)*360}function yLat(y){var y2=(180-y*360)*Math.PI/180;return 360*Math.atan(Math.exp(y2))/Math.PI-90}function extend(dest,src){for(var id in src)dest[id]=src[id];return dest}function getX(p){return p.x}function getY(p){return p.y}},{kdbush:459}],984:[function(require,module,exports){"use strict";module.exports=function transform(props){var transform=[];if(Array.isArray(props)){props.forEach(function forEachAccessor(prop){var key=Object.keys(prop)[0];transform.push(key+"("+prop[key]+")")})}return transform.join(" ")}},{}],985:[function(require,module,exports){module.exports=require("./lib/index")},{"./lib/index":986}],986:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _ponyfill=require("./ponyfill");var _ponyfill2=_interopRequireDefault(_ponyfill);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var root;if(typeof self!=="undefined"){root=self}else if(typeof window!=="undefined"){root=window}else if(typeof global!=="undefined"){root=global}else if(typeof module!=="undefined"){root=module}else{root=Function("return this")()}var result=(0,_ponyfill2["default"])(root);exports["default"]=result}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ponyfill":987}],987:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=symbolObservablePonyfill;function symbolObservablePonyfill(root){var result;var _Symbol=root.Symbol;if(typeof _Symbol==="function"){if(_Symbol.observable){result=_Symbol.observable}else{result=_Symbol("observable");_Symbol.observable=result}}else{result="@@observable"}return result}},{}],988:[function(require,module,exports){(function(process){var Stream=require("stream");exports=module.exports=through;through.through=through;function through(write,end,opts){write=write||function(data){this.queue(data)};end=end||function(){this.queue(null)};var ended=false,destroyed=false,buffer=[],_ended=false;var stream=new Stream;stream.readable=stream.writable=true;stream.paused=false;stream.autoDestroy=!(opts&&opts.autoDestroy===false);stream.write=function(data){write.call(this,data);return!stream.paused};function drain(){while(buffer.length&&!stream.paused){var data=buffer.shift();if(null===data)return stream.emit("end");else stream.emit("data",data)}}stream.queue=stream.push=function(data){if(_ended)return stream;if(data===null)_ended=true;buffer.push(data);drain();return stream};stream.on("end",function(){stream.readable=false;if(!stream.writable&&stream.autoDestroy)process.nextTick(function(){stream.destroy()})});function _end(){stream.writable=false;end.call(stream);if(!stream.readable&&stream.autoDestroy)stream.destroy()}stream.end=function(data){if(ended)return;ended=true;if(arguments.length)stream.write(data);_end();return stream};stream.destroy=function(){if(destroyed)return;destroyed=true;ended=true;buffer.length=0;stream.writable=stream.readable=false;stream.emit("close");return stream};stream.pause=function(){if(stream.paused)return;stream.paused=true;return stream};stream.resume=function(){if(stream.paused){stream.paused=false;stream.emit("resume")}drain();if(!stream.paused)stream.emit("drain");return stream};return stream}}).call(this,require("_process"))},{_process:11,stream:969}],989:[function(require,module,exports){"use strict";module.exports=TinyQueue;function TinyQueue(data,compare){if(!(this instanceof TinyQueue))return new TinyQueue(data,compare);this.data=data||[];this.length=this.data.length;this.compare=compare||defaultCompare;if(data)for(var i=Math.floor(this.length/2);i>=0;i--)this._down(i)}function defaultCompare(a,b){return a<b?-1:a>b?1:0}TinyQueue.prototype={push:function(item){this.data.push(item);this.length++;this._up(this.length-1)},pop:function(){var top=this.data[0];this.data[0]=this.data[this.length-1];this.length--;this.data.pop();this._down(0);return top},peek:function(){return this.data[0]},_up:function(pos){var data=this.data,compare=this.compare;while(pos>0){var parent=Math.floor((pos-1)/2);if(compare(data[pos],data[parent])<0){swap(data,parent,pos);pos=parent}else break}},_down:function(pos){var data=this.data,compare=this.compare,len=this.length;while(true){var left=2*pos+1,right=left+1,min=pos;if(left<len&&compare(data[left],data[min])<0)min=left;if(right<len&&compare(data[right],data[min])<0)min=right;if(min===pos)return;swap(data,min,pos);pos=min}}};function swap(data,i,j){var tmp=data[i];data[i]=data[j];data[j]=tmp}},{}],990:[function(require,module,exports){(function(process){var TWEEN=TWEEN||function(){var _tweens=[];return{getAll:function(){return _tweens},removeAll:function(){_tweens=[]},add:function(tween){_tweens.push(tween)},remove:function(tween){var i=_tweens.indexOf(tween);if(i!==-1){_tweens.splice(i,1)}},update:function(time,preserve){if(_tweens.length===0){return false}var i=0;time=time!==undefined?time:TWEEN.now();while(i<_tweens.length){if(_tweens[i].update(time)||preserve){i++}else{_tweens.splice(i,1)}}return true}}}();(function(){if(this.window===undefined&&this.process!==undefined){TWEEN.now=function(){var time=process.hrtime();return time[0]*1e3+time[1]/1e3}}else if(this.window!==undefined&&window.performance!==undefined&&window.performance.now!==undefined){TWEEN.now=window.performance.now.bind(window.performance)}else if(Date.now!==undefined){TWEEN.now=Date.now}else{TWEEN.now=function(){return(new Date).getTime()}}})();TWEEN.Tween=function(object){var _object=object;var _valuesStart={};var _valuesEnd={};var _valuesStartRepeat={};var _duration=1e3;var _repeat=0;var _yoyo=false;var _isPlaying=false;var _reversed=false;var _delayTime=0;var _startTime=null;var _easingFunction=TWEEN.Easing.Linear.None;var _interpolationFunction=TWEEN.Interpolation.Linear;var _chainedTweens=[];var _onStartCallback=null;var _onStartCallbackFired=false;var _onUpdateCallback=null;var _onCompleteCallback=null;var _onStopCallback=null;for(var field in object){_valuesStart[field]=parseFloat(object[field],10)}this.to=function(properties,duration){if(duration!==undefined){_duration=duration}_valuesEnd=properties;return this};this.start=function(time){TWEEN.add(this);_isPlaying=true;_onStartCallbackFired=false;_startTime=time!==undefined?time:TWEEN.now();_startTime+=_delayTime;for(var property in _valuesEnd){if(_valuesEnd[property]instanceof Array){if(_valuesEnd[property].length===0){continue}_valuesEnd[property]=[_object[property]].concat(_valuesEnd[property])}if(_valuesStart[property]===undefined){continue}_valuesStart[property]=_object[property];if(_valuesStart[property]instanceof Array===false){_valuesStart[property]*=1}_valuesStartRepeat[property]=_valuesStart[property]||0}return this};this.stop=function(){if(!_isPlaying){return this}TWEEN.remove(this);_isPlaying=false;if(_onStopCallback!==null){_onStopCallback.call(_object)}this.stopChainedTweens();return this};this.stopChainedTweens=function(){for(var i=0,numChainedTweens=_chainedTweens.length;i<numChainedTweens;i++){_chainedTweens[i].stop()}};this.delay=function(amount){_delayTime=amount;return this};this.repeat=function(times){_repeat=times;return this};this.yoyo=function(yoyo){_yoyo=yoyo;return this};this.easing=function(easing){_easingFunction=easing;return this};this.interpolation=function(interpolation){_interpolationFunction=interpolation;return this};this.chain=function(){_chainedTweens=arguments;return this};this.onStart=function(callback){_onStartCallback=callback;return this};this.onUpdate=function(callback){_onUpdateCallback=callback;return this};this.onComplete=function(callback){_onCompleteCallback=callback;return this};this.onStop=function(callback){_onStopCallback=callback;return this};this.update=function(time){var property;var elapsed;var value;if(time<_startTime){return true}if(_onStartCallbackFired===false){if(_onStartCallback!==null){_onStartCallback.call(_object)}_onStartCallbackFired=true}elapsed=(time-_startTime)/_duration;elapsed=elapsed>1?1:elapsed;value=_easingFunction(elapsed);for(property in _valuesEnd){if(_valuesStart[property]===undefined){continue}var start=_valuesStart[property]||0;var end=_valuesEnd[property];if(end instanceof Array){_object[property]=_interpolationFunction(end,value)}else{if(typeof end==="string"){if(end.charAt(0)==="+"||end.charAt(0)==="-"){end=start+parseFloat(end,10)}else{end=parseFloat(end,10)}}if(typeof end==="number"){_object[property]=start+(end-start)*value}}}if(_onUpdateCallback!==null){_onUpdateCallback.call(_object,value)}if(elapsed===1){if(_repeat>0){if(isFinite(_repeat)){_repeat--}for(property in _valuesStartRepeat){if(typeof _valuesEnd[property]==="string"){_valuesStartRepeat[property]=_valuesStartRepeat[property]+parseFloat(_valuesEnd[property],10)}if(_yoyo){var tmp=_valuesStartRepeat[property];_valuesStartRepeat[property]=_valuesEnd[property];_valuesEnd[property]=tmp}_valuesStart[property]=_valuesStartRepeat[property]}if(_yoyo){_reversed=!_reversed}_startTime=time+_delayTime;return true}else{if(_onCompleteCallback!==null){_onCompleteCallback.call(_object)}for(var i=0,numChainedTweens=_chainedTweens.length;i<numChainedTweens;i++){_chainedTweens[i].start(_startTime+_duration)}return false}}return true}};TWEEN.Easing={Linear:{None:function(k){return k}},Quadratic:{In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){if((k*=2)<1){return.5*k*k}return-.5*(--k*(k-2)-1)}},Cubic:{In:function(k){return k*k*k},Out:function(k){return--k*k*k+1},InOut:function(k){if((k*=2)<1){return.5*k*k*k}return.5*((k-=2)*k*k+2)}},Quartic:{In:function(k){return k*k*k*k},Out:function(k){return 1- --k*k*k*k},InOut:function(k){if((k*=2)<1){return.5*k*k*k*k}return-.5*((k-=2)*k*k*k-2)}},Quintic:{In:function(k){return k*k*k*k*k},Out:function(k){return--k*k*k*k*k+1},InOut:function(k){if((k*=2)<1){return.5*k*k*k*k*k}return.5*((k-=2)*k*k*k*k+2)}},Sinusoidal:{In:function(k){return 1-Math.cos(k*Math.PI/2)},Out:function(k){return Math.sin(k*Math.PI/2)},InOut:function(k){return.5*(1-Math.cos(Math.PI*k))}},Exponential:{In:function(k){return k===0?0:Math.pow(1024,k-1)},Out:function(k){return k===1?1:1-Math.pow(2,-10*k)},InOut:function(k){if(k===0){return 0}if(k===1){return 1}if((k*=2)<1){return.5*Math.pow(1024,k-1)}return.5*(-Math.pow(2,-10*(k-1))+2)}},Circular:{In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1- --k*k)},InOut:function(k){if((k*=2)<1){return-.5*(Math.sqrt(1-k*k)-1)}return.5*(Math.sqrt(1-(k-=2)*k)+1)}},Elastic:{In:function(k){if(k===0){return 0}if(k===1){return 1}return-Math.pow(2,10*(k-1))*Math.sin((k-1.1)*5*Math.PI)},Out:function(k){if(k===0){return 0}if(k===1){return 1}return Math.pow(2,-10*k)*Math.sin((k-.1)*5*Math.PI)+1},InOut:function(k){if(k===0){return 0}if(k===1){return 1}k*=2;if(k<1){return-.5*Math.pow(2,10*(k-1))*Math.sin((k-1.1)*5*Math.PI)}return.5*Math.pow(2,-10*(k-1))*Math.sin((k-1.1)*5*Math.PI)+1}},Back:{In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function(k){var s=1.70158*1.525;if((k*=2)<1){return.5*(k*k*((s+1)*k-s))}return.5*((k-=2)*k*((s+1)*k+s)+2)}},Bounce:{In:function(k){return 1-TWEEN.Easing.Bounce.Out(1-k)},Out:function(k){if(k<1/2.75){return 7.5625*k*k}else if(k<2/2.75){return 7.5625*(k-=1.5/2.75)*k+.75}else if(k<2.5/2.75){return 7.5625*(k-=2.25/2.75)*k+.9375}else{return 7.5625*(k-=2.625/2.75)*k+.984375}},InOut:function(k){if(k<.5){return TWEEN.Easing.Bounce.In(k*2)*.5}return TWEEN.Easing.Bounce.Out(k*2-1)*.5+.5}}};TWEEN.Interpolation={Linear:function(v,k){var m=v.length-1;var f=m*k;var i=Math.floor(f);var fn=TWEEN.Interpolation.Utils.Linear;if(k<0){return fn(v[0],v[1],f)}if(k>1){return fn(v[m],v[m-1],m-f)}return fn(v[i],v[i+1>m?m:i+1],f-i)},Bezier:function(v,k){var b=0;var n=v.length-1;var pw=Math.pow;var bn=TWEEN.Interpolation.Utils.Bernstein;for(var i=0;i<=n;i++){b+=pw(1-k,n-i)*pw(k,i)*v[i]*bn(n,i)}return b},CatmullRom:function(v,k){var m=v.length-1;var f=m*k;var i=Math.floor(f);var fn=TWEEN.Interpolation.Utils.CatmullRom;if(v[0]===v[m]){if(k<0){i=Math.floor(f=m*(1+k))}return fn(v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m],f-i)}else{if(k<0){return v[0]-(fn(v[0],v[0],v[1],v[1],-f)-v[0])}if(k>1){return v[m]-(fn(v[m],v[m],v[m-1],v[m-1],f-m)-v[m])}return fn(v[i?i-1:0],v[i],v[m<i+1?m:i+1],v[m<i+2?m:i+2],f-i)}},Utils:{Linear:function(p0,p1,t){return(p1-p0)*t+p0},Bernstein:function(n,i){var fc=TWEEN.Interpolation.Utils.Factorial;return fc(n)/fc(i)/fc(n-i)},Factorial:function(){var a=[1];return function(n){var s=1;if(a[n]){return a[n]}for(var i=n;i>1;i--){s*=i}a[n]=s;return s}}(),CatmullRom:function(p0,p1,p2,p3,t){var v0=(p2-p0)*.5;var v1=(p3-p1)*.5;var t2=t*t;var t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}}};(function(root){if(typeof define==="function"&&define.amd){define([],function(){return TWEEN})}else if(typeof module!=="undefined"&&typeof exports==="object"){module.exports=TWEEN}else if(root!==undefined){root.TWEEN=TWEEN}})(this)}).call(this,require("_process"))},{_process:11}],991:[function(require,module,exports){"use strict";function unique_pred(list,compare){var ptr=1,len=list.length,a=list[0],b=list[0];for(var i=1;i<len;++i){b=a;a=list[i];if(compare(a,b)){if(i===ptr){ptr++;continue}list[ptr++]=a}}list.length=ptr;return list}function unique_eq(list){var ptr=1,len=list.length,a=list[0],b=list[0];for(var i=1;i<len;++i,b=a){b=a;a=list[i];if(a!==b){if(i===ptr){ptr++;continue}list[ptr++]=a}}list.length=ptr;return list}function unique(list,compare,sorted){if(list.length===0){return list}if(compare){if(!sorted){list.sort(compare)}return unique_pred(list,compare)}if(!sorted){list.sort()}return unique_eq(list)}module.exports=unique},{}],992:[function(require,module,exports){module.exports=UnitBezier;function UnitBezier(p1x,p1y,p2x,p2y){this.cx=3*p1x;this.bx=3*(p2x-p1x)-this.cx;this.ax=1-this.cx-this.bx;this.cy=3*p1y;this.by=3*(p2y-p1y)-this.cy;this.ay=1-this.cy-this.by;this.p1x=p1x;this.p1y=p2y;this.p2x=p2x;this.p2y=p2y}UnitBezier.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t};UnitBezier.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t};UnitBezier.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx};UnitBezier.prototype.solveCurveX=function(x,epsilon){if(typeof epsilon==="undefined")epsilon=1e-6;var t0,t1,t2,x2,i;for(t2=x,i=0;i<8;i++){x2=this.sampleCurveX(t2)-x;if(Math.abs(x2)<epsilon)return t2;var d2=this.sampleCurveDerivativeX(t2);if(Math.abs(d2)<1e-6)break;t2=t2-x2/d2}t0=0;t1=1;t2=x;if(t2<t0)return t0;if(t2>t1)return t1;while(t0<t1){x2=this.sampleCurveX(t2);if(Math.abs(x2-x)<epsilon)return t2;if(x>x2){t0=t2}else{t1=t2}t2=(t1-t0)*.5+t0}return t2};UnitBezier.prototype.solve=function(x,epsilon){return this.sampleCurveY(this.solveCurveX(x,epsilon))}},{}],993:[function(require,module,exports){(function(global){module.exports=deprecate;function deprecate(fn,msg){if(config("noDeprecation")){return fn}var warned=false;function deprecated(){if(!warned){if(config("throwDeprecation")){throw new Error(msg)}else if(config("traceDeprecation")){console.trace(msg)}else{console.warn(msg)}warned=true}return fn.apply(this,arguments)}return deprecated}function config(name){try{if(!global.localStorage)return false}catch(_){return false}var val=global.localStorage[name];if(null==val)return false;return String(val).toLowerCase()==="true"}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],994:[function(require,module,exports){arguments[4][454][0].apply(exports,arguments)},{dup:454}],995:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],996:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":995,_process:11,inherits:994}],997:[function(require,module,exports){module.exports.VectorTile=require("./lib/vectortile.js");module.exports.VectorTileFeature=require("./lib/vectortilefeature.js");module.exports.VectorTileLayer=require("./lib/vectortilelayer.js")},{"./lib/vectortile.js":998,"./lib/vectortilefeature.js":999,"./lib/vectortilelayer.js":1e3}],998:[function(require,module,exports){"use strict";var VectorTileLayer=require("./vectortilelayer");module.exports=VectorTile;function VectorTile(pbf,end){this.layers=pbf.readFields(readTile,{},end)}function readTile(tag,layers,pbf){if(tag===3){var layer=new VectorTileLayer(pbf,pbf.readVarint()+pbf.pos);if(layer.length)layers[layer.name]=layer}}},{"./vectortilelayer":1e3}],999:[function(require,module,exports){"use strict";var Point=require("point-geometry");module.exports=VectorTileFeature;function VectorTileFeature(pbf,end,extent,keys,values){this.properties={};this.extent=extent;this.type=0;this._pbf=pbf;this._geometry=-1;this._keys=keys;this._values=values;pbf.readFields(readFeature,this,end)}function readFeature(tag,feature,pbf){if(tag==1)feature.id=pbf.readVarint();else if(tag==2)readTag(pbf,feature);else if(tag==3)feature.type=pbf.readVarint();else if(tag==4)feature._geometry=pbf.pos;
}function readTag(pbf,feature){var end=pbf.readVarint()+pbf.pos;while(pbf.pos<end){var key=feature._keys[pbf.readVarint()],value=feature._values[pbf.readVarint()];feature.properties[key]=value}}VectorTileFeature.types=["Unknown","Point","LineString","Polygon"];VectorTileFeature.prototype.loadGeometry=function(){var pbf=this._pbf;pbf.pos=this._geometry;var end=pbf.readVarint()+pbf.pos,cmd=1,length=0,x=0,y=0,lines=[],line;while(pbf.pos<end){if(!length){var cmdLen=pbf.readVarint();cmd=cmdLen&7;length=cmdLen>>3}length--;if(cmd===1||cmd===2){x+=pbf.readSVarint();y+=pbf.readSVarint();if(cmd===1){if(line)lines.push(line);line=[]}line.push(new Point(x,y))}else if(cmd===7){if(line){line.push(line[0].clone())}}else{throw new Error("unknown command "+cmd)}}if(line)lines.push(line);return lines};VectorTileFeature.prototype.bbox=function(){var pbf=this._pbf;pbf.pos=this._geometry;var end=pbf.readVarint()+pbf.pos,cmd=1,length=0,x=0,y=0,x1=Infinity,x2=-Infinity,y1=Infinity,y2=-Infinity;while(pbf.pos<end){if(!length){var cmdLen=pbf.readVarint();cmd=cmdLen&7;length=cmdLen>>3}length--;if(cmd===1||cmd===2){x+=pbf.readSVarint();y+=pbf.readSVarint();if(x<x1)x1=x;if(x>x2)x2=x;if(y<y1)y1=y;if(y>y2)y2=y}else if(cmd!==7){throw new Error("unknown command "+cmd)}}return[x1,y1,x2,y2]};VectorTileFeature.prototype.toGeoJSON=function(x,y,z){var size=this.extent*Math.pow(2,z),x0=this.extent*x,y0=this.extent*y,coords=this.loadGeometry(),type=VectorTileFeature.types[this.type],i,j;function project(line){for(var j=0;j<line.length;j++){var p=line[j],y2=180-(p.y+y0)*360/size;line[j]=[(p.x+x0)*360/size-180,360/Math.PI*Math.atan(Math.exp(y2*Math.PI/180))-90]}}switch(this.type){case 1:var points=[];for(i=0;i<coords.length;i++){points[i]=coords[i][0]}coords=points;project(coords);break;case 2:for(i=0;i<coords.length;i++){project(coords[i])}break;case 3:coords=classifyRings(coords);for(i=0;i<coords.length;i++){for(j=0;j<coords[i].length;j++){project(coords[i][j])}}break}if(coords.length===1){coords=coords[0]}else{type="Multi"+type}var result={type:"Feature",geometry:{type:type,coordinates:coords},properties:this.properties};if("id"in this){result.id=this.id}return result};function classifyRings(rings){var len=rings.length;if(len<=1)return[rings];var polygons=[],polygon,ccw;for(var i=0;i<len;i++){var area=signedArea(rings[i]);if(area===0)continue;if(ccw===undefined)ccw=area<0;if(ccw===area<0){if(polygon)polygons.push(polygon);polygon=[rings[i]]}else{polygon.push(rings[i])}}if(polygon)polygons.push(polygon);return polygons}function signedArea(ring){var sum=0;for(var i=0,len=ring.length,j=len-1,p1,p2;i<len;j=i++){p1=ring[i];p2=ring[j];sum+=(p2.x-p1.x)*(p1.y+p2.y)}return sum}},{"point-geometry":769}],1e3:[function(require,module,exports){"use strict";var VectorTileFeature=require("./vectortilefeature.js");module.exports=VectorTileLayer;function VectorTileLayer(pbf,end){this.version=1;this.name=null;this.extent=4096;this.length=0;this._pbf=pbf;this._keys=[];this._values=[];this._features=[];pbf.readFields(readLayer,this,end);this.length=this._features.length}function readLayer(tag,layer,pbf){if(tag===15)layer.version=pbf.readVarint();else if(tag===1)layer.name=pbf.readString();else if(tag===5)layer.extent=pbf.readVarint();else if(tag===2)layer._features.push(pbf.pos);else if(tag===3)layer._keys.push(pbf.readString());else if(tag===4)layer._values.push(readValueMessage(pbf))}function readValueMessage(pbf){var value=null,end=pbf.readVarint()+pbf.pos;while(pbf.pos<end){var tag=pbf.readVarint()>>3;value=tag===1?pbf.readString():tag===2?pbf.readFloat():tag===3?pbf.readDouble():tag===4?pbf.readVarint64():tag===5?pbf.readVarint():tag===6?pbf.readSVarint():tag===7?pbf.readBoolean():null}return value}VectorTileLayer.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var end=this._pbf.readVarint()+this._pbf.pos;return new VectorTileFeature(this._pbf,end,this.extent,this._keys,this._values)}},{"./vectortilefeature.js":999}],1001:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.COORDINATE_SYSTEM=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class;var _glMatrix=require("gl-matrix");var _autobindDecorator=require("autobind-decorator");var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}var PI=Math.PI;var PI_4=PI/4;var DEGREES_TO_RADIANS=PI/180;var RADIANS_TO_DEGREES=180/PI;var TILE_SIZE=512;var WORLD_SCALE=TILE_SIZE/(2*PI);var DEFAULT_MAP_STATE={latitude:37,longitude:-122,zoom:11,pitch:0,bearing:0,altitude:1.5};var COORDINATE_SYSTEM=exports.COORDINATE_SYSTEM={LNGLAT:1,METERS:2,IDENTITY:0};var Viewport=(_class=function(){function Viewport(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},width=_ref.width,height=_ref.height,latitude=_ref.latitude,longitude=_ref.longitude,zoom=_ref.zoom,pitch=_ref.pitch,bearing=_ref.bearing,altitude=_ref.altitude,mercatorEnabled=_ref.mercatorEnabled;_classCallCheck(this,Viewport);this.width=width!==undefined?width:DEFAULT_MAP_STATE.width;this.height=height!==undefined?height:DEFAULT_MAP_STATE.height;this.zoom=zoom!==undefined?zoom:DEFAULT_MAP_STATE.zoom;this.latitude=latitude!==undefined?latitude:DEFAULT_MAP_STATE.latitude;this.longitude=longitude!==undefined?longitude:DEFAULT_MAP_STATE.longitude;this.bearing=bearing!==undefined?bearing:DEFAULT_MAP_STATE.bearing;this.pitch=pitch!==undefined?pitch:DEFAULT_MAP_STATE.pitch;this.altitude=altitude!==undefined?altitude:DEFAULT_MAP_STATE.altitude;this.mercatorEnabled=mercatorEnabled!==undefined?mercatorEnabled:true;this.width=this.width||1;this.height=this.height||1;this._initialize()}_createClass(Viewport,[{key:"project",value:function project(lngLatZ){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref2$topLeft=_ref2.topLeft,topLeft=_ref2$topLeft===undefined?true:_ref2$topLeft;var _ref3=this.mercatorEnabled||this.mercator?this.projectFlat(lngLatZ):lngLatZ,_ref4=_slicedToArray(_ref3,2),X=_ref4[0],Y=_ref4[1];var v=[X,Y,lngLatZ[2]||0,1];_glMatrix.vec4.transformMat4(v,v,this.pixelProjectionMatrix);var scale=1/v[3];_glMatrix.vec4.multiply(v,v,[scale,scale,scale,scale]);var x=v[0],y=v[1],z=v[2];var y2=topLeft?this.height-y:y;return lngLatZ.length===2?[x,y2]:[x,y2,z]}},{key:"unproject",value:function unproject(xyz){var _ref5=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref5$topLeft=_ref5.topLeft,topLeft=_ref5$topLeft===undefined?true:_ref5$topLeft;return xyz.length===3?this.unproject3d(xyz,{topLeft:topLeft}):this.unproject2d(xyz,{topLeft:topLeft})}},{key:"unproject3d",value:function unproject3d(xyz){var _ref6=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref6$topLeft=_ref6.topLeft,topLeft=_ref6$topLeft===undefined?true:_ref6$topLeft;var _xyz=_slicedToArray(xyz,3),_xyz$=_xyz[0],x=_xyz$===undefined?0:_xyz$,_xyz$2=_xyz[1],y=_xyz$2===undefined?0:_xyz$2,_xyz$3=_xyz[2],z=_xyz$3===undefined?0:_xyz$3;var y2=topLeft?this.height-y:y;var v=[x,y2,z,1];_glMatrix.vec4.transformMat4(v,v,this.pixelUnprojectionMatrix);var scale=1/v[3];_glMatrix.vec4.multiply(v,v,[scale,scale,scale,scale]);var _unprojectFlat=this.unprojectFlat(v),_unprojectFlat2=_slicedToArray(_unprojectFlat,2),x0=_unprojectFlat2[0],y0=_unprojectFlat2[1];var z0=v[2];return[x0,y0,z0]}},{key:"unproject2d",value:function unproject2d(xy){var _ref7=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref7$topLeft=_ref7.topLeft,topLeft=_ref7$topLeft===undefined?true:_ref7$topLeft;var _xy=_slicedToArray(xy,2),_xy$=_xy[0],x=_xy$===undefined?0:_xy$,_xy$2=_xy[1],y=_xy$2===undefined?0:_xy$2;var y2=topLeft?this.height-y:y;var targetZ=0;var coord0=[x,y2,0,1];var coord1=[x,y2,1,1];_glMatrix.vec4.transformMat4(coord0,coord0,this.pixelUnprojectionMatrix);_glMatrix.vec4.transformMat4(coord1,coord1,this.pixelUnprojectionMatrix);var _ref8=[coord0[3],coord1[3]],w0=_ref8[0],w1=_ref8[1];var x0=coord0[0]/w0,x1=coord1[0]/w1;var y0=coord0[1]/w0,y1=coord1[1]/w1;var z0=coord0[2]/w0,z1=coord1[2]/w1;var t=z0===z1?0:(targetZ-z0)/(z1-z0);var X=x0*(1-t)+x1*t;var Y=y0*(1-t)+y1*t;return this.unprojectFlat([X,Y])}},{key:"projectFlat",value:function projectFlat(_ref9){var _ref10=_slicedToArray(_ref9,2),lng=_ref10[0],lat=_ref10[1];var scale=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.scale;scale=scale*WORLD_SCALE;var lambda2=lng*DEGREES_TO_RADIANS;var phi2=lat*DEGREES_TO_RADIANS;var x=scale*(lambda2+PI);var y=scale*(PI-Math.log(Math.tan(PI_4+phi2*.5)));return[x,y]}},{key:"unprojectFlat",value:function unprojectFlat(_ref11){var _ref12=_slicedToArray(_ref11,2),x=_ref12[0],y=_ref12[1];var scale=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.scale;scale=scale*WORLD_SCALE;var lambda2=x/scale-PI;var phi2=2*(Math.atan(Math.exp(PI-y/scale))-PI_4);return[lambda2*RADIANS_TO_DEGREES,phi2*RADIANS_TO_DEGREES]}},{key:"getProjections",value:function getProjections(){return{pixelProjectionMatrix:this.pixelProjectionMatrix,pixelUnprojectionMatrix:this.pixelUnprojectionMatrix,viewProjectionMatrix:this.viewProjectionMatrix,viewMatrix:this.viewMatrix,projectionMatrix:this.projectionMatrix}}},{key:"getDistanceScales",value:function getDistanceScales(){return{pixelsPerMeter:this.pixelsPerMeter,metersPerPixel:this.metersPerPixel}}},{key:"_initialize",value:function _initialize(){this.scale=Math.pow(2,this.zoom);this.worldSize=TILE_SIZE*this.scale;this.tileZoom=Math.floor(this.zoom);this.zoomFraction=this.zoom-Math.floor(this.zoom);this.bearingRadians=this.bearing/180*Math.PI;this.bearingRotationMatrix=_glMatrix.mat2.create();_glMatrix.mat2.rotate(this.bearingRotationMatrix,this.bearingRotationMatrix,this.bearing);this.originalPitch=this.pitch;this.pitch=Math.min(60,this.pitch);this.pitchRadians=this.pitch/180*Math.PI;this.originalAltitude=this.altitude;this.altitude=Math.max(.75,this.altitude);this.center=this.projectFlat([this.longitude,this.latitude]);this.centerX=this.center[0];this.centerY=this.center[1];this.halfFov=Math.atan(.5/this.altitude);this.topHalfSurfaceDistance=Math.sin(this.halfFov)*this.altitude/Math.sin(Math.PI/2-this.pitchRadians-this.halfFov);this.farZ=Math.cos(Math.PI/2-this.pitchRadians)*this.topHalfSurfaceDistance+this.altitude;this._calculateDistanceScales();this._calculateTransformationMatrices()}},{key:"_calculateDistanceScales",value:function _calculateDistanceScales(){var METERS_PER_DEGREE=111e3;var latitude=this.latitude,longitude=this.longitude;var latCosine=Math.cos(latitude*Math.PI/180);var metersPerDegree=METERS_PER_DEGREE*latCosine;var pixelsPerDegreeX=_glMatrix.vec2.distance(this.projectFlat([longitude+.5,latitude]),this.projectFlat([longitude-.5,latitude]));var pixelsPerDegreeY=_glMatrix.vec2.distance(this.projectFlat([longitude,latitude+.5]),this.projectFlat([longitude,latitude-.5]));var pixelsPerMeterX=pixelsPerDegreeX/metersPerDegree;var pixelsPerMeterY=pixelsPerDegreeY/metersPerDegree;var pixelsPerMeterZ=(pixelsPerMeterX+pixelsPerMeterY)/2;var altPixelsPerMeter=this.worldSize/(4e7*latCosine);var pixelsPerMeter=[altPixelsPerMeter,altPixelsPerMeter,altPixelsPerMeter];var metersPerPixel=[1/pixelsPerMeterX,1/pixelsPerMeterY,1/pixelsPerMeterZ];this.pixelsPerMeter=pixelsPerMeter;this.metersPerPixel=metersPerPixel}},{key:"_calculateTransformationMatrices",value:function _calculateTransformationMatrices(){this.projectionMatrix=_glMatrix.mat4.perspective(this._createMat4(),2*Math.atan(this.height/2/this.altitude),this.width/this.height,.1,this.farZ*10);var vm=this._createMat4();_glMatrix.mat4.translate(vm,vm,[0,0,-this.altitude]);_glMatrix.mat4.scale(vm,vm,[1,-1,1/this.height]);_glMatrix.mat4.rotateX(vm,vm,this.pitchRadians);_glMatrix.mat4.rotateZ(vm,vm,-this.bearingRadians);this.viewMatrix=this._createMat4();_glMatrix.mat4.translate(this.viewMatrix,vm,[-this.centerX,-this.centerY,0]);var vpm=this._createMat4();_glMatrix.mat4.multiply(vpm,vpm,this.projectionMatrix);_glMatrix.mat4.multiply(vpm,vpm,this.viewMatrix);this.viewProjectionMatrix=vpm;var m=this._createMat4();_glMatrix.mat4.scale(m,m,[this.width,this.height,1]);_glMatrix.mat4.translate(m,m,[.5,.5,0]);_glMatrix.mat4.scale(m,m,[.5,.5,1]);_glMatrix.mat4.multiply(m,m,this.viewProjectionMatrix);this.pixelProjectionMatrix=m;var mInverse=this._createMat4();_glMatrix.mat4.invert(mInverse,m);this.pixelUnprojectionMatrix=mInverse}},{key:"_calculatePixelProjectionMatrices",value:function _calculatePixelProjectionMatrices(){var m=this._createMat4();_glMatrix.mat4.scale(m,m,[this.width,this.height,1]);_glMatrix.mat4.translate(m,m,[.5,.5,0]);_glMatrix.mat4.scale(m,m,[.5,.5,0]);_glMatrix.mat4.multiply(m,m,this.viewProjectionMatrix);this.pixelProjectionMatrix=m;var mInverse=this._createMat4();_glMatrix.mat4.invert(mInverse,m);this.pixelUnprojectionMatrix=mInverse}},{key:"_createMat4",value:function _createMat4(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}}]);return Viewport}(),_applyDecoratedDescriptor(_class.prototype,"project",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"project"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"unproject",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"unproject"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"unproject3d",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"unproject3d"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"unproject2d",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"unproject2d"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"projectFlat",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"projectFlat"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"unprojectFlat",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"unprojectFlat"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"getProjections",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"getProjections"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"getDistanceScales",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"getDistanceScales"),_class.prototype),_class);exports.default=Viewport},{"autobind-decorator":3,"gl-matrix":438}],1002:[function(require,module,exports){module.exports=require("./dist/perspective-viewport")},{"./dist/perspective-viewport":1001}],1003:[function(require,module,exports){var Pbf=require("pbf");var vtpb=require("./vector-tile-pb");var GeoJSONWrapper=require("./lib/geojson_wrapper");module.exports=fromVectorTileJs;module.exports.fromVectorTileJs=fromVectorTileJs;module.exports.fromGeojsonVt=fromGeojsonVt;module.exports.GeoJSONWrapper=GeoJSONWrapper;function fromVectorTileJs(tile){var layers=[];for(var l in tile.layers){layers.push(prepareLayer(tile.layers[l]))}var out=new Pbf;vtpb.tile.write({layers:layers},out);return out.finish()}function fromGeojsonVt(layers){var l={};for(var k in layers){l[k]=new GeoJSONWrapper(layers[k].features);l[k].name=k}return fromVectorTileJs({layers:l})}function prepareLayer(layer){var preparedLayer={name:layer.name||"",version:layer.version||1,extent:layer.extent||4096,keys:[],values:[],features:[]};var keycache={};var valuecache={};for(var i=0;i<layer.length;i++){var feature=layer.feature(i);feature.geometry=encodeGeometry(feature.loadGeometry());var tags=[];for(var key in feature.properties){var keyIndex=keycache[key];if(typeof keyIndex==="undefined"){preparedLayer.keys.push(key);keyIndex=preparedLayer.keys.length-1;keycache[key]=keyIndex}var value=wrapValue(feature.properties[key]);var valueIndex=valuecache[value.key];if(typeof valueIndex==="undefined"){preparedLayer.values.push(value);valueIndex=preparedLayer.values.length-1;valuecache[value.key]=valueIndex}tags.push(keyIndex);tags.push(valueIndex)}feature.tags=tags;preparedLayer.features.push(feature)}return preparedLayer}function command(cmd,length){return(length<<3)+(cmd&7)}function zigzag(num){return num<<1^num>>31}function encodeGeometry(geometry){var encoded=[];var x=0;var y=0;var rings=geometry.length;for(var r=0;r<rings;r++){var ring=geometry[r];encoded.push(command(1,1));for(var i=0;i<ring.length;i++){if(i===1){encoded.push(command(2,ring.length-1))}var dx=ring[i].x-x;var dy=ring[i].y-y;encoded.push(zigzag(dx),zigzag(dy));x+=dx;y+=dy}}return encoded}function wrapValue(value){var result;var type=typeof value;if(type==="string"){result={string_value:value}}else if(type==="boolean"){result={bool_value:value}}else if(type==="number"){if(value%1!==0){result={double_value:value}}else if(value<0){result={sint_value:value}}else{result={uint_value:value}}}else{value=JSON.stringify(value);result={string_value:value}}result.key=type+":"+value;return result}},{"./lib/geojson_wrapper":1004,"./vector-tile-pb":1005,pbf:747}],1004:[function(require,module,exports){"use strict";var Point=require("point-geometry");var VectorTileFeature=require("vector-tile").VectorTileFeature;module.exports=GeoJSONWrapper;function GeoJSONWrapper(features){this.features=features;this.length=features.length}GeoJSONWrapper.prototype.feature=function(i){return new FeatureWrapper(this.features[i])};function FeatureWrapper(feature){this.id=typeof feature.id==="number"?feature.id:undefined;this.type=feature.type;this.rawGeometry=feature.type===1?[feature.geometry]:feature.geometry;this.properties=feature.tags;this.extent=4096}FeatureWrapper.prototype.loadGeometry=function(){var rings=this.rawGeometry;this.geometry=[];for(var i=0;i<rings.length;i++){var ring=rings[i];var newRing=[];for(var j=0;j<ring.length;j++){newRing.push(new Point(ring[j][0],ring[j][1]))}this.geometry.push(newRing)}return this.geometry};FeatureWrapper.prototype.bbox=function(){if(!this.geometry)this.loadGeometry();var rings=this.geometry;var x1=Infinity;var x2=-Infinity;var y1=Infinity;var y2=-Infinity;for(var i=0;i<rings.length;i++){var ring=rings[i];for(var j=0;j<ring.length;j++){var coord=ring[j];x1=Math.min(x1,coord.x);x2=Math.max(x2,coord.x);y1=Math.min(y1,coord.y);y2=Math.max(y2,coord.y)}}return[x1,y1,x2,y2]};FeatureWrapper.prototype.toGeoJSON=VectorTileFeature.prototype.toGeoJSON},{"point-geometry":769,"vector-tile":997}],1005:[function(require,module,exports){"use strict";var tile=exports.tile={read:readTile,write:writeTile};tile.GeomType={Unknown:0,Point:1,LineString:2,Polygon:3};function readTile(pbf,end){return pbf.readFields(readTileField,{layers:[]},end)}function readTileField(tag,tile,pbf){if(tag===3)tile.layers.push(readLayer(pbf,pbf.readVarint()+pbf.pos))}function writeTile(tile,pbf){var i;if(tile.layers!==undefined)for(i=0;i<tile.layers.length;i++)pbf.writeMessage(3,writeLayer,tile.layers[i])}tile.value={read:readValue,write:writeValue};function readValue(pbf,end){return pbf.readFields(readValueField,{},end)}function readValueField(tag,value,pbf){if(tag===1)value.string_value=pbf.readString();else if(tag===2)value.float_value=pbf.readFloat();else if(tag===3)value.double_value=pbf.readDouble();else if(tag===4)value.int_value=pbf.readVarint();else if(tag===5)value.uint_value=pbf.readVarint();else if(tag===6)value.sint_value=pbf.readSVarint();else if(tag===7)value.bool_value=pbf.readBoolean()}function writeValue(value,pbf){if(value.string_value!==undefined)pbf.writeStringField(1,value.string_value);if(value.float_value!==undefined)pbf.writeFloatField(2,value.float_value);if(value.double_value!==undefined)pbf.writeDoubleField(3,value.double_value);if(value.int_value!==undefined)pbf.writeVarintField(4,value.int_value);if(value.uint_value!==undefined)pbf.writeVarintField(5,value.uint_value);if(value.sint_value!==undefined)pbf.writeSVarintField(6,value.sint_value);if(value.bool_value!==undefined)pbf.writeBooleanField(7,value.bool_value)}tile.feature={read:readFeature,write:writeFeature};function readFeature(pbf,end){var feature=pbf.readFields(readFeatureField,{},end);if(feature.type===undefined)feature.type="Unknown";return feature}function readFeatureField(tag,feature,pbf){if(tag===1)feature.id=pbf.readVarint();else if(tag===2)feature.tags=pbf.readPackedVarint();else if(tag===3)feature.type=pbf.readVarint();else if(tag===4)feature.geometry=pbf.readPackedVarint()}function writeFeature(feature,pbf){if(feature.id!==undefined)pbf.writeVarintField(1,feature.id);if(feature.tags!==undefined)pbf.writePackedVarint(2,feature.tags);if(feature.type!==undefined)pbf.writeVarintField(3,feature.type);if(feature.geometry!==undefined)pbf.writePackedVarint(4,feature.geometry)}tile.layer={read:readLayer,write:writeLayer};function readLayer(pbf,end){return pbf.readFields(readLayerField,{features:[],keys:[],values:[]},end)}function readLayerField(tag,layer,pbf){if(tag===15)layer.version=pbf.readVarint();else if(tag===1)layer.name=pbf.readString();else if(tag===2)layer.features.push(readFeature(pbf,pbf.readVarint()+pbf.pos));else if(tag===3)layer.keys.push(pbf.readString());else if(tag===4)layer.values.push(readValue(pbf,pbf.readVarint()+pbf.pos));else if(tag===5)layer.extent=pbf.readVarint()}function writeLayer(layer,pbf){if(layer.version!==undefined)pbf.writeVarintField(15,layer.version);if(layer.name!==undefined)pbf.writeStringField(1,layer.name);var i;if(layer.features!==undefined)for(i=0;i<layer.features.length;i++)pbf.writeMessage(2,writeFeature,layer.features[i]);if(layer.keys!==undefined)for(i=0;i<layer.keys.length;i++)pbf.writeStringField(3,layer.keys[i]);if(layer.values!==undefined)for(i=0;i<layer.values.length;i++)pbf.writeMessage(4,writeValue,layer.values[i]);if(layer.extent!==undefined)pbf.writeVarintField(5,layer.extent)}},{}],1006:[function(require,module,exports){(function(global){WebGLDebugUtils=function(){if(typeof window=="undefined"){window=global}var log=function(msg){if(window.console&&window.console.log){window.console.log(msg)}};var error=function(msg){if(window.console&&window.console.error){window.console.error(msg)}else{log(msg)}};var glValidEnumContexts={enable:{1:{0:true}},disable:{1:{0:true}},getParameter:{1:{0:true}},drawArrays:{3:{0:true}},drawElements:{4:{0:true,2:true}},createShader:{1:{0:true}},getShaderParameter:{2:{1:true}},getProgramParameter:{2:{1:true}},getShaderPrecisionFormat:{2:{0:true,1:true}},getVertexAttrib:{2:{1:true}},vertexAttribPointer:{6:{2:true}},bindTexture:{2:{0:true}},activeTexture:{1:{0:true}},getTexParameter:{2:{0:true,1:true}},texParameterf:{3:{0:true,1:true}},texParameteri:{3:{0:true,1:true,2:true}},texImage2D:{9:{0:true,2:true,6:true,7:true},6:{0:true,2:true,3:true,4:true}},texSubImage2D:{9:{0:true,6:true,7:true},7:{0:true,4:true,5:true}},copyTexImage2D:{8:{0:true,2:true}},copyTexSubImage2D:{8:{0:true}},generateMipmap:{1:{0:true}},compressedTexImage2D:{7:{0:true,2:true}},compressedTexSubImage2D:{8:{0:true,6:true}},bindBuffer:{2:{0:true}},bufferData:{3:{0:true,2:true}},bufferSubData:{3:{0:true}},getBufferParameter:{2:{0:true,1:true}},pixelStorei:{2:{0:true,1:true}},readPixels:{7:{4:true,5:true}},bindRenderbuffer:{2:{0:true}},bindFramebuffer:{2:{0:true}},checkFramebufferStatus:{1:{0:true}},framebufferRenderbuffer:{4:{0:true,1:true,2:true}},framebufferTexture2D:{5:{0:true,1:true,2:true}},getFramebufferAttachmentParameter:{3:{0:true,1:true,2:true}},getRenderbufferParameter:{2:{0:true,1:true}},renderbufferStorage:{4:{0:true,1:true}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:true}},blendFunc:{2:{0:true,1:true}},blendFuncSeparate:{4:{0:true,1:true,2:true,3:true}},blendEquation:{1:{0:true}},blendEquationSeparate:{2:{0:true,1:true}},stencilFunc:{3:{0:true}},stencilFuncSeparate:{4:{0:true,1:true}},stencilMaskSeparate:{2:{0:true}},stencilOp:{3:{0:true,1:true,2:true}},stencilOpSeparate:{4:{0:true,1:true,2:true,3:true}},cullFace:{1:{0:true}},frontFace:{1:{0:true}},drawArraysInstancedANGLE:{4:{0:true}},drawElementsInstancedANGLE:{5:{0:true,2:true}},blendEquationEXT:{1:{0:true}}};var glEnums=null;var enumStringToValue=null;function init(ctx){if(glEnums==null){glEnums={};enumStringToValue={};for(var propertyName in ctx){if(typeof ctx[propertyName]=="number"){glEnums[ctx[propertyName]]=propertyName;enumStringToValue[propertyName]=ctx[propertyName]}}}}function checkInit(){if(glEnums==null){throw"WebGLDebugUtils.init(ctx) not called"}}function mightBeEnum(value){checkInit();return glEnums[value]!==undefined}function glEnumToString(value){checkInit();var name=glEnums[value];return name!==undefined?"gl."+name:"/*UNKNOWN WebGL ENUM*/ 0x"+value.toString(16)+""}function glFunctionArgToString(functionName,numArgs,argumentIndex,value){var funcInfo=glValidEnumContexts[functionName];if(funcInfo!==undefined){var funcInfo=funcInfo[numArgs];if(funcInfo!==undefined){if(funcInfo[argumentIndex]){if(typeof funcInfo[argumentIndex]==="object"&&funcInfo[argumentIndex]["enumBitwiseOr"]!==undefined){var enums=funcInfo[argumentIndex]["enumBitwiseOr"];var orResult=0;var orEnums=[];for(var i=0;i<enums.length;++i){var enumValue=enumStringToValue[enums[i]];if((value&enumValue)!==0){orResult|=enumValue;orEnums.push(glEnumToString(enumValue))}}if(orResult===value){return orEnums.join(" | ")}else{return glEnumToString(value)}}else{return glEnumToString(value)}}}}if(value===null){return"null"}else if(value===undefined){return"undefined"}else{return value.toString()}}function glFunctionArgsToString(functionName,args){var argStr="";var numArgs=args.length;for(var ii=0;ii<numArgs;++ii){argStr+=(ii==0?"":", ")+glFunctionArgToString(functionName,numArgs,ii,args[ii])}return argStr}function makePropertyWrapper(wrapper,original,propertyName){wrapper.__defineGetter__(propertyName,function(){return original[propertyName]});wrapper.__defineSetter__(propertyName,function(value){original[propertyName]=value})}function makeFunctionWrapper(original,functionName){var f=original[functionName];return function(){var result=f.apply(original,arguments);return result}}function makeDebugContext(ctx,opt_onErrorFunc,opt_onFunc,opt_err_ctx){opt_err_ctx=opt_err_ctx||ctx;init(ctx);opt_onErrorFunc=opt_onErrorFunc||function(err,functionName,args){var argStr="";var numArgs=args.length;for(var ii=0;ii<numArgs;++ii){argStr+=(ii==0?"":", ")+glFunctionArgToString(functionName,numArgs,ii,args[ii])}error("WebGL error "+glEnumToString(err)+" in "+functionName+"("+argStr+")")};var glErrorShadow={};function makeErrorWrapper(ctx,functionName){return function(){if(opt_onFunc){opt_onFunc(functionName,arguments)}var result=ctx[functionName].apply(ctx,arguments);var err=opt_err_ctx.getError();if(err!=0){glErrorShadow[err]=true;opt_onErrorFunc(err,functionName,arguments)}return result}}var wrapper={};for(var propertyName in ctx){if(typeof ctx[propertyName]=="function"){if(propertyName!="getExtension"){wrapper[propertyName]=makeErrorWrapper(ctx,propertyName)}else{var wrapped=makeErrorWrapper(ctx,propertyName);wrapper[propertyName]=function(){var result=wrapped.apply(ctx,arguments);return makeDebugContext(result,opt_onErrorFunc,opt_onFunc,opt_err_ctx)}}}else{makePropertyWrapper(wrapper,ctx,propertyName)}}wrapper.getError=function(){for(var err in glErrorShadow){if(glErrorShadow.hasOwnProperty(err)){if(glErrorShadow[err]){glErrorShadow[err]=false;return err}}}return ctx.NO_ERROR};return wrapper}function resetToInitialState(ctx){var numAttribs=ctx.getParameter(ctx.MAX_VERTEX_ATTRIBS);var tmp=ctx.createBuffer();ctx.bindBuffer(ctx.ARRAY_BUFFER,tmp);for(var ii=0;ii<numAttribs;++ii){ctx.disableVertexAttribArray(ii);ctx.vertexAttribPointer(ii,4,ctx.FLOAT,false,0,0);ctx.vertexAttrib1f(ii,0)}ctx.deleteBuffer(tmp);var numTextureUnits=ctx.getParameter(ctx.MAX_TEXTURE_IMAGE_UNITS);for(var ii=0;ii<numTextureUnits;++ii){ctx.activeTexture(ctx.TEXTURE0+ii);ctx.bindTexture(ctx.TEXTURE_CUBE_MAP,null);ctx.bindTexture(ctx.TEXTURE_2D,null)}ctx.activeTexture(ctx.TEXTURE0);ctx.useProgram(null);ctx.bindBuffer(ctx.ARRAY_BUFFER,null);ctx.bindBuffer(ctx.ELEMENT_ARRAY_BUFFER,null);ctx.bindFramebuffer(ctx.FRAMEBUFFER,null);ctx.bindRenderbuffer(ctx.RENDERBUFFER,null);ctx.disable(ctx.BLEND);ctx.disable(ctx.CULL_FACE);ctx.disable(ctx.DEPTH_TEST);ctx.disable(ctx.DITHER);ctx.disable(ctx.SCISSOR_TEST);ctx.blendColor(0,0,0,0);ctx.blendEquation(ctx.FUNC_ADD);ctx.blendFunc(ctx.ONE,ctx.ZERO);ctx.clearColor(0,0,0,0);ctx.clearDepth(1);ctx.clearStencil(-1);ctx.colorMask(true,true,true,true);ctx.cullFace(ctx.BACK);ctx.depthFunc(ctx.LESS);ctx.depthMask(true);ctx.depthRange(0,1);ctx.frontFace(ctx.CCW);ctx.hint(ctx.GENERATE_MIPMAP_HINT,ctx.DONT_CARE);ctx.lineWidth(1);ctx.pixelStorei(ctx.PACK_ALIGNMENT,4);ctx.pixelStorei(ctx.UNPACK_ALIGNMENT,4);ctx.pixelStorei(ctx.UNPACK_FLIP_Y_WEBGL,false);ctx.pixelStorei(ctx.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);if(ctx.UNPACK_COLORSPACE_CONVERSION_WEBGL){ctx.pixelStorei(ctx.UNPACK_COLORSPACE_CONVERSION_WEBGL,ctx.BROWSER_DEFAULT_WEBGL)}ctx.polygonOffset(0,0);ctx.sampleCoverage(1,false);ctx.scissor(0,0,ctx.canvas.width,ctx.canvas.height);ctx.stencilFunc(ctx.ALWAYS,0,4294967295);ctx.stencilMask(4294967295);ctx.stencilOp(ctx.KEEP,ctx.KEEP,ctx.KEEP);ctx.viewport(0,0,ctx.canvas.width,ctx.canvas.height);ctx.clear(ctx.COLOR_BUFFER_BIT|ctx.DEPTH_BUFFER_BIT|ctx.STENCIL_BUFFER_BIT);while(ctx.getError());}function makeLostContextSimulatingCanvas(canvas){var unwrappedContext_;var wrappedContext_;var onLost_=[];var onRestored_=[];var wrappedContext_={};var contextId_=1;var contextLost_=false;var resourceId_=0;var resourceDb_=[];var numCallsToLoseContext_=0;var numCalls_=0;var canRestore_=false;var restoreTimeout_=0;var glErrorShadow_={};canvas.getContext=function(f){return function(){var ctx=f.apply(canvas,arguments);if(ctx instanceof WebGLRenderingContext){if(ctx!=unwrappedContext_){if(unwrappedContext_){throw"got different context"}unwrappedContext_=ctx;wrappedContext_=makeLostContextSimulatingContext(unwrappedContext_)}return wrappedContext_}return ctx}}(canvas.getContext);function wrapEvent(listener){if(typeof listener=="function"){return listener}else{return function(info){listener.handleEvent(info)}}}var addOnContextLostListener=function(listener){onLost_.push(wrapEvent(listener))};var addOnContextRestoredListener=function(listener){
onRestored_.push(wrapEvent(listener))};function wrapAddEventListener(canvas){var f=canvas.addEventListener;canvas.addEventListener=function(type,listener,bubble){switch(type){case"webglcontextlost":addOnContextLostListener(listener);break;case"webglcontextrestored":addOnContextRestoredListener(listener);break;default:f.apply(canvas,arguments)}}}wrapAddEventListener(canvas);canvas.loseContext=function(){if(!contextLost_){contextLost_=true;numCallsToLoseContext_=0;++contextId_;while(unwrappedContext_.getError());clearErrors();glErrorShadow_[unwrappedContext_.CONTEXT_LOST_WEBGL]=true;var event=makeWebGLContextEvent("context lost");var callbacks=onLost_.slice();setTimeout(function(){for(var ii=0;ii<callbacks.length;++ii){callbacks[ii](event)}if(restoreTimeout_>=0){setTimeout(function(){canvas.restoreContext()},restoreTimeout_)}},0)}};canvas.restoreContext=function(){if(contextLost_){if(onRestored_.length){setTimeout(function(){if(!canRestore_){throw"can not restore. webglcontestlost listener did not call event.preventDefault"}freeResources();resetToInitialState(unwrappedContext_);contextLost_=false;numCalls_=0;canRestore_=false;var callbacks=onRestored_.slice();var event=makeWebGLContextEvent("context restored");for(var ii=0;ii<callbacks.length;++ii){callbacks[ii](event)}},0)}}};canvas.loseContextInNCalls=function(numCalls){if(contextLost_){throw"You can not ask a lost contet to be lost"}numCallsToLoseContext_=numCalls_+numCalls};canvas.getNumCalls=function(){return numCalls_};canvas.setRestoreTimeout=function(timeout){restoreTimeout_=timeout};function isWebGLObject(obj){return obj instanceof WebGLBuffer||obj instanceof WebGLFramebuffer||obj instanceof WebGLProgram||obj instanceof WebGLRenderbuffer||obj instanceof WebGLShader||obj instanceof WebGLTexture}function checkResources(args){for(var ii=0;ii<args.length;++ii){var arg=args[ii];if(isWebGLObject(arg)){return arg.__webglDebugContextLostId__==contextId_}}return true}function clearErrors(){var k=Object.keys(glErrorShadow_);for(var ii=0;ii<k.length;++ii){delete glErrorShadow_[k]}}function loseContextIfTime(){++numCalls_;if(!contextLost_){if(numCallsToLoseContext_==numCalls_){canvas.loseContext()}}}function makeLostContextFunctionWrapper(ctx,functionName){var f=ctx[functionName];return function(){loseContextIfTime();if(!contextLost_){var result=f.apply(ctx,arguments);return result}}}function freeResources(){for(var ii=0;ii<resourceDb_.length;++ii){var resource=resourceDb_[ii];if(resource instanceof WebGLBuffer){unwrappedContext_.deleteBuffer(resource)}else if(resource instanceof WebGLFramebuffer){unwrappedContext_.deleteFramebuffer(resource)}else if(resource instanceof WebGLProgram){unwrappedContext_.deleteProgram(resource)}else if(resource instanceof WebGLRenderbuffer){unwrappedContext_.deleteRenderbuffer(resource)}else if(resource instanceof WebGLShader){unwrappedContext_.deleteShader(resource)}else if(resource instanceof WebGLTexture){unwrappedContext_.deleteTexture(resource)}}}function makeWebGLContextEvent(statusMessage){return{statusMessage:statusMessage,preventDefault:function(){canRestore_=true}}}return canvas;function makeLostContextSimulatingContext(ctx){for(var propertyName in ctx){if(typeof ctx[propertyName]=="function"){wrappedContext_[propertyName]=makeLostContextFunctionWrapper(ctx,propertyName)}else{makePropertyWrapper(wrappedContext_,ctx,propertyName)}}wrappedContext_.getError=function(){loseContextIfTime();if(!contextLost_){var err;while(err=unwrappedContext_.getError()){glErrorShadow_[err]=true}}for(var err in glErrorShadow_){if(glErrorShadow_[err]){delete glErrorShadow_[err];return err}}return wrappedContext_.NO_ERROR};var creationFunctions=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];for(var ii=0;ii<creationFunctions.length;++ii){var functionName=creationFunctions[ii];wrappedContext_[functionName]=function(f){return function(){loseContextIfTime();if(contextLost_){return null}var obj=f.apply(ctx,arguments);obj.__webglDebugContextLostId__=contextId_;resourceDb_.push(obj);return obj}}(ctx[functionName])}var functionsThatShouldReturnNull=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(var ii=0;ii<functionsThatShouldReturnNull.length;++ii){var functionName=functionsThatShouldReturnNull[ii];wrappedContext_[functionName]=function(f){return function(){loseContextIfTime();if(contextLost_){return null}return f.apply(ctx,arguments)}}(wrappedContext_[functionName])}var isFunctions=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(var ii=0;ii<isFunctions.length;++ii){var functionName=isFunctions[ii];wrappedContext_[functionName]=function(f){return function(){loseContextIfTime();if(contextLost_){return false}return f.apply(ctx,arguments)}}(wrappedContext_[functionName])}wrappedContext_.checkFramebufferStatus=function(f){return function(){loseContextIfTime();if(contextLost_){return wrappedContext_.FRAMEBUFFER_UNSUPPORTED}return f.apply(ctx,arguments)}}(wrappedContext_.checkFramebufferStatus);wrappedContext_.getAttribLocation=function(f){return function(){loseContextIfTime();if(contextLost_){return-1}return f.apply(ctx,arguments)}}(wrappedContext_.getAttribLocation);wrappedContext_.getVertexAttribOffset=function(f){return function(){loseContextIfTime();if(contextLost_){return 0}return f.apply(ctx,arguments)}}(wrappedContext_.getVertexAttribOffset);wrappedContext_.isContextLost=function(){return contextLost_};return wrappedContext_}}return{init:init,mightBeEnum:mightBeEnum,glEnumToString:glEnumToString,glFunctionArgToString:glFunctionArgToString,glFunctionArgsToString:glFunctionArgsToString,makeDebugContext:makeDebugContext,makeLostContextSimulatingCanvas:makeLostContextSimulatingCanvas,resetToInitialState:resetToInitialState}}();module.exports=WebGLDebugUtils}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],1007:[function(require,module,exports){var bundleFn=arguments[3];var sources=arguments[4];var cache=arguments[5];var stringify=JSON.stringify;module.exports=function(fn,options){var wkey;var cacheKeys=Object.keys(cache);for(var i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i];var exp=cache[key].exports;if(exp===fn||exp&&exp.default===fn){wkey=key;break}}if(!wkey){wkey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var wcache={};for(var i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i];wcache[key]=key}sources[wkey]=[Function(["require","module","exports"],"("+fn+")(self)"),wcache]}var skey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var scache={};scache[wkey]=wkey;sources[skey]=[Function(["require"],"var f = require("+stringify(wkey)+");"+"(f.default ? f.default : f)(self);"),scache];var workerSources={};resolveSources(skey);function resolveSources(key){workerSources[key]=true;for(var depPath in sources[key][1]){var depKey=sources[key][1][depPath];if(!workerSources[depKey]){resolveSources(depKey)}}}var src="("+bundleFn+")({"+Object.keys(workerSources).map(function(key){return stringify(key)+":["+sources[key][0]+","+stringify(sources[key][1])+"]"}).join(",")+"},{},["+stringify(skey)+"])";var URL=window.URL||window.webkitURL||window.mozURL||window.msURL;var blob=new Blob([src],{type:"text/javascript"});if(options&&options.bare){return blob}var workerUrl=URL.createObjectURL(blob);var worker=new Worker(workerUrl);worker.objectURL=workerUrl;return worker}},{}],1008:[function(require,module,exports){module.exports.RADIUS=6378137;module.exports.FLATTENING=1/298.257223563;module.exports.POLAR_RADIUS=6356752.3142},{}],1009:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.WhooTS=global.WhooTS||{})})(this,function(exports){function getURL(baseUrl,layer,x,y,z,options){options=options||{};var url=baseUrl+"?"+["bbox="+getTileBBox(x,y,z),"format="+(options.format||"image/png"),"service="+(options.service||"WMS"),"version="+(options.version||"1.1.1"),"request="+(options.request||"GetMap"),"srs="+(options.srs||"EPSG:3857"),"width="+(options.width||256),"height="+(options.height||256),"layers="+layer].join("&");return url}function getTileBBox(x,y,z){y=Math.pow(2,z)-y-1;var min=getMercCoords(x*256,y*256,z),max=getMercCoords((x+1)*256,(y+1)*256,z);return min[0]+","+min[1]+","+max[0]+","+max[1]}function getMercCoords(x,y,z){var resolution=2*Math.PI*6378137/256/Math.pow(2,z),merc_x=x*resolution-2*Math.PI*6378137/2,merc_y=y*resolution-2*Math.PI*6378137/2;return[merc_x,merc_y]}exports.getURL=getURL;exports.getTileBBox=getTileBBox;exports.getMercCoords=getMercCoords;Object.defineProperty(exports,"__esModule",{value:true})})},{}],1010:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _map=require("./Components/map");var _map2=_interopRequireDefault(_map);var _reactRedux=require("react-redux");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var App=function(_Component){_inherits(App,_Component);function App(){_classCallCheck(this,App);return _possibleConstructorReturn(this,(App.__proto__||Object.getPrototypeOf(App)).apply(this,arguments))}_createClass(App,[{key:"render",value:function render(){return _react2.default.createElement("div",{className:"App"},_react2.default.createElement("div",{className:"App-container"},_react2.default.createElement(_map2.default,null)))}}]);return App}(_react.Component);exports.default=App},{"./Components/map":1011,react:948,"react-redux":919}],1011:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();require("babel-polyfill");var _react=require("react");var _react2=_interopRequireDefault(_react);var _reactRedux=require("react-redux");var _autobindDecorator=require("autobind-decorator");var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);var _reactMapGl=require("react-map-gl");var _reactMapGl2=_interopRequireDefault(_reactMapGl);var _mapUtils=require("../utils/map-utils");var _mapUtils2=_interopRequireDefault(_mapUtils);var _scatterplot=require("./scatterplot");var _scatterplot2=_interopRequireDefault(_scatterplot);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MAPBOX_ACCESS_TOKEN="pk.eyJ1IjoiamFjb2JraXN3ZW5kc2lkYSIsImEiOiJjaXk4cXo0eTUwMDdxMzJtcDhmM2Rocm9hIn0.lQgbjfdBvKzlXYeEQGEuPg";var SAMPLE_DATA=[[12,104],[23,14]];var Map=function(_Component){_inherits(Map,_Component);function Map(){_classCallCheck(this,Map);return _possibleConstructorReturn(this,(Map.__proto__||Object.getPrototypeOf(Map)).apply(this,arguments))}_createClass(Map,[{key:"render",value:function render(){var _props=this.props,viewport=_props.viewport,demo=_props.demo,params=_props.params,owner=_props.owner,data=_props.data,updateMeta=_props.updateMeta,isInteractive=_props.isInteractive;console.log("ffdfdf");return _react2.default.createElement(_reactMapGl2.default,{mapboxApiAccessToken:MAPBOX_ACCESS_TOKEN,width:400,height:400,latitude:37.7577,longitude:-122.4376,zoom:8,onChangeViewport:function onChangeViewport(viewport){var latitude=viewport.latitude,longitude=viewport.longitude,zoom=viewport.zoom}})}}]);return Map}(_react.Component);exports.default=Map;function mapStateToProps(state){return{viewport:state.viewport}}Map.defaultProps={onInteract:function onInteract(){},isInteractive:true}},{"../utils/map-utils":1016,"./scatterplot":1012,"autobind-decorator":3,"babel-polyfill":4,react:948,"react-map-gl":915,"react-redux":919}],1012:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();require("babel-polyfill");var _react=require("react");var _react2=_interopRequireDefault(_react);var _deck=require("deck.gl");var _react3=require("deck.gl/react");var _react4=_interopRequireDefault(_react3);var _formatUtils=require("../utils/format-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ScatterPlotDemo=function(_Component){_inherits(ScatterPlotDemo,_Component);function ScatterPlotDemo(){_classCallCheck(this,ScatterPlotDemo);return _possibleConstructorReturn(this,(ScatterPlotDemo.__proto__||Object.getPrototypeOf(ScatterPlotDemo)).apply(this,arguments))}_createClass(ScatterPlotDemo,[{key:"render",value:function render(){var _props=this.props,viewport=_props.viewport,params=_props.params,data=_props.data;if(!data){return null}var layer=new _deck.ScatterplotLayer({id:"scatter-plot",data:data,getPosition:function getPosition(d){return[d[0],d[1],0]},getColor:function getColor(d){return d[2]===1?params.colorM.value:params.colorF.value},getRadius:function getRadius(d){return params.radius.value},updateTriggers:{instanceColors:{c1:params.colorM.value,c2:params.colorF.value},instancePositions:{radius:params.radius.value}}});return _react2.default.createElement(_react4.default,_extends({},viewport,{layers:[layer]}))}}],[{key:"renderInfo",value:function renderInfo(meta){return _react2.default.createElement("div",null,_react2.default.createElement("h3",null,"Every Person in New York City"),_react2.default.createElement("p",null,"Each dot accounts for 10 people. Density per tract from 2015 census data."),_react2.default.createElement("p",null,"Data source: ",_react2.default.createElement("a",{href:"http://www.census.gov"},"US Census Bureau")),_react2.default.createElement("div",{className:"stat"},"Instances",_react2.default.createElement("b",null,(0,_formatUtils.readableInteger)(meta.points||0))))}},{key:"data",get:function get(){return{url:"data/scatterplot-data.txt",worker:"workers/scatterplot-data-decoder.js"}}},{key:"parameters",get:function get(){return{colorM:{displayName:"Male",type:"color",value:"#08f"},colorF:{displayName:"Female",type:"color",value:"#f08"},radius:{displayName:"Radius",type:"number",value:.3,step:.1,min:.1}}}},{key:"viewport",get:function get(){return{longitude:-74,latitude:40.7,zoom:11,maxZoom:16,pitch:0,bearing:0}}}]);return ScatterPlotDemo}(_react.Component);exports.default=ScatterPlotDemo},{"../utils/format-utils":1015,"babel-polyfill":4,"deck.gl":385,"deck.gl/react":387,react:948}],1013:[function(require,module,exports){"use strict";var _react=require("react");var _react2=_interopRequireDefault(_react);var _reactDom=require("react-dom");var _reactDom2=_interopRequireDefault(_reactDom);var _App=require("./App.js");var _App2=_interopRequireDefault(_App);var _reactRedux=require("react-redux");var _reducers=require("./reducers");var _reducers2=_interopRequireDefault(_reducers);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_reactDom2.default.render(_react2.default.createElement(_reactRedux.Provider,{store:_reducers2.default},_react2.default.createElement(_App2.default,null)),document.getElementById("root"));console.log("jfdfdfd")},{"./App.js":1010,"./reducers":1014,react:948,"react-dom":773,"react-redux":919}],1014:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _redux=require("redux");var _reduxThunk=require("redux-thunk");var _reduxThunk2=_interopRequireDefault(_reduxThunk);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function appReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var action=arguments[1];switch(state){default:return state}}exports.default=(0,_redux.createStore)((0,_redux.combineReducers)({app:appReducer}),(0,_redux.applyMiddleware)(_reduxThunk2.default))},{redux:961,"redux-thunk":955}],1015:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.normalizeParam=normalizeParam;exports.readableInteger=readableInteger;var _d3Color=require("d3-color");function normalizeParam(p){var value=p.value;var displayValue=void 0;switch(p.type){case"color":var color=(0,_d3Color.rgb)(value);value=[color.r,color.g,color.b];displayValue="#"+value.map(function(v){return""+(v<16?"0":"")+v.toString(16)}).join("");break;default:displayValue=value.toString()}return _extends({},p,{value:value,displayValue:displayValue})}function readableInteger(x){if(!x){return 0}if(x<1e3){return x.toString()}x/=1e3;if(x<1e3){return x.toFixed(1)+"K"}x/=1e3;return x.toFixed(1)+"M"}},{"d3-color":325}],1016:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _tween=require("tween.js");var _tween2=_interopRequireDefault(_tween);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var viewportTween=void 0;function animate(){_tween2.default.update();requestAnimationFrame(animate)}function ease(fromState,toState,duration){return new _tween2.default.Tween(fromState).to(toState,duration)}function fly(fromViewport,toViewport,duration,onUpdate){var fromState={};var nanState={};var toState={};Object.keys(toViewport).forEach(function(key){var v0=fromViewport[key];var v1=toViewport[key];if(isNaN(v0)||isNaN(v1)){nanState[key]=v1}else{fromState[key]=v0;toState[key]=v1}});if(viewportTween){_tween2.default.remove(viewportTween)}viewportTween=new _tween2.default.Tween(fromState).to(toState,duration).onUpdate(function(){onUpdate(_extends({},this,nanState))});return viewportTween}exports.default={init:animate,Easing:_tween2.default.Easing,ease:ease,fly:fly}},{"tween.js":990}]},{},[1013]);
